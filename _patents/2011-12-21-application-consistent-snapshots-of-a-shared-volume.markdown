---
title: Application consistent snapshots of a shared volume
abstract: The present invention extends to methods, systems, and computer program products for creating a snapshot of a shared volume that is application consistent across various nodes of a cluster. The invention enables a snapshot of a volume to be initiated on one node which causes all applications in the cluster that use the volume to persist their data to the volume prior to the snapshot being created. Accordingly, the snapshot is application consistent to all applications in the cluster that use the volume. The invention also enables applications on various nodes to perform post snapshot processing on the created snapshot. The invention can be used in an existing backup system that is not cluster aware to enable the existing backup system to create application consistent snapshots of a volume shared by applications across multiple nodes of a cluster.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08516210&OS=08516210&RS=08516210
owner: Microsoft Corporation
number: 08516210
owner_city: Redmond
owner_country: US
publication_date: 20111221
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","BACKGROUND","1. Background and Relevant Art","BRIEF SUMMARY","DETAILED DESCRIPTION"],"p":["Not Applicable.","Computer systems and related technology affect many aspects of society. Indeed, the computer system's ability to process information has transformed the way we live and work. Computer systems now commonly perform a host of tasks (e.g., word processing, scheduling, accounting, etc.) that prior to the advent of the computer system were performed manually. More recently, computer systems have been coupled to one another and to other electronic devices to form both wired and wireless computer networks over which the computer systems and other electronic devices can transfer electronic data. Accordingly, the performance of many computing tasks are distributed across a number of different computer systems and\/or a number of different computing environments.","It is becoming more and more common to host applications within a distributed environment. For example, applications are often hosted on a node (e.g. a server) of a cluster of nodes. In the cluster, different applications can be hosted on different nodes but may each have access to one or more common storage volumes. In other words, one storage may be accessed by many different applications spread across various nodes of the cluster.",{"@attributes":{"id":"p-0005","num":"0004"},"figref":"FIG. 1","b":["100","101","103","104","104"],"i":"a "},"The components depicted in  represent a prior art backup system that has been used to perform backups in cluster as well as non-cluster environments. Microsoft's Volume Shadow Copy Service (VSS) is an example of a coordinator that can be used in this type of backup system. In this backup system, coordinators - are used to coordinate backups of shared volumes such as volume . This backup can comprise a point-in-time image (i.e. snapshot) of volume . Although the creation of a snapshot will be described as occurring on node , similar steps can be carried out on each node to create a snapshot of volume on the node. In other words, each coordinator on nodes - functions similarly to create snapshots of a volume.","To create a snapshot on node , backup application  sends a request to coordinator  to create a snapshot. In this request, backup application  specifies a storage provider (in this example, storage provider ) that should be used to create the snapshot. Coordinator  communicates with the writer of each application on node  (writers and ) instructing them to prepare for a snapshot. This communication is referred to as a freeze command.","Such preparation includes flushing in-memory cache to disk and suspending (i.e. freezing) writes by the application until the snapshot is created. In this way, each writer ensures that all application data is persisted to volume before a snapshot is created. Once each writer has returned from the freeze command, coordinator  instructs volume to prepare for the snapshot such as by persisting file system metadata to volume and suspending writes to volume . This communication is referred to as a flush and hold command.","Once volume has returned from the flush and hold command, coordinator  instructs storage provider  to create the snapshot of volume . This is referred to as a commit command. Although one storage provider is shown, a node may employ multiple storage providers such as a hardware storage provider for interfacing directly with a hardware controller for storage , or a software storage provider for interfacing with an operating system (e.g. the file system). For purposes of the present invention, the type of storage provider used to create a snapshot is not important.","Storage provider  creates a snapshot of volume . This snapshot is a copy of the contents of volume as they existed at a single point-in-time (e.g. the point-in-time after each writer has persisted the data of each application on node  to volume and volume has flushed its cache). Once this snapshot is created and storage provider  returns from the commit command, coordinator  instructs volume that it can recommence processing (referred to as a release command), and then instructs each writer that the applications can recommence writing to volume (referred to as a thaw command). As can be seen, this backup process allows the applications to continue executing during the creation of the snapshot. The applications are only prevented from writing to volume between the receipt of the freeze and thaw commands. However, the applications can continue to read volume during this time.","This backup process produces a point-in-time snapshot of volume that has file system consistency because the flush and hold command causes all file system data to be persisted before the snapshot is created. The point-in-time snapshot also has application consistency to each application running on the node where the snapshot was initiated, which in this example is node , because the freeze command causes each application to persist its data to volume ","However, when this prior art backup process is used in a cluster environment, the point-in-time snapshot of volume does not have application consistency to each application running on nodes  or . This is because coordinator  does not communicate with other nodes in the cluster (e.g. nodes  and ). More specifically, this prior art backup system is not configured to allow a coordinator on one node to communicate with a coordinator or writers on another node. Accordingly, applications , , , and  will contain in-memory cache (or other non-persisted data) that was not persisted to volume prior to the creation of the snapshot on node , and therefore, this non-persisted data will not be included in the snapshot.","Because of this, in this prior art backup system, to create a point-in-time snapshot for each application in the cluster, a user is forced to initiate a snapshot on each of the nodes in the cluster. For example, a user would use backup applications  and  on each of nodes  and  to communicate with coordinators  and  respectively to create separate point-in-time snapshots of volume following the same process described above. This results in a separate snapshot being created on each node in the cluster.","The present invention extends to methods, systems, and computer program products for creating a snapshot of a shared volume that is application consistent across various nodes. The invention enables a snapshot of a volume to be initiated on one node which causes all applications in the cluster that use the volume to persist their data to the volume prior to the snapshot being created. Accordingly, the snapshot is application consistent to all applications in the cluster that use the volume. The invention also enables applications on the other nodes to perform post snapshot processing on the snapshot created on the node.","In one embodiment, a request is received at a backup coordinator on a first node of a cluster. The request is received from a backup application and requests that a snapshot be created of a shared volume used by at least one application on the first node and on at least one other node in the cluster. Each of the at least one application on the first and at least one other node includes a writer. Each of the first and at least one other node also includes a cluster writer.","The backup coordinator sends a freeze command to the cluster writer and each writer on the first node. The freeze command instructs the cluster writer and each writer on the first node to persist application data to the shared volume. The cluster writer on the first node then sends a notification of the freeze command to the cluster service on the first node. The cluster service on the first node sends a notification of the freeze command to the cluster service on each of the at least on other node. The notification instructs the cluster service on each of the at least one other node to initiate a backup process of the shared volume on each of the least one other node.","The cluster writer on the first node waits for a notification from the cluster service on each of the at least one other node prior to returning from the freeze command. This notification indicates that each writer on the corresponding node has persisted corresponding application data to the shared volume. Upon receiving the notification from the cluster service on each of the at last one other node, the cluster writer on the first node returns from the freeze command.","Once the cluster writer on the first node returns from the freeze command, the backup coordinator sends a request to a storage provider on the first node. The request causes the storage provider to create a snapshot of the shared volume. The snapshot has application consistency to each application on the first node and on the at least on other node that uses the shared volume.","In another embodiment, a notification is received at a cluster service on a first node. The notification indicates that a backup process of a shared volume has been initiated on a second node in the cluster. The shared volume is used by at least one application on each of the first and second nodes. The notification is received from a cluster service on the second node and indicates that a freeze command was received by a cluster writer on the second node.","The cluster service on the first node sends a request to a backup coordinator on the first node. The request requests that a snapshot be created of the shared volume. The backup coordinator sends a freeze command to the cluster writer and a writer of the at least one application on the first node. The freeze command instructs the cluster writer and the at least one writer to persist application data to the shared volume.","After the cluster writer and the at least one writer return from the freeze command, the backup coordinator sends a commit command to a helper provider on the first node. The helper provider on the first node sends a notification of the commit command to the cluster service on the first node. The helper provider blocks on the commit command. The cluster service on the first node then sends a notification to the cluster writer on the second node that the commit command has been received thus indicating that each writer on the first node has persisted the data of the corresponding application to the shared volume.","This summary is provided to introduce a selection of concepts in a simplified form that are further described below in the Detailed Description. This Summary is not intended to identify key features or essential features of the claimed subject matter, nor is it intended to be used as an aid in determining the scope of the claimed subject matter.","Additional features and advantages of the invention will be set forth in the description which follows, and in part will be obvious from the description, or may be learned by the practice of the invention. The features and advantages of the invention may be realized and obtained by means of the instruments and combinations particularly pointed out in the appended claims. These and other features of the present invention will become more fully apparent from the following description and appended claims, or may be learned by the practice of the invention as set forth hereinafter.","The present invention extends to methods, systems, and computer program products for creating a snapshot of a shared volume that is application consistent across various nodes. The invention enables a snapshot of a volume to be initiated on one node which causes all applications in the cluster that use the volume to persist their data to the volume prior to the snapshot being created. Accordingly, the snapshot is application consistent to all applications in the cluster that use the volume. The invention also enables applications on the other nodes to perform post snapshot processing on the snapshot created on the node.","In one embodiment, a request is received at a backup coordinator on a first node of a cluster. The request is received from a backup application and requests that a snapshot be created of a shared volume used by at least one application on the first node and on at least one other node in the cluster. Each of the at least one application on the first and at least one other node includes a writer. Each of the first and at least one other node also includes a cluster writer.","The backup coordinator sends a freeze command to the cluster writer and each writer on the first node. The freeze command instructs the cluster writer and each writer on the first node to persist application data to the shared volume. The cluster writer on the first node then sends a notification of the freeze command to the cluster service on the first node. The cluster service on the first node sends a notification of the freeze command to the cluster service on each of the at least on other node. The notification instructs the cluster service on each of the at least one other node to initiate a backup process of the shared volume on each of the least one other node.","The cluster writer on the first node waits for a notification from the cluster service on each of the at least one other node prior to returning from the freeze command. This notification indicates that each writer on the corresponding node has persisted corresponding application data to the shared volume. Upon receiving the notification from the cluster service on each of the at last one other node, the cluster writer on the first node returns from the freeze command.","Once the cluster writer on the first node returns from the freeze command, the backup coordinator sends a request to a storage provider on the first node. The request causes the storage provider to create a snapshot of the shared volume. The snapshot has application consistency to each application on the first node and on the at least on other node that uses the shared volume.","In another embodiment, a notification is received at a cluster service on a first node. The notification indicates that a backup process of a shared volume has been initiated on a second node in the cluster. The shared volume is used by at least one application on each of the first and second nodes. The notification is received from a cluster service on the second node and indicates that a freeze command was received by a cluster writer on the second node.","The cluster service on the first node sends a request to a backup coordinator on the first node. The request requests that a snapshot be created of the shared volume. The backup coordinator sends a freeze command to the cluster writer and a writer of the at least one application on the first node. The freeze command instructs the cluster writer and the at least one writer to persist application data to the shared volume.","After the cluster writer and the at least one writer return from the freeze command, the backup coordinator sends a commit command to a helper provider on the first node. The helper provider on the first node sends a notification of the commit command to the cluster service on the first node. The helper provider blocks on the commit command. The cluster service on the first node then sends a notification to the cluster writer on the second node that the commit command has been received thus indicating that each writer on the first node has persisted the data of the corresponding application to the shared volume.","Embodiments of the present invention may comprise or utilize a special purpose or general-purpose computer including computer hardware, such as, for example, one or more processors and system memory, as discussed in greater detail below. Embodiments within the scope of the present invention also include physical and other computer-readable media for carrying or storing computer-executable instructions and\/or data structures. Such computer-readable media can be any available media that can be accessed by a general purpose or special purpose computer system. Computer-readable media that store computer-executable instructions are computer storage media (devices). Computer-readable media that carry computer-executable instructions are transmission media. Thus, by way of example, and not limitation, embodiments of the invention can comprise at least two distinctly different kinds of computer-readable media: computer storage media (devices) and transmission media.","Computer storage media (devices) includes RAM, ROM, EEPROM, CD-ROM, solid state drives (\u201cSSDs\u201d) (e.g., based on RAM), Flash memory, phase-change memory (\u201cPCM\u201d), other types of memory, other optical disk storage, magnetic disk storage or other magnetic storage devices, or any other medium which can be used to store desired program code means in the form of computer-executable instructions or data structures and which can be accessed by a general purpose or special purpose computer.","A \u201cnetwork\u201d is defined as one or more data links that enable the transport of electronic data between computer systems and\/or modules and\/or other electronic devices. When information is transferred or provided over a network or another communications connection (either hardwired, wireless, or a combination of hardwired or wireless) to a computer, the computer properly views the connection as a transmission medium. Transmissions media can include a network and\/or data links which can be used to carry desired program code means in the form of computer-executable instructions or data structures and which can be accessed by a general purpose or special purpose computer. Combinations of the above should also be included within the scope of computer-readable media.","Further, upon reaching various computer system components, program code means in the form of computer-executable instructions or data structures can be transferred automatically from transmission media to computer storage media (devices) (or vice versa). For example, computer-executable instructions or data structures received over a network or data link can be buffered in RAM within a network interface module (e.g., a \u201cNIC\u201d), and then eventually transferred to computer system RAM and\/or to less volatile computer storage media (devices) at a computer system. Thus, it should be understood that computer storage media (devices) can be included in computer system components that also (or even primarily) utilize transmission media.","Computer-executable instructions comprise, for example, instructions and data which, when executed at a processor, cause a general purpose computer, special purpose computer, or special purpose processing device to perform a certain function or group of functions. The computer executable instructions may be, for example, binaries, intermediate format instructions such as assembly language, or even source code. Although the subject matter has been described in language specific to structural features and\/or methodological acts, it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the described features or acts described above. Rather, the described features and acts are disclosed as example forms of implementing the claims.","Those skilled in the art will appreciate that the invention may be practiced in network computing environments with many types of computer system configurations, including, personal computers, desktop computers, laptop computers, message processors, hand-held devices, multi-processor systems, microprocessor-based or programmable consumer electronics, network PCs, minicomputers, mainframe computers, mobile telephones, PDAs, tablets, pagers, routers, switches, and the like. The invention may also be practiced in distributed system environments where local and remote computer systems, which are linked (either by hardwired data links, wireless data links, or by a combination of hardwired and wireless data links) through a network, both perform tasks. In a distributed system environment, program modules may be located in both local and remote memory storage devices.",{"@attributes":{"id":"p-0045","num":"0044"},"figref":["FIG. 2","FIG. 1","FIG. 1"],"b":["200","100","200","124","134","123","133","102","103","104","200","104"],"i":["a ","a"]},"As described with respect to , backup application  can initiate the creation of a snapshot of volume by communicating with coordinator . This communication includes specifying that storage provider  should be used to create the snapshot. In response to the request from backup application , coordinator  sends a freeze command to writers and as well as to cluster writer  (because cluster writer , like writers and , is registered with coordinator  as a writer).","Writers and respond to the freeze command as described above with respect to . However, in response to the freeze command, cluster writer  communicates with cluster service  on node  who then communicates with the cluster services on the other nodes of the cluster. Accordingly, a notification of the occurrence of the freeze command on node  is broadcast by cluster service  to cluster services  and .","After notifying cluster service  of the freeze command, cluster writer  waits (i.e. does not return from the freeze command) until it receives a response from each of cluster services  and . By waiting to respond to the freeze command, cluster writer  prevents coordinator  from proceeding with the backup process.","When a cluster service receives notification of the occurrence of a freeze command on another node in the cluster, the cluster service acts as a backup application to initiate the creation of a snapshot on the corresponding node. For example, when cluster service  receives the notification from cluster service , cluster service  will communicate with coordinator  to initiate the creation of a snapshot on node . Cluster service  specifies that helper provider  should be used to create the snapshot on node . Similarly, when cluster service  receives the notification from cluster service , cluster service  will communicate with coordinator  to initiate the creation of a snapshot on node . Cluster service  specifies that helper provider  should be used to create the snapshot on node .","As a result, coordinators  and  commence the creation of a snapshot on nodes  and  respectively by sending freeze commands to each writer on the node. For example, coordinator  sends a freeze command to writers and , as well as to cluster writer , while coordinator  sends a freeze command to writers and , as well as to cluster writer . As described with respect to , the freeze command causes each writer to prepare for the creation of a snapshot such as by persisting its in-memory data. Cluster writers  and  simply return from the freeze command.","After the writers on nodes  and  return from the freeze command, coordinators  and  send a flush and hold command to volume . How these flush and hold commands are processed is not essential to the invention. For purposes of this invention, it is understood that these flush and hold commands from coordinators  and  are not ultimately routed to volume (because a flush and hold command will be sent to volume by coordinator  as described below).","Next, coordinators  and  send a commit command to helper providers  and  respectively (because helper providers  and  were specified in the respective requests to initiate a snapshot). Helper providers  and  respond to the commit command by blocking. In other words, helper providers  and  do not initially respond to coordinators  and . Additionally, helper providers  and  do not create a snapshot of volume (as would be done if a storage provider were sent the commit command).","Instead, helper providers  and  notify cluster services  and  respectively of the commit command. In response, each of cluster services  and  notifies cluster writer . These notifications inform cluster writer  that the freeze command was successfully completed on each of nodes  and  thus indicating that the applications on nodes  and  have successfully persisted their data to volume ","Because helper providers  and  block on the commit command, coordinators  and  will not send a release or a thaw command to volume or the respective writers thus preventing the writers from modifying volume until the snapshot has been created on node .","Once cluster writer  has received the notifications from cluster writers  and , cluster writer  returns from the freeze command (i.e. informs coordinator  that it has completed processing in response to the freeze command). Coordinator  then proceeds with the flush and hold command and the commit command, as described above, resulting in storage provider  creating a snapshot of volume . This snapshot is application consistent to all applications in the cluster that use volume because each application persisted its data to volume prior to the snapshot being created.",{"@attributes":{"id":"p-0056","num":"0055"},"figref":["FIG. 3","FIG. 3"],"b":["300","300","200"],"ul":{"@attributes":{"id":"ul0001","list-style":"none"},"li":{"@attributes":{"id":"ul0001-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0002","list-style":"none"},"li":["(1) Backup application  requests that coordinator  initiate the creation of a snapshot of volume using storage provider .","(2) Coordinator  sends a freeze command to writer and cluster writer . Writer processes the freeze command and returns at some point.","(3) Cluster writer  notifies cluster service  of the freeze command on node  and blocks.","(4) Cluster service  notifies cluster service  of the freeze command.","(5) Cluster service  requests that coordinator  initiate the creation of a snapshot of volume using helper provider .","(6) Coordinator  sends a freeze command to writer and cluster writer . Writer processes the freeze command and returns at some point. Cluster writer  simply returns from the freeze command.","(7) Coordinator  sends a flush and hold command to volume . The flush and hold command is processed without being sent to volume ","(8) Coordinator  sends a commit command to helper provider .","(9) Helper provider  sends a notification of the commit command to cluster service  and blocks.","(10) Cluster service  notifies cluster writer  of the commit command.","(11) Cluster writer  returns from the freeze command.","(12) Coordinator  sends flush and hold command to volume . Volume processes the flush and hold command and returns.","(13) Coordinator  sends commit command to storage provider .","(14) Storage provider  creates a snapshot of volume "]}}}},"Returning again to , after the snapshot of volume has been created, various additional steps are carried out to finish the backup process. After the snapshot is created, coordinator  sends a post snapshot command to at least some of the writers (e.g. a hypervisor writer and the cluster writer) to allow the writers to perform some minimal processing on the created snapshot prior to the snapshot being finalized (e.g. written to tape). This minimal processing is generally limited to modifications to an application's own data (e.g. rolling back a partially committed transaction).","When cluster writer  receives the post snapshot command, cluster writer  notifies cluster service  who then sends a notification of the post snapshot command to cluster services  and . Cluster writer  then waits until a response is received from each of cluster services  and  before returning from the post snapshot command. In this sense, cluster writer  handles the post snapshot command in much the same way as it handles the freeze command (i.e. by blocking).","The reason for notifying the other nodes of the post snapshot command is to allow the writers on the other nodes to perform post snapshot processing on the snapshot. Because the actual snapshot is located on node , a virtual snapshot is created on each of nodes  and . Commonly owned U.S. patent application Ser. No. 12\/971,981, filed Dec. 17, 2010, titled BACKUP AND RESTORE OF DATA FROM ANY CLUSTER NODE, describes how virtual snapshots are used to perform post snapshot processing.","Upon receiving the notification of the post snapshot command, cluster services  and  then notify helper providers  and  respectively. Until this point, helper providers  and  have been blocking on the commit command. The notification that the post snapshot command was sent on node  indicates to helper providers  and  that they can return from the commit command.","Once helper providers  and  return from the commit command, coordinators  and  each send a post snapshot command to at least some of the writers on the respective node. In this way, each writer on each node is given the opportunity to perform additional processing on the created snapshot. As in the freeze command case, cluster writers  and  also receive the post snapshot command and simply return.","Once each writer on nodes  and  has returned from the post snapshot command, coordinators  and  can finish the backup process (e.g. by sending out a release and a thaw command), and then notify cluster services  and  respectively that the snapshot is complete. Cluster services  and  receive this notification because they are acting as the backup applications on nodes  and  (i.e. they initiated the backup process). Cluster services  and  then notify cluster writer  of the completion of the backup process on nodes  and .","Once cluster writer  has received the notification of the completion of the backup process on each of the other nodes, cluster writer  returns from the post snapshot command thus allowing coordinator  to finish the backup process on node  (e.g. by sending out a release and thaw command). Coordinator  then notifies backup application  that the snapshot has been successfully created. Backup application  can then do whatever is desired with the snapshot (e.g. copy it to tape).",{"@attributes":{"id":"p-0064","num":"0077"},"figref":["FIG. 4","FIG. 3","FIG. 3"],"b":"300","ul":{"@attributes":{"id":"ul0003","list-style":"none"},"li":{"@attributes":{"id":"ul0003-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0004","list-style":"none"},"li":["(1) Coordinator  sends a post snapshot command to writer and cluster writer . Writer processes the post snapshot command and returns at some point.","(2) Cluster writer  notifies cluster service  of the post snapshot command and blocks.","(3) Cluster service  notifies cluster service  of the post snapshot command.","(4) Cluster service  notifies helper provider  that the post snapshot command was received by cluster writer  on node .","(5) Helper provider  returns from the commit command.","(6) Coordinator  sends a post snapshot command to writer and cluster writer . Writer processes the post snapshot command and returns at some point. Cluster writer  simply returns.","(7) Once each writer has returned from the post snapshot command, coordinator  notifies cluster service  (who requested the backup on node ) that the snapshot is complete.","(8) Cluster service  notifies cluster writer  of the completion of the backup process on node .","(9) Cluster writer  returns from the post snapshot command.","(10) Coordinator  notifies backup application  that the snapshot has been successfully created."]}}}},"As can be seen, by this process of using a cluster writer on one node to communicate the occurrence of freeze and post snapshot commands to cluster writers on other nodes, the writers on these other nodes are able to persist the data of the corresponding applications on these other nodes. The result is that the snapshot created on one node has application consistency, not only to the applications on the node on which the backup was initiated, but to all the applications, on any node in the cluster, that use the volume being backed up.","Further, this process enables the prior art backup system described in  to be used to create these cluster wide application consistent snapshots without having to modify the basic control flow of the backup system. In other words, the coordinators on each node do not need to be modified to implement the invention. The cluster writers and helper providers obscure, from the coordinators, the additional steps carried out to create the cluster wide application consistent snapshot (i.e. to the coordinator, the cluster writer appears to be a writer, and the helper provider appears to be a storage provider).",{"@attributes":{"id":"p-0067","num":"0090"},"figref":["FIG. 5","FIG. 2"],"b":["500","500","200"]},"Method  includes an act  of receiving a request, from a backup application, at a backup coordinator on a first node. The request requests that a snapshot be created of a shared volume used by at least one application on the first node and by at least one application on at least one other node in the cluster. Each of the at least one application on the first node and on the at least one other node includes a writer. Each of the first node and the at least one other node also includes a cluster service and a cluster writer. For example, coordinator  can receive a request from backup application  that requests that a snapshot be created of volume ","Method  includes an act  of sending, by the backup coordinator, a freeze command to the cluster writer and each writer on the first node. The freeze command instructs the cluster writer and each writer on the first node to persist application data to the shared volume. For example, coordinator  can send a freeze command to writers and as well as to cluster writer .","Method  includes an act  of sending, by the cluster writer on the first node, a notification of the freeze command to the cluster service on the first node. For example, cluster writer  can notify cluster service  of the freeze command.","Method  includes an act  of sending, by the cluster service on the first node, a notification of the freeze command to the cluster service on each of the at least one other node. The notification instructs the cluster service on each of the at least one other node to initiate a backup process of the shared volume on each of the at least one other node. For example, cluster service  can send a notification to cluster services  and .","Method  includes an act  of waiting, by the cluster writer on the first node, for a notification from the cluster service on each of the at least one other node prior to returning from the freeze command. The notification indicates that each writer on the corresponding node has persisted corresponding application data to the shared volume. For example, cluster writer  can block on the freeze command until cluster service  and cluster service  notify cluster writer  that writers and , and writers and respectively have persisted their corresponding application data to volume ","Method  includes an act  of, upon receiving the notification from the cluster service on each of the at least one other node, returning, by the cluster writer on the first node, from the freeze command. For example, cluster writer  can return from the freeze command upon receiving the notification from cluster services  and .","Method  includes an act  of, upon the cluster writer on the first node returning from the freeze command, sending, by the backup coordinator, a request to the storage provider. The request causes the storage provider to create a snapshot of the shared volume, the snapshot having application consistency to each application on the first node and the at least one other node that uses the shared volume. For example, coordinator  can request that storage provider  create a snapshot of volume ",{"@attributes":{"id":"p-0075","num":"0098"},"figref":["FIG. 6","FIG. 2"],"b":["600","600","200"]},"Method  includes an act  of receiving a notification, at a cluster service on the first node, that a backup process of a shared volume has been initiated on a second node in the cluster. The shared volume is used by at least one application on each of the first and second nodes. The notification is received from a cluster service on the second node and indicates that a freeze command was received by a cluster writer on the second node. For example, cluster service  can receive a notification from cluster service  indicating that cluster writer  received a freeze command, of a backup process, from coordinator .","Method  includes an act  of sending, by the cluster service on the first node, a request to a backup coordinator on the first node. The request requests that a snapshot be created of the shared volume. For example, cluster service  can send a request to coordinator  to request that a snapshot of volume be created on node .","Method  includes an act  of sending, by the backup coordinator, a freeze command to a cluster writer and a writer of the at least one application on the first node. The freeze command instructs the cluster writer and the at least one writer to persist application data to the shared volume. For example, coordinator  can send a freeze command to writers and as well as to cluster writer .","Method  includes an act  of, after the cluster writer and the at least one writer return from the freeze command, sending, by the backup coordinator, a commit command to a helper provider on the first node. For example, coordinator  can send a commit command to helper provider .","Method  includes an act  of sending, by the helper provider on the first node, a notification of the commit command to the cluster service on the first node. The helper provider blocks on the commit command. For example, helper provider  can notify cluster service  of the commit command and then block.","Method  includes an act  of sending, by the cluster service on the first node, a notification to the cluster writer on the second node that the commit command has been received thus indicating that each writer on the first node has persisted the data of the corresponding application to the shared volume. For example, cluster service  can send a notification to cluster writer  indicating that writers and have persisted their application data to volume ","The present invention may be embodied in other specific forms without departing from its spirit or essential characteristics. The described embodiments are to be considered in all respects only as illustrative and not restrictive. The scope of the invention is, therefore, indicated by the appended claims rather than by the foregoing description. All changes which come within the meaning and range of equivalency of the claims are to be embraced within their scope."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["In order to describe the manner in which the above-recited and other advantages and features of the invention can be obtained, a more particular description of the invention briefly described above will be rendered by reference to specific embodiments thereof which are illustrated in the appended drawings. Understanding that these drawings depict only typical embodiments of the invention and are not therefore to be considered to be limiting of its scope, the invention will be described and explained with additional specificity and detail through the use of the accompanying drawings in which:",{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
