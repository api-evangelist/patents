---
title: Making a physical copy of data at a remote storage device
abstract: Systems and methods relating to making a physical copy at a remote storage device of data on a local storage device in response to a command from a backup application operatively associated with the local storage device are disclosed. An exemplary method comprises replicating the data from the local storage device on the remote storage device. The method also comprises copying the data replicated at the remote storage device to a physical medium operatively associated with the remote storage device in response to a command from the backup application operatively associated with the local storage device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08612705&OS=08612705&RS=08612705
owner: Hewlett-Packard Development Company, L.P.
number: 08612705
owner_city: Houston
owner_country: US
publication_date: 20090729
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","DETAILED DESCRIPTION"],"p":["Storage devices commonly implement data replication operations, e.g., for data archiving and recovery. Data in virtual libraries may be replicated in another virtual library at a remote site. However, the backup application is not allowed to \u201csee\u201d the virtual library at the remote site because the backup application typically is not configured to handle two or more copies of the data (e g., having the same name, barcode, and\/or contents, etc.) Accordingly, the backup application cannot access the remote virtual library.","Enterprise customers often desire to backup data at the remote site on a physical medium (e.g., a backup tape). The physical medium serves as a \u201ccarved-off\u201d physical copy of the virtual library, and may be saved for use as an archive, test tape, etc. Because the physical medium is different from the virtual library (e.g., perhaps having a different barcode, size, cartridge type, retention time, or contents, etc.), the backup application needs to be used for copying the data from the virtual storage to the physical medium. Specifically, a virtual tape cannot be replicated on a physical tape if the virtual tape and physical tape have different characteristics (e.g., different sizes, different barcodes, and different contents). For example, multiple 100 GB virtual tapes may be copied onto a single 800 GB physical tape, and therefore the backup application must be in control. In other words, the virtual storage cannot simply be replicated to the physical medium. But since the backup application cannot handle both local and remote virtual libraries, other solutions are needed to copy a remote virtual library to a remote physical medium.","A virtual library may be used for \u201ctape stacking\u201d where multiple virtual tapes are copied onto a physical tape. But the physical tape cannot be restored directly by the backup application since the \u201cstacked tape\u201d is a custom format created by the virtual library, and thus would have to be \u201cde-staged\u201d back onto the virtual tape library store before restoring the data.","Another copy of the backup application may be installed at the remote site. This copy of the backup application can be used to access the remote virtual library and make copies to the remote physical medium. However, there requires multiple instances of the backup application to track both the virtual libraries and the backup on the physical medium. This approach also requires that the customer license separate backup applications.","Systems and methods are disclosed for making a physical copy at a remote storage device of data on a local storage device in response to a command from a backup application operatively associated with the local storage device. Briefly, a storage system is disclosed including a local storage device and a remote storage device. .A backup application maintains data (e.g., backup data for an enterprise) in a virtual storage library at the local storage device. The data can then be replicated using deduplication processes to another virtual storage library at the remote storage device.","It is desirable to periodically, or at some other time interval, replicate the data in the virtual storage library on a physical medium at the remote storage device (e.g., on a backup tape). As discussed above, however, backup applications typically are not configured to recognize copies of the backup data, and therefore a single instance of the backup application cannot be used to instruct a copy operation of the data at the remote storage device.","In exemplary embodiments, a copy engine is provided at the local storage device, and another copy engine is provided at the remote storage device. When the backup application issues a command to replicate data on the virtual storage device onto a physical storage medium, the local copy engine checks if the physical medium is located at the local storage device. If the physical medium is located at the local storage device, then the data is replicated locally. However, if the physical medium is not located at the local storage device, then the local copy engine issues the command to the remote copy engine. The remote copy engine checks if the physical medium is located at the remote storage device, and if so, the remote copy engine replicates the data on the physical storage medium at the remote storage device.","Accordingly, a single instance of the backup application operatively associated with the local storage device is able to issue a command for replicating the data in the local virtual storage library on a physical medium at a remote storage device. in addition, when implemented with deduplication technologies, the systems and methods described herein may be particularly advantageous for use over a low-bandwidth link between the local storage device and the remote storage device.","Before continuing, it is noted that exemplary operations described herein for making a physical copy at a remote storage device of data on a local storage device in response to a command from a backup application operatively associated with the local storage device may be embodied as logic instructions on one or more computer-readable medium. When executed by one or more processor, the logic instructions cause a general purpose computing device to be programmed as a special-purpose machine that implements the described operations.",{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 1","b":["100","110","150","100","120","120","125","125","130","130","100","140","145","140","100"],"i":["a","c ","a","c ","a","c "]},"It is also noted that the terms \u201cclient computing device\u201d and \u201cclient\u201d as used herein refer to a computing device through which one or more users may access the storage system . The computing devices may include any of a wide variety of computing systems, such as stand-alone personal desktop or laptop computers (PC), workstations, personal digital assistants (PDAs), server computers, or appliances, to name only a few examples. Each of the computing devices may include memory, storage, and a degree of data processing capability at least sufficient to manage a connection to the storage system  via network  and\/or direct connection .","In exemplary embodiments, the data is stored on one or more local VLS , Each local VLS  may include a logical grouping of storage cells. Although the storage cells  may reside at different locations within the storage system  (e.g., on one or more appliance), each local VLS  appears to the client(s) -as an individual storage devices. When a client -accesses the local VLS  (e.g., for a read\/write operation), a coordinator coordinates transactions between the client -and data handlers for the virtual library.","Redundancy and recovery schemes may be utilized to safeguard against the failure of any cell(s)  in the storage system. In this regard, storage system  may communicatively couple the local storage device  to the remote storage device  (e.g., via a back-end network  or direct connection). In an exemplary embodiment, the back-end network  is a WAN and may have only limited bandwidth. Remote storage device  may be physically located in close proximity to the local storage device . Alternatively, at least a portion of the remote storage device  may be \u201coff-site\u201d or physically remote from the local storage device , e.g., to provide a further degree of data protection.","Remote storage device  may include one or more remote virtual library storage (VLS) -(also referred to generally as remote VLS ) for replicating data stored on one or more of the storage cells  in the local VLS . In an exemplary embodiment all writes (e.g., by a client) to the local VLS  are logged in a batch for each of the storage cells . The batch may then be used to copy completed writes to the remote storage device  where the data is replicated at the remote VLS .","As discussed above, it is often desirable to periodically, or at some other time interval, replicate the data in the VLS  on one or more physical storage medium, such as a backup tape. The physical storage medium may reside locally  or remotely . According to exemplary embodiments described herein, the backup application is able to control replication to the physical medium even when the physical medium resides at the remote storage device , and even though the backup application is not \u201caware\u201d of the transparent deduplication between the local and remote VLS. Such an embodiment enables the backup application to provide a single point of control of data at both the local VLS, and archived data on the physical medium.","The local VLS  copies data to a remote physical medium by first transparently replicating the data at the local VLS  to the remote VLS  at the remote storage device . In an exemplary embodiment, the replication may be by deduplication, which is particularly suitable for data replication over a low-bandwidth link.","In deduplication in virtual libraries, when a write completes at the local VLS the deduplication in the device determines what in that data is new\/unique and what is duplicate to existing backups already stored in the device Thus the device \u201cknows\u201d for each virtual cartridge what is new data and what is already stored in the remote VLS. The replication can then (on a cartridge-by-cartridge basis) send over just the new data to the remote VLS along with references to the duplicate data that is already stored on the remote VLS.","When it is desired to make a physical copy of the data in the local VLS , the backup application issues a copy command to replicate the data in the local VLS  to the physical medium. This operation is transparently performed by copying the data at the remote VLS  of the same data on the local VLS  to the physical medium attached to the remote storage device , as may be better understood with reference to .",{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 2","b":["200","200","125","125","210","220"]},"The copy interface  may be implemented as a \u201cSmart Copy\u201d application programming interface (API). Smart Copy is a known out-of-band API that enables a backup application to control the copying of data from a virtual storage library to a physical medium connected to the virtual storage library. Exemplary implementations of the Smart Copy API include, but are not limited to, SMI-S (Storage Management Initiative Specification) copy services or NDMP (Network Data Management Protocol) tape copy.","SMI-S copy services may implement a Common Information Model Object Manager (CIMOM): CIMOM updates the redundancy configuration in the Common Information Model (CIM) object schema, and sends a CIM Event to the CJM proxy and then to a provider, which communicates with the EMF via an EMF client and an EMT Server.","NDMP tape copy may implement an NDMP server. The NDMP server also updates the redundancy configuration, and sends an event to the NDMP Interface Wrapper (NIW), which communicates with the EMF  via an EMF client and an EMF Server.","Both variations of Smart Copy basically perform the same operations, namely allowing the backup application to instruct the virtual library to copy one section of a specified virtual library to another section of a specified physical medium. If the physical medium  is operatively associated with (e.g., physically attached) to the local VLS , Smart Copy allows copying data directly from the local VLS  to the physical medium .","In order to copy data from the local VLS  to a physical medium  operatively associated with (e.g., physically attached) to the remote VLS , the copy interface  is enabled to hide all replication operations from the backup application  and that the physical medium  is remotely located. Accordingly, the backup application  is able to function as if the data is being replicated from the local VLS  to a local physical medium .","To enable this functionality, the copy interface  may communicate with the EMF  via an EMF client\/server, e.g., using Soap requests and Soap events. The EMF  is an abstracted AN which converts requests by the backup application (e.g., SMI-S or NOMP requests) that are received at the copy interface  into a standardized common operation commands. For example, where the storage system is emulating tape storage, the common operation command may be \u201crewind,\u201d \u201cposition tape,\u201d \u201cwrite filemark,\u201d \u201ccopy X blocks,\u201d and so forth.","The EMF  includes a local auto-migration layer . Local auto-migration layer  may be communicatively coupled with a remote auto-migration layer  at the remote VLS . The auto-migration layers ,  provide a software link between the local VLS  and the remote VLS  so that the physical library software model (configuration, state, etc.) in the remote VLS  can receive commands and be maintained by the backup application  operatively associated with the local VLS . In other words, the software link between auto-migration layers ,  enables the local VLS  to present a \u201cghost\u201d physical library to the backup application  (e.g., presented via the graphical user interface (GUI)) and enable access to the remote VLS  and remote physical storage medium  through the local copy interface  as though the remote VLS  is a local physical library.","The software link between auto-migration layers ,  enable copy operations (e.g., copy jobs, setup actions, etc) to be automatically transferred from the local VLS  to the remote VLS . in addition, when the backup application  issues a copy command to a physical medium, the software link provides a means for executing the copy command for the remote physical medium .","The software link between auto-migration layers ,  is also integrated with deduplication technologies. In this regard, exemplary embodiments may be implemented over a low-bandwidth link, utilizing deduplication technology inside the virtual libraries to reduce the amount of data transferred over the link.","In addition, the auto-migration layers ,  may be configured to wait for any active\/pending replication jobs to complete before triggering the copy action at the device controls , . Waiting allows deduplication operations to complete and the remote VLS  to be updated with respect to the local VLS. After the active\/pending replication jobs are completed and the remote VLS  is updated with respect to the local VLS, then the copy command can be executed to replicate the remote VLS  on the physical storage medium  operatively associated with the remote storage device. In this regard, the copy manager  may issue the copy command to the device control ,  for the respective physical storage medium , , e.g., via an external connection , .","The auto-migration layers ,  may also include a device information component , , respectively. The device information component ,  is configured to report on the virtual and physical libraries operatively associated with (e.g., directly connected) to the respective local or remote storage devices In this regard, a Physical Device Discovery (POD) link ,  may be provided between the auto-migration layer and the device control ,  for the physical medium , . The PDD passes the configuration and current state information from the device control ,  for the physical storage medium ,  so that the physical storage medium ,  appears as a \u201cghost\u201d library on the local VLS , regardless of the actual location (local or remote) of the physical medium , . For example, the backup application  may initiate a copy operation on the local VLS  and request a copy from a local virtual tape \u201cABC\u201d to a physical tape \u201cXYZ\u201d in the remote physical medium . Accordingly, the physical tape \u201cXYZ\u201d is presented locally to the backup application  as a \u201cghost\u201d physical library. These and other operations may be better understood with reference to .",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 3","b":["300","310","9","1","9","125","155"]},"At time t, the backup application  issues a copy command  to the copy interface  at the local storage device . At time t, the copy command  is then passed into the EMF . At time t, the EMF  converts  the requests (e.g., SM-S or NDMP requests) into a standardized common operation command (e.g., tape commands such as \u201crewind,\u201d \u201cposition ape,\u201d \u201cwrite filemark,\u201d \u201ccopy X blocks,\u201d and so forth).","At time t, the physical medium  or  is located  by device info components , . When a copy command arrives in the local device auto-migration layer, and the target physical medium is in the \u201cghost\u201d physical library that is actually attached to the remote device, the auto-migration waits for the local virtual storage to complete any active or pending replication. As discussed above, waiting. allows the deduplication operations to complete and the same data to reside in the remote device as exists on the local device so that the data can be accurately replicated on the physical medium . At time t, the links established between the local copy manager  and the remote copy manager  may be used to send the copy operation to the remote storage device as a remote jobs\/action request .","At time t, the remote copy manager  passes the copy command  to the device controller  (e.g., a medium changer for a tape drive) for executing. For example, when executed, the copy command may instruct the device controller  to transfer data from one or more virtual storage library in the remote storage device to one or more physical medium, as illustrated at time t.","It is noted that in exemplary embodiments, the local and\/or remote VLS ,  may be locked to prevent further  operations by the backup application until the copy command to the physical storage medium can be completed. After switching to a locked state, all further write and log requests by the backup application may be halted. The locked state may be established by temporarily suspending the  stream, e.g., by having the storage cells delay cache commits and write acknowledgements to the clients for a predetermined time. When replication completes, the data represents a complete image of all the writes which were completed on the local VLS and is ready to he transferred to the remote storage.","At time t, the remote auto-migration layer  may also pass back a status on the copy command to the local auto-migration layer , which may in turn pass the status information back through the EMF  to the backup application .","It is noted that transactions, such as those just described, may be initiated to replicate data on a physical storage medium, e.g., periodically, based on a predetermined number of writes, a predetermined size, or when otherwise determined by the user. Determining when to replicate data on a physical storage medium may depend at least to some extent on design considerations. For example, industry standards for archiving data may recommend a periodic update frequency.","It is noted that the exemplary embodiments shown and described are provided for purposes of illustration and are not intended to be limiting. Still other embodiments are also contemplated for making a physical copy at a remote storage device of data on a local storage device in response to a command from a backup application operatively associated with the local storage device."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 3"}]},"DETDESC":[{},{}]}
