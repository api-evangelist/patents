---
title: Apparatus and method for garbage collection
abstract: A garbage collection apparatus and a method using the same are disclosed. The garbage collection method comprises: making a list of objects that must be deleted from a memory; calculating a predetermined residual time for responding to an external command; deleting the listed objects from the memory during the residual time; and storing a list of remaining objects that have not been deleted from the memory during the residual time. Accordingly, communication failure due to a response delay or timeout is prevented by distributed processing loads of garbage collection.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07797498&OS=07797498&RS=07797498
owner: Electronics and Telecommunications Research Institute
number: 07797498
owner_city: Daejeon
owner_country: KR
publication_date: 20040803
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND ART","DISCLOSURE OF INVENTION","Technical Problem","Technical Solution","Advantageous Effects","BEST MODE","Mode For Invention"],"p":["The present invention relates to a garbage collection apparatus and method, and more particularly, to an apparatus and method for performing garbage collection in a smart card.","In a mark-and-sweep method, one of the conventional garbage collection methods, garbage collection is achieved by performing together a mark phase and a sweep phase. On the other hand, in a partial garbage collection process, only some objects are examined and collected.","A smart card, a medium used for a user-interactive communication, can hardly be used for long data processing. Thus, in a command\/response communication environment, a response time can be delayed due to a process such as the garbage collection, a processing time of which is not specially assigned. Therefore, when the garbage collection is performed, it must be considered that a user can feel a response delay and timeout can occur due to the response delay.","Also, for improving processing efficiency, most smart cards have a single thread operation structure using a one-chip processor, and only one application program is active when the user-interactive communication is performed. Therefore, the smart cards cannot have a separate process for managing the garbage collection, and also few application programs can be activated so that the partial garbage collection for a portion of an object can be efficiently performed. Furthermore, there are not sufficient resources with which the full\/partial garbage collection can be always managed.","Accordingly, the garbage collection is requested when necessary, and a predetermined process is performed only during its activated period of time. In the garbage collection intermittently performed by being passively activated, processing time is influenced by both how much garbage must be collected and the length of the period of time required for examining whether an object is garbage. The former is determined according to a kind of memory in which an object management table and objects to be collected are mainly placed, and in a memory requiring a long processing time in a write operation, a processing time depends on the amount of processed data. The latter usually depends on the number of objects to be examined.","In the smart card, it is difficult to perform both the mark and sweep phases in a garbage collection process. Particularly, it takes a lot of time to write in electrically erasable programmable read-only memory (EEPROM) used as persistent memory of the smart card. In the sweep phase of the garbage collection process, in order to collect memory space used for objects in the persistent memory or for transient objects of a case where an object management table is in EEPROM, a process of writing in EEPROM is necessary.","Accordingly, when the garbage collection is performed, a lot of processing time can be taken due to the writing in EEPROM. Therefore, a method of balancing a load by dividing a garbage collection process is required.","The present invention provides an apparatus and method for performing garbage collection, which prevent communication failure due to a response delay or timeout related to a garbage collection in smart card by balancing a load of the garbage collection.","The present invention also provides a computer readable medium having recorded thereon a computer readable program for executing a method of performing garbage collection to prevent communication failure due to a response delay or timeout by balancing a load of the garbage collection.","According to the present invention, stable memory can be secured in realtime by effectively managing the memory through distributed processing of garbage collection. Also, communication failure due to a response delay or timeout is prevented by distributed processing loads of garbage collection.","According to an aspect of the present invention, there is provided a garbage collection method comprising: making a list of objects that must be deleted from a memory; calculating a predetermined residual time for responding to an external command; deleting the listed objects from the memory during the residual time; and storing a list of remaining objects that have not been deleted from the memory during the residual time.","According to another aspect of the present invention, there is provided a garbage collection apparatus comprising: a timer, which calculates a predetermined residual time for responding to an external command; and a memory management unit, which makes a list of objects that must be deleted from a memory, deletes the listed objects from the memory during the residual time, and stores a list of remaining objects that have not been deleted from the memory during the residual time.","Accordingly, communication failure due to a response delay or timeout is prevented by balancing a load of the garbage collection.","Hereinafter, a garbage collection method and an apparatus using the same according to the present invention will now be described more fully with reference to the accompanying drawings, in which exemplary embodiments of the invention are shown.",{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 1A"},"A smart card , which has a universal subscriber identity module (USIM) or a subscriber identity module (SIM) according to an international standard, communicates with a host (or a terminal)  via a card acceptance device CAD)  using the ISO 7816 smart card communication standard.","In general, the smart card  is a system that includes a CPU, a memory such as RAM, ROM, and EEPROM, a bus, a timer, and an input\/output interface. However, due to chip size limitation of the smart card , a capacity of a built-in memory and processing ability of a processor are limited. Accordingly, the smart card  is usually used as a passive medium, and a basic operating method of the smart card  is to process an input external command and transmit a processing result.",{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 1B"},"Referring to , a card operating system (COS)  is placed in an upper layer than hardware (a silicon chip)  of a Java smart card , and a Java card virtual machine (JCVM)  is placed in an upper layer than the COS . In order to execute Java card applets , which are application programs of the smart card , the Java smart card  provides a Java card application programming interface (JCAPI) , and in order to allow the JCVM  or the JCAPI  to call function modules  provided by the COS , the Java smart card  provides a native-interface and other APIs  for additional functions.","Garbage collection using the Java smart card  is performed by a garbage collection module  of the COS . The Java smart card  provides the APIs  so that the garbage collection module  is passively called and used. The other portion besides the Java card applets  is called a JCOS .","In a smart card, it is important to guarantee a fast and even response time in response to a user's request and always secure working memory required for executing an application program on it. The former requires that a response delay is reduced in a ciphering process and a writing process in EEPROM, both particularly requiring a long processing time. In the garbage collection, a method of reducing a number of access times to write in EEPROM is considered. To satisfy the latter, since memory compaction is not performed due to its high cost, it is essential to reallocate a memory space, which is allocated and not used, by sweeping the memory space.",{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 1C"},"Referring to , a smart card , which is a user-interactive medium, has a time limit from receiving a command from a host (or a terminal)  to respond to the command.","Command processing  takes place between receiving the command from the host and responding to the command. If the host (or the terminal)  cannot receive the response within a predetermined time limit due to a long processing time in the smart card , the host (or the terminal)  performs a timeout process. When the timeout process is performed, the host (or the terminal)  expects the response within the predetermined time limit by re-transmitting the command to the smart card  a predetermined number of times in step . However, if the timeout process is performed every time, the host (or the terminal)  determines that the response is not received in step  as shown in . A user can set the number of times the host (or the terminal)  transmit a command to the smart card  when a response does not return in a predetermined time limit.","Besides determining communication success\/failure on the basis of whether a response against a command returns in a predetermined time limit, in a case of a user-interactive medium such as a smart card, an important element determining a communication quality of service (QoS) with the smart card  is how fast the smart card  can respond to a user's request.",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 1D"},"Referring to , a response time limit  is different from a user waiting time limit  in pursuit of a better QoS, which is determined for improving a response delay affecting a user. When an application program related to a smart card is developed and when a smart card management module is designed, the response time limit  and how fast responses should be performed in the user waiting time limit  must be considered.",{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 2A"},"In detail,  shows relationship between communication cycles  and changes of status  and  of a smart card when a host (or a terminal) and the smart card communicate with each other via a CAD.","A communication cycle  is made up of a process wherein the host (or a terminal) transmits a command to the smart card and receives a response to the command from the smart card. A plurality of communication cycles  is made up of a card communication session between the host (or a terminal) and the smart card.","That is, the card communication session takes place from the time when the smart card is identified after being inserted into the CAD to the time when the smart card is pulled out from the CAD.","The smart card is in a waiting mode  between the time when a response is transmitted and the time when a new command is received. In the waiting mode , the smart card checks communication channels logically connected to an input\/output unit of the smart card. The smart card is in an active mode  between the time when a command is received from the host (or a terminal) and the time when a response to the command is generated and transmitted. The smart card operates by alternating the two statuses  and ",{"@attributes":{"id":"p-0042","num":"0041"},"figref":"FIG. 2B"},"Referring to , in a communication cycle , a smart card with a processor performs a command received from a host (or a terminal) and a smart card management process in an active mode . Accordingly, in a case of garbage collection, if a garbage collection request is internally generated and transferred to a COS, mark\/sweep phases of the garbage collection are performed together in a current communication cycle or a next communication cycle.","Whenever the garbage collection is requested, the smart card uses a method of listing objects that must not currently be deleted from the smart card (mark phase) and deleting all objects except the listed objects from a memory (sweep phase). When the mark and sweep phases are performed with a normal command processing in a communication cycle, a response time may be delayed or temporary lack of memory due to the garbage collection may occur. It takes time to list objects to be deleted, furthermore, it also takes time to delete the objects due to characteristics of EEPROM in the smart card.","In the garbage collection method shown in , any information required for the garbage collection does not have to be stored in the memory, and only memory required for currently performing garbage collection is necessary. Accordingly, in the method, RAM is utilized rather than memory requiring a writing delay such as EEPROM. Even if RAM is used, memory waste is prevented by using a stack space or an unused memory space of a reserved memory space and by not using a dedicated space.","However, since the garbage collection is not related to a normal operation of processing a received command and generating a response, a user may feel uncomfortable when using a smart card due to a response delay caused by the garbage collection.","Due to a burden by the garbage collection, a smart card that has a little processing ability and limited memory space, a module that automatically manages the garbage collection is not included, and the garbage collection is requested when it is necessary.","Memory of a smart card is small comparing to mega-media but is getting larger.","Also, since the number of objects generated by a smart card application program is getting larger, and accordingly, since the number of objects to be examined and garbage to be swept are getting larger, if processes of looking for garbage and deleting the garbage among objects in total memory are included in a garbage collection process, possibility of a response delay or timeout due to the garbage collection is getting larger.",{"@attributes":{"id":"p-0050","num":"0049"},"figref":"FIGS. 3A through 3G"},"Referring to , in order to reduce possibility of a response delay or timeout, a garbage collection process is distributed and performed in a plurality of communication cycles in step  A method of measuring an available time using a timer is used for distributed processing the garbage collection in the plurality of communication cycles.","In a mark phase of a garbage collection process, a list of objects that should not be deleted in a current status of a smart card is made, and a list of objects that should be deleted from an object table is also made on the basis of the list of objects not to be deleted. When an object is newly generated or deleted during execution of an application program, the two lists are updated together. When new garbage collection is requested, if there are objects remained in the list of objects to be deleted, new objects to be deleted are added to the list. A time to make a list of objects to be deleted is when two following cases occur. Also, if there is not an existing list of objects to be deleted, a new list is made:","1) when garbage collection is requested","2) when a communication session of a smart card is initialized.","When the new garbage collection is requested, if there is a residual time up to a response time limit even after objects in the existing list of objects to be deleted are clearly deleted, in a mark phase of the newly called garbage collection, a list of objects to be deleted is newly made.","In a sweep phase of the garbage collection, a residual time up to the response time limit of the smart card is measured on the basis of the list of objects to be deleted, and the objects to be deleted are deleted during the residual time. The objects, which remain in the list of objects to be deleted, not being deleted in a response time period, are stored in EEPROM or RAM. Whenever the smart card receives a command via a CAD, the smart card repeatedly processes the command and deletes objects to be deleted during a residual time up to the response time limit after the command processing is finished.","If a memory allocation request for a new object occurs during the command processing the smart card looks for free memory space of which elements to be returned by objects to be deleted and not to be allocated. And it allocate the free memory space to the new object. If a portion of the allocated memory is returned, it is dealt as another returned memory. The amount of required memory is reduced by managing object with a bitmap.","Referring to , a smart card processes a command  and measures a residual time  up to a response time limit or a user waiting time limit for QoS. The smart card calculates the amount of garbage collection to be performed in a communication cycle, and if the garbage collection can be finished in the residual time, the smart card finishes the garbage collection .",{"@attributes":{"id":"p-0059","num":"0058"},"figref":"FIGS. 3C through 3G"},"Referring to , garbage collection is distributed and performed in two steps  and .","The amount of each garbage collection distributed into two steps is based on each available time measured after each command is processed in each communication cycle. If the mark-and-sweep method is used for the garbage collection, a method of separately performing a mark phase and a sweep phase or a separate collecting memory of objects in the sweep phase is selected.","When the garbage collection is performed over a plurality of communication cycles, an address list of objects to be deleted is stored in memory, and the sweep phase is performed using the address list. In order to exclude a possibility of losing a list of objects to be deleted examined in the mark phase when the garbage collection is performed over the plurality of communication cycles and examining the list again, the list of objects to be deleted is stored in EEPROM.","If the amount of garbage collection remained after a previous communication cycle is small, as shown in , when a new communication cycle starts in response to a command, a command processing can be performed after the garbage collection is performed first of all.","If a new garbage collection process is requested before a current garbage collection process is finished, a method of finishing the current garbage collection process and starting the new garbage collection process or a method of adding objects to be deleted to a current list for objects to be deleted is used. However, in any case, schedule management is performed so that the newly requested garbage collection is clearly performed.","Referring to  garbage collection  is performed in a first communication cycle. In a second communication cycle, two parts  and  of the different garbage collection processes are performed.  shows a part  when a residual part of the garbage collection process performed in a first communication cycle is transferred and a part  when a new garbage collection process requested in the second communication cycle is partially performed during an available time remained.","A residual part  of the newly requested garbage collection process in the second communication cycle is transferred to a third communication cycle and finished.","Referring to , the time for performing garbage collection is different from that of . If the amount of residual garbage collection  after previous garbage collection  is small, after the residual garbage collection  is finished as soon as a command is received in a second communication cycle, the received command is processed. Garbage collection  newly requested in the second communication cycle is performed during a residual available time, and residual garbage collection  is transferred to a third communication cycle.",{"@attributes":{"id":"p-0068","num":"0067"},"figref":["FIGS. 3F and 3G","FIG. 3F","FIG. 3B"],"b":["350","352","354","356","358","360","362","364","366","368","370","372"]},"Since it takes a long time to write in EEPROM, a method to enhance the processing efficiency by concurrent performing garbage collection and command processing or concurrent performing an object deletion process and a sweep phase of the garbage collection during the command processing is used in steps  and .","In the former case, if EEPROM is used as persistent memory, writing by the unit of page is basically used in EEPROM. When writing on a same page is performed, a block time, which is generated when to write on different pages, can be removed. Accordingly, if a writing process is performed at a time of gathering data to be written on a page of EEPROM, a time for writing can be reduced. Also, a scheme of concurrent performing command processing and garbage collection processing can be used.  show the times when distributed processing parts of garbage collection are performed.",{"@attributes":{"id":"p-0071","num":"0070"},"figref":"FIGS. 4A through 4C"},{"@attributes":{"id":"p-0072","num":"0071"},"figref":["FIGS. 4A through 4C","FIGS. 3A through 3G"]},{"@attributes":{"id":"p-0073","num":"0072"},"figref":"FIG. 4A","b":"400"},"The smart card examines whether there is residual garbage collection in step S.","If there are the residual garbage collection steps, the smart card measures the amount of the garbage collection that can be performed in a residual available time up to a response time limit in step S. The residual garbage collection of a previous garbage collection process is performed in the measured available time in step S. If the residual garbage collection of the previous garbage collection process cannot be finished, the new residual garbage collection is transferred to a next communication cycle. If there is a residual time after the residual garbage collection is finished, a newly requested garbage collection process is performed in step S. The newly requested garbage collection is performed in an available time, and a residual amount of the garbage collection is transferred to a next communication cycle.",{"@attributes":{"id":"p-0076","num":"0075"},"figref":"FIG. 4B"},"The smart card receives a command from a host (or a terminal) in step S. Before the smart card performs the command, it examines whether there is residual garbage collection in the previous communication cycle in step S. How much garbage collection the smart card performs before the command processing is based on the amount of residual garbage collection. The residual garbage collection in the previous communication cycle is processed in a predetermined time in step S. The smart card performs the received command in step S. After the command processing finishes, the smart card measures a residual available time and calculates the amount of garbage collection during the available time in step S. If new garbage collection is requested, the new garbage collection is processed in the available time in step S.","The smart card transmits a response for the command processing in step S.",{"@attributes":{"id":"p-0079","num":"0078"},"figref":"FIG. 4C"},"A smart card receives a command from a host (or a terminal) in step S. Before the smart card performs the command, it examines whether there is residual garbage collection in a previous communication cycle in step S. If there is the residual garbage collection in the previous communication cycle, it is processed in a pre-determined time in step S.","The smart card processes the received command in step S. In the middle of the command processing on the smart card, if there is a write on a same page of EEPROM in the garbage collection, the smart card processes the garbage collection to concurrently perform the write process with the command processing in step S. Then, the smart card processes the received command in step S. Again, the smart card examines whether there is a write on a same page of EEPROM in the garbage collection during the command process and if there is a write on the same page of EEPROM in the garbage collection, the smart card processes the garbage collection together in step S. After the command processing finishes, the smart card calculates the amount of garbage collection which can be performed during a residual time up to a response time limit measured by a timer in step S. The smart card processes the amount of calculated garbage collection in step S.","If a new garbage collection is requested, the smart card processes the new garbage collection up to a permitted time in step S. When the smart card generates a response to the command and transmits the response to the host (or the terminal) in step S, a communication cycle is finished. Steps S and S are concurrently performed with step S. The smart card selects portions written in EEPROM of a garbage collection process and concurrently performs the portions with command processing and if a command includes portions having the advantages by performing concurrent processing rather than single processing when the portions are processed, the smart card processes garbage collection together.","The invention can also be embodied as computer readable codes on a computer readable recording medium. The computer readable recording medium is any data storage device that can store data which can be thereafter read by a computer system. Examples of the computer readable recording medium include read-only memory (ROM), random-access memory (RAM), CD-ROMs, magnetic tapes, floppy disks, and optical data storage devices. The computer readable recording medium can also be distributed over network coupled computer systems so that the computer readable code is stored and executed in a distributed fashion."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"DESCRIPTION OF DRAWINGS","p":[{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 1A"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 1B"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 1C"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 1D"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 2A"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 2B"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIGS. 3A through 3G"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIGS. 4A through 4C"}]},"DETDESC":[{},{}]}
