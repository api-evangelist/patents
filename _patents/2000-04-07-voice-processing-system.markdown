---
title: Voice processing system
abstract: A voice processing system is disclosed having a first interface for receiving telephone calls from the Public Switched Telephone Network (PSTN) and application software for processing received PSTN telephone calls. The voice processing system supports an API to allow the first interface to inform the application software of the presence of the call. The voice processing system further has a second interface for receiving telephone calls from an internet protocol (IP) network, and a signaling subsystem for routing an IP call from the second interface to the application software. This signaling subsystem uses the same API as is used to inform the application software about PSTN calls. Therefore, it is transparent to the application software whether an incoming call has been received from the IP network rather than the PSTN.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=06873689&OS=06873689&RS=06873689
owner: International Business Machines Corporation
number: 06873689
owner_city: Armonk
owner_country: US
publication_date: 20000407
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION"],"p":["1. Field of the Invention","The present invention relates to voice processing systems and more particularly the manner in which such systems interface to data packet networks.","2. Description of the Related Art","Voice Processing systems are well-known in the art (see http:\/\/www.computertelephony.org for a comprehensive directory). They provide a computer-based method of non-simultaneous telephone communications and carry out a variety of tasks. These include VoiceMail, whereby callers who cannot reach their intended target can instead record a message for subsequent retrieval, and interactive voice response (IVR) systems, which enable callers to interact with the voice processing system, typically via dual tone multiple frequency (DTMF) keys, to retrieve and update certain information. Conventional IVR applications include amongst others, telephone banking, flight booking enquiries and the placing of home shopping orders.","An example of a voice processing system is the DirectTalk for AIX voice processing system available from IBM Corporation, and described in the manual \u201cDirectTalk for AIX, General Information and Planning\u201d, reference number GC33-1840-00, plus the other manuals referenced therein. Like many modern voice processing systems, the DirectTalk system is based on a general-purpose computer (in this case an RS\/6000 workstation) with additional hardware and software for the telephony and voice processing functions. (DirectTalk, AIX, and RS\/6000 are trademarks of IBM Corporation).","Traditional Voice Processing systems have been designed to connect to the Public Switched Telephone Network (PSTN) either via an analogue telephone connection, or via digital trunks lines.","One of the major advantages associated with such systems, is that they are capable of handling large volumes of telephone traffic on a continuous 24 hour by 7 day basis. Individual signals are time multiplexed together for transmission over the digital trunks. In North America, the standard form of trunk line is known as T1, and provides 24 simultaneous lines with a data connection speed of 1.544 Mbps. These trunk lines can be used not only to carry the actual audio telephone signal, but also to provide a limited degree of signaling information, for example, to reserve a channel, to make a call on a channel, to transfer a call, and so on. In Europe, the standard form of trunk line is known as E1, and provides 32 simultaneous lines (of which 30 are for telephony channels, one for framing, and one for signaling). E1 lines support a data speed of 2.048 Mbps.","The telephone channels can be processed for IVR functions like DTMF detection, call progress detection, DTMF generation, voice recognition, text to speech and the playing of compressed and uncompressed voice segments or messages.","Typically, a voice processing system incorporates an internal time division multiplex (TDM) bus to coordinate its telephone channels. Each is allocated a timeslot on the bus. The main TDM bus types commercially used in voice processing systems are the PCM Expansion bus (PEB), supporting up to 128 64 kbps TDM timeslots, and the SCbus, supporting up to 2048 64 kbps timeslots, both from Dialogic Corporation. Other well-known TDM buses include, the Enterprise Computer Telephony Forum (ECTF) H.100 CTBus, and also the MVIP bus, defined by the GO-MVIP organization, and available from Natural Microsystems Corporation, which supports up to 512 64 kbps timeslots. These can be used either as part of a chassis backplane or via a ribbon cable between TDM interface cards.","The TDM bus interfaces support 64 k bit per second digital timeslots and both E1 and T1 trunks contain dedicated 64 k bit digital voice\/data channels, so interfacing dedicated voice channels which are also 64 k bits per second is mainly a matter of synchronization of the channels from the appropriate telephony interface into the appropriate timeslots on the TDM bus. One timeslot can be used for the transmit direction of one 64 k channel and another for the receive direction.","It is also possible to interface voice processing systems to other lines (rather than just digital trunks), for example analogue voice channels, which can be sampled by Analogue to Digital (A to D) convertors into a 64 k bit voice\/data channel or in the opposite direction using D to A convertors. Other transmission mediums which deliver dedicated 64 k bit per second channels using their transport mechanisms like Asynchronous Transfer Mode (ATM) could also be interfaced to voice processing systems. All these dedicated mediums are known as Isochronous since they provide a guaranteed data rate on the channel.","There has been much interest in the transmission of voice channels on data transmission networks which use protocols like TCPIP packet transmission instead of dedicated isochronous channels. There are advantages of voice over data (packet) networks in that interface costs to the network are lower and many computer users already have data connections. It also means that local work groups which use Local Area Networks (LANs) for data communication can re-use these for voice communication and possibly combined voice\/data multimedia communication in realtime, but this is very much dependent on how busy the network is.","Some voice processing systems can already use one single interface for both voice and data, but this tends to be via a dedicated isochronous telephony channel like an analogue telephone channel or basic rate Integrated Services Digital Network (ISDN).","The disadvantage of voice over data packet networks is that there is no guarantee of exactly when any specific data packet may reach its destination. If there are multiple routes between the source and destination the packets may also be received out of order. For data this is easily resolved by queuing the packets up in the correct order and at some later time storing it or retransmitting it to another party. Realtime consistent data flow in which under run or overrun conditions matter is not a concern for data, but most certainly is for voice. Voice data received and played to someone out of order, would make speech unintelligible. Delays between playing out the first and second parts of a sentence are also unacceptable since this would be inconvenient to the user, and may change the context of the sentence for the listener.","A lot of work has gone on to resolve these issues and standards have been defined like the International Telephony Union (ITU) T Recommendations, H.323 on Visual Telephone systems and Equipment for LANs that do not guarantee quality of service. Within this recommendation there are references to other specifications and recommendations like data packet synchronization H.225, H.245 signaling control, H.261 and H.263 video codecs and G.711, G.722, G.728, G.729 and G.723 audio codecs.","Using these recommendations products are being developed to interface voice devices to data-packet networks (eg the Internet). One such device is an IP phone, which provides users with real-time, full-duplex communication over the Internet. The device is typically a home personal computer (PC) running application software which simulates the telephony environment. For example, the FreeTel Corporation market such software and it is possible to download a trial version from their web-site, http:\/\/www.freetel.inter.net. A graphical numeric keypad enables the user to dial another IP phone, connecting to the data-packet network via a dial-up Point-to-Point Protocol (PPP) or Serial Line Internet Protocol (SLIP) Internet connection. Voice data is initially input through a microphone, attached to the PC and is transmitted, via the machine's Internet connection, across the network to the other phone. The voice data can be heard through a headset which is also attached to the PC.","It is also important that telephone calls can be made from IP phones to PSTN phones. Gateway devices are being developed, which take IP data and stream it into 64 k bit per second isochronous format. Such devices also allow the data to be interfaced to E1 and T1 lines, and to Analogue channels, via D to A convertors. The streaming functions do two things:\n\n","This allows a telephone call to be made from an IP phone to an ISDN or analogue telephone connected to the PSTN. The gateway can also allow incoming calls from a normal telephone to an IP phone. The routing of such calls is done by a process called a Gatekeeper as specified in the H.323 standard. Additionally, a gateway should also be able to synchronize to TDM buses of the types previously discussed.","The advantages of transmitting voice channels on data-packet networks such as the Internet have already been discussed. For these same reasons, it is extremely beneficial for voice processing systems to interface directly to data-packet networks rather than have to accept IP phone calls which have first had to be routed via the PSTN. Although such a setup is known, existing IP solutions appear to require a new IP interface card which has all the voice processing resource on board to handle all incoming calls. Some cards may also have both the IP interface and the PSTN interface encapsulated within them. The whole process is therefore contained within the one card.","Therefore the approach thus far has been to design a new adapter with a data connection interface which handles all of the H.323 recommendations, including voice transport, signaling, does all the voice processing on board and interfaces to the IVR applications. Specific voice processing algorithms like voice compression\/decompression, silence detection, DTMF generation\/detection are also typically included. Two examples of this are:\n\n","However, such solutions tend to incorporate new software Application Programming Interfaces (APIs) to drive the software solution. Thus previously purchased existing hardware cards become redundant should the customer wish to move from a voice processing system connected directly to the PSTN to an IP connection instead. This means applications written for a voice processing system which is PSTN connected won't work when IP connected unless they have some modifications applied.","Accordingly the invention provides a voice processing system comprising:\n\n","Therefore the same application can be used to process both IP calls and PSTN calls (either in the same or in different machines), thereby increasing flexibility, and reducing costs for application development and maintenance.","In the preferred embodiment, the first and second interfaces are both connected to a TDM bus, and said second interface comprises: means for routing the audio data element of a IP call over the TDM bus to the first interface; and means for routing the signaling element of said IP call to the signaling subsystem. The second interface further comprises means for converting the IP audio data received from the IP network into TDM format for transmission across the TDM bus (and vice versa for data transmitted from the voice processing system out onto the IP network).","It will be appreciated that sending the audio data over the TDM bus is in fact something of an indirect route into the voice processing system, since the application could in principle obtain the voice data directly from the second interface. However, this would require existing applications, which are not aware of the interface to the IP network, to be re-written. By contrast, transmitting the audio data from the second interface, over the TDM bus, to the first interface, results in all audio data effectively terminating at the same location, irrespective of origin. Again this renders the source of the call (IP or PSTN) transparent to the application.","One subtlety here is that there is some variation in the handling of signaling components between IP and PSTN telephone calls. Therefore, the second interface preferably includes means for converting certain signaling elements such as DTMF calls from said IP call into audio data for transmission to the first interface over the TDM bus, so that again the application cannot distinguish between inbound data from a PSTN call, and inbound data from an ISDN call.","In the preferred embodiment, the signaling subsystem comprises one or more signaling processes, which all communicate with the application software via the same signaling interface. Typically such interface supports both various forms of PSTN signaling, such as ISDN and SS, and also H.323 signaling for IP calls. In this manner the same interface is used for both PSTN and IP calls, such that the network from which a call originated is transparent to the application (in other words, an application can support calls from both networks).","One aspect of this is that the H.323 signaling process typically includes means for mapping the channel upon which the IP call is placed into a corresponding voice processing system trunk and channel, thereby simulating the effect of a call from the PSTN, even though the trunk number has no direct meaning for an IP call.","In the preferred embodiment, the IP network is the Internet, but the invention is applicable to calls from any Internet Protocol (IP) or H.323 supporting network (such as company intranets, extranets, and so on).","The invention further provides a method for operating a voice processing system including a first interface for receiving telephone calls from the Public Switched Telephone Network (PSTN) and application software for processing received PSTN telephone calls; said method comprising the steps of:\n\n","The invention further provides a line adapter card for use in a voice processing system, said adapter card supporting a plurality of trunks\/channels and having:\n\n","wherein selected trunks\/channels of the adapter are allocated to the first interface, and other selected trunks\/channels of the adapter are allocated to the second interface.","Thus the above approach allows the re-use of standard interfaces for telephony application calls from both the PSTN and an IP network, and also to re-use the same voice processing resources for either normal PSTN or IP operation. Consequently, applications which run over the PSTN can also run unmodified over IP, and so support calls from either or both networks.","In the preferred embodiment, an IP data connection interface and system supports H.323 recommendations, but accesses the standard IVR interface E1, T1 and analogue interface cards to do the voice processing via their TDM connection bus interface. The H.323 signaling is also interfaced to the standard signaling interface of the existing IVR. The result is that the IVR application can be re-used for IP telephony unchanged from the analogue or E1\/T1 telephony.","This approach is of great benefit to the customers of companies which provide voice processing solutions, especially if those customers have already invested a great deal of money and effort in writing applications specific to a PSTN connection. With such a solution their applications will still work even though the voice network source may differ. Such customers can deploy a single application for all calls, irrespective of origin, thereby reducing application development and maintenance costs. By re-using existing hardware components, customers can switch a system (or part of a system) between IP connection and PSTN connection, thereby maximizing flexibility. For example, if the timings of the peak rates for IP and PSTN calls differ, then a machine can be dynamically configured to best match these real-time rates. Likewise, there is no obligation on the customer to favor or predict the frequency of one mode of call in comparison with another. Thus this reuse of existing IVR hardware adapters and applications is clearly very beneficial to IVR customers. Another advantage is that this approach also limits the complexity required in the adapter and the software required to interface to the data network for voice processing, compared to prior art devices.",{"@attributes":{"id":"P-00061","num":"00061"},"figref":["FIG. 1","FIG. 1"],"i":["a ","b "],"b":["5","20","40","55","60"]},{"@attributes":{"id":"P-00062","num":"00062"},"figref":["FIG. 1","FIG. 1","FIG. 1"],"i":["b ","a","b ","b ","a"],"b":["5","10","10","15"]},"As part of the voice processing software there exists a signaling library  which provides support for a number of signaling processes . These are responsible for informing the voice processing software as to the state of the telephony channels. Thus when an incoming call is detected it is one of these processes that relays this information to the voice processing software  etc. Communication between this library and the signaling processes takes place via a signaling application programming interface (API) . This API also permits the signaling processes to communicate with the voice processing software.","The type of signaling process used depends on the manner of connection to the PSTN. For example, a T1 trunk can have channel associated signaling (CAS), in which the signaling is effectively contained within the audio channels via robbed bits, or common channel signaling (CCS), in which the signaling information is contained in a separate channel from the audio channels. Two examples of signaling protocols used for CCS connections to the PSTN are SS and ISDN. An embodiment will now be described which uses ISDN as the signaling protocol, but it will be appreciated that the invention is not limited to any particular such protocol or signaling format.",{"@attributes":{"id":"P-00065","num":"00065"},"figref":"FIG. 2","i":"a ","b":["45","40","10","10","20","15","25","30"]},"Communication can take place in both directions between the PSTN and the voice processing software (arrows  and ) via the A to C connection. This enables an analogue phone  to interact under the control of the application software with the signal processing resource  as necessary, in order to play prompts, perform DTMF recognition and so on. This switch setting (ie A to C) is the default configuration. The B to C software switch setting permits communication with other DSP resources (one shown ) via the TDM bus . Such a resource might, for example, contain voice recognition software or process data using a fax card.","It will be appreciated that with a receive channel (ie incoming audio to the voice processing system) it is possible for both switch settings to be effective (ie A to C and B to C). This allows multiple devices to listen to the same incoming stream (perhaps to record and to perform voice recognition). However, for the transmit channel, only A to C or B to C can be effective, since there is no mechanism in the switch to add together audio sources from different channels.","Telephony signals are sent from the PSTN, up through the DTXA card, to the relevant signaling process (one shown ) and the reverse is also possible , . In the embodiment of , an ISDN signaling process is employed. The DirectTalk voice processing software communicates with this process via the signaling API (arrow ).",{"@attributes":{"id":"P-00069","num":"00069"},"figref":["FIG. 2","FIG. 2"],"i":["b ","a","b","c"],"b":["45","40","41","501","501","45","501","56","10","502","10","505","506","508","510","512","514","515","518","520","524"]},"It is also desirable for an IP phone to be able to communicate with an analogue phone  attached to the PSTN . One possible way of achieving this is to use the DirectTalk voice processing system as a gateway device, as shown in ","A Local Area Network (LAN) card  is plugged into the PCI bus (not shown) and interfaces to an IP network  (eg the Internet). A DSP resource card , in the preferred embodiment an Arctic 960RxD card (SPN)  made by Radisys and available from the IBM Corporation, is also plugged into the PCI bus and is attached to the TIC  (the DTXA in the present case) via the TDM bus . (Note that it would also be possible for the functionality of the LAN card  and the DSP card  to be combined into a single card).","As previously discussed, the H.323 standard provides a foundation for audio, video, and data communications across IP-based networks. With reference to the diagram, the dotted rectangle defines the components that fall within the scope of this recommendation, and can be considered together as an H.323 support system (SS). Within the H.323 SS, the H.323 software is responsible for routing the telephony signals, whilst H.245 software caters for the physical transmission of the voice data. H.225 software deals with call control management. All three run on the AIX operating system. The SPN card  also operates in conformity with this standard.","The IP phone initiates the call, transmitting H.323 protocol data packets to the LAN card (arrow ) and this then sends the data to H.245 software (arrow ) via the H.225 software . The H.245 software then routes the data to the SPN card  (arrow ), where the G.723 codec microcode  decodes the data packets. These data packets are then transferred into the appropriate format for the particular TDM bus in the voice processing system (H.100 in the preferred embodiment, but MVIP, SCSA and any other suitable format could also be used). From here, the data reaches the DTXA and travels via the software switch  connection B to C to the PSTN  and ultimately to the phone  (see arrow ). The exact reverse is also possible.","In order to support this gateway operation, signaling comes in from the IP network via the LAN card (arrow ) and is routed to the H.323 software (arrow ) via the H.225 software . The H.323 software then interacts with a special custom application  (a custom server in DirectTalk terminology) (arrow ). As a consequence of this the custom application  initiates an outbound call from the voice processing system (arrow ), which therefore interacts as appropriate with the ISDN signaling process  to set up this outbound call, and allocate it to the same TDM timeslot as the IP telephony call.",{"@attributes":{"id":"P-00075","num":"00075"},"figref":["FIG. 3","FIG. 3"],"i":["b ","c","d","e ","b ","b ","a"],"b":["90","220","301","301","301","220","54","301","304","10","10","17","304","302","303"]},"The custom server  now initiates an outbound call over the PSTN from the voice processing software by issuing an application call () to the ISDN signaling process  to inform it that it should make a call to the PSTN. The ISDN signaling process therefore requests a connection with the PSTN  via a setup signal , and is then informed by the PSTN that the call is proceeding ","A connection  is established and the ISDN signaling process  informs the voice processing software of the telephony channel upon which the call is placed. This allows a response  to be sent from the voice processing software back to the H.323 SS, which in turn forwards a connection signal  back to the originating IP phone. The H.323 SS can now connect the incoming voice data stream from the IP phone to the TDM bus, once it has requested the DSP resource to start running . In other words, the TDM timeslot on which the IP call is received is attached to the trunk\/channel on which the outbound call over the PSTN is being made using the B to C setting of switch , thereby allowing the voice processing system to act as a gateway device between the IP phone  and the analogue phone .","Note that the H.323 SS may wish to take certain steps to ensure a smooth interface between the IP call and the PSTN call. For example, it may delay completing this connection a small period of time until it has enough buffered voice to play to the TDM bus. Likewise, it may also ensure that the appropriate TDM channel idle code is present to avoid noise on the line when there is no voice to be played. This is because there will invariably be a delay between the incoming call telephony signaling and the voice data being received.","Although the voice processing system of can act as described as a gateway, it cannot however accept a call directly from an IP phone via the data-packet network (ie where the voice processing system is acting as the endpoint of the IP call, rather than as an intermediary). Rather, it is necessary for any incoming IP call to first exit the data network via the voice processing system acting as a gateway device to the PSTN (using the B to C setting of switch ), and then to return to the voice response system via the PSTN interface (using the A to C setting of switch ). This is equivalent to the voice processing system dialing its own telephone number when initiating the outbound call to the PSTN (step , ). Although this approach will allow the voice processing system to effectively receive a call from an IP telephone, the dog-leg into the PSTN and back is clearly unattractive. Firstly, it ties up additional ports on the PSTN interface, secondly it can lead to extra call handling charges, and thirdly it increases overall complexity, leading to possible delays, and so forth.",{"@attributes":{"id":"P-00080","num":"00080"},"figref":"FIG. 4","i":["a ","b","a","b ","c","d","f"],"b":["90","10","10","62","6","54","6","54","60","6","70","55"]},"It will be appreciated that up until here, the processing of the inbound IP call is the same as in FIG. A. However, once the data reaches the trunk interface card  (the DTXA), and more particularly the software switch , the data path differs. Thus now data is sent directly, via a B to A software switch connection, to the voice processing software  (see arrow ), or more particularly to DSP signal processing  or device driver , which can properly process the audio data. At the same time as the above, a reverse channel is also set up, in which the voice data is passed over the TDM bus onto the SPN card, where it is encoded by the G.723 Codec  for transmission across the IP network . The above mode of operation is performed by providing a suitable H.323 signaling process , which interacts with the signal processing API of the voice processing software. Note that the H.323 signaling process can be a standalone process, or can be incorporated into the H.323 SS (although it is not a formal part of providing H.323 communications support). Incoming communications are transferred from the IP network  over the LAN card  (arrow ), which then transmits the signaling component to the H.323 software (arrow ) via the H.225 software . The H.323 software is responsible for routing these signals to the H.323 signaling process  (arrow ). At this point the H.323 signaling process interacts directly (arrow ) with the DirectTalk voice processing software through the signaling API, allowing incoming, outgoing and call clearing messages to be passed (arrow ). In addition, the H.323 signaling processes allocates the incoming IP channel an appropriate Trunk # and channel # (even though the trunk number has no meaning per se in terms of an IP call). It will be appreciated therefore that to the application , this signaling appears exactly the same as if it were being received from the PSTN (since it is coming in through the same signaling API, and is allocated a trunk and channel number).","With respect to the audio (voice band) component of the IP call this is again handled largely as in , except that the H.323 signaling process  is effective to drive the software switch  to its new setting (ie the B to A setting). This allows the voice processing system to directly process audio received over the TDM bus in the same way as audio data received at the TIC  from the PSTN.","One complication is that certain items, such as DTMF tones, are typically sent under H.323 as signals, whereas in the PSTN they are transmitted in the audio band (as tones). (The reason for this is that it is clearly much more effective in a packet network to transmit things as digital signaling rather than voiceband). One solution here is for the H.323 SS to convert these incoming IP signals representing DTMF keys into audio data, which are then injected with the rest of the audio data onto the TDM bus.","In the preferred embodiment however, for conventional PSTN calls, the signal processing resource  recognizes DTMF in incoming audio, and then signals the device driver, which in turn signals the application (via the voice processing system). The same signaling from the device driver to the application is triggered in the preferred embodiment by direct contact between the H.323 signaling process and the device driver (in other words, the H.323 signaling process informs the device driver that a particular DTMF key has been received, and this device driver then passes this information to the application, in exactly the same way as if the device driver had received the information first from the signal processing resource . The net result of course is again that from the perspective of the application, the IP call, in terms of voice, signaling, and any DTMF keys, appears exactly as if it had been received over the PSTN.","Although the voice processing system of is shown as having connectivity to only an IP network , it will be appreciated that by rendering the origin of a call transparent to the application, it is in fact possible to use the same application for a conventional PSTN voice processing system (), or for a hybrid system wherein part of the voice processing system handles IP calls, whilst the other part caters for PSTN calls, and where the application handles both sources of call transparently (this would clearly require the voice processing system to be connected to both the PSTN  and to an IP network , as shown in fact in ). Thus the voice processing system of the present invention is very flexible in terms of its deployment.","There are certain additional complications which are addressed in the preferred embodiment of the present invention. Firstly, the TIC  permits a configuration, whereby certain incoming trunks are defined to originate from the PSTN , with others being defined to originate from the TDM bus . This makes it is possible to configure the DTXA (using additional software) to allocate some of its channels for receiving calls from the PSTN, whilst others are dedicated to IP only. Note that the IP dedicated channels should disable or ignore their interface to the PSTN and all signaling alarms indicating the status of the PSTN must also be ignored (these will effectively be spurious, given that there is no proper PSTN connection). Instead, these alarms may be replaced by indications from the H.323 SS as to the status of the data network; ie alarms denoting that there is no connection or that the connection is not synchronized. This leads onto a further potential difficulty, in that the operation of the TDM bus in a voice processing system is normally clocked by signals received over the PSTN. However, if the DTXA is not connected to the PSTN then such timing signals are not available. Therefore in a preferred embodiment, the DTXA includes a master clock which can be used to control timing with the voice processing system.","Referring now to , this shows the operation of the software switch in more detail, according to a preferred embodiment of the present invention. Note, this figure should be read in conjunction with . Those components referred to, but not illustrated, can be referenced in the other figure.","As previously described, voice data can flow in both directions from the voice processing software  to the digital signal processor  (arrow ) and via a timeslot on the TDM bus  to the voice processing system's interface  to the PSTN  (arrows , ). This interface constitutes the point at which the TIC (DTXA)  is connected to the PSTN . From here it can then flow to and from the telephone network (arrow ). (Note data is transferred as timeslots on the TDM bus.) It is the software switch setting A to C which enables the data to flow directly between the PSTN and the voice processing system. This switch setting is not however permanent, since the invention permits an IP phone to communicate directly with the voice processing software  running on the voice processing system. Arrows  and  show the flow of voice data between the digital signal processor  in the voice processing system and the H.100 interface  (in the preferred embodiment) to the SPN card  (the H.100 interface is not shown in but logically lies below the G.723 codec). Once reaching this interface, the TDM data is converted to H.323 data-packets (arrow ) for transmission across the IP network .","There is a permanent connection  between the phone interface  and the TDM bus for data flowing in the direction of arrow . However, the connection between the bus and the digital signal processor  is a temporary one (arrow ). In other words, the connection may be added or broken  according to the signals received. For data being transmitted in the direction of arrow  the reverse is true. There exists a permanent connection  between the digital signal processors  and the TDM bus . However, a connection has to be added or removed  between the TDM bus  and the interface  to the PSTN .","Should the voice processing system wish to communicate directly with the IP phone, then rather than add the connection shown by arrow  a connection between the TDM bus and the H.100 interface  is added . For calls being made in the direction of arrow , the connection between the H.100 interface and the TDM bus  is permanent.","Thus an A to C setting corresponds to switches  and  on, and  off; a B to C setting corresponds to switches  and  on, and  off, whilst the new B to A setting corresponds to switches  and  on, and  off.",{"@attributes":{"id":"P-00092","num":"00092"},"figref":"FIG. 5","b":["90","220","111","111","111","220","54","111","54","112","113","54","114"],"i":["c","d","e ","b ","e "]},"The H.323 signaling process informs the voice processing software  which trunk and channel the incoming call is to take place on. It is the responsibility of the H.323 signaling process to map the incoming IP channel information onto an appropriate Trunk #, channel # as used by the voice processing systems for PSTN calls.","According to the preferred embodiment, the H.323 signaling process is therefore informed of all the Trunk # and channel #'s which it is permitted to use on the system. The DirectTalk product achieves this with a procedure where all trunks and channels which have been enabled have events are sent to the H.323 signaling process so it is aware of the current state of the voice processing system. In an alternative preferred embodiment, this is achieved by setting up a configuration file which is then read by the H.323 signaling process.","The H.323 signaling software (see of ) informs the voice processing software  that there is an incoming call  via the H.323 signaling process  which allows incoming, outgoing and call clearing messages to be passed. The voice processing software will then launch an application and this can be done for example based on the incoming allocated channel or incoming information (eg called number or calling number) if this is also passed from the H.323 signaling process to the IVR application.","According to the preferred embodiment, before the voice processing software decides whether or not to accept the call, the H.323 signaling process allocates  a DSP resource . Upon allocation, the DSP resource is ready to receive the appropriate incoming voice data stream. According to the preferred embodiment, the voice processing software then sends an event to the H.323 signaling process to inform it that the call is being accepted .","The H.323 signaling process takes this information, and converts it into a response to inform the IP phone  via the H.323 SS (see of ) that the call has been accepted , . Once confirmation has been achieved at the IP phone that the call is connected, then the incoming voice data stream from the IP phone is transmitted over the IP network to the TDM bus via the DSP resource. The H.323 SS may wish to delay this a small period of time until it has enough buffered voice to play through the voice streamer to the TDM bus.","Note that signal processing resource  on the DTXA does not need to run until AFTER the call has been set-up. (In many voice processing systems which have CAS or analogue connection to telephone lines, such DSP resources are involved in incoming and outgoing call setup procedures in order to enable DTMF pulse detection or call progress analysis. However, according to the preferred embodiment, the DSP resource does not need to be used during this period because the IP connection simulates the use of Common Channel Signaling (CCS)).","Referring now to , conventionally, most IVR products support outgoing calls as well as inbound calls.  illustrates the sequence of events according to a preferred embodiment of the present invention. Voice processing software  running on the voice processing system (under control of an application) wishes to initiate a call to an IP phone . The voice processing software may specify to the H.323 signaling process  which Trunk # and channel # the system wishes to use. Alternatively, in the preferred embodiment, this decision is the responsibility of the H.323 signaling process itself and the H.323 signaling process is informed of all the Trunk #'s and channel #'s which it is permitted to use on the voice processing system .","To support this, in the preferred embodiment, the DirectTalk product has a procedure where all trunks and channels which have been enabled have events sent to the H.323 signaling process so it is aware as to current state of the IVR system. An alternative approach is to set up a configuration file which can be read by the H.323 signaling process. (Note that the H.323 SS makes this selection from those trunks\/channels which have been allocated to IP telephony in the system configuration; in this way it is possible to distinguish IP outbound calls from any PSTN outbound calls which the system desires to make. This  distinction can also be performed by the voice processing software based on the format of the outbound number to be dialed).","According to the preferred embodiment, the H.323 signaling process accepts the trunk # and channel # from the voice processing software or alternatively generates one from its list of valid ones and currently non-active ones. The H.323 signaling process then sends the outbound call to the H.323 SS within the voice processing system (arrow ), which places the desired call via the Gatekeeper to the IP phone  (each Gatekeeper is responsible for routing the call to either another Gatekeeper or to the IP phone, with the call terminating on the destination endpoint IP address). According to the preferred embodiment, the H.323 SS queries the Gatekeeper.  via an ARQ message , in order to verify that its endpoint destination (ie the IP phone ) exists. If all is well, the Gatekeeper confirms this via an ACF message . (Note, according to the H.323 standard, in some configurations the Gatekeeper negotiation may not be required.) The H.323 SS then initiates the call with a setup request  which, amongst other things, asks which telephony channel the call is being allocated to. The IP phone then signals back to the H.323 SS that the call is proceeding and informs the H.323 SS of the number of the allocated telephony channel. The IP phone then queries the gatekeeper  in order to verify that it has the correct address for the H.323 SS (arrow ) and receives confirmation of this (arrow ).","The IP phone then signals back to the H.323 SS that it is accepting the call , and the H.323 SS informs the H.323 signaling process of this . The H.323 signaling process then allocates a DSP resource  on the channel which the call is on , and notifies the voice processing software of the arrival of the call .","Note that the H.323 signaling process may wish to wait for the first group of data packets to be buffered before informing the voice processing system that the call has been accepted and voice can be sent on the channel to the voice streamer. However, a person skilled in the art will realize that this does not have to be so and that the H.323 signaling process may transmit the data immediately.","The invention has been described in the context of telephone calls transmitted entirely over the Internet. It is however, important to note that the invention is not limited to such. An Internet Protocol (IP) call is not restricted to the Internet, but may be made over any network capable of supporting IP (eg an intranet or extranet)."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["A preferred embodiment of the invention will now be described in detail by way of example only with reference to the following drawings. Corresponding components will be identically numbered throughout the figures:",{"@attributes":{"id":"P-00051","num":"00051"},"figref":"FIG. 1","i":"a "},{"@attributes":{"id":"P-00052","num":"00052"},"figref":["FIG. 1","figure 1"],"i":["b ","a. "]},{"@attributes":{"id":"P-00053","num":"00053"},"figref":"FIG. 2","i":"a "},{"@attributes":{"id":"P-00054","num":"00054"},"figref":"FIG. 2","i":"b "},{"@attributes":{"id":"P-00055","num":"00055"},"figref":"FIG. 3","i":"a "},{"@attributes":{"id":"P-00056","num":"00056"},"figref":["FIG. 3","FIG. 3"],"i":["b ","a. "]},{"@attributes":{"id":"P-00057","num":"00057"},"figref":"FIG. 4","i":"a "},{"@attributes":{"id":"P-00058","num":"00058"},"figref":["FIG. 4","FIG. 4"],"i":["b ","a "]},{"@attributes":{"id":"P-00059","num":"00059"},"figref":"FIG. 5"},{"@attributes":{"id":"P-00060","num":"00060"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
