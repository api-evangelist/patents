---
title: Virtual graphics device driver
abstract: Systems and methods are disclosed to enable switching of graphics processing unit (GPU) resources based on different factors. Embodiments include a virtual graphics driver as an interface between GPU drivers and the applications or graphics framework executing on an electronic device. The virtual graphics driver may switch GPU resources from a first GPU to a second GPU by routing function calls to the first GPU or the second GPU. The switching of GPU resources may be based on power management, system events such as hot-plug events, load management, user requests, any other factor, or any combination thereof. In some embodiments, a virtual frame buffer driver is provided that interfaces with the frame buffer of the GPU and provides a virtual view of the frame buffer to manage additional system application programming interfaces (APIs) during the switch.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09336028&OS=09336028&RS=09336028
owner: APPLE INC.
number: 09336028
owner_city: Cupertino
owner_country: US
publication_date: 20090625
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","SUMMARY","DETAILED DESCRIPTION OF SPECIFIC EMBODIMENTS"],"p":["The present disclosure relates generally to graphics processing and, more specifically, to management and utilization of multiple graphics processors.","This section is intended to introduce the reader to various aspects of art that may be related to various aspects of the present disclosure, which are described and\/or claimed below. This discussion is believed to be helpful in providing the reader with background information to facilitate a better understanding of the various aspects of the present disclosure. Accordingly, it should be understood that these statements are to be read in this light, and not as admissions of prior art.","Electronic devices, including computers and portable devices such as phones and media players, typically include display screens to display user interfaces, applications, video playback, video games, etc. A display of an electronic device may be driven by a specialized processor, referred to as a Graphics Processing Unit (GPU). Applications or other software may interface with the GPU via Application Programming Interfaces (APIs), programming libraries, and frameworks that may communicate with a graphics driver for the GPU.","Some electronic devices may include multiple GPUs, such as a dual GPU device, in which one or the other GPU is used to drive the display. However, in such devices, a user may have to power cycle the device, or log in and out of the device, to switch GPU resources for applications from one GPU to the other GPU. This action may be disruptive for the user and may discourage use of the GPU resource switching capability. Solutions for GPU resource switching for individual applications typically require modification of each individual application and do not provide GPU resource switching for other software.","A summary of certain embodiments disclosed herein is set forth below. It should be understood that these aspects are presented merely to provide the reader with a brief summary of these certain embodiments and that these aspects are not intended to limit the scope of this disclosure. Indeed, this disclosure may encompass a variety of aspects that may not be set forth below.","A system and method are provided that include a virtual graphics driver that facilitates switching of GPU resources between a first GPU and a second GPU. An electronic device may include tangible machine-readable storage medium defining instructions for a virtual graphics driver. The virtual graphics driver may receive function calls and route function calls to the first GPU such that the first GPU renders graphics on a display of the electronic device. The virtual graphics driver may switch GPU resources by routing subsequent function calls to the second GPU such that the second GPU renders graphics on the display.","One or more specific embodiments will be described below. In an effort to provide a concise description of these embodiments, not all features of an actual implementation are described in the specification. It should be appreciated that in the development of any such actual implementation, as in any engineering or design project, numerous implementation-specific decisions must be made to achieve the developers' specific goals, such as compliance with system-related and business-related constraints, which may vary from one implementation to another. Moreover, it should be appreciated that such a development effort might be complex and time consuming, but would nevertheless be a routine undertaking of design, fabrication, and manufacture for those of ordinary skill having the benefit of this disclosure.","Embodiments of the invention may include an electronic device having multiple GPUs and a virtual graphics driver to provide for seamless switching between the GPUs without a user logging out of the device. The virtual graphics driver may receive function calls from applications or frameworks executing on the electronic device and may route function calls to a first GPU driver so that graphics rendering is performed solely by a first GPU. During a switch of GPU resources, the virtual graphics driver may then route incoming function calls to a second GPU driver, switching graphics rendering to the second GPU. Additionally, a virtual frame buffer driver may route accesses between a first frame buffer of the first GPU and a second frame buffer of the second GPU. During a switch, the virtual frame buffer driver may switch frame buffer access from the first frame buffer to the second frame buffer.","An example of a suitable electronic device mentioned above may include various internal and\/or external components which contribute to the function of the device.  is a block diagram illustrating the components that may be present in such an electronic device  and which may allow device  to function in accordance with the techniques discussed herein. Those of ordinary skill in the art will appreciate that the various functional blocks shown in  may include hardware elements (including circuitry), software elements (including computer code stored on a computer-readable medium) or a combination of both hardware and software elements. It should be further noted that  is merely one example of a particular implementation and is merely intended to illustrate the types of components that may be present in a device . For example, in the presently illustrated embodiment, these components may include display , I\/O ports , input devices , one or more processors , memory device , non-volatile storage , expansion card(s) , networking device , power source , first graphics processing unit (GPU)  and second graphics processing unit (GPU) .","With regard to each of these components, display  may be used to display various images generated by device . In one embodiment, display  may be a liquid crystal display (LCD), an Organic Light Emitting Diode (OLED) display, or any suitable display. Additionally, in certain embodiments of electronic device , display  may be provided in conjunction with a touch-sensitive element, such as a touchscreen, that may be used as part of the user interface for device .","I\/O ports  may include ports configured to connect to a variety of external devices, such as a power source, headset or headphones, or other electronic devices (such as handheld devices and\/or computers, printers, projectors, external displays, modems, docking stations, and so forth). I\/O ports  may support any interface type, such as a universal serial bus (USB) port, a video port, a serial connection port, an IEEE-1394 port, an Ethernet or modem port, and external S-ATA port, and\/or an AC\/DC power connection port.","Input devices  may include the various devices, circuitry, and pathways by which user input or feedback is provided to processors . Such input devices  may be configured to control a function of device , applications running on device , and\/or any interfaces or devices connected to or used by electronic device . For example, input devices  may allow a user to navigate a displayed user interface or application interface. Examples of input devices  may include buttons, sliders, switches, control pads, keys, knobs, scroll wheels, keyboards, mice, touchpads, and so forth.","In certain embodiments, input devices  and display  may be provided together, such as in the case of a touchscreen where a touch sensitive mechanism is provided in conjunction with display . In such embodiments, the user may select or interact with displayed interface elements via the touch sensitive mechanism. In this way, the displayed interface may provide interactive functionality, allowing a user to navigate the displayed interface by touching display .","User interaction with input devices , such as to interact with a user or application interface displayed on display , may generate electrical signals indicative of the user input. These input signals may be routed via suitable pathways, such as an input hub or bus, to processor(s)  for further processing.","Processor(s)  may provide the processing capability to execute the operating system, programs, user and application interfaces, and any other functions of electronic device . Processor(s)  may include one or more microprocessors, such as one or more \u201cgeneral-purpose\u201d microprocessors, one or more special-purpose microprocessors and\/or ASICS, or some combination of such processing components.","The instructions or data to be processed by processor(s)  may be stored in a computer-readable medium, such as memory . Memory  may be provided as a volatile memory, such as random access memory (RAM), and\/or as a non-volatile memory, such as read-only memory (ROM). Memory  may store a variety of information and may be used for various purposes. For example, memory  may store firmware for electronic device  (such as a basic input\/output instruction or operating system instructions), various programs, applications, or routines executed on electronic device , user interface functions, processor functions, and so forth. In addition, memory  may be used for buffering or caching during operation of electronic device .","The components may further include other forms of computer-readable media, such as non-volatile storage , for persistent storage of data and\/or instructions. Non-volatile storage  may include flash memory, a hard drive, or any other optical, magnetic, and\/or solid-state storage media. Non-volatile storage  may be used to store firmware, data files, software, wireless connection information, and any other suitable data.","The embodiment illustrated in  may also include one or more card or expansion slots. The card slots may be configured to receive expansion card  that may be used to add functionality, such as additional memory, I\/O functionality, or networking capability, to electronic device . Expansion card  may connect to the device through any type of suitable connector, and may be accessed internally or external to the housing of electronic device . For example, in one embodiment, expansion card  may be a flash memory card, such as a SecureDigital (SD) card, mini- or microSD, CompactFlash card, Multimedia card (MMC), or the like.","The components depicted in  also include network device , such as a network controller or a network interface card (NIC). In one embodiment, network device  may be a wireless NIC providing wireless connectivity over any 802.11 standard or any other suitable wireless networking standard. Network device  may allow electronic device  to communicate over a network, such as a Local Area Network (LAN), Wide Area Network (WAN), or the Internet. Further, electronic device  may connect to and send or receive data with any device on the network, such as portable electronic devices, personal computers, printers, and so forth. Alternatively, in some embodiments, electronic device  may not include network device . In such an embodiment, a NIC may be added as expansion card  to provide similar networking capability, as described above.","Further, the components may also include power source . In one embodiment, power source  may be one or more batteries, such as a lithium-ion polymer battery or other type of suitable battery. The battery may be user-removable or may be secured within the housing of electronic device , and may be rechargeable. Additionally, power source  may include AC power, such as provided by an electrical outlet, and electronic device  may be connected to power source  via a power adapter. This power adapter may also be used to recharge one or more batteries if present.","As mentioned above, electronic device  may include graphics processing units  (GPU) and  (GPU). These graphics processors may alternately drive display  by rendering graphics such as a user interface, images, video, or other media to be displayed on display . One or both of GPUs  and  may be an integrated GPU (also referred to as on-board GPU) such that GPU  and\/or  are integrated with a chipset of electronic device . In other embodiments, one or both of GPUs  and  may be a dedicated GPU not integrated with a chipset of the electronic device  and having dedicated resources such as video memory. In such an embodiment, GPUs  and\/ may be provided on an expansion card .","Each GPU  and\/or  may include 2D and 3D processing capability and may include video memory (such as shared memory or GDDRx memory). Such video memory may be used as frame buffers, texture maps, array storage, or other suitable information. Additionally, each GPU  and\/or  may include any number of rendering pipelines and may be programmable for specific features for 3D processing, e.g., programmable shaders. For example, each GPU  and\/or  may be capable of executing instructions encoded using a 3D programming API, such as Open GL, Direct X, or any other suitable API. Additionally, in some embodiments one or both of the GPUs  and\/or  may include one core, two cores, or any number of cores. In some embodiments, the GPUs  and\/or  may be a GPU manufactured by Nvidia Corporation of Santa Clara, Calf., Advanced Micro Devices, Inc. of Sunnyvale, Calif., and\/or Intel Corporation of Santa Clara, Calif. Further, each GPU  and  may include any number of inputs and outputs and may drive an external display in addition to or instead of display .","As described further below, in one embodiment GPU  may have less processing power (e.g., lower clock speed, lower throughput, less pipelines, less video memory, etc.) and may use less power than GPU . In comparison, GPU  may have more processing power and use more power than GPU . In such an embodiment, GPU  may be used to reduce power usage of electronic device . In contrast, GPU  may be used for software demanding increased processing power and\/or in conditions when power usage is not a concern.","Electronic device  may also take the form of a computer or other type of electronic device. Such computers may include computers that are generally portable (such as laptop, notebook, and tablet computers) as well as computers that are generally used in one place (such as conventional desktop computers, workstations and\/or servers). In certain embodiments, electronic device  in the form of a computer may be a model of a MacBook\u00ae, MacBook\u00ae Pro, MacBook Air\u00ae, iMac\u00ae, Mac\u00ae mini, or Mac Pro\u00ae available from Apple Inc. By way of example, an electronic device  in the form of a laptop computer  is illustrated in  in accordance with one embodiment of the present invention. The depicted computer  includes housing , display  (such as the depicted LCD ), input devices , and input\/output ports .","In one embodiment, input devices  (such as a keyboard and\/or touchpad) may be used to interact with computer , such as to start, control, or operate a GUI or applications running on computer . For example, a keyboard and\/or touchpad may allow a user to navigate a user interface or application interface displayed on LCD .","As depicted, electronic device  in the form of computer  may also include various input and output ports  to allow connection of additional devices. For example, computer  may include I\/O port , such as a USB port or other port, suitable for connecting to another electronic device, a projector, a supplemental display, and so forth. In addition, computer  may include network connectivity, memory, and storage capabilities, as described with respect to . As a result, computer  may store and execute a GUI and other applications.","As described further below, in one embodiment GPU  may have less processing power (e.g., lower clock speed, lower throughput, lower number of shaders, less video memory, etc.) and may use less power than GPU . In such an embodiment, GPU  may be used to reduce power usage of the electronic device  in certain circumstances, and GPU  may be used for software demanding increased processing power and\/or in conditions when power usage is not a concern. However, in conventional systems, switching between GPUs  and  may require the user to logout of the operating system executing on device  or to power cycle device .","With the foregoing discussion in mind,  depicts block diagram  illustrating interaction between GPUs  and  and virtual graphics driver  in accordance with embodiments of the present invention. As described in detail below, virtual graphics driver  provides seamless switching between GPUs  and  by abstracting the device driver layer of the GPUs into a single virtual graphics driver  that switches calls from a first GPU (e.g., GPU ) to a second GPU (e.g., GPU ) and vice-versa.","Virtual graphics driver  is a driver layer between a graphics framework (e.g., an OpenGL framework) or application  and the drivers for the GPUs  and . Virtual graphics driver  may interpret, route, and switch function calls from the graphics framework to one of GPUs  and  by routing calls to the respective drivers. Thus, virtual graphics driver  provides seamless switching between GPUs  and , as graphics framework or application  only interfaces with virtual graphics driver .","As shown in , GPU  may communicate with graphics driver  that receives function calls routed by virtual graphics driver  and communicates with the hardware of GPU  to provide data back to virtual graphics driver  after processing by GPU . Driver  for GPU  may interface with an operating system of electronic device  via kernel extension . Similarly, GPU  may communicate with graphics driver  that interfaces with the operating system via kernel extension .","The virtual graphics driver  becomes a member of plugin linked list , and the graphics framework or application  may send function calls (also referred to as \u201cGLD function calls\u201d) to and receive data from virtual graphics driver . Virtual graphics driver  switches the function pointer between driver  and driver  depending on the status of the GPU resource switching.","During normal processing, e.g., no switching, virtual graphics driver  may route all function calls from graphics framework or application  to one of the GPUs, such as GPU . A user or an event, such as a power management event, hot-plug event, or other event external to virtual graphics driver  may initiate a switch of graphics processing resources. For example, the switch may be from a low power GPU to a high power GPU or vice-versa. In response, virtual graphics driver  may switch current GPU resources by routing the function pointer for function calls received from graphics framework or application  to driver  for GPU . For example, resources such as rendering surfaces, texture maps, shaders, etc., are routed to GPU . Further, any subsequent processing, e.g., any subsequent function calls, may be routed to GPU . In a similar manner, virtual graphics driver  may also facilitate switching from GPU  to GPU  by routing all function calls to driver . Both GPUs  and  may be active and may render output during the transition so there is no interruption or visual \u201cglitches\u201d during rendering and output to display .","In addition to virtual graphics driver , a virtual frame buffer driver may be provided to manage and switch access to the frame buffers of GPUs  and .  depicts block diagram  illustrating interaction between system APIs  and virtual frame buffer  in accordance with an embodiment of the preset invention. As shown in , GPU  may include frame buffer  and GPU  may include frame buffer . The virtual frame buffer  may be created from instructions stored on a tangible machine-readable storage medium that is a part of or accessible by electronic device  and may execute in memory  of device .","During normal (i.e., \u201cnon-switching) operation, virtual frame buffer  may route access to the currently active GPU, frame buffer  of GPU . Virtual frame buffer  provides a virtual view of frame buffer  to system APIs  that attempt to access frame buffer . Thus, any access by system APIs  to frame buffer  are responded to by virtual frame buffer driver , abstracting the interaction between framer buffers  and  and system APIs .","System APIs  may include any number of interfaces corresponding to, for example, the actual frame buffer data (pixels) , interrupts  (e.g., for hot-plug, vertical blank), power management , display resolution , Inter-Integrated Circuit (i2C) bus, DDC\/AUX activity, and\/or any other API that may attempt to access frame buffers  and  of electronic device .","After a command to switch GPU resources, virtual frame buffer driver  may be switched in coordination with virtual graphics driver . Virtual frame buffer driver  may route frame buffer access by system APIs  to the new active GPU of the switch. For a switch to GPU , as described above, virtual frame buffer driver  may switch access for system APIs  to frame buffer  of GPU . Similarly, for a switch to GPU , virtual frame buffer driver  may switch access by system APIs  to frame buffer  of GPU .","As mentioned above, switching GPU resources may be based on a variety of factors or combinations thereof. Such \u201cfactors\u201d may include, but are not limited to: user requests (e.g., an explicit request from a user to switch GPUs); power management (e.g., low battery, switch to battery power from AC power, switch from AC power to battery power); load management (e.g., 3D rendering for games, 3D graphics editing); thermal management (e.g., high system temperatures; high GPU temperature, high GPU temperature); and\/or any other suitable factor.",{"@attributes":{"id":"p-0046","num":"0045"},"figref":["FIG. 5","FIG. 5"],"b":["90","10","92","10","92","10","82","92","94","96","98","100","92","102","52","52","52"]},{"@attributes":{"id":"p-0047","num":"0046"},"figref":"FIG. 6","b":["112","1","2","112","10","1","112","12","1","30","12","92","52","114","1","2"]},"After receiving the request, virtual graphics driver  may determine the optimal switching point (block ) to make the switch. This determination may be based on the execution state of the applications presently using GPU resources and the corresponding function calls received by virtual graphics driver . Additionally, in some embodiments, virtual graphics driver  may determine if GPU  and\/or GPU  are capable of switching.","As mentioned above, during the switch transition, the virtual graphics driver  may begin routing function calls to the driver for GPU (block ). However, GPU  may still be active and any remaining operations may be completed and resulting data provided to the virtual graphics driver  to ensure a visually seamless transition.","Additionally, virtual graphics driver  coordinates with any other system resources to ensure a seamless transition. Virtual graphics driver  may coordinate with virtual frame buffer driver  to switch frame buffer access from various system APIs (block ). After receiving a request to switch frame buffers, virtual frame buffer driver  may switch frame buffer access from the GPU frame buffer to the GPU frame buffer, so that subsequent accesses to the frame buffer are routed to GPU frame buffer. As both GPU  and GPU  are active during the switching transition, virtual frame buffer driver  may manage the frame buffer switch to also ensure a visually seamless transition and an uninterrupted output to the display .","After the remaining operations of GPU have completed (block ), any subsequent function calls are then also routed to GPU driver (block ) and the switching transition is complete. After the switch, GPU  is the active GPU and is solely driving the display . Another embodiment of the process  may be executed for switching from GPU  to GPU , upon initiation of another request to switch GPU resources.","In addition to the GPU resource switching described above, virtual graphic driver  may seamlessly provide for additional functionalities and interactions with electronic device . In one embodiment electronic device  may include hot-pluggable GPUs, so that one GPU may be removed and another GPU added without interruption of operation (e.g., shutting down) of electronic device . In such an embodiment, virtual graphics driver  may switch to a first GPU to enable hot-swapping of a second GPU. After hot-swapping a third GPU into device , the virtual graphics driver  may then provide seamless switching of GPU resources of the third GPU. Additionally, in other embodiments virtual graphics driver  may be used to provide non-hardware drivers for a system, such as for a simulator or a transaction logging driver. Further, the GPU resource switching described above may be extended to any multi-GPU system, such as an electronic device having three GPUs, four GPUs, etc.","The specific embodiments described above have been shown by way of example, and it should be understood that these embodiments may be susceptible to various modifications and alternative forms. It should be further understood that the claims are not intended to be limited to the particular forms disclosed, but rather to cover all modifications, equivalents, and alternatives falling within the spirit and scope of this disclosure."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Various aspects of this disclosure may be better understood upon reading the following detailed description and upon reference to the drawings in which:",{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
