---
title: Format-converting device and private branch exchange system using the same, and format-converting method and memory medium storing a program to allow computer to execute the same method
abstract: A format-converting device couples a control device controlling an extension with a private branch exchange (PBX). A memory stores a converting table, which brings a first command data into correspondence with a given function and stores the first command data and the given function, a telephony application programming interface (TAPI) function and a telephony service provider interface (TSPI) function. A converting section calculates the given function based on the received first command data referring to the converting table. A first calculating section calculates the TAPI function. A second calculating section calculates the TSPI function. The first calculating section calculates based on a calculated result of the converting section. The second calculating section produces a second command data based on a calculated result of the first calculating section, where the second command data differs from the first command data. The second command data is sent to the PBX.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07010105&OS=07010105&RS=07010105
owner: Matsushita Electric Industrial Co., Ltd.
number: 07010105
owner_city: Osaka
owner_country: JP
publication_date: 20020315
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DESCRIPTION OF THE PREFERRED EMBODIMENTS"],"p":["The present invention relates to a format-converting device and a private branch exchange system using the same.","Recently, most hotel-management-works such as reception, reservation, check in, check out, are operated by a hotel-management system using a computer. A computer system controlling mainly hotel-management-works at a reception desk is called front office system (FOS) hereinafter.","A FOS controls a private branch exchange (PBX) and the like besides the hotel-management-works mentioned above. In general, a management system of a FOS (a FOS management system) communicates with a PBX, and controls a PBX with a command of ASCII code.","Recently, computers have progressed remarkably. A FOS has accumulated a large amount of hotel-management know-how for many days, e.g., circumstances of a hotel, customer's requirements. As a result, changing an old model of FOS management system to new one causes some troubles, and an old model of FOS management system is obliged to remain in the hotel.","On the other hand, the latest PBX can supply various services, so that a large number of old PBXs are replaced with new ones at hotels.","However, refurbishing a FOS management system for using a new PBX is complicated and troublesome. Because a large number of PBX manufacturing companies have developed PBXs and interfaces by their original command-systems and -methods, new PBXs are poorly compatible with conventional FOS management systems.","Most present FOS management systems have conventional OS or application software, and do not match a new PBX. As a result, when the new PBX is connected to a FOS management system, the following problem occurs. Even if the same ASCII codes are used for the PBX and the FOS management system as command data, description forms of command data of the PBX are different from that of the FOS management system. The new PBX thus can not recognize information or an order supplied from the FOS management system, and can not receive them. The FOS management system can not recognize information or an order supplied from the new PBX either. In a word, the new PBX and the conventional FOS management system can not work in cooperation with each other.","The present invention aims to provide a format-converting device and a private branch exchange (PBX) system using the format-converting device, where the format-converting device achieves high compatibility by calling a given function through using a command data in a specified code.","The present invention further aims to provide a format-converting method and a memory medium storing a program to allow a computer to execute the format-converting method.","The format-converting device of this invention includes the following elements:","(a) a first sending and receiving section for receiving a first command data and sending a second command data,","(b) a memory for storing a converting table, which stores a first command data and a given function corresponding to the first command data, a telephony application programming interface (TAPI) function and a telephony service provider interface (TSPI) function,","(c) a converting section referring to the converting table based on the received first command data and calculating a given function,","where when the converting section receives a data based on a second command data, the converting section changes the data to a first command data,","(d) a first calculating section calculating a TAPI function,","(e) a second calculating section calculating a TSPI function,","(f) a controller allowing the first calculating section to calculate based on a calculated result of the converting section, and allowing the second calculating section to calculate based on a calculated result of the first calculating section, and producing a second command data different from the first command data,","where when the format-converting device receives the second command data from the PBX, the first calculating section calculates based on a calculated result of the second calculating section, and the converting section supplies the first command data based on the calculated result of the first calculating section, and","(g) a second sending and receiving section sending the second command data to the PBX and receiving another second command data from the PBX.","The PBX system of this invention includes the following elements:","(a) the format-converting device mentioned above,","(b) a control device controlling a management system including extension-management,","(c) a PBX.","The format-converting method of this invention includes the following steps:","(a) receiving a first command data,","(b) calculating a selected TAPI function based on the first command data from a converting table, which stores a first command data and a given TAPI function corresponding to the first command data,","(c) selecting a TSPI function based on a calculated result of the step (b),","(d) calculating a selected TSPI function based on the first command data,","(e) producing a second command data based on a result of the step (d), and","(f) sending the second command data.","The computer readable memory medium of this invention storing a program to allow a computer to execute the format-converting method mentioned above.","Exemplary embodiments of the present invention are demonstrated hereinafter with reference to the accompanying drawings.","In these embodiments, a computer system controlling hotel-management-works at a reception desk is called front office system (FOS).","A system of the embodiment of the present invention including following elements will be described:","(a) a format-converting device,","(b) a private branch exchange (PBX) system for controlling hotel-management-works at a reception desk through using the format-converting device,","(c) a program for converting a format of ASCII code, and","(d) a computer readable memory medium for storing the program.",{"@attributes":{"id":"p-0046","num":"0045"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0047","num":"0046"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0048","num":"0047"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0049","num":"0048"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0050","num":"0049"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0051","num":"0050"},"figref":"FIG. 6"},"In , FOS management system  operates hotel-management-works such as management of service conditions of hotel-extensions or billing data at a reception desk.","PBX  connects hotel-extensions to outside lines, or provides services of voice mails and the like.","Format-converting device  executes the following operation:","1) Format-converting device  receives a command data of ASCII code written in a first description form (a first ASCII-command-data), and converts the first ASCII-command-data into a command data which PBX  can understand. The changed command data discussed above is a command data of ASCII code written in a second description form (a second ASCII-command-data).","2) Format-converting device  receives a command data written in the second description form from PBX , and changes the command data into a command data written in the first description form which FOS management system  can understand.","The first description form is different from the second description form.","RS-232C cable  serially transmits the first ASCII-command-data between FOS management system  and format-converting device . RS-232C cable  transmits the second ASCII-command-data between PBX  and format-converting device .","A structure of FOS management system  is described hereinafter. Input section  is a keyboard and the like placed at FOS management system . A data is supplied from input section  to graphical user interface (GUI) and the like supplied from FOS controller . According to this input data, FOS management system  supplies a first ASCII-command-data to format-converting device  for controlling PBX .","Display section  operates a display such as a CRT.","Memory section  stores various kinds of data of FOS management system . FOS controller  controls each section of FOS management system . FOS management section  controls a hotel data in FOS management system . RS-232C interface (I\/F)  sends and receives a first ASCII-command-data via RS-232C cable  between FOS management system  and format-converting device .","FOS management section , which includes an application program for management of FOS, operates hotel-management-works at a reception desk.","A structure of PBX  is described hereinafter.","PBX  is connected to hotel-extensions , through and outside line .","Speech channel switch  controls switching between hotel-extensions , through and outside line . Extension-circuits I\/Fs , through are provided between hotel-extensions I\/Fs , through and speech channel switch . Outside-line circuits I\/Fs , are prepared between outside line  and speech channel switch .","PBX controller  controls speech channel switch , extension-circuits I\/Fs , through and outside-line circuits I\/Fs , , and exchanges a control data with FOS management system . Memory section  stores a data for controlling PBX .","RS-232C interface (I\/F)  sends and receives a second ASCII-command-data between format-converting device  and PBX .","An operation of PBX  is described hereinafter. FOS management system  sends a command data to format-converting device  for prohibiting a calling of hotel-extension ","At that time, format-converting device  sends a second ASCII-command-data to PBX controller . PBX controller  receives and analyzes the data. PBX controller  then controls PBX , and allows PBX  to send an error sound to hotel-extension responding to a calling requirement from extension ","When a message-waiting lamp turns on, FOS management system  also sends a command data to format-converting device . According to the data, format-converting device  sends a second ASCII-command-data to PBX controller .","FOS management system  controls PBX  via format-converting device  as discussed above.","A structure and an operation of format-converting device  of the first embodiment are described hereinafter. Format-converting device  includes converting section , telephony application programming interface (TAPI) section  and telephony service provider (TSP) section .","Converting section  receives a first ASCII-command-data, and converts the data to be able to call a TAPI function from memory section  and to be able to operate. TAPI section  calculates a TAPI function. Then TSP section  calls a telephony service provider interface (TSPI) function from memory section , and calculates a TSPI function. As a result, format-converting device  receives the first ASCII-command-data, and converts the first ASCII-command-data into a second ASCII-command-data, then supplies it.","Besides the operation discussed above, format-converting device  receives a second ASCII-command-data from PBX , and sends it to converting section  via TSP section  and TAPI section , then converting section  converts the data into a first ASCII-command-data. Converting section  sends the converted data to FOS management system .","Herein, TAPI is provided by Microsoft\u00ae. Microsoft Corporation supplies TAPI library of functions. TSPI specification is provided by Microsoft Cooperation.","An operation of each section of the format-converting device of this embodiment is described hereinafter.","First, converting section  selects a given command data from the first ASCII-command-data which is supplied from FOS management system  via interface (I\/F) , where the first ASCII-command-data corresponds to a data readable by PBX .","Second, converting section  converts the selected command data, so that a TAPI function can be ready to be called from memory  and TAPI section  can be ready to calculate.","Third, converting section  allows TAPI section  to calculate, format conversion is thus executed.","ASCII-command-data-conversion table previously prepared is used as the format conversion.","In this embodiment, in order to call a TAPI function from the first ASCII-command-data, the first ASCII-command-data is temporarily replaced with a given function using ASCII-command-data-conversion table , then an operation for calling the TAPI function is executed by calculating the given function.","ASCII-command-data-conversion table is a conversion table showing a relation between first ASCII-command-data and a plurality of given TAPI functions. A condition of FOS management system  can be supplied using an input screen of display section  to the conversion table.","TAPI section  calculates the TAPI function called by converting section , and processes a TSPI function to be called. Besides TAPI, Novell's Telephony Services Application Programming Interface (TSAPI) can be used as TAPI section .","TSP section  calculates a TSPI function which is called by TAPI section  from memory section . TSP section  converts an input command into a second ASCII-command-data, and supplies the second ASCII-command-data for controlling PBX .",{"@attributes":{"id":"p-0085","num":"0084"},"figref":"FIG. 2","b":["37","34"],"i":"a "},"An input screen of  shows the following operation. A first ASCII-command-data \u201cFOSMWL ON \u201d is selected, and a TAPI function lineDevSpecific (hline, dwAddressID, hCall, lpParams, dwSize) corresponding to the selected command-data is called from memory section .","Necessary information is supplied to ASCII-command-data-conversion table for replacing the first ASCII-command-data with code FDS [Field  C]  [EXT_SETMW]  [Field C] (command name: MWLOn) corresponding to an operation for calling the TAPI function to converting section .","The command-data can be revised to another command-data, and the TAPI function and the TSPI function can be changed by supplying a condition using the input screen.","A command name and an output-destination of a code corresponding to an ASCII-command-data are supplied using input section , where the code corresponds to a given TAPI function. Thus an output destination of the function and a function replaced with the first ASCII-command-data sent from FOS management system  are determined.","For example, in this case, a command name and an output-destination are supplied as \u201cMWLOn\u201d and \u201cPBX\u201d respectively.","Each \u201cField\u201d is supplied according to the following definition for describing a command data.","1) When nine letters (as \u201cLength\u201d) from a first letter (as \u201cStart\u201d) to a ninth letter agreed with \u201cFOSMWL ON\u201d, the command of \u201cMWLOn\u201d is operated.","2) Four letters (as \u201cLength\u201d) from a twelfth letter (as \u201cStart\u201d) are recognized as \u201cExtension\u201d.","3) Four letters (as \u201cLength\u201d) from a eighteenth letter (as \u201cStart\u201d) are","Converting section  can include software called property-management-system (PMS)-interface software for sending an ASCII-command-data used in a hotel-management system and the like.","A code produced originally by a PBX maker is used as the second ASCII-command-data, and a standard code called computer-supported-telephony application (CSTA) is also used as the second ASCII-command-data.","Memory section  includes ASCII-command-data-conversion table , data area and data area ","Data area stores a given command data selected from command data of FOS management system . Data area stores a plurality of TAPI functions, TSPI functions and other information.","Data of parameter, e.g., hline, dwAddressID, hCall, lpParams, dwSize, of TAPI functions are stored at area , area , area  . . . in data area ","where: hline shows the number of a line device showing an extension number;","dwAddressID shows an address ID of which fixed value is 0;","hCall shows a calling-handle value of which fixed value is 0;","lpParams shows a pointer value of a memory data area storing other necessary information; and","dwSize shows a data area size of lpParams, and other necessary information is stored in a memory data area of dwSize.","Central controller  controls each section forming format-converting device . Input section  is an input device, e.g., keyboard. Display section  displays information on a display such as a CRT. RS-232C interface (I\/F) sends and receives a data between FOS management system  and format-converting device . RS-232C interface (I\/F) sends and receives a data between PBX  and format-converting device . recognized as \u201cExtension\u201d.",{"@attributes":{"id":"p-0106","num":"0105"},"figref":["FIG. 3","FIG. 3"],"b":"2"},"For example, \u201cFOSMWL ON 1001 1002\u201d is supplied from FOS management system  to format-converting device  as a first ASCII-command-data. At that time, the first ASCII-command-data is replaced with a function of \u201cMWLOn\u201d FDS [Field  C]  [EXT_SETMW]  [Field C]. \u201c\u201d and \u201c\u201d are stored respectively in \u201cField C\u201d and \u201cField C\u201d, and are passed to the TAPI function as data of a parameter or a \u201cstructure\u201d.","After the TAPI function is calculated, according to the calculated result, lineDevSpecific hline, dwAddressID, hCall, lpParams, dwSize of a TAPI function is called by converting section .","Then the TAPI function is calculated at TAPI section .","TSPI function TSPI lineDevSpecific (DRVRequest, hline, dwAddressID, hCall, lpParams, dwSize is called from memory section  by TSP section , and TSP section  calculates the TSPI function.","Necessary data of parameters (DRVRequest, hline, dwAddressID, hCall, lpParams, dwSize) are stored in data area , where, DRVRequest shows the number which TSP section  determines randomly. Other parameters (hline, dwAddressID, hCall, lpParams, dwSize work in the same way as those of the TAPI function.","TSP section  reads necessary data from data area , and calculates the TSPI function, then finishes a format-converting-operation. TSP section  thus supplies a resultant second-ASCII-command-data from RS-232C interface to PBX . PBX controller  controls PBX  using the second ASCII-command-data.","Even if the different description of a command data is supplied from FOS management system , a TAPI function corresponding to a command data can be called using converting section .","A format-converting-operation, which includes steps of sending a confirming-message from PBX  to memory section  of FOS management system , is described hereinafter. A message written in the second ASCII-command-data is sent from PBX  to TSP section  via interface (I\/F) and RS-232C interface of format-converting device . TSP section  always monitors a message from PBX . When TSP section  receives a given message, TSP section  begins to operate.","TSP section  recognizes the given message, and calls a CallBack function (hline, hCall, dwMsg, dwParam) of a TAPI function,","where: \u201chline, hCall\u201d work the same as those of the TAPI function;","\u201cdwMsg\u201d stores message information; and","\u201cdwParam\u201d stores detailed message information.","TAPI section  calls a CallBack function (hline, hCall, dwMsg, dwParam) of converting section  by using the CallBack function (hline, hCall, dwMsg, dwParam) which is called by TSP section .","Converting section  supplies \u201cPBXMWL ON \u201d to FOS management system  as a first ASCII-command-data based on a result of a calculation of the CallBack function (hline, hCall, dwMsg, dwParam). As a result, the message produced from PBX  is converted from a second ASCII-command-data into a first ASCII-command-data, and supplied to FOS management system , then noticed to an operator.","In this embodiment, a format-converting-operation operated at format-converting device  is executed by a program which works a computer as a converting section. The program is loaded to a computer from a computer readable memory medium storing the program.","As shown in , computer readable memory medium  stores the program. Extracting section  stores a program for extracting command contents and a necessary data from a command data written in ASCII code.","Storing section  has a program for storing command contents in data area of memory section  or in ASCII-command-data-conversion table ","Calculating section  receives a command data, then calls to calculate a TAPI function using ASCII-command-data-conversion table which shows a relation between a command data written in an ASCII-command-data and a TAPI function.","A computer having memory medium  converts the command data written in an ASCII-command-data into TAPI data.","An operation worked at format-converting device  is described hereinafter with reference to a flowchart of FIG.  and FIG. .","Processes of turning on a message-waiting lamp starting with inputting data into FOS management system , and those processes are described with reference to FIG. .","In step , an operator turns on the message-waiting lamp of extension  from input section  using GUI, and prepares extension  for a return message.","FOS management system  receives the information from an operator, and sends it to format-converting device  as a first ASCII-command-data \u201cFOSMWL ON \u201d,","where: \u201cFOSMWL ON\u201d shows a command;","\u201c\u201d shows an extension number for turning on the message-waiting lamp; and","\u201c\u201d shows a extension number for waiting the return message.","In step , converting section  calculates for calling a TAPI function corresponding to \u201cFOSMWL ON \u201d using ASCII-command-data-conversion table ","To be more specific, converting section  calls the TAPI function lineDevSpecific (hline, dwAddressID, hCall, lpParams, dwSize) used for turning on the message-waiting lamp, and replace the command data with a code FDS [Field  C]  [EXT_SETMW]  [Field C] which is ready to be calculated. The command data calls the TAPI function corresponding to \u201cMWLOn\u201d using ASCII-command-data-conversion table , and is replaced with FDS [Field  C]  [EXT_SETMW]  [Field C] which is ready to be calculated at converting section . \u201c\u201d and \u201c\u201d are stored respectively in \u201cField C\u201d and \u201cField C\u201d, and command data is calculated as a data of a parameter or a \u201cstructure\u201d which is passed to the TAPI function.","In step , TAPI function lineDevSpecific hline, dwAddressID, hCall, lpParams, dwSize is called.","In step , the TAPI function of TAPI section  is executed. TAPI section  reads necessary data such as \u201c\u201d shown in dwAddressOffset from data area and calculates it.","In step , TAPI section  reads a TSPI function TSPI lineDevSpecific (DRVRequest, hline, dwAddressID, hCall, lpParams, dwSize) and substitutes actual parameter, then operates the TSPI function of TSP section . TSP section  executes the TSPI function TSPI lineDevSpecific (DRVRequest, hline, dwAddressID, hCall, lpParams, dwSize).","In step , as a result, TSP section  supplies the following command data written in a second ASCII code.\n\n[1^:002061012F000100090100000000313030310200010803000901000 0000131303032^]6F\u2003\u2003(formula 1)\n","In step , PBX controller  turns on a message-waiting lamp of extension .","Processes of informing \u201cON\u201d of the message-waiting lamp of extension  from PBX  to FOS management system  are described hereinafter. As shown in step  of , the following second-ASCII-command-data is informed from PBX  to format-converting device .\n\n[0^:00274001FF000100090100010001313030310200010303000100040 00C000109010002000131303032000462023100^]C7\u2003\u2003(formula 2)\n","In step , TSP section  receives the second-ASCII-command-data, and recognizes \u201cON\u201d of the message-waiting lamp.","In step , TSP section  calls a CallBack function (hline, hCall, dwMsg, dwParam, dwParam, dwParam), and sends the CallBack function to TAPI section .","In step , TAPI section  calls a CallBack function (hline, hCall, dwMsg, dwParam), and sends the CallBack function to converting section .","In step , converting section  converts the CallBack function into a first-ASCII-command-data \u201cPBXMWL ON \u201d and sends the data to FOS management system .","As a result, \u201cON\u201d of the message-waiting lamp of extension  is informed to FOS management system .","Information produced at PBX  is converted from a second ASCII code to a first ASCII code, and controlled at FOS management system  as discussed above.","When TSP section  calculates an ASCII-command-data sent from PBX  as a TSPI function, a conversion table such as an ASCII-command-data-conversion table is produced, and the ASCII-command-data is replaced with a given function, then a TSPI function is called. As a result, format-converting device , which can use various kinds of PBX , is proposed.","Many modifications and variations of the present invention are possible in the light of the above techniques. It is therefore to be understood that within the scope of the invention, the invention may be practiced otherwise than as specifically described."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0034","num":"0033"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0036","num":"0035"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0038","num":"0037"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
