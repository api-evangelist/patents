---
title: System and method for using character set matching to enhance print quality
abstract: A system and method of using character set matching to identify the matching or best-matching font to print text of indeterminate language are presented. Today's operating systems do not provide the native tools and functions to easily display text of unknown language or multiple languages. The complexity of any underlying code that handles a multilingual display is sharply increased due to the text being segmented into multiple text runs. The invention employs character set engine that provides necessary character set guessing functionality, as well as an enumerator module to build a linked list of suitable output fonts to display text from an arbitrary language, and multilingual text. Output on a laser, inkjet or other printing apparatus can be granted by traversing that list.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07031002&OS=07031002&RS=07031002
owner: International Business Machines Corporation
number: 07031002
owner_city: Armonk
owner_country: US
publication_date: 19990827
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE ILLUSTRATIVE EMBODIMENTS"],"p":["This application claims priority from, and incorporates by reference, U.S. Provisional Patent Application Ser. No. 60\/114,574, filed Dec. 31, 1998, entitled \u201cSystem and Method for Evaluating Character Sets\u201d. The subject matter of this application is also related to co-pending U.S. patent application Ser. No. 09\/384,088 filed Aug. 27, 1999, entitled \u201cSystem and method for Evaluating Character Sets to Generate a Search Index\u201d; U.S. patent application Ser. No. 09\/384,089, filed Aug. 27, 1999, entitled \u201cSystem and Method for Output of Multipart Documents\u201d; U.S. patent application Ser. No. 09\/384,371, filed Aug. 27, 1999, entitled \u201cSystem and Method for Evaluating Character Sets to Determine a Best Match Encoding a Message\u201d; U.S. patent application Ser. No. 09\/384,442, filed Aug. 27, 1999, entitled \u201cSystem and Method for Evaluating Character Sets of a Message Containing a Plurality of Character Sets\u201d; U.S. patent application Ser. No. 09\/384,443, filed Aug. 27, 1999, entitled \u201cSystem and Method for Evaluating Character Sets\u201d; U.S. patent application Ser. No. 09\/384,538, filed Aug. 27, 1999, entitled \u201cSystem and Method for Highlighting of Multifont Documents\u201d; and U.S. patent application Ser. No. 09\/384,542, filed Aug. 27, 1999, entitled \u201cSystem and Method for Outputting Character Sets in Best Available Fonts\u201d.","The invention relates to the field of communications, and more particularly to the management of character set information within documents so that the most appropriate font may be used to output documents in printed form which have an arbitrary language origin.","With the use of the Internet, email and related electronic services, communications software has been increasingly called upon to handle data in a variety of formats. While the barriers to simple communications have been removed from many hardware implementations, the problem of software being unable to display text in different languages remains.","For instance, a person browsing the World Wide Web may wish to input a search string in their native language. Some Web pages or search engines will simply accept that string in the form in which it was input, but not process the spelling, syntax or character set in native form. The search engine then performs a search as though the search were in English, usually resulting in no hits. Other Web pages may allow user to manually specify the desired language for browsing and searching.","To display multilingual data correctly on the output side when a document is located and ready to be outputted on a computer screen, sent to a printer or otherwise using the right font is a common problem that developers encounter when writing international applications, including Web applications.","In the pursuit of better and more uniform multilingual documents, the International Standards Organization (ISO) and other bodies have developed a universal character set standard referred to as Unicode, Version 2.0 of which was released in 1996. The current Unicode standard is a 16-bit protocol encoding 25 different scripts as well as at least 38,885 separate characters. Scripts are in general higher-level collections of related characters from a character set which may be assembled for use in one or more languages.","Ultimately, displaying Unicode data becomes a problem of dynamically selecting the closest font available on a system to best express a subject document. The commercial TrueType\u2122 and OpenType\u2122 font sets can only output the appropriate glyphs or symbols for a subset of Unicode ranges. It is therefore necessary to generate the right character set (charset) font flag information, that is, to identify the font best matching the data to be displayed when creating the graphical font object for display or printing.","Unfortunately, documents often originate from unknown sources and unknown languages and even if the original text is encoded in Unicode, it can be difficult to identify in which character set or Unicode target range the content has been encoded with. Once the character set is identified, it can be mapped to the corresponding font flag information used to create the logical font under a given operating system. For example, text that can be encoded as Code page 874 would be mapped to THAI_CHARSET in Microsoft\u2122 Windows\u2122.","The display of Unicode data consequently relates to a process of selecting a font and using whatever system application programming interface (API) is available to output the text, a process which becomes even more complicated when the text is in multiple languages. Because the selected font might not be able to render all the characters from all the different character sets used in multipart, multilanguage documents, that type of data must be broken into different textual segments that use the same character set and display them separately using the appropriate font.","Therefore, among other technical complexities, the software developer must solve at least two fundamental problems when trying to accommodate multilingual output. The first is to determine which character set or Unicode ranges the text has been encoded with. The second, to choose the font that will be able to render the characters most correctly. Other problems exist, including the selection of most appropriate fonts for developing printed output.","The invention overcoming these and other problems in the art relates to a system and method for character set matching to achieve best printed output, in which character set information is embedded in fonts and large-capacity fonts containing symbols applicable to a variety of languages include font tag information representing their capabilities. Application software, operating system software and other resources may therefore interrogate the font tag information to determine whether a given font may represent the characters of a message on a character-by-character basis. A linked list of matching fonts is built, which may be traversed to output the document to a screen display, printer or elsewhere. Textual documents having more than one language may be analyzed in successive runs, in which the most suitable font is selected for each segment for printing such as on a laser, inkjet or other printing apparatus.","First, one illustrative environment in which the invention operates will be described, in which documents to be processed are assumed to be stored in the Unicode format. Unicode is a 16-bit universal character encoding that encompasses virtually all characters commonly used in the languages of today's world. Unicode encodes text by scripts, and not necessarily by individual languages.","The Unicode standard assigns the same code point to characters or ideographs that are shared among multiple languages, even though these characters may have different meanings and pronunciations in those different languages. For this reason, one character can be rendered by more than one glyph or symbol from different character sets, and this can potentially add logical errors to the displayed text.","Scripts can be defined as a higher-order collection of related characters which can be assembled to form one or more languages. For example, Cyrillic script can be used for the expression of Russian, Ukrainian, Bulgarian and other languages. Hebrew script can be used to express Modern Hebrew, Biblical Hebrew, and other languages. Each script has its own properties and rules, including logical order (right to left, left to right, neutral), dynamic composition, ligature and other attributes.","Ultimately, it is the responsibility of the font resources to implement the rules and behaviors proper to each script as outlined by the Unicode standard. For a font to be Unicode conformant, it must correctly interpret and render a subset of Unicode characters, providing support for one or many specific scripts and languages. To avoid ambiguity, the invention helps to transparently identify the language or character set being used in the data so that a best match to available output fonts may be made.","Otherwise, in the absence of the invention the operating system would have to select whatever default language is available in the given script. This can result in character rendering errors. Therefore, the invention operates to choose the optimal font for display as well as to select the correct script in the font, and may query the font properties and display the text output according to correct rules of language. Moreover, the invention may process texts composed in several different languages, one after the other for output. An illustration of the overall text processing according to the invention is shown in .","The Unicode standard uses different ranges for each of its constituent scripts, as illustrated in . Given a character code point within the 16-bit address range of Unicode, it is straightforward using Unicode's encoding layout to identify the corresponding script by location. But because a single script can be used by more than one language, it is only by looking at the surrounding text and using statistical methods that the character set of the original language can be determined with any degree of certainty.","It should be noted that ASCII characters are used in nearly all scripts and therefore do not reveal significant information about the original language. Conversely, the presence of idiosyncratic characters which are strongly associated with particular languages can be used to infer the use of that language in the original text. For example, Hiragana characters in a stream of Han ideographs is a strong indication that the text is Japanese, and a stream of Hangul characters is almost certainly Korean. Other scripts have known associations with various particular languages.","In general, in terms of character set evaluation or identification the invention uses a character table bank against which the ability of a number of character sets to encode a given character is tested. When a message of unknown origin is presented to the system, its characters are parsed and tested against the character table bank to identify which of the pool of character sets can express each character.","A character set which contains a match for every character of the message is likely to be the native encoding of the original message. Tallies of matches to individual characters across all available character sets in the character table bank can also be made for the message as a whole. An overall architecture of a character set analysis system is illustrated in .","The invention in one regard uses statistical methods to provide an automatic and rigorous language evaluation facility by which the text represented in Unicode is tested against a bank of available language character sets, in order to determine which or any of those candidate character sets can express the text in its entirety. The invention evaluates which character sets are capable of expressing the text from the language bank, to present to a user or otherwise.","The invention may assign a rating to those character sets that can express the given message, in order to determine which of the character sets is the most appropriate to use to express the message. The invention may likewise evaluate which character set permits searching and reading of text expressions, improving the quality of search results, all as more fully described in the aforementioned copending U.S. application Ser. Nos. 09\/384,088, 09\/384,089, 09\/384,371, 09\/384,442, 09\/384,443, 09\/384,538, and 09\/384,542.","As illustrated in , fonts which are capable of representing characters from multiple scripts are referred to as big fonts . Within a big font , scripts are identified by font tag  that encodes information about the capabilities of that font, including an indication of scripts which employ the characters of that font. In one embodiment the font tag may comprise a unique 4-byte identifier, but other formats are contemplated by the invention. Furthermore, as illustrated in , in the particular environment of True Type\u2122 fonts, big fonts  may be tagged with a font signature  that contains information about the Unicode subranges currently supported.","For example, Microsoft Windows\u2122 uses the following structure to exchange font signature information.",{"@attributes":{"id":"p-0037","num":"0036"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 1"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Typedef struct tagFONTSIGNATURE"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"4"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"77pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"112pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"{",{},{}]},{"entry":[{},{},"DWORD fsUsb[4];","\/\/Unicode subranges"]},{"entry":[{},{},"DWORD fsCsb[2];","\/\/Windows and OEM code pages"]},{"entry":[{},{},"} FONTSIGNATURE;"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"3","align":"center","rowsep":"1"}}]}]}}]}}},"Individual applications can query big fonts about their multilingual capabilities by accessing the font tag  according to the invention. More specifically, client software can inquire whether a given font may be able to render the text of a current document correctly. Microsoft\u2122 Windows\u2122 provides the following function to obtain the font signature of a font currently selected in a Device context, as will be understood by persons skilled in the art.",{"@attributes":{"id":"p-0039","num":"0038"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 2"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"int WINAPI GetTextCharsetInfo(HDC hdc,"]},{"entry":[{},"LPFONTSIGNATURE lpSig,"]},{"entry":[{},"DWORD"]},{"entry":[{},"dwFlags);"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}}}},"The procedure call in Table 2 above can only be used, however, to validate a given font for matching a character set which is already specified. To dynamically select an appropriate font, the invention instead enumerates all the fonts available in the system and organizes them by name. In the practice of the invention, and as illustrated in , this enumeration function is generally done at initialization time by creating a linked list of structures that contain various categories of information about the native fonts. Each font name category then contains a list of all the scripts supported, as well as the graphical font objects associated with that script. The ouputting of a subject text to a screen display, printer or otherwise can therefore be performed by traversing the linked list.  adhere to the syntax of the C++ language, although it will be understood that other programming languages may be used.","As illustrated in , the CUnicodeFontManager module  contains a linked list of CFamilyFont modules , each of which contains a CUnitFontInfoManager module  that contains a linked list object  containing a sequence of CUnitFontInfo objects  identifying scripts associated with or capable of expressing a given symbol. Ouputting the subject text is then a matter or traversing the linked list to invoke the fonts associated with the CUnitFontInfo objects , to send to a display screen, printer or otherwise.","To build the linked list object , the following Windows\u2122 function may be used.",{"@attributes":{"id":"p-0043","num":"0042"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"182pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 3"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"int EnumFontFamiliesEx(HDC,"]},{"entry":[{},"LPLOGFONT, \/\/pointer to logical font"]},{"entry":[{},"FONTENUMPROC,\/\/pointer to callback function"]},{"entry":[{},"LPARAM, \/\/application-supplied data"]},{"entry":[{},"DWORD); \/\/reserved; must be zero"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}}}},"In this environment, the callback function passed to the procedure call EnumFontFamiliesEx must have the following prototype.",{"@attributes":{"id":"p-0045","num":"0044"},"tables":{"@attributes":{"id":"TABLE-US-00004","num":"00004"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"thead":{"row":[{"entry":"TABLE 4"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"int CALLBACK EnumFontFamExProc("}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"ENUMLOGFONTEXW *lpelfe, \u2003\u2003\/\/ pointer to logical-font data"]},{"entry":[{},"NEWTEXTMETRICEXW *lpntme, \u2003\/\/ pointer to physical-font data"]},{"entry":[{},"int FontType, \u2003\u2003\u2003\/\/ type of font"]},{"entry":[{},"LPARAM lParam); \/\/ application-defined data"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}}},"Inside the callback function in Table 4 above, the linked list object  can be built using the data passed by the system. In the particular environment of Microsoft\u2122 Windows\u2122, the character set used is actually a font character set which does not necessarily match the character set or code page that is returned by the integrated character set guessing algorithm of the invention. Therefore, in one embodiment it is necessary to map the code page to a font character set property, before doing a lookup query to the linked list object  of available fonts.","The code in Table 5 below is as an example under Microsoft\u2122 Windows\u2122 of such a code page mapping.",{"@attributes":{"id":"p-0048","num":"0047"},"tables":{"@attributes":{"id":"TABLE-US-00005","num":"00005"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 5"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"BYTE MapCodePageToFontCharset(short iActiveCodePage)"]},{"entry":[{},"{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"switch(iActiveCodePage)"]},{"entry":[{},"{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 874:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return THAI_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 932:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return SHIFTJIS_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 936:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return GB2312_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 949:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return HANGEUL_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 950:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return CHINESEBIG5_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 1250:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return EASTEUROPE_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 1251:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return RUSSIAN_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 1252:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return ANSI_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 1253:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return GREEK_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 1254:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return TURKISH_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 1255:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return HEBREW_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 1256:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return ARABIC_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"case 1257:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return BALTIC_CHARSET;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"default:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"break;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"Return DEFAULT_CHARSET;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}}},"If a client application working in tandem with the invention to process text needs to create a graphical font object, that application will need to use a return flag when creating a logical font structure according to the invention. For further example in Windows\u2122:",{"@attributes":{"id":"p-0050","num":"0049"},"tables":{"@attributes":{"id":"TABLE-US-00006","num":"00006"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"thead":{"row":[{"entry":"TABLE 6"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"BYTE FlagCharset=MapCodePageToFontCharset( iActiveCodePage);"},{"entry":"LOGFONT lFont;"},{"entry":"(Initialization of lFont . . .)"},{"entry":"LFont.lfCharSet = FlagCharset;"},{"entry":"CreateFontIndirect ( &lFont);"},{"entry":". . ."},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]}}}}},"When the font has been created and selected into a Device context, it may then be necessary to query information such as ordering, ligature, existence of additional glyphs that are not encoded, and other information for output presentation. Windows\u2122 provides the following function to access these properties:\n\n",{"@attributes":{"id":"p-0052","num":"0052"},"tables":{"@attributes":{"id":"TABLE-US-00007","num":"00007"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 7"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"DWORD WINAPI GetCharacterPlacement("]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"168pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"HDC, \/\/ handle to device context"]},{"entry":[{},"LPCSTR, \/\/pointer to string"]},{"entry":[{},"Int, \/\/ number of characters in string"]},{"entry":[{},"Int, \/\/maximum extent for display"]},{"entry":[{},"LPGCP_RESULTS, \/\/Result buffer"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"182pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"DWORD); \/\/placement flags"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}}},"The procedure call GetCharacterPlacement can be used to query information from font tag  about a displayed string such as its width, ordering, glyph rendering and other information that may be used by client applications or otherwise to adjust the output document.","Another embodiment of the invention involving documents made up of sections in different languages will now be described. Using the character guessing algorithm described more fully in the aforementioned copending U.S. application Ser. Nos. 09\/384,088, 09\/384,089, 09\/384,371, 09\/384,442, 09\/384,443, 09\/384,538, and 09\/384,542, the text-rendering subsystem first segments the text into multiple text runs that share the same character set or Unicode range. In general, the invention manages multipart, multilanguage documents by decomposing them into discrete segments for output.",{"@attributes":{"id":"p-0055","num":"0055"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0056","num":"0056"},"tables":{"@attributes":{"id":"TABLE-US-00008","num":"00008"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"182pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 8"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"For (each segment)"]},{"entry":[{},"{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"77pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"140pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Load font into Device Context"]},{"entry":[{},"Display text in segment"]},{"entry":[{},"Unload font"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"98pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"119pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}}},"An additional difficulty in a multi-part context is the increased complexity that is introduced in functions such as word wrapping, cursor movement, text highlighting and other graphically oriented operations. This is because multiple text segments must be juggled, and for each textual segment, properties such as selected font, text position (coordinate of the Xstart and Ystart for the string), caret position, and other information must be tracked.","The object CCTextRunList illustrated in  encapsulates a list of ccTextRun objects  to manage the operations of such features, including to generate a multipart linked list object . The following procedure call is intended to create this linked list object .",{"@attributes":{"id":"p-0059","num":"0059"},"tables":{"@attributes":{"id":"TABLE-US-00009","num":"00009"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 9"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"While (Not end of text)"]},{"entry":[{},"{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"168pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"EvaluateTextCharset( );"]},{"entry":[{},"\u2002Build text run with same charset . . ."]},{"entry":[{},"\u2002new TextRun in List( . . . );"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}}},"The invention uses the technique described above to display the data in a multipart, multilanguage environment. In this case, the invention must likewise address complications to common word processing and other functions like text highlighting, text cursor placement, cursor movement, and so forth. The complexity for implementing these features is increased by the fact that the text is decomposed into multiple segments or runs. For example, to compute the extent of the text, in this embodiment the invention separately computes the extent of each segment and then adds them together.",{"@attributes":{"id":"p-0061","num":"0061"},"tables":{"@attributes":{"id":"TABLE-US-00010","num":"00010"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 10"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"SIZE GetMutilingualTextExtent(HDC hdc)"]},{"entry":[{},"{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"154pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"SIZE RetSize;"]},{"entry":[{},"For (each segment)"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"{"]},{"entry":[{},"Load font into Device Context"]},{"entry":[{},"Compute extent for segment"]},{"entry":[{},"Add the size to RetSize;"]},{"entry":[{},"Unload font"]},{"entry":[{},"}"]},{"entry":[{},"Return RetSize;"]},{"entry":[{},"}"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}}},"Because more than one font is involved in the display process, the size of the text displayed in each segment can vary considerably. Therefore, a once simple operation, such as highlighting the text, can become very involved in this embodiment. The invention therefore needs to compute the smallest rectangle that contains the whole text to assist in highlighting and other functions. To improve performance, this information is stored as part of the ccTextRunList objects , and updated during outputting to screen, printer or otherwise.","Managing the caret position and movement also requires special attention. Again this is because the text is separated into multiple segments, and the invention thus needs a function that gets the next character. In this embodiment, the invention stores a current position pointer  to the current text segment as illustrated in , as well as a set of other pointers including the illustrated begin text pointer , end of segment  pointer  (first segment illustrated but begin\/end pointers for other segments being contemplated), and end of text pointer .",{"@attributes":{"id":"p-0064","num":"0064"},"tables":{"@attributes":{"id":"TABLE-US-00011","num":"00011"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"182pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 11"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Short GetNextCharacter( )"]},{"entry":[{},"{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"154pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"If (end of segment)"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"77pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"140pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Select next segment"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"154pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"If (no more segment)"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"77pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"140pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Return End of text"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"154pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Get next character in current segment"]},{"entry":[{},"Return next character;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"182pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}}},"Once the character is returned, it is straightforward to retrieve its width using the font identified for the segment. The invention in this embodiment may process as many segments are necessary to properly encode the text for output. Different scripts may appear one or more times in the aggregate document.","Another environment of the invention relating to the Lotus Domino\u2122 Global WorkBench\u2122 illustrated in . Lotus Domino\u2122 Global WorkBench\u2122 is a tool used for the localization of Notes\u2122 databases and Web sites. It must correctly render the data stored in Notes\u2122 databases, which use a Lotus-proprietary universal character set (Lotus MultiByte Character Set, or LMBCS) that is converted to Unicode for output, no matter what the language version of the operating system used at run time. In a Notes\u2122 environment as shown, once conversion to Unicode is carried out, output font processing may be performed as described above. Alternatively, the enumerator and other modules of the invention may be configured to directly operate on the Notes\u2122-native character code.","The foregoing description of the system and method of the invention is illustrative, and variations in configuration and implementation will occur to persons skilled in the art. For example, while the output of characters has been described with respect to display on a computer monitor or printing, other types of output such as facsimile and others can be performed. The scope of the invention is accordingly intended to be limited only by the following claims."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The invention will be described with respect to the accompanying drawings, in which like numbers represent like elements.",{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 10"}]},"DETDESC":[{},{}]}
