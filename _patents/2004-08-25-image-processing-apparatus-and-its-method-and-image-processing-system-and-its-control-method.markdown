---
title: Image processing apparatus and its method, and image processing system and its control method
abstract: In a case where an image region to be processing in RGB color space and an image region to be processed in YMCK color space are mixed, if objects converted from RGB representation to YMCK representation are re-converted to RGB representation and RGB rendering is performed, the load on the system is increased, and the throughput of a printing apparatus is degraded. Accordingly, bands to be processed in the RGB color space are separated from print information inputted from a host computer, and pre-rendering is performed on the separated bands. Thereafter, bands to be processed in the YMCK color space are rendered by a rendering processing execution unit. The output order of the data of the respective bands pre-rendered in the RGB color space and that of the other bands are adjusted, and the data are sent to a printer engine.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07038815&OS=07038815&RS=07038815
owner: Canon Kabushiki Kaisha
number: 07038815
owner_city: Tokyo
owner_country: JP
publication_date: 20040825
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"p":["This is a continuation of PCT\/JP03\/03530, filed Mar. 24, 2003.","The present invention relates an image processing apparatus and its method and an image processing system and its control method, and more particularly, to image processing for performing rendering processing based on print information in accordance with a print request.","In a host computer, an application program such as a word processor or a spreadsheet operates on a basic software program such as Windows (trademark of Microsoft Corporation). In a case where printing is performed by using a printing apparatus, such application program calls a function of graphic subsystem among subsystems provided by the basic software program.","For example, the graphic subsystem, which is called a \u201cGDI\u201d (Graphic Device Interface) in the Windows system, handles processing on image information for display and\/or a printer. To absorb the difference in functions and characteristics of the respective devices such as the display and the printer, the GDI dynamically links up with a module called a device driver, to perform output processing to the respective devices.","In a module for the printer, called a printer driver, is provided with a group of functions called a \u201cDDI\u201d (Device Driver Interface), to be pre-installed in the device driver in correspondence with the capability, functions and the like of the printer. The DDI function group is arbitrarily called from the GDI by converting an API (Application Programming Interface) call by the application program into data for the device driver. In this manner, a print request from the application program is sequentially processed by the GDI via the printer driver.","When such application of the host computer outputs an image to the printing apparatus, the image is outputted from the printer driver in RGB representation for representing colors by using additive primary colors red (R), green (G) and blue (B), or YMCK representation for representing colors by using yellow (Y), magenta (M), cyan (C) and black (K) in image formation based on the subtractive processing principle.",{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 1"},"In , a rectangular object D is filled with a red grid pattern, an elliptic object D is filled with yellow, a rectangular object D is filled with a green hatching pattern, and a circular object D, filled with a blue tile pattern. When these 4 objects are processed, the printer driver generally performs processing on the objects D, D, D and D, in the order of delivery from the system. At this time, ROP (Raster OPeration) characteristic of the GDI of the Windows system exists as rendering information of the objects delivered from the system.","The ROP, which is rendering processing to perform logical operation between images, is used for designation of logical rendering of object, and is provided as ROP, ROP and ROP in correspondence with the number of the objects. The ROP designates the shape of a object, a filling pattern, and a logical operation determined mutually with respect to a destination of rendering.","The rendering of the objects D to D must be sequentially performed since in some cases, a destination as a result of immediately previous rendering is referred to in accordance with designation by the ROP. That is, unless the status of the destination as a result of rendering of the objects D to D is obtained, a proper result cannot be obtained from rendering of the object D based on the ROP.","Generally, these rendering processings are premised on monochrome image or processing in RGB color space.","The printing apparatus such as a printer, which inputs data from the host computer and performs printing, performs image processing in YMCK color space. For this purpose, as shown in , when data in mixed RGB representation and YMCK representation is inputted from the host computer, the printing apparatus converts the input RGB representation data and ROP code on the premise of RGB representation into YMCK representation data, and generates a bit image by a YMCK renderer (rendering generation device).","In a case where RGB representation data is inputted into the printing apparatus and converted to YMCK representation data, the color reproducibility of the object D which is not overlapped with the other objects, as shown in , can be approximately maintained by the performance of PDL (Page Description Language) However, regarding the objects D to D where regions S and S overlap with each other (in the case of duplication or transparency), in some cases, the validity of the image cannot be maintained even though the printing apparatus processes the above-described ROP code. This problem frequently occurs as the number of duplication is large.","Accordingly, upon rendering of object converted from RGB representation to YMCK representation, the image generating device in the printing apparatus re-converts an object having a duplication region to RGB representation again, then performs RGB rendering, then compresses the bit image and holds it, and transmits the data to a printer engine at necessary printing timing. This processing increases the load on the system and degrades the throughput of the printing apparatus.","The present invention has been made to solve the above-described problems individually or at once, and has its object to perform rendering processing on print information having mixed first image region to be processed in particular color space and second image region not to be necessarily processed in particular color space, while maintaining image validity and reproducibility and preventing degradation of throughput.","To attain the foregoing object, the present invention provides as a preferred embodiment, an image processing apparatus for forming an image based on data inputted from an external apparatus, comprising: a separator, arranged to separate a first image region to be processed in particular color space and a second image region not to be processed in particular color space, from print information accompanying a print request issued from the external apparatus; and a rendering section, arranged to perform respectively different rendering processing on print information in the separated first and second image regions.","Further, the present invention provides an image processing system having a data processing apparatus and an image processing apparatus, wherein the data processing apparatus comprising: a detector, arranged to detect a first image region to be processed in particular color space and a second image region not to be processed in particular color space, from print information; and a notifying section, arranged to notify the detected image regions to the image processing apparatus, and wherein the image processing apparatus comprising: a separator, arranged to separate print information in the first and second image regions, based on notification by the notifying section; and a rendering section, arranged to perform respectively different rendering processing on the print information in the separated first and second image regions.","Other features and advantages of the present invention will be apparent from the following description taken in conjunction with the accompanying renderings, in which like reference characters designate the same name or similar parts throughout the figures thereof.","First, a color laser-beam printer as a printing apparatus to which the present invention is applicable will be described. Note that any apparatus may be employed as a printer to which the present invention is applicable as long as it is an image forming apparatus which scans a light beam thereby forms an image, such as a copier or a facsimile apparatus. Further, the printer is not limited to a color laser-beam printer but may be a monochrome laser-beam printer and further may be other types of printers such as an ink-jet printer and a thermal printer.","[Printing Apparatus]",{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 3"},"The color printer shown in  having a resolution of 600 dpi prints a color image on a print sheet based on data representing color components respectively with 8 bits. The color printer inputs print information including print data (character code, image data and the like) and control code supplied from a host computer or the like externally connected thereto and store the input data, generates a corresponding character pattern or image in accordance with the stored data, and forms a color image on the print sheet as a recording medium.","A controller  interprets the print information supplied from the host computer, generates a print image and controls the color printer main body. An operation panel , connected to the controller , has a switch for inputting a user's instruction, a display device for notifying the user of the status of the apparatus or its operation. Note that the operation panel  is provided as a part of exterior of the color printer.","The print image generated by the controller  is outputted as a video signal VDO to an output controller . The output controller  outputs a control signal to an optical unit  and various drive system mechanisms based on status information of respective elements of the color printer inputted from various sensors (not shown), thus controls a print operation as the color printer.","The print information image-mapped by the controller  is converted into the video signal VDO and sent to a laser driver in the output controller . The laser driver drives a semiconductor laser device  in correspondence with the video signal VDO. The semiconductor laser device  outputs laser light L on\/off controlled in correspondence with the video signal VDO. The laser light L is swayed leftward and rightward directions by a polygon mirror  high-speed rotated by a scanner motor , to scan on an electrostatic drum  via an f-\u03b8 lens  and a reflection mirror .","Prior to scanning by the laser light L, an outer peripheral surface of the electrostatic drum  is approximately uniformly charged to a predetermined polarity and potential by a charger . Accordingly, an electrostatic latent image is formed on the electrostatic drum  by the scanning of the laser light L.","Respective color developers each having a rotation shaft on both ends are held by a developer selection mechanism  rotatably about the shaft. In this structure, constant positions of the respective color developer can be maintained even though the developer selection mechanism  rotates about a rotation shaft for selection of developer. When a selected developer has been moved to a developing position, a selection mechanism holding frame  is pulled by a solenoid toward the electrostatic drum  at a supporting point  as a center, then the developer selection mechanism  moves integrally with the developer toward the electrostatic drum , and developing processing is performed.","On the other hand, a print sheet P supplied from a paper feed cassette  is supplied to a transfer drum  at predetermined timing, and a front end of the print sheet P is held by a gripper . Further, to transfer a toner image on the electrostatic drum  onto the print sheet P, a transfer bias voltage having an opposite polarity to that of the toner (e.g., plus polarity) is applied to the transfer drum , and the print sheet P is electrostatically adsorbed to an outer peripheral surface of the transfer drum .","The latent image formed on the electrostatic drum  by the optical unit  is first developed by a magenta (M) developer Dm. An M toner image generated by the developing is transferred onto the print sheet P held on the outer periphery of the transfer drum . Next, an electrostatic latent image corresponding to cyan (C) is formed, and developed by a cyan (C) developer Dc. A generated C toner image is overlay-transferred on the M toner image on the print sheet P. Hereinbelow, similarly, toner images are sequentially formed and overlay-transferred on the print sheet P regarding yellow (Y) and black (K) colors. Note that when the toner image transfer has been completed, remaining toner is removed by a cleaner  from the electrostatic drum  in preparation for next latent image formation and developing.","In this manner, the 4 color toner images are overlaid on the print sheet P. Note that prior to the toner image transfer, a transfer bias voltage higher than a previous time is applied to the transfer drum . When the 4 color toner image have been overlaid on the print sheet P, a separation claw  approaches the transfer drum , then an end of the separation claw  comes into contact with the surface of the transfer drum , and the print sheet P is separated from the transfer drum . The separated print sheet P is conveyed to a fixing unit , then toner images are fixed to the print sheet, and the print sheet is discharged by a paper discharge roller  to a paper discharge tray .","The color printer of the present embodiment forms an image in 600 dpi resolution through the above image formation process.","[Controller]",{"@attributes":{"id":"p-0039","num":"0038"},"figref":"FIG. 4","b":["110","200","110"]},"A CPU  controls the controller  in a centralized manner. A ROM  is a memory which holds a program executed by the CPU , and the like. A RAM  is a work area for the CPU  and temporarily holds objects necessary for rendering and received data.","A rendering processing execution unit  reads objects from the RAM , develops an image, and stores the developed image into an image memory .","An image compression unit  compresses an image stored in the RAM  or the like, and stores the compressed image into the RAM  or the like, in accordance with the control of the CPU .","An output controller  reads the developed image stored in the image memory  or decompresses the image compressed by the image compression unit  and stored in the RAM  or the like, convert the data into a video signal, and transfers the signal to the printer engine .","Further, the host interface  controls data transfer with the host computer .","Print data of predetermined format, received from the host computer  via the host interface , is temporarily stored in the RAM , then read and processed by the CPU  in accordance with necessity. The CPU  executes the control program based on a PDL (Page Description Language) command system and a print job control language, converts the print data into object(s) based on the result of interpretation of the print data regarding printing of character and symbol, and rendering of figure and image, and stores the object into the RAM . Then, when all the data necessary for rendering have been stored into the RAM , the CPU instructs the rendering processing execution unit  to perform rendering processing.","The rendering processing execution unit  is a YMCK renderer which sequentially maps objects of characters and images in the image memory . It is necessary for a page printer such as a color laser-beam printer to transmit data, YMCK plane-sequentially, in page units. However, in the present embodiment, to reduce the capacity of the image memory , so-called banding processing is performed under the control of the CPU .","The banding processing is dividing the print content of each of YMCK planes (1 page) into plural bands thereby using the image memory  having a capacity smaller than that for 1 page. In synchronization with the processing speed of the printer engine , a band image is mapped in the image memory . For example, the image memory  is allocated to 2 bands for holding bitmap data in band units. An operation of generating bitmap data in one band memory, and an operation of outputting already-completed 1-band bitmap data from the other band memory, are alternately repeated. That is, when bitmap data is generated in one band memory, already-completed bitmap data is outputted from the other band memory.","By repeating the above processing, continuous bitmap data can be outputted. However, if a predicted period of band rendering is longer than a band printing period, the CPU  determines that it is impossible to perform the banding processing to print 1 band while rendering the next band. In such case, the CPU perform processing for proper printing, by converting the rendering resolution of print data to a lower resolution then performing rendering for whole plane (1 page) and transferring the bitmap data to the printer engine , otherwise, previously rendering only the band where the band rendering period is longer than the band printing period, then compressing and holding the data by the image compression unit (pre-rendering). Upon printing, the compressed image data, held in the image compression unit , is transferred to the printer engine  by the output controller .","[Host Computer]","The host computer  outputs print information comprising print data, control code and the like to the controller . The host computer  operates based on a basic software program (OS) such as Windows.","Regarding the software program operating on the host computer , only functional parts related to the present embodiment, briefly classified as functions operating on the OS, are an application program , a graphic subsystem , a printer interface  as an interface between the host computer and the controller .","The application program  is application software such as a word processor or a spreadsheet which operates on the OS. The graphic subsystem  has a GDI  as a part of the functions of the OS and a printer driver  as a device driver dynamically linked from the GDI. These names and functional frames may somewhat differ with OS, however, such difference in the names and frames is not a big problem in the present embodiment as long as software modules realize the respective functions. Note that generally, in the host computer  performs the respective functional modules by the OS with the hardware such as CPU, ROM, RAM, hard disk drive (HDD) and various input\/output control units (I\/O), and application programs and subsystem processes operate as functional modules under the control of the OS.","[Image Processing]",{"@attributes":{"id":"p-0052","num":"0051"},"figref":["FIG. 5","FIG. 6"],"b":["200","200"]},"When a print request to the printing apparatus is generated by the application program  of the host computer , the GDI  in the graphic subsystem  sequentially processes objects via the printer driver , as described above. Then the GDI  sets the outside shape, color information or the like of the objects in accordance with the DDI in the printer driver , and delivers information designating a band memory for rendering and print data indicating a rendering position and the like to the printer interface .","That is, the GDI  performs band dividing as shown in  (S), interprets the information of each band (S) and determines whether or not RGB representation data exists in any band (S). For example, in , the print data for 1 page is divided into 6 bands, and RGB representation data exists in bands  and . As RGB representation data exists, the GDI  adds a command indicating the existence of RGB representation data to output information of the band (S). In this manner, all the band information discriminating the bands including the RGB representation data from bands including only YMCK representation data is sent to the host interface  of the controller  via the printer interface  (S).","The controller  receives the rendering band information, and separates the bands including the RGB representation data from the other bands. Then regarding the bands including the RGB representation data, the CPU  generates objects of the RGB representation data and stores the objects into the RAM . The CPU  performs rendering processing on the bands including the RGB representation data without conversion (in RGB color space), then compresses the rendered image data by the image compression unit  and stores the data into the RAM  (S). The rendering (pre-rendering) is avoiding the banding processing only on some band, while directly handling the band by the output controller , and transmitting the data of the band to the printer engine  at necessary timing.","When the pre-rendering of the bands including the RGB representation data has been completed, the CPU  generates YMCK objects for execution of rendering of the other bands, and instructs the rendering processing execution unit  to perform rendering (S). The bands without RGB representation data are subjected to rendering in YMCK color space by the rendering processing execution unit , and mapped in the image memory  (S), and subjected to the banding processing.","Then in the respective band data rendered as RGB data, stored in the RAM , the output order is adjusted with that of the bands outputted through the banding processing, and sent by the output controller  to the printer engine  (S).","In the above-described embodiment, the data inputted from the host computer  is character code including band information or the like, a print command or print data described in the form of printer control language or the like, however, it may be arranged such that the RGB objects or YMCK objects are generated on the host computer  and outputted to the printer.","Further, in the above-described embodiment, the rendering processing execution unit  is provided as the YMCK renderer in the printing apparatus, however, a module called a RIP (Raster Image Processing) which operates in another computer may be utilized as the YMCK renderer via a network. Further, if the processing capability of the host computer  is sufficiently high or if printing is performed by a printer without renderer (rendering processor), a YMCK renderer may be provided on the host computer.","The present invention can be applied to a system constituted by a plurality of devices (e.g., a host computer, an interface, a reader and a printer) or to an apparatus comprising a single device (e.g., a copy machine or a facsimile apparatus).","Further, the object of the present invention can be also achieved by providing a program product (including storage medium holding program code, a compressed program downloaded from a server and the like) holding software program code for realizing the functions of the above-described embodiment to a system or an apparatus, and executing the program code by a computer (e.g., CPU, MPU) of the system or apparatus. In this case, the program code itself held in the program product realizes the functions according to the embodiment, and the program product or storage medium constitutes the invention. Furthermore, besides aforesaid functions according to the above embodiment are realized by executing the program code by the computer, the present invention includes a case where an OS (operating system) or the like working on the computer performs a part or entire actual processing in accordance with designations of the program code and realizes the functions according to the above embodiment.","Furthermore, the present invention also includes a case where, after the program code read from the storage medium is written in a function expansion card which is inserted into the computer or in a memory provided in a function expansion unit which is connected to the computer, CPU or the like contained in the function expansion card or unit performs a part or entire process in accordance with designations of the program code and realizes functions of the above embodiment.","As described above, according to the present invention, print information having mixed first image region to be processed in particular color space and region not to be necessarily processed in particular color space, while maintaining image validity and reproducibility and preventing degradation of throughput.","[Other Embodiment]","The present invention can be applied to a system constituted by a plurality of devices (e.g., host computer, interface, reader, printer) or to an apparatus comprising a single device (e.g., copying machine, facsimile machine).","Further, the object of the present invention can also be achieved by providing a storage medium storing program codes for performing the aforesaid processes to a computer system or apparatus (e.g., a personal computer), reading the program codes, by a CPU or MPU of the computer system or apparatus, from the storage medium, then executing the program.","In this case, the program codes read from the storage medium realize the functions according to the embodiments, and the storage medium storing the program codes constitutes the invention.","Further, the storage medium, such as a floppy disk, a hard disk, an optical disk, a magneto-optical disk, CD-ROM, CD-R, a magnetic tape, a non-volatile type memory card, and ROM can be used for providing the program codes.","Furthermore, besides aforesaid functions according to the above embodiments are realized by executing the program codes which are read by a computer, the present invention includes a case where an OS (operating system) or the like working on the computer performs a part or entire processes in accordance with designations of the program codes and realizes functions according to the above embodiments.","Furthermore, the present invention also includes a case where, after the program codes read from the storage medium are written in a function expansion card which is inserted into the computer or in a memory provided in a function expansion unit which is connected to the computer, CPU or the like contained in the function expansion card or unit performs a part or entire process in accordance with designations of the program codes and realizes functions of the above embodiments.","The present invention is not limited to the above embodiments and various changes and modifications can be made within the spirit and scope of the present invention. Therefore, to appraise the public of the scope of the present invention, the following claims are made."],"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND ART","DISCLOSURE OF THE INVENTION","BEST MODE FOR CARRYING OUT THE INVENTION"],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE RENDERINGS","p":["The accompanying renderings, which are incorporated in and constitute a part of the specification, illustrate embodiments of the invention and, together with the description, serve to explain the principles of the invention.",{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
