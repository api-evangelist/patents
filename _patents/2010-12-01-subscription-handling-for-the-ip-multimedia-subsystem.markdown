---
title: Subscription handling for the IP multimedia subsystem
abstract: Embodiments of the present invention include controlling user subscriptions within an IMS Application Server of an IP Multimedia Subsystem, IMS, network, via an Open Service Access Application Programming Interface, API, between the IMS network and a web-based application. Embodiments include subscribing a set of users by sending a start subscription message from said web-based application to the IMS network, the start subscription message including an address for each user in the set. An acknowledgement of the subscription is sent from the IMS network to said web-based application, the acknowledgement including a correlator uniquely identifying the subscribed set of users within the IMS network. A subscription for one or more users of the set is terminated by sending a stop subscription message from said web-based application to the IMS network, the stop subscription message including the address of the or each user for which the subscription is being stopped.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09037697&OS=09037697&RS=09037697
owner: TELEFONAKTIEBOLAGET LM ERICSSON (PUBL)
number: 09037697
owner_city: Stockholm
owner_country: SE
publication_date: 20101201
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"p":["This application claims the benefit of U.S. Provisional Application No. 61\/323,559, filed Apr. 13, 2010, the disclosure of which is fully incorporated herein by reference.","The present invention relates to subscription handling for the IP Multimedia Subsystem and more particularly to such subscription handling enabled by the 3GPP Open Service Access requirements.","IP Multimedia services provide a dynamic combination of voice, video, messaging, data, etc. within the same session. By growing the number of basic applications and the media which it is possible to combine, the number of services offered to the end subscribers will grow, and the inter-personal communication experience will be enriched. This will lead to a new generation of personalised, rich multimedia communication services, including so-called \u201ccombinational IP Multimedia\u201d services.","IP Multimedia Subsystem (IMS) is the technology defined by the Third Generation Partnership Project (3GPP) and ETSI TISPAN group to provide IP Multimedia services over mobile communication networks. IMS provides key features to enrich the end-subscriber person-to-person communication experience through the use of standardised IMS Service Enablers, which facilitate new rich person-to-person (client-to-client) communication services as well as person-to-content (client-to-server) services over IP-based networks. The IMS makes use of the Session Initiation Protocol (SIP) to set up and control calls or sessions between subscriber terminals (or subscriber terminals and IMS Application Servers). The Session Description Protocol (SDP), carried by SIP signalling, is used to describe and negotiate the media components of the session. Whilst SIP was created as a subscriber-to-subscriber protocol, IMS allows operators and service providers to control subscriber access to services and to charge subscribers accordingly.","By way of example,  illustrates schematically how the IMS fits into the mobile network architecture in the case of a GPRS\/PS access network (IMS can of course operate over other access networks). Call\/Session Control Functions (CSCFs) operate as SIP proxies within the IMS. The 3GPP architecture defines three types of CSCFs: the Proxy CSCF (P-CSCF) which is the first point of contact within the IMS for a SIP terminal; the Serving CSCF (S-CSCF) which provides services to the subscriber that the subscriber is subscribed to; and the Interrogating CSCF (I-CSCF) whose role is to identify the correct S-CSCF and to forward to that S-CSCF a request received from a SIP terminal via a P-CSCF.","Within the IMS service network, IMS Application Servers (ASs) are provided for implementing IMS service functionality. IMS Application Servers provide services to end users in an IMS system, and may be connected either as end-points over the 3GPP defined Mr interface, or \u201clinked in\u201d by an S-CSCF over the 3GPP defined ISC interface. In the latter case, Initial Filter Criteria (IFC) are used by an S-CSCF to determine which Applications Servers should be \u201clinked in\u201d during a SIP Session establishment (or indeed for the purpose of any SIP method, session or non-session related). The IFCs are received by the S-CSCF from an HSS during the IMS registration procedure as part of a subscriber's Subscriber Profile.","An example IMS service that is facilitated by the use of ASs is that of Multimedia Telephony (MMTel). MMTel allows a single SIP session to control virtually all MMTel supplementary services and MMTel media. All available media components can be easily accessed or activated within the session. Employing a single session for all media parts means that no additional sessions need to be set up to activate video, to add new users, or to start transferring a file.","The provision of new IMS-based services by network operators and third party service providers has conventionally required a detailed technical knowledge of SIP and IMS protocols and network architectures. In order to simplify this process, and therefore increase the range of IMS services and the speed with which they can be introduced, the Third Generation Partnership Project (commonly known as 3GPP) has been working on a so-called Open Service Access (OSA) architecture. The object of the OSA work has been to provide a set of (sometimes freely available) Application Programming Interfaces (APIs) that will allow systems developer that are unfamiliar with the IMS\/SIP architecture and standards to develop applications that can make use of the IMS network and its services. These APIs can be considered relatively high level abstractions of the underlying mechanisms and as such should be simple to use. The APIs are often referred to as \u201chandlers\u201d.","To date, 3GPP has described a number of such APIs (currently 22). These are specified in 3GPP TS 29.199-3 V8.2.0 and all are based on Parlay X. Parlay X is a set of Web service APIs specified by a group including 3GPP and ETSI. The OSA APIs can be used in interactions between an IMS Application Server and a \u201cnorth bound\u201d value added service server (hereafter referred to as \u2018VAS\u2019). The OSA APIs are intended to be powerful but nonetheless easy to use. A designer of a VAS service does not have to learn the details of SIP or IMS to be able to design services for such environments.","By way of example, the OSA architecture may be used to implement a \u201cclick to call\u201d service, whereby a user initiates a call between himself\/herself and a third party by clicking a link on a web page. The request is routed, via the Internet, to the VAS which instructs an MMTel AS, using the appropriate OSA API (e.g. \u201cMakeCallSession\u201d, with the addresses of the peer users as argument) to set up the call between the parties. In practice, the MMTel AS will send a SIP INVITE to the initiator's IMS enabled terminal. When the user answers the call, connection to the peer user is initiated over the IMS network.","The \u2018CallNotification\u2019 API (TS 29.199-3) describes in \u2018CallNotificationManager\u2019 a subscription handler to be used between an IMS system and the VAS. Such a subscription may be used, for example, to alert the VAS of incoming calls directed to a particular user, where the VAS determines a call handling procedure on behalf of the MMTel. The VAS starts a subscription by sending a \u2018StartCallNotificationRequest\u2019 handler. This API contains a unique reference for the subscription and may include several user addresses (typically URIs) in one request. The AS handling the subscription acknowledges the request to the VAS, providing the VAS with a \u201ccorrelator\u201d identifying the particular subscription. When an event occurs in the IMS that matches the subscription, an appropriate notification is sent over Parlay X to the VAS. The VAS may then act on the notification and send action instructions to the IMS. The subscription is ended by sending a \u2018StopCallNotificationRequest\u2019 from VAS to IMS, the message including as argument the appropriate correlator.","One of the problems with the currently described functionality in OSA subscription handling is the way a subscription is stopped. The stop handler only contains the unique \u2018correlator\u2019 that is created at the start of the subscription. Since OSA subscriptions are not refreshed, one can assume that a subscription is started at provisioning time of users in VAS, i.e. all users provisioned within a certain time frame (e.g. each day) are sent in one subscription. [The only thing in common for these users may be the time of provisioning.]","A subscription should act as a \u2018trigger\u2019 in the AS for a user with an active OSA subscription. Therefore, the subscription must be tied to the user data in the AS. The AS needs functionality to step through the users in the subscription and update user data for these users. The AS must also save the pointer between the unique correlator for the subscription and the users that the correlator it is applicable to. When, later, a \u2018StopCallNotificationRequest\u2019 is received with only the correlator as argument, the AS must find the pointer to which users it is applicable and update user data. This subscription termination process is illustrated in , for a subscription made in respect of a set of three users. A function is provided within the IMS to perform a mapping between correlators and respective sets of user addresses","Since in general it will be only a common subscription time that ties a group of users together, it is difficult to envisage an event that should trigger a de-subscription of the same group of users. Therefore, in order to allow de-subscribe of individual users, it is likely that real-world implementations of the proposed OSA architecture will include within a \u2018StartCallNotificationRequest\u2019 message only a single subscriber address, rather than a set of such addresses. Nonetheless, such implementations will still require within the IMS, functionality to point from a correlator (included in the StopCallNotificationRequest) to a user. This approach is inefficient not least because it requires one subscription message to be sent from the VAS to an AS for each and every subscriber.","Whilst the OSA architecture has to date specified only Parlay X based APIs, it is likely that in the future further handlers will be specified using other Web service interfaces. Examples of alternative possible Web service interfaces include those based upon Representational State Transfer (REST) and OneAPI. However, without adaptation of the core OSA principles, handlers using such alternative Web service interfaces would suffer from the problems discussed above.","It is an object of the present invention to address and overcome the problems identified in the Open Service Access architecture and which relate to IMS subscription handling.","According to a first aspect of the present invention there is provided a method of controlling user subscriptions within an IMS Application Server of an IP Multimedia Subsystem, IMS, network, via an Open Service Access Application Programming Interface, API, between the IMS network and a web-based application. The method comprises subscribing a set of users by sending a start subscription message from said web-based application to the IMS network, the start subscription message including an address for each user in the set. An acknowledgement of the subscription is sent from the IMS network to said web-based application, the acknowledgement including a correlator uniquely identifying the subscribed set of users within the IMS network. A subscription for one or more users of the set is terminated by sending a stop subscription message from said web-based application to the IMS network, the stop subscription message including the address of the or each user for which the subscription is being stopped.","According to a second aspect of the present invention there is provided a web server for controlling user subscriptions within an IMS Application Server of an IP Multimedia Subsystem, IMS, network, via an Open Service Access Application Programming Interface, API, between the IMS network and the web server. The web server comprises a subscription setting unit for subscribing a set of users by sending a start subscription message from said web server to the IMS network, the start subscription message including an address for each user in the set, and for receiving an acknowledgement of the subscription from the IMS network, the acknowledgement including a correlator uniquely identifying the subscribed set of users. The web server further comprises a subscription unsetting unit for terminating a subscription for one or more users of the set by sending a stop subscription message to the IMS network, the stop subscription message including the address of the or each user for which the subscription is being stopped.","According to a third aspect of the present invention there is provided apparatus configured to act as an Open Service Access Application Programming Interface, API, between an IMS network and a web-based application. The apparatus comprises an interface unit for interfacing to said web based application using said Open Service Access API, and a first receiving unit for receiving a start subscription message over said interface, the message identifying a set of users to be subscribed in the IMS network, and for subscribing the set of users in the IMS. The apparatus further comprises a sending unit for sending an acknowledgement of the subscription over said interface to said web-based application, the acknowledgement including a correlator uniquely identifying the subscribed set of users within the IMS network, and a second receiving unit for receiving a stop subscription message over said interface, the stop subscription message including the address of the or each user for which the subscription is being stopped, and for stopping the subscription in the IMS for those users identified by the included addresses.","It is proposed here to include within the Parlay X message StopCallNotificationRequest, sent from a server hosting a control application to a Parlay X gateway residing in an IP Multimedia Subsystem network, an address for the or each subscriber for which a Parlay X subscription is to be stopped. The receiving Parlay X gateway parses the message to determine the address(es) and initiates termination of the associated subscription(s).","The Parlay X gateway may be implemented within an IMS Application Server within which the subscription is maintained. Alternatively, the Gateway may be implemented within a separate network entity interposed between the server hosting the control application and an IMS Application Server.","In addition to the subscriber address(es), the message may include a correlator associated with a group subscription, where the Parlay X gateway maintains a mapping between the correlator and the subscriber addresses within the group. In this way, the address(es) contained in the message may comprise all of the addresses within the group or a subset of those addresses.","Further entities (\u201cnodes\u201d) may be interposed between the server hosting the control application (that is a \u201cvalue added server\u201d) and the Parlay X gateway. For example, a distribution function may be located between the two entities for the purpose of interfacing a value added server to a plurality of IMS Application Servers. A security gateway may also, or alternatively, be located on this interface, e.g. in order to handle VASes in untrusted networks.","The approach described here may be implemented using a server that hosts a control application, e.g. a value added server (VAS), and comprises a Parlay X interface towards the Parlay X gateway. The Parlay X interface in turn comprises a message handler for constructing said StopCallNotificationRequest message, such that the message includes one or more addresses for which the Parlay X subscription is to be stopped.","A Parlay X gateway may be used and which comprises a Parlay X interface towards the server hosting a control application. This Parlay X interface in turn comprises a receiver for receiving a StopCallNotificationRequest message and for parsing the message to determine subscriber addresses which it contains. The interface further comprises a subscription termination unit for terminating or initiating termination of Parlay X subscriptions associated with those addresses.","The Parlay X gateway may be implemented within an IMS Application Server, implemented in a network entity together with some other functionality, or implemented within a standalone network entity.","The 3GPP Open Service Access (OSA) architecture has been considered above. It has also been noted that OSA has specified a set of Parlay X based APIs or \u201chandlers\u201d in TS 29.199-3 V8.2.0. With reference to , these OSA APIs will allow web servers to interact with the IMS Application Servers (ASs) residing in the IMS Service Network.","TS 29.199-3 V8.2.0 describes in particular an OSA API that allows a web-based application to subscribe to IMS user notifications. This API would allow, for example, a web-based server to receive notifications of an incoming call for a subscribed user, and possibly implement an Intelligent Network (IN) type service such as call forwarding. This Parley X based API comprises a message for starting the subscription referred to as \u2018StartCallNotificationRequest\u2019. The message is defined as:",{"@attributes":{"id":"p-0036","num":"0035"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"4"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"84pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"133pt","align":"left"}}],"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}},{"entry":["Part name","Part type","Optional","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Reference","common:SimpleReference","No","Notification endpoint definition"]},{"entry":["Addresses","xsd:anyURI","No","Party addresses to receive notifications on."]},{"entry":[{},"[1 . . . unbounded]",{},"The address type\/direction is determined by"]},{"entry":[{},{},{},"the AddressDirection. If the"]},{"entry":[{},{},{},"AddressDirection part is not populated this"]},{"entry":[{},{},{},"is for notifications on called party"]},{"entry":[{},{},{},"addresses."]},{"entry":["Criteria","CallEvents","Yes","List of Call Event values to generate"]},{"entry":[{},"[0 . . . unbounded]",{},"notification. All event values are supported"]},{"entry":[{},{},{},"on the CallNotification manager interface."]},{"entry":["Addressdirection","AddressDirection","Yes","Determine if the address considered is"]},{"entry":[{},{},{},"\u201ccalled\u201d or \u201ccalling\u201d."]},{"entry":[{},{},{},"It applies for all the addresses."]},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}}]}}}}},"This message is sent by the web-based application (referred to hereinafter as a Value Added Server or VAS) to the IMS application server (AS), for example at registration of a user or users with a web-based service supported by the VAS. The VAS is of course provided with a Parlay X interface, whilst a Parlay X gateway is either installed into the IMS AS or is provided as a separate node between the IMS AS and the web interface. The interface between the Parlay X gateway and the IMS AS may be SIP based or some other internal protocol supported by the AS. In response to receipt of the StartCallNotificationRequest, the IMS AS returns to the VAS, via the Parlay X gateway, a StartCallNotificationResponse message. This message includes a \u201cCorrelator\u201d value that uniquely identifies the subscription in the IMS AS.","Once a subscription has been made, the VAS is able to terminate the subscription via the same API, using the message termed \u2018StopCallNotificationRequest\u2019. This message is currently defined in TS 29.199-3 V8.2.0 as:",{"@attributes":{"id":"p-0039","num":"0038"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"63pt","align":"left"}}],"thead":{"row":[{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]},{"entry":[{},"Part name","Part type","Optional","Description"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Correlator","xsd:string","No","Correlator of"]},{"entry":[{},{},{},{},"request to end"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]}]}}}}},"The Correlator is that value previously returned to the VAS by the IMS AS in the StartCallNotificationResponse. It is proposed here to change this message to the following:",{"@attributes":{"id":"p-0041","num":"0040"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"4"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"84pt","align":"left"}}],"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}},{"entry":["Part name","Part type","Optional","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Correlator","xsd:string","No","Correlator of request to"]},{"entry":[{},{},{},"end. In case the correlator"]},{"entry":[{},{},{},"is used to control the"]},{"entry":[{},{},{},"subscription, then"]},{"entry":[{},{},{},"\u2018*\u2019 should be given as"]},{"entry":[{},{},{},"\u2018Addresses\u2019"]},{"entry":["Addresses","xsd:anyURI","Yes","Party addresses to stop"]},{"entry":[{},"[1 . . . unbounded]",{},"notifications on."]},{"entry":[{},"Or \u2018*\u2019 (all)"]},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}}]}}}}},"As well as including the Correlator, the modified StopCallNotificationRequest message includes one or more addresses (that is URIs) identifying the users to which the message relates. As will be readily apparent, the VAS may include in the \u201cAddresses\u201d argument only the address(es) that is (are) to be stopped. This change opens up the possibility to end a subscription on a per user (address) basis, without relying upon the Correlator. This change is partly backward compatible as a legacy IMS AS receiving such a handler can merely ignore the user addresses and act on the Correlator.","If the StopCallNotificationRequest message is modified to include the individual user addresses, it is still necessary for the IMS network to parse the request and find the relevant users. There is no longer a need however to store the mapping between a \u2018correlator\u2019 and a set of users in the IMS. This will significantly simplify implementation of the OSA subscription handling within the IMS, and improve de-subscription handling. The modified architecture is illustrated schematically in . Whilst the architecture includes a \u201cdistributor\u201d, this is merely responsible for (transparently) routing the StopCallNotificationRequest message to the correct user or users, assuming that users are distributed across multiple IMS ASs within the IMS (in the example of , all users associated with the same AS).","In some implementations, when processing a StopCallNotificationRequest handler, the IMS network may continue to make use of the Correlator in addition to the user addresses themselves. For example, this may be desirable where a plurality of VASs are operated with the same IMS system, in which case the correlator may be stored with the user data in the IMS AS in order to find the correct VAS instance.",{"@attributes":{"id":"p-0045","num":"0044"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0046","num":"0045"},"b":"100"},{"@attributes":{"id":"p-0047","num":"0046"},"b":"200"},{"@attributes":{"id":"p-0048","num":"0047"},"b":"300"},{"@attributes":{"id":"p-0049","num":"0048"},"b":"400"},{"@attributes":{"id":"p-0050","num":"0049"},"b":"500"},{"@attributes":{"id":"p-0051","num":"0050"},"b":"600"},{"@attributes":{"id":"p-0052","num":"0051"},"b":"700"},{"@attributes":{"id":"p-0053","num":"0052"},"b":"800"},{"@attributes":{"id":"p-0054","num":"0053"},"b":"900"},{"@attributes":{"id":"p-0055","num":"0054"},"b":"1000"},{"@attributes":{"id":"p-0056","num":"0055"},"figref":"FIG. 5","b":["10","10","11","12"]},"An interface unit  for interfacing to the web based application using the Open Service Access API.","A first receiving unit  for receiving a start subscription message over the interface, the message identifying a set of users to be subscribed in the IMS network, and for subscribing the set of users in the IMS.","A sending unit  for sending an acknowledgement of the subscription over the interface  to said web-based application, the acknowledgement including a correlator uniquely identifying the subscribed set of users within the IMS network.","A second receiving unit  for receiving a stop subscription message over the interface , the stop subscription message including the address of the or each user for which the subscription is being stopped, and for stopping the subscription in the IMS for those users identified by the included addresses.",{"@attributes":{"id":"p-0061","num":"0060"},"figref":"FIG. 6","b":["1","2","3","4","1","5","1","6"]},"It will be appreciated by the person of skill in the art that various modifications may be made to the above described embodiment without departing from the scope of the present invention. For example, rather than being a ParlayX API, the Open Service Access API may be one of a Representational State Transfer (REST) or a GSMA OneAPI based API."],"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0031","num":"0030"},"figref":["FIG. 4","FIG. 3"]},{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
