---
title: System and method for providing persistent node names
abstract: A system and method for providing persistent node names is provided. The system and method stores the node name associated with a given storage system in the root volume associated with the storage system. Thus various components of the storage appliance may be modified without changing the node name associated with a given storage system. This enables clients to have a consistent and persistent node name to connect to in a given network environment.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08015266&OS=08015266&RS=08015266
owner: NetApp, Inc.
number: 08015266
owner_city: Sunnyvale
owner_country: US
publication_date: 20030207
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF AN ILLUSTRATIVE EMBODIMENT"],"p":["The present invention relates to storage systems and, particularly to storage systems operating on a Fibre Channel network.","A storage system is a computer that provides storage service relating to the organization of information on writable persistent storage devices, such as memories, tapes or disks. The storage system is commonly deployed within a storage area network (SAN) to or a network attached storage (NAS) environment. When used within a NAS environment, the storage system may be embodied as a file server including an operating system that implements a file system to logically organize the information as a hierarchical structure of directories and files on, e.g. the disks. Each \u201con-disk\u201d file may be implemented as a set of data structures, e.g., disk blocks, configured to store information, such as the actual data for the file. A directory, on the other hand, may be implemented as a specially formatted file in which information about other files and directories are stored.","The file server, or filer, may be further configured to operate according to a client\/server model of information delivery to thereby allow many client systems (clients) to access shared resources, such as files, stored on the filer. Sharing of files is a hallmark of a NAS system, which is enabled because of its semantic level of access to files and file systems. Storage of information on a NAS system is typically deployed over a computer network comprising a geographically distributed collection of interconnected communication links, such as Ethernet, that allow clients to remotely access the information (files) on the filer. The clients typically communicate with the filer by exchanging discrete frames or packets of data according to pre-defined protocols, such as the Transmission Control Protocol\/Internet Protocol (TCP\/IP).","In the client\/server model, the client may comprise an application executing on a computer that \u201cconnects\u201d to the filer over a computer network, such as a point-to-point link, shared local area network, wide area network or virtual private network implemented over a public network, such as the Internet. NAS systems generally utilize file-based access protocols; therefore, each client may request the services of the filer by issuing file system protocol messages (in the form of packets) to the file system over the network identifying one or more files to be accessed without regard to specific locations, e.g., blocks, in which the data are stored on disk. By supporting a plurality of file system protocols, such as the conventional Common Internet File System (CIFS), the Network to File System (NFS) and the Direct Access File System (DAFS) protocols, the utility of the filer may be enhanced for networking clients.","A SAN is a high-speed network that enables establishment of direct connections between a storage system and its storage devices. The SAN may thus be viewed as an extension to a storage bus and, as such, an operating system of the storage system enables access to stored information using block-based access protocols over the \u201cextended bus\u201d. In this context, the extended bus is typically embodied as Fibre Channel (FC) or Ethernet media adapted to operate with block access protocols, such as Small Computer Systems Interface (SCSI) protocol encapsulation over FC or TCP\/IP\/Ethernet.","A SAN arrangement or deployment allows decoupling of storage from the storage system, such as an application server, and some level of information storage sharing at the application server level. There are, however, environments wherein a SAN is dedicated to a single server. In some SAN deployments, the information is organized in the form of databases, while in others a file-based organization is employed. Where the information is organized as files, the client requesting the information maintains file mappings and manages file semantics, while its requests (and server responses) address the information in terms of block addressing on disk using, e.g., a logical unit number (lun).","Fibre Channel is a set of related protocols that defines a transport mechanism for data over a network. Each Fibre Channel device (e.g., a storage adapter) connected to a network has a world wide name (WWN) comprising a node name. Typically, the node name is hard wired into the device so that it may not be modified. As each device connected to a Fibre Channel network has a unique node name, this hard encoding of the node name prevents duplicate node names from appearing on the same Fibre Channel switching fabric, which can lead to routing errors and data loss.","A noted disadvantage of the conventional hard encoding of the node name is that should a storage system be replaced, the clients of that system need to update their internal contact information as the new storage system will have a different node name. Similarly, if a storage system that is serving data to a set of original clients is taken offline and then reactivated, but with a differing set of volumes of data, the original clients may subsequently direct data access requests to the incorrect storage system. A \u201cvolume\u201d is a cluster of physical storage devices that define an overall logical arrangement of storage space. Furthermore, if storage systems are configured as partners of a cluster and a failover situation arises such that a functioning cluster partner assumes control of the disks and manages data access requests of a failed cluster partner, a new node name will appear to be associated with that failed partner. Such a failover situation is described in U.S. Pat. No. 7,260,737, entitled SYSTEM AND METHOD FOR TRANSPORT-LEVEL FAILOVER OF FCP DEVICES IN A CLUSTER, by Arthur Lent, et al., issued on Aug. 21, 2007, the contents of which are hereby incorporated by reference.","The disadvantages described above are more noticeable when individual network interface controllers (NICs) or host bus adapters (HBAs) of a given storage system are replaced or swapped. As node names are often assigned to certain HBAs or NICs, the changing of a HBA\/NIC results in a modified node name for a given storage system. A similar problem arises when a HBA\/NIC is then moved from an original storage system to a second storage system. Clients of the original storage system thereafter direct their data access requests to the second storage system, which is not adapted to accept or process these data access requests.","Thus, use of conventional, hard-coded, WWNs as node names in various network configurations may result in additional client-side configuration issues to manage in order to permit the clients to continue to properly access data stored on a storage system. Such client-side configuration is rather burdensome and, therefore, undesirable.","The disadvantages of the prior art are overcome by providing a system and method for providing persistent node names in a storage system. By \u201cpersistent\u201d it is meant node names that do not change when storage system hardware is removed and\/or modified. To enable modifications or changes to its hardware configuration, the storage system records the node name in the root volume of the storage system. The root volume of the storage system is the principal volume associated with the storage system. This node name, which in one embodiment of the present invention is generated from the storage system's Non-Volatile Random Access Memory (NVRAM) serial number, is programmed into the HBA or NIC of the storage system.","By storing the node name in the root volume of the storage system, any of the hardware associated with the storage system, except the root volume, may be replaced or modified without affecting the node name associated with the storage system. This enables clients of a storage system to continue to access the storage system by using the persistent node name without referring to its internal routing\/directory information.","Upon initialization, the storage system searches for a node name stored in its root volume. This node name may be, for example, stored in a configuration file located within the root volume. Upon discovering the node name, the storage system sets its node name to the discovered Node name and continues with its initialization process. However, if the storage system does not find a node name in the root volume, it generates a WWN\/node name based on the NVRAM serial number. The generated WWN\/node name is then set to the storage system's node name and is stored in the root volume for later use.","Alternately, and upon logging into a Fibre Channel (FC) switching fabric, a storage system connects to a FC name server to determine whether there is a conflicting node name connected to the switching fabric. If there is a conflicting node name connected to the switching fabric, then the storage system disconnects from the fabric and alert an administrator that there is an error condition. If there is no conflict, the storage system proceeds with its normal initialization routine.","A. Network Environment",{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 1","b":["100","100","102","106","108","200","200","104"]},"A client  may be a general-purpose computer, such as a PC or a workstation, or a special-purpose computer, such as an application server, configured to execute applications over an operating system that includes block access protocols. In this illustrative embodiment, Red storage system  and Blue storage system  are connected as two nodes of a storage system cluster. These storage systems, described further below, are storage appliances configured to control storage of, and access to, interconnected storage devices. Connected to each of the storage systems  is one or more storage devices  that form a root volume of the storage system. The root volume of a storage system is the principal volume associated with a given storage system. In the illustrative embodiment, the storage system stores its configuration information in its root volume. Each of the devices attached to the switching network  includes an appropriate conventional network interface arrangement (not shown) for communicating over the switching network , or through the switches  and , using a set of desired block access protocols such as Small Computer System Interface (SCSI) encapsulated over Fibre Channel (FCP).","Also connected to the switching network  is a FC Nameserver . The Nameserver  is a special-purpose server adapted to track node names connected to the switching network . The nameserver also responds to inquiry commands from devices connected to the FC switching network.","Connecting the Red and Blue storage systems  is a cluster interconnect , which provides a direct communication link between the two storage systems. The cluster interconnect can be of any suitable communication medium, including, for example, an Ethernet connection.","It should be noted that the storage systems  are shown in a cluster configuration for exemplary purposes only. The teachings of the present invention may be utilized when the storage systems are configured in any network configuration, including, for example, a single storage system connected to a Fibre Channel switching network.","B. Storage Appliance",{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 2","b":["200","100","200","205","215","225","225","220","230","200","300"],"i":["a","b "]},"Whereas clients of a NAS-based network environment have a storage viewpoint of files, the clients of a SAN-based network environment have a storage viewpoint of blocks or disks. To that end, the multi-protocol storage appliance  presents (exports) disks to SAN clients through the creation of logical unit numbers (luns) or vdisk objects. A vdisk object (hereinafter \u201cvdisk\u201d) is a special file type that is implemented by the virtualization function and translated into an emulated disk as viewed by the SAN clients. Such vdisks objects are further described in U.S. patent application Ser. No. 10\/216,453 entitled STORAGE VIRTUALIZATION BY LAYERING VIRTUAL DISK OBJECTS ON A FILE SYSTEM, by Vijayan Rajan, et al., now issued as U.S. Pat. No. 7,107,385 on Feb. 12, 2004, the contents of which are incorporated herein by reference. The multi-protocol storage appliance thereafter makes these emulated disks accessible to the SAN clients through controlled exports, as described further herein.","In the illustrative embodiment, the memory  comprises storage locations that are addressable by the processor and adapters for storing software program code and data structures associated with the present invention. The processor and adapters may, in turn, comprise processing elements and\/or logic circuitry configured to execute the software code and manipulate the data structures. The storage operating system , portions of which are typically resident in memory and executed by the processing elements, functionally organizes the storage appliance by, inter alia, invoking storage operations in support of the storage service implemented by the appliance. It will be apparent to those skilled in the art that other processing and memory means, including various computer readable media, may be used for storing and executing program instructions pertaining to the inventive system and method described herein.","The network adapters and couple the storage appliance to a plurality of clients over point-to-point links, wide area networks (WAN), virtual private networks (VPN) implemented over a public network (Internet) or a shared local area network (LAN) or any other acceptable networking architecture.","The network adapters also couple the storage appliance  to a plurality of clients  that may be further configured to access the stored information as blocks or disks. For this SAN-based network environment, the storage appliance is coupled to an illustrative Fibre Channel (FC) switching network . The network adapters  may comprise a FC host bus adapter (HBA) having the mechanical, electrical and signaling circuitry needed to connect the storage appliance  to a SAN network switch, such as a conventional FC switch. In addition to providing FC access, the FC HBA may offload Fibre Channel network processing operations from the storage appliance's processor.","The clients may be general-purpose computers configured to execute applications over a variety of operating systems, including the UNIX\u00ae and Microsoft\u00ae Windows\u2122 operating systems.","The clients generally utilize block-based access protocols, such as the Small Computer System Interface (SCSI) protocol, when accessing information (in the form of blocks, disks or vdisks) over a SAN-based network. SCSI is a peripheral input\/output (I\/O) interface with a standard, device independent protocol that allows different peripheral devices, such as disks, to attach to the storage appliance . In SCSI terminology, clients  operating in a SAN environment are initiators that initiate requests and commands for data. The multi-protocol storage appliance is thus a target configured to respond to the requests issued by the initiators in accordance with a request\/response protocol.","In accordance with the FC protocol, initiators and targets have three unique identifiers, a node name, a port name and a device identifier. The node name and port name are \u201cworldwide\u201d unique. A device identifier is assigned dynamically by the FC port that it is attached to and is unique within a given FC switching fabric. In accordance with the Fibre Channel specification, a node name is a 8 byte long value that identifies each device connected to a Fibre Channel switching network. Node names are further described in ANSI Standard X3.230-1994 for Fibre Channel Physical and signaling Interface (FC-PH), the contents of which are hereby incorporated by reference. Each device connected to a Fibre Channel switching network logs into the network using its world wide unique node name.","The appliance  supports various SCSI-based protocols used in SAN deployments, including SCSI encapsulated over TCP (iSCSI) and SCSI encapsulated over FC (FCP). The initiators (hereinafter clients ) may thus request the services of the target (hereinafter storage appliance ) by issuing iSCSI and\/or FCP messages over the network  to access information stored on the disks. It will be apparent to those skilled in the art that the clients may also request the services of the integrated storage appliance using other block access protocols. By supporting a plurality of block access protocols, the storage appliance provides a unified and coherent access solution to vdisks\/luns in a heterogeneous SAN environment.","The storage adapter  cooperates with the storage operating system  executing on the storage appliance to access information requested by the clients. The information may be stored on the disks or other similar media adapted to store information. The storage adapter includes I\/O interface circuitry that couples to the disks over an I\/O interconnect arrangement, such as a conventional high-performance, FC serial link or loop topology. The information is retrieved by the storage adapter and, if necessary, processed by the processor  (or the adapter  itself) prior to being forwarded over the system bus  to the network adapters and , where the information is formatted into packets or messages and returned to the clients.","Storage of information on the multi-protocol storage appliance  is, in the illustrative embodiment, implemented as one or more storage volumes that comprise a cluster of physical storage disks, defining an overall logical arrangement of disk space. The disks within a volume are typically organized as one or more groups of Redundant Array of Independent (or Inexpensive) Disks (RAID). RAID implementations enhance the reliability\/integrity of data storage through the writing of data \u201cstripes\u201d across a given number of physical disks in the RAID group, and the appropriate storing of redundant information with respect to the striped data. The redundant information enables recovery of data lost when a storage device fails.","Specifically, each volume is constructed from an array of physical disks that are organized as RAID groups. The physical disks of each RAID group include those disks configured to store striped data and those configured to store parity for the data, in accordance with an illustrative RAID 4 level configuration. However, other RAID level configurations (e.g. RAID 5) are also contemplated. In the illustrative embodiment, a minimum of one parity disk and one data disk may be employed. Yet, a typical implementation may include three data and one parity disk per RAID group and at least one RAID group per volume.","To facilitate access to the disks, the storage operating system  implements a write-anywhere file system that cooperates with virtualization system code to provide a function that \u201cvirtualizes\u201d the storage space provided by disks. The file system logically organizes the information as a hierarchical structure of directory and file objects (hereinafter \u201cdirectories\u201d and \u201cfiles\u201d) on the disks. Each \u201con-disk\u201d file may be implemented as set of disk blocks configured to store information, such as data, whereas the directory may be implemented as a specially formatted file in which names and links to other files and directories are stored. The virtualization function allows the file system to further logically organize information as vdisks on the disks, thereby providing an integrated NAS and SAN appliance approach to storage by enabling file-based (NAS) access to the files and directories, while further enabling block-based (SAN) access to the vdisks on a file-based storage platform.","In the illustrative embodiment, the storage system  also includes a Non-Volatile Random Access Memory (NVRAM) . The NVRAM is used, during normal storage system operation, for various data integrity functions. The NVRAM  also includes, in the illustrative embodiment, a serial number  that uniquely identifies each storage system.","C. Storage Operating System","In the illustrative embodiment, the storage operating system is the NetApp\u00ae Data ONTAP\u2122 operating system available from Network Appliance, Inc., Sunnyvale, Calif. that implements a Write Anywhere File Layout (WAFL\u2122) file system. However, it is expressly contemplated that any appropriate storage operating system, including a write in-place file system, may be enhanced for use in accordance with the inventive principles described herein. As such, where the term \u201cWAFL\u201d is employed, it should be taken broadly to refer to any storage operating system that is otherwise adaptable to the teachings of this invention.","As used herein, the term \u201cstorage operating system\u201d generally refers to the computer-executable code operable on a computer that manages data access and may, in the case of a storage appliance, implement data access semantics, such as the Data ONTAP storage operating system, which is implemented as a microkernel. The storage operating system can also be implemented as an application program operating over a general-purpose operating system, such as UNIX\u00ae or Windows NT\u00ae, or as a general-purpose operating system with configurable functionality, which is configured for storage applications as described herein.","In addition, it will be understood to those skilled in the art that the inventive technique described herein may apply to any type of special-purpose (e.g., storage serving appliance) or general-purpose computer, including a standalone computer or portion thereof, embodied as or including a storage system. Moreover, the teachings of this invention can be adapted to a variety of storage system architectures including, but not limited to, a network-attached storage environment, a storage area network and disk assembly directly-attached to a client or host computer. The term \u201cstorage system\u201d should therefore be taken broadly to include such arrangements in addition to any subsystems configured to perform a storage function and associated with other equipment or systems.",{"@attributes":{"id":"p-0044","num":"0043"},"figref":"FIG. 3","b":["300","310","312","314","316","318","320","322","324","326","318"]},"An iSCSI driver layer  provides block protocol access over the TCP\/IP network protocol layers, while a FC driver layer  operates to receive and transmit block access requests and responses to and from the integrated storage appliance. The FC and iSCSI drivers provide FC-specific and iSCSI-specific access control to the luns (vdisks) and, thus, manage exports of vdisks to either iSCSI or FCP or, alternatively, to both iSCSI and FCP when accessing a single vdisk on the multi-protocol storage appliance. In addition, the storage operating system includes a disk storage layer  that implements a disk storage protocol, such as a Redundant Array of Independent Disks (RAID) protocol, and a disk driver layer  that implements a disk access protocol such as, e.g., a SCSI protocol.","Bridging the disk software layers with the integrated network protocol stack layers is a virtualization system  that is implemented by a file system  interacting with virtualization software embodied as, e.g., a vdisk module  and SCSI target module . The vdisk module  manages SAN deployments by, among other things, implementing a comprehensive set of vdisk (lun) commands that are converted to primitive file system operations (\u201cprimitives\u201d) that interact with the file system  and the SCSI target module  to implement the vdisks. It should be noted that the SCSI target module  and file system  may be implemented as hardware, software, firmware or any combination thereof.","The SCSI target module , in turn, initiates emulation of a disk or lun by providing a mapping procedure that translates luns into the special vdisk file types. The SCSI target module is illustratively disposed between the iSCSI and FC drivers ,  and the file system  to thereby provide a translation layer of the virtualization system  between the SAN block (lun) space and the file system space, where luns are represented as vdisks. By \u201cdisposing\u201d SAN virtualization over the file system , the multi-protocol storage appliance reverses the approaches taken by prior systems to thereby provide a single unified storage platform for essentially all storage access protocols.","The file system  illustratively implements the Write Anywhere File Layout (WAFL) file system having an on-disk format representation that is block-based using, e.g., 4 kilobyte (kB) blocks and using inodes to describe the files. A further description of the structure of the file system, is provided in U.S. Pat. No. 5,819,292, entitled METHOD FOR MAINTAINING CONSISTENT STATES OF A FILE SYSTEM AND FOR CREATING USER-ACCESSIBLE READ-ONLY COPIES OF A FILE SYSTEM by David Hitz et al., issued Oct. 6, 1998, which patent is hereby incorporated by reference as though fully set forth herein.","The storage operating system  further includes, in the illustrative embodiment, a cluster failover layer  that implements various failover features including initiating a failover. The cluster failover layer , in the illustrative embodiment, monitors the cluster interconnect for heartbeat signals.","D. Persistent Node Names","In accordance with the Fibre Channel specification, a device connected to the Fibre Channel switching network utilizes its node name when logging into the FC network. Thus, during the initialization procedure of a storage system and before the storage logs into the FC network, the node name is assigned. In accordance with the present invention, node names remains persistent across hardware changes to a storage appliance serving a specific set of resources. The storage appliance illustratively stores its node name in a predetermined location of the root volume associated with the storage, appliance. The node name may be stored in a special configuration file located within the root volume or may, in alternate embodiments, be appended to another storage appliance configuration file located within the root volume.",{"@attributes":{"id":"p-0051","num":"0050"},"figref":"FIG. 4","b":["400","400","405","410","415","420","425","430"]},"If however the storage system determines that it has located a node name in step , the procedure then branches from step  to step  where the node name of the storage system is set to the node name that was found in the root volume. After the procedure  has either set the storage appliance's node name to a found node name in step  or has stored the node name generated in step  in the root volume of the storage system in step , the procedure proceeds to step  where the storage system checks for duplicate Node names in the FC switching fabric. Once this check for duplicate node names has been completed, the procedure is then complete (step ).",{"@attributes":{"id":"p-0053","num":"0052"},"figref":"FIG. 5","b":["500","505","510","515","120","520","525"]},"Otherwise, if another device is connected to the switching fabric with the same node name, the procedure branches to step  where the storage appliance disconnects from FC switching fabric. The storage appliance then, in the illustrative embodiment, alerts the administrator of the error condition in step . The storage appliance may send an alert message to the administrator via, for example email or may display an error message in a graphical user interface (GUI).","Even if a storage appliance logs into a Fibre Channel switching network and does not detect another device with its same node name, it is possible for multiple devices to be connected to the switching fabric and utilize the same node name. For example a second storage system that does not utilize the teachings of the present invention may be connected to the switching fabric. This new storage system may utilize the same node name as a storage system already connected to the Fibre Channel switching fabric. In such an occurrence, multi protocol storage appliances typically utilize lun masking or lun mapping to limit access, e.g., prevent an unauthorized client from accessing data contained in volumes or vdisks associated with a given storage appliance.","To again summarize, the present invention provides a system and method for enabling persistent node names to be associated with a storage system. In the illustrative embodiment, the storage system, during the initialization routine, checks the root volume of the storage system to identify a node name to use. If a node name is located in a configuration file or otherwise stored in the root volume, the storage appliance then utilizes that stored node name. This enables complete storage systems, or components thereof, to be modified, replaced, or changed without a resulting change in the node name associated with the storage system.","It should be noted that the teachings of the present invention may be utilized with protocols other than Fibre Channel. It is expressly contemplated that the teachings of the present invention may be embodied with any protocol that utilizes one or more world wide unique identifiers for each device connected to the network. As such, the term \u201cnode name\u201d should be taken to include any form of world wide unique network identification for use within any acceptable network transport protocol. For example, the teachings of the present invention could be used to provide persistent port names in a FC environment.","The foregoing description has been directed to specific embodiments of this invention. It will be apparent, however, that other variations and modifications may be made to the described embodiments, with the attainment of some or all of their advantages. Additionally, the procedures or processes may be implemented in hardware, software, embodied as a computer-readable medium having program instructions, firmware, or a combination thereof. Therefore, it is the object of the appended claims to cover all such variations and modifications as come within the true spirit and scope of the invention."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The above and further advantages of the invention may be better understood by referring to the following description in conjunction with the accompanying drawings in which like-reference numerals indicate identically or functionally similar elements, of which:",{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 5"}]},"DETDESC":[{},{}]}
