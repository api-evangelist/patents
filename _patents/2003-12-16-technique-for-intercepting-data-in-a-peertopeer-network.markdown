---
title: Technique for intercepting data in a peer-to-peer network
abstract: In one embodiment, in a peer-to-peer network, data intended to be transferred directly from a first peer node to a second peer node are first redirected to an interception node. In the interception node, the data may be processed prior to being forwarded to the second peer node. The data may be scanned for virus detection and removal, for example.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07426574&OS=07426574&RS=07426574
owner: Trend Micro Incorporated
number: 07426574
owner_city: Tokyo
owner_country: JP
publication_date: 20031216
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","SUMMARY","DETAILED DESCRIPTION"],"p":["1. Field of the Invention","The present invention relates generally to computer networks, and more particularly but not exclusively to methods and systems for communicating in a peer-to-peer network.","2. Description of the Background Art","Peer-to-peer (\u201cP2P\u201d) is a type of computer network that allows one computer to directly communicate with another computer with little or no assistance from a central server. P2P networks are widely employed in both personal and business environments to transfer data, such as files for music, word processing, spreadsheet, video, and so on. Although P2P networks may have varying implementation details, most P2P networks allow files to be transferred directly from one computer to another. P2P networks may be implemented on the Internet. On the Internet, a P2P network typically requires the services of a P2P server to facilitate the establishment of direct communication channels between computers belonging to the P2P network.",{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 1","b":["140","140","120","110","110","1","110","2","110","120","141","141","1","141","2","110","143"]},"A peer node  may be a personal computer, for example. A peer node  may include a P2P module (-, -, . . . ) and one or more files (-, -, . . . ). A P2P module  may comprise computer-readable program code (i.e., software) for communicating with a P2P server  and for directly communicating with another peer node .","A P2P server  may be a computer server that has information on the whereabouts of peer nodes  that belong to the P2P network. Peer nodes  that belong to the P2P network are also referred to as members of the \u201cP2P community.\u201d A P2P server  may include a presence map  and a P2P manager . A presence map  may be a table or data structure containing presence information of peer nodes  belonging to the P2P network. Presence information may include the location information of a peer node , such as its IP address and port number. A P2P manager  may comprise computer-readable program code for providing a registrar function and a proxy function. The registrar function of P2P manager  allows peer nodes  to register its address with P2P server . For example, peer node - may register with P2P server  by providing its address. In P2P server , in response to the registration, P2P manager  may enter the address of peer node - in presence map . The proxy function of P2P manager  is employed to proxy session information between peer nodes . For example, invitations and acknowledgements for direct data transfers between peer nodes may be transmitted through P2P server  using the proxy function of P2P manager . Once communication has been established between peer nodes , the peer nodes  may directly exchange data without going through P2P server .","One problem with P2P networks is that direct data exchange between two peer nodes may facilitate the transfer of computer viruses. Unless every peer node in the P2P network has up-to-date antivirus software, one infected peer node may spread a virus to other peer nodes. Another problem with P2P networks is the lack of control on the data being transferred between nodes. While this might not be a concern among personal users, some businesses or organizations may have requirements on the kind of data that may be exchanged over the P2P network.","In one embodiment, in a peer-to-peer network, data intended to be transferred directly from a first peer node to a second peer node are first redirected to an interception node. In the interception node, the data may be processed prior to being forwarded to the second peer node. The data may be scanned for virus detection and removal, for example.","These and other features of the present invention will be readily apparent to persons of ordinary skill in the art upon reading the entirety of this disclosure, which includes the accompanying drawings and claims.","The use of the same reference label in different drawings indicates the same or like components.","In the present disclosure, numerous specific details are provided such as examples of apparatus, components, and methods to provide a thorough understanding of embodiments of the invention. Persons of ordinary skill in the art will recognize, however, that the invention can be practiced without one or more of the specific details. In other instances, well-known details are not shown or described to avoid obscuring aspects of the invention.","Being computer-related, it can be appreciated that the components disclosed herein may be implemented in hardware, software, or a combination of hardware and software (e.g., firmware). Software components may be in the form of computer-readable program code stored in a computer-readable storage medium, such as memory, mass storage device, or removable storage device. For example, a computer-readable storage medium may comprise computer-readable program code for performing the function of a particular component. Likewise, computer memory may be configured to include one or more components, which may then be executed by a processor. Components may be implemented separately in multiple modules or together in a single module.","Referring now to , there is shown a schematic diagram of an example computer that may be used in embodiments of the present invention. Depending on its configuration, the computer shown in the example of  may be employed as a personal computer or a server computer, for example. The computer of  may have less or more components to meet the needs of a particular application. As shown in , the computer may include a processor , such as those from the Intel Corporation or Advanced Micro Devices, for example. The computer may have one or more buses  coupling its various components. The computer may include one or more input devices  (e.g., keyboard, mouse), a computer-readable storage medium (CRSM)  (e.g., floppy disk, CD-ROM), a CRSM reader  (e.g., floppy drive, CD-ROM drive), a display monitor  (e.g., cathode ray tube, flat panel display), a communications interface  (e.g., network adapter, modem) for coupling to a network, one or more data storage devices  (e.g., hard disk drive, optical drive, FLASH memory), and a main memory  (e.g., RAM). Software embodiments may be stored in a computer-readable storage medium  for reading into a data storage device  or main memory . In the example of , main memory  may be configured to include a presence modifier , which is further discussed below. A presence modifier  may be executed by processor .",{"@attributes":{"id":"p-0020","num":"0019"},"figref":["FIG. 3","FIG. 1","FIG. 1"],"b":["300","140","300","110","110","112","113","110","110","300","320","330"]},"P2P server  may comprise a presence map , a P2P manager , a session map , and a presence modifier . As in P2P network , presence map  may be a table or data structure containing presence information of peer nodes  belonging to the P2P network. Presence information may include the location information of a peer node , such as its IP address and port number, for example. Table 1 shows a simplified content of an example presence map  for the example of . In the example shown in Table 1, peer nodes - and - (and other peer nodes not shown) have registered with P2P server . Peer nodes  provide their IP addresses to P2P server  as part of the registration process. Presence map  reflects the IP addresses of the registered peer nodes, among other information. The addresses shown in Table 1 have been simplified for clarity of illustration.",{"@attributes":{"id":"p-0022","num":"0021"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"91pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"77pt","align":"center"}}],"thead":{"row":[{"entry":"TABLE 1"},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}},{"entry":["NODE","IP ADDRESS","Etc."]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["110-1","1.1.1.1",". . ."]},{"entry":["110-2","1.1.1.2",". . ."]},{"entry":[". . .",". . .",". . ."]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}}}},"P2P manager  may comprise computer-readable program code for performing a registrar function and a proxy function. As a registrar, P2P manager  maintains presence map  and services registrations submitted by peer nodes . For example, peer node - may register with P2P server . As part of the registration process, peer node - may provide its IP address to P2P server . In P2P server , P2P manager  may accept the registration of peer node - and accordingly enter the IP address of peer node - in presence map . P2P manager  may also provide this registration service to other peer nodes  belonging to P2P network .","P2P manager  may proxy session information between peer nodes . The proxy function of P2P manager  allows peer nodes  to communicate through P2P server . For example, P2P manager  may forward an invitation for a data transfer or an acknowledgment to an invitation for a data transfer from one peer node  to another. As a further example, peer node - may send an invitation for a data transfer to peer node - by way of P2P server . In P2P server , P2P manager  may forward the invitation to peer node -. Peer node - may agree to the invitation by sending an acknowledgment through P2P server . In P2P server , P2P manager  may forward the acknowledgment to peer node -. In performing its proxy function, P2P manager  may consult presence map  to determine the location information of peer nodes .","In one embodiment, P2P manager  has provisions (e.g., application programming interface or API) for communicating with other program modules, such as presence modifier . This allows presence modifier  to communicate with P2P manager .","Presence modifier  may comprise computer-readable program code for redirecting data to an interception node , and for maintaining a session map . In one embodiment, presence modifier  modifies a location information published by a peer node  to that of an interception node . As will be more apparent below, this allows data that would otherwise be directly transferred between peer nodes  to be intercepted and processed in the interception node .","In the example of , P2P manager  and presence modifier  are both running in the same P2P server . As can be appreciated by those of ordinary skill in the art reading the present disclosure, a P2P manager and a presence modifier may also be running in separate computers. For example, a server computer running a presence modifier may be configured in front of a P2P server computer running a P2P manager. This way, communications between peer nodes and the P2P server computer may be intercepted and acted on by the presence modifier. Furthermore, in the example of , P2P manager  and presence modifier  are implemented as separate program modules in P2P server . It is to be noted that presence modifier  may also be integrated with P2P manager .","As shown in , P2P server  may also include a session map . Session map  may be a table or data structure containing information on communication sessions between peer nodes . Session map  may be accessed by presence modifier . Session map  may include the session ID of data transfers between peer nodes . This allows session map  to be consulted to determine the peer nodes involved in data transfer sessions in P2P network . For example, after peer nodes - and - have registered with P2P server , peer node - may send an invitation for data transfer to peer node - by way of P2P server . The data transfer may involve the transfer of file - from peer node - to peer node -. Peer node - may accept the invitation, and accordingly send an acknowledgement to peer node - by way of P2P server . Peer node - responds to the acknowledgement by publishing its location information (e.g. IP: 1.1.1.1, Port: 5001) and a session ID (e.g. 123456789) to peer node - through P2P server . A session ID may be a unique identification employed for verification and tracking purposes. A session ID may be generated by a peer node  (peer node - in this example) using a GUID (global unique ID generator), for example. Other means for generating a session ID may also be employed without detracting from the merits of the present invention. In P2P server , presence modifier  enters the session ID and the location information of peer nodes - and - in session map . This allows session map  to note the data transfer between peer nodes - and -. Table 2 shows simplified example contents of session map  for the data transfer between peer nodes - and -. In the example shown in Table 2, the data transfer from peer node - to peer node - has a session ID of \u201c123456789\u201d in session map . Session ID \u201c123456789\u201d may be used as an index to determine the peer nodes involved in the data transfer. In this particular example, the location information for peer node - in session map  for session ID \u201c123456789\u201d does not require a port number because peer node - will be providing file -. A port number may also be entered for each peer node in session map .",{"@attributes":{"id":"p-0029","num":"0028"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"center"}}],"thead":{"row":[{"entry":[{},"TABLE 2"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]},{"entry":[{},{},"Node","Node",{}]},{"entry":[{},"SESSION ID","Address\/Port","Address\/Port","Etc."]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"123456789","1.1.1.1\/5001","1.1.1.2",". . ."]},{"entry":[{},"678901234",". . .",". . .",". . ."]},{"entry":[{},". . .",". . .",". . .",". . ."]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]}]}}}}},"An interception node  may be a computer comprising a transfer manager  and a data scanner . Transfer manager  may comprise computer-readable program code for facilitating data transfer through interception node . In one embodiment, transfer manager  communicates with presence modifier  to obtain the session information (e.g., location information of the peer nodes involved in a data transfer) for a data transfer in P2P network . Transfer manager  may communicate with presence modifier  over a communication channel . For example, transfer manager  may request presence modifier  for the particulars of a session ID. Presence modifier  may use that session ID to obtain session information, such as the peer nodes involved in the data transfer, from session map  and provide that session information to transfer manager  over communication channel . It is to be noted that communication channels  (i.e., -, -),  (i.e., -, -) and  shown in  may be TCP\/IP connections over the Internet, for example.","A data scanner  may comprise computer-readable program code for processing data in interception node . Data scanner  may be an antivirus program, for example. That it is, data scanner  may scan data in interception node  for viruses. Data scanner  may also scan data in interception node  for content filtering purposes. For example, data scanner  may scan data for offensive words, confidential information and the like. It is to be noted that data scanner  may also process data in interception node  for purposes other than virus detection\/removal and content filtering without detracting from the merits of the present invention.","Data intended to be transferred directly between two peer nodes  may be redirected to interception node , where the data may be processed by data scanner . Continuing the aforementioned example involving the transfer of file - from peer node - to peer node - and having a session ID of \u201c123456789,\u201d presence modifier  may detect the location information published by peer node - and replace it with the location information of interception node . For example, presence modifier  may receive the location information from P2P manager  or intercept the location information before the location information is received by P2P manager  (such as when the presence modifier is configured in front of the P2P manager ). Presence modifier  may then forward the location information of interception node  (e.g. IP: 1.1.1.3, Port: 3001) instead of peer node -, to peer node -. Peer node - may use the location information it received from presence modifier  to open a direct communication channel - with interception node . Peer node - provides interception node  the session ID (\u201c123456789\u201d in this example) of the data transfer. Note that peer node - \u201cthinks\u201d that it is having a P2P communication with peer node -, not interception node . In other words, interception node  is advantageously transparent to peer node -.","Still continuing with the example involving session ID \u201c123456789,\u201d transfer manager  in interception node  may ask presence modifier  for the particulars of session ID \u201c123456789.\u201d Presence modifier  may use the session ID to consult session map  and identify peer nodes - and - as the peer nodes involved in the data transfer. Presence modifier  may so inform transfer manager , which then opens a direct communication channel - to peer node - using the IP address and port number of peer node - as referenced in session map  under the session ID \u201c123456789.\u201d Because interception node  received the session ID from peer node -, transfer manager  may assume that a communication channel needs to be opened to the other peer node, which is peer node -. Peer node - receives the session ID from interception node , verifies the session ID, and proceeds to transfer file - to interception node . Because of the session ID, peer node - thinks that it is having a P2P communication with peer node -, not interception node . That is, interception node  is advantageously transparent to peer node -. In interception node , data scanner  processes file -. Thereafter, interception node  transfers file - to peer node -, thereby completing the data transfer for that session ID. A similar procedure may be performed to transfer file - from peer node - to peer node -.","Although embodiments of the present invention may be employed in a variety of applications, they are especially useful as an antivirus measure. The conventional approach in combating viruses in a P2P network is to perform virus scanning\/removal in individual peer nodes. Unfortunately, this conventional approach has a serious flaw in that there may be a lot of peer nodes in a given P2P network and ensuring that each peer node has an up-to-date antivirus program (if at all) may be very difficult, if not impossible. Embodiments of the present invention advantageously allow for virus scanning\/removal of data transferred over a P2P network in a manner that is relatively transparent to peer nodes and without having to perform antivirus processing in individual peer nodes.","Turning now to , there is shown a method  of transferring data in a peer-to-peer network in accordance with an embodiment of the present invention. Method  will be described with reference to the components shown in  for illustration purposes only. It is to be understood that method  may also be performed using other components without detracting from the merits of the present invention.","Beginning in step , a first peer node and a second peer node register with a P2P server. In the P2P server, a P2P manager enters the addresses (e.g., IP addresses) of the first and second peer nodes in a presence map.","In step , the first peer node publishes its location information (e.g., IP address and port number) and a session ID for a data transfer. Step  may be as a result of an invitation for a data transfer initiated by the first peer node and accepted by the second peer node. In that case, the published location information and session ID are addressed to the second peer node to allow the second peer node to establish a direct communication channel to the first peer node. The first peer node may be a data sender or receiver depending on the particulars of the data transfer. The data to be transferred may be a file, for example. The publication by the first peer node and the invitation\/acknowledgement for data transfer may be transmitted through the P2P server using the P2P manager as a proxy.","In step , a presence modifier detects the published session ID and location information of the first peer node. The presence modifier may intercept the published session ID and location information to prevent them from being received by the P2P manager. Alternatively, the presence modifier may cooperatively work with the P2P manager in responding to any published session ID and location information. Other means for allowing the presence modifier to respond to the published session ID and location information may also be employed without detracting from the merits of the present invention. The presence modifier enters the session ID and location information of the first peer node and the second peer node in a session map.","In step , the presence modifier replaces the published location information of the first peer node with that of an interception node. The presence modifier then provides the session ID published by the first peer node and the location information (e.g., IP address, port number) of the interception node to the second peer node.","In step , the second peer node establishes a direct communication channel with the interception node using the location information of the interception node received from the presence modifier. The second peer node provides the session ID to the interception node.","In step , the interception node determines the peer nodes associated with the session ID. Because the interception node received the session ID from the second peer node, the interception node only needs to determine the location information of the other peer node involved in the data transfer. The interception node may perform step  by providing the session ID to the presence modifier. The presence modifier may use the session ID to search the session map for the particulars of the data transfer, such as the location information of the peer nodes involved in the data transfer. The presence modifier provides the particulars of the session ID to the interception node, which then determines that the first peer node is the intended communications partner of the second peer node.","In step , the interception node accordingly establishes a communication channel with the first peer node using the IP address and port number of the first peer node listed in the session map. The interception node provides the session ID to the first peer node. The first peer node verifies the session ID and proceeds to communicate with the interception node.","In method , data to be transferred between the first and second peer nodes are intercepted in the interception node. This allows the data to be processed in the interception node (e.g., for virus scanning). For example, in the case where the first peer node is to provide a file to the second peer node, the interception node may receive the file from the first peer node after step . The interception node may process the file before transferring the file to the second peer node. In another case where the first peer node is to receive a file from the second peer node, the interception node may receive the file from the second peer node after step . The interception node may process the file before transferring the file to the first peer node after the establishment of a communication channel with the first peer node in step . In light of the present disclosure, those of ordinary skill of the art will appreciate that the above-described redirection of data to an interception node in a data transfer between two peer nodes may be generally employed regardless of which peer node is the sender or receiver of the data.","While specific embodiments of the present invention have been provided, it is to be understood that these embodiments are for illustration purposes and not limiting. Many additional embodiments will be apparent to persons of ordinary skill in the art reading this disclosure."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 4"}]},"DETDESC":[{},{}]}
