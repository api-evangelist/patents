---
title: Port number reservation agent
abstract: In a communication device having a modem subsystem and an Application Processing Engine (APE) that share an IP address, port number conflicts are avoided by a Port Reservation Agent (PRA) running on the APE. Apps executing on the modem subsystem must request to register a port number with the PRA prior to using it. If the address is available, the PRA creates a port reservation socket and associates the port number with the requesting app. If the requested port number is not available, the PRA returns an error and the app must request a different address. To apps executing on the APE, the port reservation sockets appear as port numbers associated with other apps executing on the APE. In this manner, port number conflicts between the modem subsystem and the APE are avoided.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08958284&OS=08958284&RS=08958284
owner: ST-Ericsson SA
number: 08958284
owner_city: Plan-les-Ouates
owner_country: CH
publication_date: 20111024
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["PRIORITY CLAIM","FIELD OF THE INVENTION","BACKGROUND","SUMMARY","DETAILED DESCRIPTION","Advantages of the Invention"],"p":["The present application claims priority to U.S. Application Ser. No. 61\/497,554, titled \u201cPort Number Reservation Agent\u201d, filed with the United States Patent Office on Jun. 16, 2011, the disclosure of which is incorporated herein by reference in its entirety.","The present invention relates generally to wireless communication devices, and in particular to a system and method of reserving port number to prevent port number conflict between a modem subsystem and application processor in a wireless device.","Wireless communication devices\u2014such as cellphones and smartphones\u2014are enormously popular and represent a significant consumer electronics market. Increasingly, such devices are structured as an Application Processing Engine (APE) executing IP-based applications (commonly known as \u201capps\u201d). The wireless device additionally includes a modem subsystem, including a transceiver, which implements the wireless data link between the device and a subscriber network, and which also executes apps.",{"@attributes":{"id":"p-0005","num":"0004"},"figref":"FIG. 1","b":["10","12","14","12","16","17","18","20","12","22","20","14","22","24","10","20","24","20","24"]},"To account for this, the packet inspection function  of the modem subsystem  inspects the IP addresses of all incoming packets received by the transceiver . The packet inspection function  forwards incoming packets to either the modem subsystem IP stack  or the APE IP stack , depending on the port number of each incoming packet. In particular, the packet inspection function  forwards incoming packets having a port number used by the modem IP stack  to the modem IP stack , and forwards all other packets to the APE IP stack . This works well if the modem subsystem IP stack  and APE IP stack  maintain mutually exclusive port numbers.","However, in the case that an app executing on the modem subsystem  registers a port number on the modem subsystem IP stack , and the address was previously registered by an app executing on the APE , a conflict arises. Future incoming IP packets addressed to the conflicting port number will be routed by the packet inspection function  to the modem subsystem IP stack . The APE IP stack  will simply stop receiving packets, with no warning or error message. Additionally, the packets intended for the APE app  may make no sense to, or cause erratic behavior of, the modem subsystem app .","In order to prevent a port number from being utilized on both the modem subsystem and the APE, a Port Reservation Agent (PRA) is introduced on the APE. The PRA reserves server and client ports on the APE by creating port reservation sockets in the APE IP stack, on behalf of apps executing on the modem subsystem. This ensures that apps executing on the modem subsystem do not register ports using addresses already in use by apps executing on the APE. If an app executing on the modem subsystem attempts to use such a port number, it will receive an error message from the PRA, and it must select an alternative port number. Similarly, if an app executing on the APE attempts to register a port number already in use by an app executing on the modem subsystem, it will see an apparent conflict with the port reservation socket, and must select and register a different port number. Since this process is a standard procedure, apps on the APE (often created by third-party developers) need not be aware of the PRA or the port number conflict avoidance system it implements.","One embodiment relates to a communication device. The device includes a modem subsystem operative to send and receive data packets to and from at least one external device, and further operative to manage a first IP stack and to execute at least one app, the app being operative to exchange data with an external device via a port number. The device also includes an APE operative to manage a second IP stack and to execute at least one app operative to exchange data with an external device via a port number. The device further includes a Port Reservation Agent (PRA) on the APE, the PRA operative to receive from the modem subsystem a request for a port number and if the port number is available, create a port reservation socket on the APE and connect the port reservation socket to the requested port number, and if the port is not available, return an error message to the modem subsystem.","Another embodiment relates to a method, by a modem subsystem of a communication device that also includes an APE, wherein the modem subsystem and the APE share an IP address, of executing an app operative to exchange data with an external device via a port number. A port number is selected for the app. A request to register the port number with a Port Reservation Agent (PRA) on the APE is issued. If the port number is free in the PRA, data is exchanged with an external device via the port number. If the port number is not free, the method is repeated with a new port number.","Yet another embodiment relates to a method, by an APE of a communication device that also includes a modem subsystem, wherein the APE and the modem subsystem share an IP address, of avoiding port number conflicts by apps executing on the modem subsystem. A list of port numbers and their associated apps executing on the APE is maintained. A request for a port number is received from an app executing on the modem subsystem. If the requested port number is free, an entry is created for the port number and it is associated with the requesting app. If the requested port number is not free, an error message is returned. Port number conflicts between apps executing on the modem subsystem and apps executing on the APE are thus avoided.",{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 2","b":["10","12","20","14","24","22","14","26","26","20","24","20","26"]},"Port Reservation Agent","The PRA  is preferably a software application running on the APE , but may alternatively be implemented in hardware or firmware. The PRA  interacts with other software through an Application Programming Interface (API), which may be different for different programming languages and operating systems. In one embodiment, the PRA  exposes the following APIs elements to the modem subsystem:\n\n","The PRA  reserves a server port by creating a port reservation socket and binding the server port to the port reservation socket. The PRA  will never receive any packets on the port reservation socket\u2014also known as a \u201cdummy socket\u201d\u2014because the packet inspection function  on the modem subsystem  will forward all incoming packets addressed to this port to the modem subsystem IP stack . However, registration of the port reservation socket with the PRA  prevents apps  executing on the modem subsystem  from registering, with the modem subsystem IP stack , any port number already used by an apps  executing on the APE , and hence subsequently diverting that app's packet stream to the modem subsystem .","The PRA  reserves a client port by creating a port reservation socket and connecting the client port to the port reservation socket. Only an app  running on the modem subsystem  will send data using that client port.","The PRA  releases a server or client port reserved by an app  on the modem subsystem  by closing the corresponding port reservation socket.","App on Modem Subsystem",{"@attributes":{"id":"p-0022","num":"0025"},"figref":["FIG. 2","FIG. 3","FIG. 3","FIG. 2","FIG. 3","FIG. 3","FIG. 2","FIG. 2","FIG. 3"],"b":["100","22","12","22","12","102","26","1","104","106","26","24","2","26","22","12","20","3","108","22","22","14"]},"If the reservation fails\u2014that is, if the function reserve_serverport( ) or reserve_clientport( ) returns a negative result\u2014then an app  executing on the APE  has already reserved that port number (block  in ), and the app  executing on the modem subsystem  must select a new port number (block  in ) and initiate a new port reservation request (arrow  in ; block  in ). In this manner, the port reservations of apps  executing on the APE  are protected from having their data streams diverted by apps  executing on the modem subsystem  subsequently using the same port number.","When an app  executing on the modem subsystem  would like to release the use of a port number, the app  must release the port both by the PRA , using the function release_serverport( ) or release_clientport( ) in the PRA API (depending on whether it is a server or client port), and also on the modem IP stack .","App on APE","If any app  executing on the APE  attempts to use a port that is used by an app  executing on the modem subsystem , the app  executing on the APE  and requesting the port number will encounter a port reservation socket in the APE IP stack , and receive an error response. The error is identical to what would occur if the conflicting app  executing on the modem subsystem  were instead executing on the APE . Accordingly, this solution places no requirements on apps  executing on the APE , so third-party developers may use standard procedures for allocating ports.","The Port Reservation Agent  according to embodiments of the present invention presents numerous advantages over prior art solutions.","First, there is no port conflict between the modem subsystem IP stack  and the APE IP stack . This is true even though they share the same IP address.","Additionally, if an app  executing on the APE  attempts use a port that is already used by an app  executing on the modem subsystem , the app  executing on the APE  will receive the same error response as if the conflicting app  executing on the modem subsystem  was instead executing on the APE . Accordingly, the app  executing on the APE  may rely on conventional error-handling for a conflicting port number. This is an important advantage, since the apps  executing on the APE  are often developed by third-party developers.","Both the modem subsystem  and the APE  may be implemented in dedicated hardware, programmable hardware with appropriate firmware, as appropriately programmed processors (microprocessor, digital signal processor, or the like), or any combination thereof. The inventive PRA  may be implemented as a software module executing on the APE , as part of the APE IP stack , as part of an operating system, or as a stand-alone app . As such, software implementing the PRA  may be stored in memory on or accessible to the APE , or on any computer-readable media, such as memory (e.g., RAM, ROM, Flash, or the like), magnetic or optical media, hard disk drive, or the like. The PRA  software may be loaded onto the APE  at manufacture, during a configuration process, or at any time via the modem subsystem .","The present invention may, of course, be carried out in other ways than those specifically set forth herein without departing from essential characteristics of the invention. The present embodiments are to be considered in all respects as illustrative and not restrictive, and all changes coming within the meaning and equivalency range of the appended claims are intended to be embraced therein."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 3"}]},"DETDESC":[{},{}]}
