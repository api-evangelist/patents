---
title: Image processing apparatus
abstract: In an apparatus for composing image data of a main picture and image data of a sub-picture by a chroma key process, an attribute of an image contained in the sub-picture is detected, a partial area of the sub-picture is set as a chroma key mask area in accordance with the attribute detection result, and composing the image data of the main picture and the image data of the sub-picture by executing the chroma key process for an area other than the chroma key mask area without executing the chroma key process for the chroma key mask area in the sub-picture.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=06961097&OS=06961097&RS=06961097
owner: Canon Kabushiki Kaisha
number: 06961097
owner_city: Tokyo
owner_country: JP
publication_date: 20040812
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"p":["This application is a divisional of application Ser. No. 09\/790,599, filed Feb. 23, 2001, now U.S. Pat. No. 6,859,236.","1. Field of the Invention","The present invention relates to an image processing apparatus, and more particularly to techniques of composing image signals of a plurality of images in one picture.","2. Related Background Art","Multi-picture display is now frequently adopted by using a liquid crystal projector or a large display device such as a plasma display device. In the multi-picture display, images received from a DTV (digital television), images reproduced from a DVD (digital versatile disc), and images processed by a personal computer are used. It is thought that a large screen display device will become a main display device for multimedia in home use, and applications to integrally displaying images of various media on one display device has been desired.","In such a background, an image display system directed to applications mainly to DVD is required to have not only a function of displaying a plurality of images at the same time but also a function of composing a plurality of images into one multi-picture. Such images include an image from digital broadcasting, an image from a WWW browser, an image from an e-mail, an image from EPG (electronic program guide), a so-called GUI image such as a user support image of peripheral apparatus compatible with an IEEE1394 serial bus.","In order to realize such functions, a memory is necessary which is used for developing a plurality of input video images and GUI images. This memory has a structure constituted of a video image plane, a GUI image plane, and an alpha plane used for controlling the composition of video images and GUI images. In accordance with alpha values written in the alpha plane, a video image selection, a GUI image selection, and a composition of video and GUI images such as alpha blending can be processed on a bit basis.","In such a conventional image display system, if the memory for developing a plurality of input video and GUI images uses a dedicated alpha plane for controlling the composition of these images, the capacity of alpha plane is generally 8 bits per pixel multiplied by a display resolution.","For example, use of a progressive display device of a high resolution of 1080 P for HDTV of DTV field requires an alpha plane memory having a capacity of 1920\u00d71080\u00d78=2 MB. This increase in the memory capacity may cause an increased load of a CPU which develops alpha values to GUI images or of a graphic accelerator.","In order to solve this problem, a chroma key method has been proposed. With this method, without using an alpha plane, a plurality of input video and GUI images can be composed by inserting a specific key color in GUI image data.","The chroma key composition method relies upon that a CPU can control colors of a GUI image so as not to hit a key color. If data unable to be controlled by CPU is developed in a GUI image, a probability of a key color hit increases and an intended image composition may not be performed. Such the data unable to be controlled by CPU includes still image data derived from BS digital data broadcast, image data on the Internet, natural image data taken by a digital camera or the like.","It is an object of the invention to solve the above-described problem.","It is another object of the present invention to compose a main picture and a sub-picture at a high precision by efficiently using a memory.","In order to achieve the above objects, one aspect of the invention provides an apparatus for composing image data of a main picture and image data of a sub-picture by a chroma key process, comprising: attribute detecting means for detecting an attribute of an image contained in the sub-picture; area setting means for setting a partial area of the sub-picture as a chroma key mask area in accordance with an output from the attribute detecting means; and composing means for composing the image data of the main picture and the image data of the sub-picture by executing the chroma key process for an area other than the chroma key mask area without executing the chroma key process for the chroma key mask area in the sub-picture.","Other objects and features of the present invention will become apparent from the following detailed description of embodiments when read in conjunction with the accompanying drawings.","Embodiments of the invention will be described with reference to the accompanying drawings.","The present invention is applied, for example, to an image display system  shown in . This image display system  has a function of composing a plurality of video images and GUI images and integrally displaying them as one picture by a chroma key composition method.","The image display system  has an identifying unit for identifying a data type and attribute of an image having a color unable to be controlled by a CPU for controlling a graphic accelerator when the image is developed in a display memory. If the image identified by the identifying unit is judged that it has a high probability of hitting a key color during the chroma key composition process, the chroma key composition process is masked in this image area. In this manner, the memory capacity can be reduced and a precision of the chroma key composition process can be improved.","Structure of Image Display System ","In this embodiment, it is assumed that the image display system  displays images from two dependent image sources as one picture. However, the number of image sources to be displayed on a display monitor is not limited only to two, but the number may be smaller or larger than two.","Referring to , a DTV reception front-end unit (hereinafter called an \u201cimage source\u201d) includes a tuner unit , a demodulation unit , a demultiplexer unit , an audio decoding unit , an image decoding unit , and a data decoding unit .","The tuner unit  receives a broadcast signal (digital television signal) from a ground wave, a satellite wave or the like, passes the received signal through a band-pass filter, a down-converter and the like, and thereafter supplies it to the demodulation unit . The broadcast signal contains a plurality of multiplexed broadcast program data constituted of moving image data, audio data, addition information data and the like. The demodulation unit  demodulates the signal supplied from the tuner unit  in a manner matching a transmission type, performs an error correction process and the like, and supplies the processed signal to the demultiplexer unit  as a MPEG2 transport stream.","The demultiplexer unit  separates the transport stream supplied from the demodulation unit  into MPEG2 video data, MPEG2 audio data and addition information of a desired program. The audio decoding unit  decodes the MPEG2 audio data supplied from the demultiplexer unit  and outputs an audio signal. By connecting an amplifier and a speaker to the output of the audio decoding unit , sounds of the broadcast signal (program) received by the tuner unit  can therefore be listened.","The image decoding unit  decodes the MPEG2 video data supplied from the demultiplexer unit  to convert it into image data whose display format is a raster scan type and supply it to a moving image input unit ","The data decoding unit  decodes the addition information data supplied from the demultiplexer unit  and supplies the decoded data to a multi-picture control unit .","\u201cDecode\u201d means to derive a scenario of a multimedia information service provider from an object described by a scenario descriptive language, such as, for example, MHEG (Multimedia and Hypermedia Experts Group)-5, HTML (Hyper Text Markup Language) and XML (eXtensible Markup Language) for a BS digital broadcast received at the tuner unit .","This scenario is constituted of structural attributes (size, position, image type, coding method) of contents. The multi-picture control unit  analyzes a scenario and configures a data broadcast picture in cooperation with a graphic accelerator  and the image decoding unit . For example, if a CS digital broadcast is received at the tuner unit , \u201cdecode\u201d means mainly to derive program information. This program information is analyzed by the multi-picture control unit  and converted into a GUI picture such as EPG by using a drawing command to the graphic accelerator .","A DVD player (hereinafter called an \u201cimage source\u201d) converts an analog composite signal or digital signal into image data of a YUV raster format, and supplies the converted image data to a moving image input unit . The moving image input unit receives the image data from the image decoding unit  of the DTV reception front-end unit , whereas the moving input unit receives the image data from the DVD player ","Although these moving image input units and have the same structure, they receive image data from the corresponding image sources at independent timings. In this case, the moving image input units and receive control signals for receiving the image data at the same time in some cases. The control signals include, for example, a horizontal sync signal for synchronization of one line, a vertical sync signal for synchronization of one frame or field, a clock signal for sampling each pixel, a display enable signal representative of a transfer period of effective image data, and the like.","If the received image data is computer analog signals, the moving image input units and process the received analog signals by using an A\/D converter for converting the analog signal into a digital signal and a PLL circuit for sampling image data.","If the received image data is digital signals such as LVDS (Low Voltage Differential Signal), the moving image input units and process the digital signals by using a decoder and a differential buffer. If the received image data is composite signals, they process the composite signals by using a color conversion circuit for converting YUV into RGB signals and an I-P converter circuit for converting a scan method from am interlace scanning to a progressive scanning.","A resolution conversion unit converts a display format (display line number, dot number, color number) of image data received from the moving image unit , under the control of the multi-picture control unit . Similarly, a resolution conversion unit converts a display format of image data received from the moving image unit , under the control of the multi-picture control unit .","The resolution conversion units and each have a bus interface function of outputting independent two sets of image data to one common graphic bus .","Therefore, the image data output from each of the resolution conversion units and is stored in a memory via the graphic bus , under the control of a memory control unit . This memory  has a capacity corresponding to at least one picture. In this embodiment, the memory  has a capacity corresponding to at least three pictures, for the image data as well as data output from the graphic accelerator .","An output composition unit  issues a memory address at which image data to be displayed is stored, to the memory control unit , in accordance with a multi-window management command from the multi-picture control unit . In this manner, display image data is read from the memory unit  to realize final multi-picture composition.","In order to display an image corresponding to the image data output from the output composition unit , particularly a multi-picture, on a display device , an output conversion unit  performs synchronously with the frame rate of the display device  a display control corresponding to the characteristics of the display device  and a display format conversion process.","The display device  displays images corresponding to image data output from the output conversion unit . The display device  may be a flat panel display device (liquid crystal, plasma or the like) having a matrix electrode structure, a CRT or the like so long as it can display an image. In this embodiment, a high definition display device for a television and a large screen display device having a high precision of SXGA or more for a PC are intended.","A bus arbitration unit  scalably manages asynchronous accesses from the graphic bus  to the memory unit , in accordance with a priority order.","The multi-picture control unit  controls the whole operation of this system  and has a CPU with an arithmetic function, a RAM  for temporary data storage, a ROM  for storing a control program and the like, a time counter, a peripheral I\/O interface and the like.","The multi-picture control unit  may be made of only logical circuits or may be a CPU or a media processor capable of parallel calculation. A program to be used for the control by the multi-picture control unit  may be written in ROM  or may be supplied externally via the peripheral I\/O interface.","ROM  stores, if necessary, character font data and the like. The font data is used when character information from WWW or data broadcast is developed in an image.","A remote control unit  is connected to the multi-picture control unit . Therefore, the multi-picture control unit  can receive a command (using infrared ray) from a remote controller  via the remote control unit .","The graphic accelerator  operates when the multi-picture control unit  uses a drawing command and an acceleration function such as BitBit and DMA to display a GUI image on the display device , the GUI image including an OSD (On Screen Display) image, an EPG image, a data broadcast image.","A modem unit  operates for connection to the Internet. An IEEE1394 control unit  operates for connection to an external apparatus compatible with the IEE1394 serial bus specification. A PCMCIA  operates to capture image data taken with a digital camera or the like by using a compact flash card or the like. These peripheral devices are connected via a CPU bus  to the multi-picture control unit .","Operation of Image Display System ","The image display system  operates, for example, in accordance with the processes shown in the flow chart of . This operation is realized by CPU in the multi-picture control unit .","Step S, Step S:","Upon detection of a power-on of the system  by the remote controller  (Step S), the multi-picture control unit  executes a display initializing process (Step S). The display initializing process at Step S is illustrated in the flow chart of .","Referring to , the multi-picture control unit  first detects a connected input (Step S). This process checks how many image sources are connected to the system .","More specifically, the moving image input units and always monitor a connection confirmation signal from the corresponding ones of the image sources. This connection confirmation signal is a binary signal of logical \u201c1\u201d or \u201c0\u201d output from the image sources and . For example, when the connection cable is disconnected or the power source of the image source is turned off, the logic \u201c0\u201d of the connection confirmation signal is output because the moving image input units and are terminated by resistors. It is therefore possible to confirm that the image data is not input from the corresponding image source.","In accordance with monitor information supplied from the moving image input units and via control lines S-and S-at a constant time interval, the multi-picture control unit  can detect the connection confirmation signal output from the image sources and . If the connection confirmation signal is \u201c1\u201d, it is judged that the image source is connected, and thereafter the flow advances to a moving image input parameter setting process at Step S. If the connection confirmation signal is \u201c0\u201d, the connection confirmation signal is monitored until the connection confirmation signal of \u201c1\u201d is input.","After Step S, in accordance with information supplied from the moving image input units and via the control line S-and S-, the multi-picture control unit  detects parameters (display dot number, display line number, horizontal\/vertical timings, and the like) used for inputting image data from the image source whose connection was detected, and sets the detected parameters to the moving image input units and via the control lines S-and S-(Step S).","These parameters may be obtained by the moving image input units and by directly counting the clock number and horizontal sync signal number by using the horizontal sync signal for line synchronization, a vertical sync signal for frame\/field synchronization, a clock signal for sampling a pixel and the like.","Next, the multi-picture control unit  determines a display layout to be used when image data from one or more image sources whose connection was detected is displayed on the display device  (Step S). A default layout is preset in advance in ROM .","Next, the multi-picture control unit  judges whether there is an image overlap in the display layout determined at Step S is used (Step S). If it is judged that there is an image overlap, the flow advances to Step S and then to Step S, whereas if not, the flow directly advances to Step S.","If it is judged at Step S that there is an image overlap, the multi-picture control unit  determines a layer priority order of the image overlap (an image on the upper layer has a higher layer priority), and writes this information in RAM  (Step S).","At Step S, the multi-picture control unit  determines display start\/end positions and magnification\/reduction factors in horizontal\/vertical directions of each image on the display device , and writes the determined information in RAM  as resolution conversion parameters. The multi-picture control unit  sets the resolution conversion parameters to the resolution conversion units and via control lines S-and S-","Next, the multi-picture control unit  sets write memory addresses necessary for writing the outputs from the resolution conversion units and into the memory unit  (Step S). These memory addresses are used as offset values of memory addresses to be used in a write address generation process.","In this embodiment, for example, as shown in , the memory unit  is constituted of three areas including moving image areas and and a GUI image area . Therefore, at the time when the data is written in the memory unit , the memory unit  is not in an on-screen state. In this case, the multi-picture control unit  sets start addresses 0 to 2 of the areas to to the resolution conversion units and via the control lines S-and S-and to the graphic accelerator .","Next, the multi-picture control unit  sets a background color to be used for the multi-window display of the display device  (Step S). More specifically, the output composition unit  has the circuit structure such as shown in . The multi-picture control unit  sets the background color to a background register  of the output composition unit . Next, the multi-picture control unit  sets GUI images for the multi-picture control (Step S).","More specifically, GUI images are used not only as multi-picture control images but also as Web images and EPG images. The multi-picture control unit  generates GUI images by issuing a GUI image drawing command to the graphic accelerator  or by writing characters and other data developed in a bit map format in the memory unit  by using the DMA function of the graphic accelerator . The multi-picture control unit  also determines the display layout of the GUI images on the multi-picture screen. The priority order in this case is highest.","The multi-picture control unit  performs various settings for the operation of the output composition unit  (Step S).","The outline of the output composition  which operates in accordance with the settings at Step S will be described with reference to .","Referring to , a composition control unit  generates various control signals in accordance with a comparison result between parameters to be described later and the counts of a horizontal pixel number counter and a vertical line number counter which counters operate-using sync signals (Hsync, Vsync) of the display device  as a reference.","In accordance with a signal S supplied from the multi-picture control unit , the composition control unit  acquires a horizontal count start value (corresponding to a period from Hsync to the start of an effective pixel), a vertical line start value (corresponding to a period from Vsync to the start of an effective line), a horizontal pixel number and a vertical line number to thereby count the number of raster scans during the display period of the display device .","In accordance with the signal S supplied from the multi-picture control unit , the composition control unit  acquires for each image, composition start addresses (offset values from the start of an effective count of the composition control unit ), horizontal pixel numbers and vertical line numbers (information set to address generation units  to ) for the images to be composed, which respectively reflect layout information of each image. The composition control unit  compares the acquired information with the count by the composition control unit . If these values are coincident, the composition control unit  makes via data lines S-to S-the three address generation units  to  start counting. The three address generation units  to  therefore start a count operation independently.","Resetting the counters by the composition control unit  is generally effected at each Vsync.","The count outputs from the address generation units  to  are used as read addresses and output from data lines S-to S-","In this embodiment, since different image sources are managed for composing images, these images are selected by changing addresses. Namely, an address selection unit  selects an address to realize image composition. This address selection is performed in the following manner. In accordance with the signal S supplied from the multi-picture control unit , the composition control unit  acquires a composition switching count number based upon the layout information and priority information, and compares this count value with the count value of the counter of the composition control unit  to generate an address switching signal S.","Data is then read from the memory unit  and written in a data buffer  in accordance with a read\/write control signal S. The data in the data buffer  is output to a data selection unit  in response to the read\/write signal S.","If it is judged that there is no images to be composed, the composition control unit  outputs a data switching signal S to the data selection unit .","Step S:","After the initializing process at Step S described above, the multi-picture control unit  enables an image display by the display unit . The display device  therefore displays an image such as shown in  (image after multi-picture composition initialization).","Step S:","The multi-picture control unit  judges from the image on the display device  whether a user performs a magnification\/reduction action by using the remote controller .","Step S:","If it is judged at Step S that the magnification\/reduction action was performed, the multi-picture control unit  executes a magnification\/reduction change process for the display device . This process is similar to the processes at Steps S to S shown in . Thereafter, the flow returns to Step S to repetitively execute the Steps to follow.","Step S:","If it is judged at Step S that the magnification\/reduction action was not performed, the multi-picture control unit  judges from the image on the display device  after the initialization whether the user performs a position change action by using the remote controller .","Step S:","If it is judged at Step S that the position change action was performed, the multi-picture control unit  executes a position change process for the display device . This process is similar to the processes at Steps S to S shown in . Thereafter, the flow returns to Step S to repetitively execute the Steps to follow.","Step S:","If it is judged at Step S that the position change action was not performed, the multi-picture control unit  judges from the image on the display device  after the initialization whether the user performs a multi-picture display correction action by using the remote controller .","Step S:","If it is judged at Step S that the multi-picture display correction action was performed, the multi-picture control unit  executes a multi-picture display correction process for the display device . Thereafter, the flow returns to Step S to repetitively execute the Steps to follow.","Step S:","If it is judged at Step S that the multi-picture display correction action was not performed, the multi-picture control unit  judges whether the power of the system  was turned off. If not, the flow returns to Step S to repetitively repeat the Steps to follow, whereas if the power was turned off, the process is terminated.","Chroma Key Composition Process for Multi-Picture and GUI Picture by Image Display System ","Next, a process of composing a picture of two images (multi-picture) and a picture of a GUI image (GUI picture) according to the embodiment will be described.","In this embodiment, a chroma key composition method is used as a method of composing a multi-picture and a GUI picture. In this embodiment, when the graphic accelerator  develops a GUI picture in the memory unit , a paint-out process with a specific chroma key color is also executed. For example, as shown in , an area outside of the GUI image is painted out with data of a specific chroma key color (chroma key data, hereinafter simply called \u201ckey color\u201d in some case).","In this embodiment, the multi-picture control unit  determines a color (e.g., magenta) which is rarely used for drawing a GUI image, as the chroma key color. Therefore, GUI image data and key color data are developed in the GUI image area of the memory unit  shown in .","In this case, if the data read from the GUI image area of the memory unit  contains key color data, the output composition unit  shown in  selects a desired multi-picture and composes it in place of an image corresponding to the key color data.",{"@attributes":{"id":"p-0110","num":"0109"},"figref":["FIG. 8","FIG. 8"],"b":["18","14","31","33","35","30"]},"The GUI image data read from the memory unit  at memory address generation timings \u201cT1\u201d is written in the data buffer  at a timing \u201cT2\u201d (read timing of data in the GUI image area of one frame\/field).","Similarly, the selected moving image data is written in the data buffer  at a timing \u201cT3\u201d (read timing of data in the areas and for two pictures of the moving image). The data buffer  has a double buffer structure capable of storing both a GUI image and a selected moving image.","The GUI image data written in the data buffer  at the timing \u201cT2\u201d is also input to the composition control unit .","The composition control unit  sequentially compares the GUI image data with the key color data set to the key color register , and if there is a coincidence, a chroma key hit flag is set, and this flag is written in a chroma key flag buffer in the composition control unit .","The composition control unit  reads the chroma key hit flag in the chroma key flag buffer at timings \u201cTa\u201d to \u201cTd\u201d (surrounded by a circle in ). If the flag contents indicate a chroma key hit, moving image data is read from the data buffer , whereas if the flag contents do not indicate a chroma key hit (indicate a chroma key misshit), GUI image data is read from the data buffer  in response to the read control signal S. At a composite data timing \u201cT4\u201d, image data (chroma key composite data) composed from moving image data and GUI image data can be generated.","Most Characteristic Feature of Image Display System ","As described earlier, if data unable to be controlled by CPU is developed in a GUI image, a probability of a key color hit increases and an intended image composition may not be performed. Data unable to be controlled by CPU includes still image data derived from BS digital data broadcast, image data on the Internet, natural image data taken by a digital camera or the like. In order to solve this, according to the embodiment, a GUI image drawing development is controlled as in the following when data broadcast is received at a digital television.",{"@attributes":{"id":"p-0118","num":"0117"},"figref":"FIG. 9"},"Step S:","The multi-picture control unit  detects addition information decoded by the data decoding unit  (addition information after data broadcast decoding). If the addition information is not detected at Step S, the flow stands by until the addition information is detected.","Step S:","If the addition information is detected at Step S, the multi-picture control unit  recognizes the picture layout information from the contents of the addition information. As described earlier, the data decoding unit  derives a scenario of a multimedia information service provider from an object described by a scenario descriptive language, such as MHEG-5, HTML and XML, the scenario being constituted of structural attributes (size, position, image type, coding method) of contents. The multi-picture control unit  analyzes this scenario to recognize the picture layout information.","Step S:","The multi-picture control unit  judges from the picture layout information recognized at Step S whether or not it is necessary to compose a GUI picture and a multi-picture.","Step S:","If it is judged at Step S that composition is unnecessary, then in accordance with the picture layout information recognized at Step S, the multi-picture control unit  issues a drawing command to the graphic accelerator  to develop a GUI picture in the memory unit .","Step S:","If it is judged at Step S that composition is necessary, the multi-picture control unit  executes the chroma key process to be described later. For example, the composition becomes necessary when a composite picture  such as shown in  is displayed, the composite picture  including a GUI picture supplied from a multimedia information provider during data broadcast and a multi-picture of BS digital broadcast.",{"@attributes":{"id":"p-0129","num":"0128"},"figref":"FIG. 11","b":"305"},"Step S:","In accordance with the addition information supplied from the data decoding unit , the multi-picture control unit  identifies object attributes of a GUI image to be developed on the GUI image area of one picture of the memory unit . The object attributes include the display position coordinate values (start and end points), text information, color management information, source attributes of moving\/still images, and the like, respectively of each object constituting a GUI picture.","Step S:","The multi-picture control unit  judges whether or not the attribute of all the object data identified at Step S has colors capable of being controlled, i.e., has no colors unable to be controlled.","Step S:","If it is judged at Step S that the attributes have no colors unable to be controlled, as shown in  the multi-picture control unit  develops the key color  in an area of the GUI picture  corresponding to the video areas and (where two moving images video  and video  are displayed in the multi-picture (composite video picture) , in order to superpose the multi-picture in the GUI picture.","Step S:","The multi-picture control unit  then develops the GUI picture drawing.","Step S:","If it is judged at Step S that the attribute has a color unable to be controlled by CPU (the attribute has colors capable of being controlled by CPU), then a key color is hit. For example, as shown in , if the GUI picture  contains object data  having colors unable to be controlled such as a natural picture, then a key color is hit in this area (natural picture area) containing the object data. In this case, in order to avoid a chroma key composition miss, the multi-picture control unit  sets a chroma key composition process area (rectangular mask area). More specifically, as shown in , a rectangular area  defined by start and end points  and  outside of the area for which the chroma key composition process can be performed without any problem, i.e., outside of the natural picture area, is set as the rectangular mask area.","Step S:","The multi-picture control unit  notifies the coordinate values of the start and end points  and  of the rectangular mask area  set at Step S and a chroma key composition method (e.g., a method of chroma key composing the rectangular mask area ), to the output composition unit  by using the signal S.","The natural picture area may be defined as a rectangular area, and an area outside of this rectangular area may be notified to the output composition unit  to be used as the area for which the chroma key composition process is executed.","After a notice is given to the output composition unit  at Step S, the processes at Steps S and S are executed. In this case, in the process of developing the GUI picture drawing at Step S, the natural image area is developed on the memory unit mainly by using DMA.","Upon reception of the notice of the rectangular mask area from the multi-picture control unit  at Step S, the output composition unit  performs chroma key decoding only in the rectangular mask area designated by the composition control unit . Namely, key color data is detected from the data read from the memory area only in the rectangular mask area, and if a key color bit is detected, a chroma key hit flag is set.","As above, if chroma key composition is required during reception of a digital television data broadcast, an object in the addition information of data broadcast to be composed as a GUI picture is recognized. If it is judged that there is an object whose color cannot be controlled by the multi-picture control unit , an area outside of the area containing such an object is set as the rectangular mask area for the chroma key composition process so that a chroma key composition miss can be avoided.","In the first embodiment, although one rectangular mask area is set for the chroma key composition, there is a case which requires two or more rectangular mask areas. In the second embodiment, a chroma key composition process to be used for such a case will be described.","In this embodiment, for example, as shown in , chroma key composition is performed for a multi-picture  made of images (video  to video ) input from four image sources and a GUI picture  having two natural picture areas and ","This chroma key composition process is performed, for example, in accordance with the flow chart shown in .","Step S:","The multi-picture control unit  specifies the number (m) of rectangular mask areas.","Fog example, as shown in , four areas to corresponding to the areas of video  to video  in a multi-picture area  are grouped, as shown in , into three areas including an area  corresponding to the area , an area  corresponding to the area , and an area  corresponding to the areas and . This state means that the chroma key composition process is performed only for these three areas (rectangular areas)  to , i.e., these rectangular areas  to  are used as the rectangular mask areas. In this example, the number (m) of rectangular areas specified at this Step S is \u201c3\u201d.","Step S:","The multi-picture control unit  judges whether the specified number (m) judged at Step S is equal to or smaller than a maximum specifying number N of rectangular areas supported by the system . It is assumed herein that the maximum specifying number N of rectangular areas is \u201c2\u201d. The maximum specifying number N of rectangular areas can be increased in correspondence with an increased number of horizontal\/vertical counters for a rectangular area. It is, however, preferable to set the number N to about 1 or 2 from the viewpoint of cost.","Step S:","If it is judged at Step S that the specified number (m) is larger than the maximum specifying number N of rectangular areas, the multi-picture control unit  performs an optimization process for rectangular mask areas.","More specifically, the multi-picture control unit  reconsiders the rectangular mask areas  to  shown in  so as not to make the specified number (m) larger than the maximum specifying number N of rectangular areas. For example, as shown in , an area outside of the two rectangular areas  and  corresponding to the natural image areas and (containing objects whose color is unable to be controlled by the multi-picture control unit ) is defined as the rectangular mask area for the chroma key composition. In this manner, the specified number (m) can be optimized so as not to exceed the maximum specifying number N.","Step S:","The multi-picture control unit  checks whether rectangular mask areas after the optimization process at Step S can be merged.","Step S:","If it is judged at Step S that the rectangular mask areas can be merged, the multi-picture control unit  checks the specified number (m) after merger. In this example, the specified number (m) is \u201c2\u201d. Thereafter, the flow returns to Step S to repetitively perform the Steps to follow.","If it is judged at Step S that the rectangular mask areas cannot be merged, a process (rectangular mask area number reduction process) is executed at Step S to thereafter advance to the Step S. The details of the process (rectangular mask area number reduction process) at Step S will be given later.","Step S:","If it is judged at Step S that the specified number (m) is not larger than the maximum specifying number N of rectangular areas, the multi-picture control unit  notifies, as described earlier, the output composition unit  of the coordinate values of the start and end points of the rectangular mask areas for the chroma key composition and a chroma key composition method (e.g., a method of chroma key composing the area other than the natural picture areas), as well as the specified number (m).","As described above, in accordance with the picture layout and the maximum specifying number N of rectangular mask areas, the system  optimizes the specified number (m) of rectangular mask areas. It is therefore possible to provide a highly flexible and low cost apparatus or system capable of composing a multi-picture and a GUI picture.","In the third embodiment, the process (rectangular mask area number reduction process) at Step S is executed in the following manner. This process is executed under the condition that although it is judged at Step S that the rectangular mask areas cannot be merged, it is judged that only the optimization of rectangular mask areas cannot set the specified number (m) lower than the maximum specifying number N.",{"@attributes":{"id":"p-0166","num":"0165"},"figref":"FIG. 16"},"Step S:","The multi-picture control unit  judges whether an object (such as a natural picture) with uncontrollable color to be developed in each rectangular mask area optimized at Step S has a moving image attribute.","Step S:","If it is judged at Step S that the object has a moving image attribute, the multi-picture control unit  determines the rectangular mask area with the moving image attribute as an area for the chroma key composition. Generally, display defects to be caused by a chroma key composition miss are not more conspicuous in a moving image than in a still image. In this embodiment, therefore, an object with a moving image attribute is subjected to a chroma key composition process. The flow is terminated thereafter.","Step S:","If it is judged at Step S that the object has no moving image attribute, i.e., if the object is a still image, the multi-picture control unit  calculates a drawing developing area of each still image object in the rectangular mask area.","Step S:","The multi-picture control unit  identifies a rectangular mask area having the smallest area calculated at Step S. The process at Step S is performed for the rectangular mask area identified as having a smallest area calculated at Step S. In this manner, the still image having the smallest area is preferentially subjected to the chroma key composition so that display defects to be caused by a chroma key composition miss can be made not conspicuous as much as possible.","As described above, an object having less display defects to be caused by a chroma key composition miss is not designated as the rectangular mask area to reduce and optimize the specified number (m). It is therefore possible to provide a highly flexible and low cost apparatus or system capable of composing a multi-picture and a GUI picture.","In the above-described embodiments, a multi-picture and a GUI picture are composed which are generated from image data supplied from a plurality of image sources. The invention is not limited only to such a case, but it is also applicable to the case wherein in a system for composing a sub-picture and a main-picture generated by image data supplied from an image source, the sub-picture contains color unable to be controlled by a CPU for controlling a chroma key process.","The objects of the invention may be achieved by supplying a storage medium storing software program codes realizing the function of a host or terminal of each of the first to third embodiments to a system or an apparatus, and reading and executing the program codes stored in the storage medium by a computer (CPU or MPU) of the apparatus or system.","In this case, the software program codes themselves read from the storage medium realize the function of each of the first to third embodiments. Therefore, the storage medium storing program codes constitutes the present invention.","The storage medium for storing such program codes may be a ROM, a floppy disk, a hard disk, an optical disk, a magneto optical disk, a CD-ROM, a CD-R, a magnetic tape, a nonvolatile memory card, or the like.","The scope of the invention also includes not only the case wherein the function of each of the first to third embodiments can be realized by executing read program codes by a computer but also the case wherein the function of each of the first to third embodiments can be realized by executing a portion or a whole of actual processes in accordance with the program codes by an OS or the like running on a computer.","The scope of the invention also includes the case wherein the function of each of the first to third embodiments can be realized by writing the program codes read from a storage medium into a memory of a function expansion board inserted into a computer or of a function expansion unit connected to the computer, and thereafter by executing a portion or the whole of actual processes in accordance with the program codes by a CPU of the function expansion board or function expansion unit.","As described so far, according to each embodiment of the invention, when an image having color unable to be controlled by a graphic accelerator controller (GUI picture control unit such as CPU) is developed in a display memory and if the image has a high probability of a key color hit during a chroma key composition process, the chroma key composition process for the image area can be masked. It is therefore possible to reduce the capacity of a memory used for composing a multi-picture and a GUI picture and to improve a precision of a chroma key composition process.","An apparatus or system can be provided which is suitable for properly balancing a tradeoff between contradictory matters of improved versatility of digital home appliances and cost reduction thereof.","Many widely different embodiments of the present invention may be constructed without departing from the spirit and scope of the present invention. It should be understood that the present invention is not limited to the specific embodiments described in the specification, except as defined in the appended claims."],"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS"],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":["FIG. 4","FIG. 1"]},{"@attributes":{"id":"p-0021","num":"0020"},"figref":["FIG. 5","FIG. 1"]},{"@attributes":{"id":"p-0022","num":"0021"},"figref":["FIG. 6","FIG. 3"]},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":["FIG. 9","FIG. 1"]},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 12"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":["FIG. 13","FIG. 12"]},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 15"},{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 16"}]},"DETDESC":[{},{}]}
