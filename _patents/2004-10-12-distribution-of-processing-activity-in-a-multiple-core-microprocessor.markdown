---
title: Distribution of processing activity in a multiple core microprocessor
abstract: Distribution of processing activity across processing hardware based on power consumption and/or thermal considerations. One embodiment includes a plurality of processing units and a monitor to obtain monitor (e.g., power consumption, or temperature or some combination thereof) values from the processing units. The monitor transfers a process from one processing unit to another in response to the monitor values from the processing units.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07043405&OS=07043405&RS=07043405
owner: Intel Corporation
number: 07043405
owner_city: Santa Clara
owner_country: US
publication_date: 20041012
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["RELATED APPLICATIONS","BACKGROUND","DETAILED DESCRIPTION"],"p":["This application is a continuation of application Ser. No. 10\/020,568, filed Dec. 6, 2001, now U.S. Pat. No. 6,804,632.","1. Field","The present disclosure pertains to the field of electronic components. More particularly, the present disclosure pertains to distributing processing activity across various components or portions of components based on power consumption and\/or thermal considerations.","2. Description of Related Art","Effectively monitoring and adjusting the consumption of power and the consequent generation of heat of electronic components is an ongoing struggle. Electronic components such as integrated circuits continue to pack more and more functionality into a smaller area. The result of such increasing density of logic is typically an increase in the power density, the power consumed per unit of area. Higher power consumption per unit area typically results in higher heat generation per unit area. Thus, while increased processing throughput may be achieved by increasing logic density, new and innovative techniques may be desirable to contend with the resultant thermal issues.","Prior art thermal and\/or power control apparatuses are typically driven by one or both of two concerns. The first concern is device or system temperature. An electronic device typically has a particular maximum operating temperature, above which damage to the device may occur. Some power consumption limiting techniques aim to prevent electronic devices from surpassing their maximum operating temperature. Reduction of power consumption by reducing operating frequency, operating voltage, or otherwise reducing processing is often done in response to an elevating or elevated temperature (see, e.g., U.S. Pat. No. 5,838,578, \u201cMethod and apparatus for programmable thermal sensor for an integrated circuit\u201d). Thus, the typical response is to lower the overall processing level when the temperature is perceived as being too high. Clearly, however, performance may be negatively impacted when the overall processing level is reduced.","A second concern is simply the amount of power being consumed. Often, the design of portable devices is to a large extent driven by battery life. To improve battery life, aggressive power consumption limiting techniques are often employed. These power saving techniques are often triggered by the amount of processing occurring (with aggressive cutbacks upon signs of idle hardware), user selections, the removal of an A\/C power source, etc. Again, the typical response is to reduce the overall level of processing or the overall set of enabled hardware by shutting down any idle portions. Here too, the reduction in overall processing obviously can impact performance. Techniques that attempt to power down only idle hardware may impact performance because there may be some latency associated with restarting the hardware or bringing it back up to speed.","Thus, most power consumption control techniques focus on idling existing hardware when not in use or simply reducing the overall throughput or processing level (via voltage, frequency, etc.) to control overall temperature. As power consumption continues to increase in importance as a design consideration, novel techniques to contend with power consumption are desirable.","The following description discusses the distribution of processing activity across processing hardware based on power consumption and\/or thermal considerations. In the following description, numerous specific details such as logic implementations, system types, processing logic types, and logic partitioning\/integration choices are set forth in order to provide a more thorough understanding of the present invention. It will be appreciated, however, by one skilled in the art that the invention may be practiced without such specific details. In other instances, control structures and gate level circuits have not been shown in detail in order not to obscure the invention. Those of ordinary skill in the art, with the included descriptions, will be able to implement appropriate logic circuits without undue experimentation. While one embodiment is directed to a microprocessor with multiple cores, the techniques described may more generally be applied to other types of electronic components or across several components.","Various disclosed embodiments re-distribute processing tasks, threads, or computations to different portions of hardware based on power consumption and\/or thermal considerations. For example, in one embodiment, processes may be switched between different cores of a multi-core processor. Some embodiments may advantageously spread high power consumption tasks or processes between different processing units. Such spreading or distribution of processes over different hardware may beneficially reduce the peak temperature that is reached by a processing unit. Since some hardware components operate more efficiently at cooler temperatures, more efficient operation (and hence less overall power consumption) may be achieved via the resulting lower overall temperatures in some embodiments. Moreover, in some embodiments, such advantages may be obtained while substantially maintaining performance levels because \u201chot\u201d and \u201ccool\u201d processes may be swapped between particular hardware units, without necessarily requiring the idling of hardware to achieve some cooling. Additionally, in some embodiments, monitoring techniques may allow independent control of the voltages and operational frequencies of different processing units or cores.",{"@attributes":{"id":"p-0020","num":"0019"},"figref":["FIG. 1","FIG. 1"],"b":["100","1","100","2","100","110","110","100","1","100","110"]},"Each processing unit provides a monitor value that typically reflects power consumption and\/or temperature information to the monitor  via signals such as Power Consumption (PC) lines PC- through PC-N. The monitor value may take a variety of forms and may be a variety of different types of information. For example, the monitor value may simply be an analog or digital reading of the temperature of each processing unit. Alternatively, the monitor value may be a simple or complex activity factor that reflects the operational activity of a particular processing unit. In some embodiments, power consumption information reflected by the monitor value may include a measured current level or other indication of how much power is being consumed by the processing unit. Additionally, some embodiments may convey power consumption information to the monitor  that is a composite of several of these or other types of known or otherwise available means of measuring or estimating power consumption. Accordingly, some power consumption metric which reflects one or more of these or other power consumption indicators may be derived. The transmitted monitor value may reflect a temperature or a power consumption metric, which itself may factor in a temperature. Serial, parallel, and\/or various known or otherwise available protocols may be used to transmit this information to the power monitor.","The monitor  receives the power consumption information from the various processing units and analyzes whether power consumption between the units is sufficiently uneven to justify the overhead of re-allocating processes to different processing units. For example, the monitor may be triggered to rearrange processes when a particular processing unit reaches a certain temperature, when a selected temperature differential is achieved between different processing units, when power consumption has been at a selected level for a selected amount of time, etc. The monitor  may develop a total power consumption metric to indicate the total power consumption or total thermal state of all processing units to effectuate the various power control strategies. The monitor  may be a hardware component, a software component, routine, or module, or a combination of hardware and software.","The monitor communicates to the processing units via Thread or Process Swap Control (SC) lines SC- through SC-N. The monitor is capable of moving and exchanging processes by sending commands via the SC lines. Thus, processes can be swapped between processing units, rotated between processing units, etc., in response to the particular chosen thermal or power consumption metric being reached. Alternatively, or in addition to power consumption metric triggered process management, process rotation between processing units may be periodically performed to level the load between the processors.","Many different types of processing devices could benefit from the use of such process re-allocation techniques. For example, the processing units - through -N may be general purpose processors (e.g., microprocessors) or may be microprocessor cores for a multiple core (on a single die) microprocessor. Alternatively, digital signal processors, graphics processors, network processors, or any type of special purpose processor that may be used in a system with multiple parallel units or cores may benefit from thermally (or power) motivated process shifting between processing units. The processing units or processors may be identical or have at least partial functional overlap. That is, each processing unit has some common set of instructions or commands such that there are at least some (if not all) processes that can be executed on more than one processing unit or processor.",{"@attributes":{"id":"p-0025","num":"0024"},"figref":["FIG. 2","FIG. 2","FIG. 2"],"b":["200","225","205","245","225","1","230","2","235","225"]},"In the embodiment of , a power monitor  receives information from both cores to allow analysis of power consumption and\/or temperature for each specific core as well as the overall processor. In particular, in the embodiment of , the core  includes a thermal sensor . The power monitor  is coupled to receive data from the thermal sensor . Likewise, the core  includes a thermal sensor , which provides information about the thermal state of the second core  to the power monitor . Typically, integrated circuit thermal sensors located in the vicinity of or within the particular core may be used to provide a relatively accurate assessment of the thermal state of that core. A set of thermal sensors may also be spread over an area to provide a more accurate reading.","Various thermal sensors are known in the art and the particular technique used is not particularly germane to the present invention. Moreover, known substitutes for measuring temperature or power consumption may be used. For example, basic measurements of activity level, current received, etc., may also provide a power consumption metric adequate for the power monitor  to make process swapping decisions.","The power monitor  of this embodiment includes various modules, including a move module , a sum module , a shutdown module , and an exchange module . The power monitor  and\/or each module may be entirely hardware (perhaps including microcode) and therefore built in to the dual core processor , or may rely on additional external software, firmware, or configuration settings to control or assist with tracking and migration of processes from one core to the other.","The exchange module  is capable of performing an exchange operation between the two cores. One embodiment of a monitoring sequence including an exchange operation is shown in . In block , the current power (CP) is sensed for the two cores (e.g., cores  and ). As previously discussed, the current power measurement may include a variety of power consumption metrics, typically metrics averaged, integrated, or otherwise calculated over time. The current power consumption of the two processors is compared, as indicated in block . While block  indicates a test of whether CP()>>CP(), the converse test of whether CP()>>CP() would typically also be performed, as may comparisons between numerous processing units in embodiments with more than two processing units. If there is a large discrepancy between the two power consumption values, it may be desirable (though not required, depending on the metric used) to wait until a particular time elapses as indicated in block . If there is not a large discrepancy between the two, the procedure may return to sensing the current power consumption in block .","When the power monitor  detects that the power consumed by one core is very high compared to the second core over some period of time in block , the power monitor  exchanges (blocks  and ) the location of the running processes. In some embodiments, such an exchange may help to avoid hot spots. For example, the first core  may be running process A and the second core  running process B. Since the core  reaches a significantly higher temperature over a period of time, process A is deemed to be a \u201chotter\u201d process than process B. Accordingly, the overall distribution of the power consumption of the entire die could be improved by moving process A to the second core  and the process B to the first core  for some time to equalize the core temperatures. In some embodiments, swapping may be of larger concern when one processing unit exceeds some threshold level of power consumption. For example, swapping may be limited to times when CP is greater than a particular threshold and CP is much greater than CP. Such an embodiment avoids the overhead of process swapping when the overall power consumption is not high enough to justify such process swapping.","As indicated in block , in response to the detection of the substantial core power consumption imbalance in block , each processor is signaled to save its state. In one embodiment, the power monitor  generates a trap or an interrupt. In many general purpose processors, traps or interrupts are already designed to allow the processor to save its context for later resumption. Thus, an existing trap or interrupt routine or a special purpose trap or interrupt routine may be used to force the core to save its state in a manner similar to other known state saving operations used to accommodate disruptive events without losing information. Alternatively, portions of existing microcode routines or modified routines for traps may be utilized. As previously mentioned, in some embodiments it may be advantageous to use the shared cache  to perform on-die exchanges between two cores of a multi-core processor. Thus, state  for process A and state  for process B may be stored in the cache .","As indicated in block , after each processor has saved its state, each processor resumes using the state saved by the other processor. Thus, core  resumes process B by restoring state  instead of restoring the state it saved from process A. Likewise, core  resumes process A by restoring state . Various techniques may be used to ensure the other state is restored. For example, a microcode routine could be used to alter the location from which the processor restores its state. Alternatively, the cache or other logic could swap which state is returned to which processor. The process swap may be done with operating system assistance in some embodiments, but operating system assistance is not required, and some embodiments implement process swapping without alerting the operating system and\/or gaining assistance from the operating system. Whatever particular technique is chosen, the processes A and B resume execution on a different core.","Another operation that may be performed by the power monitor  is a shutdown operation, which is performed by a shutdown module . The shutdown operation may be performed either in response to a core reaching a failsafe temperature threshold requiring shutdown to avoid damage or failure or because the core is idle. In either case, the core is shut down. In some embodiments, shutdown may involve saving the state of the core that is shut down. Additionally, power may be removed from the power well of that core. For example, as shown in , the core  may be in a power well  that is separate from the power well  for the core . Power may be shut off to just one of the power wells.",{"@attributes":{"id":"p-0034","num":"0033"},"figref":["FIG. 4","FIG. 3"],"b":["280","400","410","2","2","410","2","420","430","440"]},"Another operation that may be performed by the power monitor  is a sum operation, which is performed by a sum module . The sum operation assists in assuring that the total sum of power of all processing units controlled by a power monitor falls within a desired power envelope. If the power exceeds the prescribed limit, the power monitor in response throttles processing (e.g., decrease voltage and\/or frequency of some of the cores).","Additionally, the sum module  ensures that processing throughput is increased to the extent possible given the desired thermal envelope. Thus, the sum module may also detect when the total power consumption falls below a certain level. Voltages or frequencies to one or both of the cores may be ratcheted up in order to improve performance when the sum module detects that overall power consumption is below a selected power consumption metric.","The flow diagram of  illustrates a monitoring sequence for one embodiment when multiple processing units are active. The sequence of  includes exchanges and increasing or decreasing processing in response to summing operations. Notably, as with other flow diagrams, the operations illustrated are not necessarily performed sequentially or if they are performed sequentially, they are not necessarily performed in the illustrated order in all cases. In the illustrated embodiment, exchanges are performed as needed, as indicated in block . Thus, high and low power processes are swapped between processing units in order to even out the physical distribution of the power consumption. Additionally, as indicated in block , the sum of total power consumed by both cores is calculated (e.g., by the sum module).","The sum total is compared to the desired power envelope for the system or the processor itself. One of skill in the art determines a power or thermal envelope for a part depending on the thermal characteristics of the materials used to build that part, the system environments in which that part is used, the desired performance, and other factors. Similarly, a power or thermal envelope for the system may be determined. In block , whether the sum total of power consumption is too high is tested. If the sum total of power consumption is not too high, then the process begins again at block . If the sum total of power consumption is too high, then operations are throttled as indicated in block  and as previously described with respect to the sum module. If not, then the process returns to block .","In block , whether the sum total of power consumption is too low is tested. If not, then the process begins again at block . If the sum total of power consumption is too low given the desired system power or thermal envelope, then the process continues with block  in . In block , whether both processors are active and the power is still too low is tested. If both processors are active, then voltage and\/or frequency to both processors may be increased as indicated in block . For example, in the embodiment of , the voltage level to the two power wells may be increased and\/or a clock frequency for each core  and  may be increased. In another embodiment, the voltage or frequency of one of the two processors may be favored over the other. For example, the operating system may provide control settings indicating which processor or process to favor if additional processing power is available. Alternatively, the processor may develop an indication of which processor or process tends to consume more power over time, and may favor that process with additional power, should the present level of processing only put the processor at the low or safe end of its thermal envelope. Whether the executing processes would benefit from additional processing power may also be considered in some embodiments. Thus, in some embodiments, no adjustments are made despite being at the low end of a thermal envelope if the executing processes are progressing adequately.","If both processors are not active and the power too low in block , then whether a first one of the processors is inactive is tested in block . If so, then the voltage and\/or frequency to the other processor may be increased, as indicated in block . On the other hand, if the first processor is not inactive, then block  tests whether the second processor is inactive. If so, the voltage and\/or frequency to the first processor may be increased in block .","Accordingly, when a processor is operating at the low end of its thermal envelope, the processing of either or both cores may be increased appropriately. Moreover, such techniques can of course be applied to any of a variety of processing units as previously discussed. Processing may be shifted about between units, cores, circuits, modules, etc., to more evenly distribute heat generation across these various components and\/or to increase the amount of processing that can be performed given a thermal or power envelope.","Finally, the power monitor  may include a battery mode optimization module (not shown). The battery mode optimization module may allow the dual core processor to only operate one of the two cores when operating on battery power (or when battery power falls below a selected threshold). Once the system is connected to alternating current power (or the battery is recharged), both cores may be operated for higher performance.",{"@attributes":{"id":"p-0043","num":"0042"},"figref":["FIG. 7","FIG. 7"],"b":["720","700","705","715","710","705","715"]},"The processor  is coupled to a memory interface , which is coupled to a memory  and a media interface . Other known or otherwise available system arrangements may be used as will be appreciated by one of skill in the art. The memory  includes an operating system  which includes a power monitor routine such as an application programming interface (API) and a scheduler. In this embodiment, the OS provides a power monitor API in order to acquire information about the computational intensity or the likely power consumption of particular processes to the operating system. Information about the computational intensity of a program may be provided by the program itself, by a user, or derived from execution of the program. With this information, the operating system scheduler can avoid scheduling multiple high power applications on one processor. Rather, the operating system can assist in leveling the distribution of the power consumption by scheduling high power processes on different processors.","Additionally, the operating system (or other routines in memory) may provide some or all of the power monitor functionality. As indicated in , the processor communicates on-die estimated process power to the operating system or other software. The software can then determine when it would be desirable to move, swap, etc., processes as previously described. Moreover, software may be responsible for summing and other operations. Furthermore, software estimation techniques may be used instead of on-die sensors or estimation logic.","The appropriate software to perform these various functions may be provided in any of a variety of machine readable mediums. The media interface  provides an interface to such software. The media interface  may be an interface to a storage medium (e.g., a disk drive, an optical drive, a tape drive, a volatile memory, a non-volatile memory, or the like) or to a transmission medium (e.g., a network interface or other digital or analog communications interface). The media interface  may read software routines from a medium (e.g., storage medium  or transmission medium ). Machine readable mediums are any mediums that can store, at least temporarily, information for reading by a machine interface. This may include signal transmissions (via wire, optics, or air as the medium) and\/or physical storage media  such as various types of disk and memory storage devices. In any case, the power monitoring functionality may in some cases be provided wholly or in part by software routines.","Thus, a method and apparatus for distribution of processing activity across processing hardware based on power consumption and\/or thermal considerations are disclosed. While certain exemplary embodiments have been described and shown in the accompanying drawings, it is to be understood that such embodiments are merely illustrative of and not restrictive on the broad invention, and that this invention not be limited to the specific constructions and arrangements shown and described, since various other modifications may occur to those ordinarily skilled in the art upon studying this disclosure."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE FIGURES","p":["The present invention is illustrated by way of example and not limitation in the Figures of the accompanying drawings.",{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":["FIG. 6","FIG. 5"]},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 7"}]},"DETDESC":[{},{}]}
