---
title: Video stabilization
abstract: Method, device and computer program product for stabilizing a video signal. A plurality of frames of the video signal are captured using a camera. A motion sensor associated with the camera is used to generate a plurality of samples representing motion of the camera. The samples are used to determine a displacement of the camera between a first time and a second time, wherein the first time corresponds to an exposure time midpoint of a first frame of the video signal and the second time corresponds to an exposure time midpoint of a second frame of the video signal. The determined displacement is used to compensate for motion in the video signal between the first and second frames caused by the motion of the camera, to thereby stabilize the video signal.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08711233&OS=08711233&RS=08711233
owner: Skype
number: 08711233
owner_city: Dublin
owner_country: IE
publication_date: 20111115
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["RELATED APPLICATION","TECHNICAL FIELD","BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"p":["This application claims priority under 35 U.S.C. \u00a7119 or 365 to Great Britain Application No. GB 1109071.9, filed May 31, 2011. The entire teachings of the above application are incorporated herein by reference.","The present invention relates to stabilization of a video signal. In particular, the present invention relates to capturing frames of a video signal using a camera and compensating for motion of the camera to thereby stabilize the video signal.","Cameras can be used to capture a sequence of images to be used as frames of a video signal. Cameras may be fixed to stable objects, for example a camera may be mounted on a stand such as a tripod to thereby keep the camera still while the video frames are captured. However, often cameras may be implemented in mobile devices and are not necessarily mounted to fixed objects, for example a camera may be held, or may be on a moving object such as a vehicle. Movement of the camera while the camera is capturing frames of a video signal may result in unwanted movement in the video signal itself.","Image stabilization is a method that can be used to compensate for the unwanted movement in a video signal. Some systems perform motion estimation in order generate motion vectors for use by an image stabilization process. One such system is described in \u201cOnline Video Stabilization Based on Particle Filters\u201d by Junlan Yang et. al. Image stabilization algorithms may consist of three main parts: motion estimation, motion smoothing and motion compensation. A motion estimation block may estimate local motion vectors within the video signal and on the basis of these local estimates calculate a global motion vector. A motion smoothing block may then deal with filtering of the estimated global motion vector in order to smooth the calculated value and prevent large and undesirable differences between motion vectors calculated previously. A motion compensation block may then shift an image in the opposite direction to the filtered global motion vector to thereby stabilize the video signal. The motion compensation block may take into account sophisticated transformations like rotation, warping or zooming.","It can require large amounts of processing resources to perform image stabilization based on motion vectors as described above. This can be a problem when the video signal is to be stabilized in real time, i.e. when a stabilized version of the video signal is to be used (e.g. transmitted in a video call or output from a device) at the same time as it is being captured by the camera. This can also be a problem when the device which is performing the image stabilization is a small, mobile device such as a mobile telephone in which the processing resources are limited.","In recent years, motion sensors have become simpler and cheaper to manufacture and the size of motion sensors has reduced significantly. It is now feasible to implement motion sensors in mobile devices. Motion sensors generate samples representing the motion of the sensor. Two documents: \u201cUsing Sensors for Efficient Video Coding in Hand-held devices\u201d by Andy L. Lin and \u201cAccelerometer Based Digital Video Stabilization for General Security Surveillance Systems\u201d by Martin Drahansk\u00fd et. al, mention the possibility of using data from motion sensors for stabilization of a video signal.","The inventors have realised that the implementation of using data from motion sensors for stabilization of a video signal can be improved compared to the systems of the prior art. In particular, the inventors have considered factors such as: handling non-uniformly sampled sensor data; synchronization of sampled sensor data with the timing of frames of the video signal taking the shutter speed of the camera into account; fast pixel shifting of an image of one of the frames of the video signal by pointer modification; and how to select sensor sampling rate. These factors have not been considered in the references cited in the background section above.","According to a first aspect of the invention there is provided a method of stabilizing a video signal, the method comprising: capturing a plurality of frames of the video signal using a camera; using a motion sensor associated with the camera to generate a plurality of samples representing motion of the camera; using the samples to determine a displacement of the camera between a first time and a second time, wherein the first time corresponds to an exposure time midpoint of a first frame of the video signal and the second time corresponds to an exposure time midpoint of a second frame of the video signal; and using the determined displacement to compensate for motion in the video signal between the first and second frames caused by the motion of the camera, to thereby stabilize the video signal.","Time stamps provided by the camera for the frames of the video signal may relate to the time at which a shutter of the camera closes (i.e. the end time of the frame). However, the inventors have identified that in order to effectively determine the displacement (e.g. an angular displacement) between the first and second frames of the video signal using data from the motion sensor (e.g. a rotational motion sensor), it is advantageous to determine the displacement of the camera between the midpoints of the exposure times of the frames. Using the midpoints of the exposure times of the frames provides a more accurate representation of the displacement of the camera between the first and second frames. When mapping camera displacement to pixel displacement, this method provides better estimation of pixel displacement than using the end times of the frames.","In preferred embodiments, the motion of the camera is rotational motion, the motion sensor is a rotational motion sensor and the displacement of the camera is an angular displacement of the camera. The using of the samples to determine an angular displacement of the camera between a first time and a second time may comprises: determining an angular velocity of the camera using the samples; and integrating the determined angular velocity over time from the first time to the second time to thereby determine the angular displacement of the camera between the first time and the second time.","In one embodiment, the angular displacement of the camera between the first time and the second time is given by the equation:",{"@attributes":{"id":"p-0013","num":"0012"},"maths":{"@attributes":{"id":"MATH-US-00001","num":"00001"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"\u0394\u03b8","mo":"=","mrow":{"mover":{"munder":{"mo":"\u222b","mrow":{"msub":{"mi":"t","mn":"1"},"mo":"-","mrow":{"mn":"0.5","mo":"\u2062","msub":{"mi":"e","mn":"1"}}}},"mrow":{"msub":{"mi":"t","mn":"2"},"mo":"-","mrow":{"mn":"0.5","mo":"\u2062","msub":{"mi":"e","mn":"2"}}}},"mo":"\u2062","mrow":{"mrow":[{"mi":"\u03c9","mo":"\u2061","mrow":{"mo":["(",")"],"mi":"t"}},{"mo":"\u2146","mi":"t"}],"mo":"\u2062"}}}}},"br":{},"sub":["1 ","2 ","1 ","2 "]},"The integrating of the determined angular velocity may comprise interpolating the angular velocity between the times at which the samples are generated and the method may further comprise delaying the video signal thereby allowing the angular velocity of the camera at the second time to be determined by said interpolating the angular velocity between the times at which the samples are generated.","The method may further comprise extrapolating the angular velocity determined using the samples to thereby determine the angular velocity of the camera at the second time.","The sample rate of the samples generated using the motion sensor may be higher than the frame rate of the video signal. Furthermore, the camera and the motion sensor may be situated within a mobile device.","The using of the determined displacement to compensate for motion in the video signal between the first and second frames caused by the motion of the camera may comprise: determining a pixel displacement representing motion in the video signal between the first and second frames caused by the determined displacement of the camera; filtering the pixel displacement; and shifting the image of at least one of the first and second frames in accordance with the filtered pixel displacement to thereby stabilize the video signal. The filtering of the pixel displacement may comprise: determining an accumulated pixel displacement based on said determined pixel displacement for the second frame; and determining a filtered accumulated pixel displacement for the second frame based on a weighted sum of the determined accumulated pixel displacement for the second frame and a filtered accumulated pixel displacement for the first frame.","The method may further comprise adding a time offset to at least one of (i) the captured plurality of frames, and (ii) the generated plurality of samples, such that the timing of the captured plurality of frames matches the timing of the generated plurality of samples.","According to a second aspect of the invention there is provided a device for stabilizing a video signal, the device comprising: a camera configured to capture a plurality of frames of the video signal; a motion sensor, associated with the camera, configured to generate a plurality of samples representing motion of the camera; a displacement determining block configured to use the samples to determine a displacement of the camera between a first time and a second time, wherein the first time corresponds to an exposure time midpoint of a first frame of the video signal and the second time corresponds to an exposure time midpoint of a second frame of the video signal; and a motion compensation block configured to use the determined displacement to compensate for motion in the video signal between the first and second frames caused by the motion of the camera, to thereby stabilize the video signal.","The motion sensor may be a gyroscopic motion sensor. The device may be a mobile device.","According to a third aspect of the invention there is provided a method of stabilizing a video signal, the method comprising: capturing a plurality of frames of the video signal using a camera; determining a pixel displacement representing motion in the video signal between first and second frames of the video signal caused by motion of the camera; and shifting an image of at least one of the first and second frames in accordance with the pixel displacement to thereby stabilize the video signal, wherein the image comprises a stride value indicating memory space of the image, a plurality of pixel values, a pointer indicating the position of a first pixel of the image, and a width value indicating the width of the image, wherein said shifting of the image comprises adjusting the pointer and the width value without adjusting the stride value.","In this way, the image may be shifted and resized by simply changing the pointer and the width value whilst keeping the stride value constant. In this way, no copying of data in memory is necessary. In other words, instead of copying a crop area into a new memory area (which can be a complex process), an image representation is used that allows for independent width and stride values. In this way, a new image can be created by changing the pointer and the width value while the stride is kept intact (which is a simpler process than copying a crop area into a new memory area).","The image may comprise a plurality of image planes which are each represented by a respective plurality of pixel values, a respective pointer indicating the position of a first pixel of the image plane, and a respective width value indicating the width of the image plane, wherein the image planes may be shifted together by adjusting their respective pointers and width values without adjusting the stride value.","The method may further comprise rounding the determined pixel displacement to an integer-pixel displacement.","The method may further comprise: using a motion sensor associated with the camera to generate a plurality of samples representing motion of the camera; and using the samples to determine a displacement of the camera between a first frame of the video signal and a second frame of the video signal, wherein the determined displacement is used to determine said pixel displacement.","The method may further comprise filtering the pixel displacement.","According to a fourth aspect of the invention there is provided a device for stabilizing a video signal, the device comprising: a camera configured to capture a plurality of frames of the video signal; a pixel displacement determining block configured to determine a pixel displacement representing motion in the video signal between first and second frames of the video signal caused by motion of the camera; and an image shifting block configured to shift an image of at least one of the first and second frames in accordance with the pixel displacement to thereby stabilize the video signal, wherein the image comprises a stride value indicating memory space of the image, a plurality of pixel values, a pointer indicating the position of a first pixel of the image, and a width value indicating the width of the image, wherein the image shifting block is configured to shift the image by adjusting the pointer and the width value without adjusting the stride value.","According to a fifth aspect of the invention there is provided a method of stabilizing a video signal, the method comprising: capturing a plurality of frames of the video signal using a camera; determining a portion of motion of the camera occurring whilst a shutter of the camera is closed and not whilst the shutter of the camera is open; determining a pixel displacement representing motion in the video signal between first and second frames of the video signal caused by, and corresponding to, the portion of motion of the camera; and shifting an image of at least one of the first and second frames in accordance with the pixel displacement to thereby stabilize the video signal.","In this way, image stabilization may be reduced when motion blur is present in the video signal. For high levels of camera motion, motion blur will be present in the frames of the video signal for devices without physical stabilization, such as optical or mechanical stabilization. Motion blur is caused when the camera moves whilst the shutter of the camera is open and capturing one frame of the video signal. If image stabilization were applied for frames containing motion blur, the resulting video signal will contain motion blur but no motion which can be detrimental because a user viewing the video signal may perceive this to look strange and\/or unnatural. The inventors have realised that it may be beneficial to have no compensation for motion that is made during the time interval when the camera shutter is open. If the exposure time (i.e. the time for which the shutter is open) is very short, then having no compensation for motion that occurs whilst the shutter is open will not make a significant difference. However, if the exposure time (i.e. the time for which the shutter is open) is very long, then little stabilization will be applied to the video signal. Furthermore, motion blur will be accompanied by the corresponding motion in the video signal, which may be perceived as more natural to a user viewing the video signal.","The method may further comprise: using a motion sensor associated with the camera to generate a plurality of samples representing the portion of motion of the camera; and using the samples to determine a displacement of the camera between the first frame of the video signal and the second frame of the video signal, wherein the determined displacement is used to determine said pixel displacement.","According to a sixth aspect of the invention there is provided a device for stabilizing a video signal, the device comprising: a camera configured to capture a plurality of frames of the video signal; a motion determining block configured to determine a portion of motion of the camera occurring whilst a shutter of the camera is closed and not whilst the shutter of the camera is open; a pixel displacement determining block configured to determine a pixel displacement representing motion in the video signal between first and second frames of the video signal caused by, and corresponding to, the portion of motion of the camera; and an image shifting block configured to shift an image of at least one of the first and second frames in accordance with the pixel displacement to thereby stabilize the video signal.","According to a seventh aspect of the invention there is provided a computer program product for stabilizing a video signal, the computer program product being embodied on a non-transient computer-readable medium and configured so as when executed on a processor of a device to perform the operations of any of the methods described herein.","There are described herein methods for using motion sensor data to remove camera shaking (and other motion of the camera) from a video signal to thereby stabilize the video signal, for example for use in a mobile device. The methods may comprise synchronising sensor data with camera frames and, in particular, determining the angular displacement at the midpoint of the exposure time. The methods may comprise filtering image displacement values using an exponential filter suitable for use with non-uniformly sampled sample data from the motion sensor. The methods may comprise modifying the position of a pointer for shifting and\/or cropping an image of a frame of the video signal based on determined motion of the camera. The methods may comprise adapting image stabilization for frames of the video signal containing motion blur.","Preferred embodiments of the invention will now be described by way of example only.",{"@attributes":{"id":"p-0041","num":"0040"},"figref":["FIG. 1","FIG. 1"],"b":["100","100","100","102","104","106","108","102","104","100","104","102","100","104","102","106","100","108","100","102","104","106","108","100"]},"With reference to  there is now described a process of stabilizing a video signal using the device  according to a preferred embodiment. In step S the camera  captures images to be used as frames of a video signal. For example, the camera  may have an array of light sensors which record the level of light that is incident on the sensors during the time allocated to a frame of the video signal. A shutter of the camera  is used to separate the frames in time, such that during each frame the shutter is open for a period of time and closed for another period of time. The captured frames of video signal are provided to a pre-processor (e.g. implemented in a processing block by the CPU ). The pre-processor operates to stabilize the images in the frames of the video signal before the frames are encoded using a video encoding technique as is known in the art.","In step S, while the camera  is capturing frames of the video signal, the motion sensor  generates samples representing the motion of the device . For example, the motion sensor  may be a rotational motion sensor such as a gyroscope. The gyroscope  measures angular velocity of the device  and outputs samples representing the angular velocity at particular intervals. The intervals may, or may not, be regular intervals. Preferably, but not necessarily, on average the sample rate of the samples output from the gyroscope  is higher than the frame rate of the video signal. For example, the sample rate output from the gyroscope  may be 60 samples per second, which reflects the maximum usual shaking frequency of the device  and is currently independent of frame rate. The samples generated by the gyroscope  are provided to the pre-processor.","In step S the angular displacement of the camera  between two frames (frame  and frame ) of the video signal is determined. This determination may be performed by a processing block of the CPU . The inventors have identified that in order to effectively determine the angular displacement between the two frames using data from the gyroscope , it is useful to integrate the angular velocity over the time interval between the midpoints of the exposure times of the frames captured by the camera . The inventors have also determined that this can be particularly problematic as it may not be possible to synchronise the sampling rate of the gyroscope  with the frame rate of the camera , particularly when:\n\n","As described above, the pre-processor receives video frames from the camera  and also receives the samples from the gyroscope . The samples from the gyroscope  are provided to the pre-processor (e.g. at regular intervals), at a rate at least equivalent to the frame rate of the video signal captured by the camera . Using a higher sampling rate in the gyroscope  gives more accurate angle estimates but can be more costly in terms of CPU usage.","A time stamp, t, provided by the camera  to a first frame (frame ) of the video signal indicates the end time of the frame, i.e. the time at which the shutter of the camera  is closed to end frame . Similarly, a time stamp, t, provided by the camera  to a second frame (frame ) of the video signal indicates the end time of the frame, i.e. the time at which the shutter of the camera  is closed to end frame . In order to determine the angular displacement (\u0394\u03b8) of the device  between the first frame and the second frame, rather than using the time stamps of the frames to denote the times of the frames, it is more accurate to use the midpoints of the exposure time of frame  and frame . The exposure times of the first and second frames are denoted by eand e. The angular displacement is determined by integrating the angular velocity (represented by the samples output from the gyroscope ) of the device  between a time t\u22120.5eand a time t\u22120.5e. Therefore the angular displacement between frame  and frame  is given by:",{"@attributes":{"id":"p-0047","num":"0049"},"maths":{"@attributes":{"id":"MATH-US-00002","num":"00002"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":["\u0394","\u03b8"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},{"mrow":[{"mrow":[{"mi":"\u03b8","mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":"t","mn":"2"}}},{"mi":"\u03b8","mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":"t","mn":"1"}}}],"mo":"-"},{"msubsup":{"mo":"\u222b","mrow":[{"msub":{"mi":"t","mn":"1"},"mo":"-","mrow":{"mn":"0.5","mo":"\u2062","msub":{"mi":"e","mn":"1"}}},{"msub":{"mi":"t","mn":"2"},"mo":"-","mrow":{"mn":"0.5","mo":"\u2062","msub":{"mi":"e","mn":"2"}}}]},"mo":"\u2062","mrow":{"mrow":[{"mi":"\u03c9","mo":"\u2061","mrow":{"mo":["(",")"],"mi":"t"}},{"mo":"\u2146","mi":"t"}],"mo":"\u2062"}}],"mo":"="}],"mo":"="}}}},{"@attributes":{"id":"p-0048","num":"0050"},"figref":["FIG. 3","FIG. 3","FIG. 3","FIG. 3","FIG. 3"],"b":["102","102","1","102","2","2","1","2"],"sub":["1 ","2 ","1 ","2 ","12 ","12 ","1","1","2","2"]},"Since the samples of the gyroscope  are not synchronised with the timings of the frames of the video signal captured by the camera , it might be the case that the gyroscope  does not generate samples at the midpoints of the frames (frame  and frame ). In which case, the angular velocity of the device  at the midpoints of the frames can be determined by interpolating the angular velocity represented by the samples generated by the gyroscope . The angular velocity is evaluated by interpolation at any time instant, and the midpoints of the exposure times of the frames define the integral interval used when calculating the angular displacement according to the equation above.",{"@attributes":{"id":"p-0050","num":"0052"},"figref":["FIG. 4","FIG. 4","FIG. 4","FIG. 4","FIG. 4"],"b":["102","100","104","402","404","406","408","410","104","404","406","406","408","104","102","104"],"sub":["1","1","2","2"]},"There may arise a situation in which a frame to be stabilized is received at the pre-processor after the latest sample from the gyroscope . For example, when the frame  is captured at the camera  the frame  may be received at the pre-processor before any samples from the gyroscope have been generated subsequent to the midpoint of the exposure time of the frame  (t\u22120.5e). For example frame  may be received at the pre-processor before the sample  shown in . In this situation, delay may be introduced into the video stream, in order for the sample  to be received at the pre-processor before the frame  is processed, thereby allowing the angular velocity at time (t\u22120.5e) to be determined before the frame  is processed by the pre-processor. Alternatively, the angular velocity may be extrapolated from the previously received samples from the gyroscope  in order to determine the angular velocity of the device  at the time (t\u22120.5e).","In the case of no motion of the camera  (e.g. for fixed placement of the device ), the gyroscope  may be disabled in order to save battery life. The state of no motion can be determined by feedback from a video encoder which encodes the video signal subsequent to the image stabilization method described herein and implemented by the pre-processor. The video encoder may perform motion estimation as part of the encoding process and as such can determine whether the camera is moving. A state of motion can also be determined and used to enable the gyroscope  when the camera  is moved. When the device  operates in the state of no motion, the motion sensor  may be polled at a slow interval to determine whether the device  has started moving again. There may be computationally cheaper ways to determine when the device  starts moving, depending on hardware and Application Programming Interfaces (APIs) implemented in the operating system of the device .","The timings of the operation of the hardware used for the camera  and for the gyroscope  might not match. This may be because the camera  and the gyroscope  are implemented in independent hardware chips. Therefore it may be beneficial to add an offset to the time stamps of either (or both) the samples generated by the gyroscope  and the frames of the video signal. In this way the timing of the samples from the gyroscope  can be matched with the timing of the frames of the video signal correctly. The offset may be constant for a particular combination of hardware chips. Therefore a delay may be computed offline and used at the device  without incurring a processing penalty for the method described herein.","In step S a pixel displacement representing the motion of the camera  is determined In general, a rotation of the camera  results in an approximately constant pixel displacement across the image of a frame of the video signal, independent of distances to objects in the image. This is in contrast to linear camera motion, for which pixel displacement is a function of the distance to the object. A function (or algorithm) mapping the rotation of the device  to a pixel displacement depends on parameters of the camera  (e.g. focal length and width of lens of the camera ) and the resolution of the images captured by the camera . Encoder feedback can be useful to determine the accuracy of the samples generated by the gyroscope  and to adapt the mapping algorithm. There are also some cases of motion and object placement where the stabilization model described herein based on the samples from the gyroscope  is not accurate (e.g. for rotation of the camera  around a user's face, the user's face may be stable in the middle of the frame but the gyroscope  detects rotation and therefore the stabilization process will attempt to stabilize the background) which may be detected by the encoder and fed back to the stabilization algorithm. In this way the stabilization algorithm can be adapted.","The pixel displacement determined in step S represents the motion in the images of the frames of the video signal resulting from the motion of the camera  (as opposed to motion in the subject matter of the images). In this way, the pixel displacement determined in step S represents unwanted motion in the images of the frames of the video signal.","In step S the pixel displacement determined in step S is filtered. This is done in order to smooth the changes that are applied to the video signal in the image stabilization process over time to thereby provide a smoother stabilized video signal. The filter used to filter the pixel displacement can be designed in different ways, depending on, for example, the resolution of the images captured by the camera , the acceptable delay which may be applied to the video signal, and the allowed amount of cropping which can be applied to the images of the original video signal received at the pre-processor from the camera . For example, higher resolution video frames may benefit from a larger filter attenuation of high frequency changes to the pixel displacement applied in the image stabilization process. On the other hand, the amount of cropping sets a hard limit to the maximum filter attenuation.","An exponential filter may be used which filters the pixel displacements according to the equation:\n\n_filt()=(1)*_filt(1)+(),\n","where n represents the frame number of the video signal, x represents the accumulated displacement (or \u201cposition\u201d), according to the pixel displacement determined in step S, and x_filt represents the filtered accumulated displacement which is subsequently used to determine how to align the input image in order to stabilize it as described in more detail below. In this way the filter acts as an exponential filter. When motion stops, x_filt\u2212x will converge to zero which implies no shifting of the image. The filter smoothes out changes to the determined pixel displacement over time, by basing the filtered pixel displacements on the corresponding filtered pixel displacement of the previous frame as well as on the pixel displacement determined for the current frame in step S. The weighting applied to the filtered pixel displacement of the previous frame is (1\u2212w) whereas the weighting applied to the pixel displacement determined for the current frame is w. Therefore adjusting the weighting parameter, w, will adjust how responsive the filter is to changes in the pixel displacement (x). A recursive (Infinite Impulse Response (IIR)) filter is more suited than a Finite Impulse Response (FIR) filter when the output x_filt is clipped to be in the range [x\u2212crop, x+crop] as the clipped value is fed back to the filter loop and makes subsequent output of x_filt less prone to clipping.","The weighting parameter, w, is adapted to the resolution and instant frame rate of the video signal to obtain a constant physical cut-off frequency, which is measured in Hertz. If the filter were an ideal filter then the physical cut-off frequency would define the highest frequency component of changes to x which will be incorporated into x_filt. Changes to x which have higher frequency than the cut-off frequency will be attenuated by an ideal filter and will not be present in x_filt. However, the filter is not an ideal filter and as such the cut-off frequency defines the highest frequency for which the attenuation applied by the filter is below 3 dB. So for non-ideal filters there will be some attenuation below the cut-off frequency and there will not be perfect attenuation above the cut-off frequency. The filter output is clipped so that that the difference between x_filt and x is not larger than the frame cropping size. w is adapted so that the physical cut-off frequency is constant, e.g. 0.5 Hz. From the filter transfer function, a function w(fc, fs) can be derived that maps a physical cut-off frequency fc to w. When the sampling frequency (frame rate) fs changes, w also changes even though fc is constant. The filter according to the filter equation above is well suited for instant changing of the cut-off frequency (changing w), compared to other filters.","In step S the image of the second frame (frame ) is shifted using the filtered pixel displacement from step S. In this way the motion in the image of the second frame (relative to the first frame) due to the motion of the camera  is attenuated. In other words, the filtered pixel displacement is used to compensate for the motion in the video signal between the first and second frames caused by the motion of the camera, to thereby stabilize the video signal.","The filtered pixel displacements are rounded to full-pixel displacements (i.e. integer-pixel displacements). This allows a simple method to be employed to shift the image of the second frame. The image is represented using a stride value indicating memory space of the image, a plurality of pixel values, a pointer indicating the position of a first pixel of the image, and a width value indicating the width of the image. The shifting of the image comprises adjusting the pointer and the width value without adjusting the stride value. It can be seen that the width value is independent of the stride value which allows the width of the image to be changed without affecting the stride of the image. Therefore the memory space of the image (e.g. in the memory ) does not need to be changed when the image is shifted (and\/or resized). This means that no copying of data in the memory  is necessary with this approach. This is in contrast to a conventional method of cropping an image in which the crop area of the image is copied into a new memory area. Copying the crop area may be computationally complex which may be detrimental, particularly when the method is to be implemented on a mobile device in which the processing resources available to the CPU  may be limited. With the method described herein, since the width value is independent of the stride value the new, shifted image can be created by changing the pointer and the width while the stride is kept intact.","The image may be represented by multiple image planes, for example a luma plane (Y) and two chroma planes (U and V). The image planes of the input image may be shifted and resized by simply changing the pointers to the luma and chroma planes, thereby modifying the width of the image planes whilst keeping the stride intact. The image planes are shifted by the same amount to ensure that the shifted image planes can be used together to represent the shifted image.","In order for this image shifting process to be implemented, the image planes require respective pointers, i.e. they cannot all be represented by the same, single pointer. Furthermore, as described above, it is necessary that the image has independent width and stride values.",{"@attributes":{"id":"p-0064","num":"0066"},"figref":"FIG. 5","b":["502","504"]},"In summary of the method described above, e.g. with reference to , the following stages are implemented in the pre-processor to stabilize the images of the frames of the video signal before the video signal is encoded with a video encoder:\n\n","In some embodiments, the image stabilization may be reduced when motion blur is present in the video signal. When high levels of motion are experienced by the camera , motion blur will be present in the video. Therefore, if the image stabilization described herein is applied to the frames of the video signal, then the resulting video signal will contain motion blur but no motion, which a user may perceive as looking unnatural or weird.","In one embodiment no compensation for motion of the camera  is made during the time interval when the camera shutter is open (i.e. the exposure times of the frames of the video signal) e.g. in the time interval [t\u2212e, t]. If the exposure time is very short (i.e. the shutter is open for a much shorter time than it is closed for) then this will not make a significant difference. However, if the exposure time is very long (i.e. the shutter is open for a much longer time than it is closed for), then little image stabilization will be applied to the video signal. In this way it is ensured that motion blur will always have the corresponding motion in the video signal, which is perceived as looking more natural to a viewer of the video signal.","Determining the motion of the camera  from the samples generated by the gyroscope  and determining the shutter speed is particularly advantageous since this information can be used to determine whether or not to apply the image stabilization, in view of the motion blur that the video signal may experience, without adding extra computational complexity.","It is also possible to address the issue of motion blur with no corresponding motion using a pure software stabilizer, rather than the image stabilizer described above which uses the samples from the gyroscope  to determine the motion of the camera . Software motion estimation typically finds the motion vectors representing centres of shutter speed intervals. Analyzing motion blur and finding what kind of motion produced this blur is more complex with a software stabilizer implementation than when using the samples from the gyroscope  to determine the motion of the camera , in combination with shutter speed, as described above.","In the embodiments described above, the motion sensor  is a gyroscope which generates samples representing the rotational motion of the device . In other embodiments, the motion sensor  may sense other types of motion, such as translational motion and generate samples representing the translational motion of the device . These samples can be used in the same way as described above in relation to the rotational motion to stabilize the video signal. However, as described above, with translational motion the pixel displacement will depend on the distance to the object in the image and so this must be taken into account when determining the pixel displacements. For example, multiple accelerometers may be able to estimate rotational motion, and in this case accelerometers can be used without further modification. For more general translational stabilization, it may become more difficult to implement the method described herein since different areas in the image move by different amounts of pixels. However, if the distance to the object is constant (and known) it may be simple to implement the method with translation motion. Even where the distance to the objects is not constant (but is still known) it would be possible to implement the method with translation motion but extra complication is added in determining the pixel displacements caused by the translation motion of the camera .","After stabilizing the video signal the video signal is encoded using a video encoding process. The encoded video signal may be transmitted, e.g. as part of a video call to another user or as a broadcast signal. Therefore, it is important for the video signal to be able to be stabilized and encoded in real-time (i.e. with very little delay) for use in events such as video calls, or other communication events where users are perceptually very aware of delay in the signals. Alternatively, the encoded video signal could be stored at the device , e.g. in the memory .","The method steps S, S, S and S could be implemented at the device  in software or in hardware. For example, the CPU  may execute processing blocks to implement the steps S, S, S and S. For example, a computer program product for stabilizing a video signal may be provided, which can be stored in the memory  and executed by the CPU . The computer program product may be configured so as when executed on the CPU  to perform the method steps S, S, S and S. Alternatively, hardware blocks may be implemented in the device  to implement the steps S, S, S and S.","It should be understood that the block, flow, and network diagrams may include more or fewer elements, be arranged differently, or be represented differently. It should be understood that implementation may dictate the block, flow, and network diagrams and the number of block, flow, and network diagrams illustrating the execution of embodiments of the invention.","It should be understood that elements of the block, flow, and network diagrams described above may be implemented in software, hardware, or firmware. In addition, the elements of the block, flow, and network diagrams described above may be combined or divided in any manner in software, hardware, or firmware. If implemented in software, the software may be written in any language that can support the embodiments disclosed herein. The software may be stored on any form of non-transitory computer readable medium, such as random access memory (RAM), read only memory (ROM), compact disk read only memory (CD-ROM), flash memory, hard drive, and so forth. In operation, a general purpose or application specific processor loads and executes the software in a manner well understood in the art.","Furthermore, while this invention has been particularly shown and described with reference to preferred embodiments, it will be understood to those skilled in the art that various changes in form and detail may be made without departing from the scope of the invention as defined by the appendant claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["For a better understanding of the present invention and to show how the same may be put into effect, reference will now be made, by way of example, to the following drawings in which:",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0036","num":"0035"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0038","num":"0037"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0039","num":"0038"},"figref":"FIG. 5"}]},"DETDESC":[{},{}]}
