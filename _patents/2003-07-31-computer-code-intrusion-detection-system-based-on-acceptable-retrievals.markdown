---
title: Computer code intrusion detection system based on acceptable retrievals
abstract: Methods, apparati, and computer-readable media for protecting computer code () from malicious retrievers (). A method embodiment of the present invention comprises the steps of generating () retrieval information characteristic of data sent to a retriever () by the computer code () in response to a retrieval command () issued by the retriever (); accessing at least one rule () using at least some of said retrieval information as an input to said at least one rule (); and, when said at least one rule () informs that the retrieval is not acceptable, flagging () the retrieval command () as suspicious.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07406714&OS=07406714&RS=07406714
owner: Symantec Corporation
number: 07406714
owner_city: Cupertino
owner_country: US
publication_date: 20030731
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["RELATED APPLICATION","TECHNICAL FIELD","BACKGROUND ART","DISCLOSURE OF INVENTION","DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS"],"p":["This patent application is a continuation-in-part of commonly assigned U.S. patent application Ser. No. 10\/612,198 filed Jul. 1, 2003, entitled \u201cReal-Time Training for a Computer Code Intrusion Detection System\u201d, which patent application is hereby incorporated by reference in its entirety into the present patent application.","This invention pertains to the field of thwarting intrusions perpetrated by malicious attackers to computer code (e.g., databases).","The background art includes intrusion thwarting systems where the computer code being attacked is a database. Such systems are called database intrusion detection systems. Some of these systems utilize offline non-real-time training in order to detect suspicious or anomalous activity. Examples of offline non-real-time database intrusion detection systems are described in Lee, et al., \u201cLearning Fingerprints for a Database Intrusion Detection System\u201d, 2002, pp. 264-279, published in November 2002 by Springer-Verlag, Berlin and Heidelberg, Germany; and C. Chung, et al., \u201cDEMIDS: A Misuse Detection System for Database Systems\u201d, Department of Computer Science, University of California at Davis, Davis, Calif., Oct. 1, 1999.","A common flaw in database intrusion detection systems of the prior art is that such systems fail to protect the database against insider attempts to steal large amounts of data using legitimate business processes. For example, such a system may allow a given service representative to access fields and tables within the database containing customer credit card information. Normally, a representative might access 5 to 10 accounts per hour in order to service customers. That is fine until the customer service representative decides to launch an insider attack on the database, procuring large amounts of consumer credit card information, which he then uses for nefarious purposes. The present invention is designed to protect against that and other attacks.","Methods, apparati, and computer-readable media for protecting computer code () from malicious retrievers (). A method embodiment of the present invention comprises the steps of generating () retrieval information characteristic of data sent to a retriever () by the computer code () in response to a retrieval command () issued by the retriever (); accessing at least one rule () using at least some of said retrieval information as an input to said at least one rule (); and, when said at least one rule () informs that the retrieval is not acceptable, flagging () the retrieval command () as suspicious.","This invention has applicability to any code intrusion detection system, i.e., any system in which computer code  is susceptible to being attacked by commands  which may be malicious, due to malicious intent on the part of the user  who issues the command . As used herein, \u201cuser\u201d can refer to a client computer  and\/or to a human who has control of computer . As illustrated in , there can be a plurality N of users , where N is any positive integer. \u201cUser\u201d is sometimes referred to herein as \u201cretriever\u201d.","Most of the following description illustrates the special case where the computer code  is a database . Database  can be any type of database, such as a relational database or a flat file. When database  is a relational database, commands  are typically written in a SQL language. As used herein, \u201cSQL\u201d is taken in the broad sense to mean the original language known as SQL (Structured Query Language), any derivative thereof, or any structured query language used for accessing a relational database. In the case where computer code  is not a relational database, the commands can be written in another language, such as XML. Database  may have associated therewith an internal audit table  and\/or an external database log file  for storing audit and\/or ancillary information pertaining to database . Database  is typically packaged within a dedicated computer known as a database server , which may also contain database communications module  and other modules not illustrated.","Computer code intrusion detection system (IDS)  (and its special case, database intrusion detection system ) encompasses modules , -, , , and . Modules , , -, -, , , and  can be implemented in software, firmware, hardware, or any combination thereof, and are typically implemented in software.  illustrates the case where modules , -, , , and  are stand-alone modules separate from database server . However, these modules could just as well be incorporated within database server , e.g., they could be incorporated within database communications module . Thus, intrusion detection system  could be published by a third party as a standalone package on any type of computer-readable medium, or bundled by the manufacturer of the database  with module . The purpose of intrusion detection system  is to protect computer code  from users  that have nefarious intent. For example, such users may desire to steal (possibly large amounts of) credit card information from database .","One method embodiment of the present invention comprises three phases: a training phase, a system administrator phase, and an operational phase.  illustrates the operational phase of the present invention. At optional step , computation module  extracts an input vector from a retrieval command , using any technique of real-time auditing and\/or in-line interception described below in conjunction with step . The extraction is typically done in real time or quasi-real-time. As used herein, \u201creal time\u201d means \u201cduring a short time interval surrounding the event\u201d. Thus, observing a command  in real time means that the command  is observed during a short time interval surrounding the instant that the command  enters the database .","A retrieval command  is any command by which a retrieving user  seeks to retrieve information from the database . The input vector characterizes the retrieval command  and comprises at least one parameter from the group of parameters comprising: canonicalized commands; the dates and times at which the commands  access the computer code ; logins (user IDs, passwords, catch phrases, etc.) of users  issuing the commands ; the identities of users  issuing the commands ; the departments of the enterprise in which the users  work, or other groups to which the users  belong; the applications (i.e., software programs or types of software programs) that issue the commands ; the IP addresses of the issuing computers ; identities of users  accessing a given field or fields within the computer code ; the times of day that a given user  accesses a given field or fields within the computer code ; the fields or combination of fields being accessed by given commands ; and tables or combinations of tables within the computer code  accessed by the commands.","A canonicalized command is a command  stripped of its literal field data. Literal field data is defined as a specific value of a parameter. Thus, for example, let us assume that the command  is:","SELECT NAME FROM PATIENTS WHERE NAME LIKE \u2018FRANK\u2019 AND AGE >25","In this case, the literal field data is \u201cFRANK\u201d and \u201c25\u201d. Thus, a canonicalized form of the command  is:","SELECT NAME FROM PATIENTS WHERE NAME LIKE * AND AGE >*","Literal fields can include literal numbers (plain numbers), dates, times, strings, and potentially named ordinal values (symbolic words used to represent numbers, e.g., \u201cJanuary\u201d represents the first month, \u201cFinance\u201d represents department , etc.).","In one embodiment, a retrieval command  is subjected to step  only if the fields mentioned in the command  appear on a preselected list of fields deemed to be important, e.g., credit card and password fields. In other embodiments, the operational phase is performed without the need to extract an input vector, and thus step  is not performed at all.","At step , the retrieval command  is forwarded to the database  for processing. When the database  finishes processing the retrieval command , it normally sends back to user  the requested data in the form of rows plus columns and\/or tables. A single row of data may contain a credit card number, expiration date, and customer name, i.e., three columns worth of data. A second row of data then would contain a second credit card number, a second expiration date, and a second customer name.","At step , computation module  observes this response by database  (using any technique of real-time auditing and\/or in-line interception described below in conjunction with step ); and generates retrieval information therefrom. This retrieval information is optionally stored in state table , potentially along with one or more pieces of information from the input vector (e.g., to maintain data such as \u201cusers of the SUPPORT group retrieved an average of 10 customer records per hour\u201d). State table  can maintain statistics on client  access to particular fields, associating the client  with the types of data that the client  is accessing. Clients  can be identified by user-ID (\u201cCarey\u201d), group-membership (\u201cAverage statistics for all members of the FINANCE group\u201d), group-ID (\u201cFINANCE group\u201d), as well as potentially source IP address, machine name identification, client application, or other combinations of zero or more elements of the input vector. State table  stores a set of statistics associated with one or more of these client  identifiers. State table  may also group its data based on other attributes in the input vector, including the set of referenced fields, etc. (see point 8 below). For example:","CAREY's statistics:",{"@attributes":{"id":"p-0026","num":"0000"},"ul":{"@attributes":{"id":"ul0001","list-style":"none"},"li":{"@attributes":{"id":"ul0001-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0002","list-style":"none"},"li":["1. has downloaded 2000 credit card rows total","2. downloads credit card rows at a rate of 10 per hour during business hours","3. downloads credit card rows at a rate of 3 per hour during off hours","4. has downloaded 1500 password rows total","5. downloads password rows at a rate of 10 per hour during business hours","6. downloads password rows at a rate of 3 per hour during off hours","7. downloads password rows at an average rate of 3 per request","8. For commands that attempt to access fields {USER, PASSWORD, SSN}, the average number of retrieved rows is 1.","9. etc. . . .\n\nFINANCE's average user statistics:\n","1. has downloaded 23000 credit card rows total.","2. average finance user downloads credit card rows at a rate of 7 per hour during business hours","3. downloads credit card rows at a rate of 1 per hour during off hours","4. etc. . . .\n\nstatistics for computer at IP Address 1.2.3.4:\n"]}}}},"etc.","etc.","etc.","The statistics can be maintained for only those fields deemed critical by the database administrator , or for all fields accessed. Clearly, many types of statistics can be maintained, including:\n\n","Typical contents of a state table  having three entries are illustrated in . In the first entry, an input vector was not calculated (at step ), because here the operational phase is operating on a command by command basis. Thus, there is no need to track any identifying information for a particular command , because it is the present command  that is being processed.","\u201cRetrieval information\u201d consists of two components: one or more retrieval vectors, and statistical information. As used herein, \u201cretrieval vector\u201d comprises at least one of the following: the number of rows retrieved; the number of columns retrieved; the number of tables retrieved; an identification of the columns that were retrieved; and an identification of the tables that were retrieved. Thus, in the present example of entry , the retrieval vector can be represented as [5 rows; 3 columns; columns A, J, and K]. As used herein, \u201cstatistical information\u201d means any statistics that can be generated from the retrieval, either in conjunction with data stored in state table , or on its own. Thus, \u201cstatistical information\u201d can comprise one or more of the following statistics: the rate of retrieving rows; the rate of retrieving columns; the rate of retrieving tables; the average number of rows retrieved per retrieval command  for a given input vector (or subset of an input vector); the average number of columns retrieved per retrieval command  for a given input vector; the average number of tables retrieved per retrieval command  for a given input vector; the percentage of retrieval commands  for which a given column is accessed; the percentage of retrieval commands  for which a given table is accessed; the percentage of retrieval commands  for which a given combination of columns is accessed; and the percentage of retrieval commands  for which a given combination of tables is accessed.","Note that some of these statistics are compilable across many commands , and some are compilable within a single command . In the present example of entry  in , there are two pieces of statistical information that have been generated by computation module  as a result of this particular command  accessing this particular database : S, the number of rows per second that are retrieved; and D, the number of columns per second that are retrieved. In this example, S=2000 rows per second and D=2300 columns per second.","At step , computation module  uses retrieval information to access at least one rule  pertaining to retrievals. The rules  can define acceptable and\/or unacceptable retrievals, and can be stored in any manner known to one of ordinary skill in the art. In one embodiment, at least one rule  comprises a pre-established table containing rules for acceptable and\/or unacceptable retrievals as illustrated in . In the illustrated example, rule table  has four entries. In the first entry, there is no input vector, since the corresponding rule is independent of any particular input vector. (It may be said that the input vector is wildcarded.) This emphasizes the fact that it is not necessary for table  to be accessed (indexed) by an input vector. In this example, the cognizant rule, rule , states: \u201cno more than 1000 rows per second can ever be retrieved by anybody\u201d.","At step , computation module  determines whether table  indicates that the retrieval is acceptable or unacceptable. The matching of the retrieval information from table  to the rule in table  can be performed by any technique known to those of ordinary skill in the art. If table  indicates that the retrieval is acceptable, the retrieval is allowed to proceed at step , i.e., the requested data is sent to the requesting user .","If, on the other hand, the retrieval information from table  does not satisfy the corresponding rule in table , module  flags the current command  as being suspicious at step . Then a post-flagging protocol is performed by module  at step . In the illustrated example, the retrieval information \u201cS=2000 rows per second\u201d violates the rule \u201cno more than 1000 rows per second can ever be retrieved by anybody\u201d. Thus, steps  and  are executed.","Execution of the post-flagging protocol at step  entails execution of at least one of the following steps: an alert is sent to the system administrator ; an audit log is updated; the command  is not allowed to access the computer code ; the command  is allowed to access the computer code , but the access is limited in some way (for example, the amount of data sent back to user  is limited); the command  is augmented, e.g., investigational code is inserted into the command  to provoke an audit trail; the user  sending the command  is investigated. The latter investigation can be performed by computer means (e.g., sending out a digital trace to determine the identity of the user ) and\/or by off-line means (sending a human private investigator to spy on user ).","The above example illustrates an embodiment in which table  is accessed by retrieval information but not by an input vector. In other embodiments, an input vector (or more than one input vector, as long as the input vectors are from the same command ), in addition to retrieval information, is used to access table . For example, consider the second entry illustrated in . The four rules set forth in said entry  are associated with a particular input vector LFA. These rules, which are more fully described below in conjunction with the training phase, are valid only with respect to specific input vector LFA.","The above examples illustrate the case where the operational phase is performed on a command by command basis. In other embodiments, the retrieval information can be compiled on other bases, for example, with respect to all commands  that are executed during a given time period that defines the operational phase, or for the duration of a login by a user  to the database . This is illustrated in entry  of , where the retrieval information is presented without regard to input vector. In this example, the retrieval information that has been compiled in table  is the statistic \u201cthe rate of retrieving rows was 2000 rows\/second across all commands \u201d. In this example, at step , rule  from table  remains violated, this time for the operational phase taken as a whole. Thus, at step , the entire operational phase is flagged as being suspicious, and the post-flagging protocol  performed at step  is tailored accordingly.","At step , all of the retrieval information in state table  can be matched against all of the rules in table , or just a subset of the retrieval information and\/or a subset of the rules can be used for matching.","An example of an embodiment where table  is accessed by two input vectors within the same command , as well as by retrieval information from table , is illustrated in entries  and  of . Entry  gives the rule (rule ) that for input vector L, \u201cno retrievals are allowed between 6 p.m. and midnight unless rule  is satisfied\u201d. Let us assume that L is the log-in of the user  issuing the command ; Lis \u201cAbacus \u201d; and retrieval information stored in table  for this command  specifies that the command  was issued at 8 p.m. Then at step , computation module  determines that rule  is violated, unless rule  is satisfied. Thus, table  must also be accessed by the second input vector, F. Let us assume that F is the field being queried by the command  and Fis the credit card number. Then, computation module  looks to table  to determine whether the credit card number field is retrieved at a rate D less than 10 per minute by that particular command .","The contents of table  are generated during an optional training phase, and\/or are force fed into table  by system administrator , and\/or are provided by a security or other vendor. A typical training phase is illustrated in , and is initiated at step . This is done by system administrator  flipping a switch (which may be located, for example, on database server  or on training module ); by means of a preselected event occurring (e.g., the first of each month or the addition of a new table within database ); or by any other means known to one of ordinary skill in the art for starting a computer system.","At step , training module  observes retrieval commands  that users  send to database . This observation may be done in real time. There are two major ways in which the observing step  can be performed: real-time auditing and in-line interception. Real-time auditing is typically used in cases where database  has an auditing feature. The auditing information may be placed into an audit table  internal to database  or into an external database log file . In real-time auditing, training module  instructs the database  to generate a stream of events every time a command  enters database . The stream can include such items as the text of the command , a date\/time stamp, information pertaining to the user  that issued the command , the IP (Internet Protocol) address of the issuing computer , the application that issued the command , etc.","The stream can appear in string or binary form, and can be extracted using a number of different techniques, depending upon the implementation of the IDS , including APIs (Application Programming Interfaces) that access the computer code . One example is to use ODBC (Open DataBase Connectivity), a set of C language API's that allows one to examine or modify data within database . If the Java programming language is used, JDBC (Java DataBase Connectivity) can be used instead. Another way of extracting the needed information from database  is to use code injection or patching to inject logic into one or more modules ,  within database server , to transfer control to training module . In another embodiment, called \u201cdirect database integration\u201d, the database  vendor, who has access to the commands  in conjunction with the normal operation of the database , makes the commands  available to intrusion detection system . In yet another embodiment, in cases where database  supports it, external database log file  may be examined without the need to resort to special software. Once a retrieval command  has been processed by training module , the command  can optionally be expunged from any table or log file it is stored in, to make room for subsequent commands .","In in-line interception, at least one of a proxy, firewall, or sniffer  is interposed between database  and users  (see ). The proxy, firewall, and\/or sniffer  examines packets of information emanating from users  and extracts the relevant information therefrom. Proxy, firewall, and\/or sniffer  may need to decrypt the communications emanating from users  if these communications are encrypted.","After a command  has been captured in step , at step  training module  observes (extracts) the response of database  to the command , and updates (augments) state table . Step  can be performed in real time, i.e., state table  can be updated response-by-response. The responses of the database  can be extracted using any of the techniques of real-time auditing and\/or in-line interception that are described above in conjunction with step . Similarly, previously described steps  and  can be performed using any of the above-described techniques of real-time auditing and\/or in-line interception, with computation module  rather than training module  doing the extraction and generation, respectively.","The operation of step  is illustrated in entry  of . The retrieval information comprises, for the illustrated input vector LFA, two retrieval vectors plus statistical information comprising the number of occurrences of each of the retrieval vectors, plus S and D.","Let us assume that L is the parameter \u201clog-in of the user  that issued the command \u201d. The log-in can be some preselected combination of user ID, password, and answer to a challenge phrase (e.g., \u201cwhat is your mother's maiden name?\u201d). In this example, Lis \u201cAbacus34\u201d. F is the field being queried by the command . Fis \u201ccredit card number\u201d. A is the application that issued the command  or the IP address of the requesting computer . Ais \u201cSiebel CRM Deluxe Version 22\u201d. Let us further assume that during the entirety of the training phase, the only responses generated by database  to commands  associated with LFAare a plurality of responses having five rows and three columns (retrieval vector ), and a plurality of responses having seven rows and two columns (retrieval vector ). Let us further assume that retrieval vector  has occurred 963 times, and retrieval vector  has occurred 51 times. Thus, the augmentation of state table  performed in step  for a given command  may simply entail incrementing the number of occurrences from 962 to 963, and recalculating S and D. In the illustrated example, the rate S of rows returned by database  for this input vector is 1.1 row per second, and the rate D at which database  returns columns for this input vector is 2.3 columns per second.","Note that not all of the possible parameters have to be covered in the input vector that is the subject of the training. In this case, just three parameters (out of the many more possible parameters) are so covered (the set of parameters to use may be specified by an administrator ).","Steps  and  are repeated for each command  that is processed during the training phase.","The training phase is ended, at step , by any one of a number of means. For example, system administrator  can flip a switch on database server  or training module . Alternatively, the training phase may end by a statistical technique, e.g., training module  monitors the occurrence or frequency of new commonly occurring retrieval vectors. Alternatively, the training phase may end by the occurrence of a preselected elapsed or absolute time, or by any other means known to one of ordinary skill in the art. As with all of the preselected parameters in this patent application, the preselected parameters mentioned in this paragraph may be stored in parameters storage area .","At step , module  converts the retrieval information stored in state table  into rules for acceptable and\/or unacceptable retrievals within table , using preselected set of parameters . The administrator  may be asked to review and\/or augment these rules. Entry  of  corresponds to entry  of . There are four rules illustrated for said entry. It can be seen that Rule  was derived from the retrieval information in  by first concluding that the 963 occurrences of five rows and three columns was greater than a preselected threshold value (e.g., 50) to warrant inclusion in table . Then, a preselected margin (in this case, one) in either direction was applied around the observed numbers of rows and columns to generate the rule. The \u201cAND\u201d following the semicolon in rule  is a Boolean AND, i.e., both the criterion \u201cbetween 4 and 6 rows\u201d and the criterion \u201cbetween 2 and 4 columns\u201d must be satisfied in order for the retrieval to be deemed acceptable at step . There may also be Boolean logic underlying the combination of the rules. For example, in order for module  to conclude in step  that a retrieval is acceptable, it might have been preselected that either Rule  AND Rule  AND Rule  must be satisfied; OR Rule  AND Rule  AND Rule  must be satisfied in order for the retrieval to be deemed acceptable, where \u201cAND\u201d and \u201cOR\u201d are Boolean operators. If one of these two conditions is not satisfied, module  determines that the retrieval is suspicious.","Alternative to a preselected integral margin such as the margin of 1 on either side of the observed numbers of rows and columns illustrated above, any statistical technique may be used to generate the rules of table  from the corresponding retrieval information. For example, the margin on the positive side of the number of observations may be a preselected percent of the observed value, or a preselected number of standard deviations. The margin on the lower side of the observed value may be the same or a different percent of the observed value, or the same or a different number of standard deviations. Other statistical techniques will be readily attainable by those of ordinary skill in the art.",{"@attributes":{"id":"p-0054","num":"0068"},"figref":"FIG. 4","b":["41","42","41","10","10","3","5","10","41"]},"Similarly, one could incorporate within parameters  a maximum number of rows allowed to be retrieved (possibly for a given field\/table or set of fields\/tables). Let us assume that this maximum number of rows is 20. Then if a particular training phase retrieval attempts to retrieve 21 or more rows, such a retrieval is deemed to be suspicious and is likewise reported to system administrator  at step . System administrator  can then remove from the set of acceptable retrievals within table  such suspicious retrievals.","At step , system administrator  can force feed rules into table . Step  can be performed in lieu of or in addition to the training phase. For example, one of the rules provided by the system administrator  could be: \u201cno more than 100 rows from CREDIT CARD table are acceptable\u201d or \u201cno more than 100 rows in any one minute from CREDIT CARD table are acceptable\u201d.","Rules can also be entirely statistical, such as:","\u201cIf the number of rows retrieved by a single user to the CREDIT card field exceeds the historical average for the user's group by more than 2 standard deviations, then generate an alert.\u201d","The above description is included to illustrate the operation of the preferred embodiments and is not meant to limit the scope of the invention. The scope of the invention is to be limited only by the following claims. From the above discussion, many variations will be apparent to one skilled in the art that would yet be encompassed by the spirit and scope of the present invention. For example, instead of training the system  on the number of columns overall, one could single out certain columns (or combinations of columns) of interest within database  and train on that basis, e.g., one could train on the SOCIAL SECURITY NUMBER column within the PAYROLL table, and\/or the CREDIT CARD NUMBER column within the CREDIT INFORMATION table."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["These and other more detailed and specific objects and features of the present invention are more fully disclosed in the following specification, reference being had to the accompanying drawings, in which:",{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 5","b":"18"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 6","b":"6"}]},"DETDESC":[{},{}]}
