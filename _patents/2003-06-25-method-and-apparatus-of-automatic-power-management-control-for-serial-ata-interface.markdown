---
title: Method and apparatus of automatic power management control for Serial ATA interface
abstract: The present invention is directed to a method and apparatus of automatic power management control for Serial ATA interface. In an exemplary aspect of the present invention, an idle or active condition of Serial ATA interface is automatically detected. When Serial ATA is in an idle condition, idle time of Serial ATA interface is counted using a power down counter whose frequency is determined by a programmable register based on input clock. When a power down counter value is equal to a first value, a request for a Partial power state is asserted, and Serial ATA interface is put into a Partial power state. When a power down counter value is equal to a second value, a request for a Slumber power state is asserted, and Serial ATA interface is put into a Slumber power state.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07028199&OS=07028199&RS=07028199
owner: LSI Logic Corporation
number: 07028199
owner_city: Milpitas
owner_country: US
publication_date: 20030625
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE INVENTION"],"p":["This invention relates generally to power management control, and particularly to a method and apparatus of automatic power management control for a Serial ATA interface.","Serial ATA (Advanced Technology Attachment) is an evolutionary replacement for the Parallel ATA physical storage interface. Serial ATA is a computer bus primarily designed for transfer of data between a computer processor and hard disk and has at least three advantages over Parallel ATA, namely speed, cable management, and Serial ATA's ability of being hot swappable.","There are three interface power states supported in Serial ATA: PhyReady, Partial and Slumber. In PhyReady (or power up) state, the PHY (physical) logic and main PLL (phase-locked loop) are both on and active, and the interface is synchronized and capable of receiving and sending data. Partial and Slumber are two power saving (or power down) modes. In both Partial and Slumber states, the PHY logic is powered, but is in a reduced power state. However, while the exit latency from Partial state is generally no longer than 10 \u03bcs (microseconds), the exit latency from Slumber state is generally no longer than 10 ms (milliseconds).","When a Serial ATA interface is idle (i.e., when either a Serial ATA host adapter or a Serial ATA drive is not active) for a period of time, it is desirable to put the interface into a power saving mode. In addition to saving power while in a power saving mode, the interface lifetime may be increased. Preferably, the power state change of the Serial ATA interface is hardware controlled so that communications with high level layers of the interface may be avoided, which may lead to an efficient power saving method when the interface is in idle condition for a programmable period of time.","Thus, it would be desirable to provide a method and apparatus of automatic power management control which automatically puts Serial ATA interface into power up and power down modes.","Accordingly, the present invention is directed to a method and apparatus of automatic power management control for Serial ATA interface. In an exemplary aspect of the present invention, an idle or active condition of Serial ATA interface is automatically detected. When Serial ATA is in an idle condition, idle time of Serial ATA interface is measured using a power down counter whose frequency is determined by a programmable register based on an input clock. When a power down counter value is equal to a first value, a request for a Partial power state is asserted, and Serial ATA interface is put into a Partial power state. When a power down counter value is equal to a second value, a request for a Slumber power state is asserted, and Serial ATA interface is put into a Slumber power state.","The apparatus of the present invention may put the Serial ATA interface into power up and power down states automatically. Because the present invention automatically detects the interface idle condition and puts the interface into a power saving mode when the interface is in idle condition for a programmable period of time, the present invention may save power and increase the interface lifetime. Moreover, because the present invention controls the power state change of the Serial ATA interface by hardware, communications with high level layers of the interface is avoided, which may lead to an efficient power saving method.","It is to be understood that both the foregoing general description and the following detailed description are exemplary and explanatory only and are not restrictive of the invention as claimed. The accompanying drawings, which are incorporated in and constitute a part of the specification, illustrate an embodiment of the invention and together with the general description, serve to explain the principles of the invention.","Reference will now be made in detail to the presently preferred embodiments of the invention, examples of which are illustrated in the accompanying drawings.","Referring first to , a method (or process)  of automatic power management control for the Serial ATA interface in accordance with an exemplary embodiment of the present invention is shown. The process starts with step , in which an idle condition of a Serial ATA interface is detected. Next, idle time of the Serial ATA interface is measured in step . Then in step , the Serial ATA interface is placed into Partial power state when the measured idle time is equal to a first value. Next, in step , the Serial ATA interface is placed into Slumber power state when the measured idle time is equal to a second value. In a preferred embodiment of the present invention, the second value is always greater than the first value. That way, when both power saving modes are supported and enabled, the present invention ensures that the Serial ATA interface is first placed into Partial State, followed by Slumber. It is understood that other embodiments may be contemplated by a person of ordinary skill in the art without departing from the scope and spirit of the present invention. For example, in an alternative embodiment of the steps  and , the Serial ATA interface may be placed into a power saving mode when the measured idle time is equal to a predetermined value, wherein the power saving mode is either a Partial power state or a Slumber power state.","Referring to , a method (or process)  of automatic power management control for the Serial ATA interface in accordance with a further exemplary embodiment of the present invention is shown. According to the present invention, there may be three programmable registers: Timer Count Reg, Partial Count Reg, and Slumber Count Reg. Timer Count Reg holds a programmable value TimerCount, which determines the frequency for a power down counter (pd_ctr). For example, based on the frequency of the input clock, Timer Count Reg may be programmed accordingly to obtain the time period such as 1 ms, 2 ms, or the like for the pd_ctr. Partial Count Reg holds a programmable non-zero value PartialCount. When a pd_ctr value is equal to PartialCount, a request for Partial state (ReqPartial) is asserted. Slumber Count Reg holds a programmable non-zero value SlumberCount. When a pd_ctr value is equal to SlumberCount, a request for Slumber state (ReqSlumber) is asserted.","According to the process , an input clock counter (clk_ctr) counts the clock (step ) and checks against TimerCount (step ) to generate the required frequency to operate the pd_ctr. In the step , when the clk_ctr value is equal to TimerCount, the process  proceeds to steps  and  simultaneously. In the step , the counter clk_ctr is reset, and the process  then returns to the step .","In the step , the interface idle\/active condition is automatically detected. According to one aspect of the present invention, the interface is active if any of the following conditions is true: (1) BSY, DRQ, or SERV bit of ATA task file register is ON; (2) COMWAKE or COMRESET OOB (out of band) signal is detected; and (3) firmware is forcing the interface wakeup from a power saving mode by writing a Firmware Forcing WakeUp bit in automatic power management circuitry. If none of the foregoing conditions is true, then the interface is not active (i.e., idle).","When the interface is detected to be active, the process  proceeds to step , in which any power down requests (ReqPartial and\/or ReqSlumber) are de-asserted and the pd_ctr is reset. After the step , the process  returns to the step .","When the interface is detected to be inactive, the process  proceeds to step , in which the pd_ctr starts to count the interface idle time. Next, in step , the pd_ctr value is checked against SlumberCount. If the pd_ctr value is equal to SlumberCount, then in step , Slumber Request may be received. Next, in step , ReqSlumber is ON (asserted), and ReqPartial is OFF (not asserted). Thus, the interface may be placed into Slumber state.","Following the step , if the pd_ctr value is not equal to SlumberCount, then in step , the pd_ctr value is checked against PartialCount. If the pd_ctr value is not equal to PartialCount, the process  returns to the step . If the pd_ctr value is equal to PartialCount, then in step , Partial Request may be received. Next, in step , ReqPartial is ON (asserted), and ReqSlumber is OFF (not asserted). Thus, the interface may be placed into Partial state.","In a preferred embodiment of the present invention, SlumberCount is always greater than PartialCount. That way, when both power saving modes are supported and enabled, the present invention ensures that ReqPartial is asserted first, followed by a ReqSlumber. It is understood that other embodiments may be contemplated by a person of ordinary skill in the art without departing from the scope and spirit of the present invention.",{"@attributes":{"id":"p-0024","num":"0023"},"figref":["FIG. 3","FIG. 1","FIG. 2"],"b":["300","100","200","300","300","302","304","306","302","304","302","304","308"]},"In an exemplary embodiment, the automatic power management circuitry  may include a Firmware Control Reg  and three programmable registers (Timer Count Reg , Partial Count Reg , Slumber Count Reg ). In a preferred embodiment, the Firmware Control Reg  is a 32-bit register, whose Bit is a Firmware Forcing Slumber bit, Bit is a Firmware Forcing Partial bit, and Bit is a Firmware Forcing WakeUp bit. The automatic power management circuitry  detects the active\/idle condition of the Serial ATA host adapter  through BSY, DRQ, and SERV Bits and may issue power down requests (ReqPartial and ReqSlumber) to the physical layer of the Serial ATA host adapter . The automatic power management circuitry  may also issue ReqPartial and\/or ReqSlumber to the physical layer of the Serial ATA host adapter  when it receives power down requests from the Serial ATA drive .","It is understood that  is intended as an example of apparatus of automatic power management control for the Serial ATA interface in accordance with the present invention and not as an architectural limitation to the present invention. Those of ordinary skill in the art will appreciate that various combinations and arrangements may be employed without departing from the scope and spirit of the present invention. For example, the Serial ATA host adapter  in  may be connected to more than one Serial ATA drive. In one embodiment, a Serial ATA host adapter may have two ports Port  and Port , which are connected to Serial ATA drives Drive  and Drive , respectively. In this case, according to the present invention, for each port there may be independent, identical automatic power management circuitry. If Port  of the host adapter and Drive  are in idle state, then only Port  and Drive  may be put into a power saving state, but not Port  and Drive  (assuming Port  and Drive  are in active state). In addition, the Timer Count Reg , the Partial Count Reg , the Slumber Count Reg , and the Firmware Control Reg  may be physically located outside the automatic power management circuitry .",{"@attributes":{"id":"p-0027","num":"0026"},"figref":["FIG. 4","FIG. 2","FIG. 1","FIG. 2"],"b":["306","100","200","306","306","402","404","406","408","410"]},"The OR gate  receives BSY Bit, DRQ Bit, and SERV Bit as input and outputs a value (\u201c1\u201d or \u201c0\u201d, where \u201c1\u201d means a Serial ATA host adapter is active, and \u201c0\u201d means a Serial ATA host adapter is not active) to both the inverter  and the OR gate  as input. When the OR gate  outputs \u201c0\u201d, a Serial ATA host adapter is not active, the inverter  outputs \u201c1\u201d which enables the power down counter logic . When the power down counter value reaches PartialCount or SlumberCount, the power down\/up circuitry  issues a power down request to the Serial ATA Physical Layer. Consequently, a power down state of the Serial ATA host adapter may result.","The OR gate  receives as input an output from the OR gate , a Firmware Forcing WakeUp Bit, and an COMWAKE or COMREST OOB signal and may output a WakeUp signal to the power down\/up circuitry , which in turn issues a power up request to the Serial ATA Physical Layer. Consequently, a power up state of the Serial ATA host adapter may result.","In addition, a Firmware Forcing Partial Bit or a Firmware Forcing Slumber Bit may be directly written into the power down\/up circuitry , which then issues a power down request to the Serial ATA Physical Layer, resulting in a power down state of the Serial ATA host adapter.","The present invention may place the Serial ATA interface into power up and power down states automatically by its own. The apparatus of the present invention may automatically detect the interface idle condition and put the interface into a power saving mode when the interface is in idle condition for a programmable period of time. Thus, the present invention may save power and increase the interface lifetime. Moreover, because the present invention controls the power state change of the Serial ATA interface by hardware, communications with high level layers of the interface is avoided, which may lead to an efficient power saving method.","It is appreciated that the present invention is not limited to Serial ATA interface. The present invention may also apply to a variety of other interfaces as may be contemplated by a person of ordinary skill in the art.","It is understood that the specific order or hierarchy of steps in the processes disclosed is an example of exemplary approaches. Based upon design preferences, it is understood that the specific order or hierarchy of steps in the processes may be rearranged while remaining within the scope of the present invention. The accompanying method claims present elements of the various steps in a sample order, and are not meant to be limited to the specific order or hierarchy presented.","It is believed that the present invention and many of its attendant advantages will be understood by the foregoing description. It is also believed that it will be apparent that various changes may be made in the form, construction and arrangement of the components thereof without departing from the scope and spirit of the invention or without sacrificing all of its material advantages. The form herein before described being merely an explanatory embodiment thereof, it is the intention of the following claims to encompass and include such changes."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The numerous advantages of the present invention may be better understood by those skilled in the art by reference to the accompanying figures in which:",{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":["FIG. 4","FIG. 3"]}]},"DETDESC":[{},{}]}
