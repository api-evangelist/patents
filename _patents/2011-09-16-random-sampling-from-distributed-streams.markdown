---
title: Random sampling from distributed streams
abstract: Described herein are methods, systems, apparatuses and products for random sampling from distributed streams. An aspect provides a method for distributed sampling on a network with a plurality of sites and a coordinator, including: receiving at the coordinator a data element from a site of the plurality of sites, said data element having a weight randomly associated therewith deemed reportable by comparison at the site to a locally stored global value; comparing the weight of the data element received with a global value stored at the coordinator; and performing one of: updating the global value stored at the coordinator to the weight of the data element received; and communicating the global value stored at the coordinator back to the site of the plurality of sites. Other embodiments are disclosed.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08392434&OS=08392434&RS=08392434
owner: Iowa State University
number: 08392434
owner_city: Ames
owner_country: US
publication_date: 20110916
---

{"@attributes":{"id":"description"},"GOVINT":[{},{}],"heading":["STATEMENT OF GOVERNMENT INTEREST","FIELD OF THE INVENTION","BACKGROUND","BRIEF SUMMARY","DETAILED DESCRIPTION"],"p":["This invention was made with government support under grant numbers: CNS0834743 and CNS0831903, awarded by the National Science Foundation. The government has certain rights in the invention.","The subject matter presented herein generally relates to optimal random sampling from distributed streams of data.","For many data analysis tasks, it is impractical to collect all the data at a single site and process it in a centralized manner. For example, data arrives at multiple network routers at extremely high rates, and queries are often posed on the union of data observed at all the routers. Since the data set is changing, the query results could also be changing continuously with time. This has motivated the continuous, distributed, streaming model. In this model there are k physically distributed sites receiving high-volume local streams of data. These sites talk to a central coordinator that has to continuously respond to queries over the union of all streams observed so far. A challenge is to minimize the communication between the different sites and the coordinator, while providing an accurate answer to queries at the coordinator at all times.","A problem in this setting is to obtain a random sample drawn from the union of all distributed streams. This generalizes the classic reservoir sampling problem to the setting of multiple distributed streams, and has applications to approximate query answering, selectivity estimation, and query planning. For example, in the case of network routers, maintaining a random sample from the union of the streams is valuable for network monitoring tasks involving the detection of global properties. Other problems on distributed stream processing, including the estimation of the number of distinct elements and heavy hitters, use random sampling as a primitive.","The study of sampling in distributed streams was initiated by prior work. Consider a set of k different streams observed by the k sites with the total number of current items in the union of all streams equal to n. Prior work has shown how k sites can maintain a random sample of s items without replacement from the union of their streams using an expected O((k+s)logs) messages between the sites and the central coordinator. The memory requirement of the central coordinator is s machine words, and the time requirement is O((k+s)log n). The memory requirement of the remote sites is a single machine word with constant time per stream update. Prior work has also proven that the expected number of messages sent in any scheme is (k+s log(n\/s)). Each message is assumed to be a single machine word, which can hold an integer of magnitude poly(kns).","One aspect provides a method for distributed sampling on a network with a plurality of sites and a coordinator, comprising: receiving at the coordinator a data element from a site of the plurality of sites, said data element having a weight randomly associated therewith deemed reportable by comparison at the site to a locally stored global value; comparing the weight of the data element received with a global value stored at the coordinator; and performing one of: updating the global value stored at the coordinator to the weight of the data element received; and communicating the global value stored at the coordinator back to the site of the plurality of sites.","Another aspect provides a computer program product for distributed sampling on a network with a plurality of sites and a coordinator, comprising: a computer readable storage medium having computer readable program code embodied therewith, the computer readable program code comprising: computer readable program code configured to receive, at the coordinator, a data element from a site of the plurality of sites, said data element having a weight randomly associated therewith deemed reportable by comparison at the site to a locally stored global value; computer readable program code configured to compare the weight of the data element received with a global value stored at the coordinator; and computer readable program code configured to perform one of: updating the global value stored at the coordinator to the weight of the data element received; and communicating the global value stored at the coordinator back to the site of the plurality of sites.","A further aspect provides a system comprising: at least one processor; and a memory device operatively connected to the at least one processor; wherein, responsive to execution of program instructions accessible to the at least one processor, the at least one processor is configured to: receive at the coordinator a data element from a site of the plurality of sites, said data element having a weight randomly associated therewith deemed reportable by comparison at the site to a locally stored global value; compare the weight of the data element received with a global value stored at the coordinator; and perform one of: updating the global value stored at the coordinator to the weight of the data element received; and communicating the global value stored at the coordinator back to the site of the plurality of sites.","The foregoing is a summary and thus may contain simplifications, generalizations, and omissions of detail; consequently, those skilled in the art will appreciate that the summary is illustrative only and is not intended to be in any way limiting.","For a better understanding of the embodiments, together with other and further features and advantages thereof, reference is made to the following description, taken in conjunction with the accompanying drawings. The scope of the invention will be pointed out in the appended claims.","It will be readily understood that the components of the embodiments, as generally described and illustrated in the figures herein, may be arranged and designed in a wide variety of different configurations in addition to the described example embodiments. Thus, the following more detailed description of the example embodiments, as represented in the figures, is not intended to limit the scope of the claims, but is merely representative of those embodiments.","Reference throughout this specification to \u201cembodiment(s)\u201d (or the like) means that a particular feature, structure, or characteristic described in connection with the embodiment is included in at least one embodiment. Thus, appearances of the phrases \u201caccording to embodiments\u201d or \u201can embodiment\u201d (or the like) in various places throughout this specification are not necessarily all referring to the same embodiment.","Furthermore, the described features, structures, or characteristics may be combined in any suitable manner in different embodiments. In the following description, numerous specific details are provided to give a thorough understanding of example embodiments. One skilled in the relevant art will recognize, however, that aspects can be practiced without certain specific details, or with other methods, components, materials, et cetera. In other instances, well-known structures, materials, or operations are not shown or described in detail to avoid obfuscation.","Regarding notation used herein, all algorithms are to the base  unless otherwise specified. Throughout the description, when asymptotic notation is used, the variable that is going to infinity is n, and s and k are functions of n.","A problem addressed by embodiments is that of distributed sampling. Namely, if there are k sites, each receiving a traffic stream, such as routers on a network, together with a central coordinator, the central coordinator's job is to maintain a statistic on the union of the k streams, such as the number of distinct elements, the heavy hitters or iceberg queries, et cetera. A challenge is that the stream is distributed across these k sites, and the sites should have as little communication as possible with the coordinator or with each other in order to minimize communication bandwidth, central coordinator computation time, et cetera.","A key primitive underlying statistics of interest is that of maintaining a random sample, or more generally s random samples, from the union of these streams. Given this, one may immediately obtain a protocol for finding the heavy hitters or estimating the number of distinct elements with related message (communication) complexity. Prior work established a protocol for doing this with O((k+s)log n) communication, where n is the length of the union of the streams. Such a protocol was not known to be optimal, and obtaining more practical protocols, which also asymptotically improve this complexity, is a problem addressed herein.","Accordingly, embodiments provide a new protocol that significantly improves the previous best protocol in the case that s is not too large, while k is large. Embodiments have the added benefit that the coordinator only communicates with a site when the site initiates the communication. Thus, it is possible for sites to go offline without affecting the correctness of the protocol, unlike in previous protocols. In many practical scenarios one first samples a small percentage of the stream, then runs whatever analysis is desired on the sampled stream. Embodiments give a more efficient way of doing this when the stream is distributed.","Embodiments have asymptotic message complexity",{"@attributes":{"id":"p-0024","num":"0023"},"maths":{"@attributes":{"id":"MATH-US-00001","num":"00001"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}}}]}}},"mo":","}}},"br":{}},"Essentially embodiments employ a protocol that hashes all stream tokens to a random number between [0,1] and maintains a minimum value. Clearly this is a random sample from the union of the streams. The value of the minimum is also roughly 1\/(# of distinct elements), so one obtains a rough estimate this way. More refined estimates can be obtained by obtaining s samples.","Thus, an embodiment provides for sampling from distributed streams, as well as a matching lower bound showing that the message complexity of this approach is optimal. In an embodiment, sensors assign random numbers to their received data elements from the data streams. By comparing the random number assigned for a given data element to a current global threshold value, the sensors determine when it may be appropriate to report a sample back to a coordinator node. For example, when the random number value is lower than the current global threshold value, the sensor may report the sample back to the coordinator. The coordinator node in turn monitors received samples from the sensors, and notifies them that a reported sample either establishes a new global threshold value (for example, a new minimum to be used for comparison), or indicates that the sensor that reported the sample should update its current global threshold value.","An embodiment provides a process for distributed sampling using an expected",{"@attributes":{"id":"p-0028","num":"0027"},"maths":{"@attributes":{"id":"MATH-US-00002","num":"00002"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}}}]}}}}},"br":{}},{"@attributes":{"id":"p-0029","num":"0028"},"maths":{"@attributes":{"id":"MATH-US-00003","num":"00003"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}]}}},"mo":","}}},"br":{}},"The memory requirement in the protocol at the central coordinator is s machine words, and the time requirement is",{"@attributes":{"id":"p-0031","num":"0030"},"maths":{"@attributes":{"id":"MATH-US-00004","num":"00004"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}}}]}}},"mo":"."}}},"br":{}},{"@attributes":{"id":"p-0032","num":"0031"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"91pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"98pt","align":"center"}}],"thead":{"row":{"entry":"TABLE 1"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}},{"entry":[{},"Upper Bound","Lower Bound"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"42pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Embodiment","Prior Work","Embodiment","Prior Work"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}},{"entry":[{"maths":{"@attributes":{"id":"MATH-US-00005","num":"00005"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"s","mo":"<","mfrac":{"mi":["k","s"]}}}}},{"maths":{"@attributes":{"id":"MATH-US-00006","num":"00006"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}]}}}}}},"O(klogn)",{"maths":{"@attributes":{"id":"MATH-US-00007","num":"00007"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"\u03a9","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}]}}}}}},"\u03a9(k + slogn)"]},{"entry":{}},{"entry":[{"maths":{"@attributes":{"id":"MATH-US-00008","num":"00008"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"s","mo":"\u2265","mfrac":{"mi":["k","s"]}}}}},"O(slog(n\/s))","O(klogn) ","\u03a9(slog(n\/s))","\u03a9(slog(n\/s))"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]}}]}}},"The approach employed by embodiments is straightforward and reduces the communication necessary, as the coordinator communicates with a sensor (site) if the site initiates the communication. This is useful in a setting where a site may go offline, since it does not require the ability of the site to receive broadcast messages.","Regarding a lower bond, it is described herein that for any constant q>0, any correct protocol must send",{"@attributes":{"id":"p-0035","num":"0034"},"maths":{"@attributes":{"id":"MATH-US-00009","num":"00009"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"\u03a9","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},"mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}}}]}}}}},"br":{}},{"@attributes":{"id":"p-0036","num":"0035"},"maths":{"@attributes":{"id":"MATH-US-00010","num":"00010"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"\u03a9","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.6em","height":"0.6ex"}}},"mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}}}]}}}}},"br":{}},"In addition to being quantitatively stronger than the lower bound of prior work, the lower bound of embodiments is also qualitatively stronger because the lower bound in prior work is on the expected number of messages transmitted in a correct protocol. However, this does not rule out the possibility that with large probability, much fewer messages are sent in the optimal protocol. In contrast, embodiments lower bound the number of messages that must be transmitted in any protocol 99% of the time. Since the time complexity of the central coordinator is at least the number of messages received, the time complexity of embodiments is also optimal.","The protocol used may also be modified in other embodiments to obtain a random sample of s items from k distributed streams with replacement. Here, a protocol with",{"@attributes":{"id":"p-0039","num":"0038"},"maths":{"@attributes":{"id":"MATH-US-00011","num":"00011"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mrow":{"mo":["(",")"],"mrow":{"mfrac":{"mi":"k","mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"2","mo":"+","mrow":{"mo":["(",")"],"mrow":{"mi":"k","mo":"\/","mrow":{"mo":["(",")"],"mrow":{"mi":["s","log","s"],"mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}]}}}}}}}},"mo":"+","mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mi":"s"}}}},"mo":["\u2062","\u2062","\u2062"],"mi":["log","n"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}}}}},"br":{}},"As a corollary, a protocol for estimating the heavy hitters in distributed streams with the best known message complexity is provided. In this problem, a set of H items is sought such that if an element e occurs at least an \u03b5 fraction of times in the union of streams, then e\u2208H, and if e occurs less than an \u03b5\/2 fraction of times in the union of the streams, then e\u2209H. It is known that 0 (\u03b5log n) random samples suffice to estimate the set of heavy hitters with high probability, and the previous best algorithm was obtained by plugging s=O(\u03b5log n) into a protocol for distributed sampling. Embodiments thus improve the message complexity from O((k+\u03b5log n)log n) to",{"@attributes":{"id":"p-0041","num":"0040"},"maths":{"@attributes":{"id":"MATH-US-00012","num":"00012"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["\u025b","n"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["\u025b","k"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}}}]},"mo":"+","mrow":{"mrow":{"msup":{"mi":"\u025b","mrow":{"mo":"-","mn":"2"}},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["\u025b","n"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}}},"mo":["\u2062","\u2062","\u2062"],"mi":["log","n"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}}}},"mo":"."}}},"br":{}},"It should be noted that the model used in this description is that of a proactive coordinator, as opposed to prior proposed reactive coordinators, which do not continuously maintain an estimate of the required aggregate, but only obtain an estimate when a query is posed to the coordinator. Moreover, this description concerns the case of non-sliding window, and does not concern the case of sliding windows.","The description now turns to the figures. The illustrated example embodiments will be best understood by reference to the figures. The following description is intended only by way of example and simply illustrates certain example embodiments representative of the invention, as claimed","Model","Referring to  generally, consider a system with k different sites (sensors , ), numbered from 1 to k, each receiving a local stream of elements. Let denote the stream observed at site i. There is one coordinator node , which is different from any of the sites. The coordinator does not observe a local stream, but all queries for a random sample arrive at the coordinator. Let =\u222abe the entire stream observed by the system, and let n=. The sample size s is a parameter supplied to the coordinator  and to the sites ,  during initialization.","The task of the coordinator  is to continuously maintain a random sample  of size min {n, s} consisting of elements chosen uniformly at random without replacement from . The cost of the protocol is the number of messages transmitted.","Assuming a synchronous communication model, where the system progresses in \u201crounds\u201d, in each round, each site ,  can observe one element (or none), and send a message to the coordinator , and receive a response from the coordinator. The coordinator  may receive up to k messages in a round, and respond to each of them in the same round. Thus, in some respects, this model is similar to the model in previous work. The case where multiple elements are observed per round is further described herein.","The sizes of the different local streams at the sites , , their order of arrival and the interleaving of the streams at different sites can all be arbitrary. The process utilized by embodiments makes no assumptions regarding these.","Process","The basic approach behind the process is essentially as follows. Each site ,  associates a random \u201cweight\u201d with each element that it receives. The coordinator  then maintains the set  of s elements with the minimum weights in the union of the streams at all times, and this is a random sample of . The approach is similar to the spirit in all centralized reservoir sampling. In a distributed setting, an interesting aspect is at what times the sites ,  communicate with the coordinator , and vice versa.","In an embodiment, the coordinator  maintains u, which is the s-th smallest weight so far in the system, as well as the sample, , consisting of all the elements that have weight no more than u. Each site ,  need only maintain a single value u, which is the site's view of the s-th smallest weight in the system so far. Note that it is too expensive to keep the view of each site synchronized with the coordinator's view at all times\u2014to see this, note that the value of the s-th smallest weight changes O(s log(n\/s)) times, and updating every site each time the s-th minimum changes takes a total of O(sk log(n\/s)) messages.","In an embodiment, when site i sees an element with a weight smaller than u, it sends it to the central coordinator . The coordinator  updates u and  if needed, and then replies back to i with the current value of u, which is the true minimum weight in the union of all streams. Thus, each time a site communicates with the coordinator , it either makes a change to the random sample, or, at least, gets to refresh its view of u.",{"@attributes":{"id":"p-0053","num":"0052"},"figref":["FIGS. 1-2","FIG. 3"]},"Lemma 1.","Let n be the number of elements in  so far. (1) If n\u2266s, then the set  at the coordinator contains all the (e,w) pairs seen at all the sites so far. (2) If n>s, then  at the coordinator consists of the s(e,w) pairs such that the weights of the pairs in  are the smallest weights in the stream so far. The proof of this lemma is immediate from the description of the protocol.","Lemma 2.","At the end of each round, sample  at the coordinator consists of a uniform random sample size of min {n, s} chosen without replacement from .","Proof.","In case n\u2266s, it is known that  contains every element of . In case n>s, from Lemma 1, it follows that  consists of s elements with the smallest weights from . Since the weights are assigned randomly, each element in  has a probability of",{"@attributes":{"id":"p-0060","num":"0059"},"maths":{"@attributes":{"id":"MATH-US-00013","num":"00013"},"math":{"@attributes":{"overflow":"scroll"},"mfrac":{"mi":["s","n"]}}},"br":{},"img":{"@attributes":{"id":"CUSTOM-CHARACTER-00022","he":"3.13mm","wi":"2.46mm","file":"US08392434-20130305-P00002.TIF","alt":"custom character","img-content":"character","img-format":"tif"}}},"Analysis","Now described are the message complexity and the maintenance of a random sample. For the sake of description, execution of the process is divided into \u201cepochs\u201d, where each epoch consists of a sequence of rounds. The epochs are defined inductively. Let r>1 be a parameter, which will be fixed later. Recall that u is the s-th smallest weight so far in the system (if there are fewer than s elements so far, u=1). Epoch 0 is the set of all rounds from the beginning of execution unit (and including) the earliest round where u is",{"@attributes":{"id":"p-0063","num":"0062"},"maths":{"@attributes":{"id":"MATH-US-00014","num":"00014"},"math":{"@attributes":{"overflow":"scroll"},"mfrac":{"mn":"1","mi":"r"}}},"br":{},"sub":"i "},{"@attributes":{"id":"p-0064","num":"0063"},"maths":{"@attributes":{"id":"MATH-US-00015","num":"00015"},"math":{"@attributes":{"overflow":"scroll"},"mfrac":{"msub":{"mi":["m","i"]},"mi":"r"}}},"br":{}},"If the original distributed system process illustrated in  are referred to as Process A, for the analysis, a slightly different distributed process, Process B is described. Process B is identical to Process A except for the fact that at the beginning of each epoch, the value u is broadcast by the coordinator to all sites.","While Process A is natural, Process B is easier to analyze. First, it is noted that the same inputs, the value of u (and )) at the coordinator, at any round in Process B is identical to the value of u (and ) at the coordinator in Process A at the same round. Hence, the partitioning of rounds into epochs is the same for both processes, for a given input. The correctness of Process B follows from the correctness of Process A. The only difference between them is in the total number of messages sent. In Process B, there is a property that for all i from 1 to k, u=u at the beginning of each epoch (though this is not necessarily true throughout the epoch), and for this, Process B has to pay a cost of at least k messages in each epoch.","Lemma 3.","The number of messages sent by Process A for a set of streams , j\u22121 is never more than twice the number of messages sent by Process B for the same input.","Proof.","Consider site v in a particular epoch i. In Process B, v receives mat the beginning of the epoch through a message from the coordinator. In Process A, v may not know m, at the beginning of epoch i. Two cases are considered.","Case I: v sends a message to the coordinator in epoch i in Process A. In this case, the first time v sends a message to the coordinator in this epoch, v will receive the current value of u, which is smaller than or equal to m. This communication costs two messages, one in each direction. Henceforth, in this epoch, the number of messages sent in Process A is no more than those sent in Process B. In this epoch, the number of messages transmitted to\/from v in Process A is at most twice the number of messages as in Process B, which has at least one transmission from the coordinator to site v.","Case II: v did not send a message to the coordinator in this epoch, in Process A. In this case, the number of messages sent in this epoch to\/from site v in Process A is smaller than in Process B.","Let \u03be denote the total number of epochs.","Lemma 4.","If r\u22672,",{"@attributes":{"id":"p-0076","num":"0075"},"maths":{"@attributes":{"id":"MATH-US-00016","num":"00016"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"E","mo":"\u2062","mrow":{"mo":["\uf603","\uf604"],"mi":"\u03be"}},{"mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}},{"mi":["log","s"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}]}},"mo":"+","mn":"2"}],"mo":"\u2264"}}}},"Proof.","Let",{"@attributes":{"id":"p-0079","num":"0078"},"maths":{"@attributes":{"id":"MATH-US-00017","num":"00017"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"z","mo":"=","mrow":{"mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","r"],"mo":"\/"}}},{"mi":["log","r"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}]}},"mo":"."}}}},"br":{}},{"@attributes":{"id":"p-0080","num":"0079"},"maths":{"@attributes":{"id":"MATH-US-00018","num":"00018"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mfrac":{"mn":"1","msup":{"mi":"r","mrow":{"mi":["z","l"],"mo":"+"}}},"mo":"=","mrow":{"mrow":[{"mo":["(",")"],"mfrac":{"mi":["r","n"]}},{"mfrac":{"mn":"1","msup":{"mi":["r","l"]}},"mo":"."}],"mo":"\u2062"}}}},"br":{}},{"@attributes":{"id":"p-0081","num":"0080"},"maths":{"@attributes":{"id":"MATH-US-00019","num":"00019"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mi":"\u03be","mo":"\u2265","mrow":{"mi":["z","l"],"mo":"+"}}}},{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mi":"u","mo":"\u2264","mrow":{"mrow":{"mo":["(",")"],"mfrac":{"mi":["s","n"]}},"mo":"\u2062","mfrac":{"mn":"1","msup":{"mi":["r","l"]}}}}}}],"mo":"\u2264"}}}},"Let Y denote the number of elements (out of n) that have been assigned a weight of",{"@attributes":{"id":"p-0083","num":"0082"},"maths":{"@attributes":{"id":"MATH-US-00020","num":"00020"},"math":{"@attributes":{"overflow":"scroll"},"mfrac":{"mi":"s","msup":{"mi":["nr","l"]}}}},"br":{}},{"@attributes":{"id":"p-0084","num":"0083"},"maths":{"@attributes":{"id":"MATH-US-00021","num":"00021"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mfrac":{"mi":"s","msup":{"mi":["r","l"]}},"mo":"."}}},"br":{}},{"@attributes":{"id":"p-0085","num":"0084"},"maths":{"@attributes":{"id":"MATH-US-00022","num":"00022"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"u","mo":"\u2264","mfrac":{"mi":"s","msup":{"mi":["nr","l"]}}},"mo":","}}},"br":{}},{"@attributes":{"id":"p-0086","num":"0085"},"maths":{"@attributes":{"id":"MATH-US-00023","num":"00023"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mi":"\u03be","mo":"\u2265","mrow":{"mi":["z","l"],"mo":"+"}}}},{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mi":["Y","s"],"mo":"\u2265"}}},{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mi":"Y","mo":"\u2265","mrow":{"msup":{"mi":["r","l"]},"mo":"\u2062","mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"Y"}}}}}}],"mo":["\u2264","\u2264","\u2264"],"mfrac":{"mn":"1","msup":{"mi":["r","l"]}}}}},"br":{}},"Since \u03be takes only positive integral values,",{"@attributes":{"id":"p-0088","num":"0087"},"maths":{"@attributes":{"id":"MATH-US-00024","num":"00024"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"\u03be"}},{"mrow":[{"munderover":{"mo":"\u2211","mrow":{"mi":"i","mo":">","mn":"0"},"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mi":["\u03be","i"],"mo":"\u2265"}}}},{"mrow":[{"mrow":[{"munderover":{"mo":"\u2211","mrow":{"mi":"i","mo":"=","mn":"1"},"mi":"z"},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mi":["\u03be","i"],"mo":"\u2265"}}}},{"munderover":{"mo":"\u2211","mrow":{"mi":"l","mo":"\u2265","mn":"1"},"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mi":"\u03be","mo":"\u2265","mrow":{"mi":["z","l"],"mo":"+"}}}}}],"mo":"+"},{"mi":"z","mo":"+","mrow":{"munderover":{"mo":"\u2211","mrow":{"mi":"l","mo":"\u2265","mn":"1"},"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mfrac":{"mn":"1","msup":{"mi":["r","l"]}}}},{"mi":"z","mo":"+","mfrac":{"mn":"1","mrow":{"mn":"1","mo":"-","mrow":{"mn":"1","mo":"\/","mi":"r"}}}},{"mi":"z","mo":"+","mn":"2"}],"mo":["\u2264","\u2264","\u2264"]}],"mo":"="}],"mo":"="}}},"br":{}},"Let ndenote the total number of elements that arrived in epoch j, thus n=\u03a3n. Let \u03bc denote the total number of messages sent during the entire execution. Let \u03bcdenote the total number of messages sent in epoch i. Let Xdenote the number of messages sent from the sites to the coordinator in epoch i, \u03bcis the sum of two parts, (1) k messages sent by the coordinator at the start of the epoch, and (2) two times the number of messages sent from the sites to the coordinator.\n\n\u03bc2\u2003\u2003(1)\n",{"@attributes":{"id":"p-0090","num":"0089"},"maths":{"@attributes":{"id":"MATH-US-00025","num":"00025"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mi":"\u03bc","mo":"=","mrow":{"mrow":[{"munderover":{"mo":"\u2211","mrow":[{"mi":"j","mo":"=","mn":"0"},{"mi":"\u03be","mo":"-","mn":"1"}]},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"msub":{"mi":["\u03bc","i"]}},{"mrow":[{"mi":["\u03be","k"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},{"mn":"2","mo":"\u2062","mrow":{"munderover":{"mo":"\u2211","mrow":[{"mi":"j","mo":"=","mn":"0"},{"mi":"\u03be","mo":"-","mn":"1"}]},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"msub":{"mi":["X","j"]}}}],"mo":"+"}],"mo":"="}}},{"mrow":{"mo":["(",")"],"mn":"2"}}]}}}}},"Consider epoch i. For each element j=1 . . . n in epoch i, a 0-1 random variable Yis defined as follows. Y=1 if observing the j-th element in the epoch resulted in a message being sent to the coordinator, and Y=0 otherwise.",{"@attributes":{"id":"p-0092","num":"0091"},"maths":{"@attributes":{"id":"MATH-US-00026","num":"00026"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msub":{"mi":["X","i"]},"mo":"=","mrow":{"munderover":{"mo":"\u2211","mrow":{"mi":"j","mo":"=","mn":"1"},"msub":{"mi":["n","i"]}},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"msub":{"mi":["Y","j"]}}}},{"mrow":{"mo":["(",")"],"mn":"3"}}]}}}}},"Let F(n,\u03b1) denote the event n=\u03b7 and m=\u03b1. The following Lemma gives a bound on a conditional probability that is described later.","Lemma 5.","For each j=1 . . . n\u22121",{"@attributes":{"id":"p-0096","num":"0095"},"maths":{"@attributes":{"id":"MATH-US-00027","num":"00027"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"msub":{"mi":["Y","j"]},"mo":"=","mrow":{"mn":"1","mo":"\u2758","mrow":{"mi":"F","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["\u03b7","\u03b1"],"mo":","}}}}}}},"mo":"\u2264","mfrac":{"mrow":[{"mi":"\u03b1","mo":"-","mrow":{"mi":["\u03b1","r"],"mo":"\/"}},{"mn":"1","mo":"-","mrow":{"mi":["\u03b1","r"],"mo":"\/"}}]}}}}},"Proof.","Suppose that the j-th element in the epoch was observed by site v. For this element to cause a message to be sent to the coordinator, the random weight assigned to it must be less than uat that instant. Conditioned on m=\u03b1, uis no more than \u03b1.","Note that in this lemma, the last element that arrived in epoch i is excluded. Thus, the weight assigned to element j must be greater than \u03b1\/r. Thus, the weight assigned to j must be a uniform random number in the range (\u03b1\/r, 1). The probability this weight is less than the current value of uis no more than",{"@attributes":{"id":"p-0100","num":"0099"},"maths":{"@attributes":{"id":"MATH-US-00028","num":"00028"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mfrac":{"mrow":[{"mi":"\u03b1","mo":"-","mrow":{"mi":["\u03b1","r"],"mo":"\/"}},{"mn":"1","mo":"-","mrow":{"mi":["\u03b1","r"],"mo":"\/"}}]},"mo":","}}},"br":{},"sub":"v"},"Lemma 6.","For each epoch i\n\n]1+2\n","Proof.","The expectation conditioned on F(\u03b7,\u03b1) is first obtained, and then the conditioning is removed. From Lemma 5 and Equation 3:",{"@attributes":{"id":"p-0105","num":"0104"},"maths":{"@attributes":{"id":"MATH-US-00029","num":"00029"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"msub":{"mi":["F","i"]},"mo":"\u2758","mrow":{"mi":"F","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["\u03b7","\u03b1"],"mo":","}}}}}},{"mn":"1","mo":"+","mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mrow":[{"mo":["(",")"],"mrow":{"munderover":{"mo":"\u2211","mrow":[{"mi":"j","mo":"=","mn":"1"},{"mi":"\u03b7","mo":"-","mn":"1"}]},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"msub":{"mi":["Y","j"]}}},{"mi":"F","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["\u03b7","\u03b1"],"mo":","}}}],"mo":"\u2062"}}}},{"mn":"1","mo":"+","mrow":{"munderover":{"mo":"\u2211","mrow":[{"mi":"j","mo":"=","mn":"1"},{"mi":"\u03b7","mo":"-","mn":"1"}]},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"msub":{"mi":["Y","j"]},"mo":"\u2758","mrow":{"mi":"F","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["\u03b7","\u03b1"],"mo":","}}}}}}}},{"mn":"1","mo":"+","mrow":{"mrow":{"mo":["(",")"],"mrow":{"mi":"\u03b7","mo":"-","mn":"1"}},"mo":"\u2062","mfrac":{"mrow":[{"mi":"\u03b1","mo":"-","mrow":{"mi":["\u03b1","r"],"mo":"\/"}},{"mn":"1","mo":"-","mrow":{"mi":["\u03b1","r"],"mo":"\/"}}]}}}],"mo":["\u2264","\u2264","\u2264"]}}},"br":{},"sub":"i"},"Next considered is the conditional expectation E[X|m=\u03b1].",{"@attributes":{"id":"p-0107","num":"0106"},"maths":{"@attributes":{"id":"MATH-US-00030","num":"00030"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":[{"mtd":{"mrow":{"mrow":[{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mrow":{"msub":[{"mi":["X","i"]},{"mi":["m","i"]}],"mo":"|"},"mo":"=","mi":"\u03b1"}}},{"munder":{"mo":"\u2211","mi":"\u03b7"},"mo":"\u2062","mrow":{"mrow":[{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"msub":{"mi":["n","i"]},"mo":"=","mrow":{"mrow":{"mi":"\u03b7","mo":"|","msub":{"mi":["m","i"]}},"mo":"=","mi":"\u03b1"}}}},{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mrow":[{"mrow":{"msub":[{"mi":["X","i"]},{"mi":["n","i"]}],"mo":"\u2062"},"mo":"=","mi":"\u03b7"},{"msub":{"mi":["m","i"]},"mo":"=","mi":"\u03b1"}],"mo":","}}}],"mo":"\u2062"}}],"mo":["=","\u2062"],"mi":{}}}},{"mtd":{"mrow":{"mo":["\u2264","\u2062"],"mi":{},"mrow":{"munder":{"mo":"\u2211","mi":"\u03b7"},"mo":"\u2062","mrow":{"mrow":[{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"msub":{"mi":["n","i"]},"mo":"=","mrow":{"mrow":{"mi":"\u03b7","mo":"||","msub":{"mi":["m","i"]}},"mo":"=","mi":"\u03b1"}}}},{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mn":"2","mo":["\u2062","\u2062"],"mrow":{"mo":["(",")"],"mrow":{"mi":"\u03b7","mo":"-","mn":"1"}},"mi":"\u03b1"}}}],"mo":"\u2062"}}}}},{"mtd":{"mrow":{"mo":["\u2264","\u2062"],"mi":{},"mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mrow":{"mrow":{"mn":"1","mo":"+","mrow":{"mn":"2","mo":["\u2062","\u2062"],"mrow":{"mo":["(",")"],"mrow":{"msub":{"mi":["n","i"]},"mo":"-","mn":"1"}},"mi":"\u03b1"}},"mo":"|","msub":{"mi":["m","i"]}},"mo":"=","mi":"\u03b1"}}}}}},{"mtd":{"mrow":{"mo":["\u2264","\u2062"],"mi":{},"mrow":{"mn":"1","mo":"+","mrow":{"mn":"2","mo":"\u2062","mrow":{"mi":"\u03b1","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mrow":{"msub":[{"mi":["n","i"]},{"mi":["m","i"]}],"mo":"|"},"mo":"=","mi":"\u03b1"}}},"mo":"-","mn":"1"}}}}}}}}]}}},"br":{}},{"@attributes":{"id":"p-0108","num":"0107"},"maths":{"@attributes":{"id":"MATH-US-00031","num":"00031"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mrow":{"msub":[{"mi":["X","i"]},{"mi":["m","i"]}],"mo":"\u2758"},"mo":"=","mi":"\u03b1"}}},{"mn":"1","mo":"+","mrow":{"mn":"2","mo":"\u2062","mrow":{"mi":"\u03b1","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mfrac":{"mi":["rs","\u03b1"]},"mo":"-","mn":"1"}}}}},{"mn":"1","mo":"+","mrow":{"mn":"2","mo":"\u2062","mi":"rs"}}],"mo":["\u2264","\u2264"]}}},"br":{},"sub":["i","i","i","i"]},"Lemma 7.",{"@attributes":{"id":"p-0110","num":"0109"},"maths":{"@attributes":{"id":"MATH-US-00032","num":"00032"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mrow":{"msub":[{"mi":["X","i"]},{"mi":["m","i"]}],"mo":"\u2758"},"mo":"=","mi":"\u03b1"}}},"mo":"=","mfrac":{"mi":["rs","\u03b1"]}}}}},"Proof.","Recall that n, the total number of elements in epoch i, is the number of elements observed until the s-th minimum in the stream decreases to a value that is less than or equal to \u03b1\/r.","Let Z denote a random variable that equals the number of elements to be observed from the start of epoch i until s new elements are seen, each of whose weight is less than or equal to \u03b1\/r. Clearly, conditioned on m=\u03b1, it must be true that n\u2266Z. For j=1 to s, let Zdenote the number of elements observed from the state when (j\u22121) elements have been observed with weights that are less than \u03b1\/r until the state when j elements have been observed with weights less than \u03b1\/r. Zis a geometric random variable with parameter \u03b1\/r.","Having",{"@attributes":{"id":"p-0115","num":"0114"},"maths":{"@attributes":{"id":"MATH-US-00033","num":"00033"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"Z","mo":"=","mrow":{"mrow":[{"munderover":{"mo":"\u2211","mrow":{"mi":"j","mo":"=","mn":"1"},"mi":"s"},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"msub":{"mi":["Z","j"]},"mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}],"mi":"and","mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"Z"}}}},{"mrow":{"munderover":{"mo":"\u2211","mrow":{"mi":"j","mo":"=","mn":"1"},"mi":"s"},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"msub":{"mi":["Z","j"]}}}},"mo":"=","mfrac":{"mi":["rs","\u03b1"]}}],"mo":"="}},"mo":","}}},"br":{},"sub":["i","i"]},"Lemma 8.",{"@attributes":{"id":"p-0117","num":"0116"},"maths":{"@attributes":{"id":"MATH-US-00034","num":"00034"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"\u03bc"}},{"mrow":[{"mo":["(",")"],"mrow":{"mi":"k","mo":["+","+"],"mrow":{"mn":"4","mo":"\u2062","mi":"rs"},"mn":"2"}},{"mo":["(",")"],"mrow":{"mfrac":{"mrow":[{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}},{"mi":["log","r"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.6em","height":"0.6ex"}}}}]},"mo":"+","mn":"2"}}],"mo":"\u2062"}],"mo":"\u2264"}}}},"Proof.","Using Lemma 6 and Equation 1, the expected number of messages in epoch i is:\n\n2(21)=2+4\n\nNote that the above is independent of i. The proof follows from Lemma 4, which gives an upper bound on the expected number of epochs.\n","Theorem 1.","The expected message complexity E[\u03bc] of the process is as follows.",{"@attributes":{"id":"p-0122","num":"0121"},"maths":[{"@attributes":{"id":"MATH-US-00035","num":"00035"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mrow":{"mi":["I","If","s"],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mtext":":"},{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}]},"mo":"\u2265","mfrac":{"mi":"k","mn":"8"}},{"mrow":[{"mi":"then","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},"mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"\u03bc"}}},{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":"s","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.6em","height":"0.6ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mi":["n","s"]}}}}}}],"mo":"="}],"mo":[",","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}}}},{"@attributes":{"id":"MATH-US-00035-2","num":"00035.2"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mrow":{"mi":["II","If","s"],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mtext":":"},{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}]},"mo":"<","mfrac":{"mi":"k","mn":"8"}},{"mrow":[{"mi":"then","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},"mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"\u03bc"}}},{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.6em","height":"0.6ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mi":["n","s"]}}}},{"mi":"log","mo":"\u2062","mfrac":{"mi":["k","s"]}}]}}}],"mo":"="}],"mo":[",","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}}}}]},"Proof.","It is noted that the upper bounds on E[\u03bc] in Lemma 8 hold for any value of r\u22672.","Case I:",{"@attributes":{"id":"p-0126","num":"0125"},"maths":{"@attributes":{"id":"MATH-US-00036","num":"00036"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"s","mo":"\u2265","mrow":{"mfrac":{"mi":"k","mn":"8"},"mo":"."}}}},"br":{}},{"@attributes":{"id":"p-0127","num":"0126"},"maths":{"@attributes":{"id":"MATH-US-00037","num":"00037"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mrow":[{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"\u03bc"}},{"mrow":[{"mo":["(",")"],"mrow":{"mrow":[{"mn":"8","mo":"\u2062","mi":"s"},{"mn":"8","mo":"\u2062","mi":"s"}],"mo":["+","+"],"mn":"2"}},{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}},{"mi":"log","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mn":"2"}]}}],"mo":"\u2062"}],"mo":"\u2264"},{"mrow":[{"mrow":[{"mo":["(",")"],"mrow":{"mrow":{"mn":"16","mo":"\u2062","mi":"s"},"mo":"+","mn":"2"}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mi":["n","s"]}}}],"mo":"\u2062"},{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":"s","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.6em","height":"0.6ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mi":["n","s"]}}}}}}],"mo":"="}],"mo":"="}}}},"Case II:",{"@attributes":{"id":"p-0129","num":"0128"},"maths":{"@attributes":{"id":"MATH-US-00038","num":"00038"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"s","mo":"<","mrow":{"mfrac":{"mi":"k","mn":"8"},"mo":"."}}}},"br":{}},{"@attributes":{"id":"p-0130","num":"0129"},"maths":{"@attributes":{"id":"MATH-US-00039","num":"00039"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"r","mo":"=","mfrac":{"mi":"k","mrow":{"mn":"4","mo":"\u2062","mi":"s"}}}}},"br":{}},{"@attributes":{"id":"p-0131","num":"0130"},"maths":{"@attributes":{"id":"MATH-US-00040","num":"00040"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"\u03bc"}},{"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.6em","height":"0.6ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mi":["n","s"]}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mi":["k","s"]}}}]}}},"mo":"."}],"mo":"="}}}},"Lower Bound","Theorem 2. For any constant q, 0<q<1, any correct protocol must send",{"@attributes":{"id":"p-0134","num":"0133"},"maths":{"@attributes":{"id":"MATH-US-00041","num":"00041"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"\u03a9","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}}}]}}}}},"br":{}},"Proof.","Let \u03b2=(1+(k\/s)). Defining",{"@attributes":{"id":"p-0137","num":"0136"},"maths":{"@attributes":{"id":"MATH-US-00042","num":"00042"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"e","mo":"=","mrow":{"mi":"\u03b8","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}}}]}}}}}},"br":{},"sup":"i\u22121"},"A distribution on orderings of the stream updates is considered. Namely, on a totally-ordered stream 1, 2, 3 . . . , n of n updates, and in the i-th epoch, the \u03b2k updates are randomly assigned among the k servers, independently for each epoch. Let the randomness used for the assignment in the i-th epoch be denoted \u03c3.","Considering the global stream of updates, suppose a sample set  of s is maintained without replacement. Letting denote a random variable indicating the value of  after seeing i updates in the stream, the following lemma is used about random sampling.","Lemma 9. For any constant q>0, there is a constant C\u2032=C\u2032(q)>0 for which\n\n","Proof.","Consider the stream 1, 2, 3 . . . , n of updates. In the classical reservoir sampling algorithm,  is initialized to 1, 2, 3 . . . , s. Then, for each i>s, the i-th element is included in the current sample set with probability s\/i, in which case a random item in is replaced with i.","For the first part of Lemma 9, let Xbe an indicator random variable if i causes  to change. Let X=\u03a3X. Hence, E[X]=1 for 1\u2266i\u2266s, and E[X]=s\/i for all i>s. Then E[X]=s+\u03a3s\/i=s+s(H\u2212H), where H=ln i+O(1) is the i-th Harmonic number. Then all of the Xare independent indicator random variables. It follows by a Chernoff bound that",{"@attributes":{"id":"p-0144","num":"0145"},"maths":{"@attributes":{"id":"MATH-US-00043","num":"00043"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":[{"mtd":{"mrow":{"mrow":[{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"X"}},{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mi":"X","mo":"\/","mn":"2"}}},{"mi":"exp","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mrow":{"mo":"-","mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"X"}}},"mo":"\/","mn":"8"}}}],"mo":["<","\u2264","\u2062"],"mi":{}}}},{"mtd":{"mrow":{"mo":["\u2264","\u2062"],"mi":{},"mrow":{"mi":"exp","mo":"(","mrow":{"mo":"-","mrow":{"mo":["(",")"],"mrow":{"mi":"s","mo":["+","-"],"mrow":[{"mi":"s","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"ln","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mn":"1"}},"mo":"\/","mn":"8"}]}}}}}}},{"mtd":{"mrow":{"mo":["\u2264","\u2062"],"mi":{},"mrow":{"mrow":[{"mi":"exp","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mo":"-","mrow":{"mi":"\u0398","mo":"\u2061","mrow":{"mo":["(",")"],"mi":"s"}}}}},{"msup":{"mrow":[{"mo":["(",")"],"mfrac":{"mi":["s","n"]}},{"mi":"s","mo":"\/","mn":"8"}]},"mo":"."}],"mo":"\u2062"}}}}]}}},"br":{},"sub":["0 ","0"]},"For the second part of Lemma 9, consider the i-th epoch, i>0, which contains \u03b2k consecutive updates. Let Ybe the number of changes in this epoch. Then E[Y]\u2267s(H\u2212H)=\u03a9(s log \u03b2). Note that \u03b2\u22679 since s<k\/8 by assumption, and \u03b2=1+k\/s. Since Ycan be written as a sum of independent indicator random variables, by a Chernoff bound,",{"@attributes":{"id":"p-0146","num":"0147"},"maths":{"@attributes":{"id":"MATH-US-00044","num":"00044"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"Pr","mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"msub":{"mi":["Y","i"]},"mo":"<","mrow":{"mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"msub":{"mi":["Y","i"]}}},"mo":"\/","mn":"2"}}}},{"mi":"exp","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mrow":{"mo":"-","mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"msub":{"mi":["Y","i"]}}}},"mo":"\/","mn":"8"}}},{"mi":"exp","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mo":"-","mrow":{"mi":"\u03a9","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["s","log","\u03b2"],"mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}]}}}}}},{"mfrac":{"mn":"1","mrow":{"mi":"\u03b2","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"\u03a9","mo":"\u2061","mrow":{"mo":["(",")"],"mi":"s"}}}},"mo":"."}],"mo":["\u2264","\u2264","\u2264"]}}}},"Hence, the expected number of epochs i for which Y<E[Y]\/2 is at most",{"@attributes":{"id":"p-0148","num":"0149"},"maths":{"@attributes":{"id":"MATH-US-00045","num":"00045"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"munderover":{"mo":"\u2211","mrow":{"mi":"i","mo":"=","mn":"1"},"mi":"e"},"mo":"\u2062","mfrac":{"mn":"1","msup":{"mrow":[{"mi":"\u03b2","mo":"\u2062","mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},{"mi":"\u03a9","mo":"\u2061","mrow":{"mo":["(",")"],"mi":"s"}}]}}},"mo":","}}},"br":{},"sub":["i","i ","i"]},"Corner Cases","When s\u2267k\/8, the statement of Theorem 2 gives a lower bound of \u03a9(s log(n\/s)). In this case Theorem 2 follows immediately from the first part of Lemma 9 since these changes in  must be communicated to the central coordinator. Hence, in what follows it can be assumed that s<k\/8. Notice also that if k=O(1), then",{"@attributes":{"id":"p-0151","num":"0152"},"maths":{"@attributes":{"id":"MATH-US-00046","num":"00046"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}}}]},"mo":"=","mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":"s","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}}}}},"mo":","}}},"br":{}},"Main Case: Let C>0 be a sufficiently small constant, depending on q, to be determined below. Let H be a possibly randomized protocol, which with probability of at least q, sends at most Cke messages. \u03a0 can not be a correct protocol.","Let \u03c4 denote the random coin tosses of \u03a0, that is, the concatenation of random strings of all k sites together with that of the central coordinator.","Let \u03b5 be the event that \u03a0 sends less than Cke messages. By assumption, Pr[\u03b5] q. Hence, it is also the case that\n\n\n\n\u03c4,{},{\u03c3}\n","For a sufficiently small constant C\u2032>0 that may depend on q, let  be the event that there are at least (1\u2212(q\/8))e epochs for which the number of times  changes in the epoch at least C\u2032s log(1+k\/s)). By the second part of Lemma 9,\n\n\n\n\u03c4{},{\u03c3}\n\nIt follows that there is a fixing of \u03c4=\u03c4\u2032 as well as a fixing of , , . . . , to \u2032, \u2032, . . . , \u2032 for which  occurs and\n",{"@attributes":{"id":"p-0156","num":"0157"},"maths":{"@attributes":{"id":"MATH-US-00047","num":"00047"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mrow":[{"munder":{"mi":"Pr","mrow":{"mo":["{","}"],"msub":{"mi":["\u03c3","i"]}}},"mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mrow":[{"mrow":{"mi":["\u025b","\u03c4"],"mo":"|"},"mo":"=","msup":{"mi":["\u03c4","\u2032"]}},{"mrow":[{"mo":["(",")"],"mrow":{"msub":[{"mn":"0"},{"mn":"1"},{"mi":"e"}],"mo":[",",",","\u2062",","],"mi":"\u2026","mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}}},{"mo":["(",")"],"mrow":{"msubsup":[{"mn":"0","mi":"\u2032"},{"mn":"1","mi":"\u2032"}],"mo":[",",","],"mrow":{"mi":"\u2026","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},"msubsup":{"mi":["e","\u2032"]}}}}],"mo":"="}],"mo":","}}},{"mi":"q","mo":"-","mrow":{"mi":"q","mo":"\/","mn":"2"}}],"mo":"\u2265"},{"mi":"q","mo":"\/","mn":"2"}],"mo":"="}}}},"Notice that the three (sets of) random variables \u03c4, {}, and {\u03c3} are independent, and so in particular, {\u03c3} is still uniformly random given this conditioning.","By a Markov argument, if event \u03b5 occurs, then there are at least (1\u2212(q\/8))e epochs for which at most (8\/q))\u00b7C\u00b7k messages are sent. If events \u03b5 and  both occur, then by a union bound, there are at least (1\u2212(q\/4))e epochs for which at most (8\/q))\u00b7C\u00b7k messages are sent and  changes in the epoch at least C\u2032s log(1+k\/s)) times. Such an epoch is referred to herein as balanced.","Let i* be the epoch which is most likely to be balanced, over the random choices of {\u03c3}, conditioned on \u03c4=\u03c4\u2032 and (, , . . . , )=(\u2032, \u2032, . . . , \u2032). Since at least (1\u2212(q\/4))e epochs are balanced if \u03b5 and  occur, and conditioned on (, , . . . , )=(\u2032, \u2032, . . . , \u2032) event  does occur, and \u03b5 occurs with probability at least q\/2 given this conditioning, it follows that",{"@attributes":{"id":"p-0160","num":"0161"},"maths":{"@attributes":{"id":"MATH-US-00048","num":"00048"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mrow":[{"munder":{"mi":"Pr","mrow":{"mo":["{","}"],"msub":{"mi":["\u03c3","i"]}}},"mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mrow":[{"mrow":{"mrow":{"msup":{"mi":"i","mo":"*"},"mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}],"mi":["is","balanced"]},"mo":"|","mi":"\u03c4"},"mo":"=","msup":{"mi":["\u03c4","\u2032"]}},{"mrow":[{"mo":["(",")"],"mrow":{"msub":[{"mn":"0"},{"mn":"1"},{"mi":"e"}],"mo":[",",",","\u2062",","],"mi":"\u2026","mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}}},{"mo":["(",")"],"mrow":{"msubsup":[{"mn":"0","mi":"\u2032"},{"mn":"1","mi":"\u2032"}],"mo":[",",","],"mrow":{"mi":"\u2026","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},"msubsup":{"mi":["e","\u2032"]}}}}],"mo":"="}],"mo":","}}},{"mrow":[{"mi":"q","mo":"\/","mn":"2"},{"mi":"q","mo":"\/","mn":"4"}],"mo":"-"}],"mo":"\u2265"},{"mi":"q","mo":"\/","mn":"4"}],"mo":"="}}},"br":{},"sub":"j "},{"@attributes":{"id":"p-0161","num":"0162"},"maths":{"@attributes":{"id":"MATH-US-00049","num":"00049"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"munder":{"mi":"Pr","mrow":{"mo":["{","}"],"msub":{"mi":["\u03c3","i"]}}},"mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"mrow":[{"mrow":{"mrow":{"msup":{"mi":"i","mo":"*"},"mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}],"mi":["is","balanced"]},"mo":"|","mi":"\u03c4"},"mo":"=","msup":{"mi":["\u03c4","\u2032"]}},{"mrow":[{"mo":["(",")"],"mrow":{"msub":[{"mn":"0"},{"mn":"1"},{"mi":"e"}],"mo":[",",",","\u2062",","],"mi":"\u2026","mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}}},{"mo":["(",")"],"mrow":{"msubsup":[{"mn":"0","mi":"\u2032"},{"mn":"1","mi":"\u2032"}],"mo":[",",","],"mrow":{"mi":"\u2026","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},"msubsup":{"mi":["e","\u2032"]}}}}],"mo":"="}],"mo":","}}},{"mi":"q","mo":"\/","mn":"4"}],"mo":"\u2265"}}}},"Since C\u2032s log(1+k\/s))>0 and  changes at least C\u2032s log (1+k s)) times in epoch i*,  changes at least once in epoch i*. Suppose the first update in the global stream at which  changes is the j-th update. In order for i* to be balanced for at least a q\/4 fraction of the \u03c3, there must be at least qk\/4 different servers which receive j*, for which H sends a message. In particular, since \u03a0 is deterministic conditioned on \u03c4, at least qk\/4 messages must be sent in the i-th epoch. But i* was chosen so that at most (8\/q))\u00b7C\u00b7k messages are sent, which is a contradiction for C<q\/32.","It follows that a contradiction has been reached, and it also follows that Cke messages must be sent with probability at least 2\u2212q. Since",{"@attributes":{"id":"p-0164","num":"0165"},"maths":{"@attributes":{"id":"MATH-US-00050","num":"00050"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"Cke","mo":"=","mrow":{"mi":"\u03a9","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":"k","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":["n","s"],"mo":"\/"}}}},{"mi":"log","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mo":["(",")"],"mrow":{"mi":["k","s"],"mo":"\/"}}}}}]}}}},"mo":","}}},"br":{}},"Sampling with Replacement","Now described is an example process to maintain a random sample of size s with replacement from . The basic idea is to run in parallel s copies of the single item sampling process described above. Done naively, this will lead to a message complexity of",{"@attributes":{"id":"p-0167","num":"0168"},"maths":{"@attributes":{"id":"MATH-US-00051","num":"00051"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":"sk","mo":"\u2062","mfrac":{"mrow":[{"mi":["log","n"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},{"mi":["log","k"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}]}}}},"mo":"."}}},"br":{}},"Viewing the distributed streams as s logical streams, , i=1 . . . s. Each is identical to , but the process assigns independent weights to the different copies of the same element in the different logical streams. Let \u03c9(e) denote the weight assigned to element e in . \u03c9(e) is a random number between 0 and 1. For each i=1 . . . s , the coordinator maintains the minimum weight, \u03c9, among all elements in , and the corresponding element.","Let \u03b2\/max\u03c9; \u03b2 is maintained by the coordinator. Each site j maintains \u03b2, a local view of \u03b2, which is always greater than or equal to \u03b2. Whenever a logical stream element at site j has a weight less than \u03b2, the site sends it to the coordinator, receives in response the current value of \u03b2, and updates \u03b2. When a random sample is requested at the coordinator, it returns the set of all minimum weight elements in all s logical streams. It can easily be seen that this process is correct, and at all times returns a random sample of size s selected with replacement. The main optimization relative to the na\u00efve approach described above is that when a site sends a message to the coordinator, it receives \u03b2, which provides partial information about all \u03c9s. This provides a substantial improvement in the message complexity and leads to the following bounds","Theorem 3.","The above process continuously maintains a sample of size s with replacement from , and its expected message complexity is O(s logs loge) in case k\u22662s log s and",{"@attributes":{"id":"p-0172","num":"0173"},"maths":{"@attributes":{"id":"MATH-US-00052","num":"00052"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"O","mo":["(",")"],"mrow":{"mi":"k","mo":"\u2062","mfrac":{"mrow":[{"mi":["log","n"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},{"mi":"log","mo":["(","\u2062",")"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mfrac":{"mi":"k","mrow":{"mi":["s","log","s"],"mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}]}}}]}}}}},"br":{}},"Proof.","A sketch of the proof is provided. The analysis of the message complexity is similar to the case of sampling without replacement. The analysis is sketched here and the details are omitted for the sake of compact description. The execution is divided into epochs, where in epoch i the value of \u03b2 at the coordinator decreases by at least a factor of r (a parameter to be determined). Let \u03be denote the number of epochs. It can be seen that",{"@attributes":{"id":"p-0175","num":"0176"},"maths":{"@attributes":{"id":"MATH-US-00053","num":"00053"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"E","mo":"\u2061","mrow":{"mo":["[","]"],"mi":"\u03be"}},{"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mrow":[{"mi":["log","n"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},{"mi":["log","s"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}]}}},"mo":"."}],"mo":"="}}},"br":{},"sub":["i ","i ","i "]},"The nelements in epoch i give rise to snlogical elements, and each logical element has a probability of no more than mof resulting in a message to the coordinator. Similar to the proof of Lemma 6, it can be shown using conditional expectations that E[X]\u2266rs log s. Thus, the expected total number of messages in epoch i is bounded by (k+2rs log s), and in the entire execution is",{"@attributes":{"id":"p-0177","num":"0178"},"maths":{"@attributes":{"id":"MATH-US-00054","num":"00054"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"O","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mrow":{"mo":["(",")"],"mrow":{"mi":"k","mo":"+","mrow":{"mn":"2","mo":["\u2062","\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mi":["rs","log","s"]}}},"mo":"\u2062","mfrac":{"mrow":[{"mi":["log","n"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},{"mi":["log","r"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}]}}}},"mo":"."}}},"br":{}},"Thus, in view of the foregoing description, and now referring again to , it can be appreciated that in an environment where a plurality of sensors , , such as network routers, handle streaming data elements, such as IP addresses, an embodiment provides for sampling from the distributed streams by maintaining a random sample at the coordinator  with a minimum use of bandwidth and message complexity. At the outset, all sensors ,  assign a random number within a predetermined range (for example, 0-1) to a data element received and report it as an initial sample to the coordinator . The coordinator  in turn determines a global value (for example, a minimum or maximum value from the plurality of random numbers received thus far) from among the random numbers. The coordinator responds to those sensors, for example sensor , that have not reported the data element with the lowest random value. The coordinator's current lowest value (globally) is a random sample from the plurality of streams, as reported by sensors , .","Referring to , once a sensor (for example, sensor ) has received a communication from the coordinator indicating the global value (for example, a global minimum value), the sensor continues receive data elements from the data stream  and continues to assign random numbers to the received data elements . By comparing  the random number assigned for a given data element to a current global threshold value, the sensors may determine  when it is appropriate to report a sample back to a coordinator node. The sensor may determine that the current random number value is not reportable , and may maintain its current sample .","However, when the random number value is reportable, for example being lower than the current global threshold value (last value received from the coordinator), the sensor may determine that it is appropriate report the sample back to the coordinator . In such a case, the sensor may store the new (locally) minimum value  and report it back to the coordinator .","The coordinator node in turn continues to compare such received sample values from the sensors , and determines if these reported values establish a new global value (global minimum in this example) . If so , the coordinator establishes a new global value . However, if the reported sample is determined to not establish a new global value (is not below the current global minimum value in this example) , the coordinator communicates with the reporting sensor the current global minimum such that the reporting sensor may update its current global threshold value .","Referring to , it will be readily understood that embodiments may be implemented using any of a wide variety of devices or combinations of devices, for example for implementing sensor and\/or coordinator functionality as described herein. An example device that may be used in implementing embodiments includes a computing device in the form of a computer . In this regard, the computer  may execute program instructions configured to provide for random sampling from distributed streams, and perform other functionality of the embodiments, as described herein.","Components of computer  may include, but are not limited to, at least one processing unit , a system memory , and a system bus  that couples various system components including the system memory  to the processing unit(s) . The computer  may include or have access to a variety of computer readable media. The system memory  may include computer readable storage media in the form of volatile and\/or nonvolatile memory such as read only memory (ROM) and\/or random access memory (RAM). By way of example, and not limitation, system memory  may also include an operating system, application programs, other program modules, and program data.","A user may interface with (for example, enter commands and information) the computer  through input devices . A monitor or other type of device can also be connected to the system bus  via an interface, such as an output interface . In addition to a monitor, computers may also include other peripheral output devices. The computer  may operate in a networked or distributed environment using logical connections (network interface ) to other remote computers or databases (remote device(s) ), such as for communication between sensors and coordinator. The logical connections may include a network, such local area network (LAN) or a wide area network (WAN), but may also include other networks\/buses.","As will be appreciated by one skilled in the art, aspects may be embodied as a system, method or computer program product. Accordingly, aspects of the present invention may take the form of an entirely hardware embodiment, or an embodiment including software (including firmware, resident software, micro-code, et cetera) that may all generally be referred to herein as a \u201ccircuit,\u201d \u201cmodule\u201d or \u201csystem.\u201d Furthermore, aspects of the present invention may take the form of a computer program product embodied in at least one computer readable medium(s) having computer readable program code embodied thereon.","Any combination of at least one computer readable medium(s) may be utilized. A computer readable storage medium may be, for example, but not limited to, an electronic, magnetic, optical, electromagnetic, infrared, or semiconductor system, apparatus, or device, or any suitable combination of the foregoing. More specific examples (a non-exhaustive list) of the computer readable storage medium would include the following: an electrical connection having at least one wire(s), a portable computer diskette, a hard disk, a random access memory (RAM), a read-only memory (ROM), an erasable programmable read-only memory (EPROM or Flash memory), an optical fiber, a portable compact disc read-only memory (CD-ROM), an optical storage device, a magnetic storage device, or any suitable combination of the foregoing. In the context of this document, a computer readable storage medium may be any tangible or non-signal medium that can contain or store a program for use by or in connection with an instruction execution system, apparatus, or device.","Program code embodied on a computer readable medium may be transmitted using any appropriate medium, including but not limited to wireless, wireline, optical fiber cable, RF, etc., or any suitable combination of the foregoing.","Computer program code for carrying out operations for embodiments may be written in any combination of programming languages, including an object oriented programming language such as Java, Smalltalk, C++ or the like and conventional procedural programming languages, such as the \u201cC\u201d programming language or similar programming languages. The program code may execute entirely on a first computer, partly on the first computer, as a stand-alone software package, partly on the first computer and partly on a remote computer or entirely on the remote computer or server. In the latter scenario, the remote computer may be connected to the first computer through any type of network, including a local area network (LAN) or a wide area network (WAN), or the connection may be made to an external computer (for example, through the Internet using an Internet Service Provider).","Embodiments are described with reference to figures of methods, apparatus (systems) and computer program products according to embodiments. It will be understood that portions of the figures can be implemented by computer program instructions. These computer program instructions may be provided to a processor of a general purpose computer, special purpose computer, or other programmable data processing apparatus to produce a machine, such that the instructions, which execute via the processor of the computer or other programmable data processing apparatus, create means for implementing the functions\/acts specified.","These computer program instructions may also be stored in a computer readable medium that can direct a computer, other programmable data processing apparatus, or other devices to function in a particular manner, such that the instructions stored in the computer readable medium produce an article of manufacture including instructions which implement the function\/act specified. The computer program instructions may also be loaded onto a computer, other programmable data processing apparatus, or other devices to cause a series of operational steps to be performed on the computer, other programmable apparatus or other devices to produce a computer implemented process such that the instructions which execute on the computer or other programmable apparatus provide processes for implementing the functions\/acts specified.","This disclosure has been presented for purposes of illustration and description but is not intended to be exhaustive or limiting. Many modifications and variations will be apparent to those of ordinary skill in the art. The example embodiments were chosen and described in order to explain principles and practical application, and to enable others of ordinary skill in the art to understand the disclosure for various embodiments with various modifications as are suited to the particular use contemplated.","Although illustrated example embodiments have been described herein with reference to the accompanying drawings, it is to be understood that embodiments are not limited to those precise example embodiments, and that various other changes and modifications may be affected therein by one skilled in the art without departing from the scope or spirit of the disclosure."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE SEVERAL VIEWS OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIGS. 1-3"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
