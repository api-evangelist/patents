---
title: Fast channel change handling of late multicast join
abstract: In an internet protocol television (IPTV) system, fast channel change (FCC) transactions that experience late multicast joins are handled specially, thereby allowing the system to be provisioned for the vast majority of multicast joins that are within an expected range. During an FCC transaction, the subscriber interface device, such as a set-top box (STB), can determine how long it can wait to join the multicast stream of the new channel before a gap can be predicted to occur in the handover from the FCC unicast to the multicast. If the STB has not joined the multicast stream by the determined time, a recovery procedure is invoked in which the STB sends a RESTART request to the FCC server which, in turn, increases the rate of the FCC unicast as if the FCC transaction were restarted, thus allowing the handover to occur seamlessly. This solution reduces the demands of each FCC transaction, allowing for greater scalability and reduced cost.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08161515&OS=08161515&RS=08161515
owner: Alcatel Lucent
number: 08161515
owner_city: Paris
owner_country: FR
publication_date: 20090513
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF INVENTION","BACKGROUND","SUMMARY","DESCRIPTION OF EMBODIMENTS"],"p":["The present invention relates generally to internet protocol television (IPTV), and more particularly to fast channel change (FCC) methods and apparatus.","In a typical signal distribution system providing Internet protocol television (IPTV) over digital subscriber line (DSL) or fiber, a subscriber or user is provided with an interface device, such as a set-top box (STB) or receiver, for communicating with network equipment, which may comprise, for example, a DSL access multiplexer (DSLAM). The interface device is configured to receive and process for presentation on a television or the like, a content stream corresponding to a channel selected by the user.","In order to receive a given selected channel in an IPTV system, the subscriber interface device will typically join a multicast stream corresponding to the selected channel. This is problematic in that there can be a substantial delay, on the order of several seconds, between user entry of a channel change command and receipt of decodable multicast data for the new channel. Because decoding the video stream is typically a recursive process, i.e., decoding a frame relies on previously decoded frames, decoding must start at an \u201centry point,\u201d where no prior frames are needed. Therefore, once an STB joins the multicast of a new channel, it has to wait for the next entry point in the stream in order to begin decoding. The interval between such entry points, however, may be hundreds of milliseconds or even seconds. This is the major cause of delay in channel change. During this channel change delay period, the screen of the presentation device is usually blank or frozen, which can be particularly annoying to the viewer when channel surfing.","One approach used in IPTV to address the problem of channel change delay has been to deploy fast channel change (FCC) servers in the distribution system. An FCC server caches the last few seconds of the content stream for each channel. In response to a subscriber's entry of a channel change command, the subscriber's STB sends an FCC request to the FCC server. The FCC server sends in unicast to the STB a short stream of video from the new channel for immediate playback, starting at some entry point in the past (behind the current multicast packet). The FCC server sends the data to the STB at a data rate faster than the channel's data rate, in which case, after a few seconds, it \u201ccatches up\u201d with the multicast stream for that channel. The STB begins playing the new channel shortly after it receives the first unicast packet; hence the channel change appears to be fast. Once the FCC server \u201ccatches up\u201d with the multicast, it signals the STB to join the multicast stream for the new channel. The STB joins the multicast and continues to play from the multicast stream. A description of an exemplary implementation of this conventional approach can be found in U.S. Patent Application Publication No. 2005\/0081244, entitled \u201cFast Channel Change.\u201d","Generally, the subscriber's loop (between the STB and DSLAM) is of limited bandwidth. If the FCC server were to send the FCC unicast to the STB at the channel's data rate in parallel to the multicast, packet loss might occur. To prevent such an occurrence, shortly after signaling to the STB to join the multicast, the server drops the unicast rate to a fraction of the channel data rate. Therefore, during the time from receiving the \u201cjoin multicast\u201d signal until beginning to receive the multicast input, the STB receives data at a rate significantly lower than the rate at which it consumes data, with the balance obtained from a buffer which had been accumulated before, when the server unicast rate was higher than the channel data rate. In order to prevent the buffer in the STB from running out before decoding of the multicast stream begins, the server has to select the starting point at a sufficiently long delay.","A significant drawback of the conventional FCC approach, however, is that the amount of data per FCC transaction is very sensitive to the variability of the multicast join time, that is, the time from sending a join request until receiving the first multicast packet. This interval can be modeled as a random variable with a long-tailed distribution that can vary from a few milliseconds to several hundreds of milliseconds. As such, provisioning a conventional FCC system for all cases of multicast join time results in a major increase in FCC transaction duration, which for most cases is not needed, and makes it harder to scale-up the FCC system to handle greater numbers of FCC transactions.","Another approach to the channel change delay problem relies on a high bandwidth link to the subscriber. Generally, using more bandwidth alleviates the problem, but due to limitations in the distribution system, additional bandwidth may not be available or cost-effective.","Thus, there is an unsolved need to adequately reduce the duration and amount of data sent of the unicast streams sent by a FCC server when subscribers change channels for video distributed in an IP network environment.","The present invention in the illustrative embodiments provides improved techniques for fast channel change in an IPTV system or other type of signal distribution system.","In an illustrative embodiment of a fast channel change (FCC) procedure of the invention, after an FCC server has completed unicast transmission to a user interface device, such as a set-top box (STB), and the STB has requested to join the multicast stream for the new channel, the STB is configured to predict whether it will run out of packets at least some interval (e.g., several hundred milliseconds) before that actually happens. If the STB predicts that it will run out, it leaves the multicast and sends a message, referred to herein as a RESTART message, to the FCC server. In response to the RESTART message, the FCC server increases its output data rate to the unicast level, which is faster than the multicast rate. When the FCC server catches up with the multicast, it signals the STB to join the multicast for the new channel and the transaction continues as before.","Implementation of such an exemplary recovery procedure allows planning the FCC server for the vast majority of common cases rather than for the worst case. In the few cases where the multicast join time exceeds the designed-for join time, the recovery procedure will re-start the FCC transaction to prevent a gap in the handover from the FCC unicast to the multicast. Among other benefits, this solution allows a smaller initial delay between the FCC unicast and multicast streams, less data sent per FCC transaction, faster FCC transactions, and improved scalability, without requiring a higher bandwidth to the subscriber.","The aforementioned and other aspects, features and benefits of embodiments of the present invention will be apparent from the figures and description which follow.","In this description, it is assumed that the reader is familiar with the basic operating principles and architectures of digital distribution systems such as video-over-IP networks. The invention will be described herein in conjunction with illustrative embodiments of signal distribution systems and associated fast channel change (FCC) processing techniques. It should be understood, however, that the invention is not limited to use with the particular systems and techniques described, but is instead more generally applicable to any signal distribution system in which it is desirable to provide improved handling of FCC requests. For example, although described herein primarily in the context of IPTV systems, the techniques of the invention can also be adapted in a straightforward manner to other types of signal distribution systems, including, for example, cellular systems. Moreover, although described herein primarily in the context of video, the techniques of the invention can be applied to any type of streaming content, including, for example, audio, or audio and video.",{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 1","b":["100","100","110","110","110","110","110","110"]},"In network , multicast video streams containing encoded content are typically distributed from one or more content sources  which may comprise otherwise conventional service provider equipment, including, for example, headend systems, satellites, servers, etc. The network  comprises a combination of network elements such as routers and switches ,  and a plurality of nodes such as Digital Subscriber Line Access Multiplexer (DSLAM)  for distributing video streams to a plurality of subscriber interface devices, such as a set-top box (STB) . For the sake of simplicity, one path from one content source , one DSLAM  and one STB  are shown in . The thick arrows indicate downlink data flow, whereas thin arrows indicate uplink control messages, such as channel change requests.","For purposes of the illustrative embodiments, the subscriber interface device  will be assumed to be a set-top box (STB), but in other embodiments may comprise, for example, receivers, computers, cellular handheld terminals or other processor-based devices, in any combination. Such devices are also referred to herein as user interface devices or \u201cclients\u201d and may be implemented as a separate device, such as an STB, a satellite receiver (not shown), a modem (not shown) or other devices which are connected to a presentation device  such as a TV. The user interface device  may also be integrated with or part of a display device such as a TV, computer (not shown) or monitor (not shown) which has a screen for rendering and displaying content (audio and\/or video content). A given device of this type allows one or more users to access content streams that are delivered to the device via the signal distribution system. The STB  may have a conventional hardware implementation, including, for example, a processor coupled to a memory and a decoder  for converting received content streams to a form suitable for presentation by the device . The memory may include an electronic random access memory (RAM), a read-only memory (ROM) or other type of storage device, as well as portions or combinations of such devices. A portion of the memory may comprise an input buffer  for storing content streams received from the distribution network  and feeding the decoder , preferably at a constant bit rate. The processor and memory are used in storage and execution of one or more software programs for implementing interface device portions of the fast channel change processing techniques disclosed herein. The memory may be viewed as an example of what is also referred to herein as a computer-readable storage medium. The network  also includes at least one fast channel change (FCC) server  arranged at some intermediate point between the content source  and DSLAM . As described in greater detail below, the FCC server  provides a unicast video stream to the STB  via DSLAM . The FCC server  receives the multicast stream from the content source  and caches that for provision, when needed, as a unicast stream. In a typical system, a single FCC server  will engage in multiple FCC transactions with multiple STBs, often simultaneously. For clarity of description, FCC transactions between one FCC server and one STB are described herein.","In the schematic representation of , router  represents the last common router in the multicast route to the STB  and to the FCC server . Router  represents the first common router in the multicast route and the FCC unicast route to the STB . Routers  and  may be the same network element. Dashed or dotted arrows indicate that there may be intermediate network elements (routers, switches) in between which are not depicted in .","Although shown as a separate, stand-alone device, the FCC server  may be implemented on a common processing platform with one or more other servers of the system, or may be distributed across multiple such processing platforms. Also, although  shows only a single DSLAM , one pair of routers\/switches , , and a single FCC server , a given embodiment can of course include multiple such elements. The system  may further include additional elements of a type found in conventional implementations of such a system, such as switches, content servers, ad servers, etc.","While the embodiments herein are discussed and described with reference to DSLAMs, those skilled in the art will readily appreciate that the present invention may be adapted for use in conjunction with any type of edge node including servers, routers, switches, satellite transmitters, and other suitable nodes for distributing content from the edge of a network to an end-user. In this embodiment, the DSLAM  is a network element which presents an interface of the content distribution network  to the STB  and can be implemented conventionally.","The STB  is coupled to DSLAM  via a point-to-point, bidirectional connection  which may be a DSL, cable, fiber-optic or wireless link or any other suitable connection. Content streams from the network  are passed by the DSLAM  on to the STB . The STB  transmits control messages to the DSLAM  such as channel change request messages. Requests for channel changes from the STB  go to the DSLAM , which passes them on to the FCC server .","When the FCC server  receives a channel change request, it begins streaming the requested channel data to the STB  in unicast for a period of several seconds. Initially, this is the only data stream received by the STB  and thus the FCC server  can utilize the full bandwidth available to the STB. At some point, the FCC server  instructs the STB  to join the multicast stream for the new channel and sometimes afterwards the FCC server  terminates the unicast stream. Once the STB  begins receiving the multicast stream, or at some time before then, the bit rate of the unicast stream has to be dropped accordingly in order to avoid overloading the connection  and causing packet loss. This suggests two phases of unicast FCC streaming: a first phase using the full available bandwidth, and a later phase in which the unicast stream is sharing the bandwidth with the multicast stream. For further optimization we introduce an intermediate phase representing the minimum duration of the interval that elapses from the time the instruction to join the multicast stream is sent from the FCC server , until the multicast stream begins to arrive at the STB , during which the unicast data rate equals the channel data rate.",{"@attributes":{"id":"p-0029","num":"0028"},"figref":["FIG. 2","FIG. 2"],"b":["150","125","201","125","202","125","150","203","151","152","150","201","151","152","150","203","150","125"]},"As shown in , Phase  begins at time Twith the reception of the FCC request at the FCC server . Since processing delays at the FCC server  are assumed to be negligible, as soon as the FCC server  receives an FCC request, it begins unicast streaming the requested channel data to the STB . The packets sent by unicast are taken from the FCC server's cache beginning with the packet received by the server at time T. (It should be noted that the packet received by the server at time Tmust be an entry point.) The difference Dbetween Tand Tis the initial time gap between the incoming multicast packets and the outgoing unicast packets. The determination of this interval is discussed below in greater detail. The rate of the unicast streaming during Phase  is 1+E, where E is a burst factor (E>0). Sending data from the FCC server  at a rate higher than 1 is possible because the sending begins at a point which is a period Dbehind the multicast reception at the FCC server. Preferably, E is selected so that 1+E is the available bandwidth for streaming data to the STB . Because the FCC server output data rate 1+E is higher than the input rate 1, the gap between the incoming multicast packets and the outgoing unicast packets is decreasing during Phase . Typically, the duration of phase  may be several seconds.","When the time gap between the multicast stream arriving at the FCC server  and the unicast stream leaving the server becomes zero, i.e. when incoming packets are sent from the FCC server to the STB  essentially as soon as they are received by the FCC server, the FCC server  instructs the STB to join the multicast. The STB , in turn, sends an internet group management protocol (IGMP) join request to DSLAM  at time T. This marks the beginning of Phase . There is an interval Tfrom the sending of an IGMP join request by the STB  at time Tuntil the time at which the first multicast packet is received by the STB . The interval T, referred to as the multicast join time, is a random variable which changes from request to request. It has a minimum, T, but its distribution has a long tail and Tcan have a high maximum value. The significance of the multicast join time and its variability in an FCC transaction are discussed below in greater detail.","Phase  is the interval starting at time Tand lasting up to T. During Phase , the FCC server  does not have to share the bandwidth with the multicast, but it cannot send data at a rate faster than 1 because after catching up with the multicast, the server cannot send packets faster than the rate at which it receives them. Thus the FCC server  continues sending data to the STB  at rate 1 for a period no longer than T, which typically will not be more than several tens of milliseconds. In , the relative size of Tis exaggerated for clarity of illustration.","As shown in , upon expiration of the period T, the FCC server  reduces the rate of the unicast stream to the STB , even though the STB might not actually begin to receive the multicast stream until some later time, T+T. This reduction in the unicast rate at time T+Tmarks the beginning of Phase . Starting at time T+T, the STB  receives both the unicast stream from the FCC server  as well as the multicast stream. So that the total bit rate of the multicast stream and the unicast stream does not exceed the available bandwidth of 1+E, the FCC server  preferably drops the unicast rate to E during Phase . Note that the FCC server  does not know exactly when the STB  begins receiving the multicast stream until after the fact (if at all). Hence it preferably drops the rate at the earliest time at which the STB can begin receiving multicast, namely at T+T.","At each point in time in the graph of , the horizontal difference between the plot  and the line  is the time interval between the reception of a unicast packet at the STB  and the packet's provision to the STB decoder . At time T, plot  and line  meet and this time interval is substantially zero. As can be seen from :",{"@attributes":{"id":"p-0035","num":"0034"},"maths":{"@attributes":{"id":"MATH-US-00001","num":"00001"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msub":{"mi":"T","mn":"3"},"mo":"=","mrow":{"msub":[{"mi":"T","mn":"2"},{"mi":"T","mrow":{"mi":["J","min"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}}],"mo":["+","+"],"mrow":{"mfrac":{"msub":{"mi":["D","S"]},"mrow":{"mn":"1","mo":"-","mi":"E"}},"mo":"."}}}},{"mrow":{"mo":["(",")"],"mn":"1"}}]}}}},"br":{},"b":["150","152","212","202","203","125","3","3","125","150","125"],"sub":["3 ","3","3"]},"In order to avoid any gaps in the stream of data decoded by the STB , a seamless handover from the unicast to the multicast streams needs to occur. As will be seen, an important determinant as to whether a seamless handover will occur is the multicast join time, T. The conditions for a seamless handover will now be discussed.","Let Dand Bbe the duration and the amount of data sent in Phase , respectively. Since the data rate is normalized so that the multicast data rate is 1, Bis given in time units and represents the amount of data transmitted by the multicast in that length of time. Phase  begins with an initial time gap (between multicast arrival at and packet unicast from the FCC server ) of Dand ends when this time gap decreases to zero. Because during Phase  the FCC server  sends data at rate 1+E and receives data at rate 1, Dand Bcan be determined as follows:",{"@attributes":{"id":"p-0038","num":"0037"},"maths":{"@attributes":{"id":"MATH-US-00002","num":"00002"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":[{"mtd":[{"mrow":{"mrow":{"msub":{"mi":"D","mn":"1"},"mo":"=","mfrac":{"msub":{"mi":["D","S"]},"mi":"E"}},"mo":","}},{"mrow":{"mo":["(",")"],"mn":"2"}}]},{"mtd":[{"mrow":{"msub":{"mi":"B","mn":"1"},"mo":"=","mrow":{"mrow":[{"msub":{"mi":"D","mn":"1"},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mi":"E"}}},{"mfrac":{"mrow":{"msub":{"mi":["D","S"]},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mi":"E"}}},"mi":"E"},"mo":"."}],"mo":"="}}},{"mrow":{"mo":["(",")"],"mn":"3"}}]}]}}}},"At time T, the STB  begins to decode the unicast data corresponding to the multicast data at time T, and since the STB decodes the data at rate 1, it constantly decodes data which is Dbehind the multicast stream at any given point in time. (Note that in , line  is parallel to line , offset in time by the interval D.) Therefore, by time Twhen the unicast stream has caught up with the multicast stream and Phase  ends, the STB buffer  has accumulated an amount Dof data. The buffer  maintains this level during Phase , during which the input rate into the buffer equals the output rate to the decoder . During Phase , however, unicast data arrives at rate E but is decoded by the STB at rate 1. Therefore, assuming 0<E<1, the STB buffer  will be depleted at a time",{"@attributes":{"id":"p-0040","num":"0039"},"maths":{"@attributes":{"id":"MATH-US-00003","num":"00003"},"math":{"@attributes":{"overflow":"scroll"},"mfrac":{"msub":{"mi":["D","S"]},"mrow":{"mn":"1","mo":"-","mi":"E"}}}},"br":{},"b":["3","151","125"],"sub":"S "},{"@attributes":{"id":"p-0041","num":"0040"},"maths":{"@attributes":{"id":"MATH-US-00004","num":"00004"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"V","mo":"=","mrow":{"mrow":[{"mfrac":{"msub":{"mi":["D","S"]},"mrow":{"mn":"1","mo":"-","mi":"E"}},"mo":"-","msub":{"mi":["D","S"]}},{"msub":{"mi":["D","S"]},"mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mi":"E","mrow":{"mn":"1","mo":"-","mi":"E"}}}}],"mo":"="}}}},"br":{},"b":["3","150","3"],"sub":"J "},{"@attributes":{"id":"p-0042","num":"0041"},"maths":{"@attributes":{"id":"MATH-US-00005","num":"00005"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"msub":{"mi":["T","J"]},"mo":"\u2264","mrow":{"msub":{"mi":"T","mrow":{"mi":["J","min"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}},"mo":"+","mi":"V"}},{"msub":{"mi":"T","mrow":{"mi":["J","min"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}},"mo":"+","mrow":{"mrow":{"msub":{"mi":["D","S"]},"mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mi":"E","mrow":{"mn":"1","mo":"-","mi":"E"}}}},"mo":"."}}],"mo":"="}},{"mrow":{"mo":["(",")"],"mn":"4"}}]}}}}},"In this inequality, Tand E are network parameters that may not be readily alterable or may be beyond the control of the FCC system designer, in which case the only way to insure that no gap occurs would typically be by increasing Dso that the condition of Eq. 4 is satisfied even for the largest possible value of T. As seen from Eqs. 2 and 3, this would result in a proportionate increase in the duration of Phase  and the amount of data sent during this phase.","As mentioned above, the multicast join time Tis a random variable with a long-tailed distribution and can occasionally have a large maximum value. As such, it may be impossible or impractical to require a seamless handover from unicast to multicast for the largest possible value of T; i.e., for the condition of Eq. 4 to always be met. Doing so could make the duration of the unicast stream and the amount of data sent in unicast too large for large scale operation (i.e. running many FCC sessions in parallel).","In an exemplary system, a maximum value of Tfor which the handover can be expected to be seamless with a given, preferably high, probability is specified, designated herein as H. In other words, Dis selected so that if the join time Tdoes not exceed H, the handover from unicast to multicast will be seamless with the given probability. His preferably selected so that the probability of T>His small (e.g., less than 5%). If, however, the join time Tdoes exceed H, exemplary procedures implemented as described below, can handle such a case to provide a seamless handover. In an exemplary embodiment, Hhas a value of a few hundred milliseconds.",{"@attributes":{"id":"p-0046","num":"0045"},"figref":["FIG. 3","FIG. 2"],"b":["150","301","150","140","125","125","150","302","1","303","2"],"sub":["S ","2 "]},"Once the STB  has sent the multicast join request, there will be a time T+Jby which if the STB has not received the first multicast packet, it can predict that it will run out of data when the FCC unicast ends at time T. In other words, if the multicast join time Texceeds Jthere will be a gap in the stream provided to the STB decoder . As shown in , J=T+V and the \u201cprior warning\u201d time W is the length of the interval which begins at T+Jwhen it becomes clear that there is a problem, and ends at time T, when running out of data occurs. The warning time W is substantially independent of the data rates and is typically several hundred milliseconds long. Note that under the simplifying assumptions made above, W\u2248D. As shown in , the time T+Jcorresponds to the multicast arrival at the FCC server  of the last usable unicast packet (represented by point ) discussed above.","At , the STB  determines Jbased on the level of its buffer  at time T, designated B(T), and the burst rate E in accordance with the following expression:",{"@attributes":{"id":"p-0049","num":"0048"},"maths":{"@attributes":{"id":"MATH-US-00006","num":"00006"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msub":{"mi":["J","max"]},"mo":"=","mrow":{"msub":{"mi":"T","mrow":{"mi":["J","min"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}},"mo":"+","mrow":{"mrow":[{"mi":"B","mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":"T","mn":"2"}}},{"mrow":{"mo":["(",")"],"mfrac":{"mi":"E","mrow":{"mn":"1","mo":"-","mi":"E"}}},"mo":"."}],"mo":"\u2062"}}}},{"mrow":{"mo":["(",")"],"mn":"5"}}]}}}},"br":{},"b":["151","2","3"]},{"@attributes":{"id":"p-0050","num":"0049"},"maths":{"@attributes":{"id":"MATH-US-00007","num":"00007"},"math":{"@attributes":{"overflow":"scroll"},"mfrac":{"mrow":[{"mi":"B","mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":"T","mn":"2"}}},{"mn":"1","mo":"-","mi":"E"}]}}},"br":{},"b":"3"},"The parameters of Eq. 5 used by the STB  to calculate Jcan be obtained by a variety of suitable means. Because the STB buffer level at time Tcan be expected to be substantially constant through Phase , the buffer level may be determined, for example, as soon as the STB  receives the message from the FCC server  to join the multicast, later within Phase  or shortly after the beginning of Phase , ostensibly to obtain a more accurate level in case there is a change in the buffer level during Phase . (Note that by waiting until Phase , an updated estimate of the burst rate E can also be obtained and used in determining J.) The parameter Tcan be provisioned in the STB , or the STB can estimate it by tracking the interval from the time it receives the signal to join the multicast until the unicast data rate drops to well below 1. The burst rate E may be known to the STB via provisioning or estimated from either the incoming data rate or the rate of depletion of the buffer  after the time T+T, in Phase . Alternatively, any or all of the parameters D, T, E may be communicated by the FCC server. For example, these values may be included in the message from the FCC server signaling the STB to join the multicast.","At , as the STB  continues to receive the unicast stream from the FCC server , it waits to join the multicast; i.e., it awaits reception of the first multicast stream packet. At , while waiting to join the multicast, the STB  monitors the time that has elapsed since the join request was sent. If this time has not exceeded J, determined at , the STB continues to await the multicast stream as it continues to receive the FCC unicast stream. If the multicast stream begins before the elapsed time exceeds J, operation proceeds normally in Phase , as represented by . Phase  then ends at  as the unicast stream from the FCC server  ends.","If, however, it is determined at  that the elapsed time since the join request was sent has exceeded Jand reception of the multicast stream has not yet started, operation proceeds to . At this point, the STB  knows that it will run out of data by the time the FCC unicast ends and in response takes preemptive action to prevent such an occurrence. Such a scenario is depicted in . At , the STB leaves the multicast group by sending an IGMP \u201cleave\u201d message to the DSLAM  and preferably waiting for a short time (e.g. \u02dc100 msec) to verify that the multicast stream has been stopped; that is, that no multicast packets arrive after sending the IGMP \u201cleave\u201d message. Subsequently, at  the STB sends a RESTART message to the FCC server . With reference to , this occurs at or about time T+J[B(T)]. (For clarity of illustration,  does not show the aforementioned waiting time between leaving the multicast and sending the RESTART message). The RESTART message acts as an additional request to join the same channel. Upon receiving the RESTART message from the STB , the FCC server  will revert to a new \u201cPhase ,\u201d designated Phase in , but without backing off, it will simply increase the effective data rate to 1+E and keep unicast streaming data to the STB (, step ) from the point in which it is currently in the unicast stream.","The RESTART message and its implementation can be incorporated, for example, as an enhancement of a current or new FCC protocol or standard, or as part of a proprietary scheme.","Once the gap between the multicast and unicast is closed (again), the FCC server will instruct the STB to join the multicast, and continue following the same procedure as in the first attempt, with the hope that this time the first multicast packet will arrive sooner. As shown in , the STB sends a multicast join request at time T(, step ). This marks the beginning of a new \u201cPhase ,\u201d designated Phase in . As in Phase , during Phase the unicast rate drops to 1 until the interval Thas elapsed at time T+T.","As before, sometime during Phase or at the beginning of Phase , the STB  will determine (, ) a new value for Jbased on the level of its buffer  at time Tin accordance with Eq. 5. This new value is shown in  as J[B(T)]. Note that the time T+J[B(T)] corresponds to the multicast arrival at the FCC server of the last usable unicast packet, as represented by point . The STB  then waits, once again, for the multicast to start (, ). In the meantime, Phase comes to an end at time T+Tand a new \u201cPhase ,\u201d designated Phase begins. As in Phase , the unicast rate in Phase drops to E.","In the scenario depicted in , the STB  begins to receive the multicast stream before expiration of the time interval J[B(T)], at time T+T. As described above, the STB receives both the multicast and unicast streams (, ) in Phase until the unicast ends at time T().","Because very long multicast join times are not very common, the probability that the multicast join time will exceed the expected join time more than two, or at most three times consecutively is virtually negligible.","Implementing the exemplary recovery procedure allows the parameter Hto be set lower; i.e., it makes it possible to design the FCC system for a smaller variation in the multicast join time T. As discussed above, in order to have a seamless handover, the condition of Eq. 4 must be satisfied. Re-arranging the terms of Eq. 4:",{"@attributes":{"id":"p-0060","num":"0059"},"maths":{"@attributes":{"id":"MATH-US-00008","num":"00008"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msub":{"mi":["D","S"]},"mo":"\u2265","mrow":{"mrow":[{"mo":["(",")"],"mfrac":{"mrow":{"mn":"1","mo":"-","mi":"E"},"mi":"E"}},{"mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":["T","J"]},{"mi":"T","mrow":{"mi":["J","min"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}}}],"mo":"-"}},"mo":"."}],"mo":"\u2062"}}},{"mrow":{"mo":["(",")"],"mn":"6"}}]}}}},"br":{},"sub":["S ","J ","J","Jmin","S ","J ","S ","J ","J "]},{"@attributes":{"id":"p-0061","num":"0060"},"figref":"FIG. 5","sub":["max ","2a","max","2a"],"b":["304","305","306","202"]},"A desired goal of an embodiment of the invention is to reduce the average of the duration of Phase , D, and the average of the amount of unicast data transmitted, B, in Phase  of a FCC transaction. Optimizing the selection of the parameter H(the maximum allowable multicast join time for normal operation) in accordance with the actual distribution of the multicast join time helps achieve this goal. Selecting Htoo high will result in unnecessarily increasing Dand therefore also Dand B(per Eqs. 2 and 3), while selecting Htoo low will result in too many FCC transactions going through a recovery procedure, such as the restart procedure described above, and incurring the overhead associated with it. Because of the way that IGMP works, however, popular channels are likely to have a shorter multicast join time than less commonly watched channels. Furthermore, during periods of peak usage, the multicast join time is likely to be longer because IGMP join requests may be delayed longer in queues before being processed. Therefore, in accordance with an exemplary embodiment of the invention, His preferably adaptive to channel, time and\/or usage. In other words, the values of Hand thus Dare selected in accordance with the channel, time and\/or usage.","In an exemplary embodiment, the probability of a FCC transaction resorting to a restart procedure, as described above, is estimated at the FCC server at any given time t as P. The probability Pcan be estimated, for example, by considering time intervals of fixed duration (e.g. 10 seconds) and in each interval calculating the ratio between the number of FCC transactions using the restart procedure to the total number of FCC transactions in that interval. If the probability Pexceeds some pre-set target probability P(e.g., 5%) then H(and D) is increased and if P<Pthen H(and D) is decreased.","The above-described procedure should work well when the target probability Pwhich minimizes the average duration of or the average amount of data transmitted during a FCC transaction is known and when Pdoes not change over time. If this is not true, however, one can instead use a procedure such as described below in order to minimize the average duration of or the average amount of data transmitted during a FCC transaction.","Firstly, the server may estimate the distribution of the multicast join time directly. As mentioned above, a client typically reports to the FCC server when it receives the first multicast packet in each FCC transaction, which allows the server to determine the multicast join time for each FCC transaction. The FCC server can use these values to estimate the current distribution of the multicast join time for a particular channel, for example by generating a histogram of all multicast join times for a particular channel in a given interval of time (e.g., the last 60 seconds).","Using the estimated multicast join time distribution, the server can set Tto a value according to this distribution. For any value of D, the corresponding values of",{"@attributes":{"id":"p-0067","num":"0066"},"maths":{"@attributes":{"id":"MATH-US-00009","num":"00009"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"V","mo":"=","mrow":{"mrow":[{"mrow":{"msub":{"mi":["D","S"]},"mo":"\u2061","mrow":{"mo":["(",")"],"mfrac":{"mi":"E","mrow":{"mn":"1","mo":"-","mi":"E"}}}},"mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}},{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}],"mi":"and","msub":{"mi":["J","max"]}},{"msub":{"mi":["T","Jmin"]},"mo":"+","mi":"V"}],"mo":"="}}}},"br":{},"sub":["max ","d","S"]},"As shown in , during Phase , the unicast rate into the STB buffer  is E while the output rate to the decoder  is 1. If the client sends a RESTART message, it does so a time V after the start of Phase . When Phase  starts, the gap between the incoming unicast and multicast is zero; after Phase  starts, the unicast is received at rate E while the multicast proceeds at rate 1. Hence during time interval of V, the gap between the incoming unicast and the multicast is V(1\u2212E)=DE. This is the delay of the unicast relative to the multicast at the beginning of Phase and it corresponds to the initial delay Dat the beginning of Phase . Using the same reasoning used to derive Eqs. 2 and 3, but substituting DE for D, the duration and the amount of data transmitted during Phase , respectively, are given by:",{"@attributes":{"id":"p-0069","num":"0068"},"maths":{"@attributes":{"id":"MATH-US-00010","num":"00010"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":[{"mtd":[{"mrow":{"mrow":{"msub":{"mi":"D","mrow":{"mn":"1","mo":"\u2062","mi":"a"}},"mo":"=","mrow":{"mfrac":{"mrow":{"msub":{"mi":["D","S"]},"mo":"\u2062","mi":"E"},"mi":"E"},"mo":"=","msub":{"mi":["D","S"]}}},"mo":",","mi":"and"}},{"mrow":{"mo":["(",")"],"mn":"7"}}]},{"mtd":[{"mrow":{"msub":{"mi":"B","mrow":{"mn":"1","mo":"\u2062","mi":"a"}},"mo":"=","mrow":{"mfrac":{"mrow":{"msub":{"mi":["D","S"]},"mo":"\u2062","mrow":{"mi":"E","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"-","mi":"E"}}}},"mi":"E"},"mo":"=","mrow":{"mrow":{"msub":{"mi":["D","S"]},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mi":"E"}}},"mo":"."}}}},{"mrow":{"mo":["(",")"],"mn":"8"}}]}]}}}},"If more RESTART requests are necessary, the duration and the amount of data transmitted during the first phase after each RESTART request are also Dand B, respectively. For estimating the total duration and amount of data transmitted in unicast, initial Phases  and  and Phases and after each RESTART can be ignored because their durations are typically much shorter than those of Phases  and . (The durations of these phases are exaggerated in  for illustrative purposes). Moreover, because of the lower data rates in Phases , and , , the amount of data transmitted in these phases is even lower in comparison to Phases , . Based on these simplifying assumptions, the expected total duration Dand the expected total amount of data sent Bare given by:",{"@attributes":{"id":"p-0071","num":"0070"},"maths":{"@attributes":{"id":"MATH-US-00011","num":"00011"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":[{"mtd":[{"mrow":{"mrow":{"msub":{"mi":["D","exp"]},"mo":"=","mrow":{"mrow":[{"msub":{"mi":"D","mn":"1"},"mo":"+","mrow":{"msub":{"mi":"D","mrow":{"mn":"1","mo":"\u2062","mi":"a"}},"mo":"\u2062","mrow":{"munderover":{"mo":"\u2211","mrow":{"mi":"i","mo":"=","mn":"1"},"mi":"\u221e"},"mo":"\u2062","msubsup":{"mi":["P","d","i"]}}}},{"mrow":[{"msub":{"mi":"D","mn":"1"},"mo":"+","mrow":{"msub":{"mi":"D","mrow":{"mn":"1","mo":"\u2062","mi":"a"}},"mo":"\u2062","mfrac":{"msub":{"mi":["P","d"]},"mrow":{"mn":"1","mo":"-","msub":{"mi":["P","d"]}}}}},{"msub":{"mi":["D","S"]},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mfrac":[{"mn":"1","mi":"E"},{"msub":{"mi":["P","d"]},"mrow":{"mn":"1","mo":"-","msub":{"mi":["P","d"]}}}],"mo":"+"}}}],"mo":"="}],"mo":"="}},"mo":",","mi":"and"}},{"mrow":{"mo":["(",")"],"mn":"9"}}]},{"mtd":[{"mrow":{"msub":{"mi":["B","exp"]},"mo":"=","mrow":{"mrow":[{"msub":{"mi":"B","mn":"1"},"mo":"+","mrow":{"msub":{"mi":"B","mrow":{"mn":"1","mo":"\u2062","mi":"a"}},"mo":"\u2062","mrow":{"munderover":{"mo":"\u2211","mrow":{"mi":"i","mo":"=","mn":"1"},"mi":"\u221e"},"mo":"\u2062","msubsup":{"mi":["P","d","i"]}}}},{"mrow":[{"msub":{"mi":"B","mn":"1"},"mo":"+","mrow":{"msub":{"mi":"B","mrow":{"mn":"1","mo":"\u2062","mi":"a"}},"mo":"\u2062","mfrac":{"msub":{"mi":["P","d"]},"mrow":{"mn":"1","mo":"-","msub":{"mi":["P","d"]}}}}},{"mrow":[{"msub":{"mi":["D","S"]},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mi":"E"}}},{"mrow":{"mo":["(",")"],"mrow":{"mfrac":[{"mn":"1","mi":"E"},{"msub":{"mi":["P","d"]},"mrow":{"mn":"1","mo":"-","msub":{"mi":["P","d"]}}}],"mo":"+"}},"mo":"."}],"mo":"\u2062"}],"mo":"="}],"mo":"="}}},{"mrow":{"mo":["(",")"],"mn":"10"}}]}]}}},"br":{},"sub":["S","exp ","exp ","S","exp ","exp "]},"If in a particular embodiment a higher accuracy is needed or desired, it is possible to compute more accurate estimates for Dand Bwhich account for the contribution of all phases. In that case, Dand Bin Eqs. 9 and 10 would be replaced by the corresponding expressions for the total durations and unicast data amounts of Phases ,  and  and Dand Bwould be replaced by the corresponding expressions for the total durations and unicast data amounts of Phases , and ","It should be understood that the particular examples and the corresponding assumptions described above are not limitations of the present invention. For example, in other embodiments, the assumptions made above need not apply. Also, the particular phases, parameters and other characteristics of the FCC processing as described above may be varied in alternative embodiments. The present invention may be embodied in other specific apparatus and\/or methods. The described embodiments are to be considered in all respects as only illustrative and not restrictive. In particular, the scope of the invention is indicated by the appended claims rather than by the description and figures herein. All changes that come within the meaning and range of equivalency of the claims are to be embraced within their scope."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF FIGURES","p":["Some embodiments of apparatus and\/or methods in accordance with embodiments of the present invention are now described, by way of example only, and with reference to the accompanying figures in which:",{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":["FIG. 4","FIG. 3"]},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 5"}]},"DETDESC":[{},{}]}
