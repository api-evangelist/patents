---
title: Method and apparatus for isolating faults in a switching matrix
abstract: A signal router is described. The signal router includes a switching matrix, an error detector and a controller. The switching matrix includes a first number of inputs and a second number of outputs, and is configured to receive an information stream. The error detector is coupled to one of the second number of outputs, and is configured to generate error information by virtue of being configured to detect errors in the information stream. Likewise, the controller is coupled to the switching matrix and error detector. The controller is configured to select one of the first number of inputs, receive error information from the error detector, and configure the switching matrix to couple the selected input to one of the outputs.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=06856600&OS=06856600&RS=06856600
owner: Cisco Technology, Inc.
number: 06856600
owner_city: San Jose
owner_country: US
publication_date: 20000104
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCES TO RELATED APPLICATIONS","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE INVENTION"],"p":["This application is related to patent application Ser. No. 09\/232,397, filed Jan. 15, 1999, and entitled \u201cA METHOD FOR ROUTING INFORMATION OVER A NETWORK,\u201d having A. N. Saleh, H. M. Zadikian, Z. Baghdasarian and V. Parsi as inventors; patent application Ser. No. 09\/232,395, filed Jan. 15, 1999, now abandoned and entitled \u201cA CONFIGURABLE NETWORK ROUTER,\u201d having H. M. Zadikian, A. N. Saleh, J. C. Adler, Z. Baghdasarian, and V. Parsi as inventors; patent application Ser. No. 09\/232,396, filed Jan. 15, 1999 and entitled \u201cMETHOD OF ALLOCATING BANDWIDTH IN AN OPTICAL NETWORK,\u201d having H. M. Zadikian, A. Saleh, J. C. Adler, Z. Baghdasarian, and V. Parsi as inventors; patent application Ser. No. 06\/174,323, now U.S. Pat. No. 4,438,492, filed Jan. 4, 2000, and entitled \u201cA RESOURCE MANAGEMENT PROTOCOL FOR A CONFIGURABLE NETWORK ROUTER\u201d having H. M. Zadikian, A. Saleih, J. C. Adler, Z. Baghdasarian and Vahid Parsi as inventors; patent application Ser. No. 09\/477,166, filed herein Jan. 4, 2000, and entitled \u201cMETHOD AND APPARATUS FOR A REARRANGEABLY NON-BLOCKING SWITCHING MATRIX,\u201d having A. N. Saleh, D. Duschatko and L. B. Quibodeaux as inventors; patent application -Ser. No. 09\/389,302, filed Sep. 2, 1999, and entitled \u201cNETWORK ADDRESSING SCHEME FOR REDUCING PROTOCOL OVERHEAD IN AN OPTICAL NETWORK,\u201d having A. Saleh and S. E. Plote as inventors; patent application Ser. No. 09\/478,235, filed Jan. 4, 2000, and entitled \u201cA METHOD FOR PATH SELECTION IN A NETWORK,\u201d having A. Saleh as inventor; patent application Ser. No. 09\/477,498, filed Jan. 4, 2000, and entitled \u201cMETHOD OF PROVIDING NETWORK SERVICES,\u201d having H. M. Zadikian, S. E. Plote, J. C. Adler, D. P. Autry, and A. Salch as inventors. These related applications are hereby incorporated by reference, in their entirely and for all purposes.","1. Field of the Invention","This invention relates to the field of information networks, and more particularly relates to a router capable of routing information over a network.","2. Description of the Related Art","Today's networks carry vast amounts of information. High bandwidth applications supported by these networks include streaming video, streaming audio, and large aggregations of voice traffic. In the future, these demands are certain to increase. To meet such demands, an increasingly popular alternative is the use of lightwave communications carried over fiber optic cables. The use of lightwave communications provides several benefits, including high bandwidth, ease of installation, and capacity for future growth.","The synchronous optical network (SONET) protocol is among those protocols designed to employ an optical infrastructure and is widely employed in voice and data communications networks. SONET is a physical transmission vehicle capable of transmission speeds in the multi-gigabit range, and is defined by a set of electrical as well as optical standards. SONET networks have traditionally been protected from failures by using topologies that support fast restoration in the event of network failures. Their fast restoration time makes most failures transparent to the end-user, which is important in applications such as telephony and other voice communications. Existing schemes rely on techniques such as 1-plus-1 and 1-for-1 topologies that carry active traffic over two separate fibers (line switched) or signals (path switched), and use a protocol (Automatic Protection Switching or APS), or hardware (diverse protection) to detect, propagate, and restore failures.","In routing the large amounts of information between the nodes of an optical network, it is desirable to have a fast, efficient method for finding the most preferable path through that network. For example, in the case of voice communications, the failure of a link or node can disrupt a large number of voice circuits. The detection of such faults and the restoration of information flow must often occur very quickly to avoid noticeable interruption of such services. For most telephony implementations, for example, failures must be detected within about 10 ms and restoration must occur within about 50 ms. The short restoration time is critical in supporting applications, such as current telephone networks, that are sensitive to quality of service (QoS) because such detection and restoration times prevent old digital terminals and switches from generating alarms (e.g., initiating Carrier Group Alarms (CGAs)). Such alarms are undesirable because they usually result in dropped calls, causing users down time and aggravation. Restoration times exceeding 10 seconds can lead to timeouts at higher protocol layers, while those that exceed 1 minute can lead to disastrous results for the entire network.","In a SONET network, a failure of a given link results in a loss of signal (LOS) condition at the nodes connected by that link (per Belicore's recommendations in GR-253 (GR-253: (SONET) , Common Generic Criteria, Issue 2 [Bellcore, December 1995], included herein by reference, in its entirety and for all purposes)). The LOS condition propagated an Alarm Indication Signal (AIS) downstream, and Remote Defect Indication (RDI) upstream (if the path still exists), and an LOS defect locally. The defect is upgraded to a failure 2.5 seconds later, which causes an alarm to be sent to the Operations System (OS) (per GR-253). When using SONET, the handling of the LOS condition should follow Bellcore's recommendations in GR-253 (e.g., 3 ms following a failure, an LOS defect is detected and restoration should be initiated). This allows nodes to inter-operate, and co-exist, with other network equipment WE) in the same network. The arrival of the AIS at a node causes the node to send a similar alarm to its neighbor and for that node to send an AIS to its own neighbor, and so on. Under GR-253, each node is allowed only a certain amount of time in which to forward the AIS, and so quickly propagate the indication of a failure.","As can be seen, a network element in such environments must be able to quickly detect and address failures such as those discussed above. To enable the detection, and so correction, of such failures, it is desirable to provide the ability to monitor the operation of the network element, without detrimentally affecting the network element's operation. Also desirable is the ability to predict the occurrence of failures, so that corrective action may be taken in advance of any failures that might occur.","In one embodiment of the present invention, a signal router is described. The signal router includes a switching matrix, an error detector and a controller. The switching matrix includes a first number of inputs and a second number of outputs, and is configured to receive an information stream. The error detector is coupled to one of the second number of outputs, and is configured to generate error information by virtue of being configured to detect errors in the information stream. Likewise, the controller is coupled to the switching matrix and error detector. The controller is configured to select one of the first number of inputs, receive error information from the error detector, and configure the switching matrix to couple the selected input to one of the outputs.","In one aspect of this embodiment, the signal router includes number of error detectors. In this aspect, each of a number of switching matrices within the signal router is coupled to a corresponding error detector. If one of the switching matrixes experiences a failure, the failure is detected by a corresponding error detector. The switching matrix is configured to identify the failed switching matrix by virtue of error information generated by the corresponding error detector.","In another aspect of this embodiment, the information stream includes a number of frames. In this aspect, the error detector includes an error checker and a framing circuit. The error checker is coupled to the switching matrix and the controller, while the framing circuit is coupled to the switching matrix, the controller and the error checker. The error checker is configured to generate error check information, which is included in the error information. For example, each frame may contains an error check entry, and the error checker may generate error check information by analyzing one of the frames and comparing a result of said analyzing to an error check entry of another frame. The framing circuit is configured to detect a start-of-frame condition for each frame, indicate the start-of-frame condition to the error checker, detect an end-of-frame condition for each frame, indicate the end-of-frame condition to the error checker, and detect framing error. As with the error check information, the framing error is included in the error information.","In another embodiment of the present invention, an error detection method is disclosed. The error detection method includes sending a first command to a controller, generating error information and retrieving the error information. The controller is coupled to control a switching matrix and to an error detector. The command causes the controller to configure the switching matrix to couple one of a number of inputs to one of a number of outputs. The selected input is configured to receive an information stream, while the selected output is coupled to the error detector. The error information is generated by detecting errors, if any, in the information stream using the error detector. Once the errors have been detected and the error information generated, the error information is retrieved from the error detector using the controller.","In one aspect of this embodiment, the information stream includes a number of frames. In this aspect, the framing circuit is coupled to and provides framing information to an error checker of the error detector. The detection of errors includes generating framing errors and check errors in the appropriate circumstances. A framing error is generated if a farming circuit of the error detector detects an error in framing in the information stream. If no framing error is detected, a check error is generated for each erroneous frame that is processed by the error detector, an erroneous frame being a frame in which the error checker detects an error within the frame.","The foregoing is a summary and thus contains, by necessity, simplifications, generalizations and omissions of detail; consequently, those skilled in the art will appreciate that the summary is illustrative only and is not intended to be in any way limiting. Other aspects, inventive features, and advantages of the present invention, as defined solely by the claims, will become apparent in the non-limiting detailed description set forth below.","The use of the same reference symbols in different drawings indicates similar or identical items.","The following is intended to provide a detailed description of an example of the invention and should not be taken to be limiting of the invention itself. Rather, any number of variations may fall within the scope of the invention which is defined in the claims following the description.","In addition, the following detailed description has been divided into sections, subsections, and so on, in order to highlight the various subsystems of the invention described herein; however, those skilled in the art will appreciate that such sections are merely for illustrative focus, and that the invention herein disclosed typically draws its support from multiple sections. Consequently, it is to be understood that the division of the detailed description into separate sections is merely done as an aid to understanding and is in no way intended to be limiting.",{"@attributes":{"id":"P-00041","num":"00041"},"figref":["FIG. 1A","FIG. 1B"],"b":["100","100","110","120","130","120","100","150","160","170","180","190","195","1","195","1","100","190","191","192","195","1","195","1","194","1"]},"Among other benefits, router  solves three growth-related problems often encountered in today's information networks, and particularly in SONET networks:\n\n","Router  is a multi-rack, fully redundant router that, in one embodiment, supports at least 256, 1+1 I\/O ports, and provides 1-plus-1 protection by using multiple copies (e.g., two or more) of group and main matrices operating in 1+1 mode. Failures within one copy of a given matrix do not require a complete switchover to the backup copy. Only the affected paths through the matrix are switched to the backup copy. This greatly improves switching speed and minimizes the impact of such redundancy on other connections. Preferably, the group matrix is a 2:1 reduction stage that selects output signals from one of two line cards (also referred to herein as I\/O modules, due to their functionality) and connects the selected output signals to the main matrix, thus preventing non-working channels from consuming ports on the main matrix.","In one embodiment, there are at least three types of processors in a router . The lowest level, level-3, resides on the line card and is responsible for all real time aspects of the processing of the physical protocol (e.g., SONET). In a SONET implementation, every level-3 processor is responsible for a single optical signal (e.g., an OC-48 signal) and, via a protocol processor, performs all required SONET\/SDH section and line termination functions. The fast response time required from the level-3 processor makes a firmware implementation preferable. The firmware, which may be written in the \u201cC\u201d or \u201cC++\u201d programming languages, assembler, or other programming language, is preferably optimized for low latency and resource efficiency. Higher-level processing is implemented on a separate module, the shelf processor module, which is shared by several line cards.","The second level of processors, level-2, reside on a shelf and main matrix processor modules. The software on the shelf processor module is responsible for managing and controlling line cards. Only half the line cards supported are active at any one time in order to support 1+1 protection. A level-2 processor deals with tasks that require a reasonable response time (for example, on the order of milliseconds), but have no direct impact on the data path. In other words, missed events, such as hardware interrupts, do not result in bit errors. Some of the functions handled by the shelf processor include the periodic collection of maintenance data from the line cards, receiving and processing periodic keep-alive messages from those cards, shelf startup and configuration, proxy management, and other related functions.","The third processor level, level-1, resides on a system processor module and provides system-wide management and control services. In one embodiment, there are preferably two fully synchronous copies of the level-1 processor in the system, both of which are simultaneously active and, through a dedicated and redundant high-speed link, keep their run-time and stored databases fully synchronized. One of the two processors is designated the master and is responsible for all level-1 processing. An update message is sent to the second processor whenever a change is made to the database and before that change is effected. A periodic keep-alive mechanism allows either copy of the system controller to detect failures on the other copy.","Router  provides yet another type of processor, referred to herein as a route processor. Such a processor is dedicated to the path\/route discovery and restoration functions. The route processor is responsible for receiving failure indications from the line cards, calculating a new route for failed connections, and sending reconfiguration requests to all affected nodes, including its own.","Hardware Architecture","In one embodiment, router  is a multi-rack communications system capable of terminating at least 8192 signals and cross-connecting at least 4096 OC-48 signals. Such a router can be used, for example, as SONET\/SDH line terminating equipment (LTE) capable of terminating the Section and Line overheads of received OC-48 signals, and cross-connects those signals according to provisioned input-output mappings. Some of the terminated signals can optionally be protected using any of the common protection schemes (1+1, 1:1, and 1:N).","Overhead processing and generation is performed on the line card by a protocol processor. This protocol processor handles all aspects of the SONET protocol, including framing, insertion and extraction of embedded data channels, error checking, AIS detection, pointer processing, clock recovery, multiplexing\/duplexing, and similar duties.","Signal Path",{"@attributes":{"id":"P-00055","num":"00055"},"figref":["FIG. 2","FIG. 1A","FIG. 2"],"b":["200","100","100","210","1","212","1","214","210","1","212","1","210","1","220","1","1","1","220","1","220","1","1","212","1","216","1","214","218","130","212","1","216","1"]},"It will be noted that the variable identifier \u201cN\u201d is used in several instances in  (and subsequent use of other variables, such as \u201cm\u201d, \u201cx,\u201d \u201ck,\u201d and others) to more simply designate the final element (e.g., group matrix (N), line card (N,N), and so on) of a series of related or similar elements (e.g., group matrices ()-(N), line cards (,)-(N,N), and so on). The repeated use of such variable identifiers is not meant to imply a correlation between the sizes of such series of elements. The use of such variable identifiers does not require that each series of elements has the same number of elements as another series delimited by the same variable identifier. Rather, in each instance of use, the variable identified by \u201cN\u201d (or \u201cm,\u201d \u201cx,\u201d \u201ck,\u201d and others) may hold the same or a different value than other instances of the same variable identifier. For example, group matrix (N) may be the tenth group matrix in a series of group matrices, whereas line card (N,N) may be the forty-eighth line card in a series of line cards.","Using signal paths  as an example, data enters the system at one of line cards (,)-(N,N). It is at this point, in a SONET-based system, that the Section and Line overheads are processed and stripped off by a protocol processor (not shown). The extracted SONET\/SDH payload envelope is then synchronized with the system clock and sent to two different copies of a local matrix, depicted as group matrices ()-(N) and ()-(N) in FIG. A. In one embodiment, group matrices ()(N) and ()-(N) are used mainly as 2:1 reduction stages that select one of two optical signals and pass the selected optical signal to switching matrix . This allows the implementation of a variety of protection schemes (including 1:N, or 0:1) without having to use any additional ports on main matrix . All protect signals are terminated at group matrices ()-(N) and ()-(N). In order to maximize bandwidth, it is preferable that only active signals be passed through to switching matrix .","In one embodiment, switching matrix  is an errorless, rearrangeably non-blocking switching network. In one embodiment, switching matrix  is a \u00d7 switching network that consists of three columns and 16 rows of 16\u00d717 switching elements that allow any of their inputs to be connected to any of their outputs, with the 17th output provided to permit fault detection within switching matrix . A single copy of the matrix may be housed, for example, in a single rack that contains three shelves, one for each column (or stage) of the matrix. Each one of such shelves contains cards housing the 16 switching elements in each stage. The switching element itself includes, for example, a 16\u00d717 crosspoint switch, with optical transceivers, and a microcontroller for controlling the crosspoint switch and providing operational feedback to the level-2 processor. Communications between the two processors may be carried, for example, over an Ethernet connection. The level-2 processor in turn communicates with the level-1 and route processors.","The switching elements in each matrix copy of the exemplary embodiment may be connected using fiber-optic cables, for example. While copper cabling may also be employed, such an option may not offer the speed and number of connections provided by an optical arrangement. After passing through the stages of switching matrix , an optical signal may be routed to an I\/O shelf that (optionally) splits the optical signal into two signals. One of the signals is sent to an active line card, while the other, when available, is sent to a backup card.","Line cards (,)-(N,N) receive optical signals from group matrices ()-(N) and  ()-(N) which are in turn connected to two separate copies of the main matrix. Line cards (,)-(N) monitor both signals for errors and, after a user-defined integration period, switch to the backup signal if that signal exhibits better bit error rate (BER) performance than the prior active signal. This scheme, referred to herein as 1-plus-1, allows line cards (,)-(N,N) to select between the two copies of the group matrix without any level-1 or level-2 CPU intervention. This helps to ensure that such a switch can be made in 50 ms or less (per Belicore's recommendations in GR-253 (GR-253(SONET) , Common Generic Criteria, Issue 2 [Bellcore, December 1995], included herein by reference, in its entirety and for all purposes)). The selected signal is then processed by the transmit section of the protocol processor, which inserts all required transport overhead bytes into the outgoing stream.","Regarding the signals described herein, both above and subsequently, those skilled in the art will recognize that a signal may be directly transmitted from a first logic block to a second logic block, or a signal may be modified (e.g., amplified, attenuated, delayed, latched, buffered, inverted, filtered or otherwise converted, etc.) between the logic blocks. Although the signals of the embodiments described herein are characterized as transmitted from one block to the next, other embodiments may include modified signals in place of such directly transmitted signals with the informational and\/or functional aspect of the signal being transmitted between blocks. To some extent, a signal input at a second logic block may be conceptualized as a second signal derived from a first signal output from a first logic block due to physical limitations of the circuitry involved (e.g., there will inevitably be some attenuation and delay). Therefore, as used herein, a second signal derived from a first signal includes the first signal or any modifications to the first signal, whether due to circuit limitations or due to passage through other circuit elements which do not substantively change the informational and\/or final functional aspect of the first signal.","Control Path",{"@attributes":{"id":"P-00063","num":"00063"},"figref":"FIG. 3","b":["300","100","300","2"]},"Groups","At the bottom of the hierarchy is what is referred to herein as a group matrix, or a Group Ethernet Repeater in a system using Ethernet communications, and depicted in  as group matrices ()-(N) and ()-(N). Each one of group matrices ()-(N) and ()-(N), also referred to herein as a hub, a repeater, or concentrator, is a physical layer device and preferably supports a star network topology, such as the IEEE 802.3 10 BASE-T networking standard. The redundant connections from line cards (,)-(N,N) in each of groups ()-(N) are connected to two repeaters that reside on two separate copies of the group matrix module. Preferably, each one of line cards (,)-(N,N) supports two network ports (e.g., 10 BASE-T Ethernet ports). The two sets of four signals from each port pass through a relay that selects one of them for connection to the LAN for purposes of redundancy. Groups ()-(N) represent the first layer of the control bus hierarchy. Group matrices ()-(N) and ()-(N) are each controlled by a shelf processor (not shown, for the sake of clarity) and communicate with one of the shelf switches described below via LAN connections.","Shelf Ethernet Switch",{"@attributes":{"id":"P-00067","num":"00067"},"figref":"FIG. 3","b":["100","320","1","321","1","310","1","310","1","310","1","220","1","1","212","1","216","1","220","1","1","212","1","216","1","220","1","1","212","1","216","1","212","1","216","1","320","1","321","1","2","320","1","321","1"]},"Shelf switches ()-(N) and ()-(N) are the next higher level of the control hierarchy in router , and are located on the shelf processor module (exemplified by line racks (()-N)). Each copy of shelf switches ()-(N) and ()-(N) interconnects six connections from the three groups in each shelf, another connection from the shelf processor, and one connection from system switch  (and ). Shelf switches ()-(N) and ()-(N) can be implemented, for example, using an 8-port Ethernet configured to handle 10 Mbps Ethernet traffic and a single port, dual-rate switch (e.g., 10 Mbps\/100 Mbps Ethernet).","System Switch","The next level of the hierarchy is the system switch, of which there are two copies in each router. These are shown as system switches  and  in FIG. . This fully redundant scheme prevents failures on one switch from taking down the entire control bus. In one embodiment, a system switch manages connections from the following sources:\n\n","It will be noted that main matrix  includes matrix cards (,)-(,N), and that, more generally, main matrices  and  are included matrix racks ()-(N)","System switches  and  are located in a management bay. As noted, the fully redundant switches manage connections from various router elements, such as I\/O and matrix bays, level-1 processors, and route processors. Each of level-1 processors  and  and route processors  and  is preferably connected to system switches  and  using 100 Mbps Ethernet connections in a configuration that creates an expandable, efficient, and fully redundant control bus.","Physical Configurations and Modules","I\/O Bay","An I\/O bay can support, for example, a total of 16 slots. Slots may be logically divided into functional groups. In such an embodiment, four such functional groups are defined with three of the groups occupying five slots each. In that embodiment, the other group, which occupies a single slot can be configured to house the shelf processor. Thus, the I\/O bay can contain line cards and group matrices which are controlled by shelf processors. These elements are exemplary of line cards (,)-(N-N), group matrices ()-(N) and  ()(N), shelf processors  ()-(N) and  ()-(N), and shelf switches ()-(N). It will be noted that the various line cards, group matrices, and shelf processors correspond to similar elements from previous figures.","Groups","A group is made up of line cards occupying a number of slots on a shelf. In one implementation, the group is 20 line cards that occupy five slots. Four of the slots hold, for example, 16 line cards at 4 per slot, with the last slot holding the group matrix. The same slot can be used with a wide variety of line cards and in various configurations. This architecture provides flexibility to allow any combination of line cards to be installed in each slot.","The fifth slot in the aforementioned embodiment can be configured to accept a group matrix. Preferably, two group matrix cards are employed, each containing a 2:1 optical reduction stage that \u201cselects\u201d working channels before the signals leave the shelf. In a 1+1 protection scheme, the two inputs to the line cards are classified as active and protect channels. The working channel is one of the active and protect channels that is selected based on bit error rate or other criteria, and so implements a redundancy scheme. This prevents the standby line cards from using any bandwidth on switching matrix .","Backplane","The following describes one embodiment of a backplane and some of the interface signals on that backplane. The backplane in the I\/O bay shelf carries a variety of signals between line cards and other modules in the shelf. Each I\/O shelf module is configured to allow an automatic, errorless switch from one power bus to the other.","Shelf processor module backplane signals include reset signals, clock signals, hardware detect signals (e.g., card detect, copy present, and the like), slot ID signals, and slot communication signals (both low and high speed). Line card backplane signals include reset signals, clock signals, communication signals, hardware detect signals, and slot ID signals. Group matrix module backplane signals include reset, clock signals, communication signals (both low and high speed), detection and hardware detect signals, and slot ID signals.","System Modules","Line Card",{"@attributes":{"id":"P-00087","num":"00087"},"figref":["FIG. 4","FIG. 4"],"b":["220","1","1","400"]},"Line card  receives optical signals from other network elements via a line-side optical receiver  and from the local router's system via a system-side optical receiver . Each of these receivers implements an optical-to-electrical (O\/E) conversion function. Line card  transmits optical signals to other network elements using a line-side optical transmitter  and to the group matrices using a system-side optical transmitter . Each of these transmitters implements an electrical-to-optical (E\/O) conversion function. It will be noted that line-side refers to the side of the line card coupled to other network elements and system-side refers to the side of the line card coupled to the group matrices.","Line-side optical receiver  is coupled to a protocol processor  which performs clock recovery multiplexing, demultiplexing, and SONET STEILTE processing in both directions. Similarly, system-side optical receiver  is also coupled to protocol processor  to allow protocol processor  to receive optical signals. The processed electrical signals from protocol processor  are coupled to the transmitters  and . The clock recovery functions are combined with demultiplexers and multiplexers to support reception and transmission of the optical data, respectively. The multiplexers serialize output data generated in protocol processor  by performing parallel-to-serial conversion on the parallel data. In contrast, de-multiplexers are used in protocol processor  to perform serial-to-parallel conversion on received data.","In order to add protection channels, line-side optical transmitter  is also coupled to a 1:2 broadcast unit . To receive such optical signals, optical receiver  is also coupled to a : selector  in order to select the working channel before the optical signals leave the shelf and thus prevent the standby channel (also referred to herein as the protect channel) from using any bandwidth on switching matrix .","Protocol processor  is coupled to a bus . Protocol processor  interfaces the line card to two copies of the matrix in a 1+1 physical protocol. In a SONET implementation, protocol processor  provides both STE\/LTE processing according to published industry standards. Also coupled to bus  are a memory  and a CPU . Memory  should be fast enough for efficient operation of CPU .","CPU  communicates with other of line cards (,)-(N,N) over a control bus (not shown) using a transceiver  that is coupled to CPU . Transceiver , is coupled to a transformer  which is coupled to a switch . Switch  is coupled to the control bus. Switch  implements a 1:1 protection scheme for transceiver  and couples CPU  to two independent ports on the backplane (not shown). Each of the two ports connects to one copy of the hub of the group matrix. This allows the software on the line card to switch to the backup link when the software detects failures on the active link.","Preferably, CPU  includes numerous integrated peripherals including embedded SCC channels (e.g. in-band communications) and an Ethernet controller (for example, to support communications with other system modules). In one embodiment, CPU  provides an onboard communications processor module (not shown) that handles time-critical aspects of the protocols supported.","Group Matrix Module","The group matrix module includes two independent blocks: a group matrix and a hub (also referred to herein as a repeater).","Group matrix","FIG. . illustrates an exemplary group matrix , which is exemplary of group matrices ()-(N) and group matrices ()-(N). In the embodiment shown in , group matrix  includes a series of 2:1 path selectors (exemplified by selectors ()-(N)), broadcast units ()-(N), and a microcontroller  controlling these. Selectors ()-(N) select one of two full-duplex optical signals and couple the selected signal to switching matrix . Selectors ()-(N) and broadcast units ()-(N) are grouped into pairs to form I\/O channels ()-(N). Microcontroller  communicates with other elements of router  via redundant transceivers (exemplified by transceivers  and ). For example, microcontroller  can control selectors ()-(N) and broadcast units ()(N) through commands received from the group processor.","Hub","One or more hubs are also provided to support communication between the group matrices and system switches in router . In an Ethernet communications environment, the hub's functions are carried out primarily by repeater interface controllers (RICs). Each RIC integrates the functions of a repeater, clock and data recovery unit (CDR), Manchester encoder\/decoder, and transceiver. Each RIC has a set of registers that convey status information and allow a number of configuration options to be specified by the user using, for example, a microcontroller.","Shelf Processor Module","The shelf processor module provides, among other elements, a shelf processor and switch that interconnect the LAN segments from the groups and the shelf processor to a port on the shelf switch (Ethernet switch ).","Shelf Processor",{"@attributes":{"id":"P-00103","num":"00103"},"figref":"FIG. 6","b":["600","605","600","605","607","610","607","605","607","600","611","612","605"]},"Shelf CPU  is also connected to a timer , which preferably contains the following three functional blocks:\n\n","Ethernet switch  is coupled to a transceiver  which, via a select , allows Ethernet switch  to connect to two separate Ethernet segments. Select  implements a 1:1 protection scheme that allows shelf processor  to recover from failures on the active segment by simply switching to the other segment. Ethernet switch  is also coupled to one or more group transceivers (exemplified by group transceivers , , , and ). Group transceivers , , , and  connect ports on Ethernet switch  to the groups.","System Switch","One embodiment of a system capable of interconnecting network segments in a switched configuration allows communications between shelf switches, higher-level (e.g., level-1) processors, and shelf-processors. In an Ethernet-based system, the system switch supports both 10 Mbps and 100 Mbps connections. The segments come from the shelf switching in the I\/O shelf and the matrix switches, among others, and allow these elements to communicate.","Main Matrix Bay","Switching in router  is based on a rearrangeably non-blocking network. A switching matrix, as described herein consists of switch nodes arranged in a staged array. For a 256\u00d7256 switching matrix, for example, switching matrix  consists of 48 nodes arranged in an array of 16 rows by 3 columns, with each column containing one stage of the switch matrix. All 48 nodes in the switch matrix are substantially similar and consist of a crossbar device that allows any of its inputs to be connected to any of its outputs, regardless of the current state of the crossbar.","Main Matrix",{"@attributes":{"id":"P-00115","num":"00115"},"figref":["FIG. 7","FIG. 7","FIG. 7"],"b":["130","130","256","256","700","1","1","16","3","700","1","1","16","3","720","1","256","720","1","256","730","1","256","700","1","1","16","3"]},"Physically, each of the 48 switching nodes of this embodiment occupies a single slot in a matrix rack, such as that described below. The rack described below is arranged with three shelves (one per matrix column) that house the switch node cards (there are 16 such cards in every shelf) and six-shelf-processor cards (two per shelf).","Matrix Rack","A rack is used to hold one or more matrices, and is referred to herein as a matrix rack. In one embodiment, a matrix rack is configured to hold 48 switching nodes (i.e., switching nodes (,)-(,)) in a compact physical configuration. The matrix rack thus can support, for example, switching nodes (,)-(,), which each provide 16 input signals and 17 output signals, and thus provides switching matrix  with 256 input signals and 256 output signals, along with a fault detection output for each node to allow the detection of faults within the respective node. Matrix shelf processors are configured in redundant pairs to provide fault-tolerant control of switch nodes (,)-(,).","The cross-connect information, i.e. input-to-output mapping, is written into the crosspoint switch by a local microcontroller which receives such information from the local shelf processor over a high-speed connection. The three shelf processors in each rack receive such information from the node controller, which resides in a different rack. This hierarchy can be extended indefinitely. The crosspoint switch receives a high speed serial data from the optical receivers that perform optical-to-electrical conversion on the received optical signals. Data from the crosspoint switch is retimed to synchronize the data with the system clock of router , using a clock and data recovery (CDR) unit, before being converted back into an optical signal that connects to the next stage of the matrix over fiber-optic cables.","Switch Node Module",{"@attributes":{"id":"P-00121","num":"00121"},"figref":"FIG. 8","b":["700","1","1","16","3","800","800","0","810","840","800","840"]},"The block diagram of switch node  in  illustrates the main elements of a switch node using a SONET-based implementation. The core of switch node  is crosspoint switch . Crosspoint switch  is preferably a 2.5 Gbps 16\u00d717 differential crosspoint switch with full broadcast capability, when implementing a 256\u00d7256 matrix that supports fault isolation according to an embodiment of the present invention. Any of its input signals can be connected to any, or all, of its output signals, including the node's fault isolation outputs. The device can be configured, for example, via a low-speed port through a two-step\/two-stage process. This process allows changes to be made to switch configuration without disturbing its operation.","Assuming 16 input signals (indicated in  as inputs ()-()), crosspoint switch  is configured to receive optical input signals from optical receivers ()-() at switch input signals ()-(). Crosspoint switch  also provides switch outputs ()-(), of which switch outputs ()-() serve as the source output signals for switch node , while switch output () is used in the detection of errors. Switch output () is fed into a CDR\/DEMUX , in which the clock is recovered and the input signal demultiplexed from a serial stream into a parallel stream. The CDR is used to re-time the serial data after the data has passed through the crosspoint switch. This helps eliminate most of the accumulated noise and jitter, and ensure that the eye opening is wide enough to carry the signal from one stage of the matrix to the next. CDR\/DEMUX  performs two functions: first, using a stable reference clock, CDR\/DEMUX  recovers the clock signal from the incoming data stream, then CDR\/DEMUX  uses the recovered clock to convert the serial stream into parallel data. CDR\/DEMUX  can also supply a 155 MHz word clock that can be used by an external physical layer processor to sample data from the device. In some embodiments, the clock and data recovery unit may include a phase-locked loop.","The parallel data is fed into a framer\/error detector . In one embodiment, framer\/error detector  is a physical layer device that performs framing and parity computations on an STS-48 signal. Parity errors detected by framer\/error detector  are counted and then in turn reported to the matrix shelf processor (not shown, but shown as shelf CPU  in FIG. ). Framer\/error detector  is controlled by microcontroller , which can also perform bit-error tests on incoming STS-48 signals when instructed to do so by the shelf processor. Parity errors detected by framer\/error detector  are counted and in turn reported to the matrix shelf processor. Microcontroller  is also responsible for detecting and reporting loss-of-signal (LOS) and out-of-lock (OOL) conditions from the optical receivers, CDRs, and framer\/error detector , respectively. Microcontroller  communicates with the shelf processor via transceivers  and  over a bus that carries asynchronous data over the backplane (not shown). Incoming signals (which may be simultaneously analyzed for errors by being routed to switch output ()) are routed to one of switch outputs ()-(). Switch outputs ()-() are coupled to CDRs ()-(), which in turn drive optical transmitters ()-(,). The outputs from optical transmitters ()() appear at outputs ()-() as optical signals.",{"@attributes":{"id":"P-00125","num":"00125"},"figref":["FIG. 9","FIG. 8","FIG. 9","FIG. 9"],"b":["800","830","830","900","910","920","930","940","900","910","825","810","822","17","900","910","840","900","910","920","9","840","900","910","900","910","900","900"]},"Framing circuitry , in an environment in which the data stream being tested is divided into frames (e.g., SONET), provides error information that includes loss-of-frame error, out-of-frame error, and lost-of-signal error information. Additionally, framing circuitry  provides framing information to error checker , allowing error checker  to synchronize itself with the incoming data stream. Information provided to error checker  by framing circuitry  can included, for example, indication of a start-of-frame condition, an end-of-frame condition, and one or more of the previously-described framing errors. Indications of the occurrence of an error from error checker  and framing circuitry  are provided to error counter , which is accessible by microcontroller . Also shown in , error limit register  is coupled to comparator , as is error counter . With the addition of these elements, framer\/error detector  is capable of generating a signal (e.g., an interrupt signal) to microcontroller . This might be used, for example, to allow microcontroller  to measure the amount of time required for a given number of errors to occur.",{"@attributes":{"id":"P-00127","num":"00127"},"figref":["FIGS. 10 and 11","FIG. 10"],"b":["9","9","9","900","910","1000","840","920","1005","920","920","920","810","822","17","1010","840","1015","840","920","1020","840","1030","920","900","910","1040","920","1050","840","920","840","1020","1030","920","1060","840","1070","810","1080","840","810","810","1090","840","920","920","920"]},{"@attributes":{"id":"P-00128","num":"00128"},"figref":"FIG. 11","b":["9","900","910","1100","920","1110","930","1120","810","840","810","1125","1130","920","900","910","1140","930","940","920","930","840","900","910","1145","1150","920","930","940","840","1140","840"]},"Once the error limit has been reached, the error timer is stopped, if one was started for this process (step ). Next, error information is calculated based on the error limit programmed into error limit register  and, optionally, on timer information (e.g., the initial time increment loaded into the timer for a countdown timer) (step ). If the error information so calculated indicates that reconfiguration of crosspoint switch  is required (step ), crosspoint switch  is reconfigured to address the failure indicated by the error information (step ). Alternatively, as noted, actions taken might also include alerting a system administrator, or requiring user intervention in the form of manual routing or replacement of circuit elements.",{"@attributes":{"id":"P-00130","num":"00130"},"figref":["FIG. 12","FIG. 9","FIGS. 9 and 12"],"b":["830","900","910","1200","840","840","1200","900","920","900","920","900","840","910"]},{"@attributes":{"id":"P-00131","num":"00131"},"figref":["FIG. 13","FIG. 13"],"b":["900","1300","910","1310","1200","1330","810","1330","1200","1340","1350","840","1200","1200","840","1200","1360","840","810","1370","840","810","1380","840"]},{"@attributes":{"id":"P-00132","num":"00132"},"figref":["FIG. 14","FIG. 14"],"b":["840","900","910","1400","1410","840","900","910","1420","1420","1440","1200","840","840","1450","840","900","910","1460","1465","1450","840","1470","810","1480","810","840","1490"]},"It will be apparent to one skilled in the art that the various apparati and methods just described can be applied to the nodes making up a matrix (e.g., crosspoint switch ) or an entire matrix (e.g., switching matrix ) (or only portions thereof). Thus, in the latter case, one or more paths through switching matrix  can be tested on an end-to-end basis. This would be the case, for example, if a specific input data stream (and so that data stream's path through switching matrix ) were to be tested. Alternatively, in the former case, switching nodes are tested separately. In a switching matrix employing multiple switching nodes, this allows failures to be localized within the switching matrix. This can be accomplished, for example, by sending a command to some or all of the switching node's microcontrollers (or microprocessors, as the case may be) to test one or more of their outputs.","Testing can also be performed in an ongoing manner. For example, one or more of the microprocessors can be programmed to continuously cycle through testing each one of the corresponding switching node's data paths. This can be used to support fault-tolerance techniques. Errors detected during this testing can be used to trigger several actions, including the reconfiguration of the switching matrix to reroute data streams around failed nodes (or to avoid a problematic path through a switching node), the manual re-routing of data streams, alarms, administrator intervention (e.g., the physical replacement of failed components), and the like.","Matrix Shelf Processor Module","The matrix shelf processor module provides local control and management for one of the main-matrix shelves. The matrix shelf processor communicates with the level-1 and route processors over a low speed network connection and with the matrix node cards over a multidrop, low-speed bus.",{"@attributes":{"id":"P-00137","num":"00137"},"figref":"FIG. 15","b":["1500","600","6","1500","130","1","1500","1510","1510","1520","1510","340","341","1540","1510","1570","1560","1510"]},"Management Bay","The management bay can house, for example, the following modules:\n\n","All of the above modules are fully redundant and communicate with the rest of router  over redundant control buses. The placement of individual modules within the rack is not addressed in this document, since there are no architectural preferences, or restrictions, on such choices.","Level-1 Processor\/System Controller",{"@attributes":{"id":"P-00147","num":"00147"},"figref":"FIG. 16","b":["1600","1600","1610","340","341","1610","1620","1610","1630","1630","1640","1650","1660","1660","1660","1640","1610","1650"]},"APB  may also be connected to a dual-channel serial communication controller (SCC), which is used to communicate with one or more remote Operations Systems (OS) using, for example, the X.25 protocol. For more OS links and higher link speeds, the user can optionally install one or more WAN Interface Modules in the management bay. Such modules, which preferably handle all real-time aspects of the OS link, including layer- of the OSI stack, communicate with the level-1 processor.","Route Processor Module",{"@attributes":{"id":"P-00150","num":"00150"},"figref":["FIG. 17","FIG. 17"],"b":["1700","1700","1700","1700","1700","1700","1710","1730","1740","1710","100","1750","1750","1151","1752","1753","1754","1754","100"]},"System Switch",{"@attributes":{"id":"P-00152","num":"00152"},"figref":"FIG. 18","b":["1800","1800","1800","1800","1810","1810","1820","1","1830","1840","1","1840","1","1850","1","1810","1860","1800"]},"Software Architecture","In one embodiment, router  implements many functions in software to provide flexibility, support for communications protocols, and ease of implementation. The software architecture presented here forms a distributed management, control, and routing layer capable of spanning hundreds or thousands of nodes. The software architecture covers all protocol layers, management and control applications, and inter-node communication protocols and APIs.","The software modules described herein may be received by the various hardware modules of router , for example, from one or more computer readable media. The computer readable media may be permanently, removably or remotely coupled to the given hardware module. The computer readable media may non-exclusively include, for example, any number of the following: magnetic storage media including disk and tape storage media; optical storage media such as compact disk media (e.g., CD-ROM, CD-R, etc.) and digital video disk storage media; nonvolatile memory storage memory including semiconductor-based memory units such as FLASH memory, EEPROM, EPROM, ROM or application specific integrated circuits; volatile storage media including registers, buffers or caches, main memory, RAM, etc.; and data transmission media including computer network, point-to-point telecommunication, and carrier wave transmission media. In a UNIX-based embodiment, the software modules may be embodied in a file which may be a device, a terminal, a local or remote file, a socket, a network connection, a signal, or other expedient of communication or state change. Other new and various types of computer-readable media may be used to store and\/or transmit the software modules discussed herein.","Overall Architecture","The software running the various processors of router  normally includes three major components: operating system, inter-processor and inter-node communications, and management and control applications. The operating system should provide standard facilities for supporting program operation, communications, and system management tasks.","An important aspect of any software architecture is its underlying inter-process communications (IPC) mechanism. IPCs that provide for the isolation of tasks are preferable. Such IPCs use message passing as their preferred communication. Message passing allows for full, but isolated interaction among tasks. To the rest of the system, a task, no matter how complex, is reduced to a simple producer and consumer of messages. An IPC mechanism provides a set of well defined services, each accessed through one or more messages. Though sometimes visible to other tasks, in one embodiment, none of a given task's variables and structures should be accessible outside its context. Limiting task interactions to message passing and keeping runtime variables private to each task allows individual software components to evolve independently and in parallel.","In order to keep code generic (i.e., system-and processor-independent), the message-based IPC should also provide a consistent application programming interface (API) that doesn't rely on any system-specific features or attributes. The API should have the same syntax and behavior, regardless of the underlying operating system, processor, or message-passing mechanism used. With certain generating systems, for example, message queues are used to implement the IPC, while on other kernels, pipes might be more appropriate. Preferably, then, the API should provide the following services to the application code:\n\n","The last service, name lookup and registration, makes it possible for communicating entities to reference one another using names rather than task ID's, which are system-dependent.","Resource Manager","A resource manager (RM) is the software module responsible for collecting information about available resources and monitoring their status during normal system operation. A resource is used generically in this document to refer to any manageable hardware element that performs one or more system functions. The RM builds its resource list from unsolicited information the RM receives from other modules in the system, and from periodic keep-alive messages the RM exchanges with those modules. The RM, for example, is the first system application notified of card failures, insertions, and removals.","In one embodiment of router , there are two RM versions in the system. The first, which runs on the level-1 processor, is responsible for managing system resources and, in some cases, network-wide resources. The other version, which runs on level-2 processors, is responsible for managing resources in a single shelf. This multi-level hierarchy creates a flexible and expandable system where lower-level resource managers are custom designed for the specific shelf controlled.","The RM maintains information about a given resource in a structure called the Resource Control Block (RCB). The RCB consists of two main sections: a generic section, which is the sane for all resources regardless of type, and a resource-specific section that varies according to resource type. All resource managers maintain a hierarchical list of resource control blocks that represents resources under their control. The list is referred to herein as the resource list and reflects the resources' hierarchy and their interdependencies. This allows the RM to determine, relatively quickly, the effect a given resource's failure has on other members of the hierarchy.","The router  preferably runs one or more versions of the Unix operating system on the level-1 processor and the level-2 processors (in the I\/O and matrix shelves). Level-2 processors preferably run a real-time version of the Unix operating system (OS). Other processors (e.g., level-3, route, quad, and matrix-node processors) preferably run a single task that does not require the services of an operating system or kernel. While Unix operating systems are described herein as being preferable, any one or a number of operating systems may be used.","System Controller","The system controller is responsible for overall system management and control. The system controller uses a variety of protocols to communicate with other nodes in the network, including the operating system (OS). Some of the protocols satisfy specific requirements (e.g. in a SONET based system, the transfer of OAM&P message across the SONET\/SDH communications channels DCC), while others implement features, or functions, that are not part of the physical protocol used. To facilitate these functions, every router (one router, two, etc.) in a network is assigned an ID that uniquely identifies the given router within the network. The ID can also serve as a priority metric that determines the node's level within the hierarchy. However, the network can be configured to allow the user to override this by manually assigning priorities to network nodes. The system controller supports a number of tasks that perform management, control, and routing functions, including resource management, OS interfacing, various network protocol servers, and operations, control, and intermediate system services.","Matrix Shelf Processor","The matrix shelf processor is responsible for the overall operation of a single main matrix shelf. The matrix processor communicates with the system controller, the route processor, and the microcontroller on each of the switch nodes, to provide local control and management for the shelf, including matrix configuration, diagnostics, and error reporting. The software on the matrix shelf processor preferably runs under a real-time Unix operating system. The RM on the matrix shelf processor is responsible for managing the hardware resources in its shelf. Like other resource managers in the system, the level-2 manager on this module uses a combination of hardware and software to discover and maintain a list of available shelf resources. A protocol may be implemented to support such messaging.","In one embodiment, fault isolation is implemented by a dedicated task that is responsible for locating failures within the shelf. In a SONET based implementation, the software running on the shelf processor, with help from the microcontroller on the switch node, to determine(s) the quality of any of the input signals.","Failure Isolation","Fault isolation may be implemented, for example, by a dedicated task that is responsible for locating failures within the shelf. The software running on the shelf processor, with help from the microcontroller on the switch node, is able to determine input signal quality.",{"@attributes":{"id":"P-00177","num":"00177"},"figref":"FIG. 19","b":["1900","822","17","8","1910","130"]},"As described, in one embodiment, the microcontroller then clears the error counter and starts a timer that expires at the end of the specified period (step ). Errors are reported by the physical layer monitor using a dedicated interrupt line (step ). The interrupt handler increments an error counter every time an interrupt is received from the monitor (step ).","At the end of the test period, which is indicated by the expiration of the timer, the microcontroller disables the physical layer monitor interrupt and saves the contents of the error counter (step ). When a GET_TEST_RESULT message is received from the shelf processor (step ), the microcontroller returns the result of the test in the response message (step ). If the GET_TEST_RESULT is received before the timer has expired, the microcontroller stops the timer and performs the sequence (step ).","I\/O Shelf Processor","Line Card","The I\/O Module terminates an input signal from one of the other nodes in the network. For example, in a SONET-based implementation, a single SONET\/SDH OC-48 signal is terminated by an I\/O module, although other signal levels (OC-192, OC-12, and so on) may be supported. In one embodiment, the software consists of two threads, one that runs in the background and is responsible for non-time critical tasks. The other thread, which runs at the interrupt level, is responsible for all real-time aspects of the software, including limited overhead processing, alarm detection and forwarding, and fault detection and recovery. The I\/O module maintains a copy eof its firmware and startup code onboard.","While particular embodiments of the present invention have been shown and described, it will be obvious to those skilled in the art that, based upon the teachings herein, changes and modifications may be made without departing from this invention and its broader aspects and, therefore, the appended claims are to encompass within their scope all such changes and modifications as are within the true spirit and scope of this invention. Furthermore, it is to be understood that the invention is solely defined by the appended claims."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The present invention may be better understood, and its numerous objects, features, and advantages made apparent to those skilled in the art by referencing the accompanying drawings.",{"@attributes":{"id":"P-00018","num":"00018"},"figref":"FIG. 1A"},{"@attributes":{"id":"P-00019","num":"00019"},"figref":"FIG. 1B","b":"1"},{"@attributes":{"id":"P-00020","num":"00020"},"figref":"FIG. 2","b":"1"},{"@attributes":{"id":"P-00021","num":"00021"},"figref":"FIG. 3","b":"1"},{"@attributes":{"id":"P-00022","num":"00022"},"figref":"FIG. 4"},{"@attributes":{"id":"P-00023","num":"00023"},"figref":"FIG. 5"},{"@attributes":{"id":"P-00024","num":"00024"},"figref":"FIG. 6"},{"@attributes":{"id":"P-00025","num":"00025"},"figref":"FIG. 7"},{"@attributes":{"id":"P-00026","num":"00026"},"figref":"FIG. 8"},{"@attributes":{"id":"P-00027","num":"00027"},"figref":"FIG. 9"},{"@attributes":{"id":"P-00028","num":"00028"},"figref":"FIG. 10","b":"8"},{"@attributes":{"id":"P-00029","num":"00029"},"figref":"FIG. 11","b":"8"},{"@attributes":{"id":"P-00030","num":"00030"},"figref":"FIG. 12"},{"@attributes":{"id":"P-00031","num":"00031"},"figref":"FIG. 13","b":"12"},{"@attributes":{"id":"P-00032","num":"00032"},"figref":"FIG. 14","b":"12"},{"@attributes":{"id":"P-00033","num":"00033"},"figref":"FIG. 15"},{"@attributes":{"id":"P-00034","num":"00034"},"figref":"FIG. 16"},{"@attributes":{"id":"P-00035","num":"00035"},"figref":"FIG. 17"},{"@attributes":{"id":"P-00036","num":"00036"},"figref":"FIG. 18"},{"@attributes":{"id":"P-00037","num":"00037"},"figref":"FIG. 19"}]},"DETDESC":[{},{}]}
