---
title: Reverberation processor based on absorbent all-pass filters
abstract: A reverberation processor includes a chain of absorbent all-pass filters and an absorbent delay line. The decay time can be precisely controlled by controlling the magnitude of the attenuation in the absorbent delay lines. Further, each absorbent delay line includes a low-pass filter for controlling the decay time at a particular high frequency.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07149314&OS=07149314&RS=07149314
owner: Creative Technology Ltd
number: 07149314
owner_city: Singapore
owner_country: SG
publication_date: 20001204
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DESCRIPTION OF THE SPECIFIC EMBODIMENTS"],"p":["Virtual auditory displays (including computer games, virtual reality systems or computer music workstations) create virtual worlds in which a virtual listener can hear sounds generated from sound sources within these worlds. In addition to reproducing sound as generated by the source, the computer also processes the source signal to simulate the effects of the virtual environment on the sound emitted by the source. In a first-person computer game, the player hears the sound that he\/she would hear if he\/she were located in the position of the virtual listener in the virtual world. One important environmental factor is reverberation, which refers to the reflections of the generated sound which bounce off objects in the environment. Reverberation can be characterized by measurable criteria, such as the reverberation time, which is a measure of the time it takes for the reflections to become imperceptible. Computer generated sounds without reverberation sound dead or dry. Additionally, reverberation is a very important effect utilized in music composition and rendering. Often a musical voice is recorded \u201cdry\u201d and then reverberation, or other effects, are added afterwards as post processing.","Artificial reverberation algorithms are well known in the art and are described e.g. in Stautner, J., and Puckette, M., \u201cDesigning Multi-Channel Reverberators,\u201d , Vol. 6, no. 1 (1982); Dattorro, J., \u201cEffect Design (Part 1: Reverberator and Other Filters; Part 2: Delay-Line Modulation and Chorus),\u201d , Vol. 45, no. 9\u201310 (1997); and Jot, J.-M., \u201cEfficient Models for Reverberation and Distance Rendering in Computer Music and Virtual Audio Reality,\u201d 1997 (1997). The implementation of these algorithms on digital signal processors is based on a network of digital delay lines which are connected together and to the input and output points of the algorithm by feed-forward or feedback connections. Rooms of different sizes and acoustical properties can be simulated by modifying the topology of the network (the number of delay lines and the connections between them), by varying the duration of the delays, or by adjusting the amplification or attenuation coefficients of multipliers and filters inserted on the feed-forward or feedback connections.","As depicted in , a typical model of reverberation breaks the reverberation effects into discrete time segments. The first signal that reaches the listener is the direct-path signal, which undergoes no reflections. Subsequently, a series of discrete \u201cearly\u201d reflections are received during an initial period of the reverberation response. Finally, after a critical time, the exponentially decaying \u201clate\u201d reverberation is modeled statistically because of the combination and overlapping of the various reflections. The magnitudes of Reflections_delay and Reverb_delay are typically dependent on the size of the room and on the position of the source and the listener in the room.","Accurate control of decay time has been demonstrated in a class of reverberator topologies, often referred to as \u201cFeedback Delay Networks\u201d (FDN), whose \u201clossless prototype\u201d can be represented as a parallel bank of delay lines interconnected via a unitary (i.e. energy-preserving) feedback matrix. FDN Reverberators are disclosed in co-pending commonly assigned patent applications entitled ENVIRONMENTAL REVERBERATION PROCESSOR, filed Nov. 2, 1999 (Application Ser. No. 09\/441,141) and REVERBERATION PROCESSOR FOR INTERACTIVE AUDIO APPLICATIONS, filed Apr. 11, 2000 (Application Ser. No. 09\/547,365), which are hereby incorporated by reference for all purposes. Another popular class of reverberator topologies creates a late reverberation response by using arrangements of delays and all-pass filters inserted in a feedback loop. These topologies are popular due to the efficient generation of echoes and theoretically colorless frequency response of all-pass filters. However, these all-pass reverberators have lacked a mathematically accurate means of controlling decay time characteristics and output level and have had to rely instead on empirical or inaccurate methods.","According to one aspect of the invention, conventional all-pass filters used in a digital audio reverberation processor using cascaded all-pass filters and delays in a recursive feedback loop are replaced by modified all-pass filters, called absorbent all-pass filters, in which an absorbent filter is associated with each delay unit. Absorbent filters are designed to provide accurate, explicit control of reverberation decay time in multiple frequency bands.","According to another aspect of the invention, the output of the late reverberation module is normalized so that the reverberation intensity is independent of the reverberation decay time.","According to another aspect of the invention, reverberation modal density and echo density are also controlled independently from decay time and intensity. These criteria must be satisfied for a reverberator compliant with standard 3-D audio Application Programming Interfaces (APIs): EAX, 13DL2, OpenAL.","Other features and advantages of the invention will be apparent in view of the following detailed description and appended claims.","The invention will now be described with reference to the preferred embodiments.","The complete reverberator  is shown in . The inputs are passed through low-pass filters and  before being sent through delay lines and  and passed to the early reflection block  and late reverberation block . The early reflections are created by tapping the input delays and passing the summed signals through normal all-pass filters and . The delay values of the early reflection taps and the late reverberation feeds are functions of the Reflections Delay and Reverb Delay parameters, as described below.  depicts an embodiment of the late reverberation block  which is made up of two chains and of absorbent all-pass filters AP R\u2013AP R and AP L\u2013AP L and absorbent delay lines and . Signals from the chains and are tapped, summed and passed through normalizing elements (described below) and to make the two late reverb outputs and . The inputs and to the late reverberation block  are added to the fed-back signals and from the ends of the all-pass\/delay chains and , and these signals pass through a unitary mixing matrix  to feed the inputs and to both the all-pass\/delay chains and ","Two independent output signals are obtained by tapping the chains after each absorbent all-pass filter. In the currently described embodiment, the absorbent all-pass delay lengths are chosen to be mutually prime, and are arranged in each chain in order of increasing length. The decay time is controlled by adjusting the attenuation and low-pass filter in each absorbent all-pass filter and after each delay line according to Equation (3) below. The modal density can be modified by scaling the amount of delay in the absorbent all-pass filters, and the echo density (or \u201cdiffusion\u201d) can be modified by changing the all-pass coefficient (g in ) of the absorbent all-pass filters.",{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 4","b":["60","62","64","60","70","72","74","76","78"]},"An all-pass filter is any filter whose magnitude response is equal to 1 for all frequencies. All-pass filters have a transfer function H(z) that can be represented as a ratio of two polynomials in the complex variable z,",{"@attributes":{"id":"p-0021","num":"0020"},"maths":{"@attributes":{"id":"MATH-US-00001","num":"00001"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"H","mo":"\u2062","mrow":{"mo":["(",")"],"mi":"z"}},"mo":"=","mfrac":{"mrow":[{"mi":"B","mo":"\u2062","mrow":{"mo":["(",")"],"mi":"z"}},{"mi":"A","mo":"\u2062","mrow":{"mo":["(",")"],"mi":"z"}}]}}}}},"where the coefficients of B are the coefficients of A in reverse order. For example:",{"@attributes":{"id":"p-0023","num":"0022"},"maths":{"@attributes":{"id":"MATH-US-00002","num":"00002"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"H","mo":"\u2062","mrow":{"mo":["(",")"],"mi":"z"}},"mo":"=","mfrac":{"mrow":[{"mn":"1","mo":["+","+","+"],"mrow":[{"mn":"0.5","mo":"\u2062","msup":{"mi":"z","mrow":{"mo":"-","mn":"1"}}},{"mn":"0.25","mo":"\u2062","msup":{"mi":"z","mrow":{"mo":"-","mn":"2"}}},{"mn":"0.12","mo":"\u2062","msup":{"mi":"z","mrow":{"mo":"-","mn":"3"}}}]},{"mn":"0.12","mo":["+","+","+"],"mrow":[{"mn":"0.25","mo":"\u2062","msup":{"mi":"z","mrow":{"mo":"-","mn":"1"}}},{"mn":"0.5","mo":"\u2062","msup":{"mi":"z","mrow":{"mo":"-","mn":"2"}}}],"msup":{"mi":"z","mrow":{"mo":"-","mn":"3"}}}]}}}}},"There are a number of topologies which can implement transfer functions of this form, and all of them are all-pass.","Any all-pass filter can be made into an absorbent all-pass filter by associating in series with each delay line in the filter an attenuation which may vary with frequency. When an absorbent all-pass filter is used in a late reverberation block these attenuations are used to control the decay time of the late reverberation according to Equations (3) or (4) below. If the attenuations vary with frequency then the decay time can be controlled at multiple frequencies. One method of creating a frequency dependent attenuation is to use both a low-pass filter  and an attenuation gain element  associated in series with each delay line.","The attenuation gain  precisely controls the decay time at low and mid frequencies, and the low-pass filter , having a gain at a specified high frequency dependent on the delay length, controls the decay time at the specified high frequency.","The following list of control parameters (compliant with the Level 2.0 Interactive 3D Audio Rendering Guideline (13DL2) of the 3D Working group of the Interactive Audio Special Interest Group) describes briefly what aspects of the reverb algorithm are affected by each reverberation control parameter.","Room:","Room affects the gain of the reverb output (both early reflections and late reverberation.)","Room HF:","RoomHF controls the high frequency attenuation of the low-pass filters at the inputs to the reverberator.","Decay Time:","The decay time of the late reverberation at low frequencies is controlled by adjusting the absorbent attenuations in the absorbent all-pass filters and absorbent delay lines (denoted \u2018a\u2019 in the diagrams.)","Decay HF Ratio:","The ratio of high frequency decay time to low frequency decay time in the late reverberation is controlled by adjusting the high-frequency attenuation of the low-pass filters in the absorbent delays and absorbent all-pass filters.","Reflections:","Reflections controls the output gain\/attenuation of the early reflections.","Reflections Delay:","Reflections Delay controls the delay time between the input to the reverberator and the first tap of the early reflections.","Reverb:","Reverb controls the output gain\/attenuation of the late reverberation.","Reverb Delay:","Reverb Delay controls the delay between the first tap of the early reflections and the input to the late reverberation processor. It also controls the spread of the early reflection taps.","Diffusion:","Diffusion controls the all-pass coefficient (denoted \u2018g\u2019 in the diagrams) of the absorbent all-pass filters in the late reverberation processor, thus affecting the echo density.","Density:","Density scales the delay lengths in the late reverb, specifically the delays in the absorbent all-pass filters and absorbent delays, thus affecting the modal density.","HF Reference:","HF Reference sets the frequency at which the input low-pass filters and the low-pass filters in the absorbent delays and absorbent all-pass filters are controlled. In other words Room HF and Decay HF Ratio control the attenuation at HF Reference of these low-pass filters.","The elements in the currently described embodiment of the late reverberation processor  of  will now be described in greater detail.","In the currently described embodiment, the delay lengths of the absorbent all-pass filters are chosen to be mutually prime, and are arranged in each chain in order of increasing length. The decay time is controlled by adjusting the attenuation and low-pass filter in each absorbent all-pass and after each delay line according to Equation (3) below. The modal density can be modified by scaling the amount of delay in the absorbent all-pass filters, and the echo density (or \u201cdiffusion\u201d) can be modified by changing the all-pass coefficient (g in ) of the absorbent all-pass filters.","Mixing Matrix:","The mixing matrix  mixes the two inputs and to the late reverberation block  along with the two feedback signals and into two signals and which feed the late reverb all-pass\/delay chains and . The matrix is designed to have a unitary energy gain. The matrix outputs are calculated from the matrix inputs according to the following formulas:",{"@attributes":{"id":"p-0054","num":"0053"},"maths":{"@attributes":{"id":"MATH-US-00003","num":"00003"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"mi":"LeftOut","mo":"=","mrow":{"mrow":[{"mrow":{"mo":"-","mfrac":{"mn":"1","msqrt":{"mn":"2"}}},"mo":"\u2062","mi":"LeftIn"},{"mfrac":{"mn":"1","msqrt":{"mn":"2"}},"mo":"\u2062","mi":"RightIn"}],"mo":"+"}},{"mi":"RightOut","mo":"=","mrow":{"mrow":[{"mrow":{"mo":"-","mfrac":{"mn":"1","msqrt":{"mn":"2"}}},"mo":"\u2062","mi":"LeftIn"},{"mfrac":{"mn":"1","msqrt":{"mn":"2"}},"mo":"\u2062","mi":"RightIn"}],"mo":"-"}}],"mo":["\u2062","\u2062"],"mstyle":{"mtext":{}}}},{"mrow":{"mo":["(",")"],"mn":"1"}}]}}}}},"Delay Lengths:","The delay lengths of the absorbent all-pass filters in the late reverberation processor are functions of the Density parameter. Each absorbent all-pass filter has a different delay length with each absorbent all-pass filter in the chain having a longer delay than the previous. These lengths are calculated so that none of the delay lengths are integer multiples of any of the other lengths, and so that the lengths decrease as Density decreases.","All-Pass Coefficient and Diffusion:","The all-pass coefficient of the absorbent all-pass filters (denoted \u2018g\u2019 in ) is set as a function of the Diffusion property. All the filters in the late reverberation processor have the same all-pass coefficient, and it is calculated from the following equation:\n\n(Diffusion\/100)\u2003\u2003(2)\n\n","Absorbent Gains and Filters:","The absorbent gain in the absorbent all-pass filters and delays (denoted \u2018a\u2019 in the diagrams) is a function of the Decay Time property and the length of each particular delay. The absorbent gain can be calculated using the following formulas:",{"@attributes":{"id":"p-0061","num":"0061"},"maths":{"@attributes":{"id":"MATH-US-00004","num":"00004"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"mi":"length","mo":"=","mrow":{"mi":["Delay_Length","_in","_milliseconds"],"mo":["\u2062","\u2062"]}},{"mi":"Tr","mo":"=","mrow":{"mi":["Decay_Time","_in","_milliseconds"],"mo":["\u2062","\u2062"]}},{"mi":"adB","mo":"=","mrow":{"mrow":[{"mo":"-","mn":"60"},{"mi":["length","Tr"],"mo":"\/"}],"mo":"*"}},{"mi":"a","mo":"=","msup":{"mn":"10","mfrac":{"mi":"adB","mn":"20"}}}],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mtext":{}},{"mtext":{}},{"mtext":{}}]}},{"mrow":{"mo":["(",")"],"mn":"3"}}]}}}}},"In general, the absorbent gain is implemented by applying to each delay line an attenuation whose logarithm is proportional to the delay length, which has the effect of multiplying the system's impulse response by an exponentially decaying envelope.","Low-Pass Filter:","In general, the decay time can be made frequency-dependent by making each attenuation into a filter G(z) whose gain at any frequency \u03c9 is dependent on the delay length \u03c4and the desired decay time Tr(\u03c9)) at that frequency:\n\n20 log()|=\u221260\u03c4(\u03c9)\u2003\u2003(4)\n\nIn the present embodiment the decay time is controlled at two frequencies by associating a Low Pass Filter (LPF) in series with each absorbent gain.\n",{"@attributes":{"id":"p-0065","num":"0065"},"figref":["FIG. 5","FIG. 4"],"b":["80","64","62"]},"Both inputs are filtered by a DC-normalized, one-pole low-pass filter, which has the transfer function",{"@attributes":{"id":"p-0067","num":"0067"},"maths":{"@attributes":{"id":"MATH-US-00005","num":"00005"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"mi":"H","mo":"\u2061","mrow":{"mo":["(",")"],"mi":"z"}},"mo":"=","mfrac":{"mrow":[{"mn":"1","mo":"-","mi":"b"},{"mn":"1","mo":"-","msup":{"mi":"bz","mrow":{"mo":"-","mn":"1"}}}]}}},{"mrow":{"mo":["(",")"],"mn":"5"}}]}}}}},"The filter coefficient \u2018b\u2019 is calculated from the values of RoomHF and HF Reference according to the following pseudo-code:",{"@attributes":{"id":"p-0069","num":"0069"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"FS = Sampling Rate in samples per second;"]},{"entry":[{},"Fc = HF Reference Value, in Hz;"]},{"entry":[{},"DbGainAtFC = \u221260*length\/(HFRatio*Tr);"]},{"entry":[{},"G = pow(10.0, DbGainAtFc \/ 20.0);"]},{"entry":[{},"if(G==1.0){"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"b = 0.0;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"else{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"omega = cos(2*PI*Fc\/FS);"]},{"entry":[{},"A = 8.0*G \u2212 4.0*G*G \u2212 8.0*G*omega +"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"4.0*G*G*omega*omega;"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"b = (2*G*omega \u2212 2.0 + sqrt(A)) \/ (2.0*G \u2212 2.0);"]},{"entry":[{},"b = (b>1.0)?1.0:b;"]},{"entry":[{},"b = (b<0.0)?0.0:b;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}},"ul":{"@attributes":{"id":"ul0003","list-style":"none"},"li":{"@attributes":{"id":"ul0003-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0004","list-style":"none"},"li":"where length and Tr are the same as those in the above gain calculation (eq. 3)."}}}},"Taps:","In the late reverb the signal after each absorbent all-pass in a chain is tapped and summed into the output for that side.","Output Level and Normalization:","The summation of the late reverb taps for each side is multiplied by one final value before being sent to the output. This last multiply is used for three purposes: 1) Adjust the output level for the Room property; 2) Adjust the output level of the late reverberation prosessor for the Reverb property; and 3) normalize the energy output of the late reverberation.","The intensity level of the late reverberation response can be controlled independently of the other parameter settings by normalizing the energy gain of the late reverberation network, and adjusting the level of the normalized output. To determine the energy gain of the late reverberation network it is useful to describe the network as a feedback loop with loop energy gain A, and output energy gain B, as in .","The energy gain is then the product of the output gain B and a geometric series of A:\n\nEnergyGain=(1+)\u2003\u2003(6)\n","The system impulse response is the sum of a series of elementary impulse responses (corresponding to a different numbers of trips through the feedback loop). Equation (6) assumes that these elementary impulse responses are mutually uncorrelated signals, so that the total energy is the sum of their individual energies. This assumption is made because the impulse response of each pass through the two chains of cascaded absorbent all-pass filters has few large interfering terms in the successive impulse response due to the mixing matrix and the use of large mutually prime delay lengths. Since, for finite decay times, the loop energy gain A is less than one, the geometric series can be simplified to 1\/(1-A) and the amount of normalization required is:",{"@attributes":{"id":"p-0077","num":"0078"},"maths":{"@attributes":{"id":"MATH-US-00006","num":"00006"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mi":"Norm","mo":"=","mrow":{"msqrt":[{"mfrac":{"mn":"1","mi":"EnergyGain"}},{"mfrac":{"mrow":{"mn":"1","mo":"-","mi":"A"},"mi":"B"}}],"mo":"="}}},{"mrow":{"mo":["(",")"],"mn":"7"}}]}}}}},"To calculate the loop energy gain A of the late reverberation processor described in , the energy gain for each of the two chains of filters is first calculated. The energy gain of each chain can be approximated as the product of the energy gains of each filter and attenuation in the chain, where energy gain of a filter is defined as the sum of its squared impulse response. This assumption is made because the use of mutually prime delay lengths ensures that the cross terms between convolved absorbent all-pass filter impulse responses will occur seldom and only late in the response where the terms are small.","The loop energy gain A for the entire reverberation loop is then the sum of the energy gains of the two branches:",{"@attributes":{"id":"p-0080","num":"0081"},"maths":{"@attributes":{"id":"MATH-US-00007","num":"00007"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mi":"A","mo":"=","mrow":{"mrow":[{"msubsup":{"mi":["g","DL"],"mn":"2"},"mo":"\u00b7","mrow":{"munder":{"mo":"\u220f","mi":"i"},"mo":"\u2062","msub":{"mi":["c","Li"]}}},{"msubsup":{"mi":["g","RL"],"mn":"2"},"mo":"\u00b7","mrow":{"munder":{"mo":"\u220f","mi":"i"},"mo":"\u2062","msub":{"mi":["c","Ri"]}}}],"mo":"+"}}},{"mrow":{"mo":["(",")"],"mn":"8"}}]}}}},"ul":{"@attributes":{"id":"ul0005","list-style":"none"},"li":"where Cis the energy gain for the with absorbent all-pass filter in the left chain, and gis the attenuation associated with the delay line in the left chain. Similarly, c, and gare the energy gains for the right absorbent all-passes and attenuation."}},"The left and right output gains BL and BR are calculated by assuming that the total energy gain at the output is the sum of the energy gains after each tap (see ). The energy gain after each tap is the product of the energy gain in the chain up to that tap, which is calculated as the product of filter gains, as in Equation (8), and the energy gain of the tap. For example, the output gain of the left output is:",{"@attributes":{"id":"p-0082","num":"0084"},"maths":{"@attributes":{"id":"MATH-US-00008","num":"00008"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msub":{"mi":["B","L"]},"mo":"=","mrow":{"mrow":[{"msubsup":{"mi":"t","mn":["1","2"]},"mo":"\u2062","msub":{"mi":["c","L1"]}},{"msubsup":{"mi":"t","mn":["2","2"]},"mo":"\u00b7","mrow":{"munderover":{"mo":"\u220f","mrow":{"mi":"i","mo":"=","mn":"1"},"mn":"2"},"mo":"\u2062","msub":{"mi":["c","Li"]}}},{"msubsup":{"mi":"t","mn":["6","2"]},"mo":"\u2062","mrow":{"msubsup":{"mi":["g","DL"],"mn":"2"},"mo":"\u00b7","mrow":{"munderover":{"mo":"\u220f","mrow":{"mi":"i","mo":"=","mn":"1"},"mn":"6"},"mo":"\u2062","msub":{"mi":["c","Li"]}}}}],"mo":["+","+","+"],"mi":"\u2026"}}},{"mrow":{"mo":["(",")"],"mn":"9"}}]}}}}},"The left and right outputs are normalized by multiplying by NormL and NormR where:",{"@attributes":{"id":"p-0084","num":"0086"},"maths":{"@attributes":{"id":"MATH-US-00009","num":"00009"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"mi":"NormL","mo":"=","msqrt":{"mfrac":{"mrow":{"mn":"1","mo":"-","mi":"A"},"msub":{"mi":["B","L"]}}}},{"mi":"NormR","mo":"=","msqrt":{"mfrac":{"mrow":{"mn":"1","mo":"-","mi":"A"},"msub":{"mi":["B","R"]}}}}],"mo":[",","\u2062"],"mstyle":{"mtext":{}}}},{"mrow":{"mo":["(",")"],"mn":"10"}}]}}}}},"The last remaining step is to calculate the energy gain for each absorbent all-pass filter, which we defined as the sum of the squared impulse response samples. We calculate the energy gain at low frequencies by ignoring the effect of the low-pass filter in the absorbent all-pass filter.","By examining the impulse response of an absorbent all-pass filter (with low-pass filtering disabled) it can be easily shown that the energy gain is a function of the all-pass coefficient g and the absorbent gain a (shown in ):",{"@attributes":{"id":"p-0087","num":"0089"},"maths":{"@attributes":{"id":"MATH-US-00010","num":"00010"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msub":{"mi":["c","Li"]},"mo":"=","mrow":{"msup":{"mi":"g","mn":"2"},"mo":"+","mrow":{"mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"-","msup":{"mi":"g","mn":"2"}}},"mo":"\u2062","mfrac":{"msubsup":{"mi":["a","Li"],"mn":"2"},"mrow":{"mn":"1","mo":"-","mrow":{"msubsup":{"mi":["a","Li"],"mn":"2"},"mo":"\u2062","msup":{"mi":"g","mn":"2"}}}}}}}},{"mrow":{"mo":["(",")"],"mn":"11"}}]}}}}},"It is possible to calculate the energy normalization values in the same routine in which the absorbent gains and filter coefficients are calculated.","Once the normalization values are calculated, the output gain for the left and right branches of the late reverberation processor can be calculated. The output gain takes into account the Room and Reverb levels as well as the energy normalization. There is an additional correction that takes place when the two reverb outputs will be added together to make a mono signal. This additional correction depends on the value of the Diffusion property. The following pseudo code shows how the late reverb output levels of the late reverberation block are calculated in the currently described embodiment:",{"@attributes":{"id":"p-0090","num":"0092"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"98pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"val = (Room Value + Reverb Value) \/ (100.0);","\/\/ \/100 to go from mB to dB."]},{"entry":[{},"val = pow(10,val\/20.0);","\/\/ convert to amplitude"]},{"entry":[{},"if(val > 1.0)"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"231pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"val = 1.0;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"245pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"if(stereo outputs will be summed to mono)"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"259pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"{"},{"entry":"diff_adj = pow(10, 3.5*Diffusion Value\/ (100*20); \/\/ adjust normalization by +3.5dB"},{"entry":"\/\/ for max diffusion. scale linearly"},{"entry":"\/\/ in dB."}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"245pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"else"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"231pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"diff_adj = 1.0;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"245pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Left Reverb Output Level = val * NormL * diff_adj;"]},{"entry":[{},"Right Reverb Output Level = val * NormR * diff_adj;"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}}},"Note from eq. (10) above that the value of the parameter Norm is equal to the square root of the reciprocal of the energy gain of the late reverberation network. Thus, by amplifying the output signal by Norm the gain of the late reverberation loop is canceled and the output level of the reverberation block is independent of the parameter settings.","For example, as demonstrated in eqs. (10) and (11), in the currently described embodiment the gain of the late reverberation loop is dependent on the value of the Diffusion parameter. The normalization described above cancels the effect of the Diffusion parameter on the loop gain so that echo density can be varied without changing the output level. It then possible to adjust the output level based solely on the values of the Room and Reverb parameters.","As is well known in the art, the block diagrams depicted in  can be implemented entirely in hardware, software, or a combination thereof. For example, in a hardware embodiment the normalization would be implemented by an amplifier having a gain set to attenuate the loop output signal by Norm. In a software embodiment the value of the output signal would be multiplied by Norm. In a currently preferred embodiments the input signals are digital audio signals, the filters and gain elements are implemented in software, stored in a computer readable medium which may include digital data encoded in electromagnetic signals or stored in magnetic or optical media, executed on a processor.","The invention has now been described with reference to the preferred embodiments. Alternatives and substitutions will now be apparent to persons of skill in the art. In particular, the detailed structure of the late reverb described is not necessary to practice the invention. Other topologies for implementing a late reverberation block are well known in the art. Additionally, there are a number of topologies which can implement all-pass filters, and all of them can be made into absorbent all-pass filters by having attenuations associated in series with their delay lines. Accordingly, these different topologies may be utilized in implementations of the invention. Also, for different implementations the calculation of Norm would be varied to take into account different elements. Accordingly, it is not intended to limit the invention except as provided by the appended claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
