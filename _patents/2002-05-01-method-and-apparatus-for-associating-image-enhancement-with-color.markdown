---
title: Method and apparatus for associating image enhancement with color
abstract: Provided is a method and apparatus of processing an image using filters. The method and apparatus receives an input pixel and a pixel array associated with the image, identifies a color of the pixel array to facilitate processing the input pixel and the pixel array associated with the image and locates the color and the association with a corresponding image enhancement operation in a color lookup table.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07545976&OS=07545976&RS=07545976
owner: Hewlett-Packard Development Company, L.P.
number: 07545976
owner_city: Houston
owner_country: US
publication_date: 20020501
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS REFERENCE TO RELATED APPLICATIONS","BACKGROUND OF THE INVENTION","DETAILED DESCRIPTION"],"p":["This application relates to U.S. patent application Ser. No. 10\/136,958 filed May 1, 2002 entitled \u201cParameterized Sharpening and Smoothing Method and Apparatus\u201d filed on the same day therewith, assigned to the assignee of the present invention and incorporated by reference herein for all purposes.","The proliferation of digital image photography, printing and image generation demands improved image processing techniques. These image processing techniques improve the perceived quality of images by manipulating the data captured and recorded by cameras and other devices. Lower cost devices can produce higher quality images through sophisticated image processing techniques performed on computers and peripheral devices. This satisfies the consumer's need for better quality images without spending large amounts of money for professional or even \u201cprosumer\u201d type devices.","One image processing technique called image-sharpening tends to increase the perceptibility of details in an image. Typically, image-sharpening operates by increasing pixel contrast on and around perceived edges in an image. If the edges are important to the image, this increases the visible details in the image and overall perceived quality of the image. Unfortunately, artifacts, noise and other details may not be desired yet will also be enhanced by image-sharpening operations. These sharpening operations can often make the image look \u201cnoisy\u201d and appear of lower quality than if otherwise left alone.","Alternative image processing operations for smoothing operate to reduce or eliminate artifacts, noise and other undesired detailed elements of an image. Filters and other operations are applied to these images to soften or eliminate details perceived to be artifacts and noise. Smoothing preferably eliminates unwanted noise and artifacts by making neighboring pixels more consistent with each other. Applied indiscriminately, however, these smoothing filters have the deleterious effect of also eliminating desired details important to the image and can result in fuzzy or blurred images.","Active suppression of noise and artifacts during image processing is another method of improving image quality through image processing. These operations also have a smoothing effect primarily on or around sharp edges in an image. While these suppression methods may be more accurate, they can be computationally inefficient and therefore not cost effective to implement on lower cost hardware and software platforms.","Moreover, even high quality image processing methods cannot be applied successfully to all types of images. An image processing method that improves one image may be inappropriate when applied to another image. Further, one image processing technique may counteract the advantageous effects of another image processing technique.",{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 1","b":["100","102","104","105","106","108","110","112","114","116","118","120"]},"In one implementation, image  is processed in sections using pixel window  having N\u00d7N pixels. Alternate implementations may use an asymmetric pixel window having M\u00d7N pixels. In the case of an N\u00d7N pixel window  dimensions can be set to 5\u00d75, 3\u00d73 and other window dimensions depending on the granularity of processing required. Filter selection module  receives an indication from color lookup table  identifying a filter for processing input pixel  and pixel window . This indication can be an index or offset identifying a filter in filter database  or can be an actual image processing algorithm or set of parameters for performing an algorithm. In one implementation, filter processing module  applies the filter selected from filter database  to input pixel  and pixel window . Filter database  includes a wide range of filters and convolutions for image enhancement. For example, these filters and convolutions provide multiple levels of smoothing and sharpening operations for application on input pixel  and pixel window .","Optionally, filter selection module  receives indication from color lookup table  in weighted combination with an indication from pixel classification module  when selecting a filter from filter database  for processing an image. A user or application can further control the filter indication provided by pixel classification module  through adjustments to enhancement settings . Enhancement settings  allow a user or application to influence the indication provided by pixel classification module  to filter selection module  when making a filter selection.","For example, pixel classification  can provide an indication to use sharpening-type filters on input pixel  and the pixel window  having edges and smoothing-type filters for input pixel  and the pixel window  containing noise, blocking artifacts and other undesirable characteristics. These indications from pixel classification  are combined with sharpening or smoothing filter selection indications from color lookup table  to select the proper filter database . Because the pixel classification and filtering indicators are parameterized using enhancement settings , the sharpening and smoothing type image enhancements can be set according to the output image desired. Details on performing pixel classification and image enhancement using enhancement settings  in accordance with pixel classification module  is described in further detail in the U.S. patent application Ser. No. 10\/136,958 entitled, \u201cParameterized Smoothing and Sharpening Method and Apparatus\u201d, assigned to the assignee of the present invention, filed on the same day therewith and incorporated by reference in the entirety for all purposes.","Representing images with the proper color models is an important aspect of the present invention. Because combining three primary colors (X, Y, Z) can define the light sensations a person experiences with their eyes, several tristimulus color spaces exist for specifying three independent functions of wavelength for the ideal trichromatic observer. The fundamentals of such three-dimensional constructs are described by the international standards body Commission Internationale L'Eclairage or CIE. Setting the standards for colorimetry and identifying colors is discussed in Principles of Color Technology, by Billmeyer and Saltzman, published by John Wiley & Sons, Inc., NY, copyright 1981 (2d. ed.) and Color Science: Concepts and Methods, Quantitative Data and Formulae, by Wyszecki and Stiles, published by John Wiley & Sons, Inc., copyright 1982 (2d ed.), incorporated herein by reference in pertinent parts, particularly pages 119-130 and Fundamentals of Interactive Computer Graphics, by Foley and Van Dam, Addison-Wesley Publishing Company, incorporated herein by reference in pertinent parts, particularly pages 606-621.","These various trichromatic model systems include: the red, green, blue (RGB) model; the cyan, magenta, yellow (and black) (CMY(K)) model; the hue, saturation, value (HSV) model; the hue, lightness, saturation (HLS) model; the luminance, red-green scale, yellow-blue scale (L*a*b*) model; and the YIQ model used in commercial color television broadcasting. Selecting the proper model depends on the application and the various advantages the model provides.","Typically, color input and output devices like scanners, cathode ray tube (CRT) video monitors, and printers present color images in a device-dependent fashion. For example, CRT guns are driven by voltage levels or other input signal functions that correspond to red, green and blue or RGB data triplets. These RGB data triplets correspond to the specific color gamut for the CRT and the unique colors produced by the CRT pixels on its screen. Differences in color reproduction on each of the devices means that the same RGB triplet may actually produce a very different color or hue when displayed on a different model CRT or hard copy made with a color printer using a different device color space like cyan, magenta, yellow and black or CMYK. (To maintain black color purity in CMYK printing, a separate black (K) ink or toner may be provided rather than printing all three cyan, magenta and yellow colors to form a composite black).","Transforming colors between devices or color spaces on different devices requires complex, non-linear computations in multiple dimensions. To reduce the processing requirements for these transformations, the correlative values are typically precomputed and stored in large color look-up tables (CLUT) sometimes requiring upwards of 50 Mb or more. Generally, a larger CLUT contains a wider range of color combinations yielding more accurate color images, but may require more computing time or processing power as the CLUT is searched and accessed. Further compute time and processing power is also required when a match between a color combination cannot be found in the CLUT, and thus complex interpolation within the color space is required in order to transform the color. Efficiently interpolating between values in large CLUTs is described in U.S. Pat. No. 5,748,176 entitled, \u201cMulti-Variable Colorimeter Data Access by Iterative Interpolation and Subdivision\u201d, by Jay S. Gondek, assigned to the assignee of the present invention and incorporated by reference herein in the entirety.","Often, the CLUT contains data to approximate a transformation from an RGB system to a CMYK system facilitating the correlation between two color models and\/or rendering of color images on different devices. These transformations often include the conversion of images rendered using the additive primary colors of red, green, and blue (RGB) for a computer video monitor into the subtractive primary colors, cyan, magenta, yellow and black (CMYK) for printing on a color printing device.","According to the present invention, CLUTs developed for each device are modified and used by implementations of the present invention to perform image processing, instead of color transformations.  is a flowchart diagram providing the operations associated with creating these entries in the CLUT as used by an image processing system designed in accordance with implementations of the present invention.","Initially, a color gamut is gathered for an image presentation device. The color gamut has the range of available colors the device is capable of reproducing (). As described above, the trichromatic model used to represent the color gamut depends on the type of device and method the device uses to produce color images. Color printers using the CYMK color model have a corresponding color gamut representing the effect of combining each of the cyan, yellow and magenta colors together in various combinations and amounts. Similarly, color CRT display devices using the RGB color model have a color gamut describing the effect of combining each of the red, green and blue colors together on the display device.","Representing the displayable colors for these and other raster devices is a subset of the total color space represented by the CIE chromaticity diagrams. Rather than CIE chromaticity diagrams, RGB space or CYMK space is generally represented using a Cartesian coordinate system with the additive RGB or subtractive CYMK primaries along opposing ends of the X, Y and Z axis. Of course, other color model representations are also possible and aspects of the present invention are not limited to only RGB and CYMK color models. This Cartesian coordinate system is used by U.S. Pat. No. 5,748,176 entitled, \u201cMulti-Variable Colorimeter Data Access by Iterative Interpolation and Subdivision\u201d to efficiently interpolate between entries in the CLUT and effectively improve the dynamic range without significant hardware or other algorithmic operations.","Once the color gamut is determined for a device, different regions of colors representing the color gamut in a spatial CLUT are associated with one or more image enhancement operations (). Entries in the spatial CLUT can utilize an index or an embedded database query to access the enhancements operations in a separate database. Alternatively, the spatial CLUT may have enough room to directly store appropriate algorithm operations and\/or convolutions for enhancing the images.","In accordance with the present invention, color schemes frequently found in images are improved through the application of certain enhancement or image processing operations. The spatial CLUT cross references the various color schemes with the specific enhancement operations thereby facilitating the image enhancement process. By referencing segments of the image by color, typical objects or scenes in the image receive the most appropriate type of image enhancement. Conversely, other portions of the image having other color schemes are not processed by inappropriate image enhancement operations.","For example, in one implementation shades of green are associated in the spatial CLUT with sharpening routines. Leaves, grasses, trees, foliage and other similar objects typically associated with shades of green are sharpened thereby enhancing the perception of these objects in the image. Similarly, flesh tone colors are associated in the spatial CLUT with smoothing routines thus reducing artifacts, noise and other undesirable elements that sometimes appear on the skin tones of people appearing in images. Moreover, segmenting these regions of colors in accordance with the present invention reduces the degree that flesh tone colors in a photo incorrectly receive sharpening, or shades of green in a photo are inadvertently smoothed. Other color regions in the spatial CLUT can also be associated with smoothing, sharpening or any other enhancement operations closely associated with a region of colors or spectrum of colors in a logical grouping.","The spatial CLUT is made available to image processing devices once enhancement operations are associated with entries in the spatial CLUT (). Image processing devices include display card devices or other image processing equipment used to render images on computers or computer-based equipment. The actual spatial CLUT is made available using application programming interfaces (API), system calls and other interfaces typically used to interface traditional CLUTs used for color transformations rather than spatial transformations. For example, the spatial CLUT can be provided directly in an operating system or within device-drivers designed to interface between the operating system and image processing devices associated with a computer or computer-based device.",{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 3","b":"300"},"A sample pixel window and input pixel in the pixel image is selected for determining an input color and the corresponding enhancement operation (). In one implementation, the input pixel is in the center of a pixel window having either a 5\u00d75 dimension, a smaller 3\u00d73 dimension or another dimension. Using a smaller pixel window allows the processing to occur more rapidly while the large pixel dimension trades the longer processing times for more precision. Each resulting enhancement operation modifies the input pixel and pixel window before shifting the sample pixel window to cover another area of the image. Continuing this enhancement operation on the input image creates an enhanced output image of the same dimensions in accordance with the present invention.","The input color of the pixel window is generally determined by taking a center weighted average of the values in the pixel window. Alternatively, the input color can be determined by using a weighted average of the values in the pixel window without the extra emphasis on the color contributed by the input pixel in the center of the pixel window. A further alternative can use the input color associated with the input pixel in the center of the pixel window rather than performing any color determination calculations.","The input color identified is cross referenced in the spatial CLUT to locate an appropriate enhancement operation (). Identifying the input color in the spatial CLUT involves comparing the input color with entries in the spatial CLUT using the appropriate color model. In some cases, it may be necessary to convert the input color into a color model compatible with entries in the spatial CLUT (i.e., RGB to CYMK or CYMK to RGB).","The larger the spatial CLUT, the higher the likelihood that the specific color combination associated with the input color will be immediately identified in the spatial CLUT. In some cases, however, the input color does not match an entry in the spatial CLUT even when using the same 3 D color space (). To identify the closest matching entry in the spatial CLUT, entries in the spatial CLUT are interpolated until a match with the input color is located. Efficient interpolation of entries in a CLUT is further described in U.S. Pat. No. 5,748,176 entitled, \u201cMulti-Variable Colorimeter Data Access by Iterative Interpolation and Subdivision\u201d. Several iterations of interpolation () and matching () of the input color with entries in the spatial CLUT may occur until a match is found.","In one implementation, the matching entry in spatial CLUT is accessed and the corresponding enhancement operation is identified (). This enhancement operation is obtained from filter database  and provided to filter selection  and filter processing  in  and used to enhance input pixel  and pixel window . Alternatively, the enhancement operation identified the spatial CLUT is used in combination with other factors for determining which filters from filter database  to apply. For example, these factors could include a local gradient and mean absolute deviation associated with the input pixel and pixel window. A pixel classification method and apparatus described in U.S. patent application Ser. No. 10\/136,958 entitled, \u201cParameterized Smoothing and Sharpening Method and Apparatus\u201d provides additional factors for selecting smoothing and sharpening enhancement filters using local gradient and mean absolute deviation calculations as previously described.",{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 4","b":["400","400","402","404","1","406","2","408","3","410","412","400","412"]},"This particular table divides the color gamut for an image processing device into four different groups. Alternate implementations of the present invention could divide the color gamut into greater or fewer groups of colors. Each color grouping is associated with one or more different enhancement filters. For example, Color type  is associated with 3 D color space identifiers ranging from X, Y, Zto X, Y, Z. In this example, the entries in color type  are all associated with the same Type  enhancement. This Type  enhancement could be a sharpening enhancement, a smoothing enhancement or any other type of enhancement to perform on input pixel and the associated pixel window. Colors identified as Color Type , Color Type  and Color Type  operate in a similar manner with respect to entries in the table diagram of .","Spatial CLUT  designed in accordance with the present invention is provide in  and correlates sharpening and smoothing type convolution filters with one or more different colors. In spatial CLUT  color groups  include dark colors, flesh tones, green colors and light colors. These colors in color groups  are associated respectively with 3 D color space identifiers  as illustrated in . Although these 3 D color space identifiers  appear in sequence, alternate implementations can also use color space entries that are out of sequence, follow different mathematical patterns or randomly entered into spatial CLUT .","In this example, dark colors and flesh tones from color groups  are associated with smooth enhancement operations . This is done to reduce the higher sensor noise typically found in the darker colors of images and, in the case of flesh tones, to reduce noise, artifacts and even blemishes sometimes found on the skin of people in images. In comparison, green colors in color group  are associated with sharpen enhancement  to increase the detail associated with portions of an image having shades of green. This is useful for bringing out the details of trees and other foliage and generally enhances an image. Separating the colors and enhancement operations in this manner keeps foliage and high-frequency detail portions of an image crisp and clear while not inadvertently sharpening artifacts and noise sometimes associated with people's faces and other areas with skin tone colors. As illustrated in , a neutral enhancement operation  is associated with and applied to light colors. Like the spatial CLUT in , the enhancement filter index  of 0.0 indicates a maximum smoothing enhancement, the enhancement filter index of 0.5 to indicate a no smoothing or sharpening and 1.0 to indicate application of a maximum sharpening operation on an input pixel and corresponding pixel window.",{"@attributes":{"id":"p-0041","num":"0040"},"figref":"FIG. 6","b":["604","602","608","610","612","614","616","602","604","606","618","620","622","624","626","604","602","604","602","604"]},{"@attributes":{"id":"p-0042","num":"0041"},"figref":"FIG. 7","b":["700","700","702","704","706","708","710","712","714"]},"Image processing apparatus  can included as part of a computer system or can be designed into one or more different types of peripheral equipment. In a computer system, image processing apparatus  receives graphics from an application and enhances the images in accordance with the present invention. Software and controls used by image processing apparatus  may reside in the application, in device drivers, in the operating system or a combination of these areas depending on the implementation design requirements. Alternatively, if image processing apparatus  is part of a peripheral device like a printer or display, images could be enhanced without depending entirely on the processing requirements of a computer. This would enable, for example, a stand alone network attached image generation device to process and enhance image in accordance with the present invention without relying on the concurrent availability of a personal computer or similar computing device. For example, a network attached printer device could receive images over a network and process the images in accordance with the present invention. Implementations of the present invention could be installed or built into a single network attached peripheral device providing enhanced images without requiring upgrade of applications, operating system or computer devices throughout the network.","Primary memory  stores and retrieves several modules for execution and access under the control of processor . These modules include: a color detection and spatial CLUT , a color interpolation module , a pixel classification module (optional) , a pixel filtering module , an image presentation module  and a runtime module .","Color detection and spatial CLUT  receives an input pixel and pixel window for processing. Colors are detected and cross referenced to entries in the spatial CLUT to access enhancement operations or associations with enhancement operations. In one implementation, enhancement operations or algorithms are stored in a storage area within color detection and spatial CLUT . Alternatively, the entries in color detection and spatial CLUT  identifies enhancement operations stored elsewhere and these entries are used to influence or select the actual enhancement operations using different access methodologies.","Color interpolation module  can be invoked to identify the proper entry in the spatial CLUT for a particular input color. As described previously, some input colors cannot be matched with entries in the spatial CLUT; interpolating between existing entries in the spatial CLUT determines a viable alternative. In one embodiment, the interpolation method for selecting the entry in spatial CLUT is designed in accordance with U.S. Pat. No. 5,748,176 entitled \u201cMulti-variable colorimetric data access by iterative interpolation and subdivision\u201d.","Pixel classification module  is an optional module used in conjunction with spatial CLUT to identify a suitable enhancement operation for enhancing a portion or all of an image. For example, pixel classification module  can use gradient and mean average deviation calculations to classify pixels for sharpening and smoothing. Combining these determinations with interpolations and selections from entries in spatial CLUT may modify these filter enhancement selections and provide sharper green foliage and smoother skin tones in an image.","Pixel filtering module  applies the selected filters to the pixel or pixels from an image. The resulting pixels passing through pixel filtering module  are enhanced using enhancement operations in accordance with one implementation of the present invention. Image presentation module  sends a block or stream of image data over bus  including the enhanced pixels and onto image generation device for display, printing or other visual representation. Additional functions in image presentation module may include data buffering, compression, encryption and other image processing operations. Run-time module  can be a real-time executive or operating system or conventional preemptive operating system that coordinates the allocation of resources, operation and processing on image processing device .","Image driver  interfaces with one or more different types of image generation devices providing signal and protocol level communication suitable for communication with the particular device.","Processor  can be a general purpose processor that executes x86 instructions or similar general purpose instructions. Alternatively, processor  can be an embedded processor that executes instructions burned into ROM or microcode depending on the implementation requirements.","Program memory  provides additional memory for storing or processing instructions used by processor . This area may operate as a primary area to execute instructions or as an additional cache area for storing frequently used instructions or macro-type routines.","Network communication port  provides network connectivity directly with image processing device . This port can provide high-speed network access using protocols like TCP\/IP or can provide dial-up serial access over a modem link using serial network protocols like PPP, SLIP or similar types of communication for communication or diagnostics purposes.","Secondary storage  is suitable for storing executable computer programs, including programs embodying the present invention, and data used by the present invention. This area can be a traditional memory or solid-state memory storage.","Input\/output (I\/O) ports  are coupled to image processing device  through bus . Input\/output ports  facilitate the receipt and transmission of data (e.g., text, images, videos, and animations) in analog or digital form over other types of communication links such as a serial link, local area network, wireless link, and parallel link. Input\/output (I\/O) ports  facilitate communication with a wide variety of peripheral devices including keyboards, pointing devices (mouse, touchpad and touchscreen) and printers. Alternatively, separate connections (separate buses) can be used to interface with these peripheral devices using a combination of Small Computer Systems Interface (SCSI), Universal Serial Bus (USB), IEEE 1394\/Firewire, Personal Computer Memory Card International Association (PCMCIA) or any other suitable protocol.","In practice, the invention can be implemented in digital electronic circuitry, or in computer hardware, firmware, software, or in combinations of them. Apparatus of the invention can be implemented in a computer program product tangibly embodied in a machine-readable storage device for execution by a programmable processor; and method steps of the invention can be performed by a programmable processor executing a program of instructions to perform functions of the invention by operating on input data and generating output. The invention can be implemented advantageously in one or more computer programs that are executable on a programmable system including at least one programmable processor coupled to receive data and instructions from, and to transmit data and instructions to, a data storage system, at least one input device, and at least one output device. Each computer program can be implemented in a high-level procedural or object-oriented programming language, or in assembly or machine language if desired; and in any case, the language can be a compiled or interpreted language. Suitable processors include, by way of example, both general and special purpose microprocessors. Generally, a processor will receive instructions and data from a read-only memory and\/or a random access memory. Generally, a computer will include one or more mass storage devices for storing data files; such devices include magnetic disks, such as internal hard disks and removable disks; magneto-optical disks; and optical disks. Storage devices suitable for tangibly embodying computer program instructions and data include all forms of non-volatile memory, including by way of example semiconductor memory devices, such as EPROM, EEPROM, and flash memory devices; magnetic disks such as internal hard disks and removable disks; magneto-optical disks; and CD-ROM disks. Any of the foregoing can be supplemented by, or incorporated in, ASICs (application-specific integrated circuits).","While specific embodiments have been described herein for purposes of illustration, various modifications may be made without departing from the spirit and scope of the invention. Accordingly, the invention is not limited to the above-described implementations, but instead is defined by the appended claims in light of their full scope of equivalents."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 7"}]},"DETDESC":[{},{}]}
