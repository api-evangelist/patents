---
title: Image forming apparatus and control method therefor
abstract: This invention discloses an image forming apparatus having an image reading function that can correct the density even when an image is formed based on data acquired from an apparatus other than an image reading apparatus, and a control method therefor. A printer controller () includes a PG unit () for generating a pattern having a predetermined density. The pattern is transmitted to an engine controller () via an output I/F to obtain a print result. Correction data representing the difference between a result obtained by reading the print result and a predetermined characteristic is received from a reader controller via a serial communication controller (). The correction data is stored in a data correction unit () and used for printing data subsequently received via an input I/F.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07075664&OS=07075664&RS=07075664
owner: Canon Kabushiki Kaisha
number: 07075664
owner_city: Tokyo
owner_country: JP
publication_date: 20010302
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS"],"p":["The present invention relates to an image forming apparatus such as a copying machine having an image reading function and a control method therefor.","Copying machines, and image forming systems using image reading and forming apparatuses have conventionally been used. Such a machine or system is designed to obtain an exact copy of an original. For this purpose, it is important to adjust the density when read image data is output by the image forming apparatus.","For example, a known copying machine corrects the image density by printing a specific pattern on a printing sheet by a printer, reading the pattern by an image reader, comparing the actually read value with a reference value, and correcting the density.","Density correction is, however, effective only when an image is formed on the basis of image data obtained by using the image reading apparatus, i.e., when the copying machine is used. This density correction is not suitable when an image is formed by using image data acquired without using the image reading apparatus or printing data such as PDL (Page Description Language), e.g., when a network-connectable copying machine is used as a printer from a computer on a network.","The present invention has been made to overcome the conventional drawbacks, and has as its object to provide an image forming apparatus having an image reading function that can appropriately correct the density even when an image is formed based on data acquired from an apparatus other than an image reading apparatus, and a control method therefor.","According to a gist of the present invention, there is provided an image forming apparatus comprising image forming means for forming an image on the basis of print data and outputting the image, first print data generation means for generating the print data from original image data read by image reading means, and second print data generation means which generates the print data on the basis of printing data received from a device other than the image reading means, and can communicate with the first print data generation means, characterized in that the first print data generation means includes communication means capable of transmitting, to the second print data generation means, either of the original image data read by the image reading means, and correction data based on the original image data read by the image reading means and predetermined data, and the second print data generation means includes test data generation means for generating test print data, and correction means for performing predetermined correction for subsequently received printing data or the print data generated based on the printing data, on the basis of the original image data and predetermined data from the communication means or on the basis of the correction data.","According to another gist of the present invention, there is provided a method of controlling an image forming apparatus having image forming means for forming an image on the basis of print data and outputting the image, first print data generation means for generating the print data from original image data read by image reading means, and second print data generation means which generates the print data on the basis of printing data received from a device other than the image reading means, and can communicate with the first print data generation means, characterized by comprising the communication step of generating original image data read by the image reading means, or correction data based on the original image data read by the image reading means and predetermined data, and transmitting the original image data or correction data to the second print data generation means, and the correction step of causing the second print data generation means to perform predetermined correction for subsequently received printing data or the print data generated based on printing data, on the basis of the original image data and predetermined data or the correction data transmitted in the communication step.","According to still another gist of the present invention, there is provided a storage medium which stores a control program for an image forming apparatus having image forming means for forming an image on the basis of print data and outputting the image, first print data generation means for generating the print data from original image data read by image reading means, and second print data generation means which generates the print data on the basis of printing data received from a device other than the image reading means, and can communicate with the first print data generation means, characterized by comprising a program code of the communication step of generating original image data read by the image reading means, or correction data based on the original image data read by the image reading means and predetermined data, and transmitting the original image data or correction data to the second print data generation means, and a program code of the correction step of causing the second print data generation means to perform predetermined correction for subsequently received printing data or the print data generated based on printing data, on the basis of the original image data and predetermined data or the correction data transmitted in the communication step.","Other features and advantages of the present invention will be apparent from the following description taken in conjunction with the accompanying drawings, in which like reference characters designate the same or similar parts throughout the figures thereof.","Preferred embodiments of the present invention will now be described in detail in accordance with the accompanying drawings.","[Overall Arrangement]","The overall arrangement will be described.  are block diagrams showing the positioning of a printer as a basic function of an image processing apparatus in the overall arrangement. Reference numeral  denotes a video I\/F which communicates with a printer  and printer controller  (to be described later). Details of I\/F signals will be explained. The printer  forms an electrical image signal received via the I\/F  into a visible image by using toner or the like, transfers the image onto a printing sheet, and fixes and outputs the image. To implement the image formation sequence, the printer  controls various loads. Further, the printer  detects the printer status and notifies the printer controller of the status.","The printer controller  receives data sent via a host computer  () or a network  (). Data are sent in various formats as bitmap data and PDL (Page Description Language) data. The printer controller  rasterizes data in a memory and transfers the data as raster data to the printer . In this manner, data created by the host computer can be output from the printer. The printer controller and printer are separately illustrated in  for convenience, but the printer controller may be inside the printer, which is popular in an actual arrangement.",{"@attributes":{"id":"p-0042","num":"0041"},"figref":["FIG. 2","FIG. 2","FIGS. 1A and 1B","FIG. 2","FIG. 1A"],"b":["2001","2002","2003","2103","2001","2104","2103","2105","2004","2005","2006"]},"[Arrangements of Printer Controller and Printer]","The present invention relates to an image processing apparatus with a composite function obtained when a module is mounted in the basic structure to add a function. The arrangements of the printer controller and printer will be explained as the premise of the image processing apparatus.","The video I\/F  connecting the printer controller and printer will be described in detail.  is a block diagram for explaining representative signals exchanged between the engine controller  and the printer controller  in .",{"@attributes":{"id":"p-0045","num":"0044"},"figref":["FIG. 4","FIG. 3"]},"A \/PPRDY signal  represents that the printer is turned on, processing such as initial setting ends, and communication with the printer controller is enabled.","A \/CPRDY signal  represents that the printer controller is turned on, processing such as initial setting ends, and communication with the engine controller is enabled.","A \/RDY signal  represents that the engine controller receives a print start instruction (\/PRNT signal to be described below) from the printer controller and enables print operation. This signal becomes true when each portion of the printer normally operates, e.g., the internal temperature of a fixing unit reaches a predetermined temperature, no printing sheet remains in the printer, or a polygon mirror rotates at a predetermined speed.","A \/PRNT signal  is used by the printer controller to instruct the engine controller to start or continue print operation.","A \/TOP signal  is a sync signal serving as the reference of vertical image scanning that is transferred from the engine controller to the printer controller. This signal is output a predetermined time after the signal  is output from the printer controller.","A \/LSYNC signal  is a sync signal used as the reference of horizontal scanning by the printer controller. Similar to the \/TOP signal, the \/LSYNC signal  is output a predetermined time after the signal  is output from the printer controller.","A \/VCLK signal  is a sync clock for \/VDOEN and \/VDO signals (to be described below), and causes the printer controller to output a clock having a frequency corresponding to an image signal.","A \/VDOEN signal  is for controlling input of an image signal from the printer controller to the engine controller. The engine controller detects whether the signal  is true\/false in synchronism with the \/VCLK signal, receives the signal  if it is true, and does not receive the signal  if it is false.","A \/VDO signal  is image data. The printer controller outputs the \/VDO signal  in synchronism with the \/VCLK signal by using as a reference the \/TOP signal for the vertical direction or the \/LSYNC signal for the horizontal direction.","A \/CCLK signal  is a sync clock when the printer controller transmits a serial command to the engine controller and the engine controller sends back a serial status to the printer controller. The \/CCLK signal  is output from the printer controller.","A \/CBSY signal  represents to the engine controller that the printer controller transmits a serial command by using a \/CMD signal (to be described below).","A \/CMD signal  is used by the printer controller in transmitting serial information to the engine controller. Serial information will be referred to as a command.","A \/SBSY signal  represents to the printer controller that the engine controller sends back a serial status by using a \/STS signal.","A \/STS signal  is used by the engine controller in sending back serial information to the printer controller. Serial information will be referred to as a status.","A \/CCRT signal  notifies the printer controller that the internal status of the printer changed. Upon reception of this notification signal, the printer controller uses the \/CMD signal to issue a command of inquiring a portion changed in status on the engine side. In response to this, the engine controller uses the \/STS signal to notify the printer controller of the status.","The printer controlled by the engine controller will be described with reference to .  is a sectional view schematically showing a printer mechanism and printing medium convey path. An electrophotographic color printer is exemplified in .","Reference numeral  denotes a scanner which receives an image signal (\/VDO) sent from the printer controller (not shown), irradiates a photosensitive body  with a laser beam corresponding to the image signal, and forms a charged image on the photosensitive body. The photosensitive body  rotates counterclockwise and reaches a black developing unit  or color developing unit . The developing units  and  apply toners (develop) to the photosensitive body in accordance with electric charges on the photosensitive body. Only the black developing unit  operates for a monochrome image, whereas both the developing units  and  are sequentially used for a color image. The toner image formed on the photosensitive body is transferred to an intermediate transfer body  which is in contact with the photosensitive body  and rotates clockwise. This intermediate transfer body is rotated once for a monochrome image, and four times for a color image, thereby transferring the monochrome or color image on the intermediate transfer body.","A printing medium such as a printing sheet fed from an upper cassette  or lower cassette  via a pickup roller  or  is conveyed by feed rollers  or , and further conveyed up to registration rollers  by a convey roller . To convey a printing sheet from a manual feed unit, the printing sheet is conveyed up to the registration rollers  by a convey roller .","The registration rollers  convey the printing sheet such that the printing sheet reaches the position between the intermediate transfer body and a transfer belt  at a timing when formation of a toner image on the intermediate transfer body  ends. When the printing sheet reaches this position, the transfer belt comes into contact with the intermediate transfer body via the printing sheet, and the toner image formed on the intermediate transfer body  is transferred to the printing sheet. The image transferred to the printing sheet is fixed to the printing sheet by the heat and pressure of fixing rollers .","The image-bearing printing sheet is conveyed to and delivered from either a faceup delivery port  or facedown delivery port  designated by the printer controller in advance. For two-sided printing, the printing sheet undergoes print processing again via a convey path . As a result, image information sent from the printer controller can be output.",{"@attributes":{"id":"p-0066","num":"0065"},"figref":["FIG. 6","FIG. 6"]},"When preparations for image information are completed, the printer controller sets the \/PRNT signal to low (true) and notifies the engine controller of the completion of preparations. At the same time, the printer controller generates an image sync signal \/VCLK used to transfer an image signal.","In response to this, the engine controller performs necessary processing such as various settings in the printer, and when reception of an image signal becomes possible, outputs the vertical sync signal \/TOP and horizontal sync signal \/LSYNC to the printer controller.","The printer controller transfers the image signal \/VDO and image valid signal \/VDOEN to the engine controller in response to the received \/TOP signal and \/LSYNC signal. The series of processes are repeated to perform entire printing.","Exchange of a command and status between the printer controller and the engine controller during print operation will be explained.  is shows communication timings between the printer controller and the engine controller. Communication is serial.","A case wherein the \/CCRT signal on the lowest stage is not used will be described. To issue (transmit) a command to the engine controller, the printer controller sets the \/CBSY signal to low (true) and sends command data on the \/CMD signal in synchronism with the clock signal \/CCLK. The engine controller having received the data checks whether the \/CBSY signal is high (false), changes the \/SBSY signal to low (true), and sends back engine-side status data corresponding to the command on the status signal \/STS in synchronism with the \/CCLK signal generated from the printer controller. The printer controller receives the status data, and continues or stops print control in accordance with the status.","A case wherein the \/CCRT signal is used will be described. This signal changes to low (true) when the status on the engine side designated by the printer controller in advance changes. Assume that the printer controller sets by the signal \/CMD that the \/CCRT signal is enabled when sheets run out, that the number of remaining printing sheets is only one, and that the printer controller requests two printouts. Print sequence operation is normally processed for the first printout, but no second printing sheet exists. Thus, when formation of the second image starts, the printer engine detects a change in status and changes the \/CCRT signal from high to low. This signal is transmitted to the printer controller. Immediately upon detecting this, the printer controller issues to the engine controller a command of requesting the sheet presence\/absence status of a sheet feed unit in order to detect which sheet cassette is out of sheets. In accordance with this command, the engine controller sends back the status of out-of-sheet cassette to the controller. The \/CCRT signal is cleared to high at a timing when the status-sending \/SBSY signal changes to low.","Detailed print operation will be explained with reference to  showing exchange of a command and status between the printer controller and the engine controller.  shows a case wherein a color output is done.","Upon reception of a print start request from the host computer or the like, the printer controller checks a printer ready status with respect to the engine controller while performing conversion processing or the like for image data to be printed. When receiving the ready status from the engine controller, the printer controller designates the lower cassette in  in which a command of designating the sheet feed stage of printing sheets is issued. The engine controller sends back a sheet feed status with respect to the cassette designation. Then, the controller issues a command of requesting information about the size of printing sheets in the designate cassettes, and the engine controller responds to this.","After sheet feed information is exchanged, the printer controller issues a deliver FU designation command of designating a delivery port, and the engine controller sends back the status of the designated delivery port. A page mode designation command of designating the number of pages of images to be formed and a monochrome\/color designation command are issued, and responses to these commands are repeated, thereby completing all the settings on the printer side.","After the printer is set, the printer controller generates a print request to the engine controller (changes \/PRNT to true), and generates a clock signal (\/VCLK). The engine controller waits for a predetermined time after the \/PRNT signal becomes true, and outputs the \/TOP signal and horizontal sync signal (\/LSYNC). Upon reception of the \/TOP signal, the printer controller counts the \/LSYNC signal for a predetermined time, and transfers an image signal (\/VDO) to the engine controller in synchronism with the \/VCLK signal while synchronizing the vertical scanning direction with the \/TOP signal and the horizontal scanning direction with the \/LSYNC signal. In this case, a color mode is set, and data transfer processing is repeated until images of four, C, M, Y, and K colors are formed and processing of one page ends.","The printer controller returns the \/PRNT signal to high (false) after receiving the final \/TOP signal. The engine controller detects the end of the print request by confirming the status (false) of the \/PRNT signal at the end timing of image formation processing. Then, the engine controller shifts to post-processing such as cleaning operation of the intermediate transfer body. A printing sheet bearing a toner image after print processing passes through the fixing rollers and is delivered from a designated delivery port. The printer controller issues a print status request to the engine controller. After confirming a response representing no printing sheet convey status (end of deliver) from the engine controller, the printer controller changes to a print end status upon a predetermined wait time, and stands by in a ready status until the next print request is generated.","If an illegal status such as jam of a printing sheet, the absence of printing sheets, or door open operation by the user is generated during the above operation, the engine controller uses the \/CCRT signal or the like to immediately notify the printer controller of the printer abnormality. The printer controller executes remedy processing.","Processing between the printer controller and the engine controller has been described.","[Arrangement when Reader Controller is Mounted]",{"@attributes":{"id":"p-0080","num":"0079"},"figref":"FIG. 9"},"Reference numeral  denotes an original feeder for conveying an original to an optical reading unit; , an optical reader; and , an original glass table of the optical reader. The original feeder  operates in synchronism with the optical reader . When the original feeder  feeds an original onto the original glass table , the reading unit incorporated in the optical reader  scans the image while moving in the right-and-left direction in , and emits reflected light having undergone proper optical processing to a photoelectric converter . Reference numeral  denotes a printer main body.",{"@attributes":{"id":"p-0082","num":"0081"},"figref":["FIG. 10","FIG. 9","FIG. 2","FIG. 10","FIG. 2"]},"In , reference numeral  denotes a reader frame; , an original table; , a light source; , a photoelectric conversion means; , an A\/D conversion means; , a reader controller; , the printer main body; , the engine controller for controlling sheet convey and image formation of the printer; , the image forming unit; , the printer controller incorporated in the printer main body ; , the host computer connected to the printer controller  in one-to-one correspondence or via the network ; , the sheet cassette deck which can be added as an option; , the sorter which can be added as an option; and , the option controller for controlling the optional cassette deck and optional sorter.","The reader controller  has a means for processing a digital image output from the A\/D conversion means, a motor control means (not shown) for reading an image, and a function of controlling communication with the engine controller  and printer controller . In the present invention, the reader controller  is arranged in the printer main body  so as not to use an external cable for controlling communication with the engine controller  and printer controller .",{"@attributes":{"id":"p-0085","num":"0084"},"figref":["FIG. 11","FIG. 10","FIG. 11","FIG. 11","FIG. 11"],"b":["2103","2002","2501","106","2002","2201","106","2501","2201","106"]},{"@attributes":{"id":"p-0086","num":"0085"},"figref":["FIG. 12","FIG. 10","FIG. 3","FIG. 3"],"b":["106","2103","2002","2103","106","2002","106","2103","106","2002","106","2103","106","106"]},"Reference numeral  denotes an image signal processing unit; , an original scan optical system control unit for controlling the optical reader  in ; , an original feed control unit for controlling the original feeder ; , an operation unit; and , an image input unit. An image signal converted by the photoelectric converter  in the optical reader  is input from the image input unit  to the reader controller , and transferred to the internal image signal processing unit .","The arrangement of the reader controller will be explained in detail.  is a block diagram showing a portion associated with the printer controller and engine controller in the arrangement of the reader controller .","In , reference numeral  denotes the image signal processing unit shown in ; , the image input unit shown in ; , the selector for selecting either of an output from the image input unit  and a signal sent from the printer controller  and outputting the selected signal to the engine controller . Signal systems switched by the selector are three, image clock \/VCLK, image enable signal \/VDOEN, and image data \/VDO. Reference numeral  denotes a serial communication controller for communicating with the engine controller; , an I\/O port for exchanging signals for compensating for communication in the communication controller; and , an interrupt controller. The interrupt controller receives an image leading end request signal \/PTOP and printer status change signal \/PCCRT.","Reference numeral  denotes a serial communication controller for communicating with the printer controller; , an I\/O port for exchanging signals for compensating for communication in the communication controller; and  and , first and second gates for controlling whether to send to the printer controller a signal transmitted from the printer. The gates are controlled by an image leading end request signal \/TOP and line sync signal \/LSYNC. Reference numeral  denotes a control circuit which has a gate function and flag set function and controls a printer status change signal \/CCRT. Whether to transfer the printer status change signal \/PCCRT issued by the engine controller to the printer controller is controlled by opening\/closing the gate. By setting the flag, the printer status change signal \/CCCRT can be issued from the reader controller to the printer controller.","[Copying Operation]","An operation when a full-color original image is read and output from the image forming apparatus will be explained with reference to , , and . When a copying start key (not shown) on the operation unit  is pressed, the reader controller  recognizes the copying mode, closes the gates  and , turns off the control circuit , and sets the selector  so as to output a signal from the image signal processing unit .","The reader controller  checks the printer ready status signal \/PPRDY from the engine controller  via the I\/O port . The reader controller  performs various settings in the engine controller in the above-mentioned way by using the serial communication controller . In other words, the reader controller  sequentially issues a command of designating the sheet feed stage of printing sheets and a command of requesting the printing sheet size of the designated sheet feed stage. The engine controller sends back statuses corresponding to the series of commands.","The reader controller  determines a delivery port by a delivery port designation command and issues a page mode designation command of designating the number of pages of images to be formed. The reader controller  issues a command of designating monochrome\/color printing and ends all the settings on the printer side.","After the original feeder  feeds an original to the original table via the original feed control unit , the reader controller generates a print request \/PPRNT signal to the engine controller. In response to this, the engine controller sends back the \/PTOP signal after a predetermined time. The interrupt controller  which received the \/PTOP signal outputs an interrupt to a CPU , and the CPU  controls the optical system control unit  so as to operate the optical reader  in synchronism with the \/PTOP signal. A signal input from the photoelectric converter  to the image signal processing unit  is transferred as the \/PVDO signal to the engine controller in synchronism with the \/PVCLK signal while synchronizing the vertical scan direction with the \/PTOP signal and the horizontal scan direction with the \/PLSYNC signal. Since a color mode is set in this case, the optical reader  is operated four times, and images of four, C, M, Y, and K colors are formed with respect to four generated \/PTOP signals.","Upon reception of the final \/TOP signal, the printer controller returns the \/PRNT signal to high (false). The engine controller detects the end of the print request and shifts to post-processing such as cleaning operation of the intermediate transfer body. A printing sheet bearing a toner image after print processing passes through the fixing rollers and is delivered from a designated delivery port. The printer controller issues a print status request to the engine controller. After confirming a response representing no printing sheet convey status (end of deliver) from the engine controller, the printer controller changes to a print end status upon a predetermined wait time, and stands by in a ready status until the next print request is generated.","[Print Operation]","A method when an image from the printer controller is output (printed) from the image forming apparatus will be described. The reader controller  changes to a ready status when copying operation ends. At this time, the reader controller opens the gates  and  and turns off the control circuit  for the sake of print operation. The reader controller checks a printer ready status signal \/PRDY from the engine controller via the I\/O port . If the printer ready status signal \/PRDY is enabled, the reader controller  sets a printer ready status signal \/CRDY in the printer controller via the I\/O port .","The printer controller performs the same communication with the reader controller as conventional communication with the engine controller for the purpose of various settings. The reader controller communicates with the printer controller by using the serial communication controller . The reader controller interprets received data from the printer controller by using the CPU  and performs various settings with respect to the engine controller in accordance with the contents of the data. The reader controller communicates with the engine controller by using the serial communication controller . The engine controller sends back, to the reader controller, statuses corresponding to a series of commands issued from the reader controller, and the reader controller receives the statuses by using the serial communication controller . The received contents are interpreted by the CPU  and transmitted to the printer controller by using the serial communication controller .","The printer controller generates a print request \/CPRNT signal to the reader controller, and the reader controller which received this signal generates a print request \/PPRNT signal to the engine controller. In response to this, the engine controller sends back the \/PTOP signal after a predetermined time. Since the gate  is open, the \/PTOP signal directly reaches the printer controller as a \/CTOP signal. The printer controller transfers the \/CVDO signal to the reader controller in synchronism with the \/CLSYNC signal received via the gate controller  while synchronizing the vertical scan direction with the \/CTOP signal, i.e., in synchronism with the \/CVCLK signal while synchronizing the horizontal scanning direction with the \/PLSYNC signal. In the reader controller, the selector  is set to select a signal sent from the controller. The \/CVCLK, \/CVDOEN, and \/CVDO signals sent from the controller are respectively transmitted as \/PVCLK, \/PVDOEN, and \/PVDO to the engine controller.","[Difference Between Print Operation and Copying Operation]","The difference between print operation and copying operation will be described in terms of the image output timing.","A detailed description of the arrangement of the printer controller  will be omitted. The printer controller  incorporates an image memory where image data to be printed is prepared in advance. Only an electrical delay time is required until the printing data \/VDO can be output upon reception of the image leading end request signal \/TOP sent from the engine controller.","To the contrary, in the copying mode, an original is read to output image data, while the optical reader  is moved. As shown in , an acceleration time is required by changing the idle reader to a status in which the reader moves at a high original read speed. This time is, e.g., about several hundred ms. If the engine controller sends the image leading end request signal \/TOP in the copying mode at the same timing as a signal in the print mode, the image data \/VDO reaches the engine controller with a delay of several hundred ms in the copying mode. This time difference can be reduced by the following two methods.\n\n","In method 1, the arrangement of the reader controller  in  need not be changed, and the reader controller starts moving the original reader upon reception of the \/TOP signal in the copying mode. More specifically, the reader controller  sends \/TOP earlier in consideration of the delay of mechanical operation so as to make the moving start timing coincide with the read start timing in . In method 2, an arrangement shown in  is adopted. The arrangement in  is different from that in  in that a new signal \/RSTART is input to the interrupt controller  instead of the \/PTOP signal. This arrangement is effective because the image leading end request signal \/PTOP sent from the engine controller is necessary only when the printer controller executes print operation, and need not be input to the interrupt controller of the reader controller, and because the reader moving start request signal \/RSTART sent from the engine controller is necessary only in the copying mode and need not be sent to the printer controller. In the arrangement of , the engine controller sends the \/RSTART signal at a timing considering the operation delay of the original reader. This can reduce the time difference between the modes.","[Control for Setting Command]","As described above, the reader controller is connected between the printer controller and the engine controller. The printer controller and engine controller communicate with each other via the reader controller. The following description concerns an operation when the printer controller issues a setting command, e.g., sheet cassette change command to the printer while the reader controller reads and outputs an original image by using the optical system controller.","For descriptive convenience, a command issuing sequence when no reader controller is used, i.e., in the arrangement of  will be explained with reference to .  shows a processing sequence in the printer controller, and  shows a processing sequence in the engine controller.","The printer controller issues a sheet cassette change command (S) and waits for a response from the engine controller (S). Upon receiving the response, the printer controller determines whether the command was successfully executed (S), and ends the command issuing sequence. The engine controller waits for a command to be issued from the printer controller (S), and if a command is issued, checks the contents of the command (S). For the sheet cassette change command, the engine controller changes the sheet cassette (S), and if the sheet cassette was successfully changed, notifies the printer controller of the success of command execution (S). Then, the engine controller returns to the command wait status. For a command other than the sheet cassette change command, the engine controller performs processing corresponding to the command (S) and returns to the command wait status.","A processing sequence when the reader controller is added will be explained with reference to . Note that the printer controller and engine controller execute the same control as shown in .",{"@attributes":{"id":"p-0107","num":"0108"},"figref":["FIG. 17","FIG. 12"],"b":["2205","1901","1902"]},"For example, when the reader controller can issue a command to the engine controller in order to perform copying mode operation because there is no instruction in progress, the reader controller issues via a signal line \/PCMD the same command as the command sent from the printer controller by using the serial communication controller  (step S). The reader controller waits for a response to the issued command (S), and upon receiving a response representing that the command was normally executed, notifies the printer controller of the success of execution (S). If execution of the command fails, the reader controller performs predetermined error processing, e.g., reissues a command (S).","To the contrary, when copying operation is not normally executed if the reader controller directly issues the sheet cassette change command sent from the printer controller to the engine controller because, e.g., the reader controller designates a sheet cassette and executes copying operation, the reader controller does not issue any command to the engine controller, and stores the command in an engine command queue where commands issued from the printer controller to the engine controller are stored in the issuing order (S).","Since the reader controller has to send back a response to the command to the printer controller, the reader controller sends back a pseudo notification representing that the command was successfully executed, to the printer controller via a signal line \/CSTS by using the serial communication controller  (S).","Processing of a command stored in the engine command queue will be explained with reference to . If the reader controller changes to a status in which it can issue a command received from the printer controller to the engine controller without influencing the status of the reader controller (YES in S), the reader controller issues the oldest command stored in the engine command queue to the engine controller via the signal line \/PCMD by using the serial communication controller  (S), and waits for a response (S). Note that a command issued by the reader controller itself is also transmitted to the engine controller via the signal line \/PCMD.","After the engine controller completes execution of the command, the reader controller receives the response via the signal line \/PSTS (S). If execution succeeds, the reader controller deletes the successful command from the engine command queue (S). If execution of the command fails, the reader controller processes it as an error generation status (S).","In this way, when the reader controller is interposed between the printer controller and the engine controller, the command processing sequence can be achieved without any operational inconsistency in issuing a normal command from the printer controller to the engine controller.","[Control to Status Change Signal]","The following description concerns processing when the engine controller uses \/PCCRT to transmit to the reader controller that the status on the engine side changes, e.g., an error occurs when the reader controller is interposed between the printer controller and the engine controller.","When the reader controller is interposed, the type of printer status whose change is to be detected may be different between the reader controller and the printer controller. This occurs when, e.g., a sheet during conveyance jams.","If jam occurs while the engine performs copying operation under the control of the reader controller, only the reader controller wants to know this status. The printer controller cannot execute appropriate post-processing even if it knows this status because the jam does not occur during output from the printer controller.","If a control system identical to the reader controller is to be mounted in the printer controller, jam processing control software which should exist in one of the controllers is repetitively installed in the two controllers. This is very wasteful in terms of the number of design steps, quality evaluation, and software capacity.","It, therefore, suffices to notify the printer controller of a status change in the print mode and the reader controller of a status change in the copying mode. Even in the copying mode, however, the printer controller sometimes wants to receive an engine status change signal. For example, the printer controller must be notified of information about a change in cassette size or the absence of sheets. Such a change does not require a strict time until each controller performs processing after the engine controller issues a status change signal.","For this reason, the following processing is done. In the copying mode in which the reader controller controls the engine controller in the arrangement of , a status change signal \/PCCRT sent from the engine controller by using the control circuit  is not transmitted to the printer controller but received by only the reader controller via the interrupt controller .",{"@attributes":{"id":"p-0120","num":"0121"},"figref":"FIG. 19","b":["2101","2102","2103","2104","2105"]},"If the reader controller determines to notify the printer controller of the contents, the reader controller sets a flag by using the control circuit , generates a status change signal \/CCCRT, and notifies the printer controller of the contents (S). If the reader controller receives an inquiry about the status change signal (YES in S), it transmits to the printer controller the status change received from the engine controller as a status (S). After transmitting the status, the reader controller changes the status change signal \/CCCRT to false.","If the response from the engine controller represents a status change of which the printer controller need not be notified, the reader controller executes necessary processing (S) and does not notify the printer controller of this.","In the print mode in which the printer controller controls the engine controller, the gate of the control circuit  is open, as described above. Thus, the status change signal \/PCCRT sent from the engine controller is directly received as the status change signal \/CCCRT by the printer controller.","[Control to Execution Command]","Control of an execution command will be explained. Control of the reader controller when the printer controller and reader controller simultaneously issue use requests to the engine controller will be exemplified.",{"@attributes":{"id":"p-0125","num":"0126"},"figref":["FIG. 20","FIG. 8"],"b":["1301","106","1301"]},"If the printer controller issues a print request during copying operation, it is difficult in terms of the usability to execute print processing by interrupting copying operation. The print request in this situation suspends until copying operation ends.","However, a status \/CSTS with respect to a command \/CCMD from the printer controller must be sent back within a predetermined time. For this reason, only a set value requested by \/CCMD is stored in a printer controller (PDL) area of the buffer . When a set value for the reader is different from a set value for PDL, the reader controller sets the value in the engine controller before print operation starts after copying operation ends. This will be explained in detail with reference to .","Assume that the printer is in copying operation, a sheet is set to be fed from the upper cassette and delivered to a faceup delivery port, and the image formation mode is set to a color mode for a color original. When the printer controller issues a print request, execution of print operation itself suspends, but various settings can be done. Assume that set values upon issuing the print request represent that a sheet is fed from an upper cassette and delivered to a facedown delivery port and a monochrome image is output. In this case, the reader controller stores the set values by a command from the printer controller in a predetermined area of the buffer  (S) and sends back a status \/CSTS (S). After copying operation ends (YES in S), the reader controller compares a value set in copying operation with the set value requested by the printer controller for each set item in the buffer (S and S). If the set values are the same, they are not changed; if the set values are different, the reader controller issues a command \/PCMD and updates the set value before the start of print operation (S).","In this example, as for the sheet cassette, both the reader controller and printer controller designate the upper cassette. The reader controller need not issue any sheet cassette designation command when copying operation ends and is switched to print operation. As for the delivery port and image formation mode, different ports and modes are designated between copying operation and print operation. When copying operation ends, the reader controller issues a delivery port designation command and image formation mode designation command to the engine controller. This operation is repeated for all the setting items (S to S), and then processing ends.","The reader controller determines a command from the printer controller so as not only to suspend execution of a command to the engine controller but also to prevent repetitive setting of values which have already been set by the reader controller to the engine controller.","A case wherein a copying request is issued during print operation will be described with reference to . In this case, it is more preferable in terms of the usability in contrast to the case of  that copying operation interrupt print operation and be executed, than that a copying button is pressed in front of the copying machine but copying operation cannot be done owing to the progress of print operation.","In the print mode, as shown in , image data \/CVDO sent from the printer controller  is selected by the selector  and transmitted as \/PVDO to the engine controller . Assume that settings from the printer controller are the upper cassette, facedown delivery port, and monochrome image mode. The engine controller can detect the end only when a \/PPRN signal from the printer controller changes to high (false), and does not know the number of prints to be obtained. Assume that the printer is to print out four images. If the reader does not issue a copying operation request by an interrupt, the engine controller generates four \/PTOP signals at image timings as shown in , and images are sent from the printer controller to the engine controller via the reader controller  in accordance with the signals.","A processing timing when an interrupt copying request for one copy of a color original is generated in the reader controller while the second image is printed out will be explained with reference to . The reader controller issues a \/PPRNT request to the engine controller upon reception of a \/CPRNT request from the printer controller, and the engine controller supplies a \/PTOP signal as a \/CTOP signal to the printer controller via the reader controller. Then, print operation of first and second images  and  is executed.","A case wherein the reader controller issues an interrupt copying request while the second image is printed out will be described. The reader controller generates a \/CCCRT signal to the printer controller. This signal does not represent an actual change in engine status but requests the printer controller to free the engine in order to allow the reader to control the printer engine. The signal is generated by using the control circuit , as described above. The printer controller issues a command of checking the engine status with respect to the \/CCCRT signal, and the reader controller sends back a \u201ccopying-in-progress\u201d status to the printer controller with respect to the checking command.","In general, the printer controller generates a time-out error a predetermined time after no \/CTOP is supplied while \/CPRNT is kept low (true). However, the printer controller is set to cancel the time-out error and permanently wait for the \/CTOP signal when the printer controller receives the \u201ccopying-in-progress\u201d status. Hence, the printer controller detects that the engine is in copying operation, and waits for the \/CTOP signal while keeping the \/CPRNT signal to low (true).","Since the image formation mode changes to the copying mode, the reader controller switches the selector and gate so as not to transmit the \/PTOP signal from the engine controller to the printer controller (). The reader controller transmits the data received from the reader as image data \/PVDO to the engine controller (). After an interrupt copy is obtained ( shows one interrupt copy), the image formation mode changes to the print mode again. The reader controller cancels masking of the \/PTOP signal and sends it as \/CTOP to the printer controller. The printer controller resumes operation and transmits third and fourth image data  and  to the engine controller where the image data  and  can be printed out. Interrupt copying operation during print operation can be achieved in this fashion.","The reader controller determines and controls either of the printer controller and reader controller which is to control the printer engine, and the timing of issuing a command in accordance with the situation. This realizes requests from two controllers for one engine.","[Control to Set Content Confirmation Command]","Control when the printer controller issues a set content confirmation command will be explained.","When the printer controller is to confirm a status set in the engine controller, the printer controller issues a set content confirmation command via \/CCMD. The reader controller which has received this command checks an area of the set value storage buffer  (), which corresponds to the current mode. If the set value requested by the printer controller is found, the reader controller reads out the contents and notifies the printer controller of the contents via \/CSTS. If the printer controller requests a set value which is not in the buffer, the reader controller issues a set content confirmation command to the engine controller via \/PCMD. The engine controller reads out the contents and notifies the reader controller of the set contents via \/PSTS. The reader controller notifies the printer controller of the contents via \/CSTS.","[Density Correction Method]","A density adjustment method as a feature of the present invention will be described.","The density is adjusted to reduce variations in print density in the printer and obtain an output of a desired print density.","[Density Correction Processing in Copying]","Density correction processing when the above-described image forming apparatus is used as a copying machine will be explained.",{"@attributes":{"id":"p-0143","num":"0144"},"figref":"FIG. 24","b":["902","106"]},"In , the image input unit  transfers an image signal converted by the photoelectric converter  () such as a CCD sensor to the image signal processor. The image signal processing unit  comprises a shading correction unit  for correcting the profile of the image input unit , an input masking unit  for correcting the characteristics of the image input unit , an undercolor removal unit  for replacing cyan, magenta and yellow with black (K), a direct mapping unit  for performing correction suitable for the characteristics of an output unit (printer), a data sampling unit , an output \u03b3 unit , an output processing unit  for performing binarization processing or the like, and a PG (Pattern Generator) unit .","The density is corrected by the following procedures.","Image data representing a density pattern made up of a plurality of patches (small-area portions) with different densities is generated by the PG unit  and output on a printing sheet by the printer.",{"@attributes":{"id":"p-0147","num":"0148"},"figref":["FIG. 27","FIG. 27"],"b":"3009"},"This pattern output is placed on the original glass table  or original feeder  of the reader, and the pattern image is read. The read pattern data is supplied to the image signal processing unit  shown in  via the image input unit , and sampled by the data sampling unit . The sampling result is processed by the CPU  shown in .","The processing contents of the CPU  will be explained with reference to . The CPU  calculates the difference between digital data of the pattern formation density and an actual output density (or a value of image data obtained by reading it), and adjusts (corrects) the density so as to eliminate the difference.","For example, a pattern generated by the PG unit  has eight density levels with intervals of 32 from a density of 0 (in , a pattern is made up of seven types of density patches including a density of 0 (no data is printed)). A predetermined number of pixel data are sampled from each density patch on the basis of the difference from the read image data input to the data sampling unit . The CPU  calculates the sample average value for each density patch.","The sample average value (output value) for each density patch is plotted in correspondence with the value in input (input value), as represented by \u00b7 in . An ideal input\/output characteristic is determined in advance, and the density is corrected to eliminate the difference between the measured value and the ideal characteristic.","For example, a straight line b represents an input\/output characteristic attained by connecting measured values, and a straight line a represents an ideal input\/output characteristic determined in advance. In this case, an actual output density decreases in comparison with an ideal output density with respect to input digital data. To obtain an ideal density, a correction value is obtained for an input digital data value so as to eliminate the difference from the ideal characteristic, and a correction table is created. The created correction table is reflected on the output \u03b3 unit . The output \u03b3 unit  adds a corresponding correction value in the correction table in accordance with an input value, and outputs the sum. This correction processing attains an ideal output density.","[Density Correction Processing of PDL Data]","Density correction processing when the above-mentioned image forming apparatus is used as a printer will be described.  is a block diagram showing an arrangement concerning density correction processing in the printer controller .","In , reference numeral  denotes an input I\/F to an external device such as the host computer ; , a reception buffer; , an object generation unit for mapping data to a bitmap; , an object buffer; , a rendering unit for performing color processing; , a band buffer (output buffer); , an output I\/F to the engine controller ; , a data correction unit; , a dither processing unit; , a CPU; , a communication controller; and , a PG (Pattern Generator) unit.","Detailed correction processing will be explained.","Up to creation of a correction table, density correction processing is basically the same as in the case wherein the image forming apparatus is used as a copying machine.","More specifically, image data representing a pattern made up of a plurality of patches with different densities is generated by the PG unit  in the printer controller , and output by the printer via the engine controller .","The pattern output is placed on the original glass table  or original feeder  of the reader, and the pattern image is read. The subsequent processing is the same as density correction processing for a copied image, and a correction table is created. At this time, the ideal input\/output characteristic is the same as in copying. The created correction table is transmitted from the reader controller  to the printer controller  by using a communication means. That is, the serial communication controller  in the reader controller  is connected to the serial communication controller  in the printer controller . The contents of the correction table are transmitted to the printer controller  by using the two controllers.","The CPU  in the printer controller  sets the correction characteristic of the data correction unit  on the basis of the transmitted correction table. Accordingly, image data from the printer controller  can also undergo the same density correction as image data read from the reader.","Communication contents transmitted from the reader controller  to the printer controller  may be a correction table itself used by the data correction unit  of the printer controller . For example, correction table data of 256 levels for each of three colors (C, M, and Y) or four colors (C, M, Y, and K) are communicated.","The correction table can be generated in the printer controller . For example, when the ideal input\/output characteristic is different from that in copying, a correction table for eliminating the difference between the ideal input\/output characteristic and an input\/output characteristic held in the printer controller  can be generated. To generate a correction table in the printer controller , pattern image data read by the reader is directly transmitted from the reader controller  to the printer controller . In this case, it is also possible depending on the read resolution to sample a predetermined number of image data by the data sampling unit  for each of density patches for three or four colors and to transmit the sampled data.","Alternatively, only the difference between read pattern image data and an ideal output value may be transmitted. By exchanging information necessary for density correction by using the serial communication controllers, density correction can be easily performed for printing data received by the printer controller without adopting any special signal line between the reader controller and the printer controller.","[Other Embodiment]","In the above embodiment, data from an original, host computer, or the like is color data, and a color original reading apparatus is used. The above-described density adjustment processing can also be applied for monochrome data.","The present invention may be applied to a system constituted by a plurality of devices (e.g., a host computer, interface device, reader, and printer) or an apparatus comprising a single device (e.g., a copying machine or facsimile apparatus). For example, density adjustment processing of the present invention can be implemented even in a system in which a reader such as an image scanner is connected to a printer via a network or cable.","The object of the present invention is realized even by supplying a storage medium which stores software program codes for realizing the functions of the above-described embodiment to a system or apparatus, and causing the computer (or a CPU or MPU) of the system or apparatus to read out and execute the program codes stored in the storage medium.","In this case, the program codes read out from the storage medium realize the functions of the above-described embodiment, and the storage medium which stores the program codes constitutes the present invention.","As a storage medium for supplying the program codes, a floppy disk, hard disk, optical disk, magnetooptical disk, CD-ROM, CD-R, magnetic tape, nonvolatile memory card, ROM, or the like can be used.","The functions of the above-described embodiment are realized not only when the computer executes the readout program codes, but also when the OS (Operating System) running on the computer performs part or all of actual processing on the basis of the instructions of the program codes.","The functions of the above-described embodiment are also realized when the program codes read out from the storage medium are written in the memory of a function expansion board inserted into the computer or that of a function expansion unit connected to the computer, and the CPU of the function expansion board or function expansion unit performs part or all of actual processing on the basis of the instructions of the program codes.","When the present invention is applied to the storage medium, the storage medium stores program codes corresponding to at least one of the above-described flow charts.","As has been described above, the present invention can implement an image forming apparatus having an image reading function in which the density of even an image formed based on data acquired from an apparatus other than an image reading apparatus can be corrected by arranging a pattern generator for generating a predetermined pattern in a printer controller for receiving external printing data and by correcting the printing data on the basis of only the results of reading a pattern output, and a control method therefor.","Furthermore, the present invention can be applied to the system comprising either a plurality of units or a single unit. It is needless to say that the present invention can be applied to the case which can be attained by supplying programs which execute the process defined by the present system or invention.","As many apparently widely different embodiments of the present invention can be made without departing from the spirit and scope thereof, it is to be understood that the invention is not limited to the specific embodiments thereof except as defined in the appended claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The accompanying drawings, which are incorporated in and constitute a part of the specification, illustrate embodiments of the invention and, together with the description, serve to explain the principles of the invention.",{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIGS. 1A and 1B"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":["FIG. 3","FIG. 2"]},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":["FIG. 10","FIG. 9"]},{"@attributes":{"id":"p-0022","num":"0021"},"figref":["FIG. 11","FIG. 10"]},{"@attributes":{"id":"p-0023","num":"0022"},"figref":["FIG. 12","FIG. 10"]},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 15"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIGS. 16A and 16B"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 17"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 18"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 19"},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 20"},{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 21"},{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 22"},{"@attributes":{"id":"p-0034","num":"0033"},"figref":"FIG. 23"},{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 24"},{"@attributes":{"id":"p-0036","num":"0035"},"figref":"FIG. 25"},{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 26"},{"@attributes":{"id":"p-0038","num":"0037"},"figref":"FIG. 27"}]},"DETDESC":[{},{}]}
