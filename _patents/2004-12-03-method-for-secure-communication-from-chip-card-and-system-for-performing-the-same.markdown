---
title: Method for secure communication from chip card and system for performing the same
abstract: A method and system is provided to secure a data transmission from a chip card to an off-card entity. A transport key is generated at the off-card entity. The transport key is transmitted in a secure manner from the off-card entity to the chip card. At the chip card, the transport key is used to encrypt data to be sent from the chip card to the off-card entity. The data having been encrypted at the chip card using the transport key is then transmitted from the chip card to the off-card entity. The off-card entity is capable of decrypting the data received from the chip card through use of the transport key previously generated at the off-card entity.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07805611&OS=07805611&RS=07805611
owner: Oracle America, Inc.
number: 07805611
owner_city: Redwood City
owner_country: US
publication_date: 20041203
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"p":["A chip card is a card that includes a microprocessor and a memory. The microprocessor is capable of operating in accordance with program instructions stored in the memory on the chip card. In comparison with traditional magnetic stripe cards, chip cards provide increased memory for storing data and increased security of stored data. Chip cards can be used for a variety of applications, particularly applications that require manipulation of large numbers, such as applications involving cryptographic processes. Therefore, chip cards are well-suited for applications that require secure digital identity. For example, in one application a chip card can be used to provide secure access to a computing network.","Chip card standards have been developed to provide a common programming standard for use by different chip card manufacturers. The chip card standards are intended to facilitate chip card application portability between chip cards of different manufacturers. The \u201cGlobal Platform Open Platform Card Specification, Version 2.0.1,\u201d (\u201cOpen Platform Specification\u201d for ease of discussion) is a chip card standard that has been extensively adopted throughout the chip card industry. The Open Platform Specification provides a common security and chip card management architecture for protecting the chip card system infrastructure. The Open Platform Specification defines card components, command interfaces, transaction sequences, and common interfaces to enable creation of multi-application chip card systems.","The Open Platform Specification, particularly Version 2.0.1, defines a secure channel protocol to secure commands and data sent from an application process operating on an off-card entity, such as a server computer system, to a selected application operating on the chip card. In accordance with the Open Platform Specification, the secure channel is secured by using a shared secret. More specifically, a diversified master key unique to a particular chip card is used to mutually authenticate the server to the chip card and the chip card to the server. Also, the diversified master key is used to generate a session key that can be used to secure, i.e., encrypt, data being communicated from the off-card entity to the chip card. However, the Open Platform Specification, Version 2.0.1, does not provide for securing data communicated from the chip card to the off-card entity. Thus, a potential exists for man-in-the-middle attacks during data transmission from the chip card to the off-card entity.","In view of the foregoing, a solution is needed to provide for securing data communicated from the chip card to the off-card entity. Furthermore, the solution should be capable of being implemented on chip cards designed to comply with the Open Platform Specification, Version 2.0.1.","It should be appreciated that the present invention can be implemented in numerous ways, such as a process, an apparatus, a system, a device or a method on a computer readable medium. Several inventive embodiments of the present invention are described below.","In one embodiment, a method for securing a data transmission from a chip card to an off-card entity is disclosed. The method includes an operation for generating a transport key at the off-card entity. In another operation, the transport key is transmitted in a secure manner from the off-card entity to the chip card. An operation is also provided for using the transport key to encrypt data at the chip card to be sent from the chip card to the off-card entity. The method further includes an operation for transmitting the data having been encrypted using the transport key from the chip card to the off-card entity.","In another embodiment, a method for securing data transmitted from a chip card is disclosed, wherein the chip card is compliant with Global Platform Open Platform Specification, Version 2.0.1. The method includes an operation for establishing a secure channel between a back-end system and the chip card. The back-end system is then operated to generate a transport key at the back-end system. In another operation, the transport key is transmitted from the back-end system to the chip card using the secure channel. The method further includes an operation for extracting the transport key at the chip card. The chip card is then operated to use the extracted transport key to encrypt data to be transmitted from the chip card to the back-end system. Additionally, an operation is performed to transmit the encrypted data from the chip card to the back-end system. The transport key generated at the back-end system is used to decrypt the data having been transmitted from the chip card to the back-end system.","In another embodiment, a system for transmitting data between a chip card and an off-card entity is disclosed. The system includes a server computer system defined to execute an application for generating a transport key. The system also includes a chip card reader connected to communicate with the server computer system. The system further includes a chip card connected to communicate with the chip card reader. The chip card is capable of communicating with the server through the chip card reader by way of a secure channel. Using the secure channel, the chip card is defined to receive the transport key from the server computer system. The chip card is further defined to execute an application that directs use of the transport key to encrypt data to be communicated from the chip card to the server computer system.","Other aspects of the invention will become apparent from the following detailed description, taken in conjunction with the accompanying drawings, illustrating by way of example the principles of the invention.","In the following description, numerous specific details are set forth in order to provide a thorough understanding of the present invention. It will be apparent, however, to one skilled in the art that the present invention may be practiced without some or all of these specific details. In other instances, well known process operations have not been described in detail in order not to unnecessarily obscure the present invention.","It should be appreciated that the present invention can be implemented in numerous ways, including as a process, an apparatus, a system, a device, or a method. Several exemplary embodiments of the invention will now be described in detail with reference to the accompanying drawings.",{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 1","b":["105","103","101","105","103","111","103","101","109","103","105","101","105","107","113","107","105","105","105","101","105"]},{"@attributes":{"id":"p-0018","num":"0017"},"figref":["FIG. 2","FIG. 1"],"b":["105","101","215","105","101","105","101","215","105","101","105","101","101","105","101"]},"In accordance with the present invention, the server  is defined to execute an application A for generating a transport key . The server  is configured to store the generated transport key  in a memory location on the server . The application A is capable of writing\/reading the transport key  to\/from the memory location on the server  as indicated by arrow . In one embodiment, the transport key  is generated upon establishment of a secure session between the server  and the chip card , wherein establishment of the secure session is associated with establishment of the secure channel . In one embodiment, the transport key  is generated using a session key that is generated upon establishment of the secure session. It should be appreciated that the session key for a particular secure session is unique. Therefore, in this embodiment, the transport key  generated from the session key will be unique for each secure session. Having a unique transport key  for each secure session serves to reduce the risk of replay attacks on data encrypted using the transport key.","The application A is further defined to transmit the transport key  to the chip card  via the secure channel , as indicated by arrow . The transmission including the transport key  can be encrypted to protect the data in the transmission as well as the transport key . In one embodiment, the transport key  is embedded in a payload portion of a transmission packet sent from the server  to the chip card . The chip card  is equipped with a memory capable of storing the received transmission packet data including the transport key . Also, the chip card  is defined to execute an application B for extracting the transport key  from the received transmission packet and utilizing the transport key  to encrypt data. The application B on the chip card  and the application A on the server  are counterpart applications that include a common understanding of how the transport key  is generated, transmitted, extracted, and utilized.","Once the transport key  is extracted from the transmission packet received at chip card , the transport key  can be stored in the memory resident on the chip card . The application B is capable of acquiring the transport key , as indicated by arrow . Then, using the transport key , the application B is capable of encrypting data to be transmitted from the chip card  to the server . With respect to , transport key-encrypted data  is shown to be a product of the application B, as indicated by arrow . Once generated, the transport key-encrypted data  can be transmitted from the chip card  to the server , as indicated by arrow . It should be appreciated that use of the transport key  to encrypt the data to be transmitted to the server  from the chip card  serves to protect the data. Thus, transmission of the transport key-encrypted data from the chip card  to the server  can be conducted using essentially any transport mechanism, including a non-secure uplink channel, without exposing the data.","Upon receipt at the server , the transport key-encrypted data  can be passed to the application A for processing, as indicated by arrow . The application A is capable of directing the server  to acquire the transport key  from memory and use the transport key  to decrypt the transport key-encrypted data . With respect to , decrypted data  is shown to be a product of the application A, as indicated by arrow .","In accordance with the foregoing description, the transport key  serves as a shared secret between the server  and the chip card  to enable encryption of data to be communicated from the chip card  to the server . It should be understood that as opposed to the \u201cGlobal Platform Open Platform Specification, Version 2.0.1\u201d the present invention provides for secure communication of data in the direction initiating at the chip card  and terminating the server . Thus, the present invention enables secure two-way communication in the context of the \u201cGlobal Platform Open Platform Specification, Version 2.0.1.\u201d","Though, the present invention as described can be implemented with essentially any Open Platform Specification compliant chip card , a particular embodiment exists in which the chip card  is defined as a JAVA\u2122 Card. In this embodiment, the JAVA\u2122 Card is defined to be compliant with JAVA\u2122 Card Enterprise Software. Thus, the application B resident on the JAVA\u2122 Card, i.e., chip card , can be defined as an applet. Also, during the JAVA\u2122 Card provisioning process, the JAVA\u2122 Card system extracts Public Key Interface (PKI) credentials from the JAVA\u2122 Card to use and\/or store in the back-end, i.e., the server . Consequently, the PKI credentials are known to both the server  and the chip card . Therefore, extraction of the PKI credentials enables the server  to encrypt the transmission including the transport key  such that the system is not subject to snooping or man-in-the-middle attacks.","In addition to the transport key  used to protect data to be transmitted from the chip card  to the server , the principles of the present invention can also be used to protect a message authentication code (MAC) to be transmitted from the chip card  to the server . For example, the applications A and B on the server  and chip card , respectively, can each include a capability and understanding of how to generate, transmit, extract, and utilize a MAC transport key. The MAC transport key is analogous to the transport key  as previously discussed. However, the MAC transport key is used to encrypt MAC data to be transmitted from the chip card  to the server , whereas the transport key  is used to encrypt payload data to be transmitted from the chip card  to the server . Use of the transport key  and the MAC transport key can be conducted in a simultaneous manner, i.e., communicated in the same transmission packet.","In one embodiment, the MAC transport key is embedded within a MAC portion of the transmission packet, and the transport key  is embedded in the payload portion of the transmission packet. The application B includes knowledge necessary to how to extract each of the MAC transport key and the transport key  from the transmission packet. Thus, in one embodiment, the server  is defined to generate the MAC transport key and transmit the MAC transport key to the chip card . The chip card  is defined to use the MAC transport key to encrypt MAC data to be transmitted from the chip card  to the server . The chip card  is further defined to transmit the encrypted MAC data to the server . Once the encrypted MAC data is received at the server , the application A is capable of decrypting the MAC data using the MAC transport key.",{"@attributes":{"id":"p-0027","num":"0026"},"figref":["FIG. 3","FIG. 3"]},"The method includes an operation  for generating a transport key at the off-card entity. In one embodiment, the transport key is a triple data encryption standard (triple-DES) transport key. In an operation , the transport key is transmitted from the off-card entity to the chip card in a secure manner. For example, considering the chip card and off-card entity are compliant with the Open Platform Specification, a mutual authentication process can be performed between the off-card entity and the chip card to establish a secure channel between the off-card entity and the chip card. Then, the established secure channel can be used to transmit the transport key from the off-card entity to the chip card. Also, in one embodiment, the transport key can be included in a payload portion of an application data protocol unit (APDU) command when transmitted from the off-card entity to the chip card. Furthermore, in another embodiment, a session key generated upon establishment of the secure channel can be used to encrypt the transport key prior to transmitting the transport key from the off-card entity to the chip card.","The method further includes an operation  for using the transport key at the chip card to encrypt data to be sent from the chip card to the off-card entity. In the embodiment wherein the chip card is compliant with the Open Platform Specification, the chip card can execute a DES_CBC_NOPAD command to use the transport key to encrypt data to be sent to the off-card entity. In the embodiment wherein the transport key is encrypted using the session key associated with establishment of the secure channel, it should be appreciated that the chip card can use its knowledge of the session key to decrypt the transport key, thus enabling use of the transport key for encryption of the data at the chip card.","The method also includes an operation  in which the data having been encrypted at the chip card using the transport key is transmitted from the chip card to the off-card entity. Transmission of the transport key-encrypted data from the chip card to the off-card entity can be performed using a non-secure uplink channel, without causing public exposure of the data represented by the transport key-encrypted data. Once the off-card entity receives the transport key-encrypted data from the chip card, the off-card entity can use its knowledge of the transport key to decrypt the transport key-encrypted data.","The method of  is described above with respect to generation and use of a transport key to protect data to be transmitted from the chip card to the off-card entity. Often the data to be transmitted from the chip card to the off-card entity is accompanied by a message authentication code (MAC). In the event that it becomes desirable to protect the MAC, the same method as described above with respect to  can also be utilized to protect the MAC. More specifically, a MAC transport key can be generated and used to encrypt the MAC at the chip card. Additionally, the method of  can be implemented in a dual manner to simultaneously protect both the data and the MAC to be transmitted from the chip card to the off-card entity. Thus, both the transport key and the MAC transport key can be generated and used to protect the data and the MAC, respectively. In one embodiment, transmission of the transport key and MAC transport key from the off-card entity to the chip card can be performed by embedding the transport key within a payload portion of a transmission packet and the MAC transport key within the MAC portion of the transmission packet.",{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 4","b":["401","403"]},"The method further includes an operation  for transmitting the transport key from the back-end system to the chip card using the secure channel. In one embodiment, the transport key is included in a payload portion of an APDU command when transmitted from the back-end system to the chip card. Also, in another embodiment, a session key associated with the secure session can be used to encrypt the transport key prior to transmission of the transport key from the back-end system to the chip card.","Once the transmission including the transport key is received at the chip card from the back-end system, the method includes an operation  for extracting the transport key at the chip card. If the transport key has been encrypted using the session key, the chip card is capable of decrypting the transport key using its knowledge of the session key obtained upon establishment of the secure session. The method further includes an operation  for operating the chip card to use the extracted transport key to encrypt data to be transmitted from the chip card to the back-end system. In an operation , the transport key-encrypted data is transmitted from the chip card to the back-end system. In one embodiment, transmission of the encrypted data from the chip card to the back-end system can be performed using a non-secure uplink channel without compromising the security of the transport key-encrypted data. Additionally, the method includes an operation  for using the transport key previously generated at the back-end system to decrypt the data received at the back-end system from the chip card.","In one embodiment, the chip card in the method of  is a JAVA\u2122 Card compliant with JAVA\u2122 Card Enterprise Software. In this embodiment, the extraction of the transport key at the chip card, i.e., JAVA\u2122 Card, can be directed by an applet executing on the JAVA\u2122 Card. Also in this embodiment, operation of the JAVA\u2122 Card to use the extracted transport key for encrypting data to be transmitted from the JAVA\u2122 Card to the back-end system can be directed by the applet executing on the JAVA\u2122 Card.","In a manner similar to the method of , the method of  can be used in conjunction with transmission of data that is accompanied by a MAC. In the event that it becomes desirable to protect the MAC, the same method as described above with respect to  can also be utilized to protect the MAC. More specifically, a MAC transport key can be generated at the back-end system. Then, the MAC transport key can be transmitted from the back-end system to the chip card using the secure channel. In one embodiment, transmission of the transport key and MAC transport key from the off-card entity to the chip card can be performed by embedding the transport key within a payload portion of a transmission packet and the MAC transport key within the MAC portion of the transmission packet. At the chip card, the MAC transport key can be used to encrypt MAC data to be sent from the chip card to the back-end system. Once the MAC data is encrypted using the MAC transport key, the encrypted MAC data is transmitted from the chip card to the back-end system.","In accordance with the foregoing, an application process operating on the server generates a transport key, e.g., a triple data encryption standard (triple-DES) transport key, to be communicated to a selected chip card application, e.g., applet, via a secure channel. The selected chip card application uses the transport key received from the server to encrypt data to be sent from the chip card to the server. In one embodiment, a chip card being compliant with the \u201cGlobal Platform Open Platform Card Specification, Version 2.0.1,\u201d operates to encrypt the data to be sent to the server using a DES_CBC_NOPAD command and the transport key. Thus, the data sent over the non-secured uplink channel in the direction from the chip card to the server is encrypted. Since a different transport key is generated by the application process operating on the server upon establishment of each secure session, the risk of replay attacks on the transport key-encrypted data is substantially diminished. Thus, the present invention enables secure communication in both directions between the server and the chip card in the context of the Open Platform Specification, wherein the secure communication is critical to the end-to-end security of the system.","Embodiments of the present invention may be practiced with various computer system configurations including hand-held devices, microprocessor systems, microprocessor-based or programmable consumer electronics, minicomputers, mainframe computers and the like. The invention can also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a wire-based or wireless network.","With the above embodiments in mind, it should be understood that the present invention may employ various computer-implemented operations involving data stored in computer systems. These operations are those requiring physical manipulation of physical quantities. Usually, though not necessarily, these quantities take the form of electrical or magnetic signals capable of being stored, transferred, combined, compared, and otherwise manipulated. Further, the manipulations performed are often referred to in terms, such as producing, identifying, determining, or comparing.","Any of the operations described herein that form part of the invention are useful machine operations. The invention also relates to a device or an apparatus for performing these operations. The apparatus may be specially constructed for the required purposes, or it may be a general-purpose computer selectively activated or configured by a computer program stored in the computer. In particular, various general-purpose machines may be used with computer programs written in accordance with the teachings herein, or it may be more convenient to construct a more specialized apparatus to perform the required operations.","Embodiments of the present invention can be processed on a single computer, or using multiple computers or computer components which are interconnected. A computer, as used herein, shall include a standalone computer system having its own processor, its own memory, and its own storage, or a distributed computing system, which provides computer resources to a networked terminal. In some distributed computing systems, users of a computer system may actually be accessing component parts that are shared among a number of users. The users can therefore access a virtual computer over a network, which will appear to the user as a single computer customized and dedicated for a single user.","The invention can also be embodied as computer readable code on a computer readable medium. The computer readable medium is any data storage device that can store data which can be thereafter be read by a computer system. Examples of the computer readable medium include hard drives, network attached storage (NAS), read-only memory, random-access memory, CD-ROMs, CD-Rs, CD-RWs, magnetic tapes, and other optical and non-optical data storage devices. The computer readable medium can also be distributed over a network of coupled computer systems so that the computer readable code is stored and executed in a distributed fashion.","Although the foregoing invention has been described in some detail for purposes of clarity of understanding, it will be apparent that certain changes and modifications can be practiced within the scope of the appended claims. Accordingly, the present embodiments are to be considered as illustrative and not restrictive, and the invention is not to be limited to the details given herein, but may be modified within the scope and equivalents of the appended claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 4"}]},"DETDESC":[{},{}]}
