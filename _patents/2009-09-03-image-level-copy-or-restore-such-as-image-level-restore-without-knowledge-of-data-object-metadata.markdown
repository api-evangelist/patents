---
title: Image level copy or restore, such as image level restore without knowledge of data object metadata
abstract: A system and method for performing an image level restore of data is described. In some examples, the system receives a request to restore a file and transmits the request to an intermediate component. The intermediate component may then retrieve a directory file from an image of a secondary copy of a data set, identify a location of the file from the directory file, and provide the location to the requestor.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08725688&OS=08725688&RS=08725688
owner: CommVault Systems, Inc.
number: 08725688
owner_city: Oceanport
owner_country: US
publication_date: 20090903
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS REFERENCE TO RELATED APPLICATIONS","BACKGROUND","DETAILED DESCRIPTION"],"p":["This application claims priority to U.S. Provisional Patent Application No. 61\/094,763, filed on Sep. 5, 2008, entitled IMAGE LEVEL COPY OR RESTORE, SUCH AS IMAGE LEVEL RESTORE WITHOUT KNOWLEDGE OF DATA OBJECT METADATA, which is incorporated by reference in its entirety.","A snapshot is a copy of a set of files and\/or directories as they were at a particular point in the past. That is, the snapshot is an image, or representation, of a volume of data at a point in time. A snapshot may be as a secondary copy of a primary volume of data, such as data in a file system, an Exchange server, a SQL database, an Oracle database, and so on. The snapshot may be an image of files, folders, directories, and other data objects within a volume, or an image of the blocks of the volume.","Data storage systems utilize snapshots for a variety of reasons. One typical use of snapshots is to copy a volume of data without disabling access to the volume for a long period. After performing the snapshot, the data storage system can then copy the data set by leveraging the snapshot of the data set. Thus, the data storage system performs a full backup of a primary volume when a primary volume is active and generating real-time data. Although performing a snapshot (i.e., taking an image of the data set) is a fast process, the snapshot is typically not an effective or reliable backup copy of a data set, because it does not actually contain the content of the data set. Restoring data from snapshots can be especially cumbersome, because a restoration process cannot restore the data set using snapshots alone. Recovery of individual files or folders can be especially cumbersome, because typical systems often recover an entire snapshot in order to restore an individual file or folder imaged by the snapshot.","Associated information, such as metadata, is often required in order to restore a file or folder via the snapshot, because the snapshot itself does not provide any information about the file or folder other than the image of a data set at a certain time. That is, the snapshot provides information about what was in or is changed in a data set (the image), but does not provide any information about where a particular file (or a copy of a data object) is currently stored or contained.","Therefore, a system that provides the benefits of snapshots while avoiding some of the drawbacks would provide significant utility.","Overview","Described in detail herein is a system and method that restores desired data via snapshot images of the data by retrieving a directory file from the snapshots, using the directory file to identify a location of where the data is stored, and providing the location to a requestor of the data (such as a data recovery system, a user, and so on). That is, the system may restore data from an image level copy of the data without generally relying on metadata or other similar information associated with the data.","In some examples, the system includes an intermediate component communicating between a data recovery system and a secondary copy of data to be restored, such as a snapshot copy mounted to the intermediate component. The snapshot copy may be a software-based snapshot (such as a snapshot performed using File System Snapshot, Qsnap, Volume Shadow Services, and so on), or a hardware-based snapshot (such as a snapshot performed using EMC, HP, Hitachi, and\/or NetApp or other applications). For example, the snapshot copy may be created during a copy-on-write process, a redirect-on-write process, a split mirror process, using a log structure file architecture, using continuous data protection, and so on. The intermediate component may receive a request from the data recovery system to restore a file, locate a snapshot that contains an image of the file, retrieve, from the snapshot, a directory file imaged by the snapshot, identify a location for the file from the directory file, and indicate the location for the file to the data recovery system. The data recovery system can then retrieve the requested file using the location information.","In some examples, the system includes a cache or other memory component that stores retrieved files, directory files, and other data once the data is requested and\/or retrieved during a restoration process. Before identifying a snapshot that images the file, the system may review the cache after receiving a request to restore a file. In some cases, the system may identify a directory file associated with the file, and extract the location information directly from the cached directory file. In some cases, the system may restore the file directly from the cache.","Thus, in some examples, the system utilizes an intermediate component to facilitate the extraction of information from imaged directory files that identify locations of files within imaged data sets. Knowledge or extraction of location information enables a recovery system to avoid relying on metadata and\/or other indexed information associated with a data set and\/or a snapshot of a data set. Additionally, in some examples the system enables a snapshot-based copy of data to act as a file system for all data imaged by the copy of data.","The system will now be described with respect to various examples. The following description provides specific details for a thorough understanding of, and enabling description for, these examples of the system. However, one skilled in the art will understand that the system may be practiced without these details. In other instances, well-known structures and functions have not been shown or described in detail to avoid unnecessarily obscuring the description of the examples of the system.","The terminology used in the description presented below is intended to be interpreted in its broadest reasonable manner, even though it is being used in conjunction with a detailed description of certain specific examples of the system. Certain terms may even be emphasized below; however, any terminology intended to be interpreted in any restricted manner will be overtly and specifically defined as such in this Detailed Description section.","Suitable System","Referring to , a block diagram illustrating components of a data stream utilized by a suitable data storage and recovery system is shown. The stream  may include a client , a media agent , and a secondary storage device . For example, in storage operations, the system may store, receive and\/or prepare data to be stored, copied or backed up at a server or client . The system may then transfer the data to be stored to media agent , which may then refer to storage policies, schedule policies, and\/retention policies (and other policies) to choose a secondary storage device . The media agent  may include or be associated with an intermediate component, to be discussed herein.","The secondary storage device  receives the data from the media agent  and stores the data as a secondary copy, such as a backup copy. Secondary storage devices may be magnetic tapes, optical disks, USB and other similar media, disk and tape drives, and so on. Of course, the system may employ other configurations of stream components not shown in the Figure.","Referring to , a block diagram illustrating an example of a data storage and recovery system  is shown. Data storage systems may contain some or all of the following components, depending on the needs of the system.  and the following discussion provide a brief, general description of a suitable computing environment in which the system can be implemented. Although not required, aspects of the system are described in the general context of computer-executable instructions, such as routines executed by a general-purpose computer, e.g., a server computer, wireless device or personal computer. Those skilled in the relevant art will appreciate that the system can be practiced with other communications, data processing, or computer system configurations, including: Internet appliances, network PCs, mini-computers, mainframe computers, and the like. Indeed, the terms \u201ccomputer,\u201d \u201chost,\u201d and \u201chost computer\u201d are generally used interchangeably herein, and refer to any of the above devices and systems, as well as any data processor.","Aspects of the system can be embodied in a special purpose computer or data processor that is specifically programmed, configured, or constructed to perform one or more of the computer-executable instructions explained in detail herein. Aspects of the system can also be practiced in distributed computing environments where tasks or modules are performed by remote processing devices, which are linked through a communications network, such as a Local Area Network (LAN), Wide Area Network (WAN), Storage Area Network (SAN), Fibre Channel, or the Internet. In a distributed computing environment, program modules may be located in both local and remote memory storage devices.","Aspects of the system may be stored or distributed on computer-readable media, including magnetically or optically readable computer discs, hard-wired or preprogrammed chips (e.g., EEPROM semiconductor chips), nanotechnology memory, biological memory, or other tangible or physical data storage media. In some aspects of the system, computer implemented instructions, data structures, screen displays, and other data under aspects of the system may be distributed over the Internet or over other networks (including wireless networks), on a propagated signal on a propagation medium (e.g., an electromagnetic wave(s), a sound wave, etc.) over a period of time, or they may be provided on any analog or digital network (packet switched, circuit switched, or other scheme). Those skilled in the relevant art will recognize that portions of the system reside on a server computer, while corresponding portions reside on a client computer, and thus, while certain hardware platforms are described herein, aspects of the system are equally applicable to nodes on a network.","The data storage system  contains a storage manager , one or more clients , one or more media agents , and one or more storage devices . Storage manager  controls media agents , which may be responsible for transferring data to storage devices . Storage manager  includes a jobs agent , a management agent , a database , and\/or an interface module . Storage manager  communicates with client(s) . One or more clients  may access data to be stored by the system from database  via a data agent . The system uses media agents , which contain databases , to transfer and store data into storage devices . Client databases  may contain data files and other information, while media agent databases may contain indices and other data structures that include information associated with the storage of data into secondary storage devices, for example.","The data storage and recovery system may include software and\/or hardware components and modules used in data storage operations. The components may be storage resources that function to copy data during storage operations. The components may perform other storage operations (or storage management operations) other that operations used in data stores. For example, some resources may create, store, retrieve, and\/or migrate primary or secondary data copies. Additionally, some resources may create indices and other tables relied upon by the data storage system and other data recovery systems. The secondary copies may include snapshot copies and associated indices, but may also include other backup copies such as HSM copies, archive copies, and so on. The resources may also perform storage management functions that may communicate information to higher level components, such as global management resources.","In some examples, the system performs storage operations based on storage policies, as mentioned above. For example, a storage policy includes a set of preferences or other criteria to be considered during storage operations. The storage policy may determine or define a storage location and\/or set of preferences about how the system transfers data to the location and what processes the system performs on the data before, during, or after the data transfer. In some cases, a storage policy may define a logical bucket in which to transfer, store or copy data from a source to a data store, such as storage media. Storage policies may be stored in storage manager , or may be stored in other resources, such as a global manager, a media agent, and so on. Further details regarding storage management and resources for storage management will now be discussed.","Referring to , a block diagram illustrating an example of components of a server used in data storage operations is shown. A server, such as storage manager , may communicate with clients  to determine data to be copied to storage media. As described above, the storage manager  may contain a jobs agent , a management agent , a database , and\/or an interface module. Jobs agent  may manage and control the scheduling of jobs (such as copying data files) from clients  to media agents . Management agent  may control the overall functionality and processes of the data storage system, or may communicate with global managers. Database  or another data structure may store storage policies, schedule policies, retention policies, or other information, such as historical storage statistics, storage trend statistics, and so on. Interface module  may interact with a user interface, enabling the system to present information to administrators and receive feedback or other input from the administrators or with other components of the system (such as via APIs).","Data Recovery Using an Intermediary","In some examples, the system performs some or all the operations described herein using an intermediate component, virtual storage device, virtual device drover, or other intermediary capable of mounting to a file system and communicating with a storage device. That is, an intermediate component may communicatively reside between a component that receives requests for files (such as a restoration component) and a data store (such as a data storage component). The intermediate component enables flexibility during data restoration, enabling a file system to indirectly access a secondary copy of data in order to identify information associated with data stored by the secondary copy, among other benefits.","Referring to , a block diagram illustrating a system for restoring data  from a snapshot-based secondary copy of data is shown. The system  includes a restore component  that receives data recovery requests from users, such as from system administrators. The restore component  may include a file system that receives and sends requests, and a display component that includes a user interface that enables users to visually interact with the restore component. Among other things, the user interface may facilitate the selection of data, such as files, folders, or other self-contained data objects to be restored.","The restore component  sends data recovery requests to an intermediate component , to be discussed herein. Briefly, the intermediate component  acts to receive requests from the restore component  and to provide location information for requested data. The intermediate component  communicates with a storage component , such as storage media containing secondary copies of a data set. The storage component receives requests for files or folders via the intermediate component, and may transfer the files or folders (or information associated with the files or folders) to the intermediate component  or to the restore component .","The system  may also include an optional cache  associated with the intermediate component . The cache, or other memory component, may store files or information retrieved from the storage component , such as files or information requested by the restore component  via the intermediate component . The cache  may serve requests for files or information included in the cache, to promptly respond to a request, such as a request for the same file that was recently and\/or previously requested. Although the cache  is shown as being outside the intermediate component, other configurations are of course possible. For example, the cache may be included within the intermediate component, within the restore component , within the storage component , and so on. Additionally, some or all of the components may include a cache that stores various files or information retrieved during data recovery.","Referring to , a block diagram illustrating computing system components for restoring data from a snapshot-based secondary copy of data is shown. As discussed with respect to , the system components include a restore component , an intermediate component , and a data storage component . The restore component  may include a client , such as a client that receives requests from users. The client may communicate received requests to a file system  that communicates with storage devices, such as a database  located at the restore component . For example, the database  may be a hard drive or hard disk that stores data produced by the file system as primary copies or production copies of the data. The system components may also include an intermediate component , such as a virtual device driver. The virtual device driver  communicates with a disk driver  and mounted disk , which together act as the data storage component .","Referring to , a block diagram illustrating an intermediate component  used in restoring data from a snapshot-based secondary copy of data is shown. The intermediate component  may include a restore module  containing its own file system . The restore module  (or component, sub-system, and so on), may communicate with a file system, such as the file system  at the restore component .","The intermediate component  may also include a storage device module  that communicates with storage devices, such as disk driver  and disk  (or other removable media). The storage device module  may include a directory module  that accesses entries within directory files obtained from snapshot-based secondary copies and extracts information from the directory files, such as location information associated with files indexed by the directory files. In other words, to determine the location of files, the directory module identifies the specific disk or storage device maintaining a desired file and identifies the blocks on the disk that contain the file, such as by retrieving the directory, file allocation table (FAT), master file table (MFT), or other data structures that describe files and file locations on the disk.","The intermediate component  may also include a cache  (or, a cache module or interface that communicates with an external cache), and\/or other agents or components , such as components that index files, classify files, manage files or information, and so on.","As discussed above, the system facilitates the recovery of files from snapshot-based secondary copies of data using an intermediary. Referring to , a flow diagram illustrating a routine  for restoring a file using an intermediate component is shown. In step , the system receives a request to restore a file. For example, the system receives the request via a user interface associated with a restore component . The request may present, via a graphical user interface, a list of files stored in secondary storage. For example, the system may present files currently stored on disk along with files no longer on disk but stored on secondary storage. The user or administrator may then select a desired file and\/or files.","Alternatively or additionally, the request may include an indication of a snapshot (or group of snapshots) that contain an image of the file. The system may present snapshots (or groups of snapshots) to a user via the user interface, or information associated with the snapshots or groups of snapshots. For example, the system may present information identifying various snapshots taken of a file or of a data store that contained the file. In some cases, the restore component  presents, via the user interface, various groups of snapshots to a user for selection.","In step , the system recovers the file using an intermediary, such as the intermediate component . For example, the intermediary may receive the request, identify a location of the requested file, and provide the location to the requestor. By having previously mapped specific files with particular disks and\/or storage devices, and with snapshots of the mapped storage devices, the system of  can readily locate the disk location and block extent of the desired file or files, as described herein. In step , the system retrieves the requested file from the identified location. For example, the restore component , using provided location information, directly accesses a data storage device and retrieves the file from the data storage device. That is, the system may access a directory file, identify data blocks that correspond to a requested file, and provide the data block identification to a file system. The file system may then directly access the file using the provided data block information.","Thus, the intermediary, in some examples, intercepts requests for files from a file system in order to quickly and efficiently provide location information associated with the file to the file system. The file system, using the provided information, can then directly access and retrieve the file. The intermediary will now be discussed. Referring to , a flow diagram illustrating a routine  for recovering a file via the intermediate component  is shown.","In step , the system mounts the file system, or launches a file system process for accessing a file location data structure, to an intermediate component, such as a component that acts as a virtual storage device. That is, the file system communicates with a component that appears to external systems (such as file system ) to be the disk driver  for reading and writing data from disk , but is in fact the intermediate component  communicating between the file system and the storage device.","In step , the file system requests a directory file from the storage device . That is, the file system requests an index or other table that is associated with and identifies the files within the storage device and the secondary copies contained within the storage device and locations of those files. In some cases, the directory file was created when a primary copy of the data was created, or was periodically created and\/or updated from a primary volume. For snapshot-based copies, the directory file may be imaged by a snapshot along with the files imaged by the snapshot.","Referring to , a table  illustrating a directory file used in identifying locations of files imaged by snapshots is shown. The table  includes entries for files imaged by the snapshot, and includes a column storing a name or other similar information  for each entry a column storing a location  or other similar information for each entry. For example, the entry  contains a file named \u201cdoc1.doc\u201d and information associated with the file, \u201cblocks -.\u201d In addition, entry  contains a file named \u201cdoc2.doc\u201d and information associated with the file, \u201cblocks -\u201d and \u201cN:\/blocks -\u201d (e.g., the file is stored in multiple locations). Of course, the table  may include other information.","Referring back to , in step , the virtual storage device obtains data blocks from the storage device. The virtual storage device may intercept or trap the request from step  and send a request to the storage device. The virtual storage device may extract some or all of the directory file and provide the necessary data blocks.","In step , the virtual storage device presents the obtained data blocks to the file system. Optionally, upon receiving a selection of a file by the file system, the virtual storage device sends a location of the selected file to the file system. That is, the virtual storage device reviews the extracted directory file, obtains location information (such as the blocks on a magnetic disk storing a file, the tape offsets on a tape storing the file, and so on), and provides the location information to the file system. In step , the virtual storage device may optionally store the obtained data blocks in an associated cache, to serve future requests for files in the directory, among other things In step , the virtual storage device may optionally store the provided location information, the file itself, and\/or the directory file in the cache, as described above.","In step , the file system retrieves the file from the storage device using the location information provided by the virtual storage device and responds to the original request. Using the location information, the file system may directly mount to the storage device and retrieve the file at the provided location. Alternatively, the virtual storage device may retrieve the file from the storage device and present the file to the file system.","As an example, a user, via a user interface presented to the user at a client computer , selects one or more Microsoft\u00ae Exchange\u00ae mailboxes to restore. The Exchange mailbox includes one or more files and associated data objects (such as emails) currently stored at the client computer  (or in database ) as well as files that have been stored in snapshot-based secondary copies and moved from the database . The system, however, is able to present all the files to the user via the user interface. For example, Windows Explorer, or a similar application, may query the database  and obtain files and\/or associated data objects associated with the mailbox, and lists them for the user. In addition, Windows Explorer queries the data storage component  for files\/data objects associated with the mailbox. This query is intercepted by the intermediate component, which retrieves a directory file associated with the data imaged by the snapshot-based secondary copies, and transfers the directory file to the user via the user interface. The user interface presents all retrieved files\/data objects to the user, without the user performing any additional or different steps to receive information from the snapshot-based secondary copies.","When the user selects a file\/data object stored in database , the system looks to a FAT, MFT, or other location table associated with the file system , identifies the blocks in the database that contain the file\/data object, and retrieves the file\/data object. However, when the user selects a file\/data object no longer stored in database , the system performs one of the routines described herein, such as routine , via a restore component or other similar components described herein. For example, the file system  sends a request to the data storage component  in order to retrieve the file\/data object. The request is intercepted by the intermediate component , which then locates the file\/data object based on information in the directory file that associates the snapshot image of the file with the file's location (e.g., what physical storage media stores the file and where on that physical storage media it resides). The system then transfers the location information to the file system, which then retrieves the file\/data object. Thus, the system facilitates the recovery of data for users without required a user or a file system to perform additional tasks or functions when the data is not stored at the file system.","Of course, the routines and examples described herein with some of the steps omitted or modified. For example, a virtual storage device may receive a request for a file and only provide location information for the file (and not the directory file). Additionally, the virtual storage device may first look to the cache before retrieving a directory file, which will now be discussed.","Referring to , a flow diagram illustrating a routine  for restoring a file using a cache associated with an intermediate component is shown. In step , a file system receives a request to restore a file. In step , the file system mounts to an intermediate component, which includes a cache or other memory component. In step , the intermediate component reviews the cache to determine if the cache contains the file, information associated with the file (such as location information), or a directory file that indexes the file.","If the cache includes information associated with the file, or the file itself, the system, in step , restores the file using the cached information. If the cache does not include any information, routine  proceeds to step  of , and the intermediate component obtains a directory file from a snapshot to identify the location of the file, as discussed herein.","Therefore, in some cases, utilizing an intermediate component enables the system to use previously recovered information to restore data. This can save time and resources, among other benefits.","Conclusion","From the foregoing, it will be appreciated that specific examples of the data recovery system have been described herein for purposes of illustration, but that various modifications may be made without deviating from the spirit and scope of the system. For example, although files have been described, other types of content such as user settings, application data, emails, and other data objects can be imaged by snapshots. Accordingly, the system is not limited except as by the appended claims.","Unless the context clearly requires otherwise, throughout the description and the claims, the words \u201ccomprise,\u201d \u201ccomprising,\u201d and the like are to be construed in an inclusive sense, as opposed to an exclusive or exhaustive sense; that is to say, in the sense of \u201cincluding, but not limited to.\u201d The word \u201ccoupled\u201d, as generally used herein, refers to two or more elements that may be either directly connected, or connected by way of one or more intermediate elements. Additionally, the words \u201cherein,\u201d \u201cabove,\u201d \u201cbelow,\u201d and words of similar import, when used in this application, shall refer to this application as a whole and not to any particular portions of this application. Where the context permits, words in the above Detailed Description using the singular or plural number may also include the plural or singular number respectively. The word \u201cor\u201d in reference to a list of two or more items, that word covers all of the following interpretations of the word: any of the items in the list, all of the items in the list, and any combination of the items in the list.","The above detailed description of embodiments of the system is not intended to be exhaustive or to limit the system to the precise form disclosed above. While specific embodiments of, and examples for, the system are described above for illustrative purposes, various equivalent modifications are possible within the scope of the system, as those skilled in the relevant art will recognize. For example, while processes or blocks are presented in a given order, alternative embodiments may perform routines having steps, or employ systems having blocks, in a different order, and some processes or blocks may be deleted, moved, added, subdivided, combined, and\/or modified. Each of these processes or blocks may be implemented in a variety of different ways. Also, while processes or blocks are at times shown as being performed in series, these processes or blocks may instead be performed in parallel, or may be performed at different times.","The teachings of the system provided herein can be applied to other systems, not necessarily the system described above. The elements and acts of the various embodiments described above can be combined to provide further embodiments.","These and other changes can be made to the system in light of the above Detailed Description. While the above description details certain embodiments of the system and describes the best mode contemplated, no matter how detailed the above appears in text, the system can be practiced in many ways. Details of the system may vary considerably in implementation details, while still being encompassed by the system disclosed herein. As noted above, particular terminology used when describing certain features or aspects of the system should not be taken to imply that the terminology is being redefined herein to be restricted to any specific characteristics, features, or aspects of the system with which that terminology is associated. In general, the terms used in the following claims should not be construed to limit the system to the specific embodiments disclosed in the specification, unless the above Detailed Description section explicitly defines such terms. Accordingly, the actual scope of the system encompasses not only the disclosed embodiments, but also all equivalent ways of practicing or implementing the system under the claims.","While certain aspects of the system are presented below in certain claim forms, the inventors contemplate the various aspects of the system in any number of claim forms. For example, while only one aspect of the system is recited as embodied in a computer-readable medium, other aspects may likewise be embodied in a computer-readable medium. Accordingly, the inventors reserve the right to add additional claims after filing the application to pursue such additional claim forms for other aspects of the system."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 4A"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 4B"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 9"}]},"DETDESC":[{},{}]}
