---
title: Differential bandwidth metering for networks with direct peerings
abstract: Methods and apparatus for differential bandwidth metering in a network implementing direct peerings. A system includes a plurality of resource collections and a billing manager. The billing manager obtains a first metric of network traffic transmitted on behalf of a client to obtain one or more services from one or more resource collections. The billing manager also obtains a second metric of network traffic transmitted on behalf of the client over one or more private links, where each private link is set up to establish a network path between a respective client network of the client and a respective resource collection of the plurality of resource collections. The billing manager provides composite billing information to the client comprising a differential billing amount dependent upon a difference between the first metric and the second metric.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09141947&OS=09141947&RS=09141947
owner: Amazon Technologies, Inc.
number: 09141947
owner_city: Reno
owner_country: US
publication_date: 20111219
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","DETAILED DESCRIPTION OF EMBODIMENTS","CONCLUSION"],"p":["Many companies and other organizations operate computer networks that interconnect numerous computing systems to support their operations and the services they provide to their end customers distributed worldwide. For example, data centers housing significant numbers of interconnected computing systems have become commonplace, such as private data centers that are operated by and on behalf of a single organization, and public data centers that are operated by entities as businesses to provide computing resources to customers. In many cases providers set up large networks that may logically span several regions or even countries, and may include numerous data centers with varying levels of services and facilities available, utilized together to provide a unified set of services to their end customers.","In some data centers that have been set up to provide computing and\/or storage facilities to remote clients, the set of computational resources at the data center may be dynamically divided into resource pools, with each pool being made available for exclusive use by a given client for designated periods of time. Customers may be billed for the various resources used for each service they access\u2014e.g., for CPU usage based on the type of server used, for memory based on the amount of memory used at each server, and so on. There are a number of alternatives available for how the consumers of these facilities establish network connectivity to the resource pools that have been designated for their use. The customer requests may originate from a wide variety of devices\u2014desktop personal computers, laptops, client-office servers, tablets, smart phones and the like. These devices may use either long-lasting network links (e.g., using a client office network with a T1 connection) to communicate with their proximate private network and\/or the public Internet, or they may have transient connectivity (e.g., in the case where the customer uses a mobile smart phone). The proximate networks to which the customer devices are directly connected may in turn route request traffic to the provider network's data centers over a wide variety of paths. Such paths in many cases may have somewhat unpredictable performance, reliability and security characteristics.","For some casual types of service requests, such as a request from a customer to read a recent news article from a web-based news provider, a reasonable variation in responsiveness and an occasional dropped connection may be acceptable. However, for many business-related data transmissions, such as stock quote services and stock purchase order services provided by online stock traders, or for high-bandwidth software package deployments originating at a software development center, more stringent performance, reliability and security needs may exist. In such environments, a customer of the provider network may need a greater level of network isolation and control than is generally available over the public Internet. For example, the customer may wish to establish, if possible, dedicated private network links between the customer's own network and the provider network, such that the only traffic transmitted over those links is traffic generated on behalf of the customer and in accordance with policies established by the customer. Providers of such dedicated private links may wish to bill the customers for whom such links are set up based on, for example, the link usage levels. In a complex provider network with hundreds or thousands of different resource collections each providing billable services to clients, where some of the clients may have various dedicated private links set up while others do not, the problem of determining how much traffic is transmitted on behalf of which client at various points in the network may become complicated. In addition, in such complex networks there may often be periods over which network paths are underutilized, thereby resulting in a suboptimal return on the network operators' investments on networking equipment","While embodiments are described herein by way of example for several embodiments and illustrative drawings, those skilled in the art will recognize that embodiments are not limited to the embodiments or drawings described. It should be understood, that the drawings and detailed description thereto are not intended to limit embodiments to the particular form disclosed, but on the contrary, the intention is to cover all modifications, equivalents and alternatives falling within the spirit and scope as defined by the appended claims. The headings used herein are for organizational purposes only and are not meant to be used to limit the scope of the description or the claims. As used throughout this application, the word \u201cmay\u201d is used in a permissive sense (i.e., meaning having the potential to), rather than the mandatory sense (i.e., meaning must). Similarly, the words \u201cinclude,\u201d \u201cincluding,\u201d and \u201cincludes\u201d mean including, but not limited to.","Various embodiments of methods and apparatus for differential bandwidth metering and dynamic bandwidth management for networks with direct peerings are described. Networks set up by an entity such as a company or a public sector organization to provide one or more services accessible via the Internet (such as various types of cloud-based computing or storage) to a distributed set of clients may be termed provider networks in this document. Such a provider network may include numerous data centers hosting various resource pools, such as collections of computer servers, storage devices, networking equipment and the like, needed to implement and distribute the services offered by the provider. Each client of a provider network may wish to transmit requests to the provider network from a client network comprising the client's own set of devices (e.g., servers, desktop or laptop systems, and the like).","In order to extend the geographical areas over which its services can be accessed with desired levels of performance, reliability and security, an operator of a provider network may establish dedicated private network paths between its main data centers and one or more routers that are physically located at a facility remote from the data centers. Such routers owned or managed by, or on behalf of, the provider network operator are called \u201cendpoint\u201d routers in this document, as they may represent the furthest points to which the provider network's control or ownership of network equipment extends. For example, only traffic that has passed through a device owned or managed by the provider network operator, and therefore complies with policies set by the provider network operator, may be allowed on the private paths between the endpoint routers and other components of the provider network.","Using a variety of approaches, the operator of the provider network may collaborate with a client to establish one or more private links from an endpoint router to a client router of the client's network, e.g., to provide enhanced performance and enhanced security for communications between the client network and the resource collections allocated to the client. In some embodiments, for example, a programmatic interface through which connectivity-related requests from clients are handled may be implemented by the operator of the provider network, and the interface may be used by the client to obtain instructions for setting up and configuring the private links. In other cases the client may communicate using more traditional means such as telephones, e-mail or physical mail with the operator of the provider network and\/or other third-parties (such as operators of router housing facilities, last-mile connectivity providers and the like) that may need to be involved in setting up the links. The direct dedicated private links, which may also be referred to as cross-network links, may for example comprise a cable linking a physical port at an endpoint router with a physical port at a client network router, with both the endpoint router and the client router co-located at the same physical facility or network data center. In some cases the private links may not explicitly require a new physical link between a client's network and the provider network's endpoint router; instead, for example, the private link may be set up with the help of third party providers that may be able to use networking protocols and\/or portions of existing network infrastructure to provide the desired private connectivity. After the private links are set up, a client may in some embodiments establish a plurality of logically-isolated network paths that share the same private link for traffic between the client network and one or more service instances implemented at resource collections allocated to the client. Various network isolation mechanisms may be used to isolate the traffic in different implementations, such as VLAN tags. The private links may be termed \u201cdirect connect\u201d links herein, and the logically-isolated network paths may be termed \u201clogical connections\u201d.","There may be multiple points within the provider network at which network traffic may be measured. For example, at the resource collections, network traffic may be measurable on a per-service level for each client making service requests. Each service may require a client to authenticate itself at the beginning of a client session, before a requested task or set of tasks is performed, and a service metering agent associated with the service may collect traffic measurements indicating how much network traffic the client generated for that service. At the endpoints where the direct connect links are set up, it may also be possible for link metering agents to measure how much traffic is flowing on each private link, and to associate that traffic with the client for whom the link was set up. Thus, even though individual network packets themselves may not have identification information of the client or clients for whom the packet is being transferred, metering agents may be able to measure client traffic at some level of aggregation both at the resource collections (where the services are performed) and at the direct connect links (where traffic enters and leaves the provider network) in some embodiments. Since traffic flowing over a direct connect link may be targeted at (or received from) a service instance at a resource collection, a given network packet may potentially count towards multiple traffic measurements at different points in the provider network.","In one embodiment, a billing manager may be operable to obtain different sets of summed traffic measurements for the services and the direct connect links, and generate billing information for each client based on the client's usage of the links and services and on the billing policies agreed to with the client. In one provider network, for example, the default billing behavior may be that each client that requests a service should be billed for the network traffic that is generated at the corresponding resource collection for that service, and every client that uses a dedicated private link should be billed for traffic that flows through the link. Because of the potential for traffic being counted multiple times, e.g., once during service-related traffic measurement and once during direct connect measurement, different billing policies may be used to override the default behavior. One such billing policy may, for example, indicate that the billing manager should charge the client at certain rate for the traffic that passes through the client's private links, but that the client should not be charged again for that same traffic being measured at the resource collections for services requested by the client. In an embodiment where such a billing policy is implemented, the billing manager may obtain, e.g., from the various metering agents, both a direct connect traffic summation metric for the client and a service traffic summation metric. The service traffic metric may sum up, for example, all the traffic transmitted to or from one or more resource collections on behalf of the client to obtain a service or services at the resource collection during a given time period, such as a month or a week. The direct connect traffic metric may sum up, for example, all the traffic transmitted over a given direct connect link that is allocated to the client, over the same time period. The billing manager may then, in such an embodiment, provide composite billing information to the client for the client's network traffic usage. In accordance with the billing policy, the composite billing information may include a first billing amount dependent on the direct connect traffic metric, and a second billing amount that depends on the difference (if any) between the service traffic metric and the direct connect traffic metric. For example, if during a given billing period, ten gigabytes of traffic were measured at the resource collections and six gigabytes were measured at the direct connect link or links, the client may be charged only once for the six gigabytes (at the rates applicable for direct connect traffic), and service-related charges would be applied to the four remaining gigabytes of the ten gigabytes of service-related traffic originally measured. Different billing policies may be in effect for different clients, and at different times for the same client, in some embodiments. For example, according to one billing policy, the billing manager may be required to minimize the total bill, so that if two different billing rates could be applied to a given traffic measurement amount (e.g., if either a service-determined rate or a direct connect rate is applicable), the lower of the two rates would be chosen.","In another embodiment, a dynamic bandwidth manager may be implemented, e.g., to increase the utilization of the available network bandwidth during periods in which there may be excess network capacity beyond the amount being used by various clients. Each client may provide its bandwidth configuration settings to the dynamic bandwidth manager, comprising for example a baseline direct connect traffic transmission rate for the client. The baseline transmission rate may indicate a current rate of direct connect traffic for which the client has agreed to pay at a certain billing rate, e.g., 1 Gbits\/second at one cent per 100 Mbits. With the help of the metering agents at the direct connect links, the resource collections and\/or elsewhere in the provider network, the dynamic bandwidth manager may gather measurements of actual traffic usage. In some embodiments, the dynamic bandwidth manager may determine the difference between measured traffic transmission rate over a path between the client's network and resource collections allocated to the client, and the peak transmission capacity of that path. If this difference exceeds a threshold value (e.g., if only 20% of the peak capacity is currently in use) the dynamic bandwidth manager may initiate a transmission of an indication such as a routing signal to the client network indicating that more bandwidth is currently available than the previously agreed-to baseline rate. Such a routing signal may be transmitted, for example, using a routing protocol message, e.g., a Border Gateway Protocol (BGP) message within which the value of a particular attribute indicates the change in available bandwidth. If the client wishes to take advantage of the extra bandwidth, the client may respond to the signal by increasing its traffic rate. In some embodiments, additional information such as the pricing for the newly-available bandwidth may also be transmitted to the client, and the client may take the pricing information into account when deciding how to respond to the signal. In some embodiments, dynamic changes in pricing may be communicated to the billing manager to help in preparing accurate composite billing information.","Example System Environment",{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 1","b":["100","105","140","140","140","140","150","140","150","150","140","150","140","110","110","110","110","110","110","130","132","105","105","120","120","120","105","130","132","120","110","105","120","110","130","132","130","132","110","105","165","132","140","150"]},"The system  may also include a variety of metering agents configured to collect measurements of traffic generated on behalf of the clients in various embodiments. For example, in one embodiment each service instance  may have an associated service metering agent  (e.g., agent A for service instance A, agent B for service instance B, and agent C for service instance C) responsible for collecting network traffic measurements associated with the service instance. Such service metering agents  may, in one exemplary implementation, collect measurements at the network interface level for each service instance, indicating how many bytes of traffic were sent or received for a given set of client-requested operations. In other implementations service-related traffic measurements may be taken at other levels of the software and\/or hardware stack at the resource collections, e.g., at the application level or within the operating system or hypervisor in use at the service instance. Service metering agents  may in some embodiments periodically transmit metering records indicative of service-related network traffic to a metering database . In one embodiment the service metering agents may submit metering information to a dynamic bandwidth manager , in addition to, or instead of, transmitting metering records directly to a metering database . The dynamic bandwidth manager  may be responsible for making changes in available bandwidth known to clients, as described in detail below.","In addition to the service metering agents , the provider network  may also include link metering agents  for the direct connect private links  at endpoint routers , e.g., link metering agent A associated with endpoint router A and link metering agent B associated with endpoint router B. Each private link  may connect a physical router port at a client router within a client network  to a physical port at an endpoint router  in some embodiments, while in other embodiments a third-party provider such as a network services provider may implement the private link . Each physical port at the endpoint router may be allocated to the client whose client network is connected (either directly using a physical link, or indirectly with the help of a third party provider) via the port. In such embodiments, the link monitoring agents  may be operable to measure the traffic at each port separately, thereby allowing the traffic on each port to be associated with the client for whom the port is allocated. Link metering agents  may also be configurable in some embodiments to submit link metering records to metering database  and\/or to a dynamic bandwidth manager .","In one embodiment, system  may include a billing manager  responsible for collecting metering records generated by the various metering agents  and , using the billing rates and policies in effect for various types of services and physical link usage by the clients, and providing billing information to the clients as per their billing preferences. For example, according to one billing policy in one embodiment, a billing manager  may obtain a metric \u201cSigma_S\u201d summing up all the service related traffic measured for a particular client at various resource collections during a given billing period, and a second metric \u201cSigma_P\u201d summing up all the traffic measured over private (i.e., direct connect) links  for that client during that same period. The billing manager  may then compute the difference \u201cDelta_SP\u201d by subtracting Sigma_P from Sigma_S. If Delta_SP is greater than zero, i.e., if there was more cumulative service-related traffic than cumulative private link traffic, the billing manager  may then compute two billing amounts in accordance with the billing policy in place: a private link billing amount A_Direct_Connect dependent on Sigma_P and an average private link billing rate RP, and a differential billing amount A_Differential that depends on Delta_SP and an average service billing rate RS. A_Differential may be computed, instead of for example simply charging the client an amount based on the cumulative service traffic Sigma_S and RS, in order to avoid billing the client twice for the same traffic\u2014once for the traffic as it flows over the private link  and again for when it reaches (or starts from) the service instances  at resource collections . The billing manager  in this example may then provide composite billing information to the client, comprising A_Direct_Connect and A_Differential.","A variety of billing policies may be implemented in different embodiments, and as a result the computations performed by the billing manager  to arrive at composite billing information for various clients may differ. For example, in some embodiments, a given private link  may be used for traffic of two or more logically-isolated network paths, which may have been set up to allow clients to isolate traffic for one purpose (such as a corporate intranet with high demands for security) from traffic for another purpose (e.g., a publicly accessible web site set up by the client for its own customers to access using public links of the Internet). In such embodiments, the billing manager  may provide separate billing amounts for each logically-isolated path so that the client may be able to track the networking costs associated with each of the two types of operations. In other embodiments, as described in further detail below in conjunction with the discussion of , different client accounts may be linked for billing purposes, and the billing manager  may allow clients to view consolidated billing information for linked client accounts, which may include billing amounts dependent upon the ratio of traffic generated on behalf of each account. In some embodiments, different services or service instances may have different billing rates associated with them, and the billing manager may have to take the service-specific billing rates into account instead of, for example, using an average service billing rate when computing the composite billing information. Similarly, in some environments different private links  set up on behalf of the same client may have different billing rates associated with them, and such different rates may have to be taken into account as well. In embodiments where pricing is dynamically changed, e.g., where a dynamic bandwidth manager  advertises varying rates to clients at different points in time as described below, the billing manager  may have to take such pricing variations into account. The billing manager  may store billing data, such as billing policies, preferences and rates in effect for various clients, within a billing database  in some embodiments.","System  may include a dynamic bandwidth manager  (which may be referred to herein as a DBM) in some embodiments. The dynamic bandwidth manager  may be responsible for, among other functions, communicating changes in available bandwidth levels to the clients, e.g., using routing protocol messages or other signals, thus allowing those clients that are able to use increased bandwidth to benefit from variation in network traffic over time. The DBM  may also obtain dynamic bandwidth preferences or settings from clients, comprising for example such information as the current baseline bandwidth that the client has agreed to pay for, a maximum price the client is willing to pay for additional bandwidth, and so on. In one embodiment, the DBM  may compute a current or recent traffic transmission rate along one or more paths between a client network  and one or more resource collections , e.g., using information provided by link metering agents  and\/or the service metering agents . The DBM  may subtract the current traffic rate from the peak or rated capacity of the path or paths to arrive at an estimate of the current excess capacity that could be used by interested clients. If the difference between the peak capacity and the current transmission rates exceeds a threshold, in some embodiments the DBM  may initiate a transmission of a routing signal to the client network to indicate that the client may be able to transmit more traffic than its current baseline level. For example, in one implementation, the DBM  may send a request to an endpoint router  to transmit a BGP message to a client network with a community attribute set to a particular value, thereby informing the client of the available bandwidth. Different types of routing protocols may be used in various embodiments, and different message types and attributes may be employed to transmit the indication of bandwidth availability. In some embodiments the manner in which the indication is transmitted may be selectable by the clients, e.g., in the bandwidth configuration settings they provide to the DBM , clients may indicate their preferred notification or signaling mechanisms. Such client preferences and settings may be stored in a bandwidth management database  in some embodiments.","In one embodiment a DBM  may also make pricing modifications, e.g., by lowering prices when there is a lot of excess bandwidth available, and\/or by raising prices as the amount of excess bandwidth decreases. The DBM  in such an embodiment may also communicate the pricing changes to clients, e.g., by updating a web page, or using some other communication mechanism. Pricing changes may also be communicated via routing protocol messages in some embodiments. A DBM  may be responsible for receiving client bandwidth setting updates as well in some embodiments\u2014e.g., when a client wished to perform a data intensive computation requiring a large amount of data transfer, it may send a signal to the DBM indicating that it is willing to pay a higher rate than the default or current rates in effect. Such client notifications may induce the DBM to repeat its computations of currently available excess bandwidth in some implementations, to see if the client's needs for more bandwidth can be met.","Direct Connect Link Establishment and Usage",{"@attributes":{"id":"p-0037","num":"0036"},"figref":["FIG. 2","FIG. 2"],"b":["130","201","105"]},"A client that has an account set up may use facilities or instructions supported by the operator of provider network  to first establish one or more direct connect private links  for dedicated connectivity (entry  in ). For example, the client may be given instructions specifying which physical port of an endpoint router  should be connected to a client-side router, where the endpoint router is located (e.g., in which rack in which data center), and so on. After establishing a private link  as per the instructions, a client may then establish one or more logically-isolated network paths that use that private link (entry ). The functionality of the dedicated connectivity may be verified or validated (entry ), e.g., in some embodiments the client and\/or a connectivity coordinator within the provider network operator may perform one or more verification operations and confirm that the client can successfully communicate with the provider network over the link , and that traffic over the link is isolated in accordance with the desired configuration of logically-isolated paths.","After the private link and the logically-isolated paths have been established, the client may set up and begin utilizing service instances  at resource instances  allocated for the client (entry ) in accordance with the billing policies and rates in effect for the client's accounts. In embodiments where a dynamic bandwidth manager  is implemented and can change traffic-related pricing, or the billing manager  can change pricing, the client may receive updated bandwidth pricing information (element ) from time to time. In one embodiment a client may update its connectivity characteristics as needed (element ), e.g., by requesting a change to its baseline bandwidth, by specifying a new price it is willing to pay for additional bandwidth, and the like. Based on the billing policy in effect, the client may receive billing information periodically (element ), e.g., from the billing manager .","Logically-Isolated Connections Sharing Direct Connect Links","In many cases a client may be interested in using resource collections  for a variety of different purposes\u2014for example, a software vendor may wish to use one set of resources to set up a development and build environment for its software engineers, another set of resources for an intranet for storing and sharing corporate information internally within the company, and a third set of resources for a web site that may be accessed by the software vendor's customers. Such a client may desire, for example for administrative purposes, accounting\/billing purposes, and\/or security purposes, that the network traffic for each set of resources be isolated from the traffic for the other sets of resources. The software vendor may wish to ensure that the build-related traffic be kept separate from the intranet traffic, that traffic from the build machines or resources may not be permitted to reach one or more intranet servers, and so on. At the same time, such a client may wish to utilize the same links  provided via an endpoint router  for all these different functions.",{"@attributes":{"id":"p-0041","num":"0040"},"figref":["FIG. 3","FIG. 3","FIG. 2"],"b":["352","352","391","332","312","322","110","302","105","312","302","391","372","132","391","352","322","302","352","332","312"]},"Traffic Metering for Services at Resource Collections",{"@attributes":{"id":"p-0042","num":"0041"},"figref":["FIGS. 4","FIG. 4"],"i":["a ","b ","a"],"b":["4","140","150","455","192","150","445","440","445","455","440","150","440"]},"As shown in , the service metering agent  may monitor incoming service-related data  received at the network interface , as well as outgoing service-related data  sent from the network interface . In one implementation, network traffic counters within the software stack (e.g., in a layer of a hypervisor, operating system, or application) may be used to keep track of incoming and outgoing traffic. Service metering agent  may, in some embodiments, periodically transfer metering records indicating the amount of traffic measured for a given client for a given service to a metering database . The granularity at which service metering records are generated and\/or transmitted may vary in different implementations, and may be tunable: for example, a metering record for a given (service, client) combination may be generated every minute in one implementation, and every fifteen minutes in another implementation. In embodiments where a dynamic bandwidth manager  is present, some or all of the measurements may be transmitted to the DBM  as well or instead of being stored directly in the metering database . A DBM  may be configured to store metering information it receives in the metering database , and\/or read metering information from the metering database as needed. A billing manager  may retrieve metering records generated by the service metering agent  as needed from the metering database .","In the embodiment illustrated in and , a service metering agent  is shown incorporated within a service instance . In some embodiments, service metering agents may be independent of or external to the service instances\u2014e.g., traffic related to a service may be monitored using a network tap, sniffer, or similar mechanism that may also be able to allocate network packets to different client accounts by analyzing the packet contents. In one embodiment a single service metering agent  may be capable of monitoring traffic associated with several service instances . While and illustrate an embodiment in which a service metering agent  is configured to measure traffic at the network interface level, in other embodiments the traffic may be measured at other levels of the software\/hardware stack.","Traffic Metering for Direct Connect Links",{"@attributes":{"id":"p-0045","num":"0044"},"figref":"FIG. 5","b":["130","132","105","0","11","0","130","110","130","195","130","557","559","130","110","557","559","110","110","132"]},"A link metering agent  may use any of various measurement techniques in different embodiments. For example, the endpoint router  may maintain counters for incoming and outgoing traffic over each port in some embodiments, while sniffers or network taps may be used in other embodiments. While in  the link metering agent is shown external to the endpoint router , in other embodiments the link metering agent may be incorporated within the router. A single link metering agent  may be responsible for monitoring direct connect traffic for several routers in some embodiments. In some embodiments link traffic may be allocated to client accounts based on the contents of the packets, rather than on the physical ports used. In one embodiment the traffic measured on a given direct connect link may be further classified based on the logically-isolated network path to which it belongs (e.g., using VLAN tags as described earlier).","The interactions between link metering agents  and the metering database , dynamic bandwidth managers  and billing managers  may be similar to the interactions between those entities and the service metering agent  described above. Link metering agent  may, in some embodiments, periodically transfer metering records indicating the amount of traffic measured over a given link  (and therefore associated with a given client account) to a metering database . The granularity at which link metering records are generated may also vary in different implementations, and may be tunable: for example, a metering record for a given link  may be generated every five minutes in one implementation, and every ten minutes in another implementation. In embodiments where a dynamic bandwidth manager  is present, some or all of the link traffic measurements may be transmitted to the DBM  as well or instead of being stored directly in the metering database . A DBM  may be configured to store link metering information it receives in the metering database , and\/or read metering information from the metering database as needed. A billing manager  may retrieve metering records generated by the link metering agent as needed from the metering database .","In some embodiments, different metering databases may be implemented for private link measurements than for service measurements. In other embodiments, the service metering agents and link metering agents may transmit their measurements directly to dynamic bandwidth managers and\/or billing managers, and may transmit metering records to metering databases. In one embodiment, traffic metering may be implemented at other points in the provider network in addition to the service instances  and the private links \u2014e.g., at various network devices associated with the internal links  shown in , and metering records gathered at the internal links may also be sent to a metering database , a dynamic bandwidth manager  and\/or a billing manager .","Contents of Metering Records",{"@attributes":{"id":"p-0049","num":"0048"},"figref":["FIGS. 6","FIG. 4","FIG. 6"],"i":["a ","b ","a","a"],"b":["6","601","602","604","192","601","606","445","601","608","150","610","612","614"]},"A link metering record  as illustrated in for one embodiment may include several elements similar to the elements of service metering record . For example, the link metering record  may also include start and end timestamps  and  indicating the time period over which measurements were made. In some embodiments a router identifier  and a physical port number  may also be included, identifying the location of the link  on which the measurements were made. A client account identifier  (and\/or a billing account identifier) may be included as well. In one embodiment a logical connection identifier  may be used to indicate the logically-isolated network path (similar to paths A or B of ) on which the traffic was transmitted. A link metering record may also include separate measurements for incoming traffic (element ) and outgoing traffic (element ) in some embodiments; in other embodiments the incoming and outgoing traffic may be combined into a single measurement. Additional metadata associated with the link  or the client, not shown in , may be incorporated within link metering records in some embodiments.","As noted earlier, in some embodiments service metering records  and link metering records  may be transmitted to one or more metering databases  by the respective metering agents that generate them. In other embodiments, the records may be sent to dynamic bandwidth managers and\/or billing managers, which may in turn store them in persistent stores if needed.","Contents and Linkage of Billing Accounts",{"@attributes":{"id":"p-0052","num":"0051"},"figref":"FIG. 7","b":["701","701","701","701","119","116","701","711","701","713"]},"In some embodiments different services implemented at resource collections  may have different billing rates for their associated network traffic, while in other embodiments a common network transmission billing rate may be used for several different services. Different clients may be charged different billing rates for the same service type in some environments. A record A of the service traffic related billing rate or rates currently applicable may be stored in the billing account record A. In some environments, the service-related billing rates may be modified during a given billing period, and a record of the specific service-related billing rates applicable for different time periods may also be stored within element A. For example, a client may have agreed to a service billing rate of ten cents per gigabyte for a period Jan. 1-Jan. 10 2012, and then on January 11 the billing rate may have changed to eight cents per gigabyte for the remainder of the month. In this example, the different rates (eight and the cents per gigabyte) and the corresponding time periods (January 1-10 and January 11-January 31) may be stored in element A.","Private link billing rate information may be stored within an element A, and in embodiments where different rates for different logically-isolated paths are supported, the rates for different logical paths may be stored in an element A. As in the example of variable service billing rates described above, records of varying private link billing rates and\/or varying logical path billing rates and the corresponding time periods for which the different rates are applicable may also be stored in elements A and A.","In some embodiments one or more billing policies, such as precedence policies A, may also be included within billing account records . A precedence policy may indicate the way in which a billing rate should be chosen when more than one billing rate may be applicable for a given traffic measurement. For example, if the billing rate for services is RS and the billing rate for private link traffic is RP, one precedence policy may specify that if there is a choice, RP should be applied rather than RS; another precedence policy may specify that the minimum of RS and RP should always be applied.","Billing accounts may be linked to each other in some embodiments, e.g., at the request of the clients involved. In the illustrated embodiment, linked billing relationship indicator  shows that billing account records B and C are both linked to billing account record A. Account linkage may be requested for a number of different reasons in different embodiments. A corporation may set up a single global client account as a parent account, for example, and may wish to set up different child billing accounts for different organizations within the corporation. The corporation may wish to obtain consolidated billing information for the global client account, and may desire the option of also obtaining individual billing information for each organization. In another example, a first client of the provider network  may have as its customer another client of the provider network, so that traffic generated over the first client's private link  may have been generated from a resource collection  allocated to the second client. The first client may wish to manage the billing of the second client's traffic, and may request that their billing account records be linked. The billing manager  may be responsible for providing consolidated billing information for linked accounts, depending on billing policies in effect.","A billing account record  may be set up, e.g., by a billing manager , when a client first sets up its client account with the provider network, as indicated in element  of . A client may issue various requests over time to change, link, or unlink its billing accounts, e.g., via an interface provided by the billing manager . In some embodiments a dynamic bandwidth manager  may also be involved in changing some of the contents of billing account records; for example, the dynamic bandwidth manager may change the billing rates offered to a client for a private link or for a service, and may inform the billing manager of changes, or of the rates to apply for a client for a given time period.","Example of Traffic Flow Over a Shared Direct Connect Link",{"@attributes":{"id":"p-0058","num":"0057"},"figref":["FIG. 8","FIG. 8"],"b":["130","110","810","810","130","110","105","810","810","140","130","130","820","240","820","240","240","240","150","240","150","240","150"]},"In the embodiment shown in , traffic may be measured at several points by various metering agents. Traffic flowing over the link , designated as TP, may be measured by a link metering agent , and, since the link is assigned to Client A, this traffic may be apportioned to Client A\u2014i.e., Client A may be responsible for paying for the link traffic. In addition, service-related traffic may be measured at each service instance\u2014traffic TS at service instance A, TS at service instance B, and TS at service instance C. In one example scenario, TP for a given month may be 15 Gigabytes, TS may be 20 Gigabytes, TS may be 10 Gigabytes, and TS may be 5 Gigabytes. The total measured service related traffic in this example is 35 Gigabytes (TS+TS+TS), and the total link-related traffic is 15 Gigabytes (TP). Some or all of the link-related traffic may have contributed to the service traffic total. (The total service related traffic may exceed the link traffic because there may be alternative paths to the resource collections, i.e., paths that do not include the link .)","One billing policy that may be implemented by a billing manager  in this example scenario may be summarized as \u201ccharge the direct connect client at the direct connect rate for the traffic that flows over the private link; and distribute charges for any excess service related traffic proportionally, i.e., in the ratio of the service traffic totals generated for each client\u201d. Here the direct connect client is Client A, and so Client A may be charged for 15 Gigabytes of traffic at the prevailing direct connect billing rate. The \u201cexcess\u201d service related traffic is 20 GB, obtained by subtracting TP from (TS+TS+TS). This excess service related traffic may be apportioned as follows between the three clients, based on the respective ratios TS\/(TS+TS+TS), TS\/(TS+TS+TS), and TS\/(TS+TS+TS). Client A would be charged for (20\/35) times , or approximately 11.4 Gigabytes. Client B would be charged for (10\/35) time 20, or 5.7 Gigabytes, and Client C would be charged for (5\/35) times 20, or 2.9 Gigabytes. Since the billing accounts of clients A and B are linked, a linked service billing amount proportional to the sum of the service traffic portions allotted to those two clients (11.4+5.7, i.e., 17.1 Gigabytes) may be presented to Client A (or Client B) upon request by billing manager . The traffic apportioned to, and hence the billing amounts generated for, each client may differ depending on the billing policy in effect.","Methods for Billing Manager Functionality",{"@attributes":{"id":"p-0061","num":"0060"},"figref":["FIG. 9","FIG. 6","FIG. 6"],"b":["116","902","651","601","117"],"i":["b","a"]},"The billing manager  may then obtain a summation of the service-related traffic, designated as metric Sigma_S in  (element ), and a summation of the private link traffic, designated as metric Sigma_P (element ). The difference Delta_SP between the service related metric Sigma_S and the link-related metric Sigma_P may then be calculated (element ). The billing manager may then obtain the current billing rates applicable to the client for service-related traffic (RS) and the billing rate for link-related traffic (RP), e.g., from the billing database  (element ).","If Delta_SP is greater than zero (as determined in element ), i.e., if the service-related traffic metric exceeds the private link-related traffic metric, in the embodiment illustrated in  the billing manager  may generate billing information for the client comprising two billing amounts (element ). One amount may be proportional to the private link traffic metric Sigma_P and the private link billing rate RP. The other amount may be proportional to the \u201cexcess\u201d service-related traffic, i.e., Delta_SP, and the service billing rate RS. By providing this differential billing amount, the billing manager may ensure that the client is not charged twice for the same traffic. If Delta_SP is not greater than zero, only the billing amount proportional to Sigma_P and RP may be provided, as shown in element .",{"@attributes":{"id":"p-0064","num":"0063"},"figref":"FIG. 10","b":["116","1","130","1","2","1","2","1","2"]},"The billing manager  may collect metering records for service-related and link-related traffic for both clients (element  of ). Metric Sigma_S that sums up the service-related traffic for client A, and Sigma_S that sums up the service-related traffic for client A, may be obtained (element ) and summed as Sigma_S_total. In addition, the summed private link traffic metric Sigma_P may also be obtained by the billing manager (element ). The difference Delta_SP between the sum of the service traffic metrics Sigma_S_total and the private link traffic metric Sigma_P may then be computed (element ).","If Delta_SP is greater than zero (as determined in element ), i.e., if the sum of the service-related traffic metrics for the two clients exceeds the link-related traffic metric, in the embodiment illustrated in  the billing manager  may apportion or distribute the excess service-related traffic between the two accounts in the ratio of their respective service traffic metrics. That is, as shown in element , Delta_SP may be divided into two parts: Delta_SP computed as Delta_SP*Sigma_S\/Sigma_S_total, and Delta_SP computed as Delta_SP*Sigma S\/Sigma_S_total. The billing manager may then generate consolidated billing information for the linked client accounts comprising three billing amounts (element ). One amount may be proportional to the private link traffic metric Sigma_P, and may be associated with A's account. A second amount may be proportional to Delta_SP, and also associated with A's account, while a third amount may be proportional to Delta_SP, and may be associated with A's account. If Delta_SP is not greater than zero, only the billing amount proportional to Sigma_P may be provided, as shown in element .","In embodiments where each of the clients A and A uses a respective logically-isolated network path sharing the private link , and link monitoring agents  are configured to break down the private link traffic by for each logically-isolated connection separately, the private link billing amount may be split up into two portions as well, one for each of the logically-isolated paths. In one embodiment, where a link monitoring agent  may not be able to distinguish the traffic of one logically-isolated path from that of another, the billing manager  may use ratio-based logic to split up the private link traffic between the two logically-isolated paths. That is, Sigma_P may be split into two components Sigma_P and Sigma_P, where Sigma_P is obtained as (Sigma_P*Sigma_S\/Sigma_S_Total), and Sigma_P may be obtained as (Sigma_P*Sigma S\/Sigma_S_Total).",{"@attributes":{"id":"p-0068","num":"0067"},"figref":["FIG. 11","FIG. 10"],"b":["116","116","1102","1104","1110","1120","1130","119"]},"If Delta_SP is greater than zero (as determined in element ), i.e., if the sum of the service-related traffic metrics for the two services exceeds the private link-related traffic, in the embodiment illustrated in  the billing manager  may apportion or distribute the excess service-related traffic between the two service types in the ratio of their respective service traffic metrics. That is, as shown in element , Delta_SP may be divided into two parts: Delta SPX computed as Delta_SP*Sigma_SX\/Sigma_S_total, and Delta_SPY computed as Delta_SP*Sigma SY\/Sigma_S_total. The billing manager may then generate billing information for the client account comprising three billing amounts (element ). One amount may be proportional to the private link traffic metric Sigma_P and the private link billing rate RP. A second amount may be proportional to Delta_SPX and RX, and a third amount may be proportional to Delta_SPY and RY. If Delta_SP is not greater than zero, only the billing amount proportional to Sigma_P may be provided, as shown in element .","In embodiments where each of the services X and Y are provided using a respective logically-isolated network path sharing the private link , and link monitoring agents  are configured to break down the private link traffic by for each logically-isolated connection separately, the private link billing amount may be split up into two portions as well, one for each of the logically-isolated paths. In one embodiment, where a link monitoring agent  may not be able to distinguish the traffic of one logically-isolated path from that of another, the billing manager  may use similar ratio-based logic as described above to split up the private link traffic between the two logically-isolated paths. That is, Sigma_P may be split into two components Sigma_PX and Sigma_PY, where Sigma_PX is obtained as (Sigma_P*Sigma SX\/Sigma_S_Total), and Sigma_PY may be obtained as (Sigma_P*Sigma SY\/Sigma_S_Total).","The various techniques used by billing manager in the examples described above to apportion summed traffic metrics for private links and for services may be combined as needed in different embodiments, based on the billing policies in place for a given client. In scenarios where different services have different billing rates for different clients over different time periods, the billing manager may have to perform ratio-based computations for each of the different time periods and each of the different clients and services. Despite the complexity of collecting hundreds or thousands of metrics from various agents for various clients, using a combination of the techniques described above the billing manager may be able to meet its goals of charging for network traffic on a fair and equitable basis, and avoiding over-charging any client or charging a client multiple times for the same traffic.","Example of Web-Based Interface for Billing Information",{"@attributes":{"id":"p-0072","num":"0071"},"figref":"FIG. 12","b":["116","116","1203","1200","1205","1207"]},"Area  may be provided to indicate the charges related to direct connect private links\u2014e.g., the total amount of direct connect traffic and the applicable rate may be shown. Area  may show the service-related billing information. In each case the client may be allowed to obtain a more detailed view of the summarized data, e.g., broken down at finer time granularity, by logically-isolated paths, or based on other criteria. Finally, a total amount for the billing period may be shown in an area  in the illustrated embodiment. The total amount may be divided into subcomponents indicating the contribution of the direct connect traffic and the service-related \u201cdifferential\u201d or \u201cexcess\u201d traffic as shown. In one embodiment a button  may be provided to allow the client to change settings, e.g., to request changes in the layout of the web page or to request billing policy changes.","Dynamic Bandwidth Management Using Routing Signals","When setting up their data centers and networks, and allocating resource collections and network paths to clients, provider network operators often install spare capacity. For example, even if a client needs no more than 500 megabits\/second of bandwidth, the provider network operator may set up gigabit\/second (or even ten gigabit\/second) network paths. This may be done for a variety of reasons: to ensure that spikes in customer demand can be handled, for example, or in anticipation of increased future steady-state demand, or because standard equipment (such as networking cables) may have a capacity that does not always match the exact client needs. Clients may also sometimes request that more resources (e.g., more or faster CPUs, memory or bandwidth) be allocated for them than they know they will consistently need, even in computing environments where they may be able to add resources fairly quickly. As a result, even in provider networks that support dynamic bring-up of resources, there may be underused resources from time to time. In one embodiment, as also described briefly earlier, a dynamic bandwidth management mechanism may be employed to inform clients about currently available bandwidth levels via routing signals.",{"@attributes":{"id":"p-0075","num":"0074"},"figref":["FIG. 13","FIGS. 4"],"b":["118","118","192","4","195","130","110","1310","132","118","117","118","121"],"i":["a ","b"]},"Based on its knowledge of the client's bandwidth management settings, and its knowledge of the measured traffic transmission rates, the DBM  may determine whether to inform the client that additional bandwidth is available. In one embodiment, the DBM  may be operable to determine whether a difference Delta_MP between a measured transmission rate of traffic over at least a portion of a network path linking the client network  to one or more resource collections  allocated to the client, and a peak transmission capacity of the network path, exceeds a threshold value T. If the difference Delta_MP exceeds T, the DBM  may initiate a transmission of a routing signal  to the client network  indicating that more bandwidth is available (i.e., bandwidth exceeding the current baseline allocated to the client is available). In some embodiments the DBM  may send a signal request  to an endpoint router , indicating the nature of the routing signal the endpoint router should send. In other embodiments, a signal request may be sent to any network device of the provider network that may be capable of sending a routing signal  to the client network , such as other routers, intelligent gateways, intelligent switches, and the like. In one embodiment the DBM  itself may be incorporated within a device capable of sending routing signals , in which case the DBM itself may transmit the routing signal . The portion of the network path where the transmission rate is measured may include one or more direct connect links in some embodiments, and may exclude direct connect links in other embodiments.","The routing signal  may comprise, in one embodiment, one or more messages formatted in accordance with a routing protocol such as the Border Gateway Protocol (BGP) or any other appropriate routing protocol. In one implementation in which BGP is used, a particular value or range of values of a BGP attribute such as the Multi-exit discriminator (MED) attribute or a community attribute (which may also be referred to as a communities attribute) may be used to indicate the availability of excess bandwidth. In some embodiments the Open Shortest Path First (OSPF) protocol may be used, and in other embodiments the Resource Reservation Protocol (RSVP) may be used.","In other embodiments the routing signal may comprise a set of advertised routing prefixes or addresses. For example, a BGP advertisement, indicating that packets targeted at address range 156.10.1.0\/24 (expressed in Common Internet Domain Routing or CIDR notation) should be directed towards a particular resource collection, may have been initially propagated from some set of routers such as endpoint router  and\/or other routers of the provider network. (In this example, the notation 156.10.1.0\/24 is interpreted as follows: the 156.10.1.0 indicates the starting address of a range of IP addresses; and the 24 specifies the decimal number of the leading bits of the routing prefix for that range. In this case the 24 leading bits imply that, in the range of IP addresses being advertised, the first three dot-separated digits are to remain constant\u2014156, 10, and 1 in this case, each accounting for 8 of the 24 bits. This leaves a range of 256 addresses covered by the range\u2014156.10.1.0 through 156.10.1.255.) By advertising additional addresses, say in the range 156.10.2.0\/24 (i.e., 156.10.2.0 through 156.10.2.255), 256 more addresses may be added to the set of addresses usable for the resource collections of the client, which may serve as an indication of additional available bandwidth. Other types of routing signals may be used in some embodiments.","The routing signal  may be sent to a client network router  as shown. Depending on the type of the routing signal used, the signal may be propagated to various other network devices\u2014for example, routing prefixes may be sent on to other client network routers or even routers beyond the client network. In some embodiments the receipt of the routing signal  at one or more networking devices in the client network  may result in changes in client application behavior\u2014e.g., more instances of an application or application component may be started up, the number of processing threads involved in a computation may be increased, and so on. In one embodiment, a reception of a routing signal at a client network device may in turn trigger messages or notifications being sent to other client devices or to client applications that indicate the change in available bandwidth, so that the targeted client applications or devices may perform operations to take advantage of the additional bandwidth. In some implementations the routing signal may specify not just the fact that additional bandwidth is available, but how much additional bandwidth is available.","In one embodiment the DBM  may also be responsible for providing indications of pricing changes that may be made in accordance with the changing bandwidth utilization. For example, the configuration settings for a client may include the currently acceptable maximum price the client is willing to pay for network usage. If a DBM  determines that there is sufficient spare bandwidth available (e.g., if the difference Delta_MP discussed above exceeds some pricing-related threshold T), the DBM  may be willing to offer the bandwidth at a lower price than the client is currently paying. In such an embodiment, the DBM  may also send a transmission of pricing information associated with the available transmission rate to the client. In some implementations, the DBM may initiate the sending of the pricing information, and the information may actually be sent by some other entity such as a billing manager . A client may thus be notified not only about the bandwidth available in such embodiments, but also about a price associated with using the bandwidth, so that a cost-benefit analysis of using the newly-available bandwidth is made easier. In some embodiments the DBM  may be configured to change the pricing information offered to a client based on the current network utilization levels\u2014e.g., if there is 1000 megabits\/sec of spare capacity, one price may be offered, and if there is 10000 megabits\/sec of spare capacity, the price may be lowered further. Thus the magnitude of Delta_MP may play a role in determining the pricing in such an embodiment. In one embodiment, the threshold T that may be used to make dynamic pricing modifications may itself be a function of Delta_MP\u2014e.g., the threshold may be reduced as Delta_MP increases. In various embodiments, the frequency at which DBM  makes decisions as to whether to send routing signals and\/or pricing information to clients may differ, i.e., the time intervals between such decisions may vary, based for example on factors such as how quickly bandwidth measurements happen to be changing, how frequently bandwidth measurements are received from various metering agents, the preferences of the clients, and so on.","In one embodiment a DBM  may be configured to provide signals or indications of a possible need to reduce network usage by clients. For example, in one scenario a DBM  may have previously signaled to a client A that additional bandwidth is available. The client A may as a result have increased its network usage, e.g., by starting up more threads of a network-intensive application. Over time, other traffic may also have increased over portions of the provider network and\/or the physical link set up for A. Consequently, when DBM  performs one of its subsequent computations to determine Delta_MP on behalf of the client A, it may find that Delta_MP has fallen to less than a second threshold T, indicating that the network path utilization may now be reaching higher than desired levels. In such a situation, the DBM  may send an indication of a reduction in available bandwidth to the client, or initiate the transmission of such an indication. In one implementation, the indication may comprise another routing signal, e.g., a BGP message with a particular attribute setting different than the setting used to indicate additional bandwidth availability. In another implementation, the indication may comprise dropping packets received from the client. If a protocol such as the Transmission Control Protocol (TCP) is being used, the dropping of packets received from the client may result in adjustments or reductions in subsequent transmission rates from the client, because of the flow control functionality built in to the protocol. A withdrawal of one or more networking prefixes or routes may be used in some embodiments to signal that client traffic should be reduced.","Client-Provided Dynamic Bandwidth Configuration Settings",{"@attributes":{"id":"p-0082","num":"0081"},"figref":["FIG. 14","FIG. 2"],"b":["1461","1405","118","118","201","118","121"]},"As shown, the settings notification  may comprise an identifier  of the client's account, and an indication of the baseline bandwidth  that the client is willing to pay for, or has contractually agreed to pay for. In some embodiments the settings notification  may include a maximum price  that the client is currently willing to pay for network bandwidth, i.e., at the time the settings notification is transmitted. In one embodiment the client may indicate a preferred signaling mechanism  for bandwidth modification signals\u2014e.g., the client may prefer that the BGP communities attribute be used to indicate that excess bandwidth is available, or that routing prefixes should be used. In some embodiments a client may also wish to indicate a preferred minimum duration  for a bandwidth modification. For example, a network-intensive application such as a climate simulation or a bioinformatics computation being run by the client may require that for a minimum amount of useful work to be done, a large data set that may take fifteen minutes to transfer over the network is needed. In such a scenario, while the client may be willing to make use of additional bandwidth to perform more computations, it may indicate a preference that the additional bandwidth, once provided to the client, remain available for at least fifteen minutes. Such a preference may be indicated using a preferred minimum duration field  in the settings notification. In one such embodiment the DBM  may, upon receiving such a duration preference, consult measurement metrics trends that it may maintain, e.g., within dynamic bandwidth management database , to estimate the probability that extra bandwidth will remain available to the client for the desired duration before making a decision whether to send a signal indicative of the extra bandwidth to the client. Additional settings, not shown in , such as preferences for times of the day (or days of the week) during which extra bandwidth could be used most effectively by the client, may also be communicated to DBM  as needed from time to time in some embodiments.","Methods for Remote Connectivity Operations",{"@attributes":{"id":"p-0084","num":"0083"},"figref":["FIG. 15","FIG. 15","FIG. 14"],"b":["130","110","1502","118","121"]},"As shown in element  of , the method may in one embodiment further comprise collecting network traffic metrics, e.g., with the help of link metering agents , service metering agents , and any other traffic monitors that may be configured to measure traffic flowing through various links and devices between the client network  and the resource collections  to which the client network is connected. Traffic measurements may be taken in accordance with a schedule in some embodiments, e.g., measurements collected over five-minute intervals may be provided to the dynamic bandwidth manager  and\/or stored in a metering database . The difference between the peak transmission capacity of a network path between a client network and the client's resource collections, and the measured traffic over at least a portion of the network path, may be obtained, as shown in element  of . If the difference exceeds a first threshold, as determined in element , a decision may be made to indicate to the client that additional bandwidth is available. A signaling mechanism to be used for communicating this information to the client may be selected (element ) in some embodiments, e.g., based on the client's preference settings or on an agreement reached beforehand with the client. A transmission of a routing signal indicating an available transmission rate that exceeds the baseline transmission rate of the client may be initiated by the dynamic bandwidth manager  (element ), e.g., in the form of one or more messages formatted in accordance with a routing protocol such as BGP from a router connected to the client network in some embodiments.","In one embodiment, if the difference between the peak transmission capacity and the measured traffic rates is found to be less than a second threshold (as determined in element  of ), a dynamic bandwidth manager  may initiate a transmission of an indication to the client that the client's traffic transmission rate should be reduced (element ). Such an indication may for example comprise dropping one or more network packets received from the client, sending routing protocol messages, and\/or changing routing prefixes. The client may reduce its subsequent traffic in response to the indication\u2014for example, in the case where packets are dropped, the software for a network protocol such as TCP that implements flow control may adjust the transmission rate downwards. If the difference between the peak transmission capacity and the measured traffic rates lies within an acceptable range (i.e., if it neither exceeds the first threshold nor is less than the second threshold), no signal or indication of bandwidth changes may be sent to the client until the next time the difference is computed.","In one embodiment, a dynamic bandwidth manager  may also be configured to make bandwidth pricing changes\u2014e.g., to reduce the price during periods when there is substantial excess bandwidth available, and to increase the price as the available bandwidth decreases. Such changes may be made and communicated to the client (element  of ) as needed. In some embodiments routing signals (e.g., BGP messages with certain attribute values) may be used for communicating price changes, while in other embodiments other means of communication may be used, such as an updated price made available via a web page or pages.",{"@attributes":{"id":"p-0088","num":"0087"},"figref":"FIG. 16","b":["1610","130","118","118","1620","118","1630"]},"Concurrently, the DBM  may monitor actual traffic at various points in the network (e.g., with the help of link metering agents , service metering agents , and\/or other traffic monitors), as well as any configuration preference changes communicated by the client (element ). If, based on its knowledge of the peak bandwidth capabilities of network paths, the difference between the peak and the measured transmission rates, and\/or the client's configuration settings, the DBM  makes a determination that a client should be notified about a change in the available bandwidth or pricing (element ), the DBM may send an indication of the bandwidth change and\/or pricing change to the client (element ). For example, a change in available bandwidth may be indicated using a message formatted according to a routing protocol in use, such as BGP, OSPF, or RSVP. The dotted lines between the left and right portions of  are intended to indicate the impact of the client's actions on the DBM , and the DBM's actions on the client. For example, the client's sending a notification of a change in its configuration settings may trigger the DBM to check whether the new settings and the current traffic measurements warrant an initiation of a routing signal or pricing notification; and the transmission of a routing signal from the DBM indicating a change in available bandwidth may trigger the client to check whether a change in the client's settings (such as an acceptable price or the baseline transmission level) is desirable.","Example Web Interface for Dynamic Bandwidth Interactions","In some embodiments the DBM  may be configured to implement one or more programmatic interfaces to communicate with the client regarding some of the functionality described above. For example, one or more application programming interfaces (APIs), command-line interfaces, graphical user interfaces (GUIs), and\/or web interfaces may be implemented.  is an illustration of a portion of an exemplary web-based interface that may be provided for dynamic bandwidth-related communications, according to some embodiments. Web page  may be used, for example, to provide bandwidth pricing history to clients, which may be helpful in their decisions on whether to utilize surplus bandwidth in the future. Such a web page may also allow clients to inspect their current dynamic bandwidth settings and initiate changes to the settings as desired.","As shown, the web page  may comprise a greeting area  welcoming the client. A graphical representation  of pricing history over a recent period may be provided in some embodiments. The client may be allowed to change the time period for which pricing history is displayed in some implementations, e.g., by selecting among choices such as \u201cLast 24 hours\u201d, \u201cLast week\u201d, \u201cLast month\u201d and so on. The graphical display may itself be updated in real time with the latest pricing information available in one implementation. The current bandwidth-related configuration settings of the client may be displayed in region . Such a region may include the client's billing account identification and a baseline bandwidth setting currently in effect for the client. In some embodiments the current settings for the maximum price the client is willing to pay may be included in the web page. In one embodiment a preferred signaling mechanism to be used to notify the client of changes to available bandwidth may also be included in the displayed settings. The client may be permitted to request that the settings be changed, e.g., by using a \u201cChange Settings\u201d button as shown. In some embodiments the client may be allowed to change values for various settings within a region , and the \u201cChange Settings\u201d button may lead to a confirmation page where the new settings are displayed and the client is requested to verify them before they are put into effect.","Example Use Cases","The techniques described above of providing differential metering and billing for direct connect links, and of dynamic bandwidth management, may be used in a variety of environments. For example, an operator of a provider network that is investing in the provision of dedicated direct connect links  may wish to increase the market penetration of the direct connect functionality and retain a high level of customer satisfaction from direct connect clients. In order to do so, the rates charged for direct connect data transmission may be set lower than the default rates charged for service-related data transmission in some embodiments, and direct connect clients may be informed that they will be charged at the (lower) direct connect rates for as much traffic as flows over the direct connect links, without being charged again for that same traffic at service-related rates at their resource collections. The functionality of providing consolidated billing for linked accounts, drill-down capabilities for getting billing details for different types of traffic, and billing at the level of logically-isolated paths may all help to make billing easier to manage and understand for customers. The ability of dynamic bandwidth managers to use routing signals to indicate changes in available bandwidth, and to use dynamically-modifiable client preferences in making pricing and bandwidth allocation decisions, may be very helpful for clients whose applications require large and\/or varying amounts of network data transfer.","Illustrative Computer System","In at least some embodiments, a server that implements a portion or all of one or more of the technologies described herein, including the techniques to implement an interface that defines various connectivity services and operations, and to receive and respond to various types of connectivity requests via the interface, may include a general-purpose computer system that includes or is configured to access one or more computer-accessible media, such as computer system  illustrated in . In the illustrated embodiment, computer system  includes one or more processors  coupled to a system memory  via an input\/output (I\/O) interface . Computer system  further includes a network interface  coupled to I\/O interface .","In various embodiments, computer system  may be a uniprocessor system including one processor , or a multiprocessor system including several processors  (e.g., two, four, eight, or another suitable number). Processors  may be any suitable processors capable of executing instructions. For example, in various embodiments, processors  may be general-purpose or embedded processors implementing any of a variety of instruction set architectures (ISAs), such as the x86, PowerPC, SPARC, or MIPS ISAs, or any other suitable ISA. In multiprocessor systems, each of processors  may commonly, but not necessarily, implement the same ISA.","System memory  may be configured to store instructions and data accessible by processor(s) . In various embodiments, system memory  may be implemented using any suitable memory technology, such as static random access memory (SRAM), synchronous dynamic RAM (SDRAM), nonvolatile\/Flash-type memory, or any other type of memory. In the illustrated embodiment, program instructions and data implementing one or more desired functions, such as those methods, techniques, and data described above, are shown stored within system memory  as code  and data .","In one embodiment, I\/O interface  may be configured to coordinate I\/O traffic between processor , system memory , and any peripheral devices in the device, including network interface  or other peripheral interfaces. In some embodiments, I\/O interface  may perform any necessary protocol, timing or other data transformations to convert data signals from one component (e.g., system memory ) into a format suitable for use by another component (e.g., processor ). In some embodiments, I\/O interface  may include support for devices attached through various types of peripheral buses, such as a variant of the Peripheral Component Interconnect (PCI) bus standard or the Universal Serial Bus (USB) standard, for example. In some embodiments, the function of I\/O interface  may be split into two or more separate components, such as a north bridge and a south bridge, for example. Also, in some embodiments some or all of the functionality of I\/O interface , such as an interface to system memory , may be incorporated directly into processor .","Network interface  may be configured to allow data to be exchanged between computer system  and other devices  attached to a network or networks , such as other computer systems or devices as illustrated in , for example. In various embodiments, network interface  may support communication via any suitable wired or wireless general data networks, such as types of Ethernet network, for example. Additionally, network interface  may support communication via telecommunications\/telephony networks such as analog voice networks or digital fiber communications networks, via storage area networks such as Fibre Channel SANs, or via any other suitable type of network and\/or protocol.","In some embodiments, system memory  may be one embodiment of a computer-accessible medium configured to store program instructions and data as described above for  for implementing embodiments of methods and apparatus for differential bandwidth metering for networks implementing direct peerings, and for dynamic bandwidth management in such networks. However, in other embodiments, program instructions and\/or data may be received, sent or stored upon different types of computer-accessible media. Generally speaking, a computer-accessible medium may include non-transitory storage media or memory media such as magnetic or optical media, e.g., disk or DVD\/CD coupled to computer system  via I\/O interface . A non-transitory computer-accessible storage medium may also include any volatile or non-volatile media such as RAM (e.g. SDRAM, DDR SDRAM, RDRAM, SRAM, etc.), ROM, etc, that may be included in some embodiments of computer system  as system memory  or another type of memory. Further, a computer-accessible medium may include transmission media or signals such as electrical, electromagnetic, or digital signals, conveyed via a communication medium such as a network and\/or a wireless link, such as may be implemented via network interface . Portions or all of multiple computer systems such as that illustrated in  may be used to implement the described functionality in various embodiments; for example, software components running on a variety of different devices and servers may collaborate to provide the functionality of the dynamic bandwidth manager and\/or the billing manager. In some embodiments network devices such as intelligent switches, routers, gateways or other appliances may be used.","Various embodiments may further include receiving, sending or storing instructions and\/or data implemented in accordance with the foregoing description upon a computer-accessible medium. Generally speaking, a computer-accessible medium may include storage media or memory media such as magnetic or optical media, e.g., disk or DVD\/CD-ROM, volatile or non-volatile media such as RAM (e.g. SDRAM, DDR, RDRAM, SRAM, etc.), ROM, etc, as well as transmission media or signals such as electrical, electromagnetic, or digital signals, conveyed via a communication medium such as network and\/or a wireless link.","The various methods as illustrated in the Figures and described herein represent exemplary embodiments of methods. The methods may be implemented in software, hardware, or a combination thereof. The order of method may be changed, and various elements may be added, reordered, combined, omitted, modified, etc.","Various modifications and changes may be made as would be obvious to a person skilled in the art having the benefit of this disclosure. It is intended to embrace all such modifications and changes and, accordingly, the above description to be regarded in an illustrative rather than a restrictive sense."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0005","num":"0004"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIGS. 4","i":["a ","b "],"b":"4"},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIGS. 6","i":["a ","b "],"b":"6"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 12"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 15"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 16"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 17"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 18"}]},"DETDESC":[{},{}]}
