---
title: Internet protocol telephony security architecture
abstract: A secure Internet Protocol (IP) telephony system, apparatus, and methods are disclosed. Communications over an IP telephony system can be secured by securing communications to and from a Cable Telephony Adapter (CTA). The system can include one or more CTAs, network servers, servers configured as signaling controllers, key distribution centers (KDC), and can include gateways that couple the IP telephony system to a Public Switched Telephone Network (PSTN). Each CTA can be configured as secure hardware and can be configured with multiple encryption keys that are used to communicate signaling or bearer channel communications. The KDC can be configured to periodically distribute symmetric encryption keys to secure communications between devices that have been provisioned to operate in the system and signaling controllers. The secure devices, such as the CTA, can communicate with other secure devices by establishing signaling and bearer channels that are encrypted with session specific symmetric keys derived from a symmetric key distributed by a signaling controller.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07568223&OS=07568223&RS=07568223
owner: General Instrumental Corporation
number: 07568223
owner_city: Horsham
owner_country: US
publication_date: 20040715
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCES TO RELATED APPLICATIONS","BACKGROUND OF THE INVENTION","BRIEF SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE INVENTION"],"p":["This application is a continuation of U.S. application Ser. No. 09\/546,900 filed Apr. 10, 2000, entitled INTERNET PROTOCOL TELEPHONE SECURITY ARCHITECTURE, which claims the benefit of U.S. Provisional Application 60\/128,772, filed Apr. 9, 1999, entitled INTERNET PROTOCOL TELEPHONE SECURITY ARCHITECTURE, each of which is hereby incorporated herein by reference in its entirety.","The disclosure relates to Internet Protocol telephony. More particularly, the disclosure relates to security in an Internet Protocol telephony network.","Communication systems, particularly communication networks enabled for public access, are configured to provide remote communications for users connected to the system. System operators may bill system users based in part on a perceived value of the communication services provided by the network or based in part on a level of network resources engaged in supporting a user communication. Some users may attempt to access the communication system in an unauthorized manner in an attempt to receive the benefits of the communication system without the corresponding cost.","The degree of effort an unauthorized user applies to accessing the system is typically proportional to the value associated with access to the system. For example, a highly secure network that provides a low value to an unauthorized user may be relatively immune from attacks by unauthorized users. In contrast, a relatively unsecured network that potentially provides high value to unauthorized users may constantly be targeted by unauthorized users.","A telephone system is an example of a communication system that provides varying level of services. Unauthorized user expend proportionate levels of effort in attempting to access those features of the system that are perceived as providing the highest value. Basic phone service is typically of lower value and is not often the efforts of unauthorized users. However, long distance service provided by the phone system has a much higher value and thus, is the goal of many attacks to the system.","The theft of network services can occur through many means. However, unauthorized system access is gained typically through the use of hardware clones or protocol attacks.","A hardware clone is a device that is configured to be virtually identical to an authorized device within the system. Unauthorized access to system services is gained by masquerading as an authorized user. Communication systems such as wireless telephone systems and satellite television systems were often the targets of unauthorized clone access during the early years of system implementation.","A protocol attack is based on exploiting a weakness in one or more protocols used in the communication system. A simplified example of a protocol attack is in a communication system that provides access based on password authentication. An unauthorized user may use various techniques in an effort to \u201cguess\u201d a correct password allowing access to the system. Alternatively, an unauthorized user may monitor a communication channel or link for the presence of an authorized user and record the communication messages transmitted by the authorized user when accessing the system. The unauthorized user may then retransmit or replay the communication messages from the authorized user to access the system.","Internet Protocol (IP) based networks are subjected to unauthorized intrusions and attacks in attempts to access services and data available on the network. IP telephony networks combine the services of previous IP and telephone networks while still allowing compatibility and access to legacy systems.","Because an IP telephony network can be configured to provide services of both legacy IP networks and Public Switched Telephone Networks (PSTN), the IP telephony network is likely to be the subject of attacks designed to provide unauthorized access. Therefore, it is desirable to have a secure IP telephony network architecture that is resistant to present and future intrusions.","A secure Internet Protocol (IP) telephony system, apparatus, and methods are disclosed. Communications over an IP telephony system can be secured by securing communications to and from a Cable Telephony Adapter (CTA). The system can include one or more CTAs, network servers, servers configured as signaling controllers, key distribution centers (KDC), and can include gateways that couple the IP telephony system to a Public Switched Telephone Network (PSTN). Each CTA can be configured as secure hardware and can be configured with multiple encryption keys that are used to communicate signaling or bearer channel communications. The KDC can be configured to periodically distribute symmetric encryption keys (called session keys) to allow devices that have been provisioned to operate in the system in order to be able to authenticate and to establish secure sessions with servers in an IP Telephony network. The secure devices, such as the CTA, can communicate with other secure devices by establishing signaling and bearer channels that are encrypted with session specific symmetric keys derived from the distributed symmetric key.","The disclosure includes secure IP telephony system including a Cable Modem Termination System (CMTS) configured to provide a communication interface between at least one Cable Telephony Adapters (CTA) and an IP telephony network, a signaling controller within the IP telephony network coupled to the CMTS and configured to generate a symmetric sub-key in response to a request from the at least one CTA, the request including a signaling controller ticket, the signaling controller further configured to distribute the symmetric sub-key to the at least one CTA in response to the signaling controller ticket, and a Key Distribution Center (KDC) within the IP telephony network and coupled to the signaling controller, and configured to generate and distribute the signaling controller ticket and a signaling controller session key to the at least one CTA using public key encryption.","The disclosure also includes a secure IP telephony system including a CTA coupled to an IP telephony network and comprising a public key and a corresponding private key of the same key pair and a public key certificate signed by a certificate authority, a KDC coupled to the IP telephony network and configured to generate a ticket to the CTA in response to a request from the CTA and distribute the ticket and corresponding session key to the CTA using public key encryption, and a signaling controller coupled to the IP telephony network and configured to receive the ticket and encrypted session key in a call set up request from the CTA and generate and distribute a symmetric sub-key to the CTA in response to the call set up request.","The disclosure further includes a method of securing communications in an IP telephony system, including receiving a session key, establishing a secure signaling session with a signaling controller, in part, using the session key, receiving a call-specific sub-key from the signaling controller, and establishing secure communications with a destination device using at least one symmetric key derived from the sub-key.","The disclosure further includes a method of securing communications in an IP telephony system, including receiving a ticket from a CTA, transmitting a signaling sub-key to the CTA, establishing secure signaling with the CTA based in part on the signaling sub-key, receiving from the CTA a request for a call set up with a destination device, generating a call specific sub-key, transmitting the call specific sub-key to the destination device, and transmitting the call specific sub-key to the CTA.","A secure network architecture for IP telephony is disclosed. The secure IP telephony architecture can be implemented in a secure IP telephony system, apparatus for use in a secure system, and methods embodied within the secure system. The secure IP telephony system is disclosed in relation to an IP telephony system implemented in a Hybrid Fiber Coax (HFC) system. However, the secure system is not limited to an HFC system and other system implementations are possible.","The secure system includes a number of encryption keys that are distributed between the various network elements in the secure IP telephony system. The encryption keys are used to ensure the security of signaling messages as well as the security of the bearer channel messages.","A Key Distribution Center (KDC) distributes symmetric encryption keys to the network elements using authenticated public key encryption. The use of public key encryption with authentication allows for nearly limitless scaling of the number of network elements without the associated security issues relating to the distribution and security issues surrounding manufacturing network elements having secure symmetric keys.","The KDC can distribute the symmetric keys by establishing a secure session with each network element. The identity of the network element can be authenticated by the KDC. The network element can be, for example, a Cable Telephony Adapter (CTA). The KDC can periodically update the symmetric keys to limit the effects of any compromise of a symmetric key.","A CTA can initiate a telephone call by securely exchanging signaling messages with its signaling controller using a shared symmetric key that it established earlier with the signaling controller, during a key management exchanged that was based on the CTA's signaling controller ticket and session key. Signaling controller generates a symmetric key specific for the call and distributes it to both the initiating and destination CTAs. Both the source CTA and the destination device use the call specific symmetric key to generate additional symmetric keys that are used for communication of bearer channel traffic.","The use of periodically updated symmetric keys that are used by the network elements to securely exchange call specific symmetric keys enables nearly all communications within the IP telephony system to be encrypted. The transient nature of the encryption keys helps to minimize unauthorized access through offline cryptanalysis.",{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 1","b":["100","100","100"]},"The secure IP telephony system  embodiment shown in  includes a network  interconnecting a plurality of Cable Telephony Adapters (CTAs) and Each CTA and is coupled to a corresponding Cable Modem Termination System (CMTS) and A CMTS or is a component that exchanges digital signals with the CTAs and on connected to the network . A CMTS and can be located at a local office of an IP telephony provider.","Multiple routers -can be configured to interface the particular elements on a branch of the network  with the other branches of the network . A first router is configured to interface with the first CMTS and a first signaling controller The first signaling controller is configured to interface with the first CTA via the first CMTS The first signaling controller can be configured to perform signaling related to, for example, call set up and tear down of calls over the network .","A second signaling controller is similarly coupled to a second router on another branch of the network . The second router is also coupled to a second CMTS and an associated second CTA ","A third router is configured as part of a network  branch that interfaces with external networks, such as an external Public Switched Telephone Network (PSTN) providing plain old telephone service (POTS). The third router is coupled to a third signaling controller The third router is also coupled to a POTS trunk gateway  and a POTS signaling gateway  that are configured to provide the interface for bearer traffic and signaling data, respectively.","A fourth router on a fourth network  branch is coupled to a Key Distribution Center (KDC) . The KDC  is configured to deliver symmetric encryption keys to the various CTAs and The KDC  in the embodiment of  is shown as a distinct element. In other embodiments, the KDC  can be co-located with a signaling controller, such as the first signaling controller The KDC  and first signaling controller can be, for example, implemented within the same piece of hardware, such as a server.","The communications across the various elements in the network  can be secured using encryption. The various signaling and bearer traffic messages communicated between devices can be encrypted, authenticated, or a combination of encrypted and authenticated. The security is based on Kerberos\u2122 where a KDC  distributes tickets and session keys to the CTAs and , so that they can use those tickets and session keys to establish secure signaling channels with the signaling controllers -, and then use those secure signaling channels to establish secure connections with other IP Telephony network entities such as the gateways  and  or other CTAs. The KDC  can utilize public key encryption to distribute session keys to CTAs.","In one embodiment, the KDC  and CTAs and use a Kerberos protocol with a Public Key Cryptography for Initial Authentication in Kerberos (PKINIT) extension for key management. This protocol is based on Kerberos tickets, which are similar to HTTP cookies, encrypted with the particular server's key. A Kerberos ticket is used to both authenticate a client, such as the first CTA , to a server, such as the first signaling controller , and to establish a shared session key contained in the ticket.","A Kerberos ticket contains a session key, identities of the client, such as CTA , and the server first signaling controller , and an expiration time. All of that information is encrypted using a secret key of the server, the first signaling controller Only the desired server, here the first signaling controller , is able to decrypt the ticket and use that information.","The same session key that is inside the ticket is also delivered by the KDC  to the client, the first CTA , sealed with the client's public key or with a secret derived from a Diffie-Hellman exchange. The first CTA can hand the session ticket to the first signaling controller to establish a session in which they share a symmetric session key.","The same signaling controller Ticket and session key can be reused for many phone calls over a configurable period of time on the order of days or weeks. The expiration time inside the ticket will prevent a CTA from using the ticket after it has expired. Once the ticket has expired, the CTA will need to perform another PKINIT exchange with the KDC .","The Kerberos Generic Security Services Application Programming Interface (GSS-API) standard can be used to access Kerberos services. The KDC  and CTAs and can use an extension of the GSS-API having an API for the PKINIT public key authentication.","The CTA, for example , can use two-way authentication with public key certificates to obtain a signaling controller Ticket from the KDC . The KDC  delivers the corresponding session key to the CTA sealed with a CTA RSA public key or with a secret derived from a Diffie-Hellman exchange.","The signaling controller ticket is kept for a relatively long period of time, on the order of days or weeks. However, the length of this period can be adjusted, based on the performance requirements. A more secure system may implement shorter durations for each signaling controller ticket. The signaling controller ticket is used to establish a symmetric session key, which is in turn used to establish a set of keys for use with the IPsec ESP mode. The keys used by IPsec may be limited to just a single telephone call or may be used for more than one telephone call. The IPsec keys are not derived from the session key itself. Rather, another random key, a sub-key, is generated for each phone call and then used to derive the IPsec keys.","The advantage of the first signaling controller generating IPsec keys only for the duration of the phone call, is that the signaling controller then does not have to maintain a state. After it derives all the required keys from the sub-key and exchanges signaling messages with the CTA , it can throw away the ticket along with all of the associated keys.","The first CTA presents to the first signaling controller a session ticket along with some data encrypted with the session key that authenticates the CTA in order to establish an IPsec ESP session. In a response, the first signaling controller returns a randomly generated sub-key, encrypted with the session key. The first CTA uses the sub-key to derive a set of required IPsec keys. The IPsec keys can include two Hash-based Message Authentication Code (HMAC) authentication keys and two triple Data Encryption Standard (3-DES) encryption keys. These IPsec keys are valid for only one telephone call.","For each call, the source signaling controller, here the first signaling controller , also randomly generates a sub-key for the CTA-to-CTA signaling and bearer channel communication and distributes it to the two CTAs, for example and . This key distribution is communicated outside of Kerberos and is done over already established IPsec ESP sessions between each CTA, for example , and its signaling controller, for example Both CTAs and engaged in a call derive a set of IPsec ESP keys for the CTA-to-CTA signaling messages and another set of keys for encrypting the RTP bearer channel packets.",{"@attributes":{"id":"p-0054","num":"0053"},"figref":["FIG. 2A","FIG. 1","FIG. 1"],"b":["150","150","100","150","150","150"]},"The KDC  includes a key module  configured to store one or more secure keys. In the embodiment shown in , the KDC includes a key module  configured to store an RSA key pair, which can include a public key and a corresponding private key. The keys can be constructed to be of a length sufficient to provide a level of security desired in the system. The keys can be, for example, RSA keys that may be 2048 bits in length.","The KDC  can also include a certificate module  configured to store one or more certificates issued and signed by one or more certificate authorities. The certificate module  can store, for example, a certificate that complies with X.509 Public Key Infrastructure (PKI) policies and practices. The certificate authority issuing and signing both device and KDC certificates can include, for example, a manufacturer or a network operator. This certificate module may store KDC's own certificate and a certificate of a CA that issued this KDC certificate. The certificate module may also store trusted CA certificates that can be used to validate CTA certificates, as they are received in the PKINIT request messages.","The KDC  also includes an encryption module  that can be configured to encrypt and decrypt messages using the keys stored in the key module . The encryption module  can also include a certificate from the certificate module  in order to allow transmitted messages to be authenticated by the destination device. The encryption module  can operate in conjunction with a processor  and memory .","The various modules within the KDC  can be part of a secure processor that is configured to provide physical security for the various keys, certificates, and processes performed by the KDC . The secure processor may be configured such that no secret cryptographic keys exist as clear text outside of the secure processor. The secure processor can provide a level of security that is at least at Federal Information Processing Standard (FIPS) 140-1 level 3.",{"@attributes":{"id":"p-0059","num":"0058"},"figref":["FIG. 2B","FIG. 1","FIG. 2B","FIG. 2C"],"b":["110","110","110","100","110","110"],"i":["a ","b "]},"The CTA  includes secure cryptography module  that may be configured to operate as a Cryptoki Application Programming Interface (API) in accordance with the PKCS-11 standard. The secure cryptography module  includes a secure microprocessor  operating in conjunction with a key module  and a cryptographic operation module . The key module  stores the RSA key pair used to communicate with the KDC during distribution of the symmetric keys and can be used to store the various symmetric keys that are received from the KDC and generated from the symmetric key distributed by the KDC. The key module  can store the RSA key pairs and the signed certificates in accordance with X.509.","The secure microprocessor  provides physical protection in the form of tamperproof hardware for the RSA private key that is used as proof of the CTA's identity. The secure microprocessor  complies with the FIPS 140-1 standard level 3, whenever sections of that standard are applicable. A private key is typically not updated without a secure transaction involving very strong cryptography.","A public root verification key is also stored in the key module  and is needed for the CTA  to validate KDC certificates. While this information is public, it conveys the identity of the KDC to the CTA , and is typically not updated without a secure transaction involving very strong cryptography. This is required to avoid the holder of a leased CTA  using it in a new network, without permission from the CTA owner, which may be for example a telephone company or other network operator. Thus, the root verification key is also stored inside the key module  of the secure microprocessor .","Access to this secure microprocessor  may be provided with a CryptoKi API, based on the PKCS-11 standard. The CTA  typically does not contain any debug or maintenance modes that bypass normal security procedures and allow extraction or updates to secret keys in a raw, unencrypted form.","As shown in , the CTA  receives downstream signaling messages that can be signed, encrypted, or a combination of signed and encrypted. The encrypted messages access the secure microprocessor  via the PKCS-11 API of the secure cryptography module . The secure microprocessor  operates on the secure messages using the cryptographic operation module  in conjunction with the keys stored in the key module  to decrypt the messages. The result is the clear text of the encrypted messages.","As shown in , the CTA  performs the complementary process by receiving clear text messages. The secure cryptography module , using the secure processor , encrypts the messages in the cryptographic operation module  using one or more of the keys stored in the key module . The CTA  provides the signed and encrypted upstream signaling message to a destination device connected to the network.",{"@attributes":{"id":"p-0066","num":"0065"},"figref":["FIG. 3","FIG. 1"]},"The flow diagram of  shows a PKINIT exchange that is performed at relatively long intervals. The process allows the KDC to distribute an intermediate symmetric session key. This session key is shared between the CTA and the signaling controller via the signaling controller ticket distributed by the KDC.","The signal flow begins with a CTA requesting a Kerberos ticket from the KDC using a PKINIT Request message . The request can include the name of the CTA and associated signaling controller, a time stamp, a nonce, signature, a CTA certificate, a list of trusted Certificate Authorities (CA), and optionally, Diffie-Hellman public key and associated parameters. The CTA certificate can be a certificate issued by a manufacturer or a certificate issued by the network operator. The certificate issued by the network operator can include a phone ID derived in part from the telephone number associated with the CTA. The certificate issued by the network operator can thus be limited to PKINIT exchanges within the domain controlled by the network operator.","In response, the KDC generates a PKINIT Reply message  directed to the CTA. The CTA receives the PKINIT Reply message  from the KDC having the requested signaling controller ticket. The PKINIT Reply message  includes the signaling controller ticket, a KDC certificate, Diffie-Hellman parameters, a PKINIT temp key. Alternatively, the PKINIT reply can be restructured so that the session key can be encrypted directly with the CTA public key or a key derived from a Diffie-Hellman exchange. The KDC can encrypt the signaling controller ticket, KDC certificate, Diffie-Hellman parameters and PKINIT temp key with a CTA public key or with a Diffie-Hellman key. The PKINIT Reply message  can also include a reply key, KDC signature, and nonce encrypted with the PKINIT temp key. The PKINIT Reply message  can also include a signaling controller session key and a key validity period encrypted with the reply key.","The PKINIT Request and Reply messages will be sent over a Transport Control Protocol\/Internet Protocol (TCP\/IP) connection. A single PKINIT Request or Reply message, containing a public key and Diffie-Hellman information is typically too large to fit into a single unfragmented User Datagram Protocol (UDP) packet. Off the shelf KDCs must support UDP, but normally require a TCP connection for messages that do not fit into one UDP packet. The use of TCP instead of UDP may have some impact on performance, but since the PKINIT exchange occurs at infrequent intervals, often days or weeks apart, and is not tied to the phone calls, this does not appear to be a problem. Alternatively, UDP with IP fragmentation can be used to send larger packets.","The signaling controller session key is used in the Kerberos Application (AP) Request  and AP Reply  messages that are exchanged to establish a symmetric sub-key for each phone call. This sub-key is used to derive all of the IPsec ESP keys and starting sequence numbers used in both directions. The AP Request and AP Reply messages are small enough to fit into a single UDP packet, and thus will run over UDP.","The CTA sends the Kerberos AP request  to the signaling controller to establish a session with the signaling controller. The AP request can include the signaling controller ticket received from the KDC, the CTA name, a timestamp, a Security Parameters Index (SPI) used to identify a security association for IPsec communications, and a hash. The message parameters are encrypted with the signaling controller session key corresponding to the specific signaling controller.","The SPI shown in the AP Request  is for the upstream CTA-to-SC messages. SPI+1 is the IPsec SPI for the corresponding downstream messages. Kerberos defines an application-specific Authorization Data field in the AP Request message . This field is used to carry the SPI.","The signaling controller is able to decrypt the ticket inside the AP request  message encrypted with its server key and is able to recover the signaling controller session key and other parameters contained in the ticket. In response to the AP request , the signaling controller generates an AP reply .","The CTA receives the AP reply  containing a time stamp and a randomly generated sub-key. The message parameters are encrypted with the signaling controller session key. The CTA can then establish an IPsec ESP session with the signaling controller","IPsec protocol in the ESP mode is used to secure all signaling messages between the CTA and the signaling controller. The IPsec ESP protocol includes authentication, privacy and replay prevention. IPsec ESP runs between the IP and transport protocol layers running TCP or UDP. IPsec provides Hash-based Message Authentication Code (HMAC) authentication of the IP packet payloads. IPsec provides packet encryption, for which 3-key 3-DES in the Cypher Block Chaining (CBC) mode may be used. Since IPsec runs at a low layer, where a sequence of packets is not guaranteed, an Initialization Vector (IV) is attached explicitly to each packet. This creates an 8-byte overhead for each IP packet. Another embodiment allows the IV to be derived implicitly from a packet sequence number and SPI.","In order to strengthen message authentication, each IPsec packet should be decrypted and authenticated by a secure microprocessor in one operation as shown in the CTA embodiments of . The secure processor implementation limits a hacker's ability to bypass message authentication by hacking the CTA software. If the CTA software is hacked to avoid the passage of an IP packet through a secure microprocessor, that packet is not decrypted and will be useless.","After setting up a session with a signaling controller, a CTA can establish a call with another CTA coupled to the network, a network server capable of communicating bearer channel traffic, or an off network device via a gateway server. The signaling controller associated with this CTA distributes keys and sets up each of these communication links in a similar fashion.",{"@attributes":{"id":"p-0079","num":"0078"},"figref":["FIG. 4","FIG. 1","FIG. 4","FIG. 3","FIG. 4"]},"As shown in the flow diagram of , a source CTA initializes the call through a source signaling controller. An end to end sub-key is communicated between the source and destination signaling controllers and the source and destination CTAs can set up the signaling and bearer traffic channel using symmetric keys generated from the end to end sub-key. Here, the end to end sub-key is used by the source and destination CTAs.","During each phone call, the source and destination CTAs exchange secure signaling and bearer channel messages. At the start of each phone call a source signaling controller generates a random CTA-to-CTA (end to end) sub-key and distributes it to both CTAs. The sub-key is distributed over IPsec ESP sessions previously established between each CTA and its respective signaling controller. Both CTAs then derive from the sub-key a set of IPsec ESP keys for signaling and RTP encryption keys for media packets.","Similarly, for the CTA-to-Other Network Server communication, the signaling controller generates a CTA-to-Server sub-key and distributes it to the CTA and the server. Both the CTA and the server derive a set of IPsec ESP keys from the end to end sub-key. Here, the end to end sub-key is used by the CTA and the server.","The CTAs are presumed to already have established a sub-key with the signaling controller and and set up a IPsec ESP session and with their respective signaling controllers.","The CTA can communicate to the signaling controller over the IPsec ESP session a desire to set up communications with a corresponding network server. To set up communications between a CTA and a corresponding network server, a set of IPsec ESP keys are established between the CTA and the corresponding server. The signaling controller associated with the CTA generates a new CTA-to-Server sub-key and delivers it to both the CTA and the corresponding network server. The signaling controller generates the sub-key and SPI and delivers it to the network server . The network server, in response, generates an ACK. The signaling controller receives the ACK from the network server . The ACK can include a hash of the received sub-key and SPI.","The signaling controller can also distribute to the initiating CTA the same sub-key delivered to the network server . The signaling controller receives an ACK from the initiating CTA  that can include a hash of the received sub-key and SPI.","From this sub-key, the server and the CTA derive IPsec ESP keys and other parameters. The derived set of IPsec ESP parameters for example may include two 160-bit SHA-1 HMAC keys, two 168-bit 3-key 3-DES keys, and two IPsec starting sequence numbers (SN), one for each direction.","The SN delivered along with the sub-key is associated with the CTA-to-Server (upstream) keys. SPI+1 is associated with the Server-to-CTA (downstream) keys.","After the CTA receives its CTA-to-Server sub-key and derives IPsec ESP keys from it, it is ready to communicate with that Network Server. Although the diagram shows that the CTA-to-Server signaling comes after all of the keys had been established, the IPsec ESP signaling can occur once the keys are derived by both the server and the associated CTA.","Similarly, for CTA to CTA communications, the source signaling controller generates a CTA-to-CTA sub-key and delivers it to the destination CTA via the destination signaling controller, and then to the source CTA. In response to a request from the source CTA to initiate communications with the destination CTA, the source signaling controller generates the CTA-to-CTA sub-key including the sub-key and SPI and delivers it to the destination signaling controller . The destination signaling controller forwards the message to the destination CTA .","The destination CTA generates an ACK addressed to the source signaling controller and delivers the ACK to the destination signaling controller . The destination signaling controller sends the ACK to the source signaling controller . The ACK can include, as was the case with the other ACK messages, a hash of the received sub-key and SPI.","The source signaling controller can also send to the source CTA the same sub-key and SPI  that was sent to the destination CTA. The source CTA responds by sending an ACK  having a hash of the sub-key and SPI.","From this sub-key, both CTAs derive a set of symmetric keys including IPsec ESP keys and parameters and RTP packet encryption keys. The derived IPsec ESP keys and other parameters may for example include two 160-bit SHA-1 HMAC keys, two 168-bit 3-key 3-DES keys, and two IPsec starting sequence numbers, one for each direction. The RTP packet encryption keys may include two 168-bit 3-key 3-DES keys and optionally RTP packet authentication keys.","The SPI delivered along with the sub-key is associated with the source CTA-to destination CTA keys. SPI+1 is associated with the destination CTA-to-source CTA (downstream) keys.","After the symmetric keys are delivered to the source and destination CTAs and the CTAs have derived the necessary symmetric keys, the source CTA and destination CTA can engage in secure communications. The source CTA can communicate signaling messages with the destination CTA via an IPsec ESP link . The source CTA can communicate bearer channel traffic with the destination CTA via encrypted RTP packets.","In other embodiments, the source CTA calls a regular phone in a PSTN, via a POTS Signaling Gateway. In that embodiment, the key distribution is almost identical, except that the destination CTA is replaced with the POTS Signaling Gateway.","Similarly, it is possible for a regular phone in a PSTN to call up a CTA, via a POTS Signaling Gateway. Again, the scenario is almost identical, except that the source CTA is replaced with the POTS Signaling Gateway.","The system ensures bearer channel privacy by implementing encryption of the RTP packets, including the header. This option is provided for in the standard RTP confidentiality option. The RTP headers can specify if encryption is enabled. However the RTP specification does not specify which key is used for encryption and how the keys are managed.","As discussed in the signal flow diagram of , each CTA may derive two 168 bit 3-DES keys from the CTA-to-CTA sub-key for the RTP layer encryption. A separate encryption key is used for upstream and downstream media packets. The IV (Initialization Vector) for the encryption of the cleartext block of an RTP packet can be set to 0, as defined in the RTP specification. This provides adequate security because the 64 bits of an RTP packet contain 48 bits of random information (16-bit sequence number initialized with a random value and a 32-bit timestamp). The encryption of the remainder of an RTP packet uses a standard Cipher Block Chaining (CBC) mechanism, where the previous ciphertext block is XOR-ed with the next cleartext block, before it is encrypted.","In the case that packet authentication is also desired, it is possible to derive additional MAC keys from the same CTA-to-CTA session keys, and attach a MAC to each packet, before it is encrypted. However, adding a MAC to each media packet adds significant overhead to the bearer channel traffic, particularly in bandwidth.","As shown in the signal flow diagram of , the source signaling controller distributes the 3-DES keys used for the bearer channel privacy, and thus has access to these keys in the clear. The signaling controller can save the keys for the duration of the call in order to satisfy Communications Assistance for Law Enforcement Act (CALEA) requirements.","The bearer channel key can be stored for later retrieval at the signaling controller or at any other network side element involved in the call. If the signaling controller stores the key at a remote network element location, the keys can be stored as an encrypted cookie, as in standard browser technology, because the remote network element has no need to know the bearer channel key in the clear.","End-to-end key negotiation or exchange that does not involve network servers would not have met CALEA requirements, where all encryption keys for the bearer channel must be made available to law enforcement from a reliable source.","To limit the ability of generic hardware to access the secure communication system, the elements in the secure IP telephony system need to be provisioned in a manner that allows access to the secure system.","For example, various keys and certificates are provisioned to each CTA. The keys include an RSA key pair that is used by the CTA in the PKINIT exchange. This key pair is installed at the factory. The CTA also includes an X.509 certificate issued by the network operator during the provisioning phase for the CTA RSA key pair. This certificate is good only for that one network operator.","During the PKINIT exchanges, the CTA will send out just its X.509 certificate signed by the network operator. There is no need to send a longer certificate chain, since the KDC should have the network operator's certificate. In order to improve the performance of the PKINIT exchanges, the KDC can cache a hash of each certificate, referred to as a certificate thumbprint, that was received from the CTA and successfully verified. The next time a certificate with the same hash is encountered, the verification can be omitted.","The CTA also includes an X.509 certificate issued at the factory and signed by the manufacturer. This certificate is configured to be valid for the lifetime of the CTA and is used to authenticate the CTA during the provisioning phase. The CTA also includes a manufacturer certificate, such as a manufacturer certificate issued by a root CA. This certificate is installed at the factory. Alternatively, if the CTA software is downloaded on-line, this manufacturer certificate can be embedded inside the CTA software. The certificate should be valid for at least the expected lifetime of the CTA.",{"@attributes":{"id":"p-0107","num":"0106"},"figref":["FIGS. 5A-5B","FIG. 5A","FIG. 1"]},"The states in the CTA HFC Access State Machine of  include a HFC Not Configured state . In this state, the CTA is not provisioned and has not yet tried to register with the HFC Head-End. The CTA remains in this state if an attempt to register with the HFC fails. The CTA is able to move to another state through successful registration, such as through DOCSIS registration.","The CTA can progress to an Unprovisioned HFC Access state . While in this state, the CTA is registered with the HFC Head-End, but there is no customer account set up. The HFC system can allow the CTA to register so that it can get access to the Customer Service Representative (CSR). The CTA in conjunction with a CSR provisions the CTA in both the telephony and HFC networks. The CTA remains in this state if a provisioning request is rejected. The CTA may progress to the next state by successfully setting up the CTA customer account.","In the Fully Registered with HFC state , the CTA is allowed to send packets anywhere within the telephony network. In order to get to this state, the CTA customer account was set up in the telephony network. The Provisioning CA in the telephony network has notified the HFC Head-End that CTA access to the telephony network should be fully enabled.","Alternatively, the CTA is integrated with the general purpose Cable Modem access. The Cable Modem has been registered for HFC access to some non-telephony network services such as Internet access.","The CTA can progress to the Provisioned HFC Access state . The CTA that was fully registered with HFC can progress to this state following a reboot. In the state, the CTA is given full access to the telephony network or some other network services. The CTA can be removed from this state and return to the HFC not configured state  if the CTA or the network requests de-provisioning of the CTA.","Once the CTA is provisioned for HFC access, the CTA can be provisioned for telephony access.  is a state machine for CTA telephony access. The states in the CTA Telephony Access State Machine begin at the Telephony I\/F Not Configured state  where the CTA is not provisioned for access and has not yet tried to register with the telephony network. The CTA remains in this state if a PKINIT exchange with a signaling controller fails.","The CTA can advance to an Unprovisioned Telephony Access state  if the CTA performs a PKINIT exchange with the signaling controller using a manufacturer-signed certificate. In this state, the CTA is granted the right to make a phone call to the CSR and maybe to call 911. If the Kerberos AP Request sent by the CTA to the signaling controller fails or is rejected, the CTA remains in this state. The CTA can also return back to the Telephony I\/F Not Configured state  if the Kerberos ticket received from the PKINIT exchange expires.","The CTA can advance to an Unprovisioned Telephony Security Context state  following a successful Kerberos AP Request\/Reply exchange with the signaling controller. To arrive at the state, the unprovisioned CTA went off-hook, at which time it used a Kerberos ticket from the PKINIT exchange to establish a set of keys for use with IPsec ESP. IPsec ESP sessions will be used for signaling messages with the signaling controller, the CSR's CTA or Telephony Gateway and possibly with some additional Telephony Network Servers. If the CTA call to the CSR fails, the CTA remains in this state. Additionally, if the IPsec security association expires, the CTA returns to the Unprovisioned Telephony Access State .","The CTA can advance to a Received Network Operator-Issued Certificate state . To get to this state, the CTA customer picked up the phone and called the CSR. The customer provided information such as the name, address, and credit card number to the CSR. The CSR entered this information into a database. As a result, both the Telephony Network and the HFC Network were reconfigured to allow access to this customer, and a Network Operator-issued X.509 certificate was sent down to the CTA. In this state, the CTA is fully provisioned for the telephony service, but typically can't gain access until it reboots.","The CTA can advance to the Provisioned Telephony Access  by rebooting after receiving a Network Operator-issued certificate. The next attempt by the CTA for a PKINIT exchange with the new certificate should grant it the ability to make telephone calls, based on the subscribed service options.","In the case that the CTA's privileges were revoked or if the customer simply discontinued service, a PKINIT exchange with the Network Operator-issued certificate will fail. That will cause the CTA to go back to the Telephony I\/F Not Configured state , where the CTA may get provisioned again.",{"@attributes":{"id":"p-0119","num":"0118"},"figref":["FIG. 6","FIG. 1","FIG. 6"],"b":["100","100"]},"The functional block diagram shows the portion of the secure IP telephony system  that includes the customer device  coupled to a CTA . The CTA  is coupled to a HFC head-end, which can be a CMTS . The CMTS  is coupled to a first router that is in turn coupled to a network , first signaling controller and first KDC ","A second branch of the network  is coupled to a second router that is also coupled to a second signaling controller , second KDC , POTS trunk gateway  and POTS signaling gateway .","The POTS gateways,  and  are coupled to a CSR center  that includes a CSR device , which may be a POTS phone at the CSR center, and a CSR terminal . The CSR center  is also coupled to a provisioning CA  that is coupled to a billing host .","In the functional block diagram of , the CTA  represents the device that is being provisioned. A customer can talk on the phone or customer device  connected to the CTA  that is being provisioned. The HFC head-end can include a CMTS , DHCP Server, TFTP Server, DNS Server and any other entity residing in the HFC Head-End. All of these have been merged into one line to make the diagram more compact. Details of the HFC Head-End provisioning are defined by DOCSIS.","The routers, such as the first router is configured to route IP packets between the HFC Head-End and the telephony network . In some embodiments, the first router can be located inside the HFC Head-End and maybe even merged with the CMTS . The second router is configured to route packets between the POTS Gateways,  and , and the IP Telephony network .","The KDCs and are configured to issue Kerberos tickets that are used to generate sub-keys for IPsec ESP and other secure connections: The first KDC is configured to interface with the CTA  and first signaling controller . The second KDC close to the CSR  is configured to communicate with the POTS Gateways  and .","The POTS Signaling and Trunk Gateways,  and  interface between the POTS network and the IP Telephony network . It is assumed on this diagram that the CSR center  uses a plain telephone . However, in other embodiments, the CSR center  is connected to a CTA (not shown) within the IP telephony network .","The CSR center  includes a terminal  that is configured to extract the information about the calling CTA  from the POTS Gateway  and  and is able to enter information into the Provisioning CA . Instead of a plain terminal it may be an operations support system (OSS).","The Provisioning CA  can be a Network Operator's Certification Authority that issues certificates to provisioned CTA or TA units. The Provisioning CA  can contain customer information such as a telephone number. It does other provisioning functions as well, such as deliver customer\/CTA information to other servers such as the Billing Host  and the signaling controller. There is typically only a single logical Provisioning CA  in a IP Telephony network, although the Provisioning CA  may be distributed across one or more devices in one or more network locations.","The Billing Host  is a host that is responsible for billing customers of the IP Telephony network. There is typically only a single logical Billing Host  in an IP Telephony network but it may distributed across multiple devices and multiple locations.",{"@attributes":{"id":"p-0130","num":"0129"},"figref":["FIG. 7","FIG. 6"],"b":"100"},"Furthermore, a CTA can either be integrated together with the Cable Modem, or it can be a separate device that plugs into the Cable Modem via an Ethernet or USB port. This device is referred to as a Telephony Adapter (TA). All of these options are covered by the flow diagram. The flow diagram omits some of the ACK messages for the sake of clarity.","The CTA provisioning begins when the CTA communicates with the HFC head-end and initializes unprovisioned HFC Access . This can be a standard DOCSIS registration process for a Cable Modem, in the case of an integrated CTA, or for an attached Customer Premises Equipment (CPE), in the case of a TA. Because the CTA or TA is not yet provisioned, it is assigned an unprovisioned IP address. The use of the unprovisioned IP address restricts the CTA to exchanging messages with a limited number of hosts or IP addresses, which may include the local signaling controller, the CSR, and the Provisioning CA. As part of the initialization process, the CTA downloads an appropriate version of the software that it needs for IP Telephony.","After initializing unprovisioned HFC access, the CTA communicates with the KDC and signaling controller to get Kerberos Ticket Using PKINIT . This process is similar to the PKINIT exchange described earlier. However, there are some differences. The certificate used by the CTA is the one that was installed in the factory, signed by the manufacturer. This certificate contains the CTA MAC address, which should be verified by the KDC.","The KDC can be configured to check with the HFC Head-End accessing, for example, a DHCP Server to determine whether the IP address is valid and if the MAC address in the certificate corresponds to that IP address and has not been marked as \u201cbad\u201d at the HFC Head-End. The HFC Head-End can be configured to employ some sort of a physical layer cloning detection scheme and that can identify whether the current unit is a clone.","The CTA manufacturer certificate is also sent in the PKINIT request. This certificate is used by the signaling controller to verify the signature on the CTA certificate. The obtained Kerberos ticket has additional information, which restricts the CTA to telephone calls to only a single destination, for example, the CSR. If desired, the unprovisioned CTA may be allowed to also call an emergency number, such as the 911 number. This restriction may be placed inside the authorization-data field inside the Kerberos ticket.","The signaling controller forwards the manufacturer-signed CTA Certificate to a provisioning CA . The manufacturer-signed CTA certificate, obtained by the signaling controller during the PKINIT exchange is passed on along with the CTA's unprovisioned IP address to the Provisioning CA. The provisioning CA saves this certificate and will later, when it receives customer information, uses it to generate another CTA certificate, specific to this telephone network.","The IP address of the signaling controller, which may be the same as the IP' address of the KDC, is also saved by the Provisioning CA, so that it can later inform the signaling controller of the telephone number of the newly provisioned CTA. The provisioning CA sends an approve or deny message back to the originating signaling controller .","The CTA can then establish IPsec ESP Session with the signaling controller . When the unprovisioned CTA or TA goes off-hook, an IPsec ESP session with the signaling controller is initialized. A Kerberos ticket is used in the AP Request\/AP Reply messages to mutually authenticate the CTA and signaling controller and to obtain a sub-key. The sub-key is used to derive the necessary keys for IPsec ESP.","The Kerberos ticket contains restrictions limiting the CTA to calls to the CSR and possibly the 911 number. The signaling controller is configured to enforce these restrictions on the subsequent calls from this CTA.","After establishing the IPsec ESP session with the signaling controller, the CTA proceeds to Setup a Call to CSR . In this step, signaling messages are exchanged, in order to establish a connection with a CSR, which may be a voice or data connection. The messages include CTA-to-SC, CTA to CTA messages and possibly signaling messages exchanged with another Network Server. The sub-key distribution for securing CTA to Network Server and CTA to CTA links are also included in this step. The signaling messages are sent over a secure IPsec ESP layer.","In another embodiment, the CTA software may be configured, so that when it is in an un-provisioned state, to automatically dial the CSR as soon as the phone goes off-hook. In such an embodiment, however, an un-provisioned CTA will not be able to dial 911. If emergency access is a requirement, then the CTA should be configured for the embodiment in which the CSR telephone number is entered manually.","After establishing a call to the CSR, the CTA can exchange Customer Information  over the encrypted RTP link established with the CSR. If the customer is performing his or her own installation, he or she provides customer information over the phone, including, for example, name, address, credit card number, and other parameters. The customer can also specify the type of desired service or desired options for service. The customer may also specify the desired telephone number if such an option is available in the particular IP Telephony network.","In another embodiment where an installer provisions the CTA in response to a work order number, all of the customer information and the CTA identity should already be available to the Network Operator from earlier communications scheduling the installer. At this time, the installer simply provides the work order number and a customer service representative is able to find all of the corresponding customer information.","In yet another embodiment, it is not necessary for a human customer service representative to answers the phone on the Network Operator side. Instead, the customer or installer may be directed to a voice menu, where all of the required information is entered through the telephone keypad. This embodiment may be especially convenient when an installer is calling with a work order number.","The customer information entered by the CSR is forwarded to the Provisioning CA , which assigns the customer a telephone number, appropriate for where the customer is located. The CSR determines the calling CTA's unprovisioned IP address, and forwards the address to the Provisioning CA along with the customer information. This information will enable the Provisioning CA to send messages to configure the calling CTA. The CTA IP address can also be used by the Provisioning CA to find the manufacturer-signed certificate for the calling CTA.","The CSR terminal in this case has the ability to display the IP address of the calling CTA. Alternatively, if the CSR is using a regular phone, connected to a PSTN Gateway, the CSR obtains the CTA IP address from the gateway in some other manner. For example, an OSS connected to the CSR's CTA or a PSTN Gateway automatically detects the IP address of the calling CTA and delivers it to the Provisioning CA.","The Provisioning CA updates the Billing Host  with the customer information and the assigned telephone number. The Billing Host sends an ACK  in response to successful receipt of the customer information.","The Provisioning CA then assigns New Telephone Number. The new telephone number and the corresponding MAC address found in the original manufacturer-signed CTA certificate are sent from the Provisioning CA to the signaling controller . The signaling controller can then be configured to accept a CTA certificate that contains that telephone number. The MAC address is used by the signaling controller to provision the necessary HFC resources for the CTA.","The signaling controller provisions the CTA for the required HFC resources. It sends to the HFC Head-End the CTA MAC address and routing information . The routing information can include valid source and destination IP addresses for this CTA. Other information may also be included for the HFC Head-End. After this step, the CTA is allowed to exchange messages with any provisioned node in the IP telephony network. The HFC Head-End sends an ACK message  to the signaling controller in response to successful receipt of the information.","The ACK is forwarded by the signaling controller to the Provisioning CA . The Provisioning CA then can complete provisioning by sending a new CTA certificate, signed by the new Network Operator, and containing identifying information for this telephone network, such as the phone ID. The phone ID may be a one-way function of the phone number, such as an SHA-1 hash, but is typically not the phone number itself which may be unlisted. The provisioning is completed in this step, after the CTA receives its new certificate and returns an ACK message . The Network Operator certificate needed by the CTA to verify the new CTA certificate should already be present in the CTA after the software code download. The CTA is now ready to place and receive telephone calls anywhere within this telephone network.","The CSR receives the actual telephone number from the Provisioning CA  and relays it over the phone to the CTA customer , along with information regarding how the customer will be billed. At this time, the CTA is fully provisioned.","If a new IP Telephony customer is registering with a particular Network Operator and the CTA is not brand-new out of the factory, the CTA is provisioned in a manner similar to that of a new device. The CTA may need to be re-provisioned if the CTA was previously used by the same customer with a different Network Operator, by a different customer with the same Network Operator, or by a different customer with a different Network Operator.","Regardless of how the CTA was used previously, the previous identity and the previous certificate issued by a Network Operator is still stored in the CTA. However, that certificate is no longer valid. The CTA should have been de-provisioned as described in relation to .","In this case, the CTA attempts to perform a PKINIT exchange using an old certificate that is no longer valid. The CTA will get an error back from the signaling controller. The CTA software will then automatically remove the invalid certificate and transition into an un-provisioned state. At this time, the CTA provisioning will proceed according signal flow for provisioning of a new CTA.","Just as devices are provisioned before being allowed access to the IP telephony network, devices can be de-provisioned to prevent unauthorized access to the network. The customer may discontinue telephone service for the CTA, or the customer may change an IP Telephony provider, or moving to a new location not supported by the current IP Telephony provider.",{"@attributes":{"id":"p-0156","num":"0155"},"figref":"FIG. 8","b":["802","810","820","822","824","830","826"]},"The signaling controller forwards the termination message to the HFC Head-End . The HFC Head-End returns an ACK to the signaling controller  and the signaling controller sends an ACK to the Provisioning CA . The CSR can then send a message or a voice confirmation to the CTA informing it that the service is terminated .","Next time that the CTA tries to use its Kerberos ticket before making a phone call, the ticket will be rejected because that phone number is no longer in the signaling controller's database. The rejection message will cause the CTA to try and obtain another Kerberos ticket. The CTA tries to perform a PKINIT exchange with its Network-Operator-signed certificate but will fail again. This will cause the CTA to remove the invalid certificate and transition into an un-provisioned state.",{"@attributes":{"id":"p-0159","num":"0158"},"figref":"FIG. 9"},"In this scenario, the customer calls up the CSR to request the changes in service. The CTA establishes an IPsec ESP session with the signaling controller , for example, by going off hook. The CTA can then set up a call with the CSR . The CTA can initiate a request over the encrypted RTP for the change in service . The CSR relays the change request message and associated information to the Provisioning CA . The Provisioning CA in turn sends the change request to the Billing Host . The Billing Host then replies with an ACK message . The Provisioning CA also sends the new service options to the signaling controller . The signaling controller sends the CTA MAC and any new HFC requirements to the HFC Head-End . The HFC Head-End returns an ACK message .","If necessary, Provisioning CA issues a new certificate to the CTA . The CTA may also be directed by the HFC Head-End to download a different version of the CTA software. The CSR can contact the CTA over the encrypted RTP and confirm service options updated . The HFC Head-End can initiate a reboot of the CTA . Once the CTA reboots, the CTA can initialize with a new software image  providing the desired services.","The CTA already possesses a Network Operator certificate, so that it is able to perform a signature verification check along with the time validity check on the new certificate. The time validity check will not only make sure that the issued certificate had not expired, it ensures that the new certificate's starting time is greater than the starting time of the old certificate thereby ensuring the new certificate is not a replay.",{"@attributes":{"id":"p-0163","num":"0162"},"figref":"FIG. 10"},"Following the segment move, the CTA connects to a different HFC Head-End that has not been previously provisioned for this CTA. Thus, the CTA is initialized with an un-provisioned IP address by the new HFC, Head-End .","The CTA proceeds with a PKINIT exchange with the signaling controller, using its current certificate, issued by the Network Operator . However, the new signaling controller does not recognize the certificate and the PKINIT exchange fails.","The CTA now falls back to a PKINIT exchange with the manufacturer-signed certificate . The manufacturer-signed CTA certificate, obtained by the signaling controller during the PKINIT exchange is passed on to the Provisioning CA by the signaling controller . The Provisioning CA doesn't actually need this certificate, because it already contains a CTA certificate for the old segment. However, this step is performed for consistency. The signaling controller performs this step for every un-provisioned CTA. Along with the CTA certificate, the signaling controller also sends the unprovisioned IP address for that CTA. The Provisioning CA sends an ACK  in response.","The IP address of the signaling controller, which may be the same as the IP address of the KDC, is saved so that it can later be informed by the Network CA about the new Customer ID of the newly provisioned CTA.","The CTA establishes an IPsec ESP session with the signaling controller when the unprovisioned CTA or TA  receives the Kerberos ticket. A Kerberos ticket is used in the AP Request\/AP Reply messages to mutually authenticate the CTA and signaling controller and to obtain a sub-key. This sub-key is used to derive the necessary keys for IPsec ESP. The Kerberos ticket contains restrictions, limiting the CTA to calls to the CSR and possibly the 911 number. The signaling controller enforces these restrictions on the subsequent calls from this CTA.","The CTA then sets up a call with the CSR . Signaling messages are exchanged in order to establish a voice connection with a CSR. This includes CTA to SC, CTA to CTA messages and possibly signaling messages exchanged with another Network Server. The sub-key distribution for securing CTA to Network Server and CTA to CTA links is also included in this step. The signaling messages are sent over a secure IPsec ESP layer.","The CTA then sends over the secure RTP link the updated customer information . The CSR will send the old telephone number and the new customer information to the Provisioning CA . The Provisioning CA will generate a new telephone number, based on the new customer location.","The Provisioning CA updates the Billing Host with the new customer information and with both the old and the new customer ID . The Billing Host sends an ACK in response to the information .","The Provisioning CA notifies the Old signaling controller that the old customer ID (phone number) is no longer authorized and should be removed from its database . The corresponding MAC address (found in the original manufacturer-signed CTA certificate) is also sent. This MAC address is used by the signaling controller to remove the HFC resources for this CTA in the old HFC Head-End.","The old HFC Head-End is notified by the signaling controller that the CTA MAC address is no longer provisioned for that particular HFC segment . The old HFC Head-End sends an ACK in response . Similarly, the old signaling controller sends an ACK to the Provisioning CA .","The Provisioning CA sends the new phone number and the corresponding MAC to the signaling controller . This will allow the signaling controller to accept a CTA certificate that contains the corresponding phone ID. The MAC address is used by the signaling controller to provision the necessary HFC resources for the CTA.","The signaling controller provisions the CTA for the required HFC resources. The signaling controller sends to the HFC Head-End the CTA MAC address and routing information , including a valid source and destination IP addresses for this CTA. Other information may also be required by the HFC Head-End. The HFC Head-End responds with an ACK message . After this step, the CTA is allowed to exchange messages with any node in the IP telephony network.","The Provisioning CA sends a new certificate signed by the new Network Operator and containing the new phone ID to the CTA . The CTA responds with an ACK message . Now, the CTA is ready to place and receive telephone calls anywhere within this telephone network. Finally, the CSR gets the new telephone number from the Provisioning CA  and relays it over the phone to the CTA customer .","In the situation where a CTA requires repair, the CTA is shipped to a repair facility. After the CTA is repaired, it may be tested within the IP telephony system. The CTA can be re-provisioned for a special account associated with that repair facility to ensure that the customer does not get billed for the telephone services that are being tested in the repair facility.","A test engineer blows away the customer certificate in the CTA, possibly through the front panel controls in the CTA. The customer is still provisioned and the certificate can always be loaded back from the network, as described earlier. The CTA enters the un-provisioned state (even though the customer is still provisioned) and will follow the provisioning steps detailed earlier. The CTA is now provisioned for the repair facility. Typically the new certificate is configured to have a short validity period ranging over a few days or even a few hours.","If the original CTA was broken and shipped to a repair facility and the repair facility sends a temporary loaner CTA to the customer, the replacement CTA goes through the same provisioning steps as a previously unprovisioned CTA.","Once a CTA is repaired and tested in the repair facility, it is returned to the customer. However, during the testing phase, the CTA certificate may have been replaced with the one for the repair facility. After the testing was completed, the test certificate is either deleted from the CTA, or the CTA could undergo the full de provisioning process.","The CTA can be reconfigured with the same customer's certificate before it is shipped back to the customer.  is a flow diagram of an embodiment of post repair CTA re-provisioning.","In the diagram, the CTA gets unprovisioned access to the HFC segment connected to the repair facility . The CTA performs an unprovisioned PKINIT exchange with the local signaling controller , which relays the manufacturer-signed CTA certificate to the Network Operator Provisioning CA . The Provisioning CA returns an ACK . In this case, the Provisioning CA has no use for this certificate, but accepts the message anyway for consistency. The signaling controller always sends this certificate for an unprovisioned CTA.","A technician at the repair facility then calls up the CSR. The CTA establishes an IPsec ESP session with the signaling controller  and a call is set up to the CSR . The technician can explain that the CTA has now been repaired and should be configured back with the owner's certificate . The CSR enters this request into the Provisioning CA , which sends the CTA the appropriate certificate . As with other provisioning scenarios, the CSR has to determine the unprovisioned IP address of the calling CTA and enter it into the Provisioning CA. This allows the Provisioning CA to find the CTA and send it the certificate. The CTA returns an ACK message  and the CSR can inform the technician calling from the CTA that the CTA is configured . At this point, the CTA is fully provisioned for its owner and will work in the provisioned state, once moved back to the HFC segment, where it is already provisioned.","A CTA, in addition to accessing telephony services, may also function as a general-purpose cable modem capable of accessing various network services connected to the HFC Head-End. The router at the HFC Head-End may contain an IP packet filter. Based on an IP address, the router can determine if an upstream packet should be allowed to continue on to a particular destination. Similarly, a downstream packet may be checked by the router, to see if it can be delivered to its destination IP address.","With no cryptographic protection, a CTA (or a CPE plugged into a CTA) can fake its IP address and thus gain unauthorized access to a particular part of the network. This threat exists even for unprovisioned CTA units. In the provisioning scenarios described earlier, the unprovisioned CTA is given some limited access to the HFC network so that the customer can call the CSR and register with the telephony network. A perpetrator might change the IP address of the unprovisioned CTA so that it appears to be provisioned and is able to access some network services.","This threat is not directed at the telephony services and may or may not be of concern to the HFC Head-End Operator. Thus the solutions to this problem that are described below are optional for an IP telephony system.","The Baseline Privacy Interface (BPI+) can be used to address this problem. BPI+ not only provides privacy, but is also able to implicitly authenticate the MAC address of each packet. This approach would require the HFC Head-End to keep a database that associates each cable modem MAC address with a list of IP addresses assigned to the cable modem and to its connected CPE devices. Thus, with the use of a database, the HFC Head-End would prevent a cable modem or a CPE from using fake IP addresses.","Another, more direct, approach is also possible. Each CTA, TA or any other CPE connected to a cable modem can be required to run an IPsec AH tunnel to the router. This means that the contents of each IP packet, along with the source and destination IP addresses would be authenticated. As long as each device has its own unique security association with the router, it would not be possible to use a fake IP address.",{"@attributes":{"id":"p-0189","num":"0188"},"figref":"FIG. 12"},"The PKINIT protocol is used by a device to obtain a Kerberos ticket for the router from the KDC. The device initiates a PKINIT request to the KDC  and receives a PKINIT reply  that includes the Kerberos ticket for the router. The device then presents this ticket to the router  and they establish a sub-key , used to derive all of the necessary IPsec AH parameters (SPI, 2 HMAC keys). The lifetime of the IPsec AH keys is completely unrelated to the telephone calls. In fact, the telephony interface may not be present in the device.","The functional block diagrams of the secure IP telephony systems shown in  do not represent the only possible IP telephony configurations.  is a functional block diagram of an embodiment of a Secure Gateway Control Protocol system . In the system  of , SGCP is selected for the signaling protocol and architecture. The security architecture disclosed above still applies, with some simplifications.","The SGCP IP telephony system  includes a first CTA coupled to a first CMTS . The first CMTS is coupled to a first call agent The call agent is coupled to the IP telephony network . Similarly, a second CTA is coupled to a second CMTS The second CMTS is coupled to a second call agent that is coupled to the IP telephony network . The IP telephony network  can also be coupled to a POTS trunk gateway  and a POTS signaling gateway .","In the SGCP system , each CTA -exchanges call signaling messages with the associated call agent or rather than with a signaling controller. To ensure system security, these messages should be authenticated and secured against both replay and sequencing attacks.","The security architecture will not change much for the SGCP signaling. The signaling controller is replaced with the call agent or , the SGCP equivalent. The SGCP-based architecture does not allow a CTA, for example , to exchange signaling messages with multiple network elements. Therefore, some simplifications to the previously discussed security architecture can be made. In general, the previously disclosed secure architecture applies with the signaling controllers replaced with the call agents of the SGCP architecture.","The call agent, for example , does not generate and distribute a sub-key for the CTA to Network Server signaling messages. In the SGCP-based architecture, the CTA does not talk to any network servers besides the call agent . Additionally, the CTA to CTA sub-key is used to derive only the keys used to secure RTP media packets. There are no CTA to CTA signaling messages to secure.","A secure IP telephony system, apparatus, and methods are disclosed. The secure IP telephony system can operate using any one of several different IP telephony signaling architectures. The system ensures security using a variety of encryption techniques associated with particular links of IP telephony signaling and bearer traffic communications.","The security architecture includes Kerberos key management with the PKINIT extension for initial authentication with public keys. The interface to the Kerberos protocol is the standard GSS-API. Kerberos protocol and makes use of tickets, which are encrypted cookies that do not require the servers to keep state. IPsec in the ESP mode is used to secure signaling protocol messages. Both encryption and authentication is enabled for each IP packet.","The system includes separate Kerberos KDC located near a signaling controller. For convenience, the KDC can be co-located on the same machine with the signaling controller.","All signaling messages can be authenticated and encrypted. The security of signaling messages involving the CTA includes CTA to signaling controller communications, signaling controller to CTA communications, CTA to other Network Server communications, other Network Servers to CTA communications, and CTA to CTA communications. Other signaling messages can also be secured.","PKINIT authentication between the CTA and the KDC occurs at infrequent intervals, at which time a CTA obtains a symmetric session key along with a Kerberos Ticket for the signaling controller. A Kerberos ticket contains a session key, identities of the client (CTA) and the server (signaling controller), and an expiration time. The information is encrypted using a secret key of the server (signaling controller). Access can be limited to the designated server (for example a signaling controller). At least the designated server is able to decrypt the ticket and use that information in the Kerberos ticket.","The same session key that is inside the ticket is also delivered by the KDC to the client (CTA), sealed with the client's public key or with a secret derived from a Diffie-Hellman exchange. Thus, after the CTA hands this ticket to the signaling controller, they share a symmetric session key. The same signaling controller Ticket and session key can be reused for many phone calls, over a configurable period of time, on the order of days or weeks. The expiration time inside the ticket prevents a CTA from using the ticket after it has expired. At that time, the CTA will need to perform another PKINIT exchange with the KDC in order to gain access to the system.","In order to establish an IPsec ESP session with the signaling controller, the CTA presents it a ticket along with some data encrypted with the session key which authenticates the CTA. In response, the signaling controller returns a randomly generated sub-key, encrypted with the session key. The sub-key is used to derive a set of IPsec keys including for example two HMAC authentication keys and two 3-DES encryption keys. These IPsec keys are valid for only one telephone call.","For each call, the source signaling controller also randomly generates a sub-key for the CTA to CTA signaling and bearer channel communication and distributes it to the two CTAs. This key distribution is outside of Kerberos and is done over already established IPsec ESP sessions between each CTA and its signaling controller. Both CTAs then derive a set of IPsec ESP keys for the CTA to CTA signaling messages and another set of keys for encrypting the RTP bearer channel packets.","Physical security is used to protect both the private keys and the long-term symmetric keys stored in the CTA. The keys can be protected inside a secure microprocessor that complies with the FIPS 140-1 standard at the security level  or higher.","The public key cryptosystem used for the PKINIT authentication to the KDC can be RSA. RSA can be used for digital signatures as well as for the delivery of a session key. Optionally, the session key is encrypted with a secret derived from an authenticated Diffie-Hellman exchange.","Signaling controller Tickets may be encrypted using a 3-key 3-DES server key. IPsec ESP mode utilizes 3-key 3-DES encryption keys in the CBC mode. Packets may be authenticated with a SHA-1 HMAC.","Each CTA includes an RSA key pair and a corresponding X.509 certificate. This key pair and certificate are installed at the time of manufacture. The CTA certificate from the manufacturer is used in the PKINIT exchanges during the provisioning phase. After the provisioning, the CTA will be issued another certificate for the same RSA public key by the network operator. The resulting certificate will contain the phone ID as a one-way function of the telephone number and can be used in the PKINIT exchanges within the issuing network operator's domain.","The PKINIT exchange can occur without the Diffie-Hellman option, in which case the same RSA key pair shall be used for both signing and encryption. With the Diffie-Hellman option the RSA key pair is used to authenticate the CTA.","The KDC includes an RSA key pair and a corresponding X.509 certificate. This key pair is used for authentication during the PKINIT exchange. The KDC will verify CTA certificates against a customer database, without a need for CRLs. Both the CTA certificate and a customer record should contain the same phone ID. CRLs are still used for revocation of network (KDC) certificates.","The above description of the disclosed embodiments is provided to enable any person skilled in the art to make or use the disclosure. Various modifications to these embodiments will be readily apparent to those skilled in the art, and the generic principles defined herein may be applied to other embodiments without departing from the scope of the disclosure. Thus, the disclosure is not intended to be limited to the embodiments shown herein but is to be accorded the widest scope consistent with the principles and novel features disclosed herein."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The features, objects, and advantages of embodiments of the disclosure will become more apparent from the detailed description set forth below when taken in conjunction with the drawings, in which like elements bear like reference numerals.",{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIGS. 2A-2C"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIGS. 5A-5B"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 12"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 13"}]},"DETDESC":[{},{}]}
