---
title: Apparatus for controlling printing, method for the same, printing system, and computer program
abstract: An apparatus for controlling printing allows the user to realize the occurrence of an error in real time and reliably notifies the system administrator of details output in an error information page. When the processing is stopped due to an error while print data is being created, the apparatus reads the details of an error definition form, which is defined in advance, creates the error information page, to which instructions to shift to an offline state are add if needed, and adds the error information page to the print data. A printer analyzes the print data. If the instructions are received to shift to the offline state, the printer shifts to the offline state. The user presses an online button so that the printer in the offline state outputs the error information page.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08107098&OS=08107098&RS=08107098
owner: Canon Kabushiki Kaisha
number: 08107098
owner_city: Tokyo
owner_country: JP
publication_date: 20041123
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DESCRIPTION OF THE EMBODIMENTS","First Embodiment","Second Embodiment","Third Embodiment","Fourth Embodiment"],"p":["1. Field of the Invention","The present invention relates to apparatuses and methods for controlling printing and computer programs. In particular, the present invention relates to an apparatus and method for controlling printing, a printing system, and a computer program that directly performs printing on a printing device from a web server.","2. Description of the Related Art","In a printing system comprising a personal computer (PC) and a printer, executing a printer driver for controlling a print process (a program for controlling printing) on the PC transmits print data from the program to the printer and instructs the printer to print the data. If the processing of the print data is stopped due to an error, the program typically transmits error information to the printer by attaching it to the print data (see, for example, Japanese Patent Laid-Open No. H07-72990).","Such error information typically includes information indicating details of printing requests, error numbers, error locations, and files associated with errors. The printer outputs the received print data and the received error information. The above process is performed by, for example, outputting a trace dump in a PostScript printer or outputting error histories in a facsimile.","In the trace dump outputting, the error information is output after the print data that was originally requested is output. Therefore, a user who requests printing does not realize the occurrence of an error until the user receives print matter that is fully output. This operational flow applies to the outputting of error histories in a facsimile. There is a problem in that, since the user does not realize an error has occurred, it is difficult for the user to deal with the error promptly.","In known printing systems, there is also a problem in that it is difficult to determine whether the error information is inserted into a plurality of output print data sets.","To avoid these problems, in a situation where print data is created, when an error occurs, a method of simultaneously displaying the error information with warning dialogues and a method of notifying the user of the occurrence of the error by e-mail are known. However, in a printing system in which printing is directly performed from a web server in an intranet or the Internet by the use of the Internet Printing Protocol (IPP), a client, who makes a printing request, and a web server that receives the request and creates print data, operate in an asynchronous fashion. Therefore, there is a problem in that it is difficult to notify the user of the error information in real time. There is also a problem in that notification by e-mail lacks synchronism.","The present invention aims to solve the above problems. The present invention provides an apparatus and method for controlling printing, a printing system, and a computer program that are capable of informing a user of the occurrence of an error in a printing process in real time and of reliably notifying a system administrator of the details output in an error information page.","According to an aspect of the present invention, an apparatus for controlling printing transmits a document print job to a printing device being in the online state. The apparatus includes: a print data creating unit for creating a second print data set for performing overlay processing based on a document form and a first print data set; a retrieving unit for retrieving error information on an error when the error occurs while the document print job is being created; an error information page creating unit for creating an error information page containing the error information retrieved by the retrieving unit and instructions to shift the printing device to an offline state; an adding unit for creating a third print data set by adding the error information page created by the error information page creating unit to the second print data set; and a transmitting unit for transmitting the third print data set created by the adding unit as the document print job to the printing device.","According to the present invention, the error information for the occurrence of an error in a print data creating process is added to the end of the print data set that is correctly output as an error information page, which is dedicated to the error information. Moreover, for outputting the error information page, the printer is shifted to the offline state and, upon the user switching to the online state, the error information page is output, so that the user can be informed of the occurrence of an error in real time.","The system administrator is notified of the details output in the error information page so that reliable recovery from errors is achieved.","Other features and advantages of the present invention will be apparent from the following description taken in conjunction with the accompanying drawings, in which like reference characters designate the same or similar parts throughout the figures thereof.","Embodiments of the present invention will be described with reference to the drawings.","In a first embodiment, a printing system includes a client computer system and a web print server, and both the client and the web print server are connected to a network or networks. In this printing system, the client makes a printing request to the web print server to print a document, and the web print server receives the request and sends document print data to a printer.",{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIGS. 1A and 1B"},"A computer system  is essentially composed of: a central processing unit (CPU) ; a main memory unit including a read-only memory (ROM)  and a random-access memory (RAM) ; an external memory unit including a floppy disk (FD) drive , a hard disk (HD) drive , and the like; an input unit including, for example, a keyboard  and a pointing device, such as a mouse ; a display unit including a display ; a printing unit including a printer  and\/or a plotter; and a system bus  connecting these units. The computer system  and other computer systems are connected to each other by network buses.","The computer system  operates by executing a basic I\/O (input\/output) program, an operating system (OS), and a control program by the CPU . The basic I\/O program is stored in the ROM , and the OS is stored in a hard disk in the HD drive . When the power of the computer system  is turned on, the OS is loaded into the RAM  from the hard disk in the HD drive  by initial program loading (IPL) of the basic I\/O program and the OS then starts running.","In this embodiment, the control program and related data are stored in an FD .  shows the contents of this data storage. A storage area  of the FD  contains an area  for volume information, an area  for directory information, an area  for a control program execution file, and an area  for a control program-related data file.","As shown in , the control program execution file and the control program-related data file stored in the FD  can be loaded into the computer system  with the FD drive . When the FD  is placed in the FD drive , the control program and the related data are read out from the FD  under the control of the OS and the basic I\/O program and then loaded into the RAM  so as to be made operable.","The control program and the related data may be stored in the hard disk or a compact disc (CD).",{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 3","b":"103"},"In a storage area  of the RAM , a basic I\/O program , an OS , and a printing process control program  are stored, and a data area  and a work area  are assigned. The control program execution file in the FD  is stored in the printing process control program , whereas the control program-related data file is stored in the data area .","In this embodiment, the control program and the related data are loaded directly into the RAM  from the FD . It is possible to use the hard disk in the HD drive  shown in . In this case, the control program execution file and the control program-related data file read out from the FD  may be temporarily stored (installed) in the hard disk in the HD drive , and then, both may be loaded into the RAM  from the hard disk in the HD drive  when the control program is executed. Examples of media for storing the control program include a CD-ROM and a memory card, in addition to an FD. The control program may be stored in the ROM  so as to serve as a part of the memory map and be executed directly by the CPU .",{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 4","b":"110"},"The printer  includes a controller , a panel , and a printer engine . The printer engine  generates a latent image on a photoconductor drum by a known electrophotography process on the basis of image data (binary data or multi-value data), and transfers it to a sheet of paper, and fuses it so as to print it. The panel  serves to interface with the user (operator) and is composed of a liquid crystal panel portion having a touch sensor (not shown) and a keyboard. The user can provide the printer  with instructions to perform a predetermined task by operating the panel .","The controller  controls the panel  and the printer engine  and exchanges data with an external unit group.",{"@attributes":{"id":"p-0036","num":"0035"},"figref":["FIGS. 5A and 5B","FIGS. 5A and 5B"]},"In the printing system, a composite document comprising a plurality of document forms and constituting a single print job is subjected to printing processing. For the entry process, the document forms are sequentially entered in page order, and an error definition form in which necessary items as error information and offline settings are defined is entered as the last page, and therefore, a composite document control file is created.","For the printing process, the document forms are sequentially read out from the composite document control file, and each form is combined with substantial print data so as to create an overlay document form. If an error occurs, an error information page is created based on the error definition form, error information, and instructions on offline settings. The error information page is added to the overlay document form that is correctly created.","The Entry Process","Firstly, in step S of , the control program is executed in the web print server so as to enter a document form to be added to a print job. Secondly, in step S, it is determined whether all entries are completed. If not, the processing returns to step S and continues entering document forms. This entry process may be replaced with an editing process in which a document form is edited in the web print server, or another entry process in which a document form is read out from a medium storing the document form, such as an FD, in order to enter it.","If it is determined in step S that all entries are completed, the processing moves to step S. In step S, the control program displays a predetermined dialogue used to define the error definition form on the display  so as to accept input from the user. The user inputs desired information in the dialogue using the keyboard  and\/or the mouse  of the web print server so as to define a panel message, which is displayed on the panel of the printer when an error occurs, and whether the printer is shifted to the offline state when the error occurs. If selecting a shift to the offline state, the user defines a way to return to the online state. The user has the option of returning to the online state by manual operation return (\u201cmanual\u201d), automatic return upon expiry of a designated time period (\u201cautomatic\u201d), or the like. If the automatic return is selected, the user designates the time period (second(s)) (the time-out second(s) for automatic return).","In step S, the settings of the document forms constituting the print job and the error definition form attached to the end of the document forms, both being prepared in the previous steps, are saved in the composite document control file.","The Printing Process","The printing operations of the composite document control file according to this embodiment are described next with reference to .","In step S, the web print server receives a printing request from the client. The printing request includes the designation (pathname) of print data, the user name, the type of document to be output, and the name of a target printer. The web print server retrieves a document form from the read composite document control file on a one-by-one basis and sequentially combines it with its designated print data so as to create print data in overlay document form. In step S, it is determined whether the creation of print data in overlay document form with respect to all document forms has been completed. If so, processing moves to step S.","If it is determined that the creation of print data in overlay document form with respect to all documents has not been completed, processing proceeds to step S. In step S, it is determined whether the creation of print data in overlay document form up to this step is completed correctly. If so, the processing returns to step S, which executes the creation of print data in overlay document form with respect to the next document form. If it is determined that the processing has been stopped due to an error, error information, such as the type (number) of the error and a location of the error (line number in the document), in the printing process is collected in step S. The collected error information is temporarily saved in the memory.","In step S, the web print server temporarily saves the printing request (the user name, the type of document to be output, and the target printer name) received from the client in the memory, as in step S.","In step S, file property information required for printing the document, such as the pathname for the print data, the creation time, and attributes of write and read, is retrieved from the printing request, which is temporarily saved. The retrieved file property information is temporarily saved in the memory, as in step S.","In step S, the details of the error definition form of the composite document control file are read in order to determine whether instructions to shift to the offline state are selected. If not, processing moves to step S. If so, in step S, an offline shifting command for forcibly shifting the printer to the offline state is edited based on the offline settings (manual\/automatic for return, time-out second(s) for automatic return, and a panel message) shown in .","In step S, an error information page is created based on the error information saved in the memory in steps S to S and the offline shifting command in accordance with the format shown in . This creation process is overlay processing using forms and print data, as in the case of the creation process in step S.","Subsequent to the correct output of the overlay document forms, which are created by repeating the processing of step S, the error information page created in step S is added so as to constitute a single print data set (composite form definition file) (step S). The created composite form definition file is transmitted directly to the printer from the print server by, for example, the use of the IPP (step S). The transmitted print data set is analyzed in the controller of the printer, and the printer is forcibly shifted to the offline state when the offline shifting command is detected and, at the same time, the strings that are designated in the error definition form appear on the panel as a panel message. When the printer is shifted to the offline state, a beeping sound is usually produced at the same time. When the printer is in the offline state, the user views the panel message and then presses an online button and the error information page is output. Therefore, the user can realize that the printing process based on the request from the server has been stopped due to an error. In the case in which the automatic return to the online state is selected, the printer in the offline state is automatically returned to the online state in a predetermined period and the error information page is output. This is effective when a user who requests printing has to leave the printer. If instructions to shift to the offline state are not contained, the error information page is output subsequently to the print data that is correctly output, as in a general printing process.",{"@attributes":{"id":"p-0050","num":"0049"},"figref":["FIG. 6","FIG. 6","FIG. 6"]},{"@attributes":{"id":"p-0051","num":"0050"},"figref":["FIG. 7","FIG. 7"]},"In the first embodiment, the document forms constituting the print job, and the error definition form are combined into the single composite form definition file, and this composite form definition file is printed. In a second embodiment of the present invention, a printer driver installed in the client is used to perform the settings.","In this case, the client displays a property dialogue for the offline settings, which corresponds to the error definition form, on the basis of execution of the printer driver, and selects the type of shift to the offline state in accordance with input from the user. Since the error information items vary among applications, defining them may be omitted. If an error occurs in the printing process executed by an application in the client, an offline shifting command is generated when printing application programming interface (API) AbortDoc for aborting printing is performed, and the command is added to print data. The print data is then sent to the printer via the web print server.","According to this embodiment, the printer driver controls the processing when an error occurs, and therefore, a dedicated composite form definition file is not necessary. The printer can be shifted to the offline state with respect to printing from any application. As a result, application-independent error handling is achieved.","In the above embodiments, the web print server saves the error definition form and creates the error information page when an error occurs. The error definition form may be held in the printer. In this case, the printer stores the error definition form in a storage device (not shown). When an error occurs in the printing process, the error is analyzed. The results are sent to the error definition form to create the error information page, and the created error information page is added to the end of the print data.","The error definition form may include information about the type of printing paper, in addition to the instructions to shift to the offline state. For example, when the printer has a plurality of paper trays, one paper tray is dedicated to error information printing and holds a different type of (e.g., red) paper. For setting the error definition form in the web print server, the paper tray dedicated to the error information is designated as a target paper tray for printing the error information page. Therefore, when a plurality of documents are printed in a setting in which automatic return to the online state after an error occurs is selected, the user can readily find a printing error from among the plurality of documents.","As many apparently widely different embodiments of the present invention can be made without departing from the spirit and scope thereof, it is to be understood that the invention is not limited to the specific embodiments thereof except as defined in the appended claims.","This application claims priority from Japanese Patent Application No. 2003-400745 filed Nov. 28, 2003, which is hereby incorporated by reference herein."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIGS. 1A and 1B"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIGS. 5A and 5B"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 7"}]},"DETDESC":[{},{}]}
