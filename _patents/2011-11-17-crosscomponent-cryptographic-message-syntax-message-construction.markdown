---
title: Cross-component cryptographic message syntax message construction
abstract: Often, for reasons of wireless bandwidth conservation, incomplete messages are provided to wireless messaging devices. Employing cryptography, for confidentiality or authentication purposes, when including a received message that has been incompletely received can lead to lack of context on the receiver's end. By automatically obtaining the entirety of the message to be included, an outgoing message that includes the received message can be processed in a manner that securely and accurately represents the intended outgoing message. Alternatively, a server can assemble a composite message from a new message and an original message and, in cooperation with a wireless messaging device, construct a cryptographic message syntax message.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08983070&OS=08983070&RS=08983070
owner: BlackBerry Limited
number: 08983070
owner_city: Waterloo
owner_country: CA
publication_date: 20111117
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","DETAILED DESCRIPTION OF THE EMBODIMENTS"],"p":["The present application claims priority from U.S. Provisional Patent Application Ser. No. 61\/415,103, filed Nov. 18, 2010, the contents of which are hereby incorporated herein by reference.","The present application relates generally to mobile wireless electronic messaging and, more specifically, to constructing a cryptographic message syntax message with the involvement of more than one component.","In one manner of processing (e.g., signing) an outgoing e-mail message, a communication application, employed by a given user, generates a hash (also called a \u201cdigest\u201d) of the outgoing e-mail message and signs the hash of the outgoing e-mail message using a private key half of a public-private key pair. The signed hash of the outgoing e-mail message may then be transmitted along with the outgoing e-mail message as a signature. Upon receiving the e-mail message, the recipient may be provided with a degree of certainty that the received e-mail message originated with the given user by generating a hash of the e-mail message, decrypting the signature using a public key half of the public-private key pair and finding that the hash of the e-mail message matches the result of the decrypting.","When a mobile wireless device is used to receive and transmit e-mail, the mobile wireless device is often associated with a mobile mail server. The mobile mail server manages the transmission of messages to the mobile wireless device to optimize use of the limited resources of a wireless communication channel in the path between the mobile wireless device and the mobile mail server. The mobile mail server may also manage messages transmitted by the mobile wireless device to optimize in a similar fashion.","For a first example of optimization of transmission of messages to the mobile wireless device, by only transmitting an initial portion of a first e-mail message to the mobile wireless device, the mobile mail server may conserve wireless resources that would otherwise be consumed by transmitting the entire first e-mail message.","It is common, in e-mail communication applications, to include the text of a received e-mail message when composing an e-mail message in response or when forwarding the e-mail message to a further recipient. However, in a mobile communication system, when sending a new e-mail message related to an original e-mail message, the mobile wireless device may only be able to include the initial portion of the original e-mail message in the new e-mail message, since the mobile wireless device may only have the initial portion of the original e-mail message available. Upon receiving the new e-mail message, the cleverly designed mobile mail server may append the remaining (i.e., non-initial) portion of the original e-mail message before forwarding the entire new e-mail message toward its destination. Conveniently, this scheme conserves wireless communication channel resources.","However, when a user of the mobile wireless device wishes to sign the new e-mail message, obtaining the efficiency of previously described schemes becomes challenging.","For example, consider receipt, at the mobile wireless device, of an initial portion of a first e-mail message. The user of the mobile wireless device reviews the initial portion of the first e-mail message and composes a response to the first e-mail message. The response may be considered a second e-mail message. The second e-mail message may be considered to have at least two portions: an \u201cold\u201d portion, comprising the initial portion of the first e-mail message; and a \u201cnew\u201d portion, comprising the content composed by the user of the mobile wireless device. The user of the mobile wireless device may decide to sign the second e-mail message. Accordingly, when obtaining a signature to associate with the second e-mail message, the mobile wireless device may only obtain a hash of the second e-mail message (i.e., the old portion appended to the new portion). That is, the mobile wireless device encrypts a hash of the second e-mail message with the private key stored at the mobile wireless device. The mobile mail server would normally append the remaining (i.e., non-initial) portion of the first e-mail message to the received second e-mail message to form a complete response, before forwarding the complete response to the origin of the first e-mail message. However, since the signature received in association with the second e-mail message only relates to the old portion appended to the new portion, and not to the complete response, the mobile mail server must simply forward the second e-mail message and associated signature toward the origin of the first e-mail message.","At the origin of the first e-mail message, the recipient of the second e-mail message does not receive all of the typically appended first e-mail message content and, accordingly, may struggle with the placing of the second e-mail message properly in context.","To provide awareness to the sender of the second e-mail message (i.e., the user of the mobile wireless device) that the second e-mail message will include only a truncated version of the first e-mail message, the mobile wireless device may display a warning dialog. The warning dialog may be displayed responsive to the user of the mobile wireless device indicating, using a user interface in a message composition mode, that the second e-mail message is to be sent. The warning dialog may indicate \u201cWarning! Your message will be truncated.\u201d Furthermore, the warning dialog may be interactive and may require user selection of a choice before the warning dialog may be dismissed from the display. That is, the warning dialog may present choices labeled \u201cOK\u201d and \u201cCancel\u201d. Additionally, the warning dialog may include a checkbox labeled \u201cDon't show this dialog again\u201d. The user may select the \u201cOK\u201d choice to indicate acceptance of the truncation. Alternatively, the user may select the \u201cCancel\u201d choice to indicate a wish to return to composing the message. By selecting the checkbox labeled \u201cDon't show this dialog again\u201d and then selecting the \u201cOK\u201d choice, the user may effectively set a policy for the mobile wireless device, where the policy indicates that all future signed, and\/or encrypted, messages are to include only a truncated version of the original received message.","Upon receiving an indication that the user has selected the \u201cOK\u201d choice, the mobile wireless device may proceed to transmit the second e-mail message to the mobile mail server for forwarding to the sender of the first e-mail message.","Upon receiving an indication that the user has selected the \u201cCancel\u201d choice, the mobile wireless device may return the user interface to the message composition mode. Responsive to being returned to the message composition mode, the user may manipulate the user interface to copy, to a clipboard, the message that has been typed (i.e., the new portion). The user may then close the message composition user interface, return to a message list and re-open the first message. Once the initial portion of the first message is open, the user may manipulate a message viewing user interface to request, from the mobile mail server, the entire first message. The user may then manipulate the message viewing user interface to indicate a wish to compose a response to the first message. Once the message composition user interface has been opened, pre-loaded with the entirety of the first e-mail message, the user may paste the previously composed new portion from the clipboard to the message composition area in the message composition user interface, thereby creating a third e-mail message. The third e-mail message may be distinguished from the second e-mail message in that the third e-mail message includes the entirety of the first e-mail message and the second e-mail message only includes a truncated version of the first e-mail message. The user may then create a signature for the third e-mail message and indicate that the third e-mail message and the signature are to be sent.","One can see that including an entire original message in a signed response can require manually carrying out some potentially tedious and complex steps.","A server can assemble a composite message from a new message and an original message and, in cooperation with a wireless messaging device, construct a cryptographic message syntax message.","In an aspect of the present disclosure there is provided a method of processing an electronic message at a mobile wireless communication device. The method includes detecting receipt of an instruction to transmit a composite message, where the composite message includes a new message and an original message, creating a cryptographic message syntax (CMS) message, the CMS message having a data structure wherein a predetermined field is intentionally left empty, transmitting the new message to a server associated with the mobile wireless communication device and transmitting a message processing request to the server, the processing request including the CMS message and specifying the original message. In other aspects of the present application, a mobile wireless communication device is provided for carrying out this method and a computer readable medium is provided for adapting a processor to carry out this method.","In another aspect of the present disclosure there is provided a method of processing an electronic message. The method includes detecting receipt of a message processing request for transmission of a composite message, where the composite message includes the new message and an original message, the message processing request including the new message, an indication of the original message and a cryptographic message syntax (CMS) message, the CMS message having a data structure wherein a predetermined field is intentionally left empty. The method also includes creating the composite message from the new message and the original message, processing the composite message to cause formation of further data, inserting the further data into the predetermined field in the data structure in the CMS message and transmitting the CMS message. In other aspects of the present application, a mail server is provided for carrying out this method and a computer readable medium is provided for adapting a processor to carry out this method.","Other aspects and features of the present invention will become apparent to those of ordinary skill in the art upon review of the following description of specific embodiments of the invention in conjunction with the accompanying figures.","Referring to , an overview of an example system for use with the embodiments described below is shown. One skilled in the art will appreciate that there may be many different topologies, but the system shown in  helps demonstrate the operation of the systems and methods described in the present application. For example, there may be many mobile communication devices connected to the system that are not shown in the overview of .",{"@attributes":{"id":"p-0038","num":"0037"},"figref":"FIG. 1","b":["100","100"]},"The mobile communication device  may, for example, be connected to an Internet Service Provider on which a user of the system of , likely the user associated with the mobile communication device  illustrated in , has an account.","The mobile communication device  may be capable of sending and receiving messages and other data via wireless transmission and reception, as is typically done using electromagnetic waves in the radio frequency (RF) spectrum. The exchange of messages and other data may occur, for instance, between the mobile communication device  and a base station in a wireless carrier network . The mobile communication device  may receive data by other means, for example through a direct connection to a port provided on the mobile communication device . An example of such a direct connection is a Universal Serial Bus (USB) link.","As illustrated in , the wireless carrier network  connects to a wide area network , represented as the Internet, via a wireless infrastructure . The wireless infrastructure  incorporates a wireless gateway  for connecting to the Internet .","A connection between the mobile communication device  and the Internet  allows the mobile communication device  to access a wireless mail server . The wireless mail server  may include a processor  and a memory . The wireless mail server  may be grouped together with other servers (not shown) in an enterprise . Also connected to the Internet  may be a representative message origin . The mobile communication device  may store a private cryptographic key  that is associated with a corresponding public cryptographic key.",{"@attributes":{"id":"p-0043","num":"0042"},"figref":["FIG. 2","FIG. 2"],"b":["100","100","224","226","226","224","228","224","226","228","226","100","224","224","226","224","226","226"]},"The housing may be elongated vertically, or may take on other sizes and shapes (including clamshell housing structures). Where the keyboard  includes keys that are associated with at least one alphabetic character and at least one numeric character, the keyboard  may include a mode selection key, or other hardware or software, for switching between alphabetic entry and numeric entry.","In addition to the processor , other parts of the mobile communication device  are shown schematically in . These may include a communications subsystem , a short-range communications subsystem , the keyboard  and the display . The mobile communication device  may further include other input\/output devices, such as a set of auxiliary I\/O devices , a serial port , a speaker  and a microphone . The mobile communication device  may further include memory devices including a flash memory  and a Random Access Memory (RAM)  and various other device subsystems . The mobile communication device  may comprise a two-way radio frequency (RF) communication device having voice and data communication capabilities. In addition, the mobile communication device  may have the capability to communicate with other computer systems via the Internet.","Operating system software executed by the processor  may be stored in a computer readable medium, such as the flash memory , but may be stored in other types of memory devices, such as a read only memory (ROM) or similar storage element. In addition, system software, specific device applications, or parts thereof, may be temporarily loaded into a volatile store, such as the RAM . Communication signals received by the mobile device may also be stored to the RAM .","The processor , in addition to its operating system functions, enables execution of software applications on the mobile communication device . A predetermined set of software applications that control basic device operations, such as a voice communications module A and a data communications module B, may be installed on the mobile communication device  during manufacture. A Cryptographic Message Syntax module C may also be installed on the mobile communication device  during manufacture, to implement aspects of the present disclosure. As well, additional software modules, illustrated as an other software module N, which may be, for instance, a PIM application, may be installed during manufacture. The PIM application may be capable of organizing and managing data items, such as e-mail messages, calendar events, voice mail messages, appointments and task items. The PIM application may also be capable of sending and receiving data items via a wireless carrier network  represented by a radio tower. The data items managed by the PIM application may be seamlessly integrated, synchronized and updated via the wireless carrier network  with the device user's corresponding data items stored or associated with a host computer system.","Communication functions, including data and voice communications, are performed through the communication subsystem  and, possibly, through the short-range communications subsystem . The communication subsystem  includes a receiver , a transmitter  and one or more antennas, illustrated as a receive antenna  and a transmit antenna . In addition, the communication subsystem  also includes a processing module, such as a digital signal processor (DSP) , and local oscillators (LOs) . The specific design and implementation of the communication subsystem  is dependent upon the communication network in which the mobile communication device  is intended to operate. For example, the communication subsystem  of the mobile communication device  may be designed to operate with the Mobitex\u2122, DataTAC\u2122 or General Packet Radio Service (GPRS) mobile data communication networks and also designed to operate with any of a variety of voice communication networks, such as Advanced Mobile Phone Service (AMPS), Time Division Multiple Access (TDMA), Code Division Multiple Access (CDMA), Personal Communications Service (PCS), Global System for Mobile Communications (GSM), Enhanced Data rates for GSM Evolution (EDGE), Universal Mobile Telecommunications System (UMTS), Wideband Code Division Multiple Access (W-CDMA), High Speed Packet Access (HSPA), etc. Other types of data and voice networks, both separate and integrated, may also be utilized with the mobile communication device .","Network access requirements vary depending upon the type of communication system. Typically, an identifier is associated with each mobile device that uniquely identifies the mobile device or subscriber to which the mobile device has been assigned. The identifier is unique within a specific network or network technology. For example, in Mobitex\u2122 networks, mobile devices are registered on the network using a Mobitex Access Number (MAN) associated with each device and in DataTAC\u2122 networks, mobile devices are registered on the network using a Logical Link Identifier (LLI) associated with each device. In GPRS networks, however, network access is associated with a subscriber or user of a device. A GPRS device therefore uses a subscriber identity module, commonly referred to as a Subscriber Identity Module (SIM) card, in order to operate on a GPRS network. Despite identifying a subscriber by SIM, mobile devices within GSM\/GPRS networks are uniquely identified using an International Mobile Equipment Identity (IMEI) number.","When required network registration or activation procedures have been completed, the mobile communication device  may send and receive communication signals over the wireless carrier network . Signals received from the wireless carrier network  by the receive antenna  are routed to the receiver , which provides for signal amplification, frequency down conversion, filtering, channel selection, etc., and may also provide analog to digital conversion. Analog-to-digital conversion of the received signal allows the DSP  to perform more complex communication functions, such as demodulation and decoding. In a similar manner, signals to be transmitted to the wireless carrier network  are processed (e.g., modulated and encoded) by the DSP  and are then provided to the transmitter  for digital to analog conversion, frequency up conversion, filtering, amplification and transmission to the wireless carrier network  (or networks) via the transmit antenna .","In addition to processing communication signals, the DSP  provides for control of the receiver  and the transmitter . For example, gains applied to communication signals in the receiver  and the transmitter  may be adaptively controlled through automatic gain control algorithms implemented in the DSP .","In a data communication mode, a received signal, such as a text message or web page download, is processed by the communication subsystem  and is input to the processor . The received signal is then further processed by the processor  for output to the display , or alternatively to some auxiliary I\/O devices . A device user may also compose data items, such as e-mail messages, using the keyboard  and\/or some other auxiliary I\/O device , such as a touchpad, a rocker switch, a thumb-wheel, a trackball, a touchscreen, or some other type of input device. The composed data items may then be transmitted over the wireless carrier network  via the communication subsystem .","In a voice communication mode, overall operation of the device is substantially similar to the data communication mode, except that received signals are output to the speaker , and signals for transmission are generated by a microphone . Alternative voice or audio I\/O subsystems, such as a voice message recording subsystem, may also be implemented on the mobile communication device . In addition, the display  may also be utilized in voice communication mode, for example, to display the identity of a calling party, the duration of a voice call, or other voice call related information.","The short-range communications subsystem  enables communication between the mobile communication device  and other proximate systems or devices, which need not necessarily be similar devices. For example, the short-range communications subsystem may include an infrared device and associated circuits and components, or a Bluetooth\u2122 communication module to provide for communication with similarly-enabled systems and devices.","In overview, the mobile communication device  receives an initial portion of a first e-mail message from the wireless mail server , where the first e-mail message has originated at the representative message origin . The user of the mobile communication device  manipulates the mobile communication device  to invoke a message composition user interface preloaded with the received initial portion of the first e-mail message and composes a new portion. Where the user has specified that the message is to be processed (e.g., signed and\/or encrypted), responsive to the user indicating that the message is to be sent, aspects of the present disclosure allow for the processing of a new message that includes the new portion and the entirety of the first e-mail message.","For example, the message composition user interface may allow the user to specify that the message is to be signed. Typically, when the user has indicated that the message is to be sent, the message composition user interface prompts the user for a password associated with a key store in which the private cryptographic key  is stored. Upon verifying a received password, the processor  executes a message signing algorithm to generate a signature by, first, generating a hash of the message and, second, encrypting the hash with the private cryptographic key .","In a first cross-component message processing approach, some automation is provided to the complex operations. Responsive to the user indicating that a reply message with truncated original message is to be sent, it is proposed herein to prompt the user with a dialog that includes a user option to \u201cDownload Original\u201d. Responsive to receiving an indication that the \u201cDownload Original\u201d user option has been selected, the processor  may automatically download the remainder of the original message and append the remainder of the original message to the reply message. The processor  may then sign, encrypt or sign encrypt the reply message with the entire original message before sending, thereby providing full, end-to-end security.","Steps of a method that is an example of a first cross-component message signing approach are presented in . Initially, the processor , or, more accurately, a signature handling application executed on the processor , detects receipt (step ) of an instruction to transmit a response message and an associated signature. Such an instruction may be received from the message composition user interface application also executed on the processor .","From the user's perspective, the user has specified that the response message is to be signed and the user has composed the new portion of the response message (in any order). The user may have configured the mobile communication device , at some earlier time, to, by default, transmit an associated signature with each outgoing messages. The receipt (detected in step ), by the signature handling application, of the instruction to transmit a response message and an associated signature may be triggered by the user opening a menu and selecting a \u201csend\u201d menu item.","Responsive to the detection in step , the signature handling application may present (step ) a dialog to warn the user that the first e-mail message will be incompletely included in the response message and giving the user choice regarding how or whether to proceed. An example of a suitable dialog is illustrated as a dialog  in . The dialog  is illustrated as being displayed on the display  of the mobile communication device .","As has been discussed above, the dialog  may include choices labeled \u201cOK\u201d and \u201cCancel\u201d. Furthermore, according to an aspect of the present disclosure, the dialog  may include another choice, labeled \u201cDownload Original\u201d.","It is expected that the user of the mobile communication device  will interact with the dialog  to select one of the choices. Accordingly, the signature handling application may receive (step ) an indication of the user selection and determine (step ) which of the choices the user has selected. Upon determining (step ) that the user has selected the \u201cCancel\u201d choice, the signature handling application may return (step ) control to the message composition user interface.","Upon determining (step ) that the user has selected the \u201cOK\u201d choice, the signature handling application may generate (step ) a signature for the response message. To distinguish this signature from an alternative signature to be discussed hereinafter, this signature may be termed a \u201cresponse\u201d signature. The response signature is a result of encrypting a hash of the response message, where the response message includes the new portion, recently composed by the user of the mobile communication device , and the initial portion of the first e-mail message (i.e., not the entire first e-mail message). The signature handling application may then arrange the transmission (step ) of the response message and the response signature.","Upon determining (step ) that the user has selected the \u201cDownload Original\u201d choice, the signature handling application may obtain (step ) the remainder of the first e-mail message from the wireless mail server  and form (step ) a \u201cnew\u201d message. The new message may be formed from the new portion, recently composed by the user of the mobile communication device , and the entirety of the first e-mail message, obtained in step . The signature handling application may then generate (step ) a signature for the new message. To distinguish this signature from the \u201cresponse\u201d signature, this signature may be termed a \u201cnew\u201d signature. The new signature is a result of signing a hash of the new message. The signature handling application may then arrange the transmission (step ) of the new message and the new signature.","Additionally, the warning dialog  may include a checkbox labeled \u201cAlways download original\u201d. By selecting the checkbox labeled \u201cAlways download original\u201d and then selecting the \u201cDownload Original\u201d choice, the user may effectively set a policy for the mobile wireless device, where the policy indicates that all future signed, and\/or encrypted, messages are to include the entirety of the original received message.","As a further alternative, the dialog  may include a checkbox labeled \u201cAlways send truncated\u201d (not shown). By selecting the checkbox labeled \u201cAlways send truncated\u201d (not shown) and then selecting the \u201cOK\u201d choice, the user may effectively set a policy for the mobile wireless device, where the policy indicates that all future signed, and\/or encrypted, messages are to include only a truncated version of the original received message.","Apart from the dialog , the user may be provided with an opportunity to establish a policy through editing a policy through use of a configuration options user interface. Such a configuration options user interface may allow the user to specify a size threshold for the original message so that an original message exceeding the size threshold is not automatically downloaded in its entirety for inclusion in the new message.","Notably, the automatic downloading of the original message may be accomplished on a background thread so that the user does not have to wait for the original message to be downloaded before carrying out further activities on the mobile communication device . Responsive to indicating that the message is to be sent, the user may be prompted for a signing password, but the cryptographic key, for signing a hash of the new message, would not be used until after the original message has been downloaded.","Notably, the original message may not always be downloaded immediately. The mobile communication device  makes use of a data network connection to download the original message. Accordingly, in the absence of a data network connection, the mobile communication device  waits until a data network connection has been established, before downloading the original message.","The first cross-component message signing approach may be adapted for message encryption instead of, or in addition to, message signing. Steps of a method that is an example of adapting the first cross-component message signing approach to encryption are presented in . Initially, the processor , or, more accurately, an encryption handling application executed on the processor , detects receipt (step ) of an instruction to transmit an encrypted response message. Such an instruction may be received from the message composition user interface application also executed on the processor .","From the user's perspective, the user has specified that the response message is to be encrypted and the user has composed the new portion of the response message (in any order). The user may have configured the mobile communication device , at some earlier time, to, by default, encrypt each outgoing messages. The receipt (detected in step ), by the encryption handling application, of the instruction to transmit an encrypted version of the response message may be triggered by the user opening a menu and selecting a \u201csend\u201d menu item.","Responsive to the detection in step , the encryption handling application may present (step ) a dialog to warn the user that the first e-mail message will be incompletely included in the response message and giving the user choice regarding how or whether to proceed. An example of a suitable dialog is illustrated as a dialog  in . The dialog  is illustrated as being displayed on the display  of the mobile communication device .","As has been discussed above, the dialog  may include choices labeled \u201cOK\u201d and \u201cCancel\u201d. Furthermore, the dialog  may include another choice, labeled \u201cDownload Original\u201d.","It is expected that the user of the mobile communication device  will interact with the dialog  to select one of the choices. Accordingly, the encryption handling application may receive (step ) an indication of the user selection and determine (step ) which of the choices the user has selected. Upon determining (step ) that the user has selected the \u201cCancel\u201d choice, the encryption handling application may return (step ) control to the message composition user interface.","Upon determining (step ) that the user has selected the \u201cOK\u201d choice, the encryption handling application may encrypt (step ) the response message. The encryption handling application may then arrange the transmission (step ) of the encrypted response message.","Upon determining (step ) that the user has selected the \u201cDownload Original\u201d choice, the encryption handling application may obtain (step ) the remainder of the first e-mail message from the wireless mail server  and form (step ) a \u201cnew\u201d message. The new message may be formed from the new portion, recently composed by the user of the mobile communication device , and the entirety of the first e-mail message, obtained in step . The encryption handling application may then encrypt (step ) the new message. The encryption handling application may then arrange the transmission (step ) of the encrypted new message.","A second cross-component message signing approach involves splitting the signing operation between the mobile communication device  and the wireless mail server , thereby avoiding the downloading of the original message. Unlike the first approach, this split-signing approach cannot be considered to result in true end-to-end security, because the entire e-mail message is not signed strictly at the mobile communication device . Rather, at least the new portion, recently composed by the user of the mobile communication device , is signed strictly at the device, and the signing of the entire message, including the remainder not signed strictly at the device, involves the wireless mail server . However, this second approach does provide a compromise between security and use of wireless channel resources, which makes it particularly suitable for signing large messages or messages with large attachments.","Steps of a method that is an example of the second approach are presented in . Initially, the signature handling application detects receipt (step ) of an instruction to transmit a response message and an associated signature. Such an instruction may be received from the message composition user interface application also executed on the processor .","Responsive to the detection in step , the signature handling application may automatically add (step ) a disclaimer to the end of the response message, indicating that this point in the message marks the end of the part of the message signed at the mobile communication device  and\/or the beginning of the part signed with the assistance of the wireless mail server . For example, the disclaimer may be a line of text, such as \u201c\u2014end of device-signed data\u2014\u201d. The signature handling application may further obtain (step ) a hash of the response message, where the response message includes the new portion, recently composed by the user of the mobile communication device , and the initial portion of the first e-mail message (i.e., not the entire first e-mail message).","The signature handling application may then arrange the transmission (step ), to the wireless mail server , of a request that the wireless mail server  continue the hashing across the first e-mail message. Along with the request, the signature handling application may arrange the transmission of the \u201ccontext\u201d of the hash of the response message to the wireless mail server . The context may be an indication of the internal state of the hashing algorithm. Such an internal state indication may allow the wireless mail server  to continue to obtain the hash.","Steps in an example method of participating, at the wireless mail server , in the split signing operation are illustrated in . Initially, the wireless mail server  receives (step ) the hash continuation request. The wireless mail server  has awareness of the portion of the first e-mail message that was transmitted to the mobile communication device  and can therefore generate (step ) a \u201cfinal\u201d hash by hashing the portion of the first e-mail message that has not been transmitted to the mobile communication device , where the final hash is a hash of a \u201cnew\u201d message. The new message includes the new portion, recently composed by the user of the mobile communication device , and the entirety of the first e-mail message.","Alternatively, if the hashing algorithm is a \u201cstreaming\u201d algorithm, the mobile communication device  may transmit, to the wireless mail server , the current value of the hash.","Upon completing generation (step ) of the hash across the first e-mail message, the wireless mail server  transmits (step ) the final hash to the mobile communication device . It should be clear that the final hash is likely to be significantly smaller than the remainder of the original message.","Upon receiving (step ) the final hash from the wireless mail server , the mobile communication device  signs (step ) the final hash and arranges (step ) the transmission of the response message and the signed hash to the wireless mail server . The signed hash may be called the new signature.","Upon receiving (step ) the response message and the new signature, the wireless mail server  constructs the new message by appending (step ) the portion of the first e-mail message that has not been transmitted to the mobile communication device  to the response message and transmits (step ) the new message and the new signature.","Since the second cross-component message signing approach represented by the methods of  may not be considered to result in true, end-to-end security, the user may be provided with an opportunity to select the second cross-component message signing approach on a per-message basis, depending on the size of the data and\/or security requirements.","In a third cross-component message signing approach, the entire hash is generated on the wireless mail server . The user composes the new portion and indicates that the response message and an associated signature are to be sent.","Steps of a method that is an example of the third cross-component message signing approach are presented in . Initially, the signature handling application at the mobile communication device  detects receipt (step ) of an instruction to transmit the response message and the associated signature.","Responsive to the detection in step , the signature handling application may arrange (step ) transmission of the new portion to the wireless mail server .","Steps in an example method of participating, at the wireless mail server , in the third cross-component message signing approach are illustrated in . Initially, the wireless mail server  receives (step ) the new portion and appends the first e-mail message to the new portion, thereby forming (step ) the new message. The wireless mail server  then generates (step ) a hash of the new message. The wireless mail server  transmits (step ) the hash to the mobile communication device .","At the mobile communication device , the signature handling application receives (step ) the hash and signs (step ) the hash to generate the new signature. The signature handling application then arranges (step ) the transmission of the new signature to the wireless mail server .","Upon receipt (step ) of the new signature, the wireless mail server  transmits (step ) the new message and the new signature.","The second approach to cross-component message signing exemplified in the combination of  and the third approach to cross-component message signing exemplified in the combination of  are suitable for message signing, but differences in the manner in which a message is signed and the manner in which a message is encrypted lead to a lack of direct applicability of these approaches to the encryption of a message.","In overview, the disclosed approaches for message signing may, with some adaptation, be extended for use in message encryption. In part, the adaptation involves the mobile communication device  transmitting additional, special cryptographic information to the wireless mail server , thereby allowing the wireless mail server  to encrypt a given message.",{"@attributes":{"id":"p-0095","num":"0094"},"figref":"FIG. 10","b":["228","1002","228"]},"As discussed hereinbefore, where the message to be encrypted is a message that is formed from a new portion and an initial portion of an original message, the user of the mobile communication device  may prefer that the entirety of the original message be included as context for the new portion. However, as also discussed hereinbefore, only the initial portion of the original message may be present at the mobile communication device . Furthermore, it is noted that the original message may have been encrypted.","Responsive to detecting receipt (step ) of the instruction, the processor , under control of the message processing application, may then obtain (step ) the cryptographic information that the processor  would typically use to encrypt a message. Such cryptographic information may include, for example, one or more session keys, including a composite message session key for encrypting the composite message along with one or more initialization vectors corresponding to each of the one or more session keys. An initialization vector is a block of bits that allows a stream cipher or a block cipher to be executed in any of several modes of operation to produce a unique stream independent from other streams produced by the same session key. Where the original message was encrypted, the cryptographic information may also include one or more keys, such as an original message session key for decrypting the original message.","The processor , under control of the message processing application, may then arrange the transmission (step ), to the wireless mail server , of the message whose transmission was requested in step . The message processing application may include, in the transmission, a request for the formation and encryption of a composite message along with the cryptographic information obtained in step .",{"@attributes":{"id":"p-0099","num":"0098"},"figref":["FIG. 11","FIG. 10"],"b":["118","118","1102"]},"In the case wherein the original message was encrypted, the wireless mail server  may then decrypt (step ) the original message using an appropriate portion of the received cryptographic information.","The wireless mail server  may then create (step ) a composite message by appending the original message to the new message. Both the new message and the original message may include a body portion and one or more attachments. Accordingly, while creating (step ) the composite message, the wireless mail server  may append a body portion of the original message to a body portion of the new message and add attachments from the new message to the composite message and add attachments from the original message to the composite message.","Upon completing creation (step ) of the composite message, the wireless mail server  encrypts (step ) the composite message using an appropriate portion of the cryptographic information received in step . In conjunction with encrypting (step ) the composite message, the wireless mail server  may wrap the composite message in an appropriate encoding. Such appropriate encoding may, for example, comprise encoding using a standard known as Secure\/Multipurpose Internet Mail Extensions (S\/MIME), which is a known standard for public key encryption and signing of data. Alternatively, such appropriate encoding may, for example, comprise encoding using a standard known as Pretty Good Privacy (PGP), which is a known data encryption and decryption computer standard that provides cryptographic privacy and authentication for data communication.","In an alternate implementation, rather than receiving the composite message session key from the mobile communication device , the wireless mail server  generates the composite message session key and the corresponding initialization vector. This implementation may also involve sending the composite message session key to the mobile communication device , so that the mobile communication device  may decrypt the sent composite message, if necessary.","When the composite message has been encrypted and wrapped, the wireless mail server  may transmit (step ) the encrypted composite message toward recipients specified in a destination field of the new message.",{"@attributes":{"id":"p-0105","num":"0104"},"figref":["FIG. 12","FIGS. 10 and 11"],"b":["228","1202","228"]},"As discussed hereinbefore, where the message to be encrypted and signed is a message that is formed from a new portion and an initial portion of an original message, the user of the mobile communication device  may prefer that the entirety of the original message be included as context for the new portion. However, as also discussed hereinbefore, often only the initial portion of the original message may be present at the mobile communication device . Furthermore, it is noted that the original message may have been encrypted.","Responsive to detecting (step ) receipt of the instruction, the processor , under control of the message processing application, may then obtain (step ) the cryptographic information that the processor  would typically use to encrypt a message. Such cryptographic information may include, for example, one or more session keys, including a composite message session key for encrypting the composite message, along with one or more initialization vectors corresponding to each of the one or more session keys. Where the original message was encrypted, the cryptographic information may also include one or more session keys, including an original message session key for decrypting the original message.","The processor , under control of the message processing application, may then arrange the transmission (step ), to the wireless mail server , of the new message. The message processing application may include, in the transmission, the cryptographic information obtained in step  and a request for a hash of the composite message to be created, at the wireless mail server , from the new message and the original message.",{"@attributes":{"id":"p-0109","num":"0108"},"figref":["FIG. 13","FIG. 12"],"b":["118","118","1302"]},"In the case wherein the original message was encrypted, the wireless mail server  may then decrypt (step ) the original message using an appropriate portion of the received cryptographic information.","The wireless mail server  may then create (step ) a composite message by appending the original message to the new message. Both the new message and the original message may include a body portion and one or more attachments. Accordingly, while creating (step ) the composite message, the wireless mail server  may append a body portion of the original message to a body portion of the new message and add attachments from the new message to the composite message and add attachments from the original message to the composite message.","Upon completing creation (step ) of the composite message, the wireless mail server  generates (step ) a hash of the composite message and transmits (step ) the hash to the mobile communication device  with a hash signing request, specifying that the hash is to be signed.","Upon receiving (step ) the hash signing request from the wireless mail server , the mobile communication device  obtains (step ) a private key specific to a user of the mobile communication device . Obtaining (step ) the private key may, for example, involve prompting the user for a password to allow the processor  access to a key store, in memory of the mobile communication device , from which the processor  may obtain the private key.","Upon obtaining (step ) the private key, the processor  may sign (step ) the hash to form a signature for the composite message. The processor  may then arrange (step ) the transmission of the signature to the wireless mail server .","The wireless mail server  receives (step ) the signature and adds (step ) the signature to the composite message.","Upon adding (step ) the signature to the composite message, the wireless mail server  may encrypt (step ) the signed composite message using an appropriate portion of the cryptographic information received in step . In conjunction with encrypting (step ) the signed composite message, the wireless mail server  may wrap the composite message in an appropriate encoding as discussed hereinbefore.","When the signed composite message has been encrypted and wrapped, the wireless mail server  may transmit (step ) the encrypted and signed composite message toward recipients specified in a destination field of the new message.","According to Internet Engineering Task Force (IETF) Request For Comment (RFC) 5652 (see tools.ieff.org\/html\/rfc5652), the Cryptographic Message Syntax (CMS) describes an encapsulation syntax for data protection. The CMS supports digital signatures and encryption. The syntax allows multiple encapsulations; one encapsulation envelope can be nested inside another. Likewise, one party can digitally sign some previously encapsulated data. The CMS also allows arbitrary attributes, such as signing time, to be signed along with the message content, and the CMS provides for other attributes such as countersignatures to be associated with a signature.","Notably, because the body and attachments of the composite message are not available on the mobile communication device  in those cases wherein the original message parts are not downloaded, a CMS message cannot be constructed on the mobile communication device .","Given the above disclosure, the applicants have considered construction of a CMS message on the wireless mail server . However, if a CMS message is to be constructed on the wireless mail server , the wireless mail server  may benefit from receiving more information from the mobile communication device  than has, to this point, been transmitted from the mobile communication device .","Where the composite message is to be cryptographically signed, the additional information that the wireless mail server  may benefit from receiving from the mobile communication device  may include an indication of a digest algorithm to use. It is expected that the digest algorithm to use is to be determined on the mobile communication device  because the digest algorithm to use may depend on the cryptographic strength of the private key or may be selected based on configuration by a user of the mobile communication device . The additional information may also include an indication of a signature algorithm to use. The signature algorithm to use may depend on the private key or may be selected based on configuration by a user of the mobile communication device . Notably, the private key is not available on the wireless mail server . The additional information may further include signed and unsigned attributes that can depend on information available only on the mobile communication device . Still further, the additional information may include a signing key certificate.","Where the composite message is to be encrypted, the additional information that the wireless mail server  may benefit from receiving from the mobile communication device  may include one or more certificates associate with an intended recipient of the composite message. It is expected that the recipient certificates are trusted on the mobile communication device . The additional information may also include one or more certificates associate with the sender of the composite message. The additional information may further include one or more encrypted session keys. Encryption of the session keys on the mobile communication device  provides a degree of confidence that the session keys that are to be used are trusted on the mobile communication device . Furthermore, the additional information may include an indication of a content encryption algorithm. The content encryption algorithm may, for example, be selected on the mobile communication device . Still further, the additional information may include one or more certificate revocation lists (CRLs). A CRL is a list of serial numbers for certificates that have been revoked and, therefore, should not be relied upon. Even further, the additional information may include attributes. The additional information may also include an original message session key, which may be used to decrypt the original message. The additional information may also include a composite message session key, which may be used to encrypt the composite message.","The information described above is to be sent from the mobile communication device  to the wireless mail server  in conjunction with a request to transmit a signed and\/or encrypted composite message conforming to the CMS.","In one approach, the mobile communication device  may create a proprietary, complex structure that encodes and serializes the information and may then transmit the encoded and serialized information to the wireless mail server . Responsive to receiving the encoded and serialized information, the wireless mail server  decodes and de-serializes the information and constructs a CMS message.","Alternatively, the mobile communication device  may create a CMS message. It should be clear that a CMS message created at the mobile communication device  may not include some attributes. Furthermore, it may be that the missing attributes are considered to be mandatory.","RFC 5652 introduces eContent as a name for the content of a CMS message. RFC 5652 also indicates that the eContent within the EncapsulatedContentInfo field may, optionally, be omitted: \u201cIf the eContent value within EncapsulatedContentInfo is absent, then the signatureValue is calculated and the eContentType is assigned as though the eContent value was present.\u201d",{"@attributes":{"id":"p-0127","num":"0126"},"figref":"FIG. 14","b":["1402","228","1404"]},"The processor , under control of the CMS message processing application, may then arrange the transmission (step ), to the wireless mail server , of the new message and the CMS message created in step  along with an indication of the original message and a request to sign the composite message.",{"@attributes":{"id":"p-0129","num":"0128"},"figref":["FIG. 15","FIG. 14"],"b":["118","118","1502"]},"In the case wherein the original message was encrypted, it is expected that the mobile communication device  will supply cryptographic information, outside of the CMS message, in conjunction with receipt of the request from the wireless mail server  in step . The wireless mail server  may then decrypt (step ) the original message using the received cryptographic information.","The wireless mail server  may then create (step ) a composite message by appending the original message to the new message. Both the new message and the original message may include a body portion and one or more attachments. Accordingly, while creating (step ) the composite message, the wireless mail server  may append a body portion of the original message to a body portion of the new message and add attachments from the new message to the composite message and add attachments from the original message to the composite message.","Upon completing creation (step ) of the composite message, the wireless mail server  generates (step ) a hash of the composite message and transmits (step ) the hash to the mobile communication device  with a hash signing request, specifying that the hash is to be signed.","Upon receiving (step ) the hash signing request from the wireless mail server , the mobile communication device  obtains (step ) a private key specific to a user of the mobile communication device . Obtaining (step ) the private key may, for example, involve prompting the user for a password to allow the processor  access to a key store, in memory of the mobile communication device , from which the processor  may obtain the private key.","Upon obtaining (step ) the private key, the processor  may sign (step ) the hash to form a signature for the composite message. The processor  may then arrange (step ) the transmission of the signature to the wireless mail server .","The wireless mail server  receives (step ) the signature and amends (step ) the CMS Signed Data structure of the CMS message to insert the signature into the signature field. The wireless mail server  may also amend (step ) the CMS Signed Data structure of the CMS message to insert the composite message into the eContent field.","Following amending (step ) the CMS message, the wireless mail server  may transmit (step ) the CMS message toward recipients specified in a destination field of the new message.",{"@attributes":{"id":"p-0137","num":"0136"},"figref":"FIG. 16","b":["228","1602","228"]},"Responsive to detecting receipt (step ) of the instruction, the processor , under control of the CMS message processing application, may then obtain (step ) the cryptographic information that the processor  would typically use to encrypt a message. Such cryptographic information may include, for example, one or more session keys, including a composite message session key for encrypting the composite message. Where the original message was encrypted, the cryptographic information may also include one or more session keys, including an original message session key for decrypting the original message.","Responsive to obtaining (step ) the cryptographic information, the processor , under control of the CMS message processing application, may then create (step ) a CMS message having a CMS Enveloped Data structure wherein the encryptedContent field is intentionally left empty.","The processor , under control of the CMS message processing application, may then arrange the transmission (step ), to the wireless mail server , of the new message and the CMS message created in step  along with an indication of the original message. The CMS message processing application may include, in the transmission, a request for the formation and encryption of the composite message along with the cryptographic information obtained in step .",{"@attributes":{"id":"p-0141","num":"0140"},"figref":["FIG. 17","FIG. 16"],"b":["118","118","1702"]},"In the case wherein the original message was encrypted, the wireless mail server  may then decrypt (step ) the original message using an appropriate portion of the received cryptographic information. Notably, in cases wherein the original message was not encrypted, steps , ,  and  are unnecessary.","The wireless mail server  may then create (step ) a composite message by appending the original message to the new message. Both the new message and the original message may include a body portion and one or more attachments. Accordingly, while creating (step ) the composite message, the wireless mail server  may append a body portion of the original message to a body portion of the new message and add attachments from the new message to the composite message and add attachments from the original message to the composite message.","Upon completing creation (step ) of the composite message, the wireless mail server  may encrypt (step ) the composite message using an appropriate portion of the cryptographic information received in step . It should be clear that the cryptographic information, e.g., the session keys, are received in step  distinct from the CMS message.","When the composite message has been encrypted (step ), the wireless mail server  may amend (step ) the CMS Enveloped Data structure of the CMS message to insert the composite message into the encryptedContent field.","Upon completing the CMS message, the wireless mail server  may transmit (step ) the CMS message toward recipients specified in a destination field of the new message.","If the composite message is to be both signed and encrypted, the processor , under control of the CMS message processing application, may then create a CMS message having a CMS Signed Data structure layer (wherein the eContent field and the signature field are intentionally left empty) and a CMS Enveloped Data structure layer (wherein the encryptedContent field is intentionally left empty).","In one implementation, the layers are sent nested. For example, when the composite message is to be signed and encrypted, the received message will be CMS enveloped data. Then the encryptedContent will be CMS signed data.","In another implementation, in a case wherein each layer may not be fully constructed, the processor  arranges transmission of two CMS documents: one CMS message with Signed Data; and one CMS message with Enveloped Data. The wireless mail server  completes the CMS message having Signed Data, places the CMS message having Signed Data inside the CMS message having Enveloped Data and then completes the CMS message having Enveloped Data by encrypting everything.","It is possible for CMS message to have even more layers. These layers can be sent as additional CMS templates (one CMS template per layer) with the CMS message.","The proposed approach may be considered simpler than the transfer of a complex proprietary structure to serialize\/de-serialize CMS attributes when sent from device to the wireless mail server . The proposed approach reduces load on the wireless mail server  because the wireless mail server  merely inserts one or two attributes per layer as opposed to constructing an entire CMS message from a set of attributes.","The proposed approach is more flexible. It is easier to control what should go into CMS messages on the mobile communication device  because many security aspects are controlled on device (security configuration, user choices, end-to-end secure messages, etc). Hence, if a mechanism how a certain CMS attribute is chosen has changed, only device side needs to change because CMS is constructed on device.","Also, the proposed approach may be considered simper to implement. CMS encoding\/decoding application programming interfaces (APIs) may be considered relatively common. However, APIs for managing individual CMS attributes may be considered less common or non-existent depending on the mobile platform. In the proposed approach, the mobile communication device  can use a CMS encoding API as is by providing a single byte as message plaintext to produce CMS layer. eContent, encryptedContent, and signature attributes will be discarded on the wireless mail server  and replaced by the real attributes. However, because eContent and encryptedContent for a single byte plaintext may be considered to be relatively small, this solution adds inefficiency that may be considered insignificant.","The above-described embodiments of the present application are intended to be examples only. Alterations, modifications and variations may be effected to the particular embodiments by those skilled in the art without departing from the scope of the application, which is defined by the claims appended hereto."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Reference will now be made to the drawings, which show by way of example, embodiments of the invention, and in which:",{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0008","num":"0007"},"figref":["FIG. 3","FIG. 1"]},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":["FIG. 5","FIG. 3"]},{"@attributes":{"id":"p-0011","num":"0010"},"figref":["FIG. 6","FIG. 1"]},{"@attributes":{"id":"p-0012","num":"0011"},"figref":["FIG. 7","FIG. 1","FIG. 6"]},{"@attributes":{"id":"p-0013","num":"0012"},"figref":["FIG. 8","FIG. 1"]},{"@attributes":{"id":"p-0014","num":"0013"},"figref":["FIG. 9","FIG. 1","FIG. 8"]},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":["FIG. 11","FIG. 1","FIG. 10"]},{"@attributes":{"id":"p-0017","num":"0016"},"figref":["FIG. 12","FIGS. 10 and 11"]},{"@attributes":{"id":"p-0018","num":"0017"},"figref":["FIG. 13","FIG. 1","FIG. 12"]},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":["FIG. 15","FIG. 1","FIG. 14"]},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 16"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":["FIG. 17","FIG. 1","FIG. 16"]}]},"DETDESC":[{},{}]}
