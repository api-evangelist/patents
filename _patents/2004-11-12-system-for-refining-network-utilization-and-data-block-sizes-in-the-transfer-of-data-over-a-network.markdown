---
title: System for refining network utilization and data block sizes in the transfer of data over a network
abstract: A system and computer-readable media are provided for refining network utilization determination and download data block sizes in the transfer of a set of data over a network. In accordance with one aspect of the invention, the system includes a monitoring component, which obtains a network utilization rate at a plurality of intervals. The system also determines an average of the network utilization rates and calculates a block size of data to transfer during the intervals as a function of the average. The average may be weighted by allocating a higher ratio to the more recently obtained network utilization rate. The calculated block size may be directly proportional to the product of the average, the size of the interval, and network availability. Alternatively, the size of the intervals may be adjusted based on the calculated block size.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07436771&OS=07436771&RS=07436771
owner: Microsoft Corporation
number: 07436771
owner_city: Redmond
owner_country: US
publication_date: 20041112
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","STATEMENT REGARDING FEDERALLY SPONSORED RESEARCH OR DEVELOPMENT","TECHNICAL FIELD","BACKGROUND OF THE INVENTION","BRIEF SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE INVENTION"],"p":["This application is a continuation of application Ser. No. 09\/783,407, filed Feb. 14, 2001, which issued as U.S. Pat. No. 6,920,110.","Not applicable.","The present invention relates to computer software and, more particularly, to a system for refining network utilization and data block sizes in the transfer of data over a network.","A computer system in which one or more client machines communicate with one or more servers over a network is a common arrangement. For example, there are millions of personal computers (PCs) connected to the Internet for communication with various servers. Many of these PC users acquire new or updated software on their PCs by downloading the software from a remote server over the Internet.","Conventional methods of uploading and downloading data, such as new and updated software to a PC over a network such as the Internet interfere with the PC user's ability to browse the Internet or to otherwise communicate over the network during the download. With increased processing speeds for PCs, it is the bandwidth to the Internet which is becoming a significant bottleneck to the user's browsing experience. Because conventional downloads typically occupy 100% of the user's available communication bandwidth until the download is complete, the user is unable to utilize the network for other tasks during the download. Moreover, if the download is interrupted for some reason (e.g., the network connection is lost), it may be necessary to restart the download from the beginning of the file, thus wasting significant network resources. Other conventional downloading software permits the user to schedule the download for a designated time. In any event, conventional methods for downloading software over a network such as the Internet severely limit the user's ability to engage in other network activity.","Providing software updates is beneficial to PC users because it corrects problems and improves the performance of their PCs. Additionally, the software vendor benefits from a reduction in the number of product support calls, which in turn reduces the substantial resources the vendor might otherwise allocate to handling such calls.","Microsoft Corporation provides a software update service in connection with its MICROSOFT WINDOWS family of operating system products under the mark \u201cWINDOWS UPDATE\u201d. By accessing the \u201cWINDOWS UPDATE\u201d Internet website, MICROSOFT WINDOWS users can have their system evaluated and download both critical and non-critical software updates (e.g., a fix or a patch) over the Internet. Upon determining there are updates available which are not already loaded on the user's PC, the user is notified that such updates are available, and the user is prompted to select one or more of them for downloading over the Internet. While this is a convenient method for providing software updates to users, such downloads could interfere with other network activity. Moreover, it is likely that many users will not take the initiative to navigate to the \u201cWINDOWS UPDATE\u201d website and download operating system updates for their PCs. Consequently, users who have not yet downloaded critical updates are more likely to encounter problems with their PCs, and they will likely call the vendor's product support line when a problem arises.","Accordingly, there is a need for an effective method for downloading software updates over a network so that interference with other network activity is minimized. One potential solution is simply to increase network bandwidth. However, increased bandwidth is expensive and has historically been followed by increased user demands. Thus, even as available bandwidth increases with technological advances, there will continue to be a need to eliminate interference with other network activity because of the corresponding increases in user demands.","In one aspect, the invention is directed to one or more computer-readable media having computer-usable instructions embodied thereon for performing a method of refining network utilization determination and download data block sizes in the transfer of a set of data over a network. The method includes the step of obtaining a network utilization rate at a number of intervals. Next, the method includes the step of determining an average of the network utilization rates. The average may be weighted by allocating a higher ratio to the more recently obtained network utilization rate. The method also includes the step of calculating a block size of data to transfer during the intervals as a function of the average.","Another aspect of the invention is directed to one or more computer-readable media having computer-usable instructions embodied thereon for performing a method of refining network utilization determination and download data block sizes in the transfer of a set of data over a network. The method includes obtaining a network utilization rate at a number of intervals. Next, an average of the network utilization rates is determined. The method then calculates a block size of data to transfer during the intervals as a function of the average. The calculated block size may be directly proportional to the product of the average, the size of the interval, and network availability.","Yet another aspect of the invention involves one or more computer-readable media having computer-usable instructions embodied thereon for performing a method of refining network utilization determination and download data block sizes in the transfer of a set of data over a network. The method includes the step of obtaining a network utilization rate at a plurality of intervals. Next, the method determines an average of the network utilization rates. The method also includes the step of calculating a block size of data to transfer during the intervals as a function of the average. The size of the intervals may be adjusted based on the calculated block size.","In another aspect, the invention is directed to a system for refining network utilization determination and download data block sizes in the transfer of a set of data over a network. The system includes a monitoring component, which operates to obtain a network utilization rate at a plurality of intervals. The system also determines an average of the network utilization rates. The average may be weighted by allocating a higher ratio to the more recently obtained network utilization rate. The system then calculates a block size of data to transfer during the intervals as a function of the average.","Yet another aspect of the invention involves a system for refining network utilization determination and download data block sizes in the transfer of a set of data over a network. The system includes a monitoring component, which obtains a network utilization rate at a plurality of intervals. The system also determines an average of the network utilization rates and calculates a block size of data to transfer during the intervals as a function of the average. The calculated block size may be directly proportional to the product of the average, the size of the interval, and network availability.","Still another aspect of the invention is directed to a system for refining network utilization determination and download data block sizes in the transfer of a set of data over a network. The system includes a monitoring component, which operates to obtain a network utilization rate at a plurality of intervals. The system also determines an average of the network utilization rates and calculates a block size of data to transfer during the intervals as a function of the average. Alternatively, the size of the intervals may be adjusted based on the calculated block size.","The present invention provides a system and method for transferring data over a network such as the Internet.",{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 1"},"The invention is operational with numerous other general purpose or special purpose computing system environments or configurations. Examples of well known computing systems, environments, and\/or configurations that may be suitable for use with the invention include, but are not limited to, personal computers, server computers, hand-held or laptop devices, multiprocessor systems, microprocessor-based systems, programmable consumer electronics, network PCs, minicomputers, mainframe computers, distributed computing environments that include any of the above systems or devices, and the like.","The invention may be described in the general context of computer-executable instructions, such as program modules, being executed by a computer. Generally, program modules include routines, programs, objects, components, data structures, etc. that perform particular tasks or implement particular abstract data types. The invention may also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network. In a distributed computing environment, program modules may be located in both local and remote computer storage media including memory storage devices.","With reference to , an exemplary system for implementing the invention includes a general purpose computing device in the form of a computer . Components of computer  include, but are not limited to, a processing unit , a system memory , and a system bus  that couples various system components including the system memory to the processing unit . The system bus  may be any of several types of bus structures including a memory bus or memory controller, a peripheral bus, and a local bus using any of a variety of bus architectures. By way of example, and not limitation, such architectures include Industry Standard Architecture (ISA) bus, Micro Channel Architecture (MCA) bus, Enhanced ISA (EISA) bus, Video Electronics Standards Association (VESA) local bus, and Peripheral Component Interconnect (PCI) bus also known as Mezzanine bus.","Computer  typically includes a variety of computer readable media. Computer readable media can be any available media that can be accessed by computer  and includes both volatile and nonvolatile media, removable and non-removable media. By way of example, and not limitation, computer readable media may comprise computer storage media. Computer storage media includes both volatile and nonvolatile, removable and non-removable media implemented in any method or technology for storage of information such as computer readable instructions, data structures, program modules or other data. Computer storage media includes, but is not limited to, RAM, ROM, LEPROM, flash memory or other memory technology, CD-ROM, digital versatile disks (DVD) or other optical disk storage, magnetic cassettes, magnetic tape, magnetic disk storage or other magnetic storage devices, or any other medium which can be used to store the desired information and which can be accessed by computer . Combinations of any of the above should also be included within the scope of computer readable media.","The system memory  includes computer storage media in the form of volatile and\/or nonvolatile memory such as read only memory (ROM)  and random access memory (RAM) . A basic input\/output system  (BIOS), containing the basic routines that help to transfer information between elements within computer , such as during start-up, is typically stored in ROM . RAM  typically contains data and\/or program modules that are immediately accessible to and\/or presently being operated on by processing unit . By way of example, and not limitation,  illustrates operating system , application programs , other program modules , and program data .","The computer  may also include other removable\/non-removable, volatile\/nonvolatile computer storage media. By way of example only,  illustrates a hard disk drive  that reads from or writes to non-removable, nonvolatile magnetic media, a magnetic disk drive  that reads from or writes to removable, nonvolatile magnetic disk , and an optical disk drive  that reads from or writes to a removable, nonvolatile optical disk  such as a CD ROM or other optical media. Other removable\/non-removable, volatile\/nonvolatile computer storage media that can be used in the exemplary operating environment include, but are not limited to, magnetic tape cassettes, flash memory cards, digital video disks, digital video tape, Bernoulli cartridges, solid state RAM, solid state ROM, and the like. The hard disk drive , magnetic disk drive , and optical disk drive  are typically connected to the system bus  by a Small Computer System Interface (SCSI) . Alternatively, the hard disk drive , magnetic disk drive  and optical disk drive  may be connected to the system bus  by a hard disk drive interface, a magnetic disk drive interface, and an optical drive interface, respectively.","The drives and their associated computer storage media discussed above and illustrated in , provide storage of computer readable instructions, data structures, program modules and other data for the computer . In , for example, hard disk drive  is illustrated as storing operating system , application programs , other program modules , and program data . Note that these components can either be the same as or different from operating system , application programs , other program modules , and program data . A user may enter commands and information into the computer  through input devices such as a keyboard  and pointing device , commonly referred to as a mouse, trackball or touch pad. Other input devices (not shown) may include a microphone, joystick, game pad, satellite dish, scanner, or the like. These and other input devices are often connected to the processing unit  through a user input interface  or a serial port interface  that is coupled to the system bus, but may be connected by other interface and bus structures, such as a parallel port, game port or a universal serial bus (USB). A monitor  or other type of display device is also connected to the system bus  via an interface, such as a video adapter . In addition to the monitor , computers may also include other peripheral output devices such as speakers and printers, which may be connected through an output peripheral interface.","The computer  may operate in a networked environment using logical connections to one or more remote computers, such as a remote computer . The remote computer  may be a personal computer, a server, a router, a network PC, a peer device or other common network node, and typically includes many or all of the elements described above relative to the computer , although only a memory storage device has been illustrated in . The logical connections depicted in  include a local area network (LAN)  and a wide area network (WAN) , but may also include other networks. Such networking environments are commonplace in offices, enterprise-wide computer networks, intranets and the Internet.","When used in a LAN networking environment, the computer  is connected to the LAN  through a network interface or adapter . When used in a WAN networking environment, the computer  typically includes a modem  or other means for establishing communications over the WAN , such as the Internet. The modem , which may be internal or external, may be connected to the system bus  via the serial port interface  or other appropriate mechanism. In a networked environment, program modules depicted relative to the computer , or portions thereof, may be stored in the remote memory storage device. By way of example, and not limitation,  illustrates remote application programs  as residing on memory device . It will be appreciated that the network connections shown are exemplary and other means of establishing a communications link between the computers may be used.","Although many other internal components of the computer  are not shown, those of ordinary skill in the art will appreciate that such components and the interconnection are well known. Accordingly, additional details concerning the internal construction of the computer  need not be disclosed in connection with the present invention.","Those skilled in the art will understand that program modules such as the operating system , application programs  and data  are provided to the computer  via one of its memory storage devices, which may include ROM , RAM , hard disk drive , magnetic disk drive  or optical disk drive . Preferably, the hard disk drive  is used to store data  and programs, including the operating system  and application programs .","When the computer  is turned on or reset, the BIOS , which is stored in the ROM  instructs the processing unit  to load the operating system from the hard disk drive  into the RAM . Once the operating system  is loaded in RAM , the processing unit  executes the operating system code and causes the visual elements associated with the user interface of the operating system  to be displayed on the monitor . When an application program  is opened by a user, the program code and relevant data are read from the hard disk drive  and stored in RAM .","With reference to , an exemplary system for practicing the present invention is designated generally by reference numeral . The system  includes a client machine such as a PC  and a communications device  such as a modem for accessing a network  (e.g., the Internet). A server  is also connected to the network  in a conventional manner. The PC  and modem  establish a connection with the server  over the network  to facilitate the transfer of data between the client and the server.","A system  set forth in  is similar to the system  of , except that the system  includes a first client A and a second client B which are connected to one another over a link  such as an intranet. As with the system , the communications device  (e.g., a modem) establishes a connection between the first client A and the network . Accordingly, the clients A, B can exchange data with the server  over the network .","Those skilled in the art will readily appreciate that the present invention encompasses many possible variations to the systems ,  shown in . Of course, any number of client and server machines may be connected to the network  (either directly or indirectly). For example, the system  could include more than two client machines, one of which would act as a proxy for the others. In that case, the client machines could be connected to one another over an intranet, and the network card in the proxy machine could be connected to a router which is linked to the network  over a T line. Moreover, the network  could be the Internet or any other public or private network. Additionally, the communications device  may be part of the PC  or an independent hardware device.","In one application of the present invention, the client machine is the PC , the device  is a 56 Kbps (Kilobits per second) modem, the network  is the Internet, and the server  is a website accessible over the Internet for downloading software updates for the operating system of the PC. Referring to , a curve  represents the level of actual network bandwidth utilization for a client PC accessing the Internet over a period of time. The curve  rises from Tthrough Tto reflect the flurry of network activity which typically occurs as the user initially accesses the Internet. Then, after a brief decrease in network activity at T, the client's actual utilization again rises dramatically to a peak at T. This peak could represent any number of possible actions initiated by the client, such as the downloading of a webpage or the opening of an email message. While the user at the client machine reads the web page or the email message, or perhaps listens to music over the Internet, the actual network utilization decreases to a significantly lower level from Tthrough T.","The relatively low level of actual network bandwidth utilization shown from Tthrough T() is sometimes referred to as \u201cnetwork idle.\u201d This concept differs from \u201cmachine idle,\u201d which occurs when a PC user is not currently using the keyboard or mouse. If the machine remains idle for a period of time, a screen saver may be invoked. However, network utilization may be high at the same time the machine is idle (e.g., during a download), and the network interface may be \u201cidle\u201d when the machine is not. Thus, the present invention is directed to the transfer of a set of data, such as a software update, over a network at a time when the network utilization is relatively low. This transfer of data is intended to be transparent to the user, and the user's machine need not be idle during the transfer. This transfer of data could just as easily relate to activities initiated by a user action on the PC, such as playing video games or downloading music MP3 files, eBooks and so on. Moreover, the data to be transferred may include text, image and\/or audio data. The present invention is also equally applicable to uploads from the client to the server or other communication of data between computers.","As described below in connection with , the present invention monitors the level of actual utilization represented by the curve  () and calculates a threshold level of utilization below which the transfer of data between the client and server is not likely to interfere with other network activity. In a preferred embodiment, the threshold level is equal to approximately 33% of the maximum detected level of actual network utilization. As shown in , the threshold level is generally designated by reference numeral  and is initially set to zero. Network activity is periodically sampled, and a new threshold level is calculated each time a new maximum is identified. At T, the level of actual bandwidth usage is 15 Kbps, which is a new maximum, so the threshold  is set to 5 Kbps. The level of actual bandwidth usage is again sampled at T, and another new maximum of 30 Kbps is identified. Consequently, the new threshold  is calculated to be 10 Kbps.","When the level of actual usage  drops below the threshold level , as at T, a brief transfer of data should not significantly interfere with other network activity. The transfer of data could be initiated immediately upon first detecting that the actual usage is below the threshold level. However, a more conservative approach, in that it is more deferential to the user, is to detect at least two consecutive occurrences of low usage before initiating a download. In any event, a new maximum of 45 Kbps is detected at T, thereby triggering the calculation of an updated threshold level of 15 Kbps. Consequently, if any data transfer were initiated at T, then it would be immediately suspended at T. At T, the actual usage  once again drops below the threshold level . This time, the level of actual usage  remains between 5-10 Kbps, which is less than the threshold level of 15 Kbps, from Tto T. Thus, the transfer of data over the network would not interfere with other network activity during this time period.","A preferred architecture of the client of the present invention is set forth in . A client  includes an update client , an update engine , an update downloader  and an update applet . The client  is connected to a server such as via an update website  over a pair of links , , which are preferably HTTP (Hypertext Transfer Protocol) links. The update client  is responsible for notifications and personalization options for the user. The update engine  controls content interaction with the update site  as well as detection, installation and logging of software updates. The update downloader  is responsible for implementing the packet background downloading\/throttling and incoming packet queue management. The update applet  determines the configuration of update notifications to the user and other interactions with the user. The backend content and catalogs are available from the update site .","The present invention utilizes a data structure  illustrated in . The data structure  includes a first field  which contains the maximum identified level of actual bandwidth utilization and a second field  which contains the threshold level of utilization. As shown in , both the maximum identified level and the threshold level can vary over time depending on the level of actual utilization. As mentioned above, the threshold level is calculated as a function of the maximum identified level of actual usage. Therefore, a new threshold level is calculated each time a new maximum level is detected.",{"@attributes":{"id":"p-0050","num":"0049"},"figref":"FIG. 7","b":"120"},"Once the client is connected to the same network as the server, the level of actual network bandwidth utilization is obtained at step . As shown in , the actual usage is sampled periodically (e.g., every five seconds). Preferably, this is done by tracking the number of incoming and outgoing packets over a given time period (e.g., one second) at the communications interface between the client and the network. For a PC running the \u201cWINDOWS 98\u201d operating system, this information is available using the GetIfEntry function in \u201ciphlpapi.dll\u201d.","Relatively large files provide a more accurate basis for measuring the level of actual network bandwidth usage at the network interface. For example, it is difficult to accurately measure the download time for a 200 byte file because the overhead of measurement is significant and the small file does not saturate the available bandwidth. Consequently, the present invention preferably updates the maximum level of utilization only when the measurement of the actual level of utilization is based on the transfer speed of a file that is at least 4 KB in size.","Preferably, each of the \u201cvirtual devices\u201d is enumerated to ensure accurate monitoring, especially in a system which is more complex than the system . The term \u201cvirtual device,\u201d as used herein, refers to any networking device with a device driver, such as modems (including cable modems and ISDN modems), network cards and DSLs (Digital Subscriber Lines). Each channel of a 2-channel ISDN modem is considered to be a separate virtual device for the purposes of the present invention.","Importantly, the level of actual network bandwidth utilization is monitored rather than simply relying on the rated or listed throughput of the network device. The rated value is not reliable because, as a practical matter, the maximum throughput achieved by a modem is less than its listed throughput and may be different for each network session. Variables such as the quality of the telephone connection typically result in a maximum available bandwidth of less than 50 Kbps for a 56 Kbps modem.","Moreover, rated values cannot be assumed to be accurate when a client is connected to the network by a proxy. In the system , there is a peer-to-peer connection between the first client A and the second client B over the intranet , and the first client A is in turn linked to the network  by a modem . Assuming a 56 Kbps modem and a 10 Mbps intranet, the modem  is the bottleneck to the network . Thus, if the first client A were utilizing 40 Kbps of the network bandwidth at the same time the second client B is utilizing only 5 Kbps of the bandwidth, there would not be sufficient network bandwidth available to download a set of data (e.g., a software update) from the server  to either client without degrading their other network activity. Moreover, it would not be accurate to assume either that the second client B has a maximum throughput of 10 Mbps or that substantial bandwidth is available because the second client B is only using 5 Kbps of the network interface. Here, in the case of remote access, the level of actual bandwidth utilization for the second client B can be obtained from the RAS (Remote Access Service) device table. Thus, monitoring the actual throughput at each virtual device advantageously adapts to configuration changes between sessions and is therefore a more reliable approach.","Referring again to , the maximum detected level of actual usage is initially set to zero. Then, at step , it is determined whether the actual usage is greater than the current maximum. If not, the actual usage is sampled again at step . However, if the actual usage is greater than the current maximum, then a new maximum is set equal to the current actual level at step . Next, a threshold level is calculated as a function of the maximum at step . The threshold is initially set to zero, and a new threshold is calculated each time a new maximum is detected. As a general proposition, the threshold level could be anywhere from approximately 5%-80% of the maximum detected level. However, the presently preferred threshold level for Internet applications is approximately 33% of the maximum detected level. Once the new threshold level has been calculated, the actual usage is sampled again at step .","It should be noted that the present invention calculates the threshold level as a percentage of actual network bandwidth in Kilobits per second, as opposed to some other parameter, such as the percentage of time the network connection is busy over a given period. For example, a client machine utilizing its network connection 75% of the time over the course of an hour is not necessarily using 75% of its available bandwidth. In fact, if the user at the client PC is merely reading a webpage, reading email, listening to music or the like, it is likely that the level of actual bandwidth utilization is well below the maximum available bandwidth. Those skilled in the art will understand that the present invention, which is implemented at the client level, is fundamentally different from methods for limiting bandwidth at the hardware level (e.g., sockets).","Each time the level of actual network bandwidth utilization is obtained at step , it is also compared to the current threshold level. At step , it is determined whether the actual usage is less than the threshold level. If so, a software update (or other set of data) available from the server can be downloaded over the network to the client. To minimize interference with any other present or future network activity of the client, the download is preferably performed by downloading the software update in several segments. Accordingly, at step , one segment of the file is downloaded from the server to the client. If the client's network activity increases after downloading the first segment, the download of the entire file can be suspended until the actual usage drops back down below the threshold level. However, if the network is idle for an extended period of time, the download can be accelerated by downloading progressively larger segments of the file over the network.","A counting device is provided in a preferred embodiment of the present invention to facilitate the downloading of progressively larger file segments. For example, a 144 KB file may be downloaded from the server to the client over the Internet by first transferring an 8 KB segment of the file at step  of . A small segment such as 8 KB has been found to be an effective default because it uses 100% of the pipeline for a short period of time and permits frequent monitoring of actual usage between segments. Even if a user clicks on an URL (Uniform Resource Locator) during the download of an 8 KB block, there will be no noticeable delay to the user. Moreover, in the event an interruption occurs, 8 KB is the most data that can be lost.","At step , it is determined whether the entire file has been downloaded. Since the 8 KB block was the first segment of the 144 KB file, the entire file has not been downloaded and the counter, which is initially set to zero, is incremented to \u201c1\u201d at step . The counter keeps track of the number of segments that have been downloaded consecutively without interruption so that the size of the segments can be increased so long as network activity remains low. As an example, the size of the segments could be increased to 16 KB if the counter is equal to \u201c2\u201d, and the size of the segments could be increased to 32 KB if the counter is equal to \u201c4\u201d. This would enable the 144 KB file to be downloaded in seven progressively larger segments as opposed to 18 of the smaller 8 KB segments, provided network activity stays below the threshold level. Although the larger segments take longer to download and therefore result in less frequent monitoring of the actual usage, this approach takes advantage of any extended periods of low network activity. Typically a header accompanies each segment, so transferring a smaller number of larger segments also reduces network overhead by reducing the total number of headers transferred over the network. Presently, a 64 KB segment is the largest segment that is preferred when using a 56 Kbps modem.","After incrementing the counter at step , steps  and  are repeated. If the level of actual usage is no longer less than the threshold level, the file download is suspended and the counter is cleared (i.e., set to zero) at step . Then, the actual utilization is sampled again at step . In the event the download is suspended, the download will be resumed from the point of suspension. However, if the actual usage remains below the threshold level, the next segment is downloaded at step , and the process is repeated until it is determined at step  that the entire file has been downloaded. If so, the counter is cleared at step  and the loop ends at step .","It should be noted that the progressive download feature of the present invention may require filtering or a similar technique to overcome the limitations of some existing servers. While progressive downloads have been widely available at the FTP (file transfer protocol) level, they were not available at the HTTP level until HTTP 1.1 servers became available. As discussed above, the present invention utilizes a byte range approach with 8 KB file segments as a default. For the first segment, a byte range of \u201c0-7999\u201d is specified in the download request from the client, the range \u201c8000-15999\u201d is specified in the download request for the second segment, and so on. However, the byte range portion of the request would be lost if an HTTP 1.0 server is encountered, and the entire file would be downloaded at once. One way to avoid this problem is to use an ISAPI (Internet Server Application Programming Interface) filter to simulate an HTTP 1.1 byte request across an HTTP 1.0 proxy. Then, even if an HTTP 1.0 server is encountered, the byte range information will not be lost.","Of course, the preferred size of the segment or byte range can vary dramatically based on factors such as the speed of the modem. The foregoing examples (e.g., the default segment size of 8 KB) are based on the assumption that a large number of users will access the network with 56 Kbps modems. However, it may be appropriate to assume that a large number of users will access the network with 28 Kbps modems. In that case, the preferred default segment size would be 4 KB rather than 8 KB. Likewise, the progressively larger segments would be 8 KB and 16 KB rather than 16 KB and 32 KB. Those skilled in the art will appreciate that the use of a variety of other segment sizes is also contemplated by the present invention.","In another embodiment of the present invention, the monitoring of actual bandwidth usage during an extensive download may be given more weight than the monitoring of actual bandwidth usage before or after such a download. That is, if a predetermined number of segments are downloaded consecutively, the average level of usage for each of the segments is adopted as the new \u201cmaximum\u201d level. For example, if the predetermined number of segments is 10, the average level of usage during the downloading of ten consecutive segments would replace the previous maximum level even if the average level is less than the previous maximum value. Moreover, if 11 segments are consecutively downloaded, the average level would be calculated for segments 2-11 so that a moving average of 10 downloads determines both a new maximum level and a new threshold level.","Using a moving average to identify the maximum level advantageously provides a dynamic increase or decrease to the threshold level in response to changing network traffic conditions without compromising the accuracy of the measurement. Preferably, the maximum level will remain frozen at the most recent moving average (of the predetermined number of segments) until another extensive download occurs. In other words, a maximum level based on an extensive download is deemed to be a more accurate reflection of available bandwidth than the initial maximum level measured prior to a download. Likewise, the download of an isolated segment may not provide an accurate reflection of available bandwidth. To keep track of the number of consecutive downloads for the moving average, a counter such as the one referenced in  may be used.","Another embodiment of the present invention is described below in conjunction with . With reference to , the further embodiment of the present invention monitors the level of actual network utilization represented by the curve  () and calculates the size of a block of data that can be transferred within a predetermined interval (T\u2212T) () such that transfer of data between the client and server is not likely to interfere with other network activity. A block represents a portion of an entire set of data that is to be transferred or other independent useful unit of data. This further embodiment more fully utilizes the available bandwidth of a Network by computing block sizes and refining network speed estimates, as opposed to an embodiment as described above that utilizes a fixed threshold value to determine when to transfer data.","In practice and by way of example and not limitation,  illustrates some concepts from the further embodiment of this invention. As shown in , the sampling time is generally designated by Tand the interval T\u2212Tis initially set to a value such as 1 second. In , the region (Area ) under the external usage curve  between the intervals Tand T() would represent the total number of bytes that were transferred by processes other than the current invention. The region (Area ) bounded by the observed network throughput , the external usage curve , and the intervals Tand T (), represent the amount of bytes that could potentially be assigned for a block size. As shown, the Network throughput  and external usage  fluctuate over time, thereby necessitating the re-computation of block sizes in order to fully utilize the available bandwidth. Network activity is sampled at various points during each interval. The sampling interval is then adjusted in response to the determined network speed and utilization, rather than being maintained at a fixed value in contrast to the embodiment of . This reduces CPU and network overhead that arises from using block sizes that are not optimized for the Network.","This embodiment includes three components. There is a network interface component that collects data about the number of bytes sent and received through the Network interface hardware. There is a network speed calculator component that determines Global speed, Download speed and Free bandwidth. Finally, there is the Data Block Download component that uses the values computed by the speed component to compute a block size and download interval size.","The algorithms used by this further embodiment are detailed below. Here again, it should be noted that the references within the following algorithms are exemplary, since this algorithm is equally applicable to the upload of data.","The embodiment divides each time interval into two phases, a download phase and an idle phase. During the download phase, the software downloads a block of data from the server. During the idle phase, the software relinquishes the network to other applications.","The network-monitor component of the embodiment has access to a counter that records the number of bytes that have passed through the network interface at a given moment. The difference between two readings of the counter indicates the number of bytes that have been transferred in the time between the two readings.","During each time interval (T\u2212T), the network-monitor component samples the system clock and bytes-transferred counter at three points: (1) the start of the interval, which is also the start of the download phase, (2) the end of the download phase, and (3) the end of the interval. The download component records the interval length, the size of the block to be downloaded, and the expected duration of the download phase. At the end of the interval, the network-speed component updates its speed estimates as follows:\n\n","The block-downloader component uses Percent-free to choose the relative length of the download phase and idle phase of the following download interval. The further embodiment limits percent-free to 80% as insurance against an increase in external activity, other similar policies are also possible.","The further embodiment adjusts the duration of the sampling interval depending upon the network speed and utilization, rather than using a fixed value as in . This reduces CPU and network overhead that arises from using block sizes that are not optimized for the Network. For instance, in many implementations, using a very large block size would require dedicating a prohibitive amount of memory as a buffer. Conversely, sending data as a series of very small blocks may waste resources by requiring extra network header fields and network protocol acknowledgements. Deriving block sizes that take full advantage of Network bandwidth and that minimize the interference to Network traffic is an advantage of this further embodiment. There are several steps and components involved in determining appropriate block sizes.","For the purpose of further illustration and with reference to , assume that the upper bound for a block size, which is dictated by the memory of the downloader, is 30 Kb, i.e. the downloader can hold 30 Kb of data before it needs to write to a disk. Assume further that that the default interval duration is one second and the computed block size for interval T-Tis 35 Kb, which is beyond the maximum. As such, the algorithms of the present invention will shrink the durations of the next interval intervals T-Tin order to reduce the block size below the maximum. Continuing with this illustration, if the interval T-Twere reduced to 0.8 seconds for example, it will result in a computed block size of 28 Kb, which is within the bounds for a block size. Thus the next interval T-T() will also be set at 0.8 seconds instead of 1 second. Those skilled in the art will appreciate that the use of a variety of interval values and other block size boundaries are also contemplated by the present invention. Conversely, a block size is considered to be too small when the computed size falls below a default lower boundary which has been determined to be an inefficient size of data to transfer in the given interval. In this case, the downloader may choose to download the minimum size and then download nothing for one or more intervals, or it may choose to increase the interval length.","Several conservative approaches are taken in this further embodiment to support an acceptable level of system responsiveness while more fully utilizing available network bandwidth. Those skilled in the art will appreciate that any number of more or less conservative approaches could be used and are contemplated by the present invention. More specifically, a smoothing of the sampled network data is achieved by using an average for the Global Speed and Download Speed wherein, the average is weighted in favor of the most recent sample. In computing the running average, the latest sample counts for 30% of the new total, with the previous value counting for 70%. While this particular method of diluting the latest value with previous averages is used, other implementations would achieve the same result of allowing recovery from spikes in network activity. For example, keeping the last 10 samples and then re-computing an average using all the saved samples and the newly obtained sample each time would achieve the same result. Another approach that is taken involves a global rate that is determined to be less than one half of the average usage rate. In this case, it is assumed that the reduction is a result of client inactivity rather than a sudden loss of bandwidth. Thus, the newly determined Global speed value is not introduced into the average because that would unduly reduce the bandwidth average. However, the Global speed average is slightly reduced by a value such as 10%, in case the bandwidth really has changed. An example of such a bandwidth change would be if the telephone line noise suddenly increased due to a thunderstorm in the area. Yet another conservative approach that is taken involves limiting the Percent-free to a value such as 80%, in order to leave a little cushion for other applications.","The further embodiment of the present invention utilizes a data structure  illustrated in . The data structure  includes a first field  which contains the time at which the identified level of actual bandwidth utilization was taken and a second field  which contains the total number of bytes through the network interface, a monotonically increasing counter of the bytes that have been sent or received by the adapter. As shown in , both the timestamp and the bytes count vary with each sampling, depending on the level of actual utilization . By subtracting consecutive measurements of these values, an interval period and number of bytes transferred during the interval period are obtained.",{"@attributes":{"id":"p-0078","num":"0085"},"figref":["FIG. 10","FIG. 8"],"b":["1000","1002"]},"Referring again to , based on the initialized values for block size, Percent-free and interval, a block download and network data collection take place at step . Then, at step , the network speed related elements namely Download speed, Global speed and Percent-free are refined and updated accordingly. Next, a block size is calculated as a function of the network speed related elements at step . A new block size is calculated each time after a block download. As a general proposition, the block size could be anywhere between the size of communications packet header and the size of the memory allocated for the downloader. The presently preferred minimum block size for Internet applications is approximately 1000 bytes, 500 for block data and 500 for HTTP request and reply packet headers. Once the size has been calculated, the actual usage is sampled again at step .","At step , an average of download speed and Global speed are computed, along with the network Percent-free value. As previously discussed with reference to , during this process, it is determined whether the observed Global speed is within an acceptable range of the average Global speed, and whether Percent-free is less than a predetermined maximum fraction of bandwidth value. In the further embodiment of this invention, the observed Global speed must be greater than one half of the average Global speed in order to be included in the computation of a new average Global speed. Otherwise, the new average is determined to be 90% of the previous average Global speed. With regards to Percent-free, the further embodiment of this invention may require that a computed Percent-free value can be no greater than 80%.","Software updates (or other set of data) available from the server can be downloaded over the network to the client. As discussed above, to minimize interference with any other present or future network activity of the client, the download is preferably performed by downloading the software update in several segments otherwise referred to as a block. Accordingly, at step , one segment of the file is downloaded from the server to the client. If the client's network activity increases after downloading the first segment, the further embodiment will download smaller blocks unless the block size drops below the previously discussed minimum. However, if the network becomes idle, the next iteration of step  will increase the block size appropriately.","At step , the computed block size is bounded to a lower and upper value. The lower boundary is a size so small that it is more efficient to do nothing in that particular interval. If a computed block size is below this boundary during two consecutive intervals, the size of the interval is incremented and no block is downloaded during this second interval, as shown at step . If the computed block size remains below the lower boundary during the newly incremented interval, the block size is set to a \u201cBusy-block-size\u201d and the interval is set to a default interval value. Busy-block-size is a value that allows a minimal download to occur such that, 1) some progress is made in the download process, 2) the invention is able to address a situation wherein a server is so slow that the calculated block size may never rise to the downloader minimum, and 3) the process of downloading allows the refinement of estimated network speeds. A block size that exceeds the maximum boundary results in a shrinking of the interval so that the computed block size can be kept within bounds.","The present invention has been described in connection with exemplary embodiments which are intended to be illustrative rather than restrictive. For example, the invention has been described in the context of downloading software updates for the operating system of the PC. The software updates could just as easily relate to many other types of software, such as updates to video games on the PC. Moreover, the data to be downloaded may include text, image and\/or audio data. The present invention is also equally applicable to uploads from the client to the server.","Alternative embodiments of the present invention will become apparent to those skilled in the art to which it pertains upon review of the specification, including the drawing figures. Accordingly, the scope of the present invention is defined by the appended claims rather than the foregoing description."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE SEVERAL VIEWS OF THE DRAWING","p":["The present invention is described in detail below with reference to the attached drawing figures, wherein:",{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":["FIG. 3","FIG. 2"]},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 10"}]},"DETDESC":[{},{}]}
