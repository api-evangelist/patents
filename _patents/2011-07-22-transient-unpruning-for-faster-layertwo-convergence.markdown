---
title: Transient unpruning for faster layer-two convergence
abstract: In one embodiment, a method includes detecting a change in network topology and broadcasting a transient unconditional unpruning message to all nodes in the network. The message is configured to instruct each network element receiving the message to start a phase timer in response to the broadcast message; unprune its operational ports; and, upon expiration of the phase timer, prune its ports in accordance with the results of a pruning protocol.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08812708&OS=08812708&RS=08812708
owner: Cisco Technology, Inc.
number: 08812708
owner_city: San Jose
owner_country: US
publication_date: 20110722
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND","DESCRIPTION OF EXAMPLE EMBODIMENTS","DESCRIPTION"],"p":["This disclosure generally relates to virtual local area networks (VLANs).","Multiple VLAN registration protocol (MVRP) is used in layer-two networks to conserve bandwidth by preventing unnecessary flooding. MVRP prunes ports in the active network topology so that traffic will be flooded over only necessary links. The underlying active topology can be generated by different loop prevention protocols such as spanning tree protocol (STP), multiple spanning tree (MST), and resilient Ethernet protocol (REP). During network topology changes, such as interfaces going down, pruning states of ports in a network may need to be reprogrammed. How fast the pruning states can be updated will affect the speed of layer two network convergence.","Overview","In one embodiment, a mechanism called transient unpruning (TUP) enhances layer two convergence after a topology change. During the initial phase of a topology change, switches in the layer-two network are notified to unprune either all ports indiscriminately or a subset based on user configuration. Once settled, the pruning states are synchronized with multiple VLAN registration protocol (MVRP) and then continue to be controlled by MVRP. In particular embodiments, this mechanism achieves faster convergence at the cost of potential initial excessive flooding.",{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 1","b":["100","100","100","100","100","100","100","100","110","120","130","110","110","110","110"]},"Links  couple servers  and clients  to network  or to each other. This disclosure contemplates any suitable links . As an example and not by way of limitation, one or more links  each include one or more wireline (such as, for example, Digital Subscriber Line (DSL) or Data Over Cable Service Interface Specification (DOCSIS)), wireless (such as, for example, Wi-Fi or Worldwide Interoperability for Microwave Access (WiMAX)) or optical (such as, for example, Synchronous Optical Network (SONET) or Synchronous Digital Hierarchy (SDH)) links . In particular embodiments, one or more links  each includes an intranet, an extranet, a VPN, a LAN, a WLAN, a WAN, a MAN, a communications network, a satellite network, a portion of the Internet, or another link  or a combination of two or more such links . Links  need not necessarily be the same throughout network environment . One or more first links  may differ in one or more respects from one or more second links .","This disclosure contemplates any suitable servers . As an example and not by way of limitation, one or more servers  may each include one or more advertising servers, applications servers, catalog servers, communications servers, database servers, exchange servers, fax servers, file servers, game servers, home servers, mail servers, message servers, news servers, name or DNS servers, print servers, proxy servers, sound servers, standalone servers, web servers, or web-feed servers. In particular embodiments, a server  includes hardware, software, or both for providing the functionality of server . As an example and not by way of limitation, a server  that operates as a web server may be capable of hosting websites containing web pages or elements of web pages and include appropriate hardware, software, or both for doing so. In particular embodiments, a web server may host HTML or other suitable files or dynamically create or constitute files for web pages on request. In response to a Hyper Text Transfer Protocol (HTTP) or other request from a client , the web server may communicate one or more such files to client . As another example, a server  that operates as a mail server may be capable of providing e-mail services to one or more clients . As another example, a server  that operates as a database server may be capable of providing an interface for interacting with one or more data stores (such as, for example, data stores  described below). Where appropriate, a server  may include one or more servers ; be unitary or distributed; span multiple locations; span multiple machines; span multiple datacenters; or reside in a cloud, which may include one or more cloud components in one or more networks.","In particular embodiments, one or more links  may couple a server  to one or more data stores . A data store  may store any suitable information, and the contents of a data store  may be organized in any suitable manner. As an example and not by way or limitation, the contents of a data store  may be stored as a dimensional, flat, hierarchical, network, object-oriented, relational, XML, or other suitable database or a combination or two or more of these. A data store  (or a server  coupled to it) may include a database-management system or other hardware or software for managing the contents of data store . The database-management system may perform read and write operations, delete or erase data, perform data de-duplication, query or search the contents of data store , or provide other access to data store .","In particular embodiments, one or more servers  may each include one or more search engines. A search engine may include hardware, software, or both for providing the functionality of search engine. As an example and not by way of limitation, a search engine may implement one or more search algorithms to identify network resources in response to search queries received at search engine, one or more ranking algorithms to rank identified network resources, or one or more summarization algorithms to summarize identified network resources. In particular embodiments, a ranking algorithm implemented by a search engine may use a machine-learned ranking formula, which the ranking algorithm may obtain automatically from a set of training data constructed from pairs of search queries and selected Uniform Resource Locators (URLs), where appropriate.","In particular embodiments, one or more servers  may each include one or more data monitors\/collectors. A data monitor\/collection may include hardware, software, or both for providing the functionality of data collector\/collector. As an example and not by way of limitation, a data monitor\/collector at a server  may monitor and collect network-traffic data at server  and store the network-traffic data in one or more data stores . In particular embodiments, server  or another device may extract pairs of search queries and selected URLs from the network-traffic data, where appropriate.","This disclosure contemplates any suitable clients . A client  may enable a user at client  to access or otherwise communicate with network , servers , or other clients . As an example and not by way of limitation, a client  may have a web browser, such as MICROSOFT INTERNET EXPLORER or MOZILLA FIREFOX, and may have one or more add-ons, plug-ins, or other extensions, such as GOOGLE TOOLBAR or YAHOO TOOLBAR. A client  may be an electronic device including hardware, software, or both for providing the functionality of client . As an example and not by way of limitation, a client  may, where appropriate, be an embedded computer system, an SOC, an SBC (such as, for example, a COM or SOM), a desktop computer system, a laptop or notebook computer system, an interactive kiosk, a mainframe, a mesh of computer systems, a mobile telephone, a PDA, a netbook computer system, a server, a tablet computer system, or a combination of two or more of these. Where appropriate, a client  may include one or more clients ; be unitary or distributed; span multiple locations; span multiple machines; span multiple datacenters; or reside in a cloud, which may include one or more cloud components in one or more networks.","VLAN trunking protocol, or VLAN trunk protocol (VTP) is a Cisco proprietary Layer 2 messaging protocol that manages the addition, deletion, and renaming of virtual local area networks (VLAN) on a network-wide basis. Cisco's VLAN trunk protocol reduces administration in a switched network. When a new VLAN is configured on one VTP server, the VLAN is distributed through all switches in the domain. This reduces the need to configure the same VLAN everywhere. To do this, VTP carries VLAN information to all the switches in a VTP domain. VTP advertisements can be sent over inter-switch link protocol (ISL), 802.1q, Institute of electrical and electronics engineers (IEEE) 802.10 and LAN emulation (LANE) trunks. VTP is available on most of the Cisco Catalyst Family products.","VTP ensures that all switches in the VTP domain are aware of all VLANs. However, there are occasions when VTP can create unnecessary traffic. All unknown unicasts and broadcasts in a VLAN are flooded over the entire VLAN. All switches in the network receive all broadcasts, even in situations in which few users are connected in that VLAN. VTP pruning is a feature that used in order to eliminate or prune this unnecessary traffic.",{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 2A","b":["1","2","201"]},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 2B","b":["5","4"]},"When VTP pruning is enabled on a VTP server, pruning is enabled for the entire management domain. Making VLANs pruning-eligible or pruning-ineligible affects pruning eligibility for those VLANs on that trunk only (not on all switches in the VTP domain). VTP pruning takes effect several seconds after it is enabled. VTP pruning does not prune traffic from VLANs that are pruning-ineligible.",{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 3"},"In a VLAN bridged network, it is desirable to restrict unknown unicast, multicast, and broadcast traffic to those links which the traffic must use to access the appropriate network devices. In a large network, localized topology changes can affect the service over a much larger portion of the network. IEEE 802.1ak replaces generic attribute registration protocol (GARP) with MRP offering much improvement over resource utilization and conservation of bandwidth. With the 802.1ak MRP attribute encoding scheme, MVRP only needs to send one PDU that includes the state of all VLANs on a port. MVRP also includes the transmission of a topology change notification (TCN) for individual VLANs. This is an important feature for service providers because it allows them to localize topology changes. However, currently, topology changes in network environments having pruned ports can result in significant delays in layer two convergence, because MVRP PDUs are not propagated across blocked ports.",{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 4","b":["2","3","44","10","8","10","999","8","333","2","4","2","1"]},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 5","b":["2","44","44","10","999","333","2","1","44","10","2","1"]},"There are two issues affecting expedient unpruning of the ports, first, the sequential nature of topology convergence, and second, long propagation delays:\n\n","In particular embodiments, faster layer-two convergence can be achieved by broadcasting a TUP message. In particular embodiments, the TUP message includes at least the following fields:\n\n","In particular embodiments, two types of frames carry the TUP message. The first type are multicast frames with a non-reserved destination address (type 1 frames). Switches in the network are programmed in such a way that these frames will be forwarded normally as data, as well as punted to the CPU. These frames must be processed immediately by control planes, possibly within interrupt contexts.","The second type of frames carrying the TUP message are multicast frames with reserved destination addresses such as Cisco address 0100.0CCC.CCCC or IEEE address 0180C2.000003 (type 2 frames). These frames will be punted to the receiving node's CPU only. However, unlike the first type of frames, these frames will go through blocked ports.",{"@attributes":{"id":"p-0034","num":"0039"},"figref":"FIG. 6","b":["604","606"]},"At step , another node receives the TUP message. The receiving node at step  decides whether to drop or forward the message. Upon receiving a TUP message, the switch (or node) determines if the message has been received before, based on its originator bridge ID and sequence number. If it is a duplicate, the switch, at Step , will drop it without taking any action. Otherwise if it is carried in a type 2 frame, the control plane will flood it out of all ports regardless of whether the ports are blocked or not. If it is carried in a type 1 frame, the TUP message is flooded out of non-blocked ports through the control plane.","Independent of the type of frame received, the node first unprunes all its operational ports based on the VLAN list field. At step , the receiving node starts an initial phase timer. This timer is based on the duration field in the TUP message. If the timer has already been started due to a previous message, the switch or node extends the expiration period of the phase time based on the new message. Upon expiration of the timer at step , the process proceeds to Step , where the switch prunes those nodes whose MVRP states still do not indicate being unpruned. Thus the ports are pruned in accordance with a running pruning protocol.","Since the generation and transmission of TUP messages are independent of active topology convergence, ports in the active topology could be unpruned even before they are unblocked. In addition, the hardware assistance in forwarding TUP messages carried in type 1 frames reduces propagation delays substantially. While type 2 TUP frames are propagated more slowly, they can penetrate possible disconnected topology before convergence and still achieve the goal of parallel processing.","TUP messages generate minimal loads on both the network and the individual switch CPUs due to their small size and simple processing logic. For networks whose deployment demands minimal traffic disruption, the disclosed method can be enabled to significantly reduce convergence time.",{"@attributes":{"id":"p-0039","num":"0044"},"figref":"FIG. 7","b":["700","700","700","700","700"]},"This disclosure contemplates any suitable number of computer systems . This disclosure contemplates computer system  taking any suitable physical form. As example and not by way of limitation, computer system  may be an embedded computer system, a system-on-chip (SOC), a single-board computer system (SBC) (such as, for example, a computer-on-module (COM) or system-on-module (SOM)), a desktop computer system, a laptop or notebook computer system, an interactive kiosk, a mainframe, a mesh of computer systems, a mobile telephone, a personal digital assistant (PDA), a server, a tablet computer system, or a combination of two or more of these. Where appropriate, computer system  may include one or more computer systems ; be unitary or distributed; span multiple locations; span multiple machines; span multiple data centers; or reside in a cloud, which may include one or more cloud components in one or more networks. Where appropriate, one or more computer systems  may perform without substantial spatial or temporal limitation one or more steps of one or more methods described or illustrated herein. As an example and not by way of limitation, one or more computer systems  may perform in real time or in batch mode one or more steps of one or more methods described or illustrated herein. One or more computer systems  may perform at different times or at different locations one or more steps of one or more methods described or illustrated herein, where appropriate.","In particular embodiments, computer system  includes a processor , memory , storage , an input\/output (I\/O) interface , a communication interface , and a bus . Although this disclosure describes and illustrates a particular computer system having a particular number of particular components in a particular arrangement, this disclosure contemplates any suitable computer system having any suitable number of any suitable components in any suitable arrangement.","In particular embodiments, processor  includes hardware for executing instructions, such as those making up a computer program. As an example and not by way of limitation, to execute instructions, processor  may retrieve (or fetch) the instructions from an internal register, an internal cache, memory , or storage ; decode and execute them; and then write one or more results to an internal register, an internal cache, memory , or storage . In particular embodiments, processor  may include one or more internal caches for data, instructions, or addresses. This disclosure contemplates processor  including any suitable number of any suitable internal caches, where appropriate. As an example and not by way of limitation, processor  may include one or more instruction caches, one or more data caches, and one or more translation lookaside buffers (TLBs). Instructions in the instruction caches may be copies of instructions in memory  or storage , and the instruction caches may speed up retrieval of those instructions by processor . Data in the data caches may be copies of data in memory  or storage  for instructions executing at processor  to operate on; the results of previous instructions executed at processor  for access by subsequent instructions executing at processor  or for writing to memory  or storage ; or other suitable data. The data caches may speed up read or write operations by processor . The TLBs may speed up virtual-address translation for processor . In particular embodiments, processor  may include one or more internal registers for data, instructions, or addresses. This disclosure contemplates processor  including any suitable number of any suitable internal registers, where appropriate. Where appropriate, processor  may include one or more arithmetic logic units (ALUs); be a multi-core processor; or include one or more processors . Although this disclosure describes and illustrates a particular processor, this disclosure contemplates any suitable processor.","In particular embodiments, memory  includes main memory for storing instructions for processor  to execute or data for processor  to operate on. As an example and not by way of limitation, computer system  may load instructions from storage  or another source (such as, for example, another computer system ) to memory . Processor  may then load the instructions from memory  to an internal register or internal cache. To execute the instructions, processor  may retrieve the instructions from the internal register or internal cache and decode them. During or after execution of the instructions, processor  may write one or more results (which may be intermediate or final results) to the internal register or internal cache. Processor  may then write one or more of those results to memory . In particular embodiments, processor  executes only instructions in one or more internal registers or internal caches or in memory  (as opposed to storage  or elsewhere) and operates only on data in one or more internal registers or internal caches or in memory  (as opposed to storage  or elsewhere). One or more memory buses (which may each include an address bus and a data bus) may couple processor  to memory . Bus  may include one or more memory buses, as described below. In particular embodiments, one or more memory management units (MMUs) reside between processor  and memory  and facilitate accesses to memory  requested by processor . In particular embodiments, memory  includes random access memory (RAM). This RAM may be volatile memory, where appropriate Where appropriate, this RAM may be dynamic RAM (DRAM) or static RAM (SRAM). Moreover, where appropriate, this RAM may be single-ported or multi-ported RAM. This disclosure contemplates any suitable RAM. Memory  may include one or more memories , where appropriate. Although this disclosure describes and illustrates particular memory, this disclosure contemplates any suitable memory.","In particular embodiments, storage  includes mass storage for data or instructions. As an example and not by way of limitation, storage  may include an HDD, a floppy disk drive, flash memory, an optical disc, a magneto-optical disc, magnetic tape, or a Universal Serial Bus (USB) drive or a combination of two or more of these. Storage  may include removable or non-removable (or fixed) media, where appropriate. Storage  may be internal or external to computer system , where appropriate. In particular embodiments, storage  is non-volatile, solid-state memory. In particular embodiments, storage  includes read-only memory (ROM). Where appropriate, this ROM may be mask-programmed ROM, programmable ROM (PROM), erasable PROM (EPROM), electrically erasable PROM (EEPROM), electrically alterable ROM (EAROM), or flash memory or a combination of two or more of these. This disclosure contemplates mass storage  taking any suitable physical form. Storage  may include one or more storage control units facilitating communication between processor  and storage , where appropriate. Where appropriate, storage  may include one or more storages . Although this disclosure describes and illustrates particular storage, this disclosure contemplates any suitable storage.","In particular embodiments, I\/O interface  includes hardware, software, or both providing one or more interfaces for communication between computer system  and one or more I\/O devices. Computer system  may include one or more of these I\/O devices, where appropriate. One or more of these I\/O devices may enable communication between a person and computer system . As an example and not by way of limitation, an I\/O device may include a keyboard, keypad, microphone, monitor, mouse, printer, scanner, speaker, still camera, stylus, tablet, touch screen, trackball, video camera, another suitable I\/O device or a combination of two or more of these. An I\/O device may include one or more sensors. This disclosure contemplates any suitable I\/O devices and any suitable I\/O interfaces  for them. Where appropriate, I\/O interface  may include one or more device or software drivers enabling processor  to drive one or more of these I\/O devices. I\/O interface  may include one or more I\/O interfaces , where appropriate. Although this disclosure describes and illustrates a particular I\/O interface, this disclosure contemplates any suitable I\/O interface.","In particular embodiments, communication interface  includes hardware, software, or both providing one or more interfaces for communication (such as, for example, packet-based communication) between computer system  and one or more other computer systems  or one or more networks. As an example and not by way of limitation, communication interface  may include a network interface controller (NIC) or network adapter for communicating with an Ethernet or other wire-based network or a wireless NIC (WNIC) or wireless adapter for communicating with a wireless network, such as a WI-FI network. This disclosure contemplates any suitable network and any suitable communication interface  for it. As an example and not by way of limitation, computer system  may communicate with an ad hoc network, a personal area network (PAN), a local area network (LAN), a wide area network (WAN), a metropolitan area network (MAN), or one or more portions of the Internet or a combination of two or more of these. One or more portions of one or more of these networks may be wired or wireless. As an example, computer system  may communicate with a wireless PAN (WPAN) (such as, for example, a BLUETOOTH WPAN), a WI-FI network, a WI-MAX network, a cellular telephone network (such as, for example, a Global System for Mobile Communications (GSM) network), or other suitable wireless network or a combination of two or more of these. Computer system  may include any suitable communication interface  for any of these networks, where appropriate. Communication interface  may include one or more communication interfaces , where appropriate. Although this disclosure describes and illustrates a particular communication interface, this disclosure contemplates any suitable communication interface.","In particular embodiments, bus  includes hardware, software, or both coupling components of computer system  to each other. As an example and not by way of limitation, bus  may include an Accelerated Graphics Port (AGP) or other graphics bus, an Enhanced Industry Standard Architecture (EISA) bus, a front-side bus (FSB), a HYPERTRANSPORT (HT) interconnect, an Industry Standard Architecture (ISA) bus, an INFINIBAND interconnect, a low-pin-count (LPC) bus, a memory bus, a Micro Channel Architecture (MCA) bus, a Peripheral Component Interconnect (PCI) bus, a PCI-Express (PCI-X) bus, a serial advanced technology attachment (SATA) bus, a Video Electronics Standards Association local (VLB) bus, or another suitable bus or a combination of two or more of these. Bus  may include one or more buses , where appropriate. Although this disclosure describes and illustrates a particular bus, this disclosure contemplates any suitable bus or interconnect.","Herein, reference to a computer-readable storage medium encompasses one or more non-transitory, tangible computer-readable storage media possessing structure. As an example and not by way of limitation, a computer-readable storage medium may include a semiconductor-based or other integrated circuit (IC) (such, as for example, a field-programmable gate array (FPGA) or an application-specific IC (ASIC)), a hard disk, an HDD, a hybrid hard drive (HHD), an optical disc, an optical disc drive (ODD), a magneto-optical disc, a magneto-optical drive, a floppy disk, a floppy disk drive (FDD), magnetic tape, a holographic storage medium, a solid-state drive (SSD), a RAM-drive, a SECURE DIGITAL card, a SECURE DIGITAL drive, or another suitable computer-readable storage medium or a combination of two or more of these, where appropriate. Herein, reference to a computer-readable storage medium excludes any medium that is not eligible for patent protection under 35 U.S.C. \u00a7101. Herein, reference to a computer-readable storage medium excludes transitory forms of signal transmission (such as a propagating electrical or electromagnetic signal per se) to the extent that they are not eligible for patent protection under 35 U.S.C. \u00a7101. A computer-readable non-transitory storage medium may be volatile, non-volatile, or a combination of volatile and non-volatile, where appropriate.","This disclosure contemplates one or more computer-readable storage media implementing any suitable storage. In particular embodiments, a computer-readable storage medium implements one or more portions of processor  (such as, for example, one or more internal registers or caches), one or more portions of memory , one or more portions of storage , or a combination of these, where appropriate. In particular embodiments, a computer-readable storage medium implements RAM or ROM. In particular embodiments, a computer-readable storage medium implements volatile or persistent memory. In particular embodiments, one or more computer-readable storage media embody software. Herein, reference to software may encompass one or more applications, bytecode, one or more computer programs, one or more executables, one or more instructions, logic, machine code, one or more scripts, or source code, and vice versa, where appropriate. In particular embodiments, software includes one or more application programming interfaces (APIs). This disclosure contemplates any suitable software written or otherwise expressed in any suitable programming language or combination of programming languages. In particular embodiments, software is expressed as source code or object code. In particular embodiments, software is expressed in a higher-level programming language, such as, for example, C, Perl, or a suitable extension thereof. In particular embodiments, software is expressed in a lower-level programming language, such as assembly language (or machine code). In particular embodiments, software is expressed in JAVA. In particular embodiments, software is expressed in Hyper Text Markup Language (HTML), Extensible Markup Language (XML), or other suitable markup language.","Herein, \u201cor\u201d is inclusive and not exclusive, unless expressly indicated otherwise or indicated otherwise by context. Therefore, herein, \u201cA or B\u201d means \u201cA, B, or both,\u201d unless expressly indicated otherwise or indicated otherwise by context. Moreover, \u201cand\u201d is both joint and several, unless expressly indicated otherwise or indicated otherwise by context. Therefore, herein, \u201cA and B\u201d means \u201cA and B, jointly or severally,\u201d unless expressly indicated otherwise or indicated otherwise by context.","This disclosure encompasses all changes, substitutions, variations, alterations, and modifications to the example embodiments herein that a person having ordinary skill in the art would comprehend. Similarly, where appropriate, the appended claims encompass all changes, substitutions, variations, alterations, and modifications to the example embodiments herein that a person having ordinary skill in the art would comprehend. Moreover, reference in the appended claims to an apparatus or system or a component of an apparatus or system being adapted to, arranged to, capable of, configured to, enabled to, operable to, or operative to perform a particular function encompasses that apparatus, system, component, whether or not it or that particular function is activated, turned on, or unlocked, as long as that apparatus, system, or component is so adapted, arranged, capable, configured, enabled, operable, or operative."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0004","num":"0003"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0005","num":"0004"},"figref":"FIG. 2A"},{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 2B"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 7"}]},"DETDESC":[{},{}]}
