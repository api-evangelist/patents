---
title: Power supply and communications controller
abstract: A power supply extracts electrical power from the electro-magnetic field surrounding a high voltage power conductor and conditions the derived input power to provide a stable power source for instrumentation and communications equipment. The communications controller is a local network router that routes serial data traffic to selected communication devices such as an instrumentation processor, a power supply processor, or a maintenance port controller. The router forwards the data to other communications equipment and forwards data from the communicating equipment to an external network providing substantially simultaneous communications between the external network and the instrumentation processor, power supply processor and maintenance port controller.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08497781&OS=08497781&RS=08497781
owner: Underground Systems, Inc.
number: 08497781
owner_city: Armonk
owner_country: US
publication_date: 20051021
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"p":["This application claims the benefit of priority of provisional application Ser. No. 60\/621,098 filed Oct. 22, 2004.","This invention relates to a communication system. In particular, the communication system can communicate data associated with power transmission lines to remote systems.","Power line instruments can be mounted on a power line conductor to measure and analyze the values of particular parameters of overhead power line conductors. The performance of the power line may be determined from the values of the parameters. A communication system transmits the values measured by the power line instruments to local ground receiving stations dedicated to those instruments. The data from the various ground stations can be further transmitted to central control stations for analysis of the values of the parameters.","The values of parameters measured by the power line instruments can provide a measure of the performance of the power line conductor. The parameters associated with each conductor can describe the operational state of the power conductor and include sensing the voltage, current, phase angle, temperature, sag and the other parameters of the associated conductor. The measured quantities are communicated to one or more ground-based processors. Power for the power line instruments can be derived from the electro-magnetic field associated with the power line conductor. When power is conducted through the power line conductor a magnetic field sets up around the conductor. The magnetic field can be used to induce a current and voltage in a power supply. The induced current and voltage can be used for powering the power line instruments including the communication system.","In one aspect, a power supply controller for an instrument platform associated with a power line conductor includes an extracting means for extracting and outputting power from an electro-magnetic field generated by the power line conductor. A shunt coupled to the extracting means manages the electrical output power of the extracting means. A portion of the outputted power is stored in an energy storage means that provides a direct current (DC). Power conditioning circuitry coupled to the shunt and the energy storage means converts the output power from the extracting means and the DC input from the energy storage means to DC potentials required by circuitry of the power supply controller and the instrument platform. A communications controller is coupled to the power conditioning circuitry to transmit and receive data messages within the instrument platform and with remotely located processors and remotely located instrument platforms.","The disclosure can be implemented to realize one or more of the following advantages. The electrical instrument platform can be mounted on an energized power conductor and capable of simultaneously measuring and monitoring electrical, thermal and mechanical parameters of the conductor while communicating those values to other similar instruments and also to ground based processors located locally or remotely beyond immediate radio transmission distance. The device has the capability to process and analyze data generated from its own instruments, as well as data received from other such apparatus. The apparatus derives its power from the electro-magnetic field due to current flowing through the power conductor; the disclosure further relates a technique for operating the apparatus using stored energy (batteries) when there is inadequate or no current flow through the conductor.","One or more implementations include a means for transmitting data to remote systems. The communications may be real time, using wireless radio transceivers, and wireless cellular data technology. Both mechanisms are included in the disclosure, and both mechanisms can be used simultaneously. When fitted with a cell phone transceiver, the device can be used without local ground based equipment. A router system is embodied in the apparatus that manages the data message traffic.","The details of one or more embodiments of the invention are set forth in the accompanying drawings and the description below. Other features and advantages of the invention will become apparent from the description, the drawings, and the claims.",{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 10","b":["10","12","21","12","21","22","24","23","25","21","26","8","27","26","21","21","21","27","12","12","20","18","12","12","23","12","23","12","12","21","12"]},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 5","b":["1100","1102","1102","1102","1102","1102","1104","1110","1112","1112","1114","1102","1120","1116","1118","1102","1102","1104","1102","1120","1104","1120","1102","1102","1102","1102","1102","1102","1124","1122","1102","1102","1102","1102","1102"],"i":["a","b","c ","a","b ","c ","a","b ","c ","a","b ","c","c ","a","b ","c ","c ","b ","a ","c. "]},"Thus, in a power line monitoring system using power supply controllers and communication controls of the present invention, each instrument platform can be powered from a power line conductor. Each instrument platform in the system can transmit its own data parameters to another instrument platform or a ground-based processor. Also, each instrument platform in the system can receive data from another instrument platform and transmit that data to a third instrument platform. Hence, only one of a plurality of instrument platforms in the system need be in communication with a ground-based processor and no external power need be provided to the instrument platforms.",{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 1","b":["100","102","104","106","102","108","110","102","112","104"]},"The communications control adapter  is an electrical and mechanical intermediary between the power supply controller  and a communications device . Communication device  may be one or more wireless communication options disposed on the communication expansion adapter . The communication device  includes a 900 MHz Frequency Hopping Spread Spectrum Radio, 2.4 GHz Frequency Hopping Spread Spectrum radio and GSM\/GPRS Phone Module. The communications control adapter can provide communication of data from the main controller and power supply controller to external processors (not shown) through the communication device . The external processors can be other instrument platforms, ground-based processors or central control processors that monitor the power line conductor.","Power supply controller  can communicate with the main controller  through a network . A microcontroller (not shown) in the power supply controller  can run a software program to affect the operation of the power supply controller. Power from power supply controller  is provided to the main controller and on to the instrument platform on a line . The power supply controller  can include a field update port  to receive test and manufacturing updates and software program updates from external devices.","The function of the power supply controller  includes (1) preliminary power conditioning for the main controller , power supply for itself and communications control adapter , (2) communications routing to\/from the main controller , (3) communications control of wireless devices , and (4) control of charging a rechargeable battery .","Current transformer  can be disposed around the power line conductor. A magnetic field produced by current flowing in the power line conductor can induce a voltage in the current transformer  that may be modified by shunt transformer  and provided to the power supply controller . The instrument platform can be powered by coupling with the electro-magnetic field generated when current flows in the power line conductor. The instrument platform is attached directly on the power conductor and measures current and voltage from the electrical and magnetic field surrounding the conductor. The electrical instrument platform includes the rechargeable battery  for powering the instrument platform when the current flow, and resultant electro-magnetic field, in the power line conductor is below a first threshold value. When the current flow is above the first predetermined threshold value, the instrument platform can be powered by electromagnetic induction from the power line conductor. When the current flow is above a second threshold value, excess current may be channeled to charge the battery . When a zero current condition persists in the conductor beyond a predetermined time limit, battery control circuitry and\/or a software program can reduce the frequency of data transmission from the communications control adapter to the external processors, thus conserving battery power. When battery voltage drops below a predetermined level, all battery-powered transmission may be stopped until the batteries are recharged.","The interconnection of the power supply controller  is now described in greater detail. The interconnections within the power supply controller include:\n\n","The transformer interface contains signals and potentials including:\n\n","The battery interface provides for signals and current flows including:\n\n","A detailed description of the communications expansion interface is provided below under \u201cThe Power Supply Communications Expansion Interface.\u201d","Battery Disconnect Switch Interface ","The Battery Switch interface enables a power down of the instrument platform when line power is not traversing through the power line conductor at a level sufficient to sustain operation of the instrument platform. This functionality can enable the internal battery to maintain a charge when the system is not being used.","Main Controller Power and I\/O Interface ","The main controller  receives power and control signals from the power supply controller .","Test and Manufacturing I\/O\/Field Update Port ","The test and manufacturing I\/O enables a user to factory program the microcontroller and update factory calibration information stored in a memory of the power supply controller. In addition, when installed in a unit, some of the signals may be route to a port the field update port, that can enable the system to be configured in the field.","When used as a field update port (FUP), the test and manufacturing interface can be wired using a harness with a reduced number of signals. These signals can be externally available to allow for testing and updates of the firmware (software program) without requiring the power donut assembly to be disassembled.",{"@attributes":{"id":"p-0036","num":"0046"},"figref":"FIG. 2","b":["200","102","202","204","110","208","134","212","212","104"],"i":["a","b "]},"Power Conditioner","The power conditioner  can convert alternating current (AC) input power from the shunt control  and the direct current (DC) input from the battery  to the DC potentials required within the power supply controller .",{"@attributes":{"id":"p-0038","num":"0048"},"figref":["FIG. 3","FIG. 2"],"b":["300","202","302","302","208","104","106","304"]},"+10V Charger (+10VCHG)","The battery charge control  requires approximately +10V that may be derived from the +Vprim signal from the current transformer . Power to the battery charge control  may be adjustable under software program control to four different current limit settings and regulated to +10V by a battery charger current limiter and regulator circuitry in the battery charge control .","Microcontroller Kernel",{"@attributes":{"id":"p-0041","num":"0051"},"figref":["FIG. 4","FIG. 2"],"b":["400","204","204","402","402","402","404","402"]},"External Static Random Access Memory (SRAM)","External SRAM , which may be organized at 256 kbit\u00d716, can be provided for debug and development as well as external software code\/data storage. Data may only be written as words, on even addresses. Code and data constants, which may be stored in the internal flash memory, can reside in External SRAM .","Serial Electrically Erasable Programmable Memory (EEPROM)","Two serial EEPROM devices ,  may be provided on I2C  bus and can be organized as 512\u00d78 bits. A Manufacturing (MFG) EEPROM can be write-able at the factory by assertion of a write-enable signal (EEWREN) available at the test and manufacturing connector . The MFG EEPROM can reside at address  (A=0, A=1, A=0) and store information not expected to change in the field. The data can be used by the power supply controller to set thresholds for the minimum power requirements for radio transmission, baud rate configuration, and other parameters.","Battery Charge Control","The battery charge control  can be used to charge and monitor the status of the energy storage device  (). In an implementation, the energy storage device is an integrated Lithium Ion battery pack (2 Cells). Power to the charger can be supplied from the +Vprim () signal and can be current limited and voltage regulated. The microcontroller  can cause the battery charge control  to provide different charging rates under program control. The battery charge control can monitor the battery voltage and the battery temperature to regulate the charging of the battery. Charging status signals can be provided by the battery charge control  to the microcontroller .","Transformer Shunt Control","The current transformer  () provides power to the main controller . The current transformer  is wound with a secondary and shunt winding. Transformer shunt control  can cause the shunt winding to be shorted and attenuate the power output of the secondary winding. The transformer shunt control thus can limit the maximum voltage output from the secondary winding that may exist under light load conditions or when high current is present on the power conduction line. The microcontroller  can monitor the transformer secondary voltage and, in response, control the shorting of the shunt winding by controlling the transformer shunt control winding. In an implementation, an optically isolated triac driving a higher power triac can be used to short the shunt winding.","Test and Manufacturing Port\/Field Update Port","A test and manufacturing port  enables access for the user to factory program the microcontroller  internal flash memory and external MFG EEPROM . Boot logic circuitry  coupled to the port  can enable a user to put the microcontroller  into Boot Loader mode when a boot enable (BOOTEN) signal is asserted. A default microcontroller boot mode asynchronous port SCI2 can be connected to the test and manufacturing port  to enable RS232 level serial boot loading. Some of the signals to\/from test and manufacturing port  can be routed to an external field update port  (). This may enable operation and field updates of the main controller and microcontroller without disassembly.","Temperature Sensor","A temperature sensor  can provide the microcontroller  with a signal associated with the internal temperature of the power supply controller.","Power Supply Communications Expansion Adapter","The communications expansion adapter  interface is described in detail below.","Communications Power Protection","Communication power protection cam be provided by a current limiting circuit (not shown) to isolate the communications load from the power supply controller. In an implementation, the current limit of the current limiting circuit can be set to approximately 1.0 A to allow for the worst-case continuous load supplied to the communications expansion adapter by the power supply controller.","Power Supply Communications Expansion Adapter Interface",{"@attributes":{"id":"p-0059","num":"0069"},"figref":"FIG. 6","ul":{"@attributes":{"id":"ul0007","list-style":"none"},"li":{"@attributes":{"id":"ul0007-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0008","list-style":"none"},"li":["Power Supply Controller\/Communications Expansion Adapter interface ","2.4 GHz radio interface ","900 MHz radio interface ","GSM\/GRPS Cell Phone Module interface ","SIM Card interface ","Debug RS232 interface \n\nThe communications expansion adapter interface includes:\n","A logic level asynchronous serial interface\u2014H8 SCI1","A logic level SPI to interface which may be configured for Master or Slave\u2014H8 SP13","4 logic level digital outputs","4 logic level digital inputs","An analog input to the H8","And protected +Vin power for the communications devices"]}}}},"900 MHz Radio","The 900 MHz radio electrical interconnect  is an asynchronous serial interface with logic level signals. Signals may be passed from the power supply controller to the 900 MHz radio through 0\u03a9 resistors to enable electrical isolation during test and development. The 900 MHz radio  interface requires substantially no electrical signal transformation from the power supply controller.","2.4 GHz Radio","The 2.4 GHz radio electrical interconnect  is an asynchronous serial interface with logic level signals. The interface also can include signals that allow for additional control. The signals may be passed from the power supply controller to the 2.4 GHz radio through 0\u03a9 resistors to enable electrical isolation during test and development. The 2.4 GHz radio interface  requires substantially no electrical signal transformation from the power supply controller.","In an implementation, the 2.4 GHz radio can be mechanically affixed to the communications expansion adapter.","GSM G20 Module","The GSM\/GPRS Cell Phone Module  can include an asynchronous interface with TTL levels for data\/control packets, a master serial peripheral interface (SPI) port for debug information, an inter-integrated circuit (I2C) port for EEPROM configuration and a SIM card interface for GSM identification. The GSM\/GPRS Cell Phone module  can be mechanically affixed to the communications expansion adapter .","GSM SIM Card Interface","The GSM\/GPRS Cell Phone module  also can be coupled to a SIM card interface , which can enable the module to retrieve GSM system configuration information. Communications expansion adapter  can incorporate a SIM connector assembly.","Debug RS232 Transceiver Port","A Debug RS232 transceiver port  can be used during development to interconnect a host computer to the communications expansion adapter. The debug RS232 port  may be used to:\n\n",{"@attributes":{"id":"p-0070","num":"0095"},"figref":"FIG. 7"},"Communications Expansion Adapter Power Supply","The communications expansion adapter power supply  () can be designed to supply power to the installed communications device . Input to the communications expansion adapter power supply may be supplied from the protected +Vin (). The power supply  may be configured at time of manufacture for the installed communications device .","Power supply controller operation is controlled by a microcontroller  under the control of firmware. The firmware can include two independent executable applications:\n\n",{"@attributes":{"id":"p-0074","num":"0101"},"figref":"FIG. 8","b":["800","802","804","806","808","810","812"]},"The main controller application can be derived from the common code modules and an application layer. The power supply firmware can implement protocol handling functionality compatible with that of the main controller application. The power supply can also support routing of the messages based on the device address information supplied with each command including:\n\n","The power supply firmware can perform the following functions:\n\n","Power Management and Control","The power supply firmware can monitor the input power and power conditioning electronics. Status information about the power supply will be periodically transmitted to the main controller. The shunt winding of the power transformer can be controlled by the power supply firmware. The shunt winding may be enabled when the input voltage has exceeded a predetermined threshold.","Battery Charge Control","The firmware can monitor status information from the battery charging system to determine available battery power. In an implementation, battery charging at four different charging rates can also be selected programmatically. This call enable the host system to control the charging activity.","Support for Multiple Radio Interfaces","The power supply controller, through the communication expansion adapter support, can support different types of radios. The power supply can determine the type of radio connected to the radio interface on power-up by querying the information in MFG EEPROM on the communication expansion adapter. Once the radio type is known, the power supply can correctly handle power up sequences and monitoring of the communication expansion adapter. When a GSM\/GPRS Cell Phone is detected, the power supply can handle the additional sequences needed to configure and dial the phone.","Command\/Response Transaction Routing","The power supply firmware can act as the host to the main controller firmware. The power supply controller may inspect the routing information in any command received by the radio interface or the field update port (FUP) interface. The firmware can determine when the command is for the power supply or the main controller. When a received command is for the power supply controller, the power supply firmware can act on the command directly. When a received command is for the main controller, the power supply can pass the command on for processing. The response to the command may pass through the power supply to the radio interface and back to the ground based host system. The power supply can initiate its own commands to the main controller in order to pass information about the power supply controller to the main controller and also to receive status information from the main controller. The power supply controller may determine the power supply controller address and the address of the main controller from information stored in the power supply MFG EEPROM. The information provides the routing table for the power supply controller, these two device addresses can be set to any 16-bit value. A convention can be used where the power supply controller address is the same as the main controller address plus an offset (for example, main controller address of 0x0100, power supply address of 0x8100). This may simplify tracking of the device address information over many power donut systems.","Alert Reporting","The power supply firmware can exchange information with the main controller. When the main controller reports an alert such as a power line conductor measurement from the instrument platform, the power supply can attempt to establish a link with the ground based host system. When a GSM phone is configured on the radio interface then the power supply firmware can attempt to dial a primary phone number to report the alert. Multiple retries may be attempted when the host phone\/modem does not answer. When the power supply firmware detects a busy signal at the primary phone number then a connection on a backup phone number may be established. After the power supply establishes a link with the phone, a \u201cwake up\u201d message may be sent to the host system, which will identify the power donut to the host. The host application will then poll for the alert information and take appropriate action(s).","User Mode Loader Startup","When the power supply controller receives a command from the radio interface to start the user mode loader, the power supply may first start the user mode loader on the main controller. When the power supply has confirmed that the user mode loader has started successfully on the main controller, the user mode loader can be initiated on the power supply. This protocol also may apply to routing information to allow a ground based host to reprogram either the power supply or main controller.","Serial Loader Firmware","Serial loader firmware can enable the user to:\n\n","In the factory, at time of manufacture, the first code to be loaded can be the serial loader. The serial loader is instantiated using the boot loader mode protocol available on the H8S through the test and MFG connector. Once the serial loader has been instantiated, a host computer serial port (RS232) can be used to communicate with the unit via the external communications protocol available on the asynchronous radio port. This approach will allow field updates to be made without disassembly of the power donut. The serial loader may be used to load the flash memory and EEPROM memory on the unit. The serial loader can reside in Block  of the microcontroller flash memory and may be write-protected at the factory. When the serial loader needs to be updated, the power donut will have to be opened and reprogrammed using the test and MFG connector.","An example of serial loader commands is shown in Table 1.",{"@attributes":{"id":"p-0093","num":"0135"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":{"entry":"TABLE 1"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"serial loader Commands"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"91pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"112pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"serial loader Command","Brief Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}},{"entry":[{},"Write flash memory","Write flash memory Memory"]},{"entry":[{},"Read flash memory","Read flash memory Memory"]},{"entry":[{},"Erase flash memory","Erase flash memory Memory"]},{"entry":[{},"Write EEPROM","Write EEPROM Memory"]},{"entry":[{},"Read EEPROM","Read EEPROM Memory"]},{"entry":[{},"Write RAM","Write RAM Memory"]},{"entry":[{},"Read RAM","Read RAM Memory"]},{"entry":[{},"Execute Code","Execute Code"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}]}}},"The serial loader resident in the main controller can reload application code on the main controller in addition to reloading code on the power supply controller module. Therefore routing identification (module ID) will be used to indicate which controller, main or power supply, the host wishes to communicate to.","Common Code Modules","The power supply controller application firmware functions can be derived from code modules that are commonly developed for use on the main controller. The common set of functions may be reused in the power supply firmware. The power supply application can be modularized into layers including:\n\n","Application Programming Interface (API)","An API can be used to abstract the main application firmware from underlying code modules. This API acts as delineation between the lower level layers of firmware and the target specific application firmware. The power supply controller application may make calls to API layer functions. In an implementation, no direct calls to the underlying toolkit and primitive modules are performed. API functions can return a 16-bit error code after making the call. An example of the API functions are listed in Table 2.",{"@attributes":{"id":"p-0099","num":"0145"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":{"entry":"TABLE 2"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"API Function Reference"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"119pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"98pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Function Name","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}},{"entry":["API_INITIALIZE_M( )","Initializes the hardware and all "]},{"entry":[{},"API functions"]},{"entry":["API_BACKGROUND_M","Performs any background "]},{"entry":[{},"operations required by the "]},{"entry":[{},"API. This function should be "]},{"entry":[{},"called periodically to learn "]},{"entry":[{},"ensure correct scheduling of"]},{"entry":[{},"software timers and tasks. This "]},{"entry":[{},"function also controls a "]},{"entry":[{},"watchdog timer that will reset "]},{"entry":[{},"the processor in case of errant "]},{"entry":[{},"firmware. The returned status "]},{"entry":[{},"includes any errors detected "]},{"entry":[{},"by low-level operations such "]},{"entry":[{},"as ADC buffering."]},{"entry":["API_GET_FW_VERSION_M","Returns a string of information "]},{"entry":[{},"that contains the current "]},{"entry":[{},"firmware revision information."]},{"entry":["API_GET_SERIAL_NUM_M","Returns a string of information "]},{"entry":[{},"that contains the current serial "]},{"entry":[{},"number of the unit."]},{"entry":["API_BIST_EXECUTE_M","Executes one or more of the "]},{"entry":[{},"Built-In Self Tests."]},{"entry":["API_EEPROM_READ_M","Reads either EEPROM. The "]},{"entry":[{},"manufacturing EEPROM is "]},{"entry":[{},"located first, the user "]},{"entry":[{},"EEPROM is located after "]},{"entry":[{},"the manufacturing EEPROM."]},{"entry":["API_EEPROM_WRITE_M","Writes either EEPROM. The "]},{"entry":[{},"manufacturing EEPROM is "]},{"entry":[{},"located first, the user EEPROM "]},{"entry":[{},"is located after the "]},{"entry":[{},"manufacturing EEPROM. Write"]},{"entry":[{},"operations to the manufacturing "]},{"entry":[{},"EEPROM will fail unless an "]},{"entry":[{},"external connection is made to "]},{"entry":[{},"the EEWREN# signal on the "]},{"entry":[{},"T\/M header."]},{"entry":["API_ANALOG_READ_M","Reads an analog value from the "]},{"entry":[{},"H8 ADC."]},{"entry":["API_DIGITAL_READ_M","Reads a single digital input."]},{"entry":["API_DIGITAL_WRITE_M","Writes a single digital output."]},{"entry":["API_SERIAL_CONFIG_M","Configures one of the serial "]},{"entry":[{},"ports."]},{"entry":["API_SERIAL_GET_RX_SIZE_M","Gets the number of bytes in the "]},{"entry":[{},"serial receive buffer."]},{"entry":["API_SERIAL_CLEAR_RX_M","Empties the serial input buffer."]},{"entry":["API_SERIAL_SEND_DATA_M","Sends a block of data via the "]},{"entry":[{},"specified serial port."]},{"entry":["API_SERIAL_RECV_DATA_M","Receives a block of data from "]},{"entry":[{},"the specified serial port."]},{"entry":["API_SERIAL_PEEK_DATA_M","Returns data from the serial "]},{"entry":[{},"receive buffer without "]},{"entry":[{},"removing it. The data remains "]},{"entry":[{},"in the buffer until"]},{"entry":[{},"RECV_DATA is called."]},{"entry":["API_CONFIGURE_TASK_M","Configures one of the two real-"]},{"entry":[{},"time application tasks."]},{"entry":["API_TIMER_CONFIG_M","Configures a software timer."]},{"entry":["API_TIMER_CHECK_M","Checks the state of the selected "]},{"entry":[{},"timer."]},{"entry":["API_TIMER_WAIT_M","Waits until a timeout of the "]},{"entry":[{},"specified timer occurs."]},{"entry":["API_START_LOADER_M","Invokes the User Mode Loader."]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}}},"Built-In Self Test (BIST)","The built-in self-test can verify the operation of hardware elements of the power supply controller. These tests can be run by the application on startup to verify the hardware before attempting to initiate normal operation. An example of the tests performed by the BIST is listed in Table 3.",{"@attributes":{"id":"p-0102","num":"0148"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":{"entry":"TABLE 3"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"Built In Self Tests"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Test","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}},{"entry":["Power","Verifies the power supply voltages"]},{"entry":["RAM","Performs a write\/read sweep test on RAM"]},{"entry":["flash","Validates the CRC of the application in flash memory"]},{"entry":["memory",{}]},{"entry":["External I\/O","Verifies operation of the external digital I\/O registers"]},{"entry":["EEPROM","Validates the CRC of EEPROM data structures, tests write"]},{"entry":[{},"capability"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}}},"Hardware Tool","The toolkit modules can abstract further details of the hardware environment and perform additional supporting functions. An example of the modules is listed in Table 4.",{"@attributes":{"id":"p-0105","num":"0151"},"tables":{"@attributes":{"id":"TABLE-US-00004","num":"00004"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":{"entry":"TABLE 4"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"Toolkit Layer Modules"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Module",{}]},{"entry":["Name","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}},{"entry":["tk_cmdset.c","Implements a function interface for externally available"]},{"entry":[{},"commands"]},{"entry":["tk_digital.c","Adds support for external digital latches and registers"]},{"entry":["tk_eeprom.c","Handles read write sequences to the external EEPROM"]},{"entry":[{},"memory"]},{"entry":["tk_hdw.c","Handles system level hardware power up and initialization"]},{"entry":["tk_rttimer.c","Implements a microcontroller timer based system clock"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}}},"Hardware I\/O","Hardware I\/O are low-level primitive functions to handle specific hardware elements of the microcontroller kernel and other supporting hardware. An example of the low-level code modules is listed in Table 5.",{"@attributes":{"id":"p-0108","num":"0154"},"tables":{"@attributes":{"id":"TABLE-US-00005","num":"00005"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":{"entry":"TABLE 5"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"Low Level Primitive Modules"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Module",{}]},{"entry":["Name","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}},{"entry":["io_adc.c","Support for the microcontroller Analog to Digital"]},{"entry":[{},"Converter"]},{"entry":["io_cpu.c","Supports initializing CPU operation in various modes"]},{"entry":["io_dac.c","Support for the H8 Digital to Analog Converter"]},{"entry":["io_dig.c","Support for discrete digital inputs and outputs"]},{"entry":["io_dtc.c","Handles configuration of the H8 Data Transfer controller"]},{"entry":["io_i2c.c","Implements the I2C protocol using general purpose I\/O"]},{"entry":["io_ints.c","Handles setup and management of interrupt vectors"]},{"entry":["io_sci.c","Support for any of the H8 Serial communication interfaces"]},{"entry":["io_spi.c","Support for any of the H8 Serial Peripheral interfaces"]},{"entry":["io_tpu.c","Support for the H8 16-bit Timer Pulse Units"]},{"entry":["io_wdt.c","Support for the H8 Watchdog Timer"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}}},"Communication Protocol","An example of a basic format of a communication protocol is shown in Table 6. The format is similar for both commands and responses. In an implementation, the <STX> character is used as a start of frame marker. This is followed by comma separated command or response information. An 8-bit checksum is calculated and appended after the command information. The <EOT> character is used to indicate end of frame.",{"@attributes":{"id":"p-0111","num":"0157"},"tables":{"@attributes":{"id":"TABLE-US-00006","num":"00006"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":{"entry":"TABLE 6"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"Protocol Format"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"77pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["# of","Values",{}]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"77pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Bytes","Context","ASCII","HEX","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}},{"entry":["1","<STX>","Ctrl B","0x02","Start of Donut Message"]},{"entry":[{},{},{},{},"Packet"]},{"entry":["Max of","AAAA","\u201c1\u201d-","0x30303031-","16 Bit Recipient Device"]},{"entry":["4",{},"\u201cFFFF\u201d","0x46464646","Address"]},{"entry":["1","delimiter","\u2018,\u2019","0x2C","ASCII comma field"]},{"entry":[{},{},{},{},"delimiter"]},{"entry":["1-m","Field 1",{},{},"Variable length data"]},{"entry":[{},{},{},{},"field"]},{"entry":["1","delimiter","\u2018,\u2019","0x2C","ASCII comma field"]},{"entry":[{},{},{},{},"delimiter"]},{"entry":["1-m","Field 2",{},{},"Variable length data"]},{"entry":[{},{},{},{},"field"]},{"entry":["1","delimiter","\u2018,\u2019","0x2C","ASCII comma field"]},{"entry":[{},{},{},{},"delimiter"]},{"entry":["1-m","Field n",{},{},"add additional fields"]},{"entry":[{},{},{},{},"with delimiter"]},{"entry":["1","delimiter","\u2018,\u2019","0x2C","ASCII comma field"]},{"entry":[{},{},{},{},"delimiter"]},{"entry":["2","CS","\u201c00\u201d-","0x3030-","8 Bit checksum"]},{"entry":[{},{},"\u201cFF\u201d","0x4646","calculation"]},{"entry":["1","<EOT>","Ctrl D","0x04","End of Text Character"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}},{"entry":"Notes:"},{"entry":"1. Parsing of the command response messages may be based on the comma delimiters. In some implementations, the 16-bit device address may not need to contain leading zeros."},{"entry":"2. Numeric values can be represented in HEX format. When using only numbers and uppercase letters, lower case letters will be considered an error in the protocol."},{"entry":"3. No \u201cbroadcast\u201d message is supported. The power supply and main controller respond to commands specifically addressed to each device."}]}}]}}},{"@attributes":{"id":"p-0112","num":"0158"},"figref":"FIG. 9","b":["902","904","906","902","904","906","908","902","912","908","904","914","916","908","906","906","918","918","908","906","906","908","918","908","912","908","918"],"i":["m","m","m ","s ","s ","m ","s ","m "]},"The invention has been described in terms of particular embodiments. Other embodiments are within the scope of the claims."],"BRFSUM":[{},{}],"heading":["BACKGROUND","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION","Power Supply Controller Firmware Design"],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":["FIG. 6","FIG. 1"]},{"@attributes":{"id":"p-0016","num":"0015"},"figref":["FIG. 7","FIG. 6"]},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 10"}]},"DETDESC":[{},{}]}
