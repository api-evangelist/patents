---
title: System-managed duplexing of coupling facility structures
abstract: System-managed duplexing of coupling facility structures. A plurality of instances of coupling facility structures are maintained in a plurality of coupling facilities. Duplexing processing associated with the plurality of instances is managed by one or more operating systems, making many of the steps associated with duplexing transparent to the exploiters of the coupling facility structures. System-managed duplexing provides high availability for coupling facility structure data via a robust recovery mechanism (i.e., duplexing failover).
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=06944787&OS=06944787&RS=06944787
owner: International Business Machines Corporation
number: 06944787
owner_city: Armonk
owner_country: US
publication_date: 20011001
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS\/PATENTS","TECHNICAL FIELD","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","BEST MODE FOR CARRYING OUT THE INVENTION"],"p":["This application contains subject matter which is related to the subject matter of the following applications\/patents, each of which is assigned to the same assignee as this application. Each of the below listed applications\/patents is hereby incorporated herein by reference in its entirety:","\u201cTEST TOOL AND METHOD FOR FACILITATING TESTING OF DUPLEXED COMPUTER FUNCTIONS\u201d, Jones et al., Ser. No. 09\/968,420, filed Oct. 01, 2001;","\u201cRESTARTING A COUPLING FACILITY COMMAND USING A TOKEN FROM ANOTHER COUPLING FACILITY COMMAND\u201d, Elko et al., Ser. No. 09\/968,729, filed Oct. 01, 2001;","\u201cDYNAMICALLY DETERMINING WHETHER TO PROCESS REQUESTS SYNCHRONOUSLY OR ASYNCHRONOUSLY\u201d, Jordan et al., Ser. No. 09\/968,185, filed Oct. 01, 2001;","\u201cMANAGING THE STATE OF COUPLING FACILITY STRUCTURES\u201d, Elko et al., Ser. No. 09\/968,248, filed Oct. 01, 2001;","\u201cSYNCHRONIZING PROCESSING OF COMMANDS INVOKED AGAINST DUPLEXED COUPLING FACILITY STRUCTURES\u201d, Elko et al., Ser. No. 09\/968,179, filed Oct. 01, 2001;","\u201cCOUPLING OF A PLURALITY OF COUPLING FACILITIES USING PEER LINKS\u201d, Brooks et al., Ser. No. 09\/968,244, filed Oct. 01, 2001;","\u201cMETHOD, SYSTEM AND PROGRAM PRODUCTS FOR PROVIDING USER-MANAGED DUPLEXING OF COUPLING FACILITY CACHE STRUCTURES\u201d, Elko et al., Ser. No. 09\/255,382, filed Feb. 22, 1999;","\u201cCASTOUT PROCESSING FOR DUPLEXED CACHE STRUCTURES\u201d, Elko et al., Ser. No. 09\/255,383, filed Feb. 22, 1999;","\u201cSYSTEM-MANAGED REBUILD OF COUPLING FACILITY STRUCTURES\u201d, Allen et al., Ser. No. 09\/378,780, filed Aug. 23, 1999;","\u201cMETHOD, SYSTEM AND PROGRAM PRODUCTS FOR COPYING COUPLING FACILITY STRUCTURES\u201d, Allen et al., Ser. No. 09\/379,054, filed Aug. 23, 1999;","\u201cMETHOD, SYSTEM AND PROGRAM PRODUCTS FOR MODIFYING COUPLING FACILITY STRUCTURES\u201d, Brooks et al., Ser. No. 09\/379,435, filed Aug. 23, 1999;","\u201cDIRECTED ALLOCATION OF COUPLING FACILITY STRUCTURES\u201d, Dahlen et al., Ser. No. 09\/378,861, filed Aug. 23, 1999;","\u201cMETHOD, SYSTEM AND PROGRAM PRODUCTS FOR COPYING COUPLING FACILITY LOCK STRUCTURES\u201d, Allen et al., Ser. No. 09\/379,053, filed Aug. 23, 1999;","\u201cMETHOD OF CONTROLLING THE FLOW OF INFORMATION BETWEEN SENDERS AND RECEIVERS ACROSS LINKS BEING USED AS CHANNELS\u201d, Gregg et al. Ser. No. 09\/151,051, filed Sep. 10, 1998;","\u201cSYSTEM OF CONTROLLING THE FLOW OF INFORMATION BETWEEN SENDERS AND RECEIVERS ACROSS LINKS BEING USED AS CHANNELS\u201d, Gregg et al. Ser. No. 09\/150,942, filed Sep. 10, 1998;","\u201cSYSTEM OF PERFORMING PARALLEL CLEANUP OF SEGMENTS OF A LOCK STRUCTURE LOCATED WITHIN A COUPLING FACILITY\u201d, Dahlen et al., U.S. Pat. No. 6,233,644 B1, issued May 15, 2001;","\u201cMULTI CHANNEL INTER-PROCESSOR COUPLING FACILITY PROCESSING RECEIVED COMMANDS STORED IN MEMORY ABSENT STATUS ERROR OF CHANNELS\u201d, Elko et al., U.S. Pat. No. 5,574,945, issued Nov. 12, 1996;","\u201cMETHOD, SYSTEM AND PROGRAM PRODUCTS FOR MANAGING CHANGED DATA OF CASTOUT CLASSES\u201d, Elko et al., U.S. Pat. No. 6,230,243 B1, issued May 8, 2001;","\u201cMETHOD AND SYSTEM FOR CAPTURING AND CONTROLLING ACCESS TO INFORMATION IN A COUPLING FACILITY\u201d, Neuhard et al., U.S. Pat. No. 5,630,050, issued May 13, 1997;","\u201cDYNAMICALLY ASSIGNING A DUMP SPACE IN A SHARED DATA FACILITY TO RECEIVE DUMPING INFORMATION TO BE CAPTURED\u201d, Elko et al., U.S. Pat. No. 5,664,155, issued Sep. 2, 1997;","\u201cMETHOD AND APPARATUS FOR DISTRIBUTED LOCKING OF SHARED DATA, EMPLOYING A CENTRAL COUPLING FACILITY\u201d, Elko et al., U.S. Pat. No. 5,339,427, issued Aug. 16, 1994;","\u201cMETHOD AND SYSTEM FOR LOG MANAGEMENT IN A COUPLED DATA PROCESSING SYSTEM\u201d, Geiner et al., U.S. Pat. No. 5,737,600, issued Apr. 7, 1998;","\u201cMETHOD OF PERFORMING PARALLEL CLEANUP OF SEGMENTS OF A LOCK STRUCTURE\u201d, Dahlen et al., U.S. Pat. No. 6,178,421 B1, issued Jan. 23, 2001;","\u201cSPEEDING-UP COMMUNICATION RATES ON LINKS TRANSFERRING DATA STRUCTURES BY A METHOD OF HANDING SCATTER\/GATHER OF STORAGE BLOCKS IN COMMANDED COMPUTER SYSTEMS\u201d, Gregg et al., U.S. Pat. No. 5,948,060, issued Sep. 7, 1999;","\u201cMETHOD OF MANAGING RESOURCES IN ONE OR MORE COUPLING FACILITIES COUPLED TO ONE OR MORE OPERATING SYSTEMS IN ONE OR MORE CENTRAL PROGRAMMING COMPLEXES USING A POLICY\u201d, Allen et al., U.S. Pat. No. 5,634,072, issued May 27, 1997;","\u201cMETHOD AND APPARATUS FOR OPTIMIZING THE HANDLING OF SYNCHRONOUS REQUESTS TO A COUPLING FACILITY IN A SYSPLEX CONFIGURATION\u201d, Kubala et al., U.S. Pat. No. 5,923,890, issued Jul. 13, 1999;","\u201cMETHOD FOR RECEIVING MESSAGES AT A COUPLING FACILITY\u201d, Elko et al., U.S. Pat. No. 5,706,432, issued Jan. 6, 1998;","\u201cCOMMAND EXECUTION SYSTEM FOR USING FIRST AND SECOND COMMANDS TO RESERVE AND STORE SECOND COMMAND RELATED STATUS INFORMATION IN MEMORY PORTION RESPECTIVELY\u201d, Elko et al., U.S. Pat. No. 5,392,397, issued Feb. 21, 1995;","\u201cSOFTWARE CACHE MANAGEMENT OF A SHARED ELECTRONIC STORE IN A SUPPLEX\u201d, Elko et al., U.S. Pat. No. 5,457,793, issued Oct. 10, 1995;","\u201cREQUESTING A DUMP OF INFORMATION STORED WITHIN A COUPLING FACILITY, IN WHICH THE DUMP INCLUDES SERVICEABILITY INFORMATION FROM AN OPERATING SYSTEM THAT LOST COMMUNICATION WITH THE COUPLING FACILITY\u201d, Neuhard et al, U.S. Pat. No. 5,860,115, issued Jan. 12, 1999;","\u201cAUTHORIZATION METHOD FOR CONDITIONAL COMMAND EXECUTION\u201d, Elko et al, U.S. Pat. No. 5,450,590, issued Sep. 12, 1995;","\u201cIN A MULTIPROCESSING SYSTEM HAVING A COUPLING FACILITY, COMMUNICATING MESSAGES BETWEEN THE PROCESSORS AND THE COUPLING FACILITY IN EITHER A SYNCHRONOUS OPERATION OR AN ASYNCHRONOUS OPERATION\u201d, Elko et al., U.S. Pat. No. 5,561,809, issued Oct. 1, 1996;","\u201cCOUPLING FACILITY FOR RECEIVING COMMANDS FROM PLURALITY OF HOSTS FOR ACTIVATING SELECTED CONNECTION PATHS TO I\/O DEVICES AND MAINTAINING STATUS THEREOF\u201d, Elko et al., U.S. Pat. No. 5,463,736, issued Oct. 31, 1995;","\u201cMETHOD AND SYSTEM FOR MANAGING DATA AND USERS OF DATA IN A DATA PROCESSING SYSTEM\u201d, Allen et al., U.S. Pat. No. 5,465,359, issued Nov. 7, 1995;","\u201cMETHODS AND SYSTEMS FOR CREATING A STORAGE DUMP WITHIN A COUPLING FACILITY OF A MULTISYSTEM ENVIRONMENT\u201d, Elko et al., U.S. Pat. No. 5,761,739, issued Jun. 2, 1998;","\u201cMETHOD AND APPARATUS FOR COUPLING DATA PROCESSING SYSTEMS\u201d, Elko et al., U.S. Pat. No. 5,317,739, issued May 31, 1994;","\u201cMETHOD AND APPARATUS FOR EXPANSION, CONTRACTION, AND REAPPORTIONMENT OF STRUCTURED EXTERNAL STORAGE STRUCTURES\u201d, Dahlen et al., U.S. Pat. No. 5,581,737, issued Dec. 3, 1996;","\u201cSYSPLEX SHARED DATA COHERENCY METHOD\u201d, Elko et al., U.S. Pat. No. 5,537,574, issued Jul. 16, 1996;","\u201cMULTIPLE PROCESSOR SYSTEM HAVING SOFTWARE FOR SELECTING SHARED CACHE ENTRIES ON AN ASSOCIATED CASTOUT CLASS FOR TRANSFER TO A DASD WITH ONE I\/O OPERATION\u201d, Elko et al., U.S. Pat. No. 5,493,668, issued Feb. 20, 1996;","\u201cINTEGRITY OF DATA OBJECTS USED TO MAINTAIN STATE INFORMATION FOR SHARED DATA AT A LOCAL COMPLEX\u201d, Elko et al., U.S. Pat. No. 5,331,673, issued Jul. 19, 1994;","\u201cCOMMAND QUIESCE FUNCTION\u201d, Elko et al., U.S. Pat. No. 5,339,405, issued Aug. 16, 1994;","\u201cMETHOD AND APPARATUS FOR PERFORMING CONDITIONAL OPERATIONS ON EXTERNALLY SHARED DATA\u201d, Elko et al., U.S. Pat. No. 5,742,830, issued Apr. 21, 1998;","\u201cMETHOD AND SYSTEM FOR RECONFIGURING A STORAGE STRUCTURE WITHIN A STRUCTURE PROCESSING FACILITY\u201d, Allen et al., U.S. Pat. No. 5,515,499, issued May 7, 1996;","\u201cMETHOD FOR COORDINATING EXECUTING PROGRAMS IN A DATA PROCESSING SYSTEM\u201d, Allen et al., U.S. Pat. No. 5,604,863, issued Feb. 18, 1997; and","\u201cSYSTEM AND METHOD FOR MANAGEMENT OF OBJECT TRANSITIONS IN AN EXTERNAL STORAGE FACILITY ACCESSED BY ONE OR MORE PROCESSORS\u201d, Dahlen et al., U.S. Pat. No. 5,887,135, issued Mar. 23, 1999.","This invention relates, in general, to data processing within a distributed computing environment, and in particular, to system-managed duplexing of coupling facility structures and of commands used to access those structures.","Some distributed computing environments, such as Parallel Sysplexes, today provide a non-volatile shared storage device called the coupling facility, that includes multiple storage structures of either the cache or list type. These structures provide unique functions for the operating system and middleware products employed for the efficient operation of a Parallel Sysplex. For example, the cache structures provide directory structures and cross-invalidation mechanisms to maintain buffer coherency for multisystem databases, as well as a fast write medium for database updates. These are used by, for instance, the data sharing versions of DB2 and IMS, offered by International Business Machines Corporation, Armonk, N.Y.","The list structures provide many diverse functions. One such list structure function is to provide for high-performance global locking, and this function is exploited by such products as the IMS Resource Lock Manager (IRLM) and the Global Resource Serialization (GRS) function in OS\/390, offered by International Business Machines Corporation, Armonk, N.Y. Another list structure function is to provide a message passing mechanism with storage for maintaining multiple messages on a per system basis and a mechanism for notifying a system of the arrival of new messages. This function is exploited by the XCF component of OS\/390, which in turn is exploited by numerous multisystem applications for providing a capability to pass messages between their various instances. A third list structure function is to provide for shared queue structures that can be ordered and accessed by LIFO\/FIFO ordering, by key, or by name. Workload Manager (WLM), IMS Shared Message Queues and MQ Series, all offered by International Business Machines Corporation, Armonk, N.Y., are examples of exploiters of this feature. While these functions provide examples of the list structure uses, other uses exist.","Various components of a Parallel Sysplex have been documented in numerous applications\/patents, which are listed above and hereby incorporated herein by reference in their entirety. The capabilities defined in some of those patents provide the basic system structure to create and manage cache and list structure instances. Additionally, various of the applications\/patents listed above provide extensions to the base functions of the Parallel Sysplex.","In order to increase the robustness of coupling facility structures, over the years, various processes have been introduced that enable coupling facility structures to be rebuilt either for a planned reconfiguration or in response to a failure. Examples of these rebuild processes are described below:\n\n","Based on the foregoing, a need still exists for a system-managed duplexing capability. That is, a need exists for a duplexing capability that is managed by the operating system and largely transparent to the users of the system. Further, a need exists for a duplexing capability that enables duplexing of the various types of coupling facility structures, including cache, list and lock structures.","The shortcomings of the prior art are overcome and additional advantages are provided through the provision of a method of duplexing coupling facility structures. The method includes, for instance, creating, independent of user control, an instance of a coupling facility structure, wherein the instance of the coupling facility structure and another instance of the coupling facility structure co-exists; and processing a command against the instance of the coupling facility structure and the another instance of the coupling facility structure.","In a further aspect of the present invention, a method of facilitating access to coupling facility structures is provided. The method includes, for instance, splitting a command to be processed against a duplexed coupling facility structure into multiple instances of the command; and forwarding at least a plurality of instances of the multiple instances of the command to a plurality of instances of the duplexed coupling facility structure.","In yet a further aspect of the present invention, a method of providing duplexing within a computing environment is provided. The method includes, for instance, duplexing a coupling facility structure, wherein one instance of the coupling facility structure is located within one coupling facility of the computing environment and another instance of the coupling facility structure is located within another coupling facility of the computing environment, the one coupling facility and the another coupling facility being coupled via one or more CF-to-CF connections; splitting a command to be processed against the coupling facility structure into one command instance and another command instance; forwarding, substantially in parallel, the one command instance to the one instance of the coupling facility structure and the another command instance to the another instance of the coupling facility structure; and processing the one command instance and the another command instance.","In one embodiment, the method further includes receiving responses from the one command instance and the another command instance; merging the responses into one response; and forwarding the one response to a requester of the command.","In another aspect of the present invention, a method of monitoring processing modes of coupling facility structures is provided. The method includes, for instance, determining whether a coupling facility structure processing in simplex mode is to be processed in duplex mode; and automatically initiating duplexing of the coupling facility structure, in response to the determining indicating that the coupling facility structure is to be processed in duplex mode.","In yet a further aspect of the present invention, a method of managing processing associated with coupling facility structures is provided. The method includes, for instance, determining that a mode of processing associated with a coupling facility structure is to be altered; and altering, independent of user control, the mode of processing associated with the coupling facility structure, in response to the determining.","In still yet another aspect of the present invention, a method of managing connections to coupling facility structures is provided. The method includes, for instance, determining whether a potential connector has connectivity to one instance of a duplexed coupling facility structure or to the one instance and another instance of the duplexed coupling facility structure; and connecting the potential connector to the one instance or to the one instance and the another instance, in response to the determining, wherein the connecting is managed independent of the potential connector.","System and computer program products corresponding to the above-summarized methods are also described and claimed herein.","Additional features and advantages are realized through the techniques of the present invention. Other embodiments and aspects of the invention are described in detail herein and are considered a part of the claimed invention.","In accordance with one or more aspects of the present invention, a system-managed duplexing capability is provided, in which one or more coupling facility structures of a computing environment are duplexed under the control of one or more operating systems of the environment.","At a high level, coupling facility duplexing includes creating a second, duplex copy of an existing coupling facility structure, in another coupling facility. Relevant data and content from the original coupling facility structure is replicated in the duplexed copy. This duplexed copy is established initially in advance of any failure which might affect the structure or compromise the data that the structure contains. Then, the operating system maintains the duplex pair of structures in a synchronized, duplexed state during normal operation, as the structure's exploiter performs coupling facility operations that update the structure's content. In effect, coupling facility operations that have the potential to modify coupling facility structure data, or other structure objects, are replicated to both structures, so that the updates can be made in a coordinated way in both structure instances.","In one aspect, coupling facility duplexing is to provide a robust failure recovery capability through the ability to failover to the unaffected structure instance at any time, whenever a failure of any kind affects one of the two duplexed structure instances. Another aspect is to internalize many of the difficult steps that formerly required coupling facility exploiter support and participation (e.g., in user-managed duplexing rebuild processes) into the operating system, thereby greatly reducing the exploiter's cost to provide a structure duplexing capability relative to the previous techniques (e.g., user-managed duplexing rebuild).","System-managed duplexing rebuild thus provides both a robust failure recovery capability for coupling facility structure data and content via the redundancy of duplexing, and at the same time, low exploitation cost via system-managed, internalized processing. Additionally, unlike user-managed duplexing rebuild, which supports only cache structures, system-managed duplexing rebuild supports all types of coupling facility structures (including list and lock structures, as well as cache structures).","One embodiment of a computing environment incorporating and using one or more aspects of the present invention is depicted in FIG.  and described herein.",{"@attributes":{"id":"p-0080","num":"0088"},"figref":"FIG. 1","b":["100","102","104","106","108","110","112","114"]},"Two instances of the coupling facility structure are maintained in separate coupling facilities, referred to as the primary coupling facility and the secondary coupling facility. A CF-to-CF connection  (e.g., a peer connection), such as an Intersystem Channel (ISC) link, couples the two coupling facilities. The peer ISC link can transmit both primary message commands and secondary message commands in either direction. This may be physically represented by either two unidirectional links, one with a sender channel on the primary coupling facility and a receiver channel on the secondary coupling facility, and the second link oppositely configured. This may also be represented by a single physical link where the channel interface in each coupling facility supports both sender and receiver functionality. This latter capability exists in ISC3 links and their variants: ICB3 and IC3, all of which are offered by International Business Machines Corporation, Armonk, N.Y.","The peer ISC link between the coupling facilities is used, for instance, to exchange message path commands on the primary message command interface to configure and couple the two coupling facilities. Once configured and coupled, the peer ISC link is also used to send secondary commands of the list-notification type to exchange signals as part of a signaling protocol for duplexed command execution. The sending and receiving of these secondary commands is managed by a coupling facility component called a signaling protocol engine . Requests by the cache and list component of the coupling facility for sending and receiving duplexing signals flow through the signaling protocol engine.","One embodiment of the steps in a normal command execution for the coupling facility-to-coupling facility duplexing model are shown in  in numeric sequence that approximates the time sequence of the command. In these steps, various components of the signaling protocol are described. Further details regarding the signaling protocol are described in detail in a co-filed patent application entitled \u201cCoupling Of A Plurality Of Coupling Facilities Using Peer Links,\u201d Brooks et al., Ser. No. 09\/968,244, which is hereby incorporated herein by reference in its entirety.","Step 1. The user application generates a command and communicates this command to the LFSS through a system macro interface.","Step 2. The LFSS creates two copies of the command, sending one to the primary coupling facility and the second to the secondary coupling facility. The LFSS uses an asynchronous SEND MESSAGE interface without notification to allow the two commands to be initiated in parallel. The LFSS also sets a synchronous completion on initial status (SCIS) bit of the SEND MESSAGE to minimize the effects of any busy conditions encountered on the channel interface. A link-subsystem (LSS) component  of the coupling facility control code (CFCC) in the primary coupling facility receives the command and transfers control to the cache or list component, as appropriate. Likewise, the link-subsystem (LSS) component in the secondary coupling facility receives the command and transfers control to the cache or list component, as appropriate.","Step 3. The cache\/list component of the primary coupling facility executes the command to the point where a message response block (MRB) would be returned to the application. But, before sending the MRB and while the internal latches are held for the objects referenced by the command, a request is made to the signaling protocol engine in the primary coupling facility to send a completion signal on the peer ISC link to the secondary coupling facility. Likewise, the cache\/list component of the secondary coupling facility executes the command to the point where the MRB would be returned to the application. But, before sending the MRB and while the internal latches are held for the objects referenced by the command, a request is made to the signaling protocol engine in the secondary coupling facility to send a completion signal on the peer ISC link to the primary coupling facility.","Step 4. The signaling protocol engine in the primary coupling facility sends the completion signal to the secondary coupling facility and then waits for the reception of the completion signal from the secondary coupling facility. Likewise, the signaling protocol engine in the secondary coupling facility sends the completion signal to the primary coupling facility and then waits for the reception of the completion signal from the primary coupling facility.","Step 5. When the primary coupling facility recognizes the reception of the completion signal from the secondary coupling facility, the primary coupling facility sends the MRB and releases the latches. Likewise, when the secondary coupling facility recognizes the reception of the completion signal from the primary coupling facility, it also sends the MRB and releases the latches. If a failure occurs during this period of time and either the primary coupling facility or the secondary coupling facility fails to recognize the reception of a completion signal, then duplexing is broken by the coupling facility by, for instance, resetting a duplexing active indicator for the structure.","Step 6. Assuming no errors have occurred, the LFSS receives both MRBs from the two coupling facilities and constructs a single message response block by reconciling the results of the two MRBs and gives this response to the application. If, on the other hand, duplexing has been broken by one of the two coupling facilities, then the operating system invokes failover recovery and one of the two structures is selected as the surviving instance. Once the error is corrected, duplexing can be reestablished.","With the above processing, user transparency is provided because the duplexing functions are performed by the LFSS without awareness by the user application.","Failure isolation is also provided by creating two copies of the structure in separate facilities, each of which can continue as the surviving structure in a situation involving the failure of the other. Further, command atomicity is provided by maintaining latches on both structures until both commands complete.","Performance is optimized in several ways. First, sending the commands in parallel allows for maximum overlap of data transfer and command execution. Second, by exchanging completion signals immediately upon reaching the MRB send point in the command, the completion can be detected with minimal intervening latency. Third, the amount of data sent in the signal itself is small relative to the amount of data sent on the primary link for the command. So, a single peer ISC link can handle the combined signal traffic generated by commands sent on a significant number of primary ISC links. In fact, for small distances, a single ISC link can handle the combined traffic of the commands generated in a 32-system Parallel Sysplex. Fourth, by using list notification as the signaling transport mechanism, the signal can be processed by the receiver channel engine without needing to interrupt the coupling facility control code (CFCC) to process the signal. Fifth, by using the SCIS facility, contention detected by a SEND MESSAGE can be minimized by causing redrives to be performed substantially immediately.","Although in the embodiment described above, an ISC link is used to couple the two coupling facilities, this is only one example. Other links may be used, including, for instance, an ICB or IC link. Further, more than two coupling facilities may be coupled to one another. However, it is not necessary for all coupling facilities to be coupled to each other. For instance, a third coupling facility may be coupled to Coupling Facility  via a peer connection, but not to Coupling Facility .","In addition to the above, the coupling facilities that are coupled may be in separate Central Processing Complexes (CPC), in separate partitions of one CPC, or a combination thereof. In the situation that the facilities are in separate partitions of one CPC, the same links can be used for both duplexing and command traffic.","In another embodiment, multiple peer links can be configured as redundant connections. In this scenario, the duplexing protocol recognizes a link failure and maintains signal exchanges on surviving links.","Further details regarding system-managed duplexing are described hereinafter. The manner in which system-managed duplexing fits in with other rebuild processes is pictorially depicted in FIG. . As depicted in , the four types of rebuild process can be viewed as occupying a two-dimensional space. One dimension indicates the rebuild process type: whether the intent of the rebuild process is to simply rebuild the structure () from one location to another, or to duplex the structure (). The other dimension indicates the rebuild process technique: whether the process is user-managed () or system-managed (). These dimensions define the different rebuild processes: user-managed rebuild (), system-managed rebuild (), user-managed duplexing rebuild (), and system-managed duplexing rebuild (). Various aspects of system-managed duplexing rebuild are described below.","Problems Solved by System-Managed Coupling Facility Structure Duplexing","System-managed duplexing provides a general-purpose, hardware-assisted, easy-to-exploit mechanism for duplexing coupling facility structure data. This provides a robust recovery mechanism for failures, such as loss of a single structure or coupling facility, or loss of connectivity to a single coupling facility, through the ability to perform a rapid failover to the other structure instance of the duplex pair.","Previously, coupling facility exploiters had several potential mechanisms for providing recovery in these hard failure scenarios, each with its own costs and compromises related to availability.\n\n","As can be seen from the above, none of these approaches is ideal. Several of them have significant performance overhead associated with them during mainline operation (for example, the cost of synchronously hardening data out to DASD in addition to the coupling facility in a store-through cache model); some of them compromise availability in a failure scenario by involving a potentially lengthy rebuild or log recovery process during which the data is unavailable (for example, log merge and recovery for an unduplexed DB2 group buffer pool cache). Furthermore, some of these recovery approaches involve considerable development and test expense on the part of the coupling facility exploiters to provide the appropriate level of recovery, as each exploiter implements their own unique recovery mechanisms.","System-managed duplexing is intended to address such problems by providing an easily-exploited common framework for duplexing the structure data contained in any type of coupling facility structure, with installation control over which structures are duplexed. Overhead of duplexing during mainline operation is minimized via architecturally-defined, hardware-assisted serialization and synchronization between the primary and secondary structure updates. Availability in failure scenarios is maximized by providing a rapid failover to the unaffected structure instance of the duplexed pair, with very little disruption to the ongoing execution of work by the exploiter and applications.","Transparency to Exploiters","When a duplexing rebuild is system-managed (rather than user-managed), the operating system performs most of the significant steps in the overall duplexing rebuild process on behalf of the users. For example, the operating system can internally quiesce the use of the structure on the user's behalf (the user may also elect to perform some amount of rerouting of work away from the structure at the user's level), allocate a second instance of the structure, establish attachment to the new structure on the users' behalf, copy all necessary or desired data from the old structure instance to the new in order to establish duplexing, and then while in the duplex established phase, the operating system transparently duplexes user's mainline coupling facility operations to both structures, as needed, to maintain the duplexed pair of structure images.","In contrast, user-managed duplexing requires the coupling facility exploiters to be aware of, and to participate directly in, each of these steps, as described in, for instance, \u201cMethod, System And Program Products For Providing User-Managed Duplexing Of Coupling Facility Cache Structures\u201d, Elko et al., U.S. application Ser. No. 09\/255,382, filed Feb. 22, 1999, which is hereby incorporated herein by reference in its entirety. Advantageously, from the exploiter's perspective, this aspect of the present invention is thus, a great simplification in achieving a structure duplexing capability relative to previous techniques.","Moreover, since the duplex copy of the structure is established in advance of any failures that may eventually occur, and duplexing synchronization between the structures is maintained over time as the users perform coupling facility mainline accesses, system-managed duplexing provides a robust recovery capability for the various types of failure scenarios. Structure failures or total losses of coupling facility connectivity can be handled transparently by the operating system, by:\n\n","Although many aspects of the system-managed duplexing are transparent, one or more aspects are not totally transparent. For example, transitions into or out of the duplexed state caused by establishing duplexing initially (transitioning from simplex to duplex mode) or falling out of duplexing (transitioning from duplex to simplex mode) are not conducted in a totally transparent manner, in that the exploiters are not completely unaware of the transition taking place.","However, while system-managed duplexing does not provide the exploiters with complete transparency from the standpoint of enablement support and of transitions into and out of the duplexed state, it does provide exploiters with transparency in the following aspects:\n\n","The following sections consider various aspects of the present invention.","Duplexed Processing for Mainline Coupling Facility Operations",{"@attributes":{"id":"p-0107","num":"0126"},"figref":"FIG. 3","b":["300","302","304"]},"In some cases, the determination at INQUIRY  is straightforward. For example, some coupling facility commands are architecturally defined as simplex mode commands only, because they do not have a capability of updating any structure objects which are duplexed; such commands lack the request operands that architecturally request duplexed execution. Thus, such commands are processed in simplex mode, STEP . These commands include, for instance:\n\n","In some cases, the determination at INQUIRY  is made by virtue of the context in which the commands are executed. For example, while the commands do update structure objects, they do so only in the context of structure instance management; that is, in the course of the operating system itself establishing duplexing or managing the primary or secondary structure instances. Such commands lack the request operands that architecturally request duplexed execution and are also processed in simplex mode, STEP . Examples of such commands include, for instance:\n\n","Some coupling facility commands either may or may not update duplexed structure objects, depending on the command-specific operands that the user has requested on the command. When such commands are executing with operands specified that preclude possible updates to duplexed structure objects, the operating system performs these as simplex operations directed against the primary structure instance, STEP . Such commands, and their request-specific operands that indicate they may be performed as simplex requests, include, for instance:\n\n","Lastly, several cache commands have the property that they can cause an update to the storage class for a cache entry, but no specific operand controls whether an update is in fact being requested; rather, these commands simply set the storage class for the entry, and it may or may not cause a change to the storage class previously defined for the entry. Since in general, updating the storage class for an entry is believed to be a rare occurrence, these commands will optimistically be driven in simplex mode against the primary structure, STEP , with an operand that causes the command to fail if in fact a storage class update occurs. When these commands fail in this way, they are redriven by the operating system, transparently, as duplexed requests. Such commands include, for instance:\n\n","In one embodiment, in general, commands are driven in simplex mode whenever possible, to avoid the overhead associated with the duplexing protocols. However, for any command that supports duplexed execution, if it cannot be reliably determined that the operands or context of the request imply that no duplexed structure objects can be updated by the command, then the request is performed in a duplexed fashion, STEP . Further details regarding the processing of a duplexed coupling facility operation are described with reference to -",{"@attributes":{"id":"p-0113","num":"0179"},"figref":"FIG. 4","b":["400","402","1","404","2","406","400","408","410","3","400","412"]},"When operating system  processes the request in duplex mode, it splits the request into two coupling facility commands, one of which is driven in parallel to each of the two structure instances (), the primary and secondary, that reside in the two coupling facilities. The two commands are \u201ctagged\u201d with the architected request operands that denote duplexed execution, including, for example: a command sequence number (CSN), which is a number associated with a currently executing duplexed command; a duplexing signal-group index (DSGX), which is a value that identifies the duplex signal group to be updated in a signaling vector; and a duplexing retry index (DRX), which is a value that designates a signaling vector entry for the signaling vector identified by remote facility controls. These operands allow the architected duplexing signal exchanges to be carried out when these commands arrive at the respective target coupling facilities. For instance, the coupling facilities exchange Ready to Execute (RTE) signals , when they are ready to commence execution, and exchange Ready to Complete (RTC) signals , when they have acquired all necessary command serialization and are ready to complete. These architected duplexing operands, signals, and signal exchange protocols are described in further detail in a co-filed patent application entitled \u201cCoupling Of A Plurality Of Coupling Facilities Using Peer Links,\u201d Brooks et al. Ser. No. 09\/968,244, which is hereby incorporated herein by reference in its entirety.","When the duplexed commands complete at their respective coupling facility instances, they have updated the necessary structure objects in a coordinated manner so that the duplexed pair of structures remains in synch with one another. At that time, the two commands complete and return response information . The operating system observes the completion of each of the two coupling facility operations separately, and when both operations of the duplexed pair have completed, it merges and reconciles the results so as to arrive at a single, combined response  for the request, which is returned to exploiter .","Additional details associated with operating system software processing of a duplexed request, once the request has been determined to employ duplexed processing, are described with reference to -","Referring to , in order to perform a duplexed coupling facility operation, the operating system acquires I\/O resources (e.g., subchannels), which are used to perform the operations at each of the two coupling facilities that include the primary and secondary structure instances. At the time of the request, either both coupling facilities have subchannels available for use, in which case the duplexed request may be started immediately, or one or the other of the two coupling facilities (or both of them) does not have a subchannel available, in which case the duplexed request is not started immediately and is, instead, queued for later execution.","Should a subchannel not be available for the primary coupling facility, INQUIRY , then the operation is queued for later execution, waiting for the primary coupling facility to have an available subchannel, STEP . The processing to redrive this queued operation is described hereinafter. However, if a subchannel is available for the primary coupling facility, then an available subchannel is obtained from the primary coupling facility's free pool of subchannels for use in processing this duplexed operation, STEP . Then, with the primary subchannel in hand, a determination is made as to whether there is an available subchannel for the secondary coupling facility, INQUIRY .","If a subchannel is available for the secondary coupling facility, then an available subchannel is obtained from the secondary coupling facility's free pool of subchannels for use in processing this duplexed operation, STEP . At this point, the subchannel I\/O resources needed to perform the duplexed operation have been obtained.","Next, the exploiter's request is split into a plurality of (e.g., two) requests, a primary and a secondary request, which are driven to the primary structure and secondary structure in the duplexed pair, respectively, STEP . One embodiment of the logic associated with splitting a request is described hereinafter with reference to ","Subsequent to splitting the request, the primary and secondary coupling facility operations are initiated on their respective subchannels, targeting the primary and secondary structures, STEP  (FIG. B). Both operations are initiated in a CPU-asynchronous manner, but once both are initiated, the pair of operations may either be completed synchronously under the same unit of work that initiated them, or may be allowed to complete asynchronously and be completed under a different unit of work than the one that initiated them, INQUIRY . One embodiment for making the determination of synchronous or asynchronous completion is described in a co-filed application entitled \u201cDynamically Determining Whether To Process Requests Synchronously Or Asynchronously\u201d, Jordan et al., U.S. Ser. No. 09\/968,185, filed herewith, which is hereby incorporated herein by reference in its entirety.","If it is determined that synchronous completion is not required (or desired), then the current flow exits, STEP . This is because asynchronous completion for the duplexed pair of requests occurs under a separate flow of execution under separate units of work, one embodiment of which is described hereinafter with reference to ","However, if it is determined that synchronous completion is required (or desired), then processing spins waiting for both of the coupling facility operations to complete, STEP . In one example, this polling includes testing the primary subchannel to see if it is complete, then testing the secondary subchannel to see if it is complete, and so on, alternately, until it has been ascertained that both are complete.","Once both coupling facility operations are observed to have completed, the operating system merges and reconciles the results of the two coupling facility operations into a single response to the end user exploiter, STEP . One embodiment of the logic associated with merging\/reconciliation is described hereinafter with reference to ","At this point, processing is finished with the subchannel I\/O resources for both coupling facilities, and thus, these subchannels are returned to the free pool of subchannels associated with each coupling facility, from whence they were obtained, STEP  (). These returned subchannels may be usable in driving one or more queued operations that were previously unstartable due to the unavailability of subchannel resources for another request. Thus, if there are any such queued operations for either the primary or the secondary coupling facility, those operations are driven at this time using the subchannels that were just returned, STEP . One embodiment of the logic associated with this processing is described hereinafter with reference to ","Subsequently, a determination is made as to whether the merged\/reconciled results of the request (from STEP ) indicates that duplexing was, or needs to be, broken as a result of this request, INQUIRY . If so, then processing to break duplexing is initiated, STEP , and the results of the current request are not presented back to the exploiter at this time; rather, the request is \u201cheld\u201d on a special hold queue, until the process of breaking duplexing for the structure and reverting to simplex mode is complete, STEP . One embodiment of the processing associated with breaking duplexing, holding requests, and redriving or completing held requests once the structure is back in simplex mode is described hereinafter with reference to -","When breaking of duplexing is not needed, the merged result (provided at STEP  ()) is prepared for presentation to the exploiter using any appropriate notification mechanism, STEP .","Subsequently, if the request was processed synchronously under the exploiter's requesting unit of work, INQUIRY , then control is returned to the exploiter with the merged request results, STEP . However, if the request was processed asynchronously, then the requestor's back-end completion mechanism is driven, as appropriate, to notify the user of the merged request results, STEP . This completes processing of the duplex request flow. However, further details of selected steps are described below.","Return to INQUIRY  (), when asynchronous completion for the duplexed pair of requests is employed, asynchronous completion occurs under a separate flow of execution. One embodiment of the logic associated with asynchronous back-end completion processing for a duplexed coupling facility request is described with reference to . The two asynchronous coupling facility operations that were initiated to the coupling facilities having the primary and secondary structures are executing somewhat independently, so they will be observed to complete at different points in time based on many factors relating to the performance of the two coupling facility images and the I\/O connectivity to the two coupling facility images. (Of course, these coupling facility operations are not completely independent in their execution; they are participating in the duplexing command protocol and signal exchanges as described in FIG. ). In general, normal polling for completion of asynchronous coupling facility requests observes first the completion of one of the two operations, STEP , and then the completion of the other operation, STEP , and it is unpredictable which of the two operations will complete first, and which will complete second. Once both operations have been observed to complete, processing flows to (c) in , where the results of the two coupling facility operations are merged\/reconciled, as described herein.","Returning to INQUIRY  (), when the primary subchannel has been obtained for use in a duplexed operation, but the secondary subchannel is not available, then processing continues as described with reference to . Initially, a determination is made as to whether the primary coupling facility subchannel can be \u201ckept,\u201d while waiting for a subchannel for the secondary coupling facility to become available for use in starting the duplexed pair of operations, INQUIRY . Care is to be taken in making this determination, or deadlocks can result.","For example, suppose that a configuration contains two duplexed structures, Structure A and Structure B, and that the primary instance of Structure A and the secondary instance of Structure B reside in CF , and that the secondary instance of Structure A and the primary instance of Structure B reside in CF , and that each coupling facility has two subchannels associated with it. Suppose that two coupling facility requests for Structure A and two coupling facility requests for Structure B are received from their respective exploiters, and are processed concurrently by the operating system. Each of the two operations for Structure A might obtain a primary subchannel (using up all of the available subchannels for CF ), and each of the two operations for Structure B might obtain a primary subchannel (using up all of the available subchannels for Coupling Facility ), and then each of the operations would attempt to obtain its secondary subchannels and be unable to do so. If they all decided to \u201ckeep\u201d their primary subchannels, while waiting for a secondary subchannel to become available, then this would deadlock indefinitely as the operations for Structures A and B are each \u201ckeeping\u201d their own primary subchannels, which the other needs to acquire for use as their secondary subchannels.","To prevent this deadlock, in one example, the determination at INQUIRY  only keeps a primary subchannel associated with a particular coupling facility, if it is the only such kept primary subchannel associated with that coupling facility. If there is already a primary subchannel that is being kept associated with a duplexed request for that coupling facility, then additional subchannels are not permitted to be kept. In this case, the primary subchannel, which was previously obtained, is returned to the free pool of subchannels associated with the primary coupling facility, STEP , where it can be used to drive the next queued operation for the coupling facility to which it was returned, STEP , as is described in further detail with reference to . The request now has obtained neither the primary nor secondary subchannel, which it wishes to employ, so the request is queued waiting for a primary subchannel to become available, STEP .","On the other hand, if this is the only such kept primary subchannel associated with that coupling facility, then the primary subchannel which was previously obtained is kept for this duplexed request, and the request is queued waiting for the currently-unavailable secondary subchannel to become available, STEP .","Other techniques for avoiding a deadlock are also possible here. For example, one way of avoiding a deadlock is to simply always return the primary subchannel, whenever the secondary subchannel cannot be immediately obtained to process the duplexed request, and then try again at a later time to obtain both subchannels, again. However, this suffers from a fairness problem; the request may be tried over and over again with no guarantee that \u201cprogress\u201d will ever be made in coming any closer to acquiring all of the resources needed or desired to perform the duplexed operation. In contrast, the technique described with reference to has the advantage that subchannels can be \u201ckept\u201d for use in a duplexed operation, which has the effect of making \u201cprogress\u201d on eventually getting those duplexed requests processed; when a request has kept a primary subchannel, it can be started when only one additional subchannel becomes available (the secondary), rather than having to wait for both the primary and secondary to become available to it at the same time.","In one embodiment, the mechanism for keeping a primary subchannel is intimately related to the mechanism for driving the next queued operation, whenever a subchannel is returned to the free pool, and thus, becomes available for use for a particular coupling facility. One embodiment of this processing is described with reference to ","Referring to , when a subchannel is returned to the free pool for a coupling facility, a determination is made as to whether there are any queued duplexed operations for which the returned subchannel can serve as the last needed subchannel for the duplexed operation to be started, STEP . That would be the case, for example, if this returned subchannel was usable as the secondary subchannel for a duplexed operation, which had previously obtained a primary subchannel (STEP , ), been unable to obtain a secondary subchannel (INQUIRY , ), been able to keep its primary subchannel (INQUIRY , ), and been queued waiting for a secondary subchannel (STEP , ). When this occurs, the subchannel is obtained for use as the secondary subchannel for the duplexed request, STEP , and processing continues at (f) on ","Otherwise, a further determination is made as to whether the returned subchannel can be used as the subchannel with which a queued simplex request can be driven, INQUIRY . If so, the subchannel is obtained for use in processing that simplex request, STEP , which flows into known simplex request processing.","On the other hand, a further determination is made as to whether the returned subchannel can be used as a subchannel for a queued duplexed operation, INQUIRY . Because of previous checks that have been made (e.g., at INQUIRY ), this would be, for instance, for a queued duplexed operation that has not obtained and kept a primary subchannel, and thus, is waiting for a primary subchannel. If the returned subchannel can be used for a queued duplex request, then the returned subchannel is obtained for use by the duplexed request, STEP , and processing continues at (g) on ","Otherwise, the returned subchannel cannot currently be used to start any queued coupling facility requests, and simply remains in the free pool for the coupling facility, until it is needed.","Duplexed Request Splitting","One embodiment of the logic associated with splitting a request (STEP , ) received from the exploiter into a plurality (e.g., two) of requests (one for the primary structure, and one for the secondary structure), when duplexed command execution is employed, is described with reference to ","With duplexing, there are two interrelated operations being constructed and driven to two coupling facilities and coupling facility structures (primary and secondary) as a result of a single exploiter request, with two interrelated responses being received. Certain duplexing-related operands in the primary and\/or the secondary Message Command Block (MCB) are set to ensure the appropriate duplexed execution of the request.","As input to the request splitting process, the exploiter's request has already been translated into the appropriate MCB and Message Buffer Address List (MBAL), as if it were going to be performed as a simplex request. The processing for duplex request splitting duplicates this input MCB and MBAL into two separate message command blocks and message buffer address lists, one for each of the two commands (primary and secondary), STEP . At this point, they are identical in terms of all MCB operands and MBAL operands\/contents.","Next, command-specific duplexed request operands are modified in the primary and\/or the secondary command's MCB, depending on what specific command the user has requested, what specific request operands have been requested, environmental factors related to the processing of the request, and the like, STEP . Additional details of these command-specific modifications follow. Further, additional details relating to the definition and meaning of the operands that are used by this processing are described in a co-filed application entitled \u201cCoupling Of A Plurality Of Coupling Facilities Using Peer Links,\u201d Brooks et al. Ser. No. 09\/968,244, which is hereby incorporated herein by reference in its entirety.","Command Specific Modifications",{"@attributes":{"id":"p-0144","num":"0000"},"ul":{"@attributes":{"id":"ul0020","list-style":"none"},"li":{"@attributes":{"id":"ul0020-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0021","list-style":"none"},"li":["Read and Register\n        \n        ","Read for Castout\n        \n        ","Read Directory, Read Castout Class, Read Castout Class Information, Read List Controls, Read Lock Table Entry, Read Next Lock Table Entry, Read List, Read List Set, Read Event Monitor Controls, Read Event Queue Controls\n        \n        ","Write When Registered\n        \n        ","Write And Register\n        \n        ","Unlock Castout Locks\n        \n        ","Register Name List\n        \n        ","Unlock Castout Lock Entry\n        \n        ","Invalidate Name List\n        \n        ","Write List Controls, Register List Monitor, Deregister List Monitor, Move List Entry, Delete List Entry, Delete List Entries, Register Event Monitors, Move List Entries\n        \n        ","Write Lock Table Entry\n        \n        ","Read List Entry\n        \n        ","Write List Entry, Write and Move List Entry, Record Global Lock Manager\n        \n        ","Move and Read List Entry, Read and Delete List Entry\n        \n        ","Delete List Set\n        \n        ","Delete List\n        \n        ","Invalidate Name\n        \n        "]}}}},"In this embodiment, duplexed commands not explicitly mentioned in the above list do not have any command-specific operand modifications performed at STEP .","Continuing, generic duplexed request operands are set in the primary and secondary MCB, STEP . These operations are generic in that they are performed for all (in this example) duplex mode commands, regardless of the type of command that is being performed. These generic modifications include, for instance:\n\n","Note that, in this embodiment, there have been no modifications made to the replicated MBAL information. This implies that on a duplexed request that transfers data to the coupling facility, the same data, from the same data buffers, is transferred for both the primary and secondary requests. This also implies that on a duplexed request that receives data from the coupling facility, the same data buffer validation processing can occur for both the primary and secondary requests, although in general the actual \u201cread\u201d data transfer occurs from only the primary coupling facility, and is suppressed from the secondary coupling facility.","Duplexed Request Merging\/Reconciliation","One embodiment of the processing associated with merging and reconciling the results of a duplexed pair of coupling facility operations (STEP , ), once both are observed to have completed at the coupling facility, is described with reference to ","When a duplexed pair of requests is processed by the coupling facility, the coupling facility undertakes a series of architected signal exchanges to coordinate and synchronize the execution of the commands. The protocols associated with the signal exchanges are depicted in FIG.  and described in further detail in a co-filed patent application entitled \u201cCoupling Of A Plurality Of Coupling Facilities Using Peer Links,\u201d Brooks et al., Ser. No. 09\/968,244, which is hereby incorporated herein by reference in its entirety.","In one embodiment, these protocols expect coupling facility-to-coupling facility communication to be operating correctly in order to perform the duplexing protocols. If the coupling facility determines that the communication does not exist at the time that a duplexed command is to be processed, or if the coupling facility detects a failure of the coupling facility-to-coupling facility communication at a point that is critical to the processing of the duplexed requests, it indicates (either via the DDI response operand or via a response code) that duplexing is broken.","The coupling facility may also indicate via a response code that a duplexed operation experienced a signaling protocol \u201cdeadlock\u201d which was detected by the coupling facility and handled via \u201crequest for suppression\u201d processing. This deadlock detection and handling is described in more detail in a co-filed patent application entitled \u201cCOUPLING OF A PLURALITY OF COUPLING FACILITIES USING PEER LINKS,\u201d Brooks et al. Ser. No. 09\/968,244, which is hereby incorporated herein by reference in its entirety. When such deadlocks are detected and handled by the coupling facility, the duplexed requests will fail with an indicative response code, which is handled by the operating system redriving the requests, transparently to the exploiter.","Yet another possible outcome of the duplexed operation is that the pair of requests both complete \u201cnormally,\u201d but with a set of response codes or other response operand information that is inconsistent in some way. Should this occur, it indicates that the duplexed structure instances, though still duplexed, have fallen \u201cout of synch\u201d with one another and are no longer maintaining redundant copies of the same duplexed data. While this should not happen if duplexing protocols are operating correctly, the operating system detects such inconsistencies, if in fact they occur, and deals with them appropriately.","Referring to , initially, a determination is made as to whether the coupling facility has indicated that the commands were suppressed as a result of a detected signaling protocol \u201cdeadlock,\u201d as indicated by response codes from the coupling facility, INQUIRY . If so, the commands are set up to be redriven again, as a duplexed pair, STEP , and processing flows back to (h) in . In particular, note that the requests have already been \u201csplit,\u201d so there is no need to repeat this processing, and also that the duplex request operands, such as the CSN have already been set for this duplex pair of requests and are not modified when the commands are redriven. This helps ensure that, when this pair of requests is redriven to the coupling facilities, should another deadlock occur at the coupling facilities involving this request, the coupling facility will be more likely to resolve the deadlock in favor of this \u201colder\u201d command. This promotes \u201cfairness\u201d in ensuring that this duplex pair of requests can make progress towards actually executing in the coupling facilities.","If the commands were not suppressed, INQUIRY , then a further determination is made as to whether the coupling facility indicated that duplexing was broken at the coupling facility, either via the DDI response operand or via an indicative response code, INQUIRY . If so, set up to initiate software processing for breaking duplexing (as duplexing has already been broken at the coupling facility), STEP , and this flow is exited. Upon return to the flow described in and , if breaking duplexing is required, this occurs at STEP , and the current request is held at STEP . Part of the setup processing at STEP  () may include taking a dump to capture diagnostic information regarding the reason why duplexing is being broken, issuing messages to the operator console indicating that duplexing is broken, and the like.","Returning to INQUIRY , otherwise, the requests appear to have completed successfully without breaking duplexing, yet there still may be anomalies present in the primary and secondary operation results that indicate a logical inconsistency between the primary and secondary structure. As a simple example, consider a Write List Entry command that is attempting to update an existing list entry in the structure. The primary and secondary commands should both indicate either that the requested entry was found for processing (and was either updated or not, depending on other processing for the command), or both indicate that the requested entry was not found for processing. If one command indicates that the entry was found while, the other command indicates that the entry was not found, then the duplex pair of structures is out of sync with one another, as the result of some previous breakdown of the duplexing protocols for this structure.","Since the set of command response codes differs from command to command, and since there are cases where different response codes from the primary and secondary structures are allowable and do not indicate that the structures are out of synch with one another, in order to determine whether or not the command results are consistent, a command-specific \u201creconciliation table\u201d is consulted to determine whether the observed response code results are consistent or inconsistent, STEP . Details of this command-specific processing are described below. After this, a determination is made as to whether a structure inconsistency has been detected, INQUIRY .","If the structures are consistent, then this flow is exited and returned to the processing described in and to complete the processing of the duplexed request in a normal fashion, without breaking duplexing, STEP  (). However, if the structures are inconsistent, INQUIRY  (), then structure failure processing is driven for both of the structure instances, the primary and secondary, STEP , a set up to initiate breaking of duplexing is performed, STEP , and this flow exits. On return to and , software break duplexing processing is initiated for the structure, STEP  (), but with the further caveat that both structure instances have been marked as failed.","In this case, when we have detected that the structures are inconsistent with one another, note that the inconsistency was not caused by the current duplexed operation, it was simply detected by the current duplexed operation. It is not known when the inconsistency was introduced as a result of some prior operation being improperly processed, nor is it known how many other as-yet-undetected inconsistencies may be lurking in the structure, nor is it known with certainty which structure contains the \u201ccorrect\u201d data for the entry (and in fact, if there are multiple inconsistencies, the primary structure may contain the \u201ccorrect\u201d data for some entries and the secondary structure may contain the \u201ccorrect\u201d data for other entries). In this example, there is no way to know how to recover from such an error, once it is detected; and note, the introduction of such inconsistencies is not supposed to be possible within the scope of the duplexing architecture and protocols. Therefore, this type of error is handled by:\n\n","It may or may not be possible for the exploiter to recover from this failure, using existing mechanisms, such as user-managed structure rebuild processing, recovery of the data from logs, etc.","Referring back to STEP  () the following are examples of command-specific reconciliation tables used in the processing at STEP . The tables list possible combinations of response code from the primary (P), in rows, and secondary (S), in columns, which are considered valid, and thus, do not indicate any inconsistency. At each row\/column position in the matrix, either there is a value (which if present, indicates that the combination of response codes is valid, and indicates what the resulting response code returned to the exploiter should be), or there is no value, which indicates an inconsistent combination of response codes. Note that the \u201cR\u201d row\/column indicates any of several possible responses that indicate that recovery\/restart processing is to be performed for the operation for some reason unrelated to duplexing, such as an Interface Control Check error (IFCC). In some cases, additional command-specific response operand verification can also be performed to ensure that the requests have not only completed with a valid pair of response codes, but also with consistent operand information returned; such cases are designated and described by \u201c*\u201d in these tables.","Examples of the reconciliation tables for each duplexed command type appear below, followed by a representative code implementation of those tables (implemented via a macro invocation which lists each valid \u201ctriplet\u201d comprised of primary response code, secondary response code, and resultant response code to be given to the exploiter).",{"@attributes":{"id":"p-0162","num":"0281"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"INL - Invalidate Name List"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00001","num":"00001"},"img":{"@attributes":{"id":"EMI-C00001","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00001.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"*-Verify \u2018Current List Index\u2019 is the same for both operations "},{"entry":"#-Check whether request has been suppressed "},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0043","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 1, 4 and 5.","2) Command suppression response codes ==> 18, 19, 20, 253 & 254","3) For response code pairs (1,1), (4,1) and (5,1) verify that the returned current list item (CLI) is the same for both commands (Note the current list item is only returned for response codes 1, 4 and 5). If the indexes don't match, break duplexing, request a dump and place the request on the hold queue.","4) Response codes 4 and 5 should not be returned for commands driven to the secondary structure because the HIC value is zero on these commands. When this response code is returned, the secondary MCB is in error."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0164","num":"0300"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"RAR - Read And Register"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00002","num":"00002"},"img":{"@attributes":{"id":"EMI-C00002","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00002.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0047","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 3","2) Command suppression response codes ==> 18, 19, 20, 253 & 254","3) Response code 0 should not be returned on the secondary command because the secondary command suppresses the read operation. Response code 1 indicates successful command completion when read suppression is requested. When response code 0 is returned for a secondary command, the MCB is in error.","4) Response code pairs (0,2) and (1,2) can occur and are to be tolerated because the secondary structure does not contain unchanged entries. For these cases, the primary response code is returned.","5) Response code pair (11,3) can occur when the primary command recognizes the insufficient message buffer space (RC 11) condition and the secondary command recognizes the target storage class full (RC 3) condition. This is possible because the insufficient message-buffer response code is not prioritized relative to the target storage class full response code. In this case the insufficient message-buffer response code is returned.","6) Response code 6 should not be returned (from either structure) for duplex commands, because the duplex commands do not request halting when the command results in a storage class change (STCCC=0 is always specified on duplex commands). When this response code is returned, the MCB is in error."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0166","num":"0328"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"RFCO - Read For CastOut"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00003","num":"00003"},"img":{"@attributes":{"id":"EMI-C00003","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00003.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0051","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 18, 19, 20, 253 & 254","3) Response code pair (2,3) can occur if the requester specifies an entry that is not changed. Since the entry is not changed, it is allowable for the entry to be absent from the secondary structure. As a result, this response code pair is to be tolerated. The Data not Changed response code (RC 2) will be returned, since this is the condition which allowed the entry to be absent from the secondary structure.","4) Response code 2 should not be returned on the secondary command because the secondary structure only contains changed data.","5) If a restart is indicated from the primary structure, a restart will be indicated regardless of what was returned from the secondary structure: Data is only returned from the primary structure, and there are no retry buffers to retrieve the data from the secondary structure after the fact."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0168","num":"0351"},"tables":{"@attributes":{"id":"TABLE-US-00004","num":"00004"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"RNL - Register Name List"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00004","num":"00004"},"img":{"@attributes":{"id":"EMI-C00004","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00004.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"*-Verify \u2018Registration Index\u2019 is the same for both operations "},{"entry":"#-Check whether request has been suppressed "},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0055","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 1,3","2) Command suppression response codes ==> 18, 19, 20, 253 & 254","3) For response code pairs (0,0), (1,1), (1,3), (3,1), (3,3), (4,4), (5,5) and (16,16) verify the same registration index (RGX) is returned on both commands (Note the RGX is not returned for response codes 18, 19, 20, 254 and 255). If the indexes don't match, break duplexing, request a dump and place the request on the hold queue.","4) Response codes 5 and 16 should not be returned for duplexed commands.","5) Response code 6 should not be returned for duplexed commands. This response code can only be returned when STCCC=\u20181\u2019b which is only specified on simplex commands."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0170","num":"0380"},"tables":{"@attributes":{"id":"TABLE-US-00005","num":"00005"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"UCLE - Unlock Castout Lock Entry"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00005","num":"00005"},"img":{"@attributes":{"id":"EMI-C00005","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00005.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0059","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 2, 3, 5, 18, 19, 20, 253 and 254","3) Response code pair (2,3) can occur if the requester specifies an entry that is not locked for castout. Since the entry is not locked for castout it is allowable for the entry to be absent from the secondary structure. As a result, this response code pair is to be tolerated. The Compare Mismatch on CO lock response code (RC 2) will be returned since this is the condition which allowed the entry to be absent from the secondary structure."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0172","num":"0400"},"tables":{"@attributes":{"id":"TABLE-US-00006","num":"00006"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"UCL - Unlock Castout Locks"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00006","num":"00006"},"img":{"@attributes":{"id":"EMI-C00006","he":"54.78mm","wi":"74.00mm","file":"US06944787-20050913-C00006.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"*-Verify \u2018Current List Index\u2019 is the same for both operations "},{"entry":"#-Check whether request has been suppressed "},{"entry":"@-Verify UCL is not part of a converted command (triple); restart if it is. "},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0063","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 1","2) Command suppression response codes ==> 18, 19, 20, 253 and 254","3) For response code pairs (1,1), (2,2), (2,3), (3,3), (4,4) and (5,5) verify that the returned current list item (CLI) is the same for both commands. If the indexes don't match, break duplexing, request a dump and place the request on the hold queue.","4) Response code pair (2,3) can occur if the requester specifies an entry that is not Locked for castout. Since the entry is not locked for castout it is allowable for the entry to be absent from the secondary structure. As a result, this response code pair is to be tolerated. The Compare Mismatch on CO lock response code (RC 2) will be returned since this is the condition which allowed the entry to be absent from the secondary structure.","5) Response codes 6 and 7 can only be returned when Detachment Emulation (DTEMC=1) is requested.","6) Response code 6 may be returned in conjunction with the duplexing inactive (RC=20) response code.","7) A Restart on the primary and a RC=1 on the secondary, may be restarted because the restart token from the primary is to be returned if the UCL is part of a converted command (triple)."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0174","num":"0434"},"tables":{"@attributes":{"id":"TABLE-US-00007","num":"00007"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"WAR - Write And Register"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00007","num":"00007"},"img":{"@attributes":{"id":"EMI-C00007","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00007.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0067","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 4, 5 and 6","3) Command suppression response codes ==> 18, 19, 20, 253 & 254","4) Response code pair (5,4) can occur when the specified name exists unchanged in the primary structure, the version-number comparison fails in the primary structure, the name does not exist in the secondary and the secondary operation fails with a target-storage-class full condition. The Version number mismatch (RC 5) response code will be returned.","5) Response code (4,5) is not expected because it can only occur if the version numbers are out of synch between the primary and secondary structures.","6) Response code 6 should not be returned for commands driven to the secondary structure because assignment is not suppressed (ASC=\u20180\u2019B) on these commands. If this response code is returned on a secondary command, the MCB is in error."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0176","num":"0462"},"tables":{"@attributes":{"id":"TABLE-US-00008","num":"00008"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"WWR - Write When Registered"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00008","num":"00008"},"img":{"@attributes":{"id":"EMI-C00008","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00008.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0071","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 1, 4 and 5","2) Command suppression response codes ==> 18, 19, 20, 253 & 254","3) Response code 1 should not be returned on a command driven to the secondary. Secondary commands suppress the registration testing (SREGT=1) Leading to this response code.","4) Response code pairs (1,4) and (1,5) can occur because the registration test is suppressed in the command driven to the secondary structure.","5) Response code pair (5,4) can occur when the specified name exists unchanged in the primary structure, the version-number comparison fails in the primary structure, the name does not exist in the secondary and the secondary operation fails with a target-storage-class full condition. The Version number mismatch (RC 5) response code will be returned.","6) Response code (4,5) is not expected because it can only occur if the version numbers are out of synch between the primary and secondary structures."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0178","num":"0491"},"tables":{"@attributes":{"id":"TABLE-US-00009","num":"00009"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"CLGLM - Clear Global Lock Manager"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00009","num":"00009"},"img":{"@attributes":{"id":"EMI-C00009","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00009.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0075","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 1, 3, 8, 18, 19, 20, 253 and 254"]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0180","num":"0509"},"tables":{"@attributes":{"id":"TABLE-US-00010","num":"00010"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"DLES - Delete List Entries"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00010","num":"00010"},"img":{"@attributes":{"id":"EMI-C00010","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00010.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart as a result of a suppression condition otherwise Restart is Not applicable . . . \u2018DLES\u2019 has a retry buffer. "},{"entry":"*-1) For RC(1,1), RC(4,4), RC(7,7), RC(8,8), and RC(12,12) the CDX returned is the same for both structures. "},{"entry":"#-Check whether request has been suppressed "},{"entry":"@-Valid if DLES was done as part of a converted command (triple). "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0079","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 1","2) Command suppression response codes ==> 9, 18, 19, 20, 253 and 254","3) For response code pairs (1,1), (4,4), (7,7), (8,8) and (12,12) verify that the returned current data index (CDX) is the same for both commands. If the indexes don't match, break duplexing, request a dump and place the request on the hold queue.","4) Response code pairs (1,9) and (9,1) cannot occur because response code 1 can only be returned if one or more entries have been committed and response code 9 is a suppression condition.","5) When the DLES command is issued as part of a converted DL command (ICRTOC=1), special rules apply. This is because the forward scan to locate the list entry controls (of the next entry to process) is not serialized by the two CFs.\n    \n    "]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0182","num":"0534"},"tables":{"@attributes":{"id":"TABLE-US-00011","num":"00011"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"DLE - Delete List Entry"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00011","num":"00011"},"img":{"@attributes":{"id":"EMI-C00011","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00011.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart as a result of a suppression condition otherwise Restart is Not applicable . . . \u2018DLE\u2019 has a retry buffer. "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0084","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 1, 3, 4, 7, 8, 12, 18, 19, 20, 253 and 254"]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0184","num":"0560"},"tables":{"@attributes":{"id":"TABLE-US-00012","num":"00012"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"DLM - Deregister List Monitor"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00012","num":"00012"},"img":{"@attributes":{"id":"EMI-C00012","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00012.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0088","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 18, 19, 20, 253 & 254"]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0186","num":"0569"},"tables":{"@attributes":{"id":"TABLE-US-00013","num":"00013"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"MRLE - Move and Read List Entry"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00013","num":"00013"},"img":{"@attributes":{"id":"EMI-C00013","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00013.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart as a result of a suppression condition otherwise Restart is Not applicable . . . \u2018MRLE\u2019 has a retry buffer. "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0092","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 5","2) Command suppression response codes ==> 1, 3, 4, 5, 7, 8, 10, 11, 12, 18, 19, 20, 253 and 254","3) Response code pair (11,5) can occur because the secondary command suppresses the data transfer on the read operation. As a result, the secondary command can encounter the list full condition (RC 5) while the primary command encounters the insufficient message buffer space (RC 11) condition. In this case, the insufficient message buffer space response code will be returned. The list full response code may be returned when command is redriven and the condition still exists."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0188","num":"0623"},"tables":{"@attributes":{"id":"TABLE-US-00014","num":"00014"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"MLES - Move List Entries"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00014","num":"00014"},"img":{"@attributes":{"id":"EMI-C00014","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00014.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart as a result of a suppression condition otherwise Restart is Not applicable . . . \u2018MLES\u2019 has a retry buffer. "},{"entry":"*-Verify CDX is the same for both structures "},{"entry":"#-Check whether request has been suppressed "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0096","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 1, 15","2) Command suppression response codes ==> 9, 18, 19, 20, 253 and 254","3) For response code pairs (1,1), (1,15), (3,3), (4,4), (7,7), (8,8), (10,10), (12,12), (15,1) and (15,15) verify that the returned current data index (CDX) is the same for both commands. If the indexes don't match, break duplexing, request a dump and place the request on the hold queue.","4) For response code pairs (1,15) and (15,1) the list full response code (RC 15) is returned so the user knows the list full condition needs to be corrected before the command can be redriven.","5) Response code pairs (1,9) and (9,1) cannot occur because response code 1 can only be returned if one or more entries have been committed and response code 9 is a suppression condition."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0190","num":"0650"},"tables":{"@attributes":{"id":"TABLE-US-00015","num":"00015"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"MLE - Move List Entry"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00015","num":"00015"},"img":{"@attributes":{"id":"EMI-C00015","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00015.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart as a result of a suppression condition otherwise Restart is Not applicable . . . \u2018MLE\u2019 has a retry buffer. "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0100","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 5","2) Command suppression response codes ==> 1, 3, 4, 5, 7, 8, 10, 12, 18, 19, 20, 253 and 254"]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0192","num":"0698"},"tables":{"@attributes":{"id":"TABLE-US-00016","num":"00016"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"RDLE - Read and Delete List Entry"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00016","num":"00016"},"img":{"@attributes":{"id":"EMI-C00016","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00016.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart as a result of a suppression condition otherwise Restart is Not applicable . . . \u2018RDLE\u2019 has a retry buffer. "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0106","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 1, 3, 4, 7, 8, 11, 12, 18, 19, 20, 253 and 254"]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0194","num":"0727"},"tables":{"@attributes":{"id":"TABLE-US-00017","num":"00017"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"RLE - Read List Entry"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00017","num":"00017"},"img":{"@attributes":{"id":"EMI-C00017","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00017.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart as a result of a suppression condition otherwise Restart is Not applicable . . . \u2018RLE\u2019 has a retry buffer. "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0110","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 1, 3, 4, 7, 8, 11, 12, 18, 19, 20, 253 and 254","3) Response code 11 should not be returned on a secondary command because the secondary command suppresses the data transfer on the read operation."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0196","num":"0757"},"tables":{"@attributes":{"id":"TABLE-US-00018","num":"00018"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"RGLM - Record Global Lock Manager"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00018","num":"00018"},"img":{"@attributes":{"id":"EMI-C00018","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00018.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart as a result of a suppression condition otherwise Restart is Not applicable . . . \u2018RGLM\u2019 has a retry buffer. "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0114","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 6","2) Command suppression response codes ==> 1, 3, 6, 13, 18, 19, 20, 253 and 254"]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0198","num":"0785"},"tables":{"@attributes":{"id":"TABLE-US-00019","num":"00019"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"REMS - Register Event Monitors"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00019","num":"00019"},"img":{"@attributes":{"id":"EMI-C00019","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00019.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"*-Verify CTX is the same for both structures "},{"entry":"#-Check whether request has been suppressed "},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0118","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 1, 2","2) Command suppression response codes ==> 18, 19, 20, 253 and 254","3) For response code pairs (1,1), (1,2), (2,1), (2,2), (4,4), (5,5), and (16,16) verify that the returned current event index (CTX) is the same for both commands. If the indexes don't match, break duplexing, request a dump and place the request on the hold queue.","4) Response code 16 should not be returned for duplexed commands."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0200","num":"0816"},"tables":{"@attributes":{"id":"TABLE-US-00020","num":"00020"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"RLM - Register List Monitor"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00020","num":"00020"},"img":{"@attributes":{"id":"EMI-C00020","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00020.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0122","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 2","2) Command suppression response codes ==> 1, 2, 18, 19, 20, 253 and 254","3) Response code pairs (0,3) and (3,0) can occur and are to be tolerated because key range initialization can proceed at different rates in the two structures. The key-range not initialized response code will be the resultant response code until the key range is initialized in both structures."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0202","num":"0839"},"tables":{"@attributes":{"id":"TABLE-US-00021","num":"00021"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"RGLMV - Reset Global Lock Manager Value"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00021","num":"00021"},"img":{"@attributes":{"id":"EMI-C00021","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00021.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0126","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 3, 18, 19, 20, 253 and 254"]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0204","num":"0851"},"tables":{"@attributes":{"id":"TABLE-US-00022","num":"00022"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"RLLMV - Reset Local Lock Manager Value"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00022","num":"00022"},"img":{"@attributes":{"id":"EMI-C00022","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00022.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0130","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 3, 18, 19, 20, 253 and 254"]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0206","num":"0863"},"tables":{"@attributes":{"id":"TABLE-US-00023","num":"00023"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"RLMS - Reset Lock Managers"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00023","num":"00023"},"img":{"@attributes":{"id":"EMI-C00023","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00023.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"*-Verify Lock Manager index is the same from each structures "},{"entry":"#-Check whether request has been suppressed "},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0134","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 1","2) Command suppression response codes ==> 2, 18, 19, 20, 253 and 254","3) For response code pairs (0,0), (1,1), (2,2), (3,3), (4,4), (5,5) and (8,8) verify that the returned lock-manager index (LMX) is the same for both commands. If the indexes don't match, break duplexing, request a dump and place the request on the hold queue.","4) Response code pairs (1,2) and (2,1) cannot occur because response code 1 can only be returned if one or more entries have been committed and response code 2 is a suppression condition."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0208","num":"0892"},"tables":{"@attributes":{"id":"TABLE-US-00024","num":"00024"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"SGLMV - Set Global Lock Manager Value"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00024","num":"00024"},"img":{"@attributes":{"id":"EMI-C00024","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00024.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"*-Verify Lock Manager index is the same from each structures "},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0138","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 3, 18, 19, 20, 253 and 254"]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0210","num":"0907"},"tables":{"@attributes":{"id":"TABLE-US-00025","num":"00025"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"SLLMV - Set Local Lock Manager Value"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00025","num":"00025"},"img":{"@attributes":{"id":"EMI-C00025","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00025.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0142","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 3, 18, 19, 20, 253 and 254"]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0212","num":"0922"},"tables":{"@attributes":{"id":"TABLE-US-00026","num":"00026"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"WMLE - Write and Move List Entry"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00026","num":"00026"},"img":{"@attributes":{"id":"EMI-C00026","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00026.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"*-Force restart (retry) if RC 6 is returned with the FRPI bit on. "},{"entry":"R-Restart as a result of a suppression condition otherwise Restart (as a returned action) is not applicable . . . \u2018WMLE\u2019 has a retry buffer. "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0146","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 5, 6","2) Command suppression response codes ==> 1, 3, 4, 5, 6, 7, 8, 9, 10, 12, 13, 18, 19, 20, 253 and 254","3) Response code pairs (5,6) and (6,5) are to be reconciled because \u2018list full\u2019 (RC=5) and \u2018list set full\u2019 (RC=6) response codes have the same priority. These response code pairs will be reconciled to the List-set full response code."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0214","num":"1007"},"tables":{"@attributes":{"id":"TABLE-US-00027","num":"00027"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"WLC - Write List Controls"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00027","num":"00027"},"img":{"@attributes":{"id":"EMI-C00027","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00027.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart as a result of a suppression condition otherwise Restart is Not applicable . . . \u2018WLC\u2019 has a retry buffer. "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0150","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 1, 2, 17 18, 19, 20, 253 and 254","3) Response code pairs (0,2) and (2,0) can occur and are to be tolerated because key range initialization can proceed at different rates in the two structures. The key-range not initialized response code will be the resultant response code until the key range is initialized in both structures."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0216","num":"1026"},"tables":{"@attributes":{"id":"TABLE-US-00028","num":"00028"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"WLE - Write List Entry"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00028","num":"00028"},"img":{"@attributes":{"id":"EMI-C00028","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00028.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"*-Force restart (retry) if RC 6 is returned with the FRPI bit on. "},{"entry":"R-Restart as a result of a suppression condition otherwise Restart (as a returned action) is not applicable . . . \u2018WLE\u2019 has a retry buffer. "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0154","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> 5, 6","2) Command suppression response codes ==> 1, 3, 4, 5, 6, 7, 8, 9, 10, 12, 13, 18, 19, 20, 253 and 254","3) Response code pairs (5,6) and (6,5) are to be reconciled because \u2018list full\u2019 (RC=5) and \u2018list set full\u2019 (RC=6) response codes have the same priority. These response code pairs will be reconciled to the \u2018list set full\u2019 response code."]}},"One example of a macro used to create the above table is as follows:\n\n",{"@attributes":{"id":"p-0218","num":"1111"},"tables":{"@attributes":{"id":"TABLE-US-00029","num":"00029"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"WLTE - Write Lock Table Entry"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"chemistry":{"@attributes":{"id":"CHEM-US-00029","num":"00029"},"img":{"@attributes":{"id":"EMI-C00029","he":"54.78mm","wi":"72.47mm","file":"US06944787-20050913-C00029.TIF","alt":"embedded image","img-content":"table","img-format":"tif"}}}}},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"R-Restart "}]}}}},"br":{},"ul":{"@attributes":{"id":"ul0158","list-style":"none"},"li":["1) Response codes which generate a halt signal ==> None","2) Command suppression response codes ==> 3, 6, 18, 19, 20, 253 and 254"]}},"One example of a macro used to create the above table is as follows:\n\n","In one aspect of the present invention, there are various processing phases associated with establishing system-managed duplexing. One embodiment of these phases is described with reference to FIG. . Since some of the processing associated with these phases is similar to that for system-managed rebuild, which is known and described in one or more of the previously incorporated applications\/patents, it is not covered in great detail here. The system-managed processing is assumed to occur except as otherwise noted. Where significant differences relating to system-managed duplexing occur, those differences and extensions are Sully described.","When the system-managed duplexing rebuild process is started, it enters a Startup phase (). The exploiters are notified of this via an event exit event, such as Structure Temporarily Unavailable, which each active exploiter confirms. The exploiter instances may or may not take any action in response to this event. As one example of taking an action, an exploiter may choose to suppress or quiesce further structure activity at its level, rather than relying on the operating system for this.","When the active exploiter instances have confirmed this event, the process transitions into a Quiesce phase (). In this system-managed phase, the operating system quiesces structure activity, waiting for the completion of any in-progress requests, and sending future requests (if any) received from the structure exploiter to a delay queue.","When the systems have quiesced activity against the structure, the process transitions into an Allocate phase (). In this system-managed phase, the operating system allocates a new structure instance which, when populated with data, is used as the secondary structure of the duplex pair. The structure allocation process is a system-managed process, which proceeds independently with respect to active connectors to the structure (and in fact, may operate without any active connectors to the structure).","The structure allocation process runs on a single system whose \u201cownership\u201d of the structure allocation process is maintained by the operating system so that, in the event of a system failure, the ownership can be transferred or assumed by another system. The structure allocation process can also transfer ownership voluntarily to run on another system, if necessary or desired. However, when transferring ownership for duplexing, an additional factor is to be taken into account: coupling facility-to-coupling facility connectivity.","In particular, a given system might be unable to allocate the secondary structure because it does not have connectivity to any suitable coupling facility in the preference list (an ordered list of preferred coupling facilities), which has peer connectivity to the coupling facility in which the primary structure is allocated. Therefore, in order to maximize the chances of a successful structure allocation, ownership of the structure allocation process is to be transferred to a system, which not only has connectivity to some of the coupling facilities in the preference list, but has connectivity to the subset of the coupling facilities in the preference list which have peer connectivity to the coupling facility in which the primary structure is allocated.","Additionally, for system-managed duplexing, any in-progress alter process that is going on for the structure is explicitly stopped, prior to secondary structure allocation. The structure allocation process allocates, in one example, the secondary structure with the exact same object counts as the primary structure, and so those counts are not to be a moving target, as the structure allocation process proceeds. (In another embodiment, the secondary structure may have a differing number of object counts.)","For system-managed duplexing, secondary structure allocation assumes a rebuild attribute of LOCATION=OTHER, so that the primary and secondary structure instances are not allocated in the same coupling facility with one another. When there are active connectors to the structure, it also assumes a rebuild attribute of LESSCONNACTION=TERMINATE, so that the attempt to start duplexing for the structure is automatically stopped, if it would cause a loss of coupling facility connectivity for any active connector to the structure.","In addition to the primary and secondary structures being allocated in different coupling facilities from one another, the structure allocation process gives strong preference to placing the structures in two different coupling facilities, which are failure-isolated with respect to one another (that is, which are duplex failure-isolated).","The structure allocation technique for system-managed duplexing allocates the secondary structure taking the following considerations into account.\n\n","If the eligibility list of coupling facilities is reduced to zero after applying these considerations, then duplexing is not established, at this time. The duplexing rebuild is automatically stopped by the operating system, in this case. Otherwise, the operating system proceeds to attempt allocation in each of the coupling facilities, which remain in the eligibility list, in the order in which they appear in the eligibility list.","For system-managed duplexing, in one example, if the system successfully allocates the secondary structure, it is allocated with the same total\/maximum object counts as the primary structure. Directed Allocation commands are used to request that the secondary structure be allocated with the same attributes and total\/maximum object counts as the primary. If the directed allocation is successful in a particular coupling facility in the eligibility list, processing stops at that point; the secondary structure has been allocated. If not, allocation proceeds to be attempted in the next eligible coupling facility in the eligibility list.","When the coupling facilities in the eligibility list have been processed, if the secondary structure has not been successfully allocated, the operating system automatically stops the system-managed duplexing rebuild, because no secondary structure could be allocated. Otherwise, allocate phase processing continues.","For system-managed duplexing, the operating system sets the duplexing controls for each structure to indicate that duplexing is active. The system issues an Activate Duplexing (ADPLX) command to each structure instance, setting the other coupling facility's remote facility system identifier (RFSYID) and remote facility node descriptor (RFND) values; setting the other structure's remote facility structure identifier (RFSID) and remote facility structure authority (RFSAU) values, in each of the structures; and setting a duplexing active bit in a duplexing vector, thereby activating duplexing in each structure instance. This establishes a duplex pair of structures. Note that in the future when the system switches or stops duplexing and reverts to simplex mode, this binding of the structure instances is undone by issuing a Deactivate Duplexing (DDPLX) command against the surviving structure instance.","Embodiments of the Activate Duplexing Command and Deactivate Duplexing Command are described in a co-filed patent application entitled \u201cCoupling Of A Plurality Of Coupling Facilities Using Peer Links,\u201d Brooks et al. Ser. No. 09\/968,244, which is hereby incorporated herein by reference in its entirety.","If the secondary structure is successfully allocated, the system proceeds with system-managed duplexing structure attachment processing by transitioning into an Attach phase (). In this system-managed phase, the operating system attaches the active connectors (attached to the primary structure) to the secondary structure, as well.","When the active connectors are attached to the secondary structure, processing transitions into a Copy phase (). The copy process is a system-managed process, which proceeds independently with respect to active connectors to the structure (and is performed even if there are no active connectors to the structure). The copy process is, in most respects, similar to that used for system-managed rebuild. However, there are some differences for system-managed duplexing.","One difference that relates to the copy process is that, in this embodiment, storage class statistics are not copied from the old structure to the new structure for system-managed duplexing, nor are they duplexed on an ongoing basis between the two structure instances. Rather, each structure instance maintains its own storage class statistics independently. A request to read storage class statistics information from a duplexed structure returns one set of storage class information, from the primary structure instance.","Another difference in copy processing is that, for system-managed duplexing, copying of cache structure registrations is not performed. There is no need to copy registrations as part of establishing duplexing, since the operating system does not duplex any subsequent structure operations that register interest, once the structure is Duplex Established. The implication of this is that whenever switching forward to simplex mode using the secondary cache structure, the operating system is to ensure that all users' local cache vectors are overindicated as not valid (and thus, all local cache buffers are invalidated), since there are no valid registration information in the surviving simplex (formerly secondary) structure when that switchover occurs.","Another difference in copy processing has to do with copying of list structure registrations, especially sublist-monitoring registrations contained in Event Monitor Controls (EMCs). The registrations (e.g., list monitoring, key-range monitoring, event-queue monitoring, and sublist monitoring) are copied from the old structure to the new structure. However, the duplexing copy process does not request initial notification (INRT=0) and does request suppression of notification (SNC=1), when it registers interest in these things in the new structure. For list monitoring, key-range monitoring, and event-queue monitoring, this suppresses the generation of list notification signals, which is valid because the local vector is already in the correct state anyway. For sublist monitoring, this suppresses the queueing of created EMCs to the user's event queue. In effect, the EMCs in the new structure are unqueued at the time of copy, and remain unqueued throughout normal duplexed operation, as a result of the suppression of notification (SNC=1) on mainline operations to the secondary structure, regardless of whether or not the corresponding EMCs are being queued in the primary structure.","To correct for this lack of duplexing synchronization in the queueing of EMCs, before switching to simplex mode using the secondary structure instance, the operating system needs to prepare the secondary structure by using a command, referred to as Queue Pending EMCs or QPE, that causes EMCs associated with nonempty sublists to be queued to their respective event queues at that time. This processing may \u201coverindicate\u201d some events, but it ensures that initiatives to process nonempty sublists are not lost across a transition from duplex mode to simplex mode using the secondary structure instance. One embodiment of QPE is described in a co-filed patent application entitled \u201cCoupling Of A Plurality Of Coupling Facilities Using Peer Links\u201d, Brooks et al., Ser. No. 09\/968,244, which is hereby incorporated herein by reference in its entirety.","An implication of the way list registrations and notifications are handled for duplexed list structures is that, when switching to the secondary structure, the list notification vectors are cleared to overindicate the nonempty state for the monitored list resources.","When the copy process completes, the duplexing rebuild proceeds into a Duplex Established phase (). This is different from system-managed rebuild processing, where at this point processing would have transitioned into the cleanup phase, the old structure would have been deallocated, and the new structure would have been kept. Here, the intent of creating a new copy of the structure is to keep it around indefinitely in the Duplex Established phase, and transparently duplex required or desired operations to the structure in order to preserve the synchronization between the primary and secondary structures that the copy processing has just established.","On entry to the Duplex Established phase, the operating system modifies its internal control structures to reflect the fact that the structure is duplexed, so that subsequent requests are driven against the structure in duplex mode, if appropriate (see STEP  (FIG. )). Also, the structure is unquiesced by the operating system, so that new requests submitted by the exploiters can execute in duplexed mode. Furthermore, requests that were delayed while the structure was quiesced are similarly redriven, so that they can now execute in duplexed mode. In one example, the exploiters receive two event exit events on entry to the Duplex Established phase: Structure State Change Notification (informing them that the structure has now become duplexed), and Structure Available (the counterpart to the Structure Temporarily Unavailable event that they received back in the Startup phase, which lets the users know that the structure is usable again).","As long as the structure remains in the Duplex Established phase, which may be a very long time, structure operations by the exploiters are transparently duplexed by the operating system (as described above and in ,  and -).","Composition of Structure Attributes","In previous techniques, at various points in time, users of coupling facility structures were informed about the structure attributes of the structure to which they are connected. Many of these structure attributes relate in some way to the physical aspects of the coupling facility in which the structure is allocated, or of the physical structure instance itself.","For one aspect of the present invention, this poses an obstacle to the \u201ctransparency\u201d of system-managed coupling facility structure duplexing to the exploiters, because in general, the attributes of the primary and secondary structure may differ significantly from one another. Thus, as the structure transitions from simplex mode using the original structure, to duplexed with two structure instances allocated, to (eventually) simplex mode using the former secondary structure, several different sets of structure attributes potentially may need to become visible to the exploiters who depend on an understanding of these attributes.","In order to notify exploiters about structure attributes, a known Structure State Change Notification event is utilized. On entry to the Duplex Established phase, the Structure State Change Notification event is used to report the new attributes of the duplexed structure to the users, as described above. However, unlike before, the attributes presented on entry to the Duplex Established phase are \u201ccomposite\u201d attributes of the duplexed pair of structures. That is, the reported attributes are not the attributes of the primary or the secondary structure per se, but rather a composite of the two. The composite attributes reported on the Structure State Change Notification event are defined in terms of the following \u201ccomposition rules\u201d for the various structure attributes:\n\n","In one aspect of the present invention, there are various phases associated with stopping\/breaking duplexing for a system-managed duplexing rebuild process. One embodiment of these phases is described with reference to FIG. . Duplexing may be broken, or stopped, either voluntarily or as the result of a failure affecting one or the other of the structure instances. (As described above, it can also be caused by various types of failures of the duplexing protocols themselves, during the Duplex Established phase.)","With reference to , regardless of the reason for stopping duplexing for a structure in the Duplex Established phase (), there is an inherent \u201cdirectionality\u201d about the stop process. Processing either intends to keep the secondary structure as the surviving simplex structure (leading to the Switch () and Cleanup () phases), or it intends to keep the primary structure as the surviving simplex structure (leading to the Quiesce for Stop () and Stop () phases).","If the stop or switch processing is initiated as the result of a failure of a duplexed operation, such as a structure failure or a loss of connectivity to the coupling facility containing one of the two duplexed structure instances, then (unlike user-managed duplexing) knowledge of that failure condition is \u201chidden\u201d from the exploiters. No loss of connectivity nor structure failure event exit events are presented; and the requests to the coupling facility which experienced the failure are placed on a special \u201chold\u201d queue rather than being returned to the user with any response code indicative of the failure. This \u201chiding\u201d of the failure conditions affecting a duplexed structure is part of the philosophy behind system-managed duplexing, in which exploiters do not have to see these failure conditions, nor have any unique support to deal with these failure conditions, since they will be handled transparently by the system-managed duplexing failover mechanism in the operating system. Once the operating system has completed stop or switch processing and reverted to simplex mode, the requests on the hold queue are dispensed with appropriately, as discussed below.","When a switch to secondary is initiated, the Switch phase () is entered. During this system-managed phase, no external event exit events are presented to the exploiters. Each system internally quiesces access to the structure, so that any new requests received from the exploiter are internally queued and delayed until the structure has reverted to simplex mode (requests experiencing a failure condition are also placed on the \u201chold\u201d queue). Once the systems have quiesced access to the structure and held the in-progress requests against the structure, the processing transitions into the Cleanup phase ().","One embodiment of the logic associated with the Cleanup phase is described with reference to . The Cleanup phase is a system-managed phase in which each operating system image updates its internal control structures to reflect the fact that the structure has reverted to simplex mode, so that subsequent operations driven against the structure are executed as simplex requests targeted to the former secondary structure instance, STEP  (see also STEP  (FIG. )).","For example, there is a control block that represents a user's connection to the structure. In simplex mode, it includes the MFID and SID that identify the coupling facility and structure within that coupling facility. In duplex mode, it includes two sets of MFID and SID information, one for the primary structure and one for the secondary. If there is only one valid set of information in this control block, the structure is in simplex mode; if there are two, the structure is in duplex mode.","The following additional processing is performed by the operating system, as well during this phase:\n\n","Upon completion of the Cleanup phase, the users are presented with an event exit event, Structure State Change Notification, to inform them that the structure has reverted to simplex mode. The information presented in this event refers to the former secondary structure instance as the surviving structure.","Referring again to , when a stop to keep the primary is initiated, the Quiesce for Stop phase () is entered. During this system-managed phase, no external event exit events are presented to the exploiters. Each system internally quiesces access to the structure, so that any new requests received from the exploiter are internally queued and delayed until the structure has reverted to simplex mode (requests experiencing a failure condition are also placed on the \u201chold\u201d queue). Once all systems have quiesced access to the structure and held all in-progress requests against the structure, the processing transitions into the Stop phase ().","One embodiment of the logic associated with the Stop phase is described with reference to . The Stop phase is a system-managed phase in which each operating system image updates its internal control structures to reflect the fact that the structure has reverted to simplex mode, so that subsequent operations driven against the structure execute as simplex requests targeted to the former primary structure instance, STEP  (see also STEP  (FIG. )).","The following additional processing is performed by the operating system, as well during this phase:\n\n","Upon completion of the Stop phase, the users are presented with an event exit event, Structure State Change Notification, to inform them that the structure has reverted to simplex mode. The information presented in this event refers to the former primary structure instance as the surviving structure.","The above describes processing for switching\/stopping to fall out of duplexing when the structure is currently in the Duplex Established phase at the time of the switch\/stop request. Requests to switch or stop to fall out of duplexing can also occur during other phases of the overall system-managed duplexing rebuild process. Such requests will be handled as follows by aspects of the present invention:\n\n","The operating system also handles failure conditions (structure failure, coupling facility failure, loss of connectivity) that affect one or the other of the structure instances in an appropriate manner, based on the phase of the duplexing rebuild process:\n\n","In one aspect of the present invention, when a new instance of an exploiter attempts to connect to a duplexed structure during the Duplex Established phase of a system-managed duplexing rebuild process, the operating system transparently connects the new user to either: both of the duplexed structure instances, in duplex mode; or if that is not possible, to a simplex structure (either the former primary or former secondary structure instance).","In the case where the new user is successfully connected to both instances of the duplexed pair of structures, the outward appearance to the user is largely the same as if the structure had been in simplex mode, but with composite structure attributes being presented to the user in the connect response information. The rules for formulating this composite structure attribute information are the same composition rules as described above in the context of the presentation of the Structure State Change Notification event to active connectors on entry to the Duplex Established phase.","In the event that a new connector is able to be connected to one structure instance or the other of the duplex pair, but not both (e.g., due to lack of connectivity to one or the other of the coupling facilities), the operating system transparently falls out of duplexing, allowing the connect request to succeed to the one simplex structure instance that the connector is able to access. Once the new user is connected to the structure in simplex mode, the operating system attempts to reduplex the structure (if appropriate) into another suitable coupling facility to which the connectors, including the new one, have access. If it is not possible to reestablish duplexing in this way, the net result is that, in one aspect of the present invention, the allowing of new connectors to connect to the structure (and thus, to provide service to their clients), is favored over maintaining the duplexed state of the structure.","One embodiment of the logic associated with connecting to a duplexed structure during the Duplex Established phase is described with reference to FIG. . Initially, a determination is made as to whether the new user who is connecting to the structure has connectivity to the coupling facility where the primary structure resides, INQUIRY . If not, then a further determination is made as to whether the new user who is connecting to the structure has connectivity to the coupling facility where the secondary structure resides, INQUIRY . If not, then the user has no connectivity to either structure instance, and the operating system fails the connect request due to this total lack of relevant coupling facility connectivity, STEP .","However, if the user does have connectivity to the secondary structure at INQUIRY , then the system initiates break duplexing to switch to the secondary structure instance, STEP , in order to allow this user to connect in simplex mode to the secondary structure.","Returning to INQUIRY , if the user does have connectivity to the primary structure, then a further determination is made as to whether the new user who is connecting to the structure has connectivity to the coupling facility where the secondary structure resides, INQUIRY . If not, then the system initiates break duplexing to fall back to the primary structure instance, STEP , in order to allow this user to connect in simplex mode to the primary structure.","In either case where break duplexing processing was initiated, STEPS , , connect processing waits until this processing completes, STEP , and then proceeds to connect the new user to the surviving structure instance (be it the former primary or former secondary) in simplex mode, STEP . In this case, the system builds control structures that reflect the fact that the structure is operating in simplex mode.","If, however, the user had connectivity to the secondary structure's coupling facility at INQUIRY , then the new user has connectivity to both structure instances of the duplexed pair, and connect processing proceeds to connect the new user to both of the structure instances in duplex mode, STEP . In this case, the system builds control structures that reflect the fact that the structure is operating in duplex mode with two structure instances being used. Accordingly, coupling facility access requests made by the new connector are transparently split and processed as duplexed requests, as described earlier. Also note that the structure attributes returned to the new user via the connect response information will reflect the composite attributes of the duplexed structure, using the composition rules described earlier.","Duplex Enabled Monitoring\/Duplex Feasibility Checking","As one aspect of the present invention, the operating system periodically monitors all allocated coupling facility structures (or a subset of structures in another embodiment) to evaluate whether any structures that are currently in simplex mode should become duplexed, and if so, to determine the feasibility of starting duplexing for those simplex structures, based on current conditions.","This evaluation may determine that duplexing has now become possible for such a structure, in which case it initiates a duplexing rebuild process for the structure; or it may determine that duplexing remains infeasible at present, for any of a number of reasons, in which case it does not needlessly initiate a duplexing rebuild process for the structure which would be doomed to failure. Note that either a user-managed or a system-managed duplexing rebuild process can be initiated as a result of this feasibility checking.","The intent of duplex feasibility checking is to keep structures that are defined as \u201csupposed to be duplexed\u201d duplexed whenever possible, as much as is possible, without causing unnecessary system overhead by initiating duplexing rebuild processes that cannot possibly succeed in duplexing the structure because of environmental conditions that preclude successful duplexing.","One embodiment of the logic associated with this duplexing feasibility checking is described with reference to FIG. .","At periodic intervals (e.g., every 15 minutes), feasibility checking processing is run. When it runs, each coupling facility structure defined in the current CFRM policy definition is evaluated, starting with the first defined structure, STEP . If the structure is allocated, INQUIRY , and is currently in simplex mode, INQUIRY , and is defined in the CFRM policy as DUPLEX(ENABLED), INQUIRY , evaluation for the structure continues; otherwise, if any of these preliminary checks fail, processing flows to INQUIRY , in which a determination is made as to whether there are more defined structures to be considered. If so, feasibility checking proceeds with considering the next structure defined by the CFRM policy, STEP . If not, feasibility checking processing exits.","Returning to INQUIRY , if structure evaluation continues, then a further determination is made as to whether the connectors to the structure support user-managed duplexing, INQUIRY . If so, then processing flows to STEP , where a user-managed duplexing rebuild, having been determined to be feasible at present, is initiated. Processing then flows to INQUIRY  to consider other structures.","However, if the connectors do not support user-managed duplexing at INQUIRY , then a further determination is made as to whether the connectors to the structure support system-managed duplexing, INQUIRY . If not, then no type of duplexing rebuild is supported by the connectors and processing flows to INQUIRY  to consider other structures. If so, then evaluation for the structure continues with additional feasibility checks applicable to system-managed duplexing.","A determination is made as to whether the structure is allocated in a coupling facility that supports system-managed duplexing (e.g., CFLEVEL=10 or higher, in support of the architected duplexing signal exchanges and protocols), INQUIRY . If not, processing flows to INQUIRY  to consider other structures.","If the structure is allocated in a coupling facility that supports system-managed duplexing, then a further determination is made as to whether the structure is allocated in a coupling facility that has coupling facility-to-coupling facility connectivity to one or more other coupling facilities, which appear in this structure's preference list, INQUIRY . If not, processing flows to INQUIRY  to consider other structures.","Should CF-to-CF connectivity exist, but none of the other coupling facilities which had coupling facility-to-coupling facility connectivity to the coupling facility in which the structure is currently allocated has sufficient space to accommodate the allocation of the secondary structure in that target coupling facility with the structure attributes required, INQUIRY , then processing flows to INQUIRY  to consider other structures.","If all of these feasibility checks related to system-managed duplexing are successful, then a system-managed duplexing rebuild process is initiated for the structure, STEP . Processing then flows to INQUIRY  to consider other structures.","Described in detail above is a system-managed duplexing capability. The creating of a duplex copy of a structure includes having the operating system maintain information about two allocated coupling facility structure instances having the same name, for some period of time. By creating the duplex copy of the structure in advance of any failure, and then maintaining the structures in a synchronized duplexed state during normal mainline operation, a robust failure recovery capability is provided through the ability to failover to the structure instance which was unaffected by the failure.","Furthermore, many of the difficult steps that formerly required exploiter support and participation (e.g., in user-managed duplexing rebuild and user-managed rebuild) are internalized into the operating system, thus greatly reducing the exploiter's cost to provide a structure duplexing capability.","System-managed duplexing rebuild thus provides both a robust failure recovery capability for coupling facility structure data and content via the redundancy that the duplexing paradigm provides, and at the same time, it provides low exploitation cost via system-managed, internalized processing. Additionally, advantageously, system-managed duplexing rebuild supports all types of coupling facility structures (e.g., list, lock, and cache).","Although in the embodiments described herein, duplexing results in two structures of two coupling facilities, this can be extended to a plurality of structures in a plurality of coupling facilities.","The present invention can be included in an article of manufacture (e.g., one or more computer program products) having, for instance, computer usable media. The media has embodied therein, for instance, computer readable program code means for providing and facilitating the capabilities of the present invention. The article of manufacture can be included as a part of a computer system or sold separately.","Additionally, at least one program storage device readable by a machine, tangibly embodying at least one program of instructions executable by the machine to perform the capabilities of the present invention can be provided.","The flow diagrams depicted herein are just examples. There may be many variations to these diagrams or the steps (or operations) described therein without departing from the spirit of the invention. For instance, the steps may be performed in a differing order, or steps may be added, deleted or modified. All of these variations are considered a part of the claimed invention.","Although preferred embodiments have been depicted and described in detail herein, it will be apparent to those skilled in the relevant art that various modifications, additions, substitutions and the like can be made without departing from the spirit of the invention and these are therefore considered to be within the scope of the invention as defined in the following claims."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The subject matter which is regarded as the invention is particularly pointed out and distinctly claimed in the claims at the conclusion of the specification. The foregoing and other objects, features, and advantages of the invention are apparent from the following detailed description taken in conjunction with the accompanying drawings in which:",{"@attributes":{"id":"p-0064","num":"0072"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0065","num":"0073"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0066","num":"0074"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0067","num":"0075"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0068","num":"0076"},"figref":"FIGS. 5","i":["a","h "],"b":"5"},{"@attributes":{"id":"p-0069","num":"0077"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0070","num":"0078"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0071","num":"0079"},"figref":"FIG. 8","i":"a "},{"@attributes":{"id":"p-0072","num":"0080"},"figref":"FIG. 8","i":"b "},{"@attributes":{"id":"p-0073","num":"0081"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0074","num":"0082"},"figref":"FIG. 10"}]},"DETDESC":[{},{}]}
