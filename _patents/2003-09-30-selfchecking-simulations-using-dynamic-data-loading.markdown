---
title: Self-checking simulations using dynamic data loading
abstract: A system for evaluating a simulation includes a reference simulator configured to execute a simulation image to obtain golden data, a test simulator configured to execute the simulation image to obtain test data, and a comparator configured to generate a comparison result by comparing a portion of the golden data to a portion of the test data before the execution of the simulation image on the test simulator has completed.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07606695&OS=07606695&RS=07606695
owner: Sun Microsystems, Inc.
number: 07606695
owner_city: Santa Clara
owner_country: US
publication_date: 20030930
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF INVENTION","SUMMARY OF INVENTION","DETAILED DESCRIPTION"],"p":["Due to the complexity of modern electronic circuitry, designs for electronic circuits are often subjected to a rigorous verification process in order to detect errors. Often, simulation of the design for the circuitry is used to help locate and detect errors in the design and thus debug and\/or verify the correctness of the design. Simulation of a design may occur at low levels of abstraction, e.g., at a \u201cswitch-level.\u201d Switch-level simulations typically include active circuit elements (e.g., transistors) and passive circuit elements (e.g., resistors, capacitors, and inductors).","Simulation also may occur at a higher level of abstraction, e.g., a \u201cbehavioral level.\u201d Behavioral level simulations typically use a hardware description language (HDL) that determines the functionality of a single circuit element or group of circuit elements. Examples of typical behavioral level simulation languages are Very High Speed Integrated Circuit HDL (VHDL) and Verilog. Using Verilog, for example, electronic circuitry is described as a set of modules, each of which is part of a design of a circuit, circuits, or a device. Modules written in an HDL may be used to represent circuit elements of hardware ranging from simple gates to complete systems.","A design, e.g., a simulation or logic design, may be simulated on more than one type of simulator in order to facilitate verification of the design and\/or the simulator. For example, a design may be simulated on a hardware accelerator and\/or a software simulator. The hardware accelerator is a dedicated computer designed for a specific purpose, such as verifying designs. A software simulator is a computer program (which may be written in an HDL) that may run on a standard computer.","Often, a design is first simulated on a reference simulator, which provides reference, or \u201cgolden\u201d data. The golden data is used as a reference or standard (i.e., an \u201cexpected\u201d output) for later simulations and to compared against results of test simulators. These simulations may be performed on a different type of simulator and\/or after the design has undergone modifications or re-implementation.",{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 1","b":["20","22","28","30","32","34","40","42"]},"The design (e.g., Verilog modules) () and the user data () are compiled by the compiler () producing a simulation image (), i.e., a binary executable file. The design () includes instructions for simulating circuit elements by executing the simulation image () on the reference simulator () and the test simulator (). The user data () includes stimuli () and comparison data ().","The stimuli () include instructions for stimulating (or exercising) particular portions of a simulation image () during the simulation in order to generate the test data () and the golden data (). For example, the design () may include a particular circuit element, such as a gate. A designer may include instructions in the stimuli () so that a stimulus (e.g., a value of \u201c1\u201d) is sent as an input to the gate at a particular point of the simulation (e.g., 500 seconds into the simulation), or during a particular cycle of the simulation (e.g., the 100cycle of the simulation). The effect of the stimulus (such as the value of \u201c1\u201d) generates a particular output of the gate, which may be included in the test data () and\/or the golden data ().","The comparison data () includes instructions that specify particular values of interest to the designer for comparison purposes. For example, the designer may want to compare the reference simulator output of the aforementioned gate at a particular point of the simulation to the test simulator output of the aforementioned gate at that point of the simulation. The comparison data () includes instructions from the user data () to specify which signals of the design simulation are used for comparison purposes and at what point the signals are compared.","Executing the simulation image () on the reference simulator () generates golden data (), which is stored in the golden data repository (). Executing the simulation image () on the test simulator () generates test data (). The comparator () receives test data () and the golden data () as input. The golden data is typically obtained from the golden data repository ().","The comparator () compares the test data () to the golden data () and generates output in the form of a comparison result, which may be used to evaluate (i.e., debug and\/or verify) the test simulator () and\/or the design (). For example, for the aforementioned gate, the comparator () may use the comparison data () to compare the output of the gate at the 500cycle of a simulation for both the reference simulator () and the test simulator (). If the comparison shows a difference between the output of the gate on the reference simulator () and the output of the gate on the test simulator (), this may be an indication that the test simulator is defective.","Often, the design () is simulated on the test simulator () well after the design () is simulated on the reference simulator (). For example, after the design () is first simulated on the reference simulator (), the test simulator () is re-implemented (e.g., written in a different computer language, debugged, etc.) and then the design is simulated on the test simulator () days, weeks, months, etc. later. In this example, the resulting test data () generated by the test simulator () is compared to the same golden data () previously generated by reference simulator ().",{"@attributes":{"id":"p-0013","num":"0012"},"figref":["FIG. 2","FIG. 1"],"b":"80"},"Then, the design is compiled (with the user data) to generate a simulation image (Step ). The simulation image is loaded (Step ), and simulated (Step ) on the reference simulator. Once the simulation is complete on the reference simulator, the golden data from the simulation is stored in the golden data repository (Step ). Generally, the golden data is a record of values of signals (i.e., waveforms) from the simulation. For example, a particular waveform may represent the output value of a gate at specific points during the simulation.","Once the golden data has been stored, the simulation image is loaded onto (Step ), and simulated (Step ) on the test simulator. As a result of simulation on the test simulator, test data is generated. From the test data and the golden data, the comparator selects golden data and test data for comparison according to the instructions of the comparison data (which are included in the simulation image as executable code) (Step ). The selected golden data and selected test data is then compared to obtain a comparison result (Step ).","Next, the designer debugs the test simulator and\/or design using the comparison result (Step ). For example, the designer may detect an error if a mismatch between selected test data and selected reference data occurs, after which the designer may correct and recompile the test simulator, and continue verification of the simulation.","If the designer wishes to change the stimuli and\/or comparison data, the designer may create new user data and recompile the design to generate another simulation image. Likewise, while the simulation is performing on the test simulator, if the designer needs to revise stimuli or comparison data for simulation, the designer may halt the ongoing simulation, revise the stimuli and\/or comparison data, recompile the design and user data, and begin simulation again.","In general, in one aspect, the present invention involves a system for evaluating a simulation. The system comprises a reference simulator configured to execute a simulation image to obtain golden data, a test simulator configured to execute the simulation image to obtain test data, and a comparator configured to generate a comparison result by comparing a portion of the golden data to a portion of the test data before the execution of the simulation image on the test simulator has completed.","In general, in one aspect, the present invention involves a method of evaluating a simulation. The method comprises executing a simulation image on a reference simulator to obtain golden data, executing the simulation image on a test simulator to obtain test data, selecting a portion of the golden data and a portion of the test data, and comparing the selected golden data to the selected test data to obtain a comparison result.","In general, in one aspect, the present invention involves a computer system for evaluating a simulation. The computer system comprises a processor, a memory, a storage device, and software instructions. The software instructions stored in the memory for enabling the computer system to execute a simulation image on a reference simulator to obtain golden data, execute the simulation image on a test simulator to obtain test data, select a portion of the golden data and a portion of the test data, and compare the selected golden data to the selected test data to obtain a comparison result.","In general, in one aspect, the present invention involves an apparatus for evaluating a simulation. The apparatus comprises means for executing a simulation image on a reference simulator to obtain golden data, means for executing the simulation image on a test simulator to obtain test data, means for selecting a portion of the golden data and a portion of the test data, and means for comparing the selected golden data to the selected test data to obtain a comparison result.","Other aspects and advantages of the invention will be apparent from the following description and the appended claims.","Specific embodiments of the invention will now be described in detail with reference to the accompanying figures. Like elements in the various figures are denoted by like reference numerals for consistency.","In the following detailed description of the invention, numerous specific details are set forth in order to provide a more thorough understanding of the invention. However, it will be apparent to one of ordinary skill in the art that the invention may be practiced without these specific details. In other instances, well-known features have not been described in detail to avoid obscuring the invention.","The invention may be implemented on virtually any type computer regardless of the platform being used. For example, as shown in , a typical computer () includes a processor (), an associated memory (), a storage device (), and numerous other elements and functionalities typical of today's computers (not shown). The computer () may also include input means, such as a keyboard () and a mouse (), and an output device, such as a monitor (). Those skilled in the art will appreciate that these input and output means may take other forms. The computer () may be connected via a network connection () to a Wide Area Network (WAN) (), such as the Internet.","Aspects of the invention involve evaluating a simulation using a reference simulator and a test simulator. Aspects of the invention involve comparison of selected golden data from the reference simulator to selected test data from the test simulator before a simulation is complete on the test simulator. Aspects of the invention involve comparison of selected golden data from the reference simulator to selected test data from the test simulator before a simulation is complete on the reference simulator. Aspects of the invention involve obtaining user data, such as stimuli and comparison data, from a user and\/or debugging the test simulator or design while a simulation is performed.","A system for verification of a simulation using a reference simulator and a test simulator is shown in . The system includes a design () (e.g., a simulation or logic design), a compiler (), a simulation image (), the test simulator (), selected test data (), the reference simulator (), golden data (), a golden repository (), selected golden data (, ), a comparator (), and user data () (including stimuli () and comparison data ()). In an embodiment of the invention, the test simulator () and the comparator () are known as a test simulation system ().","The design (e.g., Verilog modules) () is compiled by the compiler (), which generates the simulation image (). The simulation image () is typically a binary executable file including instructions for performing a simulation on a computer, e.g., a computer or computers on which the reference simulator () and the test simulator () reside. In accordance with an embodiment of the invention, the reference simulator () and the test simulator () are software programs executing on specialized computing devices, such as hardware accelerators, or on general purpose computers, such as shown in .","The user data () includes data that is used to perform the simulation. In accordance with an embodiment of the invention, the user data () is provided by a user of the system while a simulation is being performed on the test simulator (), or before a simulation is complete on the test simulator (). In accordance with an embodiment of the invention, the user data () is provided by a user of the system before a simulation is performed on the test simulator ().","The user data () includes stimuli (), containing instructions for stimulating particular parts of the simulation image () during simulation to generate signal values during simulation. For example, the design () may include a particular circuit element, such as a register, an adder, or a gate, which is of interest to a designer who created the design (). Thus, the designer includes an instruction in the stimuli () to send a stimulus, i.e., a particular input signal to the circuit element, e.g., the gate, at a particular point during the simulation. The effect of the stimulus generates a particular output, which may be used to determine whether the test simulator and\/or design is working properly.","The user data () also includes comparison data (), containing instructions that specify particular signal values of interest to the designer for comparison purposes. For example, the designer may want to compare the reference simulator () output of the aforementioned gate at a particular point of the simulation to the test simulator () output of the aforementioned gate at that point of the simulation. The comparison data () may include instructions from the designer that specify which signals of the simulation of the design are used for comparison purposes and at what point the signals are compared.","The user data (), in accordance with an embodiment of the invention, includes one or more mapping rules for maps hierarchical features of different implementations of the design (). For example, the design may be implemented differently for the reference simulator () and the test simulator (). In this scenario, the design may be written using two different hardware description languages, resulting in two implementations. The two implementations, although functionally equivalent, have different internal hierarchies. Thus, two different versions of the simulation image () may be used to perform simulations on the test simulator () and the reference simulator (). Thus, the designer may include mapping rules in the user data () for use by the comparator () in order to map an implementation of the design () for the test simulator () to an implementation of the design () for the reference simulator ().","The comparator () compares selected golden data (, ) to selected test data (). Selected test data () may be selected from test data generated by the test simulator () based on the comparison data (). Similarly, selected golden data () may be selected from golden data generated by the reference simulator () based on the comparison data (). Alternatively, in one embodiment of the invention, selected golden data () may be selected from the golden data repository () based on the comparison data ().","For example, for the aforementioned gate, the comparator () may use the comparison data () to compare the output of the gate at a particular point for both the reference simulator () and the test simulator (). If the comparison shows a difference between the output of the gate for the simulation performed on the reference simulator () and the output of the gate for the test simulator (), the test simulator and\/or design may be defective.","In accordance with an embodiment of the invention, functionality of the comparator () may reside on one or more computers (or computerized devices) separate from the test simulator (). Alternatively, the comparator () may reside on one or more computers associated with the test simulator () and\/or the reference simulator (). The comparator () includes (or is in communication with) software components sufficiently configured to obtain the selected test data () and the selected golden data (, ). For example, the comparator () may include or use appropriate operating system functions or libraries, such as Application Programming Interfaces (API's) or Remote Procedure Calls (RPC's), etc.","Included in the system, but not shown, may be other software components (as needed), such as Command Line Tools (CLI's) and Graphical User Interfaces (GUI's) to enable a user (e.g., a designer or designers) to interact with the system. For example, a GUI for obtaining the user data may be included in the system. Other CLI's or GUI's may be used to control (i.e., stop and start) simulations, and to facilitate use of comparison results obtained from the comparator ().","In accordance with an embodiment of the invention, the selected test data () is a portion of the test data available from the test simulator () as a result of the simulation performed on the test simulator (). For example, hundreds or thousands of signals (i.e., waveforms) may be available from the test simulator () during or after a simulation, but the designer may select a fraction of the signals for comparison (using comparison data ()). Likewise, the selected golden data () may be a portion of the golden data () stored in the golden data repository (), which is available from the reference simulator () as a result of the simulation performed on the reference simulator ().","The selected golden data () may be obtained statically and used for comparison purposes as appropriate for a particular embodiment of the invention or for particular needs of a designer. For example, the selected golden data () may be obtained and used for comparison purposes after the simulation that provided the selected golden data () has completed. For example, a simulation may be performed on the reference simulator () resulting in the golden data () being stored in the golden data repository (). Then, hours, days, months, etc. afterward, a simulation may be performed on the test simulator accessing the selected golden data () from the golden data repository ().","Alternatively, the selected golden data () may be obtained dynamically while the simulation is being performed on the reference simulator (), instead of after the simulation has been performed on the reference simulator (). For such an embodiment of the invention, a buffer (not shown) may be used to store the golden data () (prior to being selected) in a manner similar to a producer-consumer situation, as such is commonly understood and used by those skilled in the art.","For example, the reference simulator () and the test simulator () may perform a simulation of a design concurrently, i.e., in lockstep. As golden data () becomes available during the simulation, the golden data () is stored in a buffer (not shown). Once stored in the buffer, the comparator () may obtain the selected golden data () from the buffer (not shown) when available.","Whether the selected golden data (, ) is obtained dynamically (i.e., while the simulation on the reference simulator () is being performed), or statically (i.e., after the simulation on the reference simulator () has been performed), obtaining and comparing the selected golden data (, ) and the selected test data () may occur before the simulation is being performed on the test simulator (). Further, obtaining and comparing the selected golden data (, ) and the selected test data () may occur at various times and intervals during the evaluation, as required and defined by the designer.","For example, the designer may use the comparison data () to obtain the selected golden data (, ) and\/or the selected test data () every 100cycle of the simulation. Alternatively, the selected golden data (, ) and\/or the selected test data () may be obtained at varying or irregular intervals. Further, the designer may modify the frequency that the selected golden data (, ) and\/or the selected test data () are obtained and compared while the simulation is being performed on the test simulator ().",{"@attributes":{"id":"p-0049","num":"0048"},"figref":["FIG. 5","FIG. 4","FIG. 3"],"b":["200","202","204","206"]},"Once the simulation has completed on the reference simulator, the golden data from the simulation is stored in a golden data repository (Step ). In one embodiment of the invention, the golden data is a record of values of signals (i.e., waveforms) from the simulation. For example, a particular waveform may represent the output value of the aforementioned gate at specific points during the simulation.","Once the golden data has been stored, the simulation image is loaded onto the test simulator (Step ). Next, user data is obtained from a user, e.g., a designer (Step ). The user data includes stimuli and comparison data. In accordance with an embodiment of the invention, user data is organic (i.e., obtained within an indefinite amount of time, e.g., seconds, minutes, days, weeks, etc., after the simulation has been performed on the reference simulator).","Next, a portion of the simulation is performed on the test simulator (Step ). In one embodiment of the invention, the quantity of the simulation (i.e., how large or small a portion) that is performed on the test simulator is determined by the user data to produce test data (i.e., waveforms of signals). The comparator then selects golden data and test data for comparison according to the instructions of the comparison data (Step ). The selected golden data and selected test data are then compared to obtain a comparison result (Step ).","If the comparison result is an error (Step ), then the designer determines whether or not to halt simulation (Step ). If the simulation is halted, the designer then debugs the test simulator (or the design) using the comparison result (Step ). For example, the designer may detect an error if a mismatch between selected test data and selected reference data occurs. Correction of the error may require that the designer correct the simulator (or design), obtain user data (Step ), and then continue evaluating the simulation (Steps -).","If the comparison result is not an error (Step ) or the simulation is not halted (Step ), a determination is made whether the simulation on the test simulator is complete (Step ). If the simulation is complete, a determination is made whether each error has been corrected (Step ). If each error is corrected, the simulation ends. Otherwise, the designer may need to debug and correct the test simulator (or the design) using the comparison result (Step ). Correction of the error may require that the designer correct the simulator (or design), obtain user data (Step ), and then continue evaluating the simulation (Steps -).","If the simulation is not complete, the simulation is advanced (Step ) by advancing a cycle or a simulation clock. Steps - are performed until the simulation is complete.",{"@attributes":{"id":"p-0056","num":"0055"},"figref":["FIG. 6","FIG. 4"]},"Initially, the design is obtained (Step ). Then, the design is compiled using the compiler to generate a simulation image (Step ). The simulation image is then loaded onto the test simulator and the reference simulator (Step ). The user data is obtained (Step ) and used to determine the quantity of the simulation to be performed.","A portion of the simulation is then performed on the test simulator and the reference simulator (Step ) as defined by the user data. Next, golden data from the portion of the simulation is stored in the golden data repository (e.g., the buffer) (Step ). Once the golden data has been stored, the comparator then selects golden data and test data for comparison according to the instructions of the comparison data (Step ).","Once obtained, the selected golden data and selected test data are then compared to obtain a comparison result (Step ). If the comparison result is an error (Step ), then the designer determines whether or not to halt simulation (Step ). If the simulation is halted, the designer then debugs the test simulator (or the design) using the comparison result (Step ). For example, the designer may detect an error if a mismatch between selected test data and selected reference data occurs. Correction of the error may require that the designer correct the simulator (or design), obtain user data (Step ), and then continue evaluating the simulation (Steps -).","If the comparison result is not an error (Step ) or the simulation is not halted (Step ), a determination is made whether the simulation on both the test simulator and the reference simulator is complete (Step ). If the simulations are complete, a determination is made whether each error has been corrected (Step ). If each error is corrected, the simulation ends. Otherwise, the designer may need to debug and correct the test simulator (or the design) using the comparison result (Step ). Correction of the error may require that the designer correct the simulator (or design), obtain user data (Step ), and then continue evaluating the simulation (Steps -). If the simulation is not complete, the simulation is advanced on the test and reference simulators (Step ) by advancing a cycle or a simulation clock. Steps - are performed until the simulation is complete.","As discussed earlier, the user data may be altered, modified, or replaced entirely during performance of simulation on either the test simulator or the reference simulator. Appropriate functionality for altering the user data may be included in the system. For example, the system may include functionality to lock out records and files used for storage of the golden data and for storage of the user data. Such functionality may include database file locking techniques and\/or thread synchronization techniques, such as are well known to those skilled in the art.","Further, sequences of actions or operations shown in  and\/or  may differ according to embodiments of the invention. For example, user data may be obtained before loading simulation images onto the reference simulator and\/or the test simulator.","Embodiments of the present invention may have one or more of the following advantages. Verification of designs is streamlined by acceleration and automation of comparison of simulation results. For example, the present invention may enhance the speed and quality of simulation verification by enabling a designer to alter user data \u201con the fly,\u201d i.e., while the simulation is ongoing. Furthermore, the designer may debug the test simulator \u201con the fly.\u201d Therefore, the designer may view comparison results while the simulation proceeds, possibly enabling the designer to gain additional insight into debugging the simulation. Such additional insight may lead to altering the user data \u201con the fly\u201d in order to better debug. Because altering user data and\/or the test simulator may be accomplished without recompiling the design, verification is streamlined.","While the invention has been described with respect to a limited number of embodiments, those skilled in the art, having benefit of this disclosure, will appreciate that other embodiments can be devised which do not depart from the scope of the invention as disclosed herein. Accordingly, the scope of the invention should be limited only by the attached claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF DRAWINGS","p":[{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
