---
title: Embedded apparatus, remote-processing method, and computer program product
abstract: A processing unit performs a predetermined process by a remote operation from a client device. A monitoring unit monitors a first port for an unencrypted communication with the processing unit and a second port for an encrypted communication with the processing unit, denies a connection request via the first port, and accepts a connection request via the second port. When a connection request encrypted with either one of the first port and the second port specified as a forwarding destination port is received, an encrypted communication unit decrypts the connection request and transfers decrypted connection request to the monitoring unit via the forwarding destination port.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08966244&OS=08966244&RS=08966244
owner: Ricoh Company, Ltd.
number: 08966244
owner_city: Tokyo
owner_country: JP
publication_date: 20090701
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS"],"p":["The present application claims priority to and incorporates by reference the entire contents of Japanese Patent Application No. 2008-182806 filed in Japan on Jul. 14, 2008 and Japanese Patent Application No. 2009-135091 filed in Japan on Jun. 4, 2009.","1. Field of the Invention","The present invention relates to an embedded apparatus connected to a client device, a remote-processing method, and a computer program product.","2. Description of the Related Art","In recent years, in an embedded apparatus such as a multifunction peripheral (MFP) that includes a printer function, a copier function, a facsimile function, a scanner function, and the like, various settings, reference or change of the settings, and the like are performed from a client device by a remote-communication service (hereinafter, \u201ctelnet service\u201d (telecommunication network service)) using telnet protocol.","The various settings and the reference or change of the settings of the embedded apparatus are preferably performed by an encrypted communication not by an unencrypted communication in plain text to enhance security.","However, the telnet protocol that is used in the various settings and the like is a protocol for communication in plain text, so that the encrypted communication using a secure shell (SSH) program (hereinafter, \u201cSSH service\u201d) is considered for improving security. In other words, it is considered to perform the various settings and the like for the embedded apparatus from the client device by the encrypted communication using the SSH service.","The telnet service in the embedded apparatus is different from the one used in UNiplexed Information and Computing System (UNIX) (registered trademark). Specifically, in the telnet service used in UNIX, a user logs into a server from the client device via a network for a remote operation. For example, the user can access a UNIX file system on the server from a shell or can execute commands provided in UNIX on the server from the shell.","On the other hand, the telnet service in the embedded apparatus cannot access a file system of the embedded apparatus or allow execution of commands provided in an operating system (OS) of the embedded apparatus, which is different from the one used in UNIX. In other words, the telnet service in the embedded apparatus only has a function as a computer program for performing the various settings and the like by the remote operation from the client device.","Moreover, the SSH service in the embedded apparatus also functions differently from the one in UNIX. Specifically, in the SSH service in UNIX, a user can log into a server by the encrypted communication using secure socket layer (SSL) protocol to start the shell and perform the remote operation from the shell similarly to the telnet service. On the other hand, the SSH service in the embedded apparatus does not have a function of the shell because access to a file system or execution of UNIX commands are not allowed as described above, so that the shell cannot be started.","Therefore, the following methods are considered to perform the various settings and the like of the embedded apparatus from the client device by the encrypted communication.","A first method is to embed a function equivalent to the telnet service, i.e., a telnet daemon, to the SSH service, i.e., an SSH daemon.","However, with this method, maintenance for both of the telnet daemon and the SSH daemon is required, thereby complicating maintenance and management of computer programs.","A second method is to establish a pipe connection between the SSH daemon and the telnet daemon by starting the telnet daemon directly by the SSH daemon. In a typical method in UNIX, the telnet daemon is started by an inet (Internet) daemon.","However, with this method, a new telnet daemon needs to be developed, and a process for identifying a port becomes complicated.","Therefore, a method of providing a function equivalent to the telnet service using a port forwarding function as a function of the SSH service is considered. Specifically, a technique is known to access the telnet service from an internal network using the port forwarding function, thus enabling to use the telnet service.","However, although the port forwarding function enables the encrypted communication via the SSH daemon to a port connectable by the unencrypted communication, it is not for avoiding the unencrypted communication. Therefore, the unencrypted communication can still be used. In other words, the telnet daemon needs to be always run to use the port forwarding function of the SSH, which means that not only a port for the encrypted communication but also a port for the unencrypted communication are always in an open state.","Therefore, when a user who is unfamiliar with a security performs the unencrypted communication, plaintext information may be read by a third party. For example, Japanese Patent Application Laid-open No. 2007-251568 discloses a technique as a countermeasure for the above problem, in which when a request for the unencrypted communication is received from the client device, a reply is sent to the client device to cause the client device to perform the encrypted communication.","However, in the above technique, the unencrypted communication can be avoided only by nullifying the function of the unencrypted communication, causing the SSH port forwarding function unusable.","It is an object of the present invention to at least partially solve the problems in the conventional technology.","According to one aspect of the present invention, there is provided an embedded apparatus that is configured to be connected to a client device via a network. The embedded apparatus includes a processing unit that performs a predetermined process by a remote operation from the client device; a monitoring unit that monitors a first port that is a connection interface for an unencrypted communication with the processing unit and a second port that is a connection interface for an encrypted communication with the processing unit, denies a connection request via the first port to the processing unit, and accepts a connection request via the second port to the processing unit; and an encrypted communication unit that performs an encrypted communication with the client device, when a connection request encrypted with either one of the first port and the second port specified as a forwarding destination port is received, decrypts the connection request, and transfers decrypted connection request to the monitoring unit via the forwarding destination port. When the connection request is accepted, the processing unit performs the predetermined process by an encrypted communication with the client device via the second port and the encrypted communication unit.","Furthermore, according to another aspect of the present invention, there is provided a remote-processing method for an embedded apparatus that is configured to be connected to a client device via a network. The embedded apparatus includes a processing unit, a monitoring unit, and an encrypted communication unit. The remote-processing method includes processing including the processing unit performing a predetermined process by a remote operation from the client device; monitoring including the monitoring unit monitoring a first port that is a connection interface for an unencrypted communication with the processing unit and a second port that is a connection interface for an encrypted communication with the processing unit, denies a connection request via the first port to the processing unit, and accepts a connection request via the second port to the processing unit; and communicating including the encrypted communication unit performing an encrypted communication with the client device, when a connection request encrypted with either one of the first port and the second port specified as a forwarding destination port is received, decrypting the connection request, and transferring decrypted connection request to the monitoring unit via the forwarding destination port. When the connection request is accepted, the processing includes the processing unit performing the predetermined process by an encrypted communication with the client device via the second port and the encrypted communication unit.","Moreover, according to still another aspect of the present invention, there is provided a computer program product including a computer-usable medium having computer-readable program codes embodied in the medium for implementing a remote-processing method for an embedded apparatus that is configured to be connected to a client device via a network. The embedded apparatus includes a processing unit, a monitoring unit, and an encrypted communication unit. The program codes when executed cause a computer to execute processing including the processing unit performing a predetermined process by a remote operation from the client device; monitoring including the monitoring unit monitoring a first port that is a connection interface for an unencrypted communication with the processing unit and a second port that is a connection interface for an encrypted communication with the processing unit, denies a connection request via the first port to the processing unit, and accepts a connection request via the second port to the processing unit; and communicating including the encrypted communication unit performing an encrypted communication with the client device, when a connection request encrypted with either one of the first port and the second port specified as a forwarding destination port is received, decrypting the connection request, and transferring decrypted connection request to the monitoring unit via the forwarding destination port. When the connection request is accepted, the processing includes the processing unit performing the predetermined process by an encrypted communication with the client device via the second port and the encrypted communication unit.","The above and other objects, features, advantages and technical and industrial significance of this invention will be better understood by reading the following detailed description of presently preferred embodiments of the invention, when considered in connection with the accompanying drawings.","Exemplary embodiments of an embedded apparatus, a remote-processing method, and a computer program product according to the present invention are described in detail below with reference to the accompanying drawings. In the embodiments, an image forming apparatus is employed as an example of the embedded apparatus. The image forming apparatus is, for example, a copier, a printer, a scanner, a facsimile machine, or an MFP that includes at least two of a copier function, a scanner function, a printer function, and a facsimile function. However, the present invention is not limited thereto, and the present invention can be applied to any embedded apparatus.",{"@attributes":{"id":"p-0046","num":"0045"},"figref":"FIG. 1","b":["2","1","1","2","3"]},"The image forming apparatus  is realized by a microcomputer including a central processing unit (CPU), a read only memory (ROM), and a random access memory (RAM), and includes a network control service unit , a control unit that controls the entire apparatus, a display unit, an input unit, and a function unit for image formation. The control unit, the display unit, the input unit, and the function unit are well known, so that these units are not shown and explanation thereof is omitted.","The network control service unit  provides various server functions related to the network control to the PC  as the client device, and includes an external port , an internal port , an inet daemon (INETD) , a telnet daemon (TLNTD) , an rsh (remote shell) daemon (RSHD) , and an SSH daemon (SSHD) . In , each daemon has already been started. The external port  is an external port for the telnet daemon  and functions as a connection interface (I\/F) for unencrypted communication between inside and outside of the image forming apparatus . The internal port  is an internal port for the telnet daemon  and functions as a communication I\/F for encrypted communication in the image forming apparatus .","The telnet daemon  operates as a processing unit and is a function unit that provides a telnet server function of the image forming apparatus  to the PC . The telnet daemon  in the present embodiment functions only as a management program that executes various settings or reference or change of the settings for an administrator of the image forming apparatus , which is different from a telnet service used in Unix. Therefore, the telnet daemon  cannot access a file system and execute commands provided in an OS.","The rsh daemon  operates as a processing unit and is a function unit that provides an rsh server function to the PC .","The SSH daemon  operates as a processing unit and is a function unit that provides an SSH server function of the image forming apparatus  to the PC . The SSH daemon  includes an external port  as a communication I\/F for data transfer from an external device such as the PC , and the SSH daemon  operating as an encrypted communication unit performs the encrypted communication with the PC  via the external port .","The SSH daemon  is different from an SSH daemon provided in UNIX as the telnet daemon  is limited in function of the telnet service provided in UNIX, and only provides a login function by the encrypted communication, so that a shell cannot be started. Moreover, the SSH daemon  includes a port forwarding function, with which the SSH daemon  can provide a service equivalent to the telnet daemon .","A telnet connection request is a connection request to the telnet daemon . An SSH connection request is a connection request to the SSH daemon . In the case of connecting the PC  to the telnet daemon  by using the port forwarding function of the SSH, when the SSH connection request specifying the port of the telnet daemon  as a forwarding destination port is made, the SSH daemon  transfers the SSH connection request to the port of the telnet daemon  as the forwarding destination included in the received SSH connection request as the telnet connection request, which is the port forwarding function in the SSH service.","More specifically, the SSH daemon  receives the SSH connection request, in which any one of the external port  and the internal port  is specified as the forwarding destination port and which is encrypted, from the PC  via the external port . Then, the SSH daemon  operating as an encrypted communication unit decrypts the received SSH connection request, extracts the forwarding destination port from the decrypted SSH connection request, and transfers the decrypted SSH connection request to the inet daemon  as the telnet connection request via the extracted forwarding destination port.","The inet daemon  manages and controls each daemon such as the telnet daemon  and the rsh daemon , and starts each daemon according to need.","Moreover, the inet daemon , operating as a monitoring unit, always monitors the external port  and the internal port  of the telnet daemon . When the net daemon  receives the telnet connection request from the external port , the inet daemon  denies the telnet connection request. When the inet daemon  receives the telnet connection request that is transferred by the port forwarding function of the SSH daemon  via the external port , the Met daemon  denies the telnet connection request. On the other hand, when the Met daemon  receives the telnet connection request that is transferred by the port forwarding function of the SSH daemon  via the internal port , the inet daemon  accepts the telnet connection request and transfers it to the telnet daemon . In this manner, it is possible to perform processes, such as various settings and reference and update of the various settings using the telnet service, from the PC  by the encrypted communication with high security by using the port forwarding function of the SSH daemon  and further accepting only the telnet connection request that is transferred by the port forwarding function from the SSH daemon  via the internal port  and connecting to the telnet daemon .","The PC  is realized by a microcomputer including a CPU, a ROM, and a RAM, and includes a telnet client (TNC) , an SSH client (SSHC) , a control unit that controls the entire apparatus, a display unit, and an input unit. The control unit, the display unit, and the input unit are well known, so that these units are not shown and explanation thereof is omitted.","The telnet client  is a function unit that provides a client function of the telnet connection to the telnet server function of the image forming apparatus .","The SSH client  is a function unit that provides a client function of the SSH port forwarding connection to the SSH server function of the image forming apparatus .","A network connection process by the image forming apparatus  is explained below with reference to .  is a flowchart of a connection-request transferring process by the SSH daemon  according to the first embodiment.","The SSH daemon  is in a standby state for receiving the SSH connection request via the external port  (No at Step S). When the SSH daemon  receives the SSH connection request (Yes at Step S), the SSH daemon  decrypts the received SSH connection request because the SSH connection request is encrypted (Step S). The SSH daemon  extracts a forwarding destination port specified to a predetermined position in a packet of the decrypted SSH connection request (Step S). Then, the SSH daemon  determines the extracted forwarding destination port (Step S).","If the forwarding destination port is the external port , the SSH daemon  transfers the decrypted SSH connection request to the inet daemon  via the external port  as the telnet connection request (Step S). If the forwarding destination port is the internal port , the SSH daemon  transfers the decrypted SSH connection request to the inet daemon  via the internal port  as the telnet connection request (Step S). In this manner, the SSH connection request that the SSH daemon  received from the PC  is transferred to the inet daemon  as the telnet connection request by the port forwarding function.",{"@attributes":{"id":"p-0063","num":"0062"},"figref":"FIG. 3","b":["16","16","16","11","18","21"]},"Then, the inet daemon  becomes a standby state for receiving the connection request (No at Step S). When the inet daemon  receives the telnet connection request (Yes at Step S), the inet daemon  determines the port of the received telnet connection request (Step S). The inet daemon  can determine the port by checking a portion of the port specified in the packet of the telnet connection request or can ask each port (the external port  and the internal port ) for a telnet connection request packet sequentially and determine that the port from which the telnet connection request packet is received as the port of the received telnet connection request.","If the port that received the telnet connection request is the internal port , the inet daemon  accepts the received telnet connection request (Step S) and transfers it to the telnet daemon  (Step S). Whereby, the connection of the telnet client  and the telnet daemon  is established.","On the other hand, at Step S, if the port that received the telnet connection request is the external port , the inet daemon  denies the received telnet connection request (Step S) and does not connect the telnet client  to the telnet daemon . Whereby, the telnet connection by the unencrypted communication can be avoided.","A specific example of a process to the telnet connection request is explained below.  is a sequence diagram of an example of refusal to the telnet connection request. Internet protocol (IP) addresses of the image forming apparatus  and the PC  are (192.168.0.2) and (192.168.0.1), respectively. The port number of the external port  is 23. The connection destination and the forwarding destination of the telnet connection request are specified in the connection request packet in the form of (IP address: port number). In the drawings and the following explanation, a TN connection request indicates the telnet connection request.","As shown in (A) in , when the connection request (the TN connection request) is made from the telnet client  via the network  through telnet that is the unencrypted communication, specifying the external port  that is the connection destination (192.168.0.2:23) of the image forming apparatus  (Step S), because the port that received the telnet connection request is determined to be the external port  at Step S, the inet daemon  denies the telnet connection request.","In this manner, the inet daemon  can prevent the telnet connection in plain text.","Next, it is explained of a case of using the SSH port forwarding when the PC  makes the telnet connection request to the image forming apparatus .","As shown in (B) in , the telnet client  establishes a loopback connection to the SSH client  that is the forwarding destination (127.0.0.1:X) (X is an arbitrary port number), specifying the external port  that is the forwarding destination (192.168.0.2:23) of the connection request (Step S). Then, the SSH client  makes the connection request (the SSH connection request) through the SSH that is the encrypted communication, specifying the external port  that is the forwarding destination (192.168.0.2:23), to the external port  that is the connection destination (192.168.0.2:22) (the number \u201c22\u201d indicates the external port ) of the image forming apparatus  via the network  (Step S).","The SSH daemon  decrypts the SSH connection request from the PC  and determines the forwarding destination, and transfers the SSH connection request to the external port  indicated as the forwarding destination (192.168.0.2:23) as the telnet connection request (Step S). Because the telnet connection request is the connection request to the external port , the inet daemon  denies the connection by the above Steps S and S.","In this manner, the inet daemon  denies the connection request to the external port  that is a connection I\/F for the unencrypted communication.","Next, a case is explained in which the SSH port forwarding function is used to connect the PC  to the image forming apparatus  when the PC  makes the telnet connection request to the image forming apparatus .  is a sequence diagram of an example of permission to the telnet connection request. The port number of the external port  is set to 22, and the port number of the internal port  is set to 23. In the similar manner to the example shown in , the connection destination and the forwarding destination are specified by (IP address: port number).","The telnet client  establishes a loopback connection to the SSH client  that is the connection destination (127.0.0.1:X) (X is an arbitrary port number), specifying the internal port  that is the forwarding destination (127.0.0.1:23) of the connection request (Step S). Then, the SSH client  makes the connection request (the SSH connection request) through the SSH that is the encrypted communication, specifying the internal port  that is the forwarding destination (127.0.0.1:23), to the external port  that is the connection destination (192.168.0.2:22) of the image forming apparatus  via the network  (Step S).","The SSH daemon  decrypts the SSH connection request from the PC  and determines the forwarding destination, and transfers the SSH connection request to the internal port  indicated as the forwarding destination (127.0.0.1:23) as the telnet connection request (Step S). Because the telnet connection request is the connection request to the internal port , the inet daemon  permits the connection by the above Steps S and S (Step S).","In this manner, the TN connection from the telnet client  to the telnet daemon  is permitted, so that the image forming apparatus  enables a user to utilize the telnet server function from the PC .","According to the present embodiment, the telnet connection request from the external port  and the telnet connection request that is transferred from the SSH daemon  via the external port , which are premised on the unencrypted communication, are denied, and only the telnet connection request by the encrypted communication from the SSH daemon  via the internal port  is accepted. Therefore, a conventional telnet daemon can be used without change in the present embodiment. Thus, it is possible to perform the remote processes, such as various settings and change and reference of the various settings, from the PC  while development effort is reduced and security is surely improved by a simple method.","A modified example of the first embodiment is explained below. When the telnet connection request is made from the PC  to the external port , an error reply or a message to make the connection request specifying the transfer to the internal port  by the encrypted communication can be sent to the PC .  is a flowchart of a connection-request determining process by the inet daemon  according to the modified example of the first embodiment.  is a sequence diagram of an error reply process when the telnet connection request is received according to the modified example of the first embodiment.","The processes from Step S (start process of each daemon) to Step S (determination of a port that received a connection request) are performed in the similar manner to Steps S to S in the first embodiment.","At Step S, if the port that received the telnet connection request is the external port , the inet daemon  denies the telnet connection request as in the first embodiment (Step S). Furthermore, the inet daemon  sends the error reply (connection error message) to the PC  (Step S).","More specifically, as shown in , when the inet daemon  receives the telnet connection request by the encrypted communication via the external port  that is the connection destination (192.168.0.2:23) (the number \u201c23\u201d indicates the external port ) (Step S), the inet daemon  denies the connection request, and further sends the connection error message to the telnet client  (Step S). At Step S, the processes (Steps S and S) when the port that received the telnet connection request is the internal port  are performed in the similar manner to Steps S and S in the first embodiment.",{"@attributes":{"id":"p-0083","num":"0082"},"figref":"FIG. 8","b":["1","2","20","11","2","1"]},"In this manner, when the connection request by the unencrypted communication is made by a user, the error reply and the reply indicating that the SSH connection is needed are sent, so that the user who is going to establish the connection by the unencrypted communication can be led to the encrypted communication.","Instead of the error reply as shown in , it is also possible to send from the inet daemon  or the like to the PC  an error message to make the connection request specifying the transfer to the internal port  by the encrypted communication by the port forwarding function. Specifically, the inet daemon  sends the error message to the PC  using the messenger function of a server messenger block (SMB).",{"@attributes":{"id":"p-0086","num":"0085"},"figref":["FIG. 9","FIG. 9"],"b":["13","16","12","16","13","14"]},"In this manner, when a user makes the connection request by the unencrypted communication, a message prompting the user to establish the connection via the port forward is sent, so that the image forming apparatus  can provide a method to solve a problem to a user who tried to establish the connection by the unencrypted communication and lead the user to the encrypted communication.","In the first embodiment, when the telnet connection request is made directly from the PC  via the external port , the connection request is denied. In a second embodiment, even when the telnet connection request is made directly from the PC  via the external port , if the telnet connection request is made by the encrypted communication such as the IPsec, the connection request is accepted.",{"@attributes":{"id":"p-0089","num":"0088"},"figref":"FIG. 10","b":["2","1000","2"]},"In the present embodiment, the image forming apparatus  includes a network control service unit . The network control service unit  operates as a processing unit, like the network control service unit  in the first embodiment, and includes the external ports  and , the internal port , an inet daemon , the SSH daemon , the telnet daemon , and the rsh daemon . The functions and the configurations of the external ports  and , the internal port , the SSH daemon , the telnet daemon , and the rsh daemon  are the same as those in the first embodiment.","In the similar manner to the inet daemon  in the first embodiment, when the telnet connection request is transferred from the SSH daemon  to the inet daemon  by the port forwarding function, if it is transferred via the internal port , the inet daemon  accepts the connection request. However, if the telnet connection request is transferred via the external port , the inet daemon  denies the connection request.","Moreover, even when the inet daemon  receives the telnet connection request directly from the PC  via the external port , if it is through the encrypted communication by the IPsec, the inet daemon  accepts the telnet connection request. However, if it is by the unencrypted communication, the inet daemon  denies the telnet connection request. Whether the inet daemon  receives the telnet connection request through the encrypted communication by the IPsec is determined based on presence\/absence of a negotiation with the PC  performed in the IPsec such as a key exchange, a packet of the received connection request, or the like.","A connection-request determining process by the image forming apparatus  is explained below.  is a flowchart of the connection-request determining process by the inet daemon  according to the second embodiment.","The processes from Step S (start process of each daemon) to Step S (determination of a port that received a connection request) are performed in the similar manner to Steps S to S in the first embodiment.","At Step S, if the port that received the telnet connection request is the external port , the inet daemon  determines whether the inet daemon  receives the telnet connection request by the IPsec (Step S). If the inet daemon  does not receive the telnet connection request by the IPsec (No at Step S), the inet daemon  denies the telnet connection request as in the first embodiment (Step S). If the inet daemon  receives the telnet connection request by the IPsec (Yes at Step S), the inet daemon  accepts the telnet connection request (Step S) and transfers the telnet connection request to the telnet daemon  (Step S).",{"@attributes":{"id":"p-0096","num":"0095"},"figref":"FIG. 12"},"When the connection request (the TN connection request on IPsec) is made from the telnet client  to the external port  that is the connection destination (192.168.0.2:23) (the number \u201c23\u201d indicates the external port) of the telnet daemon  of the image forming apparatus  via the network  by communication through telnet by the IPsec communication (Step S), the inet daemon  permits the connection (Step S) and makes a connection reply to the telnet client  (Steps S and S).","According to the present embodiment, when the inet daemon  receives the telnet connection request via the external port directly from the PC  by the encrypted communication by the IPsec (not by the port forwarding function of the SSH daemon ), the inet daemon  permits the connection. Therefore, the telnet client  can be directly connected to the telnet daemon  and receive the telnet connection request without via the port forwarding function of the SSH daemon . Thus, the image forming apparatus  need not require the PC  to further encrypt the telnet connection request that has already been protected by the IPsec, enabling to reduce the load on a user.","In the first embodiment, when the SSH daemon  receives the SSH connection request from the PC , the SSH daemon  transfers the connection request to the forwarding destination port specified in the connection request. In a third embodiment, when the SSH connection request is received from the PC , if the forwarding destination port is the external port, the connection request is transferred after changing the forwarding destination port to the internal port.",{"@attributes":{"id":"p-0100","num":"0099"},"figref":"FIG. 13","b":["2","1300","2"]},"In the present embodiment, the image forming apparatus  includes a network control service unit . The network control service unit  includes the external ports  and , the internal port , the inet daemon , an SSH daemon , the telnet daemon , and the rsh daemon . The functions and the configurations of the external ports  and , the internal port , the inet daemon , the telnet daemon , and the rsh daemon  are the same as those in the first embodiment.","In the similar manner to the SSH daemon  in the first embodiment, when the SSH daemon  operating as an encrypted communication unit receives the SSH connection request, the SSH daemon  decrypts the received SSH connection request and extracts the forwarding destination port specified in the SSH connection request. Then, the SSH daemon  determines the extracted forwarding destination port. If the extracted forwarding destination port is the external port, the SSH daemon  changes the forwarding destination port to the internal port and transfers the connection request to the inet daemon  via the internal port  as the telnet connection request.","A connection-request transferring process by the SSH daemon  is explained below.  is a flowchart of the connection-request transferring process by the SSH daemon  according to the third embodiment.","The processes from Step S (standby state for receiving a connection request) to Step S (extraction of a forwarding destination port) are performed in the similar manner to Steps S to S in the first embodiment.","When the SSH daemon  extracts the forwarding destination port from the SSH connection request, the SSH daemon  determines the port number of the extracted forwarding destination port (Step S). If the port number of the external port  is specified as the forwarding destination port, the SSH daemon  changes the forwarding destination port to the port number of the internal port  (Step S) and transfers the decrypted SSH connection request to the inet daemon  via the internal port  as the telnet connection request (Step S).","On the other hand, if the port number of the internal port  is specified as the forwarding destination port, the SSH daemon  transfers the decrypted SSH connection request to the inet daemon  via the internal port  as the telnet connection request without changing the forwarding destination port at Step S (Step S).",{"@attributes":{"id":"p-0107","num":"0106"},"figref":"FIG. 15"},"The telnet client  establishes a loopback connection to the SSH client  that is the connection destination (127.0.0.1:X) (X is an arbitrary port number), specifying the external port  that is the forwarding destination (192.168.0.2:23) of the connection request (Step S). Then, the SSH client  makes the connection request (the SSH connection request) through the SSH that is the encrypted communication, specifying the external port  that is the forwarding destination (192.168.0.2:23), to the external port  of the SSH daemon  that is the connection destination (192.168.0.2:23) of the image forming apparatus  via the network  (Step S).","When the SSH daemon  receives the SSH connection request from the PC , the SSH daemon  decrypts the SSH connection request and determines the forwarding destination. Then, the SSH daemon  changes the address of the forwarding destination (192.168.0.2:23) indicating the external port  to the address of the forwarding destination (127.0.0.1:23) indicating the internal port  (Step S), and transfers the SSH connection request to the internal port  indicated as the forwarding destination (127.0.0.1:23) as the telnet connection request (Step S). Because the telnet connection request is the connection request to the internal port , the inet daemon  permits the connection (Step S). In this manner, the telnet connection from the telnet client  to the telnet daemon  is permitted, so that the image forming apparatus  can enable a user to always use the telnet service from the PC .","According to the present embodiment, when the forwarding destination of the port forwarding is the external port , the SSH daemon  changes the forwarding destination port to the internal port . Therefore, it is avoided that when the external port  does not accept the connection request, the connection request is denied even if the connection request uses the port forwarding function.","In the first to third embodiments, the connection request is made from the PC  to the telnet daemon  to receive the telnet service; however, in a fourth embodiment, an FTP daemon as a processing unit is used to receive the telnet service.",{"@attributes":{"id":"p-0112","num":"0111"},"figref":"FIG. 16","b":["2","1600","2"]},"In the present embodiment, the image forming apparatus  includes a network control service unit . The network control service unit  includes an external port , the external port , an internal port , an inet daemon , the SSH daemon , the telnet daemon , an FTP daemon (FTPD) , and the rsh daemon . The functions and the configurations of the external port , the SSH daemon , the telnet daemon , and the rsh daemon  are the same as those in the first embodiment.","The external port  is an external port for the FTP daemon  and functions as a communication I\/F for unencrypted communication between inside and outside of the image forming apparatus . The internal port  is an internal port for the FTP daemon  and functions as a communication I\/F for encrypted communication in the image forming apparatus . The FTP daemon  is a daemon that is started by the inet daemon  and performs a file transfer according to the FTP. An FTP connection request indicates a connection request to the FTP daemon .","In the case of connecting the PC  to the FTP daemon  by using the port forwarding function of the SSH, when the SSH connection request specifying the port of the FTP daemon  as the forwarding destination port is made, the SSH daemon  transfers the SSH connection request to the port of the FTP daemon  as the forwarding destination included in the received SSH connection request as the FTP connection request.","More specifically, the SSH daemon  receives the SSH connection request, in which any one of the external port  and the internal port  is specified as the forwarding destination port and which is encrypted, from the PC  via the external port . Then, the SSH daemon  decrypts the received SSH connection request, extracts the forwarding destination port from the decrypted SSH connection request, and transfers the decrypted SSH connection request to the inet daemon  as the FTP connection request via the extracted forwarding destination port.","In the similar manner to the inet daemon  in the first embodiment, the inet daemon  manages and controls each daemon such as the telnet daemon , the FTP daemon , and the rsh daemon , and starts each daemon according to need.","Moreover, the inet daemon , operating as a monitoring unit, always monitors the external port  and the internal port  of the telnet daemon . When the Met daemon  receives the FTP connection request from the external port , the Met daemon  denies the FTP connection request. When the inet daemon  receives the FTP connection request that is transferred by the port forwarding function of the SSH daemon  via the external port , the inet daemon  denies the FTP connection request. On the other hand, when the inet daemon  receives the FTP connection request that is transferred by the port forwarding function of the SSH daemon  via the internal port , the inet daemon  accepts the FTP connection request and transfers it to the FTP daemon . In this manner, it is possible to perform processes, such as various settings and reference and update of the various settings using the FTP service, from the PC  by the encrypted communication with high security by using the port forwarding function of the SSH daemon  and further accepting only the FTP connection request that is transferred by the port forwarding function from the SSH daemon  via the internal port  and connecting to the FTP daemon .","In the present embodiment, the PC  includes an FTP client (FTPC)  instead of the telnet client . The FTP client  is a function unit that provides a client function of a file transfer with the FTP daemon  as a server.","A network connection process by the image forming apparatus  is explained below with reference to .  is a flowchart of a connection-request permission determining process by the inet daemon  according to the fourth embodiment, in which the FTP data transfer is performed in passive mode.","When the inet daemon  is started, the inet daemon  starts the FTP daemon , the telnet daemon , and the rsh daemon  (Step S) to establish a pipe connection to each daemon.","Then, the inet daemon  becomes a standby state for receiving an FTP session request from the FTP client  via the external port  (No at Step S). When the inet daemon  receives the FTP session request via the external port  (Yes at Step S), the inet daemon  sends a connection permission request to the FTP daemon . When the inet daemon  receives a reply to the connection permission request, the inet daemon  sends a connection permission reply to the FTP client  (Step S).","Then, the inet daemon  becomes a standby state for receiving a data transfer request by an SSH port forwarding (SSHPF) from the FTP client  via the external port  (No at Step S). When the inet daemon  receives the data transfer request from the FTP client  via the external port  (Yes at Step S), the inet daemon  sends the data transfer request to the FTP daemon . When the inet daemon  receives a data transfer port number from the FTP daemon , the inet daemon  sends the data transfer port number to the FTP client  (Step S).","Thereafter, in the PC , the SSH client  sends the SSH connection request in which the received port number is specified as the forwarding destination to the SSH daemon . The SSH daemon  transfers the connection request to the inet daemon  as the FTP connection request via the port specified as the forwarding destination.","The inet daemon  becomes a standby state for receiving the FTP connection request (No at Step S). When the inet daemon  receives the FTP connection request transferred from the SSH daemon  by the port forwarding function (Yes at Step S), the inet daemon  determines the port of the received FTP connection request by the method explained in the first embodiment (Step S).","If the port that received the FTP connection request is the internal port , the inet daemon  accepts the received FTP connection request (Step S) and transfers it to the FTP daemon  (Step S). Whereby, the connection of the FTP client  and the FTP daemon  is established.","On the other hand, at Step S, if the port that received the FTP connection request is the external port , the inet daemon  denies the received FTP connection request (Step S) and does not connect the FTP client  to the FTP daemon . Whereby, the FTP connection by the unencrypted communication can be avoided.","A specific example of a process to the FTP connection request is explained below.  is a sequence diagram of an example of permission to the FTP connection request using the SSH port forwarding in the FTP data transfer in passive mode. IP addresses of the image forming apparatus  and the PC  are (192.168.0.2) and (192.168.0.1), respectively. The port number of the external port  is . The connection destination and the forwarding destination of the FTP connection request are specified in the connection request packet in the form of (IP address: port number).","First, the FTP session request is made from the FTP client  via the network , specifying the external port  that is the connection destination (192.168.0.2:21) of the image forming apparatus  (Step S). The inet daemon  transfers the session request to the FTP daemon  (Step S). When the FTP daemon  sends a connection permission to the inet daemon  (Step S), the inet daemon  sends a connection permission reply to the FTP client  (Step S).","When the FTP client  receives the connection permission reply, the FTP client  sends a data transfer request by the SSH port forwarding communication to the external port  (Step S). The inet daemon  transfers the data transfer request to the FTP daemon  (Step S), and the FTP daemon  replies to the inet daemon  the data transfer port number (Step S). Then, the inet daemon  sends the data transfer port number received from the FTP daemon  to the FTP client  (Step S).","Thereafter, the FTP client  establishes a loopback connection to the SSH client  that is the forwarding destination (127.0.0.1:X) (X is an arbitrary port number), specifying the internal port  that is the forwarding destination (127.0.0.1:Y) (Y is an arbitrary port number) of the connection request (Step S). Then, the SSH client  makes the connection request (the SSH connection request) through the SSH that is the encrypted communication, specifying the internal port  that is the forwarding destination (127.0.0.1:Y) (Y is an arbitrary port number), to the external port  that is the connection destination (192.168.0.2:22) (the number \u201c22\u201d indicates the external port ) of the image forming apparatus  via the network  (Step S).","The SSH daemon  decrypts the SSH connection request from the PC  and determines the forwarding destination, and transfers the FTP connection request to the internal port  indicated as the forwarding destination (127.0.0.1:Y) (Step S). Because the FTP connection request is the connection request to the internal port , the inet daemon  permits the connection by the above Steps S and S (Step S).","According to the present embodiment, the encrypted communication is specified as the connection of the data communication with the FTP, so that the image forming apparatus  can prevent data to be transferred from the risk of being eavesdropped or the like.","In the present embodiment, when the external port  is specified as the forwarding destination in the SSH connection request, the SSH daemon  can be configured such that the connection request is transferred after changing the forwarding destination port to the internal port  in the similar manner to the second embodiment.",{"@attributes":{"id":"p-0135","num":"0134"},"figref":["FIG. 19","FIG. 19"],"b":["1","1000","1300","1600","1","1000","1300","1600","80","60","80","1","60","60","60","7"]},"The controller  includes a CPU , a north bridge (NB) , a system memory (MEM-P) , a south bridge (SB) , a local memory (MEM-C) , an application specific integrated circuit (ASIC) , and a hard disk drive (HDD) . The NB  and the ASIC  are connected via an accelerated graphics port (AGP) bus . The MEM-P  includes a ROM and a RAM ","The CPU  controls the entire image forming apparatus . The CPU  includes a chip set including the MEM-P , the NB , and the SB , through which the CPU  is connected to other devices.","The NB  is a bridge for connecting the CPU  to the MEM-P , the SB , and the AGP bus , and includes a memory controller that controls read and write operations to the MEM-P , a PCI master, and an AGP target.","The MEM-P  is a system memory that is used as a memory for storing computer programs and data, a memory for loading computer programs and data, a memory for drawing in a printer, or the like, and includes the ROM and the RAM . The ROM is a read-only memory used as a memory for storing computer programs and data. The RAM is a writable and readable memory used as a memory for loading computer programs and data, a memory for drawing in the printer, or the like.","The SB  is a bridge for connecting the NB , a PCI device, and a peripheral device. The SB  is connected to the NB  via the PCI bus. A network I\/F (not shown) or the like is also connected to the PCI bus.","The ASIC  is an integrated circuit (IC) for image processing including an image-processing hardware element, and functions as a bridge that connects the AGP bus , the PCI bus, the HDD , and the MEM-C  to each other. The ASIC  includes a PCI target, an AGP master, an arbiter (ARB) forming a core of the ASIC , a memory controller that controls the MEM-C , a plurality of direct memory access controllers (DMACs) that rotate image data by a hardware logic and the like, and a PCI unit that performs data transfer with the engine unit  via the PCI bus. A facsimile control unit (FCU) , a universal serial bus (USB) , and an institute of electrical and electronics engineers (IEEE) 1394 I\/F  are connected to the ASIC  via the PCI bus. An operation display unit  is directly connected to the ASIC .","The MEM-C  is a local memory used as a copy image buffer and a code buffer. The HDD  is a storage that stores therein image data, computer programs, font data, and forms.","The AGP bus  is a bus I\/F for a graphics accelerator card proposed to speed up a graphic processing. By making a direct access to the MEM-P  at high throughput, a graphics accelerator card speeds up.","An information processing program executed by the image forming apparatus in the above embodiments is embedded in a ROM or the like in advance and is provided.","The information processing program can be provided in such a way that the information processing program is recorded as an installable format file or executable format file in a computer-readable recording medium such as a compact disk read only memory (CD-ROM), a flexible disk (FD), a compact disk recordable (CD-R), and a digital versatile disk (DVD).","The information processing program can be stored in a computer connected to a network such as the Internet and downloaded via the network. Alternatively, the information processing program can be provided or distributed via the network such as the Internet.","A remote-processing program executed by the image forming apparatus in the above embodiments is a module structure including each unit of the network control service unit, such as the SSH daemon, the inet daemon, the telnet daemon, the rsh daemon, and the FTP daemon. As an actual hardware, the CPU reads the remote-processing program from the ROM and executes the remote-processing program. Due to this, each unit is loaded on a main storage device. Thus, the SSH daemon, the inet daemon, the telnet daemon, the rsh daemon, and the FTP daemon are generated on the main storage device.","According to an aspect of the present invention, it is possible to perform remote processes from a client device while development effort is reduced and security is surely improved by a simple method.","Although the invention has been described with respect to specific embodiments for a complete and clear disclosure, the appended claims are not to be thus limited but are to be construed as embodying all modifications and alternative constructions that may occur to one skilled in the art that fairly fall within the basic teaching herein set forth."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0034","num":"0033"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0036","num":"0035"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 12"},{"@attributes":{"id":"p-0038","num":"0037"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0039","num":"0038"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0040","num":"0039"},"figref":"FIG. 15"},{"@attributes":{"id":"p-0041","num":"0040"},"figref":"FIG. 16"},{"@attributes":{"id":"p-0042","num":"0041"},"figref":"FIG. 17"},{"@attributes":{"id":"p-0043","num":"0042"},"figref":"FIG. 18"},{"@attributes":{"id":"p-0044","num":"0043"},"figref":"FIG. 19"}]},"DETDESC":[{},{}]}
