---
title: System and methods providing anti-virus cooperative enforcement
abstract: A system providing methods for anti-virus cooperative enforcement is described. In response to a request from a device for access to protected resources, such as a network or protected data, a determination is made as to whether an anti-virus policy applies to the request for access made by the device. If an anti-virus policy is applicable, information pertaining to virus protection available on the device is collected. The virus protection information that is collected is evaluated to determine whether the device is in compliance with the anti-virus policy. If the device is determined to be in compliance with the anti-virus policy, the device is allowed to access the protected resources.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=06873988&OS=06873988&RS=06873988
owner: Check Point Software Technologies, Inc.
number: 06873988
owner_city: Redwood City
owner_country: US
publication_date: 20020709
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["RELATED APPLICATIONS","COPYRIGHT NOTICE","BACKGROUND OF THE INVENTION","GLOSSARY","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF A PREFERRED EMBODIMENT"],"p":["The present application is related to and claims the benefit of priority of the following commonly-owned provisional application(s): application Ser. No. 60\/372,907, filed Apr. 15, 2002, entitled \u201cSystem and Methods Providing Anti-Virus Cooperative Enforcement\u201d, of which the present application is a non-provisional application thereof. The present application is related to and claims the benefit of priority of the following commonly-owned non-provisional application(s): application Ser. No. 09\/944,057 now pending, filed Aug. 30, 2001, entitled \u201cSystem Providing Internet Access Management with Router-based Policy Enforcement\u201d, of which the present application is a Continuation-in-part application thereof; and application Ser. No. 10\/159,820 now pending, filed May 31, 2002, entitled \u201cSystem and Methodology for Security Policy Arbitration\u201d, of which the present application is a Continuation-in-part application thereof. The disclosures of each of the foregoing applications are hereby incorporated by reference in their entirety, including any appendices or attachments thereof, for all purposes.","A portion of the disclosure of this patent document contains material which is subject to copyright protection. The copyright owner has no objection to the facsimile reproduction by anyone of the patent document or the patent disclosure as it appears in the Patent and Trademark Office patent file or records, but otherwise reserves all copyright rights whatsoever.","1. Field of the Invention","The present invention relates generally to information processing and, more particularly, to systems and methods for cooperative enforcement of anti-virus protections on computer systems connected to one or more networks, such as Local Area Networks (LANs) and Wide Area Networks (WANs), including the Internet.","2. Description of the Background Art","The first computers were largely stand-alone units with no direct connection to other computers or computer networks. Data exchanges between computers were mainly accomplished by exchanging magnetic or optical media such as floppy disks. Over time, more and more computers were connected to each other using Local Area Networks or \u201cLANs\u201d. In both cases, maintaining security and controlling what information a computer user could access was relatively simple because the overall computing environment was limited and clearly defined.","In traditional computing networks, a desktop computer largely remained in a fixed location and was physically connected to a single local network via Ethernet. More recently, however, an increasingly large number of business and individual users are using portable computing devices, such as laptop computers, that are moved frequently and that connect into more than one network. For example, many users now have laptop computers that are plugged into a corporate network during the day and are plugged into a home network during the evening. Computers can be connected to networks at home, at work, and in numerous other locations. Many users also have home computers that are remotely connected to various organizations from time to time through wide area networks (WANs), including the Internet. The number of computing devices, and the number of networks that these devices connect to, has increased dramatically in recent years.","In addition, various types of connections may be utilized to connect to these different networks. A dial-up modem may be used for remote access to an office network. Various types of wireless connectivity, including IEEE (Institute of Electrical and Electronics Engineers) 802.11 and Bluetooth, are also increasingly popular. Wireless networks often have a large number of users that are occasionally connected from time to time. Moreover, connection to these networks is often very easy, as connection does not require a physical link. Wireless and other types of networks are frequently provided in cafes, airports, convention centers, and other public locations to enable mobile computer users to connect to the Internet. Increasingly, users are also using the Internet to remotely connect to a number of different systems and networks. For example, a user may connect his or her home computer to a corporate network through a virtual private network (VPN) which creates a secure session between the home computer and the corporation's network.","As more and more computers are connecting to a number of different networks (including the Internet), a whole new set of challenges face network administrators and individual users alike: previously closed computing environments are now open to a worldwide network of computer systems. Specific challenges, for example, include the following: (1) attacks by perpetrators (hackers) capable of damaging the local computer systems, misusing those systems, or stealing proprietary data and programs; (2) unauthorized access to external data (e.g., pornographic or other inappropriate Web sites); (3) infiltration by viruses and \u201cTrojan horse\u201d programs; and (4) employee abuse of business computer resources for unauthorized personal activities (e.g., accessing on-line games or streaming audio\/video programs).","One mechanism traditionally used to address several of the above challenges is a firewall product. Traditional firewall products guard a boundary (or gateway) between a local network, such as a corporate network, and a larger network, such as the Internet. These products primarily regulate traffic between physical networks by establishing and enforcing rules that regulate access based upon the type of access request, the source requesting access, the connection port to be accessed, and other factors. For example, a firewall may permit access from a specific IP address or range (or zone) of IP addresses, but deny access from other addresses. However, one of the implications of the increasing number of devices occasionally connected to different networks is that traditional corporate firewall technologies are no longer effective. Traditional firewall technology guarding a network boundary does not protect against traffic that does not traverse that boundary. It does not regulate traffic between two devices within the network or two devices outside the network. A corporate firewall provides some degree of protection when a device is connected to that particular corporate network, but it provides no protection when the device is connected to other networks. In addition, a traditional firewall may not protect against intrusions originating from a remote device which is connected to a corporate (or similar) network.","More recently, a security measure that has been utilized by many users is to install a personal firewall (or end point security) product on a computer system to control traffic into and out of the system. An end point security product can regulate all traffic into and out of a particular computer. For example, an end point security product may expressly seek authorization from a user or administrator (or from a policy established by a user or administrator) for each network connection to or from a computing device, including connections initiated from the device and those initiated from external sources. This enables a user or administrator to monitor what applications on a device are accessing the Internet. It also enforces security by obtaining authorization for each Internet or network connection to (or from) the device.","Another protective measure implemented by many users and administrators is to install an anti-virus application on their machines to provide protection against infiltration by viruses and \u201cTrojan horse\u201d programs. An anti-virus application typically includes an engine which has a database or repository of virus information (typically referred to as \u201cvirus signatures\u201d) that enables identification of viruses and other malicious code. At specified intervals the anti-virus engine will scan the computer system to detect any files that match known virus signatures. The anti-virus engine may also analyze new files received, opened, or saved on the computer system in order to bar infiltration by viruses. For example, the anti-virus engine may check e-mail attachments received by the local system. Typically, the anti-virus engine analyzes all files that are to be stored locally before such files are saved to disk in an effort to avoid installation of files containing viruses. Anti-virus programs are currently available from a number of vendors, including Norton (Symantec), McAfee, and Trend Micro. Typically, these vendors of anti-virus programs also provide frequent virus signature updates (usually through provision of a virus-data definition or \u201cDAT\u201d file) as new viruses are discovered. The updated virus information in the DAT file received by a user is added to the local database or repository, enabling identification and avoidance of new viruses.","Although end point security and anti-virus products, when properly used, provide considerable protection to users and administrators of computer systems and networks, several problems remain. One problem is that if a machine connected to a corporate network (e.g., a remote client machine connected through a VPN gateway) is infected with a virus, it may infect other machines on the same network. An infected computer that is connected to a particular network (e.g., a corporate LAN) may put the entire network at risk. For instance, the computer may be infected with a virus that intentionally tries to spread itself to other machines in the network. One machine that is not running the correct anti-virus engine or is not equipped with current virus signature definitions may jeopardize the security of the entire network. Ensuring that machines are running current anti-virus programs is particularly important, as virus issues are very time sensitive. New viruses are frequently released that cannot be identified using older anti-virus engines and definitions. It becomes critical therefore to promptly update anti-virus applications on all machines in a network in a timely fashion before the network is infiltrated by a newly released virus.","Several currently available tools provide functionality for \u201cpushing\u201d program updates, including anti-virus engine and virus signature updates, to client machines. Typically, this is in the nature of a one-time broadcast of new anti-virus engine and\/or virus definition (DAT file) updates. A number of anti-virus products also include functionality that automatically checks for the availability of updates from a vendor website and downloads any such updates to the client device. While these current solutions make updates available, they do not provide any mechanism for centralized enforcement of anti-virus policies. Existing solutions do not ensure that all machines accessing a network have installed and are using current versions of particular anti-virus products, nor do they ensure that two or more machines that are connected together are sufficiently protected against virus infiltration. For example, a Trojan horse routine on a client computer may intentionally deactivate the anti-virus engine on that machine. A user may also intentionally or unintentionally disable virus checking on the machine. Another concern is that these current solutions typically allow client machines to connect to a network before pushing updates to such client machines. These limitations make the network potentially vulnerable to malicious code on a client machine that is connected to the network.","What is needed is a solution that ensures that all machines connected to a server or a network, including client computers that are joining (e.g., remotely connecting to) a network, are using specified anti-virus products to protect against infiltration by viruses. This solution should verify that all machines connected to a network (or each other) are using current releases of both anti-virus engines and virus signature updates to provide appropriate protection to all users. The solution should also bar access to the network to non-compliant systems that are not using current versions of the required anti-virus programs. Ideally, the solution should be easy to use and should facilitate updating anti-virus engines and virus signature definitions on all systems as and when required in an efficient and time-sensitive manner. The present invention fulfills these and other needs.","The following definitions are offered for purposes of illustration, not limitation, in order to assist with understanding the discussion that follows.\n\n","The system of the present invention provides methods for verifying that a device is in compliance with an anti-virus policy before the device is allowed to access protected resources, such as a network or protected data. In response to a request from a device for access to protected resources, a determination is made as to whether or not an anti-virus policy applies to the request for access made by the device. If an anti-virus policy is applicable, information pertaining to virus protection available on the device is collected. The information that is collected about the virus protection (e.g., a virus protection or anti-virus module) available on the device is evaluated to determine whether the device is in compliance with the applicable anti-virus policy or rules. If the device is determined to be in compliance with the anti-virus policy, the device is allowed to access the protected resources.","The system of the present invention includes a client module on a client computer system or device. When the client device requests access to protected resources, the client module invokes a supervisor module referred to as an \u201cintegrity server.\u201d The client module also provides information about the request to the supervisor module. The system also includes an interface module for obtaining information regarding virus protection available on the client device. The supervisor module, when invoked by the client module, requests information about the virus protection available on the client device. This information is collected by the interface module and returned to the supervisor module. The supervisor module evaluates the information to determines whether or not the client device is in compliance with applicable anti-virus rules. If the client device is found to be in compliance with the anti-virus rules, the client device is allowed to access the protected resources.","The following description will focus on the presently-preferred embodiment of the present invention, which is implemented in a desktop application operating in an Internet-connected environment running under a desktop operating system, such as the Microsoft\u00ae Windows operating system running on an IBM-compatible PC. The present invention, however, is not limited to any one particular application or any particular environment. Instead, those skilled in the art will find that the system and methods of the present invention may be advantageously embodied on a variety of different platforms, including Macintosh, Linux, BeOS, Solaris, UNIX, NextStep, FreeBSD, and the like. Therefore, the description of the exemplary embodiments that follows is for purposes of illustration and not limitation.","I. Computer-Based Implementation","A. Basic System Hardware (e.g., for desktop and server computers)","The present invention may be implemented on a conventional or general-purpose computer system, such as an IBM-compatible personal computer (PC) or server computer.  is a very general block diagram of an IBM-compatible system . As shown, system  comprises a central processing unit(s) (CPU) or processor(s)  coupled to a random-access memory (RAM) , a read-only memory (ROM) , a keyboard , a printer , a pointing device , a display or video adapter  connected to a display device , a removable (mass) storage device  (e.g., floppy disk, CD-ROM, CD-R, CD-RW, DVD, or the like), a fixed (mass) storage device  (e.g., hard disk), a communication (COMM) port(s) or interface(s) , a modem , and a network interface card (NIC) or controller  (e.g., Ethernet). Although not shown separately, a real-time system clock is included with the system , in a conventional manner.","CPU  comprises a processor of the Intel Pentium\u00ae family of microprocessors. However, any other suitable processor may be utilized for implementing the present invention. The CPU  communicates with other components of the system via a bi-directional system bus (including any necessary input\/output (I\/O) controller circuitry and other \u201cglue\u201d logic). The bus, which includes address lines for addressing system memory, provides data transfer between and among the various components. Description of Pentium-class microprocessors and their instruction set, bus architecture, and control lines is available from Intel Corporation of Santa Clara, Calif. Random-access memory  serves as the working memory for the CPU . In a typical configuration, RAM of sixty-four megabytes or more is employed. More or less memory may be used without departing from the scope of the present invention. The read-only memory (ROM)  contains the basic input\/output system code (BIOS)\u2014a set of low-level routines in the ROM that application programs and the operating systems can use to interact with the hardware, including reading characters from the keyboard, outputting characters to printers, and so forth.","Mass storage devices ,  provide persistent storage on fixed and removable media, such as magnetic, optical or magnetic-optical storage systems, flash memory, or any other available mass storage technology. The mass storage may be shared on a network, or it may be a dedicated mass storage. As shown in , fixed storage  stores a body of program and data for directing operation of the computer system, including an operating system, user application programs, driver and other support files, as well as other data files of all sorts. Typically, the fixed storage  serves as the main hard disk for the system.","In basic operation, program logic (including that which implements methodology of the present invention described below) is loaded from the removable storage  or fixed storage  into the main (RAM) memory , for execution by the CPU . During operation of the program logic, the system  accepts user input from a keyboard  and pointing device , as well as speech-based input from a voice recognition system (not shown). The keyboard  permits selection of application programs, entry of keyboard-based input or data, and selection and manipulation of individual data objects displayed on the screen or display device . Likewise, the pointing device , such as a mouse, track ball, pen device, or the like, permits selection and manipulation of objects on the display device. In this manner, these input devices support manual user input for any process running on the system.","The computer system  displays text and\/or graphic images and other data on the display device . The video adapter , which is interposed between the display  and the system's bus, drives the display device . The video adapter , which includes video memory accessible to the CPU , provides circuitry that converts pixel data stored in the video memory to a raster signal suitable for use by a cathode ray tube (CRT) raster or liquid crystal display (LCD) monitor. A hard copy of the displayed information, or other information within the system , may be obtained from the printer , or other output device. Printer  may include, for instance, an HP LaserJet\u00ae printer (available from Hewlett-Packard of Palo Alto, Calif.), for creating hard copy images of output of the system.","The system itself communicates with other devices (e.g., other computers) via the network interface card (NIC)  connected to a network (e.g., Ethernet network, Bluetooth wireless network, or the like), and\/or modem  (e.g., 56K baud, ISDN, DSL, or cable modem), examples of which are available from 3Com of Santa Clara, Calif. The system  may also communicate with local occasionally-connected devices (e.g., serial cable-linked devices) via the communication (COMM) interface , which may include a RS-232 serial port, a Universal Serial Bus (USB) interface, or the like. Devices that will be commonly connected locally to the interface  include laptop computers, handheld organizers, digital cameras, and the like.","IBM-compatible personal computers and server computers are available from a variety of vendors. Representative vendors include Dell Computers of Round Rock, Tex., Compaq Computers of Houston, Tex., and IBM of Armonk, N.Y. Other suitable computers include Apple-compatible computers (e.g., Macintosh), which are available from Apple Computer of Cupertino, Calif., and Sun Solaris workstations, which are available from Sun Microsystems of Mountain View, Calif.","B. Basic System Software","Illustrated in , a computer software system  is provided for directing the operation of the computer system . Software system , which is stored in system memory (RAM)  and on fixed storage (e.g., hard disk) , includes a kernel or operating system (OS) . The OS  manages low-level aspects of computer operation, including managing execution of processes, memory allocation, file input and output (I\/O), and device I\/O. One or more application programs, such as client application software or \u201cprograms\u201d  (e.g., ) may be \u201cloaded\u201d (i.e., transferred from fixed storage  into memory ) for execution by the system .","System  includes a graphical user interface (GUI) , for receiving user commands and data in a graphical (e.g., \u201cpoint-and-click\u201d) fashion. These inputs, in turn, may be acted upon by the system  in accordance with instructions from operating system , and\/or client application module(s) . The GUI  also serves to display the results of operation from the OS  and application(s) , whereupon the user may supply additional inputs or terminate the session. Typically, the OS  operates in conjunction with device drivers  (e.g., \u201cWinsock\u201d driver\u2014Windows' implementation of a TCP\/IP stack) and the system BIOS microcode  (i.e., ROM-based microcode), particularly when interfacing with peripheral devices. OS  can be provided by a conventional operating system, such as Microsoft\u00ae Windows 9x, Microsoft\u00ae Windows NT, Microsoft\u00ae Windows 2000, or Microsoft\u00ae Windows XP, all available from Microsoft Corporation of Redmond, Wash. Alternatively, OS  can also be an alternative operating system, such as the previously mentioned operating systems.","The above-described computer hardware and software are presented for purposes of illustrating the basic underlying desktop and server computer components that may be employed for implementing the present invention. For purposes of discussion, the following description will present examples in which it will be assumed that there exists a \u201cserver\u201d (e.g., Web server) that communicates with one or more \u201cclients\u201d (e.g., personal computers such as the above-described system ). The present invention, however, is not limited to any particular environment or device configuration. In particular, a client\/server distinction is not necessary to the invention, but is used to provide a framework for discussion. Instead, the present invention may be implemented in any type of system architecture or processing environment capable of supporting the methodologies of the present invention presented in detail below.","II. Cooperative Anti-Virus Enforcement","A. Overview","The present invention includes a system providing improved methods for ensuring that computer systems and networks are protected against infiltration by viruses and other malicious code. Before a given computer system (e.g., a client computer) is permitted to join a network or access protected resources, a check is made to evaluate the anti-virus engine and virus definitions that are installed and in use on such computer system. For example, when a client computer requests a VPN connection to a gateway server, the system of the present invention determines whether or not a client computer is using an approved anti-virus application. The process of verifying that the client computer is operating a particular anti-virus program also includes automatically verifying that this program is up to date (i.e., neither the anti-virus engine nor the virus definition file are too old). The system and method of the present invention provides for this verification process to be efficiently performed in a manner that does not disrupt users of client computing devices or administrators of corporate networks. The present invention is flexible as it enables different compliance policies or rules to be applied to govern access to a network by different users or groups.","The present invention provides the ability to enforce compliance with virus protection policies or rules. Non-compliant systems that are not using current versions of the required anti-virus programs can be barred from accessing a network until they have installed and activated the required programs. In addition, the approach of the present invention is to provide assistance to non-compliant users to enable them to become compliant, rather than merely denying access to the network. A non-compliant user is informed about the nature of the problem and is assisted in fixing it. For example, a non-compliant user is typically redirected to a server (referred to below as a \u201csandbox server\u201d) at which the user is provided with information about how to remedy the non-compliance. The sandbox server can provide access to the required anti-virus updates or information about where such updates may be obtained. The system also facilitates updating anti-virus engines and virus signatures (i.e., virus definitions or \u201cDAT\u201d files) when required in an efficient and time-sensitive manner. The components of the currently preferred embodiment of the system of the present invention will now be described.","B. System Components and Basic Operations","1. System Environment",{"@attributes":{"id":"P-00056","num":"00056"},"figref":["FIG. 3","FIG. 3"],"b":["300","320","330","324","326","328","340","310","340","342","344","300","350","370","390","370","371","373","375"]},"2. Client Computer","The client computer  represents a personal computer (such as the previously described system ), a computer server, a personal digital assistant, a desktop computer, a laptop computer, a notebook computer, or another type of computing device. The client computer  may connect to various machines and networks from time to time. For purposes of illustrating the operation of the present invention, the following description uses the example of a remote client device (i.e., the client computer ) connecting through a virtual private network (VPN) to a gateway server  containing the protected data . The present invention, however, is not limited to any particular environment or device configuration. In particular, a VPN connection is not necessary to the invention, but is used to provide a framework for discussion. For example, the client computer  may alternatively connect to the gateway server  using a web browser. Also, the gateway server  may be a firewall, a VPN concentrator, a network router or switch, a web server, an ftp server, a file server, or the like. In addition, various different types of connections, including dial-up modems and various types of wireless connectivity, may be utilized to connect to different organizations. The present invention may be implemented in various environments in which two more computing devices interact with each other.","3. Gateway Client Connection to Gateway Server","The gateway client  serves as an interface to one or more gateway servers enabling the client computer  to remotely access a server or network. For instance, the gateway client  may be a VPN client installed on the client computer  for connection to a virtual private network (VPN). A user may utilize a VPN to connect the client computer  to his or her employer's network\/remote server(s) over the Internet. Although the gateway client  is installed on the client computer  in this exemplary embodiment, the gateway client may alternatively be installed on a separate machine. For example, a VPN software client (e.g., Cisco VPN client software) may also be installed on a separate device (e.g., Cisco 3002 VPN hardware client), or on a firewall or router. In each of these situations, the gateway client  is a module that enables the client computer  to establish a connection to another machine or network. In the currently preferred embodiment, the gateway client  includes Cisco VPN Client for Windows, version 3.5.1 from Cisco Systems, Inc. of Santa Clara, Calif.","In response to a user request to establish a connection to a remote network or server, the gateway client  initiates communication with the gateway server . The gateway client  is typically used to connect to information that is protected by (and\/or contained on) the gateway server . The gateway server  includes a module that listens for communications from client devices, such as the gateway client , and performs the tasks necessary for establishment of a session (e.g., a VPN session) for connection of the client computer . The currently preferred embodiment operates in conjunction with VPN 3000 Concentrator Series, which is VPN gateway software also from Cisco Systems. However, the present invention may also be used in conjunction with other VPN client and VPN gateway hardware and software products available from a number of other vendors. Representative vendors of VPN client and VPN gateway products include Check Point Software of Redwood City, Calif., and Intel Corporation of Santa Clara, Calif. The present invention may also be used with various other types of gateway clients and gateway servers, including, for example, web browsers connecting to web servers.","As shown at , the gateway client  (e.g., a VPN client or a web browser) on the client computer  is connected via a network protocol (e.g., IPSEC or HTTP\/HTTPS) to the gateway server . The gateway server  acts as a gateway (e.g., a VPN gateway) to a group of resources or collection of data (e.g., the protected data or resources ) and accepts requests for access to such resources from client machines. As shown, the gateway server  accepts a request for access to the protected data  from the gateway client  on the client computer . The gateway server  typically performs various steps to verify that the client computer  is authorized to access the protected data  (e.g., through user login and supply of a password) and to establish a secure session (e.g., using a Secure Socket Layer (SSL)) with the gateway client . However, the gateway server  is configured so that it will not permit complete access during the session unless it is instructed by a supervisor module, the integrity server , that this access is permissible. Assuming that the user is authorized, a connection is established between the gateway client  and the gateway server . Of particular interest to the present invention, the request for connection to the gateway server  by the gateway client  may also initiate action by the TrueVector service  and the integrity server  as hereinafter described.","4. TrueVector Service Notifies Integrity Server of Connection","The TrueVector\u00ae service or engine  is a module installed on the client computer  that is responsible for handling higher-level security and access rules. For example, the TrueVector service  may apply a rule that allows a connection from a particular application on a particular port of the client computer  to another machine or network. Basic operation of the TrueVector service  for monitoring and controlling access is described in commonly-owned U.S. Pat. No. 5,987,611, entitled \u201cSystem and methodology for managing Internet access on a per application basis for client computers connected to the Internet,\u201d the disclosure of which is hereby incorporated by reference.","The TrueVector service  also includes an integrity agent or client . The integrity agent  of the TrueVector service  communicates with the integrity server  for cooperative anti-virus enforcement as hereinafter described. The integrity agent is a client module on a client device that works in conjunction with a supervisor module (i.e., integrity server ) which is typically installed on another device. The request for access by the gateway client  is reported to or detected by the integrity agent . Detection of requests for access may be implemented in a number of different ways. The gateway client  may notify the integrity agent  of the request for connection. Alternatively, the integrity agent  and\/or the TrueVector service  may notice requests for connection to the gateway server  made from the client computer . When the TrueVector service  learns of the connection, it sends a message or event notification to the integrity server  informing the supervisor module (i.e., the integrity server) of the connection.","5. Integrity Server Retrieves and Sends Policy Applicable to Client","The integrity server  includes several server-side components of the present invention. In the currently preferred embodiment, the integrity server  is preferably installed on a different machine than the gateway server. The integrity server , which supports the methods of the present invention, communicates with a gateway server  to enforce the anti-virus policy that is established by a user or administrator. However, the integrity server  may also be installed on the same machine as the gateway server . It should also be noted that the currently preferred embodiment of the present invention is not itself an anti-virus engine that attempts to detect viruses. Rather, the client-side and server-side components of the present invention communicate with anti-virus applications and endeavor to ensure that these anti-virus applications are appropriately and consistently utilized to deter infiltration of systems and networks. However, the functionality of the present invention may be advantageously incorporated\/embedded as part of an anti-virus application or as part of a gateway server (e.g., a VPN gateway or the like). Thus, those skilled in the art will appreciate that the system and methods described herein may also be used in a number of different configurations for achieving the present invention.","The integrity server  is a supervisor module which ensures that all users accessing a particular system or network comply with specified security policies, including access rights and cooperative anti-virus enforcement. The integrity server  also serves an enforcement role. In the currently preferred embodiment, the integrity server  can advise the gateway server  to deny a request for access to protected resources or allow such request (i.e., permit connection). The rules enforced by the integrity server  may also be changed from time to time by a user or administrator (e.g., in response to certain events, such as a threat from a serious virus that has been released and is \u201cin the wild\u201d). For example, a network administrator may require all users accessing the network to implement a virus definition update (e.g., DAT file) that is targeted at a particular virus. Thus, the administrator may implement a virus-definition update in a manner that is much more efficient than sending a broadcast message to all users informing them of the need to update their virus protection programs.","When the integrity server  receives notice of a connection to gateway server , the integrity server  evaluates whether or not the user making the request (e.g., client computer ) should be permitted to access protected resources (e.g., a private network) under applicable security policies. More particularly, in response to the message received from the TrueVector service , the integrity server  retrieves the appropriate policy specification  applicable to the client computer  from the policy store . Of particular interest to the present invention, the policy specification  that is retrieved includes the anti-virus (AV) policy options . The anti-virus policy options  include policies or rules specifying particular AV applications required to be in place (if any) on the client computer . These anti-virus rules can be assigned in a number of different ways, including per connection, by individual connection, by network location, by user, by group, or by computer. A typical AV rule specifies a minimum DAT file version, a minimum DAT file date and\/or a minimum AV engine version that must be used in order to obtain access to the network or protected data . The policy can also specify that the minimum DAT file date must be within a pre-defined period of time from the current date, the date of the initial session creation, or the date of the current version of the DAT file which is discovered from a specified agent. After retrieving the policy specification  from the policy store , the integrity server  sends the policy specification , including the AV policy options , to the TrueVector service  on the client computer  in response to the message previously sent by the TrueVector service.","6. TrueVector Service Determines if Policy Includes Anti-virus Rules","The TrueVector service  receives the policy specification , stores it locally as the policy , and checks to determine if the policy  includes any anti-virus policies or rules. In other words, the TrueVector service  determines whether this policy  includes a rule requiring an anti-virus application to be utilized on the client computer . If an anti-virus rule is included in the policy , the TrueVector service  calls the anti-virus information provider plug-in (AV plug-in) . In the currently preferred embodiment, the AV plug-in  is implemented as a driver that serves as an interface to anti-virus or virus protection applications of various vendors (e.g., the AV application ) enabling the TrueVector service  to obtain certain information regarding the virus protection module (if any) that is installed and currently operating on the client computer .","7. Anti-virus Information Retrieved Using AV Plug-in","As shown at , the AV plug-in  is an interface module which retrieves version and\/or publication date information from the AV application (or virus protection module)  that is installed and operating on the client computer . As previously described, a virus protection module (e.g., AV application ) typically includes a virus protection or AV engine together with a repository containing virus definition or virus signature information. An anti-virus engine (e.g., AV engine ) can usually be identified by version number and\/or publication date. A vendor may encapsulate an anti-virus engine or virus protection module into several separate products. Nevertheless, the vendor name and version number or date of publication enable the AV engine to be specifically identified. Anti-virus enforcement also depends on virus pattern or signature files (also known as DAT files) which describe pattern characteristics of a collection of viruses. These DAT files are usually distributed by the vendor that published the AV application. Like AV engines, the DAT files can be identified by publication date and\/or by version number. As shown, anti-virus application  includes anti-virus engine  and anti-virus DAT file . The information retrieved by the interface module (i.e., AV plug-in ) usually includes the supplier and version number (or date of publication) of the AV engine  together with the anti-virus DAT file  version number, publication date, and\/or publication time.","8. Anti-virus Information Sent to Integrity Server","The TrueVector service  retrieves this information regarding the virus protection module via the AV plug-in  and sends the information to the integrity server . The integrity agent  of the TrueVector service  communicates with the integrity server  and provides it with evidence that the appropriate anti-virus application is running on the client computer . As shown at , this information can be reported by the integrity agent  by a means separate from the normal connection between the gateway client  and the gateway server  (i.e., made directly to the integrity server ). The information can be presented as an Extensible Mark-up Language (XML) document, a certificate containing an embedded attribute(s), or in another appropriate form. From time to time, the integrity agent  may also update the current anti-virus information and present this updated anti-virus information to the integrity server . This enables the integrity server  to determine whether or not to assign a new session access policy to the client computer  based on the new anti-virus information received from time to time. In the currently preferred embodiment, the integrity agent  on the client computer  does this regularly though a \u201cheartbeat\u201d mechanism as hereinafter described. The integrity server  can also send periodic requests for a heartbeat to each client device (e.g., client computer ) connected to the gateway server . The integrity server  requests each connected computer system to respond with a heartbeat message providing specified information to the integrity server within a specified time period. In the currently preferred embodiment, the heartbeat message sent by the client device in response to the request from the integrity server generally includes information regarding the security policy version, the anti-virus engine provider and version, and the virus definition (DAT) file version and publication date available on the client device. This anti-virus information enables the integrity server to evaluate compliance with the applicable anti-virus policy as hereinafter described.","9. Integrity Server Evaluates Compliance with Anti-virus Rules","The integrity server  checks the anti-virus information received from the TrueVector service  to determine whether the anti-virus application currently in use on the client computer  complies with the requirements of the policy specification . The integrity server generally evaluates whether the installed anti-virus engine  is from an approved supplier, and whether the currently running version of this engine and the currently installed anti-virus DAT file  are within the limits established in the anti-virus policy options  section of the policy specification . In other words, a check is made to determine whether or not the anti-virus engine and virus definitions in use by the client computer  are from an approved supplier and are not out of date (i.e., not too old).","A variety of different approaches may be used for determining whether or not an anti-virus application is out of date. The integrity server  may query the anti-virus vendor's web site to determine the latest version of the AV engine and DAT files. However, this approach requires a different updating mechanism for each anti-virus vendor's application (given that the vendor web sites are usually in different formats). Alternatively, the integrity server can retrieve the date and\/or version information from one or more of the client devices as they connect (i.e., from the integrity agent and TrueVector service on each client device). The integrity server generally selects the latest of the versions or dates on any client device for purposes of determining the latest version of such anti-virus programs. A user or administrator can also designate a specific agent to collect current version information. The integrity server can then consult the specified agent to determine the current version. As many client devices (including one operated by the system administrator) are configured to retrieve the anti-virus updates from the anti-virus vendors frequently (every few minutes or every day for example), this is an effective approach for determining the most current versions of the anti-virus applications that are available. The integrity server may then evaluate compliance based upon comparing the version then in use on a particular computer system with the most current version determined as described above.","After the integrity server  has evaluated compliance with anti-virus policies or rules, it notifies the gateway server about whether to permit or restrict access by this particular client device. The gateway server may then decide how much access to permit by this particular client device (i.e., the gateway server  assigns an access policy to the connection\/session between the gateway server  and the client computer ) based upon the notification from the integrity server . The integrity server may subsequently reevaluate the decision to permit access (and possibly restrict one or more client devices) at a defined frequency interval, when a user or administrator declares or repeals a virus emergency (or virus alert response), or when other significant events occur.","In the currently preferred embodiment, the integrity server  includes a user interface (not shown) that allows a system administrator or user to declare a \u201cvirus emergency\u201d or \u201cvirus alert response\u201d situation. Typically, the date and time of a virus emergency is established by a system administrator. The status of \u201cvirus emergency\u201d in the integrity server generally imposes the requirement that all users (i.e., connected client devices) must have anti-virus engine(s) and\/or DAT file(s) that are current or newer than the date and time of the given emergency. All clients (e.g., client computer ) that are currently connected to the gateway server  are automatically reevaluated for compliance with this emergency rule and access may be restricted based upon their new compliance status. When the virus emergency is deactivated, the emergency requirement is removed and the normal requirement remains in effect. All clients that are connected when the virus emergency is deactivated are again reevaluated for compliance, and may or may not be restricted from access depending on the new compliance status.","10. Integrity Server Advises Gateway Server Whether to Permit Access","If the client computer  is in compliance with the policy specification  (including anti-virus policy options ), the integrity server  sends a message to the gateway server  to permit the gateway client application  to access the protected data or resources . The client computer  may be fully authorized to access the protected data  or may be provided with more restricted access. If a client (e.g., client computer ) is in compliance, a non-restrictive policy is usually assigned to such client. However, if the client is out of compliance, a restrictive policy is generally applied. The gateway server  may include one or more predefined policies that define what access is to be afforded to non-compliant clients. Access policies may be tailored for particular clients or groups and applied by the gateway server. In the currently preferred embodiment, a restrictive policy is usually applied to prevent access through the gateway to any resource except a \u201csandbox\u201d server (not shown at FIG. ). Depending on the type of gateway, this restriction can be based on the IP addresses that can be accessed or based on a web URL pattern (if a web server) or subdirectory. The integrity server may also instruct the gateway server to change the access policy to be applied to a particular session from time to time (e.g., to restrict a client determined to no longer be in compliance with anti-virus requirements).","11. Non-compliant Client Redirected to Sandbox Server","The \u201csandbox\u201d server (not shown) is a server that informs the user of a client device about non-compliance issues (e.g., non-compliance with anti-virus requirements) and assists the user in remedying the non-compliance. For example, the sandbox server may provide the user with access to updates of the anti-virus application or information on how to obtain such updates. In the currently preferred embodiment, the sandbox server is implemented as a web server. A user that is non-compliant is redirected to this web server, which informs the user of the non-compliance and provides information about how to go about updating the anti-virus application.","C. Handling a Request for Access to Protected Data or Resources","To further illustrate the operations of the present invention, the specific steps involved in handling an exemplary request for access to protected resources using the methods of the present invention will now be described.  comprise a single flowchart illustrating the detailed method steps of the operations of the system of the present invention in handling an exemplary request for access by a client device to protected data or resources. For purposes of illustration,  and the following discussion use the example of a client device (e.g., client computer  as shown at ) remotely connecting to a gateway server (e.g., gateway server  as shown at ) in order to access protected data or a protected network (e.g., the protected data ) served by the gateway server. The present invention, however, is not limited to any particular environment or device configuration. In particular, a remote connection to a server or network is not necessary to the invention, but is used to provide a framework for discussion. The method steps described below may be implemented using computer-executable instructions, for directing operation of a device under processor control. The computer-executable instructions may be stored on a computer-readable medium, such as CD, DVD, flash memory, or the like. The computer-executable instructions may also be stored as a set of downloadable computer-executable instructions, for example, for downloading and installation from an Internet location (e.g., Web server).","The method  begins at step  when a gateway client on a client device connects to a gateway server via a network protocol (e.g., IPSEC or HTTP\/HTTPS) in an attempt to access data or resources (e.g., a network) protected by the gateway server. For example, a client device may use VPN client software to connect to VPN gateway software on the server. The gateway server accepts the connection from the client device. At step , the gateway client on the client device notifies (or is noticed by) the integrity agent of the TrueVector service that a connection to the gateway server has been created. The function providing notification to the integrity agent is described in more detail below. Alternatively, the integrity agent or TrueVector service may notice connection requests made by the gateway client to the gateway server.","When the TrueVector service learns of the connection to the gateway server, at step  the TrueVector service sends a message to the integrity server associated with this gateway server informing the integrity server about the connection. As previously described, the integrity server may be on the same machine as the gateway server or on a separate machine. When the TrueVector service notifies the integrity server of the connection to the gateway server, the integrity server commences the process of evaluating whether or not the client device should be allowed to access the protected data or resources. The integrity server first identifies the policies that are applicable to the client device. At step , the integrity server retrieves a policy specification containing anti-virus policy options applicable to this particular client device from a policy store. It should be noted that a policy specification may be configured not to require any anti-virus enforcement for one or more clients, as desired. The integrity server then sends this policy specification (including the anti-virus policy options) to the TrueVector service on the client device.","When the TrueVector service receives the policy specification from the integrity server, at step  it stores a copy of the policy specification locally and determines whether or not an anti-virus policy or rule is required by the policy specification. The policy specification may, for example, contain an anti-virus rule requiring that a particular anti-virus application is installed and operational on the client device. If an anti-virus rule is required, at step , the TrueVector service calls the anti-virus information provider plug-in (AV plug-in) to obtain information about the anti-virus application that is currently in use on the client device. In response, at step  the AV plug-in typically retrieves version (or publication date) information from the currently-installed and running anti-virus engine(s) as well as version and date information from the most recently installed anti-virus DAT file(s) on the client device.","At step , the TrueVector service receives this information from the AV plug-in and sends the information to the integrity server. The information regarding the anti-virus application running on the client device is sent to the integrity server to enable the integrity server to evaluate whether or not the client device is in compliance with the anti-virus rule required by the applicable policy specification. After receipt of this information from the TrueVector service, at step  the integrity server reviews the information about the anti-virus application installed on the client device to determine if such anti-virus application complies with the anti-virus rule of the policy specification. Typically, this involves verifying that the client is using an approved anti-virus application and that the versions of the anti-virus engine and DAT file in use on the client device are not out of date.","If the integrity server determines that the client device is in compliance with the anti-virus rule, at step  the integrity server notifies the gateway server that it may permit access from the client device (i.e., the gateway client initiating the request) to the protected data or resources served by the gateway server. It should be noted that the integrity server may also enforce other access policies or rules (e.g., security policies that are contained in the policy specification) in addition to any applicable anti-virus rule. For example, a policy may require a particular client device to have an operational end point security product and enforce particular access or security policies as a condition to obtaining access to a corporate network. The integrity server may also deny access to the client (or cause access to be denied) if it is not in compliance with these other policies or rules. As previously described, the gateway server may permit full access from a compliant client device to the protected resources or may provide access subject to certain restrictions. The client can now perform authorized activity with the protected resources.","On the other hand, if the integrity server determines that the client device is not in compliance with the applicable anti-virus rule at step , at optional step  the integrity server may cause the client device to be redirected to a sandbox server to address the non-compliance. The role of the sandbox server is to assist the client in correcting the non-compliance. For example, a user of a client device may be informed that access to a network is denied because the anti-virus application on the client device is non-compliant. The sandbox server can be used to inform the user about how to obtain the necessary updates to the anti-virus application to enable the client to obtain access to the network. Exemplary methods, embodied in the Java and C\/C++ programming languages, for implementing the foregoing steps will next be described in detail.","D. Interaction of System Components in Response to Client Connection","The following discussion illustrates the interaction of the components of the system of the present invention in handling an attempt by a client device to access resources protected by a gateway server. As described above, when a gateway client on a client device connects to a gateway server to access protected resources, the gateway client notifies the integrity agent. Alternatively, the integrity agent and\/or the TrueVector service may notice requests for connection to the gateway server made by the gateway client. The following tvIntegrityClientNotification of the currently preferred embodiment provides notification of a change in session status:",{"@attributes":{"id":"P-d0e3797","num":"00002"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"189pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20021:","\/\/","Function: tvIntegrityClientNotification"]},{"entry":["\u20022:","\/\/","\u2003Notifies the Integrity client of a change in session status."]},{"entry":["\u20023:","\/\/","Parameters:"]},{"entry":["\u20024:","\/\/","\u2003ptvNotification: Points to a TV_IC_NOTIFICATION"]},{"entry":["\u20025:","\/\/","\u2003\u2003structure, which contains information about which message"]},{"entry":["\u20026:","\/\/","\u2003\u2003is being sent, and its parameters."]},{"entry":["\u20027:","\/\/","Returns:"]},{"entry":["\u20028:","\/\/","\u2003\u2003\u2003TRUE if successful, FALSE if an error occurred."]},{"entry":["\u20029:","\/\/","\u2003\u2003\u2003Call GetLast Error(\u2009) for more information."]},{"entry":["10:","\/\/","Comments:"]},{"entry":["11:","\/\/"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["12:","BOOL WINAPI tvIntegrityClientNotification( PTV_IC_NOTI-"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"FICATION ptvNotification )"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["13:","{"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["14:","if (! ( ptvNotification && (ptvNotification->dwSize >="]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"sizeof(TV_IC_NOTIFICATION) ) ) )"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["15:","{"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["16:","SetLastError(ERROR_INVALID_PARAMETER);"]},{"entry":["17:","return FALSE;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["18:","}"]},{"entry":"19:"},{"entry":["20:","switch ( ptvNotification->tvinEventCode )"]},{"entry":["21:","{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["22:","case tvinBeginSession:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["23:","if ( ptvNotification->dwSize != sizeof("]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"TV_IC_NOTIFICATION_BEGIN ) )"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["24:","{"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"154pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["25:","SetLastError(ERROR_INVALID_PARAMETER);"]},{"entry":["26:","return FALSE;"]},{"entry":["27:","}"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["28:","return StartSession( (PTV_IC_NOTIFI-"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"CATION_BEGIN) ptvNotification );"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["29:","break;"]},{"entry":"30:"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["31:","case tvinSessionClosing:"]},{"entry":["32:","case tvinSessionClosed:"]},{"entry":["33:","{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["34:","if ( ptvNotification->dwSize != sizeof("]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"TV_IC_NOTIFICATION_SESSIONCLOSE ) )"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["35:","{"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"154pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["36:","SetLastError(ERROR_INVALID_PARAMETER);"]},{"entry":["37:","break;"]},{"entry":["38:","}"]},{"entry":"39:"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["40:","if ( ptvNotification->tvinEventCode =="]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"tvinSessionClosing )"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"154pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["41:","return SendGatewayNotify( \u201cclosing\u201d, ptvNoti-"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"fication->szSessionId );"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["42:","else"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"154pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["43:","return SendGatewayNotify( \u201cclosed\u201d, ptvNoti-"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"fication->szSessionId );"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["44:",{},{}]},{"entry":["45:",{},"break;"]},{"entry":["46:","}"]},{"entry":"47:"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["48:","default:"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["49:",{},"SetLastError(ERROR_INVALID_PARAMETER);"]},{"entry":["50:",{},"}"]},{"entry":"51:"},{"entry":["52:",{},"return FALSE;"]},{"entry":["53:","}"]},{"entry":"54:"},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}]}},"br":{},"b":["12","20","28","43"]},"If a session is starting and StartSession is invoked, StartSession connects to the integrity sever using a Secure Socket Layer (SSL) connection. Once a connection is open to the integrity server, the following function is used to login to the integrity server and inform the integrity server about the new session:",{"@attributes":{"id":"P-d0e4959","num":"00002"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20021:","bool"]},{"entry":["\u20022:","ISConnection::login ( const CHAR *szLoginInfo \/*= NULL*\/)"]},{"entry":["\u20023:","{"]},{"entry":["\u20024:","\u2003if ( ! InitMonitorClient(\u2009) )"]},{"entry":["\u20025:","\u2003\u2003return FALSE;"]},{"entry":["\u20026:","\u2003BOOL bLoginSent = FALSE;"]},{"entry":["\u20027:","\u2003BOOL bProxyLogin = FALSE;"]},{"entry":["\u20028:","\u2003faststring fstrPassword;"]},{"entry":["\u20029:","\u2003faststring fstrLanguage;"]},{"entry":"10:"},{"entry":["11:","\u2003if ( szLoginInfo && szLoginInfo[0] )"]},{"entry":["12:","\u2003\u2003bProxyLogin = TRUE;"]},{"entry":"13:"},{"entry":["14:","\u2003\/\/ Wait until now to modify the \u201clast connected\u201d time, since"]},{"entry":["15:","\u2003\/\/ m_hContext isn't valid until after InitMonitorClient(\u2009)."]},{"entry":["16:","\/\/ Don't set time connected for proxy login; it's already been set"]},{"entry":["17:","\/\/ on the initial login, and it causes a deadlock since the client"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"(IAgent) is waiting for this call"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["18:","\/\/ to complete, but the Commit below waits for the client to respond"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"to a QEVT_CHG event"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["19:","\u2003if ((m_Socket != INVALID_SOCKET) && !bProxyLogin)"]},{"entry":["20:","\u2003{"]},{"entry":["21:","\u2003\u2003RulesStartModifyEx( m_hContext, m_dwRuleID);"]},{"entry":["22:","\u2003\u2003RulesSetPropDWordEx( m_hContext, m_dwRuleID,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"PROPID_TIME_CONNECTED, GetCurrentDateTime(\u2009) );"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["23:","\u2003\u2003RulesCommitModifyEx( m_hContext, m_dwRuleID);"]},{"entry":["24:","\u2003}"]},{"entry":["25:","\u2003DbgPrintf (ODF_INTEGRITY, \u201cclientThread sending"]},{"entry":[{},"\u2003login msg . . . \\n\u201d);"]},{"entry":"26:"},{"entry":["27:","\u2003MONITOR_LOCK(lock, m_mutex);"]},{"entry":"28:"},{"entry":["29:","\u2003ZL_MessagePad mp (m_SendEndpoint);"]},{"entry":"30:"},{"entry":["31:","\u2003\/\/ Check for secondary login"]},{"entry":["32:","\u2003if ( bProxyLogin )"]},{"entry":["33:","\u2003 {"]},{"entry":["34:","\u2003\u2003xmlstring xmlLogin( szLoginInfo );"]},{"entry":["35:","\u2003\u2003faststring fstrUserName = xmlLogin.xmldecode(\u201cuserName\u201d);"]},{"entry":["36:","\u2003\u2003fstrPassword = xmlLogin.xmldecode(\u201cpassword\u201d);"]},{"entry":["37:","\u2003\u2003setLoginName( fstrUserName );"]},{"entry":["38:","\u2003\u2003fstrLanguage = xmlLogin.xmldecode(\u201clanguage\u201d);"]},{"entry":["39:","\u2003\u2003m_fstrSecondaryLogin = szLoginInfo;"]},{"entry":["40:","\u2003}"]},{"entry":["41:","else"]},{"entry":["42:","\u2003\u2003setLoginName ( \u201c\u201d );"]},{"entry":"43:"},{"entry":["44:","\u2003mp.setUser ( getLoginName( ) );"]},{"entry":"45:"},{"entry":["46:","\u2003ZL_Message *login_msg = mp.newMsg ("]},{"entry":["47:","\u2003\u2003(GetServerVersion( ) >"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"INTEGRITY_MESSAGE_PROTOCOL_VERSION_ZAMBONI) ?"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["48:","\u2003\u2003\u2003INTEGRITY_MESSAGE_PROTOCOL_VERSION :"]},{"entry":["49:","\u2003\u2003\u2003INTEGRITY_MESSAGE_PROTOCOL_VER-"]},{"entry":[{},"\u2003\u2003\u2003SION_ZAMBONI,"]},{"entry":["50:","\u2003\u2003(bProxyLogin)?IA_PROXY_LOGIN:IA_LOGIN,"]},{"entry":["5l:","\u2003\u2003STATUS_OK, m_fstrSessionID.c_str( ),"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"m_fstrSessionKey.c_str( ) );"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["52:","\u2003login_msg->getData( )->password = fstrPassword;"]},{"entry":"53:"},{"entry":"54:"},{"entry":["55:","if (fstrLanguage.empty( ) ) { \/\/ if client didn't specify a language"]},{"entry":"56:"},{"entry":["57:","fstrLanguage ="]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"getLanguageString( LOCALE_SYSTEM_DEFAULT );"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["58:","}"]},{"entry":["59:","\u2003  login_msg->getData( )->language = fstrLanguage;"]},{"entry":"60:"},{"entry":["61:","\u2003  SetMessageClientVersion( login_msg );"]},{"entry":["62:","\u2003  calcRuleFileSignature( );"]},{"entry":["63:","\u2003  SetMessagePolicyInfo( login_msg );"]},{"entry":["64:","\u2003  SetMessageVirusInfo( login_msg );"]},{"entry":"65:"},{"entry":["66:","\u2003  lock.unlock( );"]},{"entry":"67:"},{"entry":["68:","faststring extraXML;"]},{"entry":["69:","extraXML = login_msg->getData( )->zoneReport.GetXML( );"]},{"entry":["70:","extraXML += login_msg->getData ( ) ->virusReport.GetXML( );"]},{"entry":"71:"},{"entry":["72:","try {"]},{"entry":["73:","\u2003\u2003bLoginSent = login_msg->send( extraXML.empty( ) ? NULL :"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":" &extraXML );"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["74:","\u2003\u2003} catch (. . .) {"]},{"entry":["75:","\u2003\u2003\u2003m_ SendEndpoint->unlock( );"]},{"entry":["76:","\u2003\u2003\u2003delete login_msg;"]},{"entry":["77:","\u2003\u2003\u2003return false;"]},{"entry":["78:","\u2003}"]},{"entry":"79:"},{"entry":["80:","\u2003\u2003if ( bLoginSent )"]},{"entry":["81:","\u2003\u2003{"]},{"entry":["82:","\u2003\u2003\u2003MONITOR_LOCK(lock, m_mutex);"]},{"entry":["83:","\u2003\u2003\u2003m_State = IA_SESSION_RESTRICTED;"]},{"entry":["84:","\u2003\u2003\u2003lock.unlock( );"]},{"entry":["85:","\u2003\u2003 }"]},{"entry":["86:","\u2003delete login_msg;"]},{"entry":["87:","\u2003return true;"]},{"entry":["88:","}"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}},"br":{},"b":["4","26","29","46","47","51","52","64","69","70","73","83"]},"In response to the message from the TrueVector service on the client device, the integrity server retrieves the appropriate policy specification from the policy store, including any anti-virus rules contained in this policy, and sends the policy information to the TrueVector service on the client device. The callback function for downloading the policy information to the client device is as follows:",{"@attributes":{"id":"P-d0e6347","num":"00002"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20021:","ZL_CallbackStatus"]},{"entry":["\u20022:","ISConnection::DownloadCallback (ZL_MessageData *m)"]},{"entry":["\u20023:","{"]},{"entry":["\u20024:","\u2003LOG_TRACE(\u201c ( ISS_DOWNLOAD ) called from server. . .\\n\u201d);"]},{"entry":["\u20025:","\u2003LOG_TRACE(\u201cDownloading policy from server\\n\u201d);"]},{"entry":"\u20026:"},{"entry":["\u20027:","char *buf = new char [m->datasize.val + 1];"]},{"entry":"\u20028:"},{"entry":["\u20029:","\u2003SetTVAPIStatus( TV_IC_SESSIONSTATUS_DOWN-"]},{"entry":[{},"\u2003LOADING );"]},{"entry":["10:","\u2003int numBytes = m_RecvEndpoint->receiveData (buf,"]},{"entry":[{},"\u2003m->datasize.val);"]},{"entry":["11:","buf[m->datasize.val] = 0;"]},{"entry":"12:"},{"entry":["13:","\u2003LOG_INFO(\u201creceived %d bytes in download stream\\n\u201d,"]},{"entry":[{},"\u2003numBytes);"]},{"entry":["14:","if (numBytes == m->datasize.val) {"]},{"entry":"15:"},{"entry":["16:","\u2003\u2003try {"]},{"entry":"17:"},{"entry":["18:","\u2003\u2003\u2003if (!ISConfigureBuffer( buf, numBytes )) {"]},{"entry":["19:","\u2003\u2003\u2003\u2002SetTVAPIStatus( TV_IC_SESSIONSTATUS_CON-"]},{"entry":[{},"\u2003\u2003\u2003\u2002NECTED );"]},{"entry":["20:","\u2003\u2003\u2003 }"]},{"entry":["21:","\u2003\u2003\u2003else"]},{"entry":["22:","\u2003\u2003\u2003\u2002SetTVAPIStatus( TV_IC_SESSIONSTATUS_DOWN-"]},{"entry":[{},"\u2003\u2003\u2003\u2002LOADED );"]},{"entry":"23:"},{"entry":["24:","\u2003\u2003} catch (. . .) {"]},{"entry":["25:","\u2003\u2003\u2003\u2002LOG_ALERT(\u201dException: failed to load rules blob\u201d);"]},{"entry":["26:","\u2003\u2003}"]},{"entry":["27:","\u2003\u2003delete buf;"]},{"entry":["28:","\u2003\u2003LOG_INFO (\u201cleaving ISS_DOWNLOAD\\n\u201d);"]},{"entry":["29:","\u2003\u2003return CB_OK;"]},{"entry":["30:","\u2003} else {"]},{"entry":["31:","\u2003\u2003LOG_ALERT(\u201cfile download failed, will retry later. . .\\n\u201d);"]},{"entry":["32:","\u2003\u2003delete buf;"]},{"entry":["33:","\u2003\u2003return CB_ERROR;"]},{"entry":["34:","\u2003}"]},{"entry":["35:","\u2003}"]},{"entry":["36:","}"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}}},"br":{},"b":["10","18"]},"After the policy rules are received on the client device and stored locally, the TrueVector engine checks the policy to determine if the policy includes anti-virus rules. If the policy includes virus protection requirements, the client device is required to return status information about its virus protection module to the integrity server. For example, if the new policy requires the client device to advise the integrity server about the virus protection module in use on the client device, the status message sent to the integrity server must include information about the virus protection module. The following ISConnection::sendHeartbeat function sends a heartbeat message (i.e., a message containing status information) to the integrity server:",{"@attributes":{"id":"P-d0e6892","num":"00002"},"tables":{"@attributes":{"id":"TABLE-US-00004","num":"00004"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20021:","void"]},{"entry":["\u20022:","ISConnection::sendHeartbeat( )"]},{"entry":["\u20023:","{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20024:","\/\/ Now, make a new message and send the stuff"]},{"entry":["\u20025:","MONITOR_LOCK(lock, m_mutex);"]},{"entry":["\u20026:","ZL_MessagePad mp (m_SendEndpoint);"]},{"entry":["\u20027:","mp.setUser ( getLoginName( ) );"]},{"entry":"\u20028:"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20029:","ZL_Message *hb_msg = mp.newMsg ("]},{"entry":["10:","(GetServerVersion( ) > INTEGRITY_MESSAGE_PROTOCOL"]},{"entry":[{},"VERSION_ZAMBONI) ?"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["11:","INTEGRITY_MESSAGE_PROTOCOL_VERSION :"]},{"entry":["12:","INTEGRITY_MESSAGE_PROTOCOL_VERSION"]},{"entry":[{},"ZAMBONI,"]},{"entry":["13:","IA_HEARTBEAT,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"182pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["14:","STATUS_OK, m_fstrSessionID.c_str( ),"]},{"entry":[{},"m_fstrSessionKey.c_str( )\u2003);"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["15:","SetMessagePolicyInfo( hb_msg );"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["16:","SetMessageVirusInfo( hb_msg );"]},{"entry":"17:"},{"entry":["18:","SetZoneEventInfo( hb_msg );"]},{"entry":"19:"},{"entry":["20:","faststring extraXML;"]},{"entry":["21:","extraXML = hb_msg->getData( )->zoneReport.GetXML( );"]},{"entry":["22:","extraXML += hb_msg->getData( )->virusReport.GetXML( );"]},{"entry":"23:"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["24:","..."]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}},"br":{},"b":["9","13","22","22"]},"The AV plug-in is an interface to the applicable anti-virus application installed on the client device. The AV plug-in is used to retrieve information about the AV engine and the currently-installed AV DAT file from a third party AV application. The operations of the AV plug-in are illustrated by the following GetSummary method which retrieves information from a Trend Micro anti-virus application:",{"@attributes":{"id":"P-d0e7361","num":"00002"},"tables":{"@attributes":{"id":"TABLE-US-00005","num":"00005"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char"}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20021:",{}]},{"entry":["2:","HRESULT STDMETHODCALLTYPE CTrendTVPro-"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"\u2003vider::GetSummary( int format, BSTR *pSummary, int detail )"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["3:","{"]},{"entry":["4:","HKEY hKeyRoot = HKEY_LOCAL_MACHINE;"]},{"entry":["5:","faststring installDir;"]},{"entry":["6:","faststring engineVer;"]},{"entry":["7:","faststring datDate;"]},{"entry":["8:","faststring normDatDate;"]},{"entry":["9:","faststring datVer;"]},{"entry":["10:","faststring engineFile;"]},{"entry":["11:","faststring installDirRegPath;"]},{"entry":"12:"},{"entry":["13:","#define PCC7NT_ROOT \u201cSOFTWARE\\\\TrendMicro\\\\PC-"]},{"entry":[{},"cillinNT\\\\7.0\u201d"]},{"entry":["14:","#define PCC795_ROOT \u201cSOFTWARE\\\\TrendMicro\\\\PC-"]},{"entry":[{},"cillin98\\\\7.0\u201d"]},{"entry":"15:"},{"entry":["16:","#define OFSNT_ROOT \u201cSOFTWARE\\\\TrendMicro\\\\PC-"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"\u2003cillinNTCorp\\\\CurrentVersion\u201d"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["17:"," #define OFS95_ROOT"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"\u2003\u201cSOFTWARE\\\\TrendMicro\\\\OfficeScanCorp\\\\CurrentVersion\u201d"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["18:",{}]},{"entry":["19:","char szSystemDir[ MAX_PATH ];"]},{"entry":["20:","GetSystemDirectory(szSystemDir, sizeof(szSystemDir));"]},{"entry":"21:"},{"entry":["22:","if (IsWinNT( ))"]},{"entry":["23:","{"]},{"entry":["24:","\u2003if (RegGetValueStr( hKeyRoot, PCC7NT_ROOT,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"\u2003\u201cApplication Path\u201d, installDir ))"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["25:","\u2003 {"]},{"entry":["26:","\u2003\u2003 installDirRegPath = PCC7NT_ROOT;"]},{"entry":"27:"},{"entry":["28:","\u2003}"]},{"entry":["29:","\u2003else if (RegGetValueStr( hKeyRoot, OFSNT_ROOT,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"\u2003\u201cApplication Path\u201d, installDir ))"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["30:","\u2003{"]},{"entry":["31:","\u2003\u2003installDirRegPath = OFSNT_ROOT;"]},{"entry":"32:"},{"entry":["33:","\u2003}"]},{"entry":"34:"},{"entry":["35:","}"]},{"entry":["36:","else \/\/ Win9x"]},{"entry":["37:","{"]},{"entry":["38:","\u2003if (RegGetValueStr( hKeyRoot, PCC795_ROOT,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"\u2003\u201cApplication Path\u201d, installDir ))"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["39:","\u2003 {"]},{"entry":["40:","\u2003\u2003 installDirRegPath =  PCC795_ROOT;"]},{"entry":"41:"},{"entry":["42:","\u2003}"]},{"entry":["43:","\u2003 else if (RegGetValueStr( hKeyRoot, OFS95_ROOT,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"\u2003\u201cApplication Path\u201d, installDir ))"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["44:","\u2003{"]},{"entry":["45:","\u2003\u2003installDirRegPath = OFS95_ROOT;"]},{"entry":"46:"},{"entry":["47:","\u2003 }"]},{"entry":"48:"},{"entry":["49:","\u2003}"]},{"entry":"50:"},{"entry":["51:","\u2003if (RegGetValueStr( hKeyRoot, installDirRegPath.c_str( ),"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"\u2003\u201cApplication Path\u201d, installDir ))"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["52:","\u2003{"]},{"entry":["53:","\u2003\u2002if (IsWinNT( ))"]},{"entry":["54:","\u2003\u2002{"]},{"entry":["55:","\/\/look for the engine in c:\\windows\\system32\\drivers\\vsapint.sys"]},{"entry":["56:","\/\/first, then in c:\\officescan5\\vsapint.sys."]},{"entry":"57:"},{"entry":["58:","\u2003\u2003engineFile =  szSystemDir;"]},{"entry":["59:","\u2003\u2003engineFile += \u201c\\\\drivers\\\\vsapint.sys\u201d;"]},{"entry":"60:"},{"entry":["61:","\u2003\u2003long ff;"]},{"entry":["62:","\u2003\u2003_finddata_t fd;"]},{"entry":["63:","\u2003\u2003if ((ff = _findfirst( engineFile.c_str( ), &fd )) !=  \u22121)"]},{"entry":["64:","\u2003\u2003{"]},{"entry":["65:","\u2003\u2003\u2002 _findclose ff);"]},{"entry":["66:","\u2003\u2003}"]},{"entry":["67:","\u2003\u2003else"]},{"entry":["68:","\u2003\u2003{"]},{"entry":["69:","\u2003\u2003\u2002engineFile =  installDir;"]},{"entry":["70:","\u2003\u2003\u2002engineFile += \u201c\\\\vsapint.sys\u201d;"]},{"entry":["71:","\u2003\u2003}"]},{"entry":"72:"},{"entry":["73:","\u2003\u2003APPINFO ai;"]},{"entry":["74:","\u2003\u2003ZeroMemory( &ai, sizeof(ai));"]},{"entry":["75:","\u2003\u2003ai.cbSize = sizeof(APPINFO);"]},{"entry":["76:","\u2003\u2003GetAppInfo( engineFile.c_str( ), GAIF_FILEVERSION,"]},{"entry":[{},"\u2003\u2003 &ai );"]},{"entry":"77:"},{"entry":["78:","\u2003\/\/ turn all \u2018-\u2019 in the version into \u2018.\u2019. This is because"]},{"entry":["79:","\u2003\/\/ Trend uses \u2018-\u2019 in the build number, but we want to make the"]},{"entry":["80:","\u2003\/\/ format canonical."]},{"entry":["81:","\u2003\u2003strreplace( ai.fileVersion, sizeof(ai.fileVersion) , \u2018-\u2019, \u2018.\u2019);"]},{"entry":"82:"},{"entry":["83:","\u2003\u2003 engineVer =  ai.fileVersion;"]},{"entry":["84:","\u2003}"]},{"entry":["85:","\u2003 else"]},{"entry":["86:","\u2003{"]},{"entry":["87:","\u2003\u2003char vxdVer[100];"]},{"entry":"88:"},{"entry":["89:","\u2003\u2003engineFile =  installDir;"]},{"entry":["90:","\u2003\u2003engineFile += \u201c\\\\vsapi32.vxd\u201d;"]},{"entry":"91:"},{"entry":["92:","\u2003\u2003if (VXDGetFileVersion( engineFile.c_str( ), vxdVer,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"\u2003sizeof(vxdVer)))"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["93:","\u2003\u2003{"]},{"entry":["94:","\u2003\/\/ turn all \u2018-\u2019 in the version into \u2018.\u2019. This is because"]},{"entry":["95:","\u2003\/\/ Trend uses \u2018-\u2019 in the build number, but we want to make the"]},{"entry":["96:","\u2003\/\/ format canonical."]},{"entry":["97:","\u2003\u2003\u2003strreplace( vxdVer, sizeof(vxdVer), \u2018-\u2019, \u2018.\u2019);"]},{"entry":"98:"},{"entry":["99:","\u2003\u2003\u2003engineVer = vxdVer;"]},{"entry":["100:","\u2003\u2003}"]},{"entry":["101:","\u2003}"]},{"entry":"102:"},{"entry":["103:","\u2003if (engineVer.empty( ))"]},{"entry":["104:","\u2003\u2003 return E_FAIL;"]},{"entry":["105:","}"]},{"entry":["106:","else"]},{"entry":["107:","{"]},{"entry":["108:","\u2003return E_FAIL;"]},{"entry":["109:","}"]},{"entry":"110:"},{"entry":"111:"},{"entry":["112:","char datPath[_MAX_PATH];"]},{"entry":["113:","_makepath( datpath, NULL, installDir.c_str( ),"]},{"entry":[{},"\u201c\\\\LPT$VPN.*\u201d, NULL );"]},{"entry":["114:","_finddata_t fd;"]},{"entry":"115:"},{"entry":["116:","long ff = _findfirst( datPath, &fd );"]},{"entry":["117:","if (ff == \u22121)"]},{"entry":["118:","\u2003     return E_FAIL;"]},{"entry":"119:"},{"entry":["120:","unsigned int latestDatVer = 0;"]},{"entry":["121:","time_t latestDatDate = 0;"]},{"entry":["122:","do {"]},{"entry":["123:","\u2003char ext[_MAX_EXT];"]},{"entry":["124:","\u2003_splitpath( fd.name, NULL, NULL, NULL, ext );"]},{"entry":"125:"},{"entry":["126:","\u2003\u2002\/\/ get the number in the extension."]},{"entry":["127:","\u2003unsigned int ver;"]},{"entry":["128:","\u2003if ((sscanf(ext+1, \u201c%u\u201d, &ver ) != 1)"]},{"entry":["129:","\u2003\u2003\u2003&& (ver > 0)"]},{"entry":["130:","\u2003\u2003\u2003&& (ver <= 999))"]},{"entry":["131:","\u2003\u2003continue; \/\/ if not a real number, skip this file and go"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"\u2003to the next one"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["132:",{}]},{"entry":["133:","\u2003if (ver > latestDatVer) {"]},{"entry":["134:","\u2003\u2003 latestDatVer =  ver;"]},{"entry":["135:","\u2003\u2003  latestDatDate =  fd.time_write;"]},{"entry":["136:","\u2003}"]},{"entry":["137:","} while (!_findnext( ff, &fd ));"]},{"entry":["138:","_findclose(ff);"]},{"entry":"139:"},{"entry":["140:","if (latestDatVer == 0)"]},{"entry":["141:","{"]},{"entry":["142:","\u2003return E_FAIL; \/\/ no dat file found. . ."]},{"entry":["143:","}"]},{"entry":"144:"},{"entry":["145:","\/\/ convert the file's date to a normal date string."]},{"entry":["146:","struct tm *datTM;"]},{"entry":["147:","datTM =  gmtime( &latestDatDate );"]},{"entry":["148:","char szDatDate[100];"]},{"entry":["149:","wsnprintf( szDatDate, sizeof(szDatDate) , \u201c%04d-%02d-%02d"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":" \u2003%02d:%02d:%02d +00:00\u201d,"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["150:","\u2003 (datTM->tm_year + 1900),"]},{"entry":["151:","\u2003 (datTM->tm_mon + 1),"]},{"entry":["152:","\u2003 (datTM->tm_mday),"]},{"entry":["153:","\u2003 datTM->tm_hour,"]},{"entry":["154:","\u2003 datTM->tm_min,"]},{"entry":["155:","\u2003 datTM->tm_sec );"]},{"entry":"156:"},{"entry":["157:","normDatDate = szDatDate;"]},{"entry":"158:"},{"entry":["159:","\/\/ convert the dat version to string"]},{"entry":["160:","char szDatVersion[20];"]},{"entry":["161:","_itoa( latestDatVer, szDatVersion, 10 );"]},{"entry":["162:","datVer =  szDatVersion;"]},{"entry":"163:"},{"entry":["164:","faststring result;"]},{"entry":["165:","result = \u201c<provider type=\\\u201c\u201d;"]},{"entry":["166:","result += m_Name;"]},{"entry":["167:","result += \u201c\\\u201d datDate=\\\u201c\u201d;"]},{"entry":["168:","result += normDatDate;"]},{"entry":["169:","result += \u201c\\\u201d datVersion=\\\u201c\u201d;"]},{"entry":["170:","result += datVer;"]},{"entry":["171:","result += \u201c\\\u201d engineVersion=\\\u201c\u201d;"]},{"entry":["172:","result += engineVer;"]},{"entry":["173:","result += \u201c\\\u201d \/>\u201d;"]},{"entry":"174:"},{"entry":["175:","*pSummary =  resu1t.GetBSTR( );"]},{"entry":["176:","return S_OK;"]},{"entry":["177:","}"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}},"br":{},"b":"2"},"As shown at lines -, a registry is examined to establish where the currently installed anti-virus module is located on the machine. Once the location of the anti-virus module is determined, information about the anti-virus module is obtained as shown at lines -. For a Windows NT implementation, lines - evaluate what file should contain information about the anti-virus module. Lines - determine whether the file can be located. If the file is found, the function GetAppInfo is called as shown at line . GetAppInfo takes a given file name as input and returns version information. In particular, the flag GAIF_FILEVERSION returns the final version of the anti-virus module. In other words, if the file containing version information is found, then the version number stored in that file is obtained and returned. Lines - illustrate a similar process for a Windows 95\/98 implementation. In the case of a Windows 95\/98 implementation, the version information is likely to be included in a different file than for a Windows NT implementation.","Additional information is also collected for return to the calling function as illustrated in portions of the GetSummary method following line . For example, at lines - the version of the latest DAT file is obtained. At lines - the date of the DAT file is determined. At lines - an XML result string is manufactured to contain the data that has been collected. At line , this result is returned back to the calling ISConnection::sendHeartbeat() function.","After information on the anti-virus application is retrieved, the TrueVector engine sends this information to the integrity server using the below portion of the ISConnection::sendHeartbeat() function. The following is an additional portion of the previously described ISConnection::sendHeartbeat() function that handles periodic transmission of information (referred to as \u201cheartbeat\u201d messages) to the integrity server:",{"@attributes":{"id":"P-d0e10004","num":"00002"},"tables":{"@attributes":{"id":"TABLE-US-00006","num":"00006"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20021:","..."]},{"entry":"\u20022:"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20023:","lock.unlock( );"]},{"entry":"\u20024:"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["\u20025:","try {"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"182pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20026:","m_SendEndpoint->lock( );"]},{"entry":["\u20027:","hb_msg->send( extraXML.empty( )? NULL : &extraXML );"]},{"entry":["\u20028:","m_SendEndpoint->unlock( );"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["\u20029:","} catch ( . . . ) {"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"182pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["10:","DbgPrintf(ODF_INTEGRITY, \u201cunable to send heartbeat\\n\u201d);"]},{"entry":["11:","m_SendEndpoint->unlock( );"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"196pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["12:","}"]},{"entry":["13:","delete hb_msg;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["14:","}"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}},"br":{},"b":"7"},"Upon receipt of the above information, the integrity server evaluates the information to determine if the anti-virus application in use on the client device is in compliance with the rules set forth in the anti-virus policy options of the applicable policy specification. The following routine illustrates the process of evaluating the anti-virus information received by the integrity server:",{"@attributes":{"id":"P-d0e10297","num":"00002"},"tables":{"@attributes":{"id":"TABLE-US-00007","num":"00007"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20021:","\/**"]},{"entry":["\u20022:","\u2009* Checks if at least one correct AV Provider version is on the"]},{"entry":["\u20023:","\u2009* client machine, if it is not then an alert is sent if the policy"]},{"entry":["\u20024:","\u2009* allows for alerts to be sent. <p>"]},{"entry":["\u20025:","\u2009* If the <code>Message<\/code> is a login message then the alert is"]},{"entry":["\u20026:","\u2009* not sent but instead a sendHeartbeatMessage is called."]},{"entry":["\u20027:","\u2009* <p>"]},{"entry":["\u20028:","\u2009* If the <code>Message<\/code> is not a login instance and the"]},{"entry":["\u20029:","\u2009* client is not in compliance a flag is set to indicate"]},{"entry":["10:","\u2009* the client is out of compliance"]},{"entry":["11:","\u2009* @param <code>sessioinid<\/code> of the message."]},{"entry":["12:","\u2009* @param <code>cxn<code>, the <code>AgentConnection>\/code>."]},{"entry":["13:","\u2009* @param <code>Message<\/code> with a list of providers,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"optionally. (heartbeat, login, proxylogin)."}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["14:","\u2009* @return <code>true<\/code> if"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"<code>AgentConnection.isAVCompliant(providers)<\/code> or"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["15:","\u2009* <code>false<\/code> if no rules are compliant, or if"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"<code>m<\/code> is null."}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["16:","*\/"]},{"entry":["17:","private ComplianceStatus checkClientAVCompliance(boolean"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"sendMessageOnFail)"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["18:","{"]},{"entry":["19:","\u2003AVPModeler avpm ="]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"PluginManager.getPolicyStudio( ).getAVPModeler( );"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["20:","\u2003AVPanic panic =  avpm.getPanic( );"]},{"entry":"21:"},{"entry":["22:","\u2003ComplianceStatus compliant ="]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"avpm.isCompliant(getLastProviderInfo( ), getPolicy( ) , getUser( ));"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["23:","\u2003if (compliant != ComplianceStatus.COMPLIANT)"]},{"entry":["24:","\u2003{"]},{"entry":["25:","\u2003\/\/ only alert the user if he has not already been alerted"]},{"entry":["26:","\u2003\/\/ and this is a heartbeat message. The correct policy is"]},{"entry":["27:","\u2003\/\/ downloaded by the time the first heartbeat comes thru."]},{"entry":["28:","\u2003if"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"(getPolicy( ).getChecksum(getHeaderVersion( )).equals(mLastPol-"},{"entry":"icyChecksum))"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["29:","\u2003\u2003 {"]},{"entry":["30:","\u2003\u2003\/\/ send message only if one has not already been sent"]},{"entry":["31:","\u2003\u2003\/\/ AND if message never sent before override"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"sendMessageOnFail if reason is AV_PANIC"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["32:","\u2003\u2003 if ((!mSentUserAVAlert) && (sendMessageOnFail ||"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"compliant == ComplianceStatus.AV_PANIC))"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["33:","\u2003\u2003\u2003{"]},{"entry":["34:","\u2003\u2003\u2003String message, reason = \u201cav\u201d;"]},{"entry":["35:","\u2003\u2003\u2003if (compliant == ComplianceStatus.AV._PANIC)"]},{"entry":["36:","\u2003\u2003\u2003{"]},{"entry":["37:","\u2003\u2003\u2003\u2002message = \u201cA Virus Alert has been declared"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":" by your System Administrator. \u201d"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["38:","\u2003\u2003\u2003\u2002+ \u201cPlease update your anti-virus DAT file"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"immediately, \u201d"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["39:","\u2003\u2003\u2003\u2002+ \u201cor contact your System Administrator for"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"assistance.\u201d;"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["40:","\u2003\u2003\u2003\u2002reason = \u201cavemergency\u201d;"]},{"entry":["41:","\u2003\u2003\u2003}"]},{"entry":["42:","\u2003\u2003else if (compliant ==  ComplianceStatus.AV_NOPROVIDER)"]},{"entry":["43:","\u2003\u2003\u2003\u2002{"]},{"entry":["44:","\u2003\u2003\u2003 message = \u201cNo approved anti-virus software has been"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"detected on your computer. \u201d"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["45:","\u2003\u2003\u2003+ \u201cPlease install an approved anti-virus program, \u201d"]},{"entry":["46:","\u2003\u2003\u2003+ \u201cor contact your System Administrator for assistance\u201d;"]},{"entry":["47:","\u2003\u2003\u2003\u2002}"]},{"entry":["48:","\u2003\u2003\u2003\u2002else if (compliant =="]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"ComplianceStatus.AV_ENGINEVERSION)"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["49:","\u2003\u2003\u2003\u2002{"]},{"entry":["50:","\u2003\u2003\u2003message = \u201cYour anti-virus software engine is not up to"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"date. \u201d"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["51:","\u2003\u2003\u2003+ \u201cPlease upgrade your anti-virus engine, \u201d"]},{"entry":["52:","\u2003\u2003\u2003+ \u201cor contact your System Administrator for assistance\u201d;"]},{"entry":["53:","\u2003\u2003\u2003\u2002}"]},{"entry":["54:","\u2003\u2003\u2003\u2002else"]},{"entry":["55:","\u2003\u2003\u2003\u2002{"]},{"entry":["56:","\u2003\u2003\u2003message = \u201cYour anti-virus software data is not up to"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"date. \u201d"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["57:","\u2003\u2003\u2003+ \u201cPlease upgrade your anti-virus DAT file, \u201d"]},{"entry":["58:","\u2003\u2003\u2003+ \u201cor contact your System Administrator for assistance\u201d;"]},{"entry":["59:","\u2003\u2003\u2003\u2002}"]},{"entry":["60:","\u2003\u2003\u2003mSentUserAVAlert = informAgent(getSessionId( ), message,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"reason);"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["61:","\u2003\u2003\u2003\u2002}"]},{"entry":["62:","\u2003\u2003}"]},{"entry":["63:","\u2003\u2003 else"]},{"entry":["64:","\u2003\u2003{"]},{"entry":["65:","\u2003\u2003\u2003\u2002sendHeartbeatMessage( );"]},{"entry":["66:","\u2003\u2003\u2003\u2002return mAVCompliant; \/\/ do not change the compliance"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"state because the policy on the client is different"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["67:","\u2003\u2003}"]},{"entry":"68:"},{"entry":["69:","\u2003\u2003\/\/ remember the status of the last compliance check"]},{"entry":["70:","\u2003\u2003\u2002return compliant;"]},{"entry":["71:","\u2003\u2003}"]},{"entry":"72:"},{"entry":["73:","\u2003\u2003\/\/ remember the status of the last compliance check"]},{"entry":["74:","\u2003 return ComplianceStatus.COMPLIANT;"]},{"entry":["75:","}"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}},"br":{},"b":["17","22"]},"The compliance value which is returned by avpm.isCompliant indicates the compliance status of the client device. The return value can indicate that no anti-virus module is installed on the client device, that the anti-virus engine is outdated, or another status indicating why the client device is not in compliance with the required anti-virus policy. Commencing at line  above is a special case for handling a system wide anti-virus emergency (indicated by an AV_PANIC compliance status). In the currently preferred embodiment, an administrator or user may declare a virus emergency which typically requires all client devices to respond with a heartbeat message providing status information. In the event of a virus emergency, the client is sent a message indicating that a virus emergency has been declared and the client should immediately update its anti-virus DAT file. Other examples of compliance status indications are shown at lines - above. For example, the status ComplianceStatus.AV_NOPROVIDER as shown at line  indicates that no approved anti-virus module is installed on the client device. If this is the case, a message is generated for transmission to the client informing the client that it does not have approved anti-virus software. At line , the message is sent to the client informing the client of the compliance status. The message is then typically displayed in a pop-up dialog box (i.e., the user interface) on the client device. Alternatively, if the client device is in compliance with all anti-virus requirements, then the value ComplianceStatus. Compliant is returned as shown at line .","The isCompliant method called at line of the above checkClientAvCompliance method is as follows:",{"@attributes":{"id":"P-d0e11831","num":"00002"},"tables":{"@attributes":{"id":"TABLE-US-00008","num":"00008"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20021:","\/**"]},{"entry":["\u20022:","* Compares the list of uploads to the rules for <code>p<\/code> and"]},{"entry":["\u20023:","* returnd <code>true<\/code> if at least one of the uploads is"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"compliant."}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20024:","* @return <code>true<\/code> if <code>p<\/code> contains no"]},{"entry":["\u20025:","* rules or if <code>uploades<\/code> has at least one record that is"]},{"entry":["\u20026:","* compliant with one of the rules in <code>p<\/code>."]},{"entry":["\u20027:","*\/"]},{"entry":["\u20028:","public ComplianceStatus isCompliant(List uploads, Policy p. User u)"]},{"entry":["\u20029:","{"]},{"entry":["10:","AVPModeler avpm ="]},{"entry":[{},"pluginManager.getPolicyStudio( ).getAVPModeler( );"]},{"entry":["11:","AVPanic panic =  getPanic( );"]},{"entry":["12:","\/\/ set fail state to lack of AV_PROVIDERS until we know there is at"]},{"entry":["13:","\/\/ least one AVProviderInfo record."]},{"entry":["14:","ComplianceStatus compliant ="]},{"entry":[{},"ComplianceStatus.AV_NOPROVIDER;"]},{"entry":["15:","\/\/ see if we have rules."]},{"entry":["16:","AVPRule rules[\u2009] =  p.getRuleArray( );"]},{"entry":["17:","if (rules ==  null ||  rules.length == 0)"]},{"entry":["18:","return ComplianceStatus.COMPLIANT;"]},{"entry":["19:","\/\/ see if we have active rules"]},{"entry":["20:","boolean hasActiveRules =  false;"]},{"entry":["21:","for (int i =  0 ; i < rules.length ; i++)"]},{"entry":["22:","{"]},{"entry":["23:","if (rules[i].getActive( ))"]},{"entry":["24:","{"]},{"entry":["25:","hasActiveRules =  true;"]},{"entry":["26:","break;"]},{"entry":["27:","}"]},{"entry":["28:","}"]},{"entry":["29:","\/\/ TRIVIAL CASE: if no active rules then all users are compliant."]},{"entry":["30:","if (!hasActiveRules)"]},{"entry":["31:","return ComplianceStatus.COMPLIANT;"]},{"entry":["32:","\/\/ TRIVIAL CASE: if no uploads then this is not compliant."]},{"entry":["33:","if (uploads == null || uploads.size( ) == 0)"]},{"entry":["34:","return ComplianceStatus.AV_NOPROVIDER;"]},{"entry":["35:","\/\/ NON TRIVIAL CASE: now we have 1+ uploads and 1+ rules,"]},{"entry":[{},"match them and see. . ."]},{"entry":["36:","\/\/ start with the uploads and find matching records. . ."]},{"entry":["37:","for (int i = 0 ; i < uploads.size( ) ; i++)"]},{"entry":["38:","{"]},{"entry":["39:","ProviderInfo pu =  (ProviderInfo)uploads.get(i);"]},{"entry":["40:","if (pu instanceof AVProviderInfo)"]},{"entry":["41:","{"]},{"entry":["42:","\/\/ we have had at least one AV Provider to compliance fails to a"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"general state"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["43:","\/\/ case ensures we do not override previously set reasons."]},{"entry":["44:","if (compliant ==  ComplianceStatus.AV_NOPROVIDER)"]},{"entry":["45:","compliant =  ComplianceStatus.AV_NONCOMPLIANT;"]},{"entry":["46:","\/\/ check if the user is a special agent of the rules provider"]},{"entry":["47:","try"]},{"entry":["48:","{"]},{"entry":["49:","avpm.handleSpecialAgent(u, (AVProviderInfo)pu);"]},{"entry":["50:","} catch (Exception e) { }"]},{"entry":["51:","\/\/ Skip this provider if it fails panic test"]},{"entry":["52:","if (panic.getActive( ) &&"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"((AVproviderInfo)pu).getDatDate( ).com-"},{"entry":"pareTo(panic.getMinDATDate( )) < 0)"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["53:","{"]},{"entry":["54:","compliant = ComplianceStatus.AV_PANIC;"]},{"entry":["55:","continue;"]},{"entry":["56:","}"]},{"entry":["57:","for (int j = 0 ; j < rules.length ; j++)"]},{"entry":["58:","{"]},{"entry":["59:","if (pu.getType( ) == rules[j].getType( ) && rules[j].getActive( ))"]},{"entry":["60:","{"]},{"entry":["61:","compliant = rules[j].isCompliant(pu)"]},{"entry":["62:","if (compliant ==  ComplianceStatus.COMPLIANT)"]},{"entry":["63:","{"]},{"entry":["64:","Log.info(LogNLS.AVPMODELER_000,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"new Object[ ] {pu.getType( ).toString( ),"},{"entry":"rules[j].toString( ), p.getName( )});"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["65:","return compliant;"]},{"entry":["66:","}"]},{"entry":["67:","}"]},{"entry":["68:","}"]},{"entry":["69:","}"]},{"entry":["70:","}"]},{"entry":["71:","return compliant;"]},{"entry":["72:","}"]},{"entry":"73:"},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}},"br":{},"b":["8","16","18","19","31","32","34"]},"If the applicable policy contains active anti-virus requirements and uploads are received, then commencing at line  the anti-virus information received from the client device is compared to the anti-virus requirements of the policy. For example, the for loop starting at line  evaluates whether information received in the uploads indicates that the anti-virus module on the client device is compliant with each of the active rules of the anti-virus policy. Immediately before this for loop at lines - is a special case for handling a virus emergency (also referred to as a virus alert response) situation, which is indicated by a status of AV_PANIC. As previously described, an administrator or user may declare a virus emergency requiring a response from connected client devices. In the case of a virus emergency, a check is made as shown at line  to determine if the DAT file is out of date. A DAT file is out of date if it is older than the minimum day required by the administrator or user declaring the emergency.","If the client device is determined to be in compliance with the applicable policy, the integrity server sends a message to the gateway server to permit the client device to access the protected data, resources, or network served by the gateway server. The following function illustrates a session between the integrity server and gateway server for communication of this authorization to the gateway server:",{"@attributes":{"id":"P-d0e13047","num":"00002"},"tables":{"@attributes":{"id":"TABLE-US-00009","num":"00009"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20021:",{}]},{"entry":["\u20022:","\/**"]},{"entry":["\u20023:","\u2002* Accept an IGW session -- sends ISS_IGW_AUTH_OK"]},{"entry":["\u20024:","\u2002*\/"]},{"entry":["\u20025:","public synchronized void acceptIGWSession (String sessionid)"]},{"entry":["\u20026:","{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["\u20027:","SessionState ss = (SessionState)mSessionTable.get(sessionid);"]},{"entry":["\u20028:","if (ss != null)"]},{"entry":["\u20029:","{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["10:","String gatewayid = ss.getGatewayId( );"]},{"entry":["11:","if (gatewayid != null)"]},{"entry":["12:","{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"168pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["13:","IgwConnection gwCxn ="]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"(IgwConnection)mIGWConnections.get(gatewayid);"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["14:","if (gwCxn != null)"]},{"entry":["15:","{"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["16:","gwCxn.acceptSession(ss.getGatewaySessionId( ));"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["17:","}"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["18:","}"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["19:","}"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["20:","}"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}},"br":{},"b":["5","16"]},"While the invention is described in some detail with specific reference to a single-preferred embodiment and certain alternatives, there is no intent to limit the invention to that particular embodiment or those specific alternatives. For instance, those skilled in the art will appreciate that modifications may be made to the preferred embodiment without departing from the teachings of the present invention."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"P-00032","num":"00032"},"figref":"FIG. 1"},{"@attributes":{"id":"P-00033","num":"00033"},"figref":"FIG. 2"},{"@attributes":{"id":"P-00034","num":"00034"},"figref":"FIG. 3"},{"@attributes":{"id":"P-00035","num":"00035"},"figref":"FIGS. 4A-B"}]},"DETDESC":[{},{}]}
