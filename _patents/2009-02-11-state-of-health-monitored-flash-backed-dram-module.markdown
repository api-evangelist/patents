---
title: State of health monitored flash backed dram module
abstract: A device includes: non-volatile memory; a controller in communication with the non-volatile memory, wherein the controller is programmed to move data from a volatile memory to the non-volatile memory upon a loss of power of a primary power source of the volatile memory; and a backup power supply providing temporary power to the controller and the volatile memory upon the loss of power of the primary power source, including: a capacitor bank with an output terminal; a connection to a voltage source that charges the capacitor bank to a normal operating voltage; and a state-of-health monitor that is programmed to generate a failure signal based on a voltage at the output terminal of the capacitor bank.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07990797&OS=07990797&RS=07990797
owner: STEC, Inc.
number: 07990797
owner_city: Santa Ana
owner_country: US
publication_date: 20090211
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","TECHNICAL FIELD","BACKGROUND","SUMMARY","DETAILED DESCRIPTION","Block Diagram Details","Signal Descriptions","States and State Transitions","I2C Interfaces","Debug, Maintenance, Test, and Scan","FPGA Architecture","Power Supply Description","EDL Capacitor Power Supply","SD Data Format","Burn-in Self-Test Operation","Visual Indicators"],"p":["This application is related to U.S. patent application Ser. No. 12\/369,027, filed Feb. 11, 2009; U.S. patent application Ser. No. 12\/369,032, filed Feb. 11, 2009; U.S. patent application Ser. No. 12\/369,046, filed Feb. 11, 2009; U.S. patent application Ser. No. 12\/369,052, filed Feb. 11, 2009; U.S. patent application Ser. No. 12\/369,076, filed Feb. 11, 2009; U.S. patent application Ser. No. 12\/369,079, filed Feb. 11, 2009; and PCT Patent Application No. PCT\/US09\/33755, filed Feb. 11, 2009.","The disclosed subject matter relates to a flash backed dual in-line memory module (DIMM) module.","Digital processing devices, such as, for example, RAID systems sometimes use memory caches, for example, to improve performance of read and write operations. Caches are often implemented using volatile memory. However, if the power source of the volatile memory fails, the data stored in the volatile memory can be lost. In addition, a volatile memory device, such as a DRAM memory module typically requires certain parameters that describe properties of DRAM devices making up the module to be placed in a separate non-volatile memory located on the memory module. One example of this is Serial Presence Detect (SPD). However, the storing of this information can require the addition of an entire non-volatile memory to the volatile memory just for this purpose.","This disclosure relates to a flash backed dual in-line memory module (DIMM) module including a non-volatile memory, a volatile memory, and a controller. During normal operation the DIMM is powered by a primary power source. When the primary power source is interrupted, a backup power source supplies sufficient temporary power to the DIMM so that the controller can transfer data from the volatile memory into the non-volatile memory before power from the backup power source is depleted. When the primary power source becomes available again, the controller transfers the data that was stored in the non-volatile memory back into volatile memory.","In one aspect, a device includes: non-volatile memory; a controller in communication with the non-volatile memory, wherein the controller is programmed to move data from a volatile memory to the non-volatile memory upon a loss of power of a primary power source of the volatile memory; and a backup power supply providing temporary power to the controller and the volatile memory upon the loss of power of the primary power source, including: a capacitor bank with an output terminal; a connection to a voltage source that charges the capacitor bank to a normal operating voltage; and a state-of-health monitor that is programmed to generate a failure signal based on a voltage at the output terminal of the capacitor bank.","In another aspect, a method includes: interrupting the charging, by a voltage source, of a capacitor bank arranged to provide temporary power to a controller programmed to move data from a volatile memory to a non-volatile memory upon a loss of power of a primary power source of the volatile memory and to provide power to a volatile memory upon the loss of power of a primary power source; while the charging is interrupted, applying a predetermined resistance across the output terminal of the capacitor bank for a predetermined period of time; monitoring the output terminal of the capacitor bank during the predetermined period of time to determine whether the voltage at the output terminal falls below a predetermined threshold voltage; and if the voltage at the output terminal falls below the predetermined threshold voltage within the predetermined period of time, generating a failure signal.","Referring to , the described embodiment of the invention is a dual in-line memory module (DIMM)  that includes volatile memory , non-volatile memory , isolation logic , and a controller . DIMM  is connected to a primary power source (not show) to support normal operation and is also connected to a backup power source  (see ). When DIMM  is operating under power supplied by the primary power source, an external system (e.g. a RAID system) stores data in and reads data from volatile memory  through interface . However, when the power from the primary power source  is interrupted, a backup power source supplies sufficient temporary power to DIMM  so that controller  can cause isolation logic  to isolate volatile memory  from the external system and then transfer data from volatile memory  into non-volatile memory  before power from backup power source  is depleted. When the primary power source becomes available again, controller  transfers the data that was stored in non-volatile memory  back into volatile memory  and causes isolation logic  to reconnect volatile memory  to the external system.","Volatile memory  is a DRAM array that includes various DRAM chips, e.g., DRAM chips  and . Non-volatile memory  includes various flash memory devices, e.g., flash devices  and . Due to constraints of DIMM , all the data stored in volatile memory  cannot be moved to non-volatile memory  at one time. One of these constraints is that the flash devices of non-volatile memory  cannot be written into as fast as the DRAM devices of volatile memory  can be read from. To account for this discrepancy, data is moved from volatile memory  to non-volatile memory  one DRAM chip at a time. In addition, during the transfer of data from volatile memory  to non-volatile memory , DRAM chips not being actively transferred are put into a low power state that maintains the data stored in them but consumes less power than a normal operating state. In the DRAM chips of volatile memory , this low power state is self-refresh mode. By putting the DRAM chips that are not being actively transferred into a low power state, module  requires less power during the backup operation than it would otherwise. This allows, for example, for a smaller and less expensive backup power source to be used.",{"@attributes":{"id":"p-0019","num":"0018"},"figref":["FIG. 2","FIG. 2","FIG. 3"],"b":["200","100","170","210","100","100","220","210","210","100","210","300","200"]},"Non-volatile memory  is embedded with the serial presence detect (SPD) information for volatile memory  (e.g., information that describes the size and speed of DRAM chips in volatile memory ). By using non-volatile memory  to store the SPD information of volatile memory , volatile memory  avoids the need for having a separate EEPROM module for storing this information. Avoiding the addition of a separate EEPROM saves costs, reduces the size module , and reduces the number of components required.","DIMM  includes two I2C buses between the external system and controller . I2C busses are typically used to attach low-speed peripherals to various devices when, for example, simplicity and low manufacturing cost are more important than speed. The first I2C bus is for accessing the Serial Presence Detect (SPD) EEPROM (the \u201cSPD I2C bus\u201d). This is defined by the standard JEDEC spec. The second I2C bus is used to access other module  information, such as, status information and state-of-health (SoH) information for controller , non-volatile memory , and backup power source  (the \u201cNVDIMM I2C bus\u201d). The status information can include, for example, current state of the flash memory (written, erased, erasing, defective, etc.); number of bad blocks swapped out; number of spare blocks remaining; total number of download cycles completed; number of ECC errors in last download; number of ECC errors in last restore; status of last download (in progress, completed no errors, completed with errors, etc.); status of last restore (in progress, completed no errors, completed with errors, etc); flash header information. The SoH information can include, for example, current state of the backup power source (charged, discharged, charging, etc.), whether any capacitors making up a backup power source have failed (and if so, which capacitors have failed), and type of backup power source (e.g., capacitor or battery).","Flash memory  provides the nonvolatile storage on the DIMM and is implemented using Secure Digital (SD)\/MultiMediaCard+ (MMC+). Controller  can support various arrangements, for example, four independent SD\/MMC+ interfaces to four SD mass storage devices each operating with 20 Mbyte\/sec bandwidth using a 4-bit data bus or four MMC+ mass storage devices each operation with 40 Mbyte\/sec bandwidth using an 8-bit data bus. One advantage of using SD\/MMC technology is the complexity of managing flash memory is hidden from controller  using a simple, low pin count interface. The flash memories can be implemented in a single device, for example, the SanDisk iNAND, or can be constructed using a discrete SD controller with separate NAND memory devices on the same DIMM. In either case, the SD\/MMC controller is responsible for ECC and bad block management according to the NAND technology used.","Serial Presence Detect (SPD) data is stored in the first 256 bytes of the flash memory attached to the first SD\/MMC+ interface (i.e., flash chip ). The typical write protection mechanism is implemented using flags stored within the flash configuration space. Controller  implements a read-cache, write-through mechanism for the SPD data, where the SPD information can be stored in a cache on controller  (in addition to on a flash chip ). During system power up, controller  fetches the SPD data from the flash memory. Read operations on the SPD I2C interface use the cached data while write operations are immediately written to the flash memory. During the write operation to the flash memory, the SPD I2C interface will ignore any read or write requests.","The status information data is stored in the second 256 bytes of the flash memory attached to the first SD\/MMC+ interface. This interface allows the user to monitor and configure the operation of the non-volatile functions. The region is also used to track the system state during the last power cycle. Controller  implements a read-cache, write-cache mechanism for the configuration data, where the status information can be stored in a cache on controller  (in addition to on a flash chip ). During system power up, the FPGA fetches the data from the flash memory. Read and write operations on the NVDIMM I2C interface use the cache data. Cache data is written back during power-off and power-loss (backup) events.","Controller  is an advanced embedded processor with a custom 133 MHz DDR controller, four custom SD\/MMC+ host interfaces, the SPD I2C interface, and the NVDIMM I2C interface. The microprocessor can be, for example, a soft 32-bit Altera NIOS RISC processor executing firmware from the internal memory instance in the FPGA (programmable read-only memory (PROM) ). The processor controls the operating state of module  data movement between the DDR and SD\/MMC+ interfaces and communication on the SPD and NVDIMM I2C interfaces. The custom DDR interface allows controller  to manipulate the DRAM array on a per byte-lane basis. The interface has individual control of the CKE signals allowing each device in the DRAM array to be controlled. The controller uses the first 8 bytes in each byte lane in the array to set the internal phase alignment of the bus. The four custom SD\/MMC+ interfaces are designed for embedded applications where features such as hot plug are not required. The interface supports 1-bit, 4-bit and 8-bit operation at clock speeds up to 50 MHz. The interfaces also can operate together synchronizing four SD\/MMC+ cards allowing high-bandwidth read and write operations without large amounts of data buffering. For applications requiring the SD\/MMC+ cards to be removed, the FPGA host interface allows the cards to be reordered for situations where the cards are not installed in the correct order.","Volatile Memory  is a DRAM array. Various examples configurations including 8 bits of error correcting code (ECC) for every 64 bits of actual data are shown in the table below. In the example with two Giga bytes of NVDIMM, one rank can be turned on and off depending on current memory requirements. Turning off a rank when it is unneeded saves power. When data (actual data and ECC) is moved from volatile memory  to non-volatile memory , non-volatile memory  stores the actual data and ECC without a distinction between the two stored in the non-volatile memory . When the data is moved back from non-volatile memory  to volatile memory , controller  restores the actual data and ECC back into volatile memory  as is appropriate for the particular DRAM devices being used.",{"@attributes":{"id":"p-0027","num":"0026"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"5","colwidth":"35pt","align":"center"}}],"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}},{"entry":["NVDIMM","DRAM",{},"# of",{}]},{"entry":["Total","Device","Configuration","DRAMs","Ranks"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":{}}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"35pt","align":"char","char":"."}},{"@attributes":{"colname":"5","colwidth":"35pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["256 Mbyte","512 Mbit\u2003","\u200232 Mwords \u00d7 16 bits","5","1"]},{"entry":["512 Mbyte","1 Gbit","\u200264 Mwords \u00d7 16 bits","5","1"]},{"entry":["\u20031 Gbyte","1 Gbit","128 Mwords \u00d7 8 bits","9","1"]},{"entry":["\u20032 Gbyte","1 Gbit","128 Mwords \u00d7 8 bits","18","2"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]}}]}}},"PLL  is a high performance, low skew, PLL-based, zero-delay buffer that distributes a differential input clock signal to the DRAM array. The DDR clock from the edge connector is multiplexed with the DDR2 clock from controller  to prevent PLL  from entering into its low power state and tristating its outputs. In this example design, the selected PLL must operate at the desired system rate as well as a slower DDR controller rate. In general, PLLs bypass themselves and operate as a small-delay buffer at the slowest clock rates.","Control and address signals are re-driven through registers  to the DRAM devices on the following rising clock edge (data access is delayed by one clock). Controller  uses tristates to access the address and control signals. When controller  controls DRAM , the register is isolated from the edge connector using FET bus switches  and controller  can directly drive the register inputs. When the system controls the DRAM array, the FET bus switches  are on and the FPGA tristates its outputs. The CKE signals are treated differently from the other control signals. The switching between the two operational modes is glitchless to ensure DRAM  remains in self-refresh mode. For these signals, FET switches  are used to multiplex between the edge connector (leading to the system) and controller .","The high-bandwidth FET mulitplexers  and  are designed to support high-bandwidth applications such as memory interleaving, bus isolation and low-distortion signal gating. The FET multiplexers  and  isolate module  from the system bus during a power-loss event. The FET multiplexers use a charge pump to elevate the gate voltage of the pass transistor, to provide a low and flat on-state resistance. The low and flat on-state resistance allows for minimal propagation delay and supports rail-to-rail switching on the data input\/output (I\/O) ports. The FET multiplexers also feature low data I\/O capacitance to minimize capacitive loading and signal distortion on the data bus.","Depending on the configuration of module , not all data stored in volatile memory  is backed up to non-volatile memory . Instead, module  can be configured to backup (and later restore) data stored in select portions of volatile memory . Information stored in non-volatile memory is typically key\/directory information used to determine the location of information (e.g., files) in a file system. Key\/directory information is critical information that essentially all users will choose to backup. However, other types of information can also be stored in volatile memory . For example, software program information that does not change (e.g., a \u201c.exe\u201d file) can be stored in volatile memory . Controller  includes registers that allow a user to segment volatile memory . A starting address is stored in one register and an ending address is stored in a second register. All data stored between these two addresses will be backuped and restored. Data stored outside of these addresses will not be backuped\/restored. The values of these registers are controlled through the NVDIMM I2C bus. Users, may choose for example, specify the starting and ending addresses such that only key\/directory information is backedup\/restored. One reason for choosing to only restore key\/directory information is to improve restore time by not wasting time restoring information that does not need to be restored from non-volatile memory  (e.g., a \u201c.exe\u201d has very likely not changed and can be loaded from the host system when required).","Module  can be configured to support various numbers of flash chips (e.g., 1-4) and is its firmware is programmed depending on the selected number. The number of flash chips used can be based on, for example, the size of volatile memory that needs to be backed up and the time in which the backup must occur (e.g., the amount of time backup power can be supplied) or on reaching a desired restore speed (i.e., more flash devices allow for a quicker restore time). For example, for a controller that can support up to four flash chips, the controller would have four busses. Each of the busses can be connected (or not connected) to a flash chip depending on the selected number of flash chips. The selected number of flash chips (e.g., 1, 2, or 4) are connected to the busses and soldered onto a printed circuit board (PCB). For a module  that is designed to accommodate up to four flash chips, if only two flash chips were installed, the remaining space for the not-installed two flash chips remains empty and controller  is programmed to only attempt to communicate with the two installed flash chips. For a constant backup time or restore time, the number of flash chips can be increased in proportion with the size of the volatile memory. Alternatively, the backup time and restore time can be reduced by increasing the number of flash chips.","Module  implements a 72 bit DDR2 memory interface with a 244 pin mini-DIMM connector. The connector signal assignments are defined in JEDEC Standard 21C Page 4.20.14-2, DDR2 Registered Mini-DIMM Design Specification (currently available from www.jdec.org). Signals corresponding to each of the 244 pins are not illustrated in  to avoid making  unreadable.","The NVDIMM_RESET signal initializes controller  and forces the controller to restart its state machine. Controller  is also reset when the standard RESET_IN input is asserted (along with, for example, volatile memory  and register ). When the controller  is held in reset by NVDIMM_RESET, module  operates normally. That is, the when NVDIMM_RESET is asserted, FET switches  are held on thus allowing the system to access the DRAM memory  without further interaction.","The NVDIMM_PG signal reports the state of the power in the user system. When the signal is high, the system power rails are operating within specification. When the signal goes low, power loss is imminent and controller  moves data to flash memory . The system puts all DRAM devices (e.g., -) into self-refresh operation before deasserting NVDIMM_PG if the DRAM device data is to be moved to flash memory (as indicated by the NVCACHE_ENABLE signal). If NVCACHE_ENABLE is low when NVDIMM_PG deasserts, then the data in the DRAM devices is ignored during the power loss event.","The NVCACHE_ENABLE signal reports the existence of cache data in the DRAM devices that should be moved to flash memory if the system power fails. If NVCACHE_ENABLE is high when NVDIMM_PG deasserts, controller  moves the data in the DRAM devices to flash memory. If NVCACHE_ENABLE is low when NVDIMM_PG deasserts, the DRAM contents are ignored and are not stored in flash memory . That last sequence used by the system to shut down normally (e.g., without a power failure in response to a user requesting a shut down). When NVDIMM_PG is low, NVCACHE_ENABLE is ignored by controller  to prevent spurious transitions on the signal from affecting any backup events.","During restore operations, the NVCACHE_ENABLE is used by the system to signal to controller  that flash memory  may be erased. A dirty tag within the flash memory is not cleared until a handshake with NVCACHE_ENABLE is completed. This allows, for example, the system to handle another power loss event during the restore operation.","After the data is moved from flash memory  to DRAM , the DRAM_AVAILABLE signal is asserted indicating the system may access the data. When the system decides flash memory  should be purged (e.g., to prevent data to be restored again after a power loss event), the system deasserts (falling edge) NVCACHE_ENABLE to reset the flash memory. The system waits for NVDIMM_READY to assert before asserting NVCACHE_ENABLE again. The system can continue to use module  before NVDIMM_READY asserts, but the data will not be backed up during a power-loss event.","The CACHE_DIRTY signal indicates that flash memory  contains a data image of DRAM . During the BACKUP state, the CACHE_DIRTY signal indicates the start of the backup process. During POWER UP state, the CACHE_DIRTY indicates that flash memory  contains a backup image. The signal is held high until the NVCACHE_ENABLE signal is deasserted (falling edge), indicating the cache data has been read from DRAM .","The DRAM_AVAILABLE signal indicates when the system can access DRAM . When DRAM_AVAILABLE is low, controller  has control of DRAM . When the signal is high, the system can take the DRAM devices (e.g., -) out of self-refresh and access the data. In the event of a power up with data in flash memory , DRAM_AVAILABLE will remain deasserted until the flash data is moved to DRAM . Once the signal asserts, the system may read and write to DRAM , but cannot assert NVCACHE_ENABLE until module  is ready. A delay between the assertion of DRAM_AVAILABLE and NVCACHE_ENABLE may arise, for example, after a restore operation because non-volatile memory  is being erased or the backup power source is being recharged. The system may choose to only read from (as opposed to reading from and writing to) volatile memory  during this time.","The NVDIMM_READY signal indicates that module  is capable of handling a power-loss event. The signal does not assert until the external power source is in good health and fully charged. When configured to fully erase flash memory , the NVDIMM_READY signal will also not assert until flash memory  is fully initialized to a known state. This feature allows the design to support flash memory devices that cannot support full-speed burst write operations without erasing the flash memory. During normal system operation (idle state), the system cannot assert NVCACHE_ENABLE until NVDIMM_READY is asserted. During backup operation, NVDIMM_READY is deasserted. During restore operation, NDIMM_READY is deasserted. If controller  determines at any time that a power loss event cannot be handled correctly, for example, if the EDL capacitor bank failed a self-test operation, controller  deasserts the NVDIMM_READY to notify the system to move any cache data from the DIMM memory (e.g., to move the data to permanent storage such as a hard drive of the system).","The NVDIMM_SEATED is a pull-up pin on the DIMM pin out that allows the system to detect module . The system also can also detect module  by attempting to read from the NVDIMM I2C interface to see if the I2C slave responds.","The NVDIMM I2C slave interface on controller  provides a full-feature user interface to controller . A user can configure and control controller  as well as access detailed status information using the NVDIMM_SDA and NVDIMM_SCL (signals ).","V3P3_AUX is the auxiliary 3.3V voltage rail that supplies power to the nonvolatile logic during normal system operation. During a power loss condition, module  switches from this supply and operates from VBACK  (the voltage rail that is the power supply used during the backup operation) until controller  turns itself off.","Module  also includes a third I2C interface that is located between controller  and backup power source  (the \u201cbackup power supply I2C interface\u201d). The backup power supply I2C interface allows controller  to communicate with the external backup power supply module using VBACK_SDA and VABACK_SCL. Through the interface, controller  can determine the type of backup power method (e.g., EDL capacitor or battery) as well as determine the state-of-charge and state-of-health for the power supply. Information communicated across the backup power supply I2C interface can be communicated across the NVDIMM I2C interface as part of the SoH information. The backup power supply reset (VBACK_RESET) allows controller  to reset the external backup power supply module. The VCHRG voltage rail supplies power to the EDL capacitor charge or external battery backup power supply module. The voltage rail is nominal 12 volts capable of sourcing 500 mA.","Signals TEST_RX and TEST_TX make up a production test interface that is a 57.6Kbaud serial link. During normal system operation, the test signals are tristated and floating.",{"@attributes":{"id":"p-0047","num":"0046"},"figref":"FIG. 4","b":["100","100","115"]},"The IDLE state is the normal operating state when the system power is applied. If CACHE_DIRTY is already set and NVCACHE_ENABLE is then asserted, CACHE_DIRTY is deasserted. CACHE_DIRTY can be used to confirm the response of an unsuccessful restore operation due to an invalid backup. If NVCACHE_ENABLE is asserted and NVDIMM_READY is asserted, asserting CACHE_DIRTY acknowledges that the controller is now operating in a nonvolatile state (power loss will trigger a backup operation). If NVCACHE_ENABLE deasserts, deassert CACHE_DIRTY to acknowledge that the controller is now operating in volatile state (power loss will not a backup operation). If the backup power source is within voltage specification, asserting NVDIMM_READY indicates the system can support a power failure. If the backup power source fails self-test (or for any other reason controller  cannot complete the backup operation), deasserting NVDIMM_READY signals the system to empty the cache. If CACHE_DIRTY is asserted and NVDIMM_PG deasserts, power has been lost and DRAM memories contain data to be written to the flash memories. In such a case, controller  deasserts DRAM_AVAILABLE and NVDIMM_READY and transitions to the BACKUP state. If CACHE_DIRTY is deasserted and NVDIMM_PG deasserts, the DRAM memories do not contain valid data and the power is turning off normally. In such a case, deassert DRAM_AVAILABLE and NVDIMM_READY (if set) and transition to the POWER DOWN state.","The BACKUP state is responsible for moving data from the DRAM  to the flash memory , while operating on backup power. If the GLITCH bit is not set, controller  waits for CKE to go low to ensure the DRAM memories are placed in self-refresh (the GLITCH bit is set if a backup operation started, but during the operation the power came back up). The on-board regulators switch to source power from the backup power. The DDR bus is disconnected and controller  drives DRAM . Controller  masks off the NVCACHE_ENABLE signal as the system may be powered off. Controller  asserts the DIRTY register and writes the flash configuration page to record the start of the backup process. If a checkpoint exists due to transitioning back from the GLITCH state, controller  restarts the backup from the checkpoint. Otherwise, for each DRAM device of DRAM , take the DRAM device out of self-refresh and write the contents the flash memory . If NDIMM_PG asserts during the memory copy operation, put the active DRAM device back into self-refresh, checkpoint the current backup point and move to the GLITCH state. When all DRAM devices have been copied to flash and the flash has completed its programming cycle, controller  writes the flash configuration with current state information and waits for the programming cycle to complete. Finally, controller  moves module  to the POWER DOWN state.","The POWER DOWN state handles the power down operation to prevent memory module  from restarting prematurely if system power is still available. That is, NVDIMM_PG may indicate a power-loss event, but system power may not have been removed from the memory module. Controller  switches on-board regulators back to normal power if operating on backup power. Controller  tristates the interface between the controller and the multiplexers  and connect the DRAM devices to the DDR bus. If NVDIMM_PG ever asserts, system power is still present so the system is restarted by moving to the POWER UP state.","The glitch state signifies a case in which the system temporarily lost power, but power has returned before the backup operation completed thus allowing the user to retrieve the DRAM contents without using the flash data. The GLITCH state may be entered multiple times during a backup operation. There are two outcomes when in the GLITCH state. Either the power-loss event continues and the data within the DRAM  is backed up to flash  or the data within DRAM  is retrieved and NVCACHE_ENABLE is deasserted. If the power loss is temporary, the memory module must still recharge the EDL capacitor to a known state before asserting NVDIMM_READY and allow the system to rely on the nonvolatile function. To do so, module  records the event by asserting the GLITCH register indicating the power restored before loss of backup power; switches the on-board regulators to source power from the normal system power; tristates controller  and reconnect the DDR bus to the DRAM memories; asserts DRAM_AVAILABLE indicating data is available; unmasks the NVCACHE_ENABLE signal because the system can empty the DRAM devices of data; if NVDIMM_PG is asserted and NVCACHE_ENABLE is deasserted, the partial copy in the flash memories is not required, deasserts CACHE_DIRTY and transitions to the ERASE state; if NVCACHE_ENABLE is asserted and NVDIMM_PG deasserts, power has been lost and DRAM memories contain data to be written to the flash memories, deasserts DRAM_AVAILABLE and transitions to the BACKUP state to resume from the checkpoint.","The wipe state, is for applications where part of the DRAM  is used for run-time, non-volatile purposes (e.g., if a user has decided to store non-key\/directory information in volatile memory  and has chosen not to backup\/restore the non-key\/directory information) In the wipe state controller  can be configured to zero out a single continuous region in the address space. This feature prevents spurious ECC errors within the DRAM memories. Module : disconnects the DDR bus and has controller  drive the DRAM memories; if the wipe function is interrupted by loss of power indicated by NVDIMM_PG deasserting, transitions to the POWER DOWN state; for each DRAM, initializes the configured address space to zero and initializes the associated ECC values; when all DRAMs are completed, transitions to the RESTORE state.","The RESTORE state transfers flash memory  contents back to DRAM . The state is not exited until the system indicates the restored data in the DRAMs has been read, in order to handle power-loss events during this state. A power-loss event during the RESTORE state causes the same image to be restored to the DRAM memory on the next power-on event. Module : If not already done so, disconnects the DDR bus and has controller  drive the DRAM memories; records in the flash configuration memory that the restore operation has started allowing the system to detect a multiple restore event; for each DRAM, copies the contents from the flash memory to the DRAM; when all DRAMs are completed, updates the MODE bytes with the value stored in the flash configuration (system MODE value as the MODE value is read only) and puts that DRAM into self-refresh operation; if the restore function is interrupted by loss of power indicated by NVDIMM_PG deasserting, transitions to the POWER DOWN state; tristates controller  and reconnects the DDR bus to DRAM ; asserts DRAM_AVAILABLE; and when NVCACHE_ENABLE transitions from high to low (falling edge), transitions to the ERASE state to erase the flash contents.","Some flash memory devices require the memory to be erased in order to achieve maximum bandwidth performance during large sequential write operations. In such embodiments, the system at least clears any flags indicating that a partial copy or image exists in the flash memory. The erase operation cannot occur until the system has indicated that any data in DRAM  (that is, the restored data or partially backup data) has be read from DRAM . Module  enters the ERASE state and: if an erase cycle was interrupted by another power loss, restarts the erase cycle at the beginning; tristate controller  and reconnect the DDR bus to the DRAM ; assert DRAM_AVAILABLE; if required, writes the flash configuration to clear any flags indicating a potential backup or a backup image within the flash memory and to mark that an erase cycle has started; if the ERASE register is asserted, erases the flash memory modules; if the erase function is interrupted by loss of power indicated by NVDIMM_PG deasserting, transitions to the POWER DOWN state; updates the flash configuration when the erase cycle completes normally; when erase operation is completed, transitions to IDLE state.","The FPGA controller has two separate slave I2C interfaces that are controlled using the same protocol as the industry standard two-wire I2C serial EEPROM (i.e., the SPD I2C interface and the NVDIMM I2C interface). The base address for the SPD I2C interface is set at the standard 0xA0 while the base address for the NVDIMM I2C interface is set at 0xB0. The 1-bit address offset is applied to both base addresses to allow the two interfaces to connected together if required and inter-operate with other modules. That is, SPD I2C interface and the NVDIMM I2C interface can be implemented as a single physical interface that use different address ranges. Controller  uses the first 512 byte block in the flash memory attached to the first SD\/MMC+ interface. The first half of the block is used for SPD data while the second half of the block is used for flash configuration.  shows the functional operation of a read using the I2C interfaces.  shows the functional operation of a write using the I2C interfaces.","Module  also includes functionality for debugging, maintenance, testing, and scanning. For example, if controller is implemented using an Altera processor, the Altera JTAG UART interface is a fully featured debug and monitoring interface that allows the user to access the firmware functions. Using the Altera tool suite, the firmware can be monitored and\/or overwritten with new firmware for investigation purposes. Using the built-in UART function, the JTAG interface can be used to emulate a serial interface allowing slow-speed custom communication. As well, for larger FPGA configurations, the firmware can incorporate a test user interface to perform diagnostic tests on the DRAM and flash memories for testing purposes. The test user interface is also accessed through UART built into the Altera JTAG interface.","During production test, controller  can be held in reset to allow DRAM  and SD\/MMC+ flash  to be tested. Thus, FET switches  and  on the DDR interface are held in the proper state when controller  is held in reset. At the same time, controller  tristates the SD\/MMC+ interfaces to allow for bed-of-nail testing of the flash memories.","Controller  has a production test control that configures the firmware to run a production test on the DDR interface and SD\/MMC+ interfaces to ensure proper connectivity. Controller  reads and writes to the DDR memory devices to exercise the address, data and control signals of the DDR. As well, controller  passes sufficient data over the SD\/MMC+ command and data buses to exercise all signals. As an end-customer production test, the NVDIMM I2C interface provides a mechanism to control the backup and restore operations and directly access the flash and DDR memory.",{"@attributes":{"id":"p-0059","num":"0058"},"figref":"FIG. 7","b":"110"},"The power supply of module  performs a number of system operations. It generates the voltage rails required for controller  and it isolates module  from the system rails during a power failure.  shows the structure of the power supply.","During normal operation, transistor Q and the diode D directs the system power VDD and V3P3_AUX to the devices on module . V3P3_AUX is an additional edge connector pin that supplies power for the non-standard devices on module . VDD is the standard module power source involving a number of edge connector pins. VMEM is the supply rail powering the module  devices. The V3P3_AUX voltage rail is converted to three additional supply rails required by controller . In general, the V1P2 and the V1P8 voltage rails supply the bulk of the controller power with the V2P5 rail supplying power for the FPGA analog PLLs and the V3P3 supplying power for the FPGA digital I\/O, oscillator and the SD\/MMC+ cards.","Controller  is informed of an imminent power loss either through edge connector signals or through the NVDIMM I2C interface. Once this occurs, controller  turns on Q and Q and turns off transistor Q to source power from the EDL capacitor bank connected to VBACK  and isolating the module from the system power. This power switch is hit-less as, in this case for example, the power supply regulators U, U, U and U are configured not to cause controller  to reset or the DRAM  to lose data. One method of switching between power supply sources is to use diode switching. The diode D prevents, for example, the EDL capacitor voltage from feeding back into the V3P3_AUX supply which may cause the supply to glitch if a transistor is used due to charge sharing between \u201cdecoupling\u201d capacitors on the two rails (with one of the capacitors being the EDL capacitor bank). Depending on the type of power loss event, controller  may be requested to stop using the EDL capacitor bank and to move back to the system power. Again, this power switch is hit-less as to prevent data loss or glitches on the power rails.","Module  also charges and monitors the EDL capacitor bank using the VCHRG supply. This voltage rail is specified to be used for charging purposes only and the module continues to operate normally even when VCHRG is not connected. To improve the power efficiency of the EDL capacitor bank, the minimum input voltage of U and U can be as low as possible. This minimum input specification limits the low end of the EDL capacitor discharge curve as the backup operation must be complete before U or U reach their specification limit. For this reason, the V3P3 regulator U is a step-up regulator from the V1P8 supply allowing the minimum EDL discharge level to be as low as possible.","While cascading regulators affects the efficiency of the power supply, the V3P3 and V2P5 are relatively low power compared to the V1P8 supply. The power loss in cascading the V3P3 regulator U is significantly less than the improved EDL capacitor bank efficiency due to the lower minimum discharge level. A 1V decrease in the minimum EDL capacitor bank voltage is a 10% improvement in total system power while cascading V3P3 regulator U represents a rough 30% drop in efficiency of just the V3P3 supply rail (which is roughly 5 to 10% of the total system power).","The system of  supports four configurations of DRAM devices with different numbers of SD\/MMC+ memory devices. Each configuration has different PCB layouts which allow the power supply design to adjusted to support the different loads. The power supply design can handle 70\u00b0 C. ambient (PCB) temperature with no forced air flow. Components for the power supply design are located on one side of the PCB with a maximum height of 4 mm. The power supply takes no more than 3 inches by 1 inch of board space including any heat spreaders.","The VDD system rail is over-constrained so that the voltage drops across the transistor Q does not cause the VMEM supply to fall outside the downstream device ranges. The voltage drop budget the Q transistor voltage drop has been selected at arbitrary percentage of nominal value, but better performance is desirable.","The regulators shown in the diagram are functional and can be combined into multiple-output regulator devices. All voltage rails have monitors (the \u201cPG\u201d signals) which can be combined with the regulators or in a separate device. The V3P3 monitor is separate because it monitors the V3P3 rail while the V3P3_AUX rail is the power source. The V3P3 regulator does not function if VCHRG is not supplied, but this is not an error as module  must still continue to operate (see ). To increase the energy storage efficiency of the EDL capacitor bank, the minimum allowed input voltage to the regulators is as low as possible. The table below provides additional information for the regulators.",{"@attributes":{"id":"p-0068","num":"0067"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"63pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"70pt","align":"center"}}],"thead":{"row":[{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]},{"entry":[{},"Regulator","Min Input","Max Input","Notes"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"U1 V3P3","1.8 V","VBACK","1, 2, 3"]},{"entry":[{},"U2 V2P5","2.8 V","VBACK","3"]},{"entry":[{},"U3 V1P8","2.8 V","VBACK","3"]},{"entry":[{},"U4 V1P2","2.8 V","VBACK","3"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]},{"entry":[{},"Notes:"]},{"entry":[{},"1. Closest headroom of all the regulators and limits the performance of the EDL capacitor bank."]},{"entry":[{},"2. Low-quiescent current requirement as the regulator idles (capacitance load) in normal operation."]},{"entry":[{},"3. Specifications based on configuration. See the section on voltage rails for specifications. Devices close to current specifications should be investigated as the power consumptions are still estimates."]}]}}}}},"The power transistors are responsible for moving the DRAM devices to the backup power and isolating the backup power from the system power VDD and V3P3_AUX. The capacitor charger U is handles the loss-of-power and prevents the EDL capacitor bank from discharging back through the charger. Transistors Q and Q is an n-channel MOSFETs and is controlled by the FPGA using 3.3V control signals removing the need for high-side drivers. Transistor Q is a p-channel MOSFET directly controlled by the FPGA or n-channel MOSFETs with some high-side drive mechanism (the VCHRG supply or VCAP supplies normally cannot be used unless the module continues to operate without these supplies). The currents listed in the table below have some over-design margin so transistors close to meeting the specification can also be used in this example design. During a power loss event, the transistors only operate until the EDL capacitor bank is discharged (e.g., a maximum of about 2 minutes).",{"@attributes":{"id":"p-0070","num":"0069"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"49pt","align":"center"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"center"}},{"@attributes":{"colname":"5","colwidth":"42pt","align":"center"}}],"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}},{"entry":["Transistor","Max VDS","Max IDD","On Resistance","Notes"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":{}}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"7"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"7pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"21pt","align":"right"}},{"@attributes":{"colname":"3","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"center"}},{"@attributes":{"colname":"5","colwidth":"49pt","align":"center"}},{"@attributes":{"colname":"6","colwidth":"42pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Q1","12","V","2700 mA","0.020 ohm","1"]},{"entry":[{},"Q3","1.8","V","4000 mA","0.009 ohm","2"]},{"entry":[{},"Q4","1.8",{},"\u2002650 mA","0.056 ohm","2"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"6","align":"center","rowsep":"1"}}]},{"entry":[{},"Notes:"]},{"entry":[{},"1. Based on low supply specification of VCAP (2.8 V) and 2% margin in supply voltage."]},{"entry":[{},"2. Based on low supply current specification of supply and 2% margin of supply voltage."]}]}}]}}},"Returning to , EDL capacitor  or backup battery  connected to VBACK  are located external to module  because they are physically large and sensitive to temperature. The long term life of the EDL capacitors and batteries are sensitive to the ambient temperature as well as the operating voltage of the capacitor. For this design, the operating voltage has been chosen such that the capacitorwill tolerant ambient temperatures less than 50\u00b0 C. for at least 10 years. In general, the backup power is located near an air intake or another relatively cool location within the chassis. The backup controller  performs periodic state-of-health checks on the backup power source to determine if the power supply is no longer capable of sustaining and reporting the status through the NVDIMM I2C interface.","Long term lifetime of EDL capacitors show a correlation to temperature and operating voltage. Like aluminum capacitors, the lifetime generally doubles for every 10\u00b0 C. decrease in temperature. Also like aluminum capacitors, the capacitor is exponentially sensitive to working voltage. Maxwell Technologies models the lifetime of the PC10 capacitors in hours using a thermal-nonthermal (T-NT) model:",{"@attributes":{"id":"p-0073","num":"0072"},"maths":{"@attributes":{"id":"MATH-US-00001","num":"00001"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"L","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"mo":["(",")"],"mrow":{"mi":["V","T"],"mo":","}}},"mo":"=","mfrac":{"mrow":[{"mrow":{"mn":"4.8901","mo":"\u2062","mi":"E"},"mo":"-","mn":"06"},{"msup":{"mi":"V","mn":"7.9838"},"mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mi":"exp","mrow":{"mo":["(",")"],"mrow":{"mo":"-","mfrac":{"mn":"9385.8","mi":"T"}}}}]}}}},"br":{}},{"@attributes":{"id":"p-0074","num":"0073"},"tables":{"@attributes":{"id":"TABLE-US-00004","num":"00004"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"84pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"center"}}],"thead":{"row":[{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]},{"entry":[{},{},"Temp","Working","Lifetime"]},{"entry":[{},"Description","\u00b0 C.","Votlage","Years"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":{}}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"84pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"char","char":"."}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Room Temperature","25","2.50","18"]},{"entry":[{},"Ambient (high voltage)","40","2.50","3.9"]},{"entry":[{},"Ambient (reduce voltage)","40","2.20","11"]},{"entry":[{},"Operating (high voltage)","50","2.50","1.6"]},{"entry":[{},"Operating (reduce voltage)","50","1.95","11"]},{"entry":[{},"Server (high voltage)","60","2.50","0.7"]},{"entry":[{},"Server (reduced voltage)","60","1.75","11"]},{"entry":[{},"Server (high voltage)","70","2.50","0.3"]},{"entry":[{},"Server (reduced voltage)","70","1.60","10"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]}]}}]}}},"As shown, the capacitors are operated at low working voltages, which affects the structure of the voltage regulator. In a parallel configuration, the total capacitance is the sum of all the capacitors. However, the discharge current is large over a small voltage swing during use. The voltage regulator requires a boost switch-mode power supply architecture with high-current inductors. In a series configuration, the total capacitance is the reciprocal of the sum of the reciprocal of the capacitance, but the total working voltage has increased. Issues include balancing the operating voltage between capacitances and keeping the number of capacitors reasonable. For the purpose of the design exploration, the 50\u00b0 C. operating temperature has been chosen allowing the design to use 75% of the capacitor working voltage for a 10 year life time. This scenario allows for a 15\u00b0 C. rise in temperature over the common 35\u00b0 C. external ambient temperature for enterprise computers within a server room. The other target environment would be a telecom NEBS standard with a 40\u00b0 C. maximum ambient temperature that may increase to 50\u00b0 C. ambient temperature with a 5\u00b0 C. higher temperature within the equipment frame during short term HVAC failures. The length of the short-term temperature failures are defined to be up to 96 hours each, but not more than 15 days per year.",{"@attributes":{"id":"p-0076","num":"0075"},"figref":["FIG. 9","FIG. 2"],"b":"110"},{"@attributes":{"id":"p-0077","num":"0076"},"tables":{"@attributes":{"id":"TABLE-US-00005","num":"00005"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"63pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"center"}}],"thead":{"row":[{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]},{"entry":[{},{},"Nominal",{},{}]},{"entry":[{},"Supply Name","Voltage","Accuracy","Notes"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"VCHRG","\u2002\u200912 V","+\/\u22125%","1"]},{"entry":[{},"VCAP","11.5 V","+\/\u22121%","2"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]},{"entry":[{},"Notes:"]},{"entry":[{},"1. Can depend the system, for example, in some embodiments a wider supply range may have an advantage."]},{"entry":[{},"2. Nominal float voltage of the capacitor bank. During discharge cycle, regulators continue to operate until the capacitor bank discharges to 2.8 V or lower."]}]}}}}},{"@attributes":{"id":"p-0078","num":"0077"},"tables":{"@attributes":{"id":"TABLE-US-00006","num":"00006"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"63pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"center"}}],"thead":{"row":[{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]},{"entry":[{},"Supply Name","Min Current","Max Current","Notes"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"VCHRG",{},"\u2002500 mA","1"]},{"entry":[{},"VCAP","100 mA","2700 mA","2"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]},{"entry":[{},"Notes:"]},{"entry":[{},"1. Based on an example customer specification that the charger consumes no more than max specification in all cases."]},{"entry":[{},"2. Based on U1 operating at 70% efficiency, U3 operating at 80% efficiency and U4 operating at 90% efficiency, that VCAP is operating at 2.8 V (low end of operating range) with a 2% loss"]}]}}}}},"The described embodiment also includes a state of health monitor for the backup power supply. EDL capacitors have a limited life time that is sensitive to the working voltage, ambient or storage temperature and the number of charge\/discharge cycles (wearing). In some applications, only the working voltage and the ambient temperature are important, for example, if the number of predicted cycles is 100 times less than specification. The life-time of EDL capacitors is based on the capacitance degrading to a specified threshold (in most cases 30% drop from initial capacitance) or the ESR of the capacitance increasing to a specified threshold (depending on the manufacturer a 30% to 100% increase from initial ESR). Given the sensitivity of the EDL capacitor to stress, the controller monitors the state-of-health of the capacitor. The state-of-health monitor U (of ) can be combined with the charger U depending on the implementation. A state of health monitor informs the FPGA if the capacitor bank is charged sufficiently to handle a loss-of-power. In general, the charger U must be able to \u201cturn off\u201d during the test. In, for example, embodiments with a number of capacitors in series, the voltage across each capacitor can be monitored and fed into signals that can be checked over the backup power supply I2C bus. This allows for the identification of a specific capacitor that has failed as well as indication that the backup power source has failed overall.","Measuring the time from power-on (VCHRG power is applied) to when VCAP reaches the fully-charged state provides a method of estimating the health of the capacitor bank. Controller  can report whether module  is capable of handling a power loss event. If the capacitor bank never achieves a full-charge state, the system detects this and declares an error.","To measure capacitance, the capacitor is fully charged. The charger is first turned off and a fixed known load (resistor) is applied to the capacitor bank for a period of time to slightly discharge the capacitor. In general, the load current is small to prevent ESR from affecting the measurement. The measurement method can be as simple as a voltage comparator that triggers an interrupt on controller  if the VCAP supply drops below a fixed voltage. If the interrupt is triggered during the test, the capacitance is too low and the capacitor bank has failed the test. One issue is that the capacitor is discharged partially which must be accounted for in the energy budget as a power loss event could occur right after the self-test.","In order to minimize the cost of the EDL capacitor power supply, the self-test intelligence is located on module . To control the logic in the power supply, an I2C to GPIO expander device is used. Thus, controller  is able to control and monitor signals on the backup power supply module (e.g.,  or ).","As discussed, in some cases, a battery may be selected over an EDL capacitor because batteries have a higher energy density than EDL capacitors and thus require less volume and mass. For instance, a single A123 battery is rated for 2.3 Ah at 3.3V, weighs 70 grams and requires 2 cubic inches. If module  requires 5 Watts for 2 minutes, the required energy is only 0.05 Ah which is over an order of magnitude less than the battery capacity. Most battery chargers for portable laptop computers have all the necessary functions required for the backup power supply. In addition, most of these devices have an integrated I2C interface for monitoring, configuration and control that can be used by module .","In single SD\/MMC+ card operation, the first block of the SD card (bytes  to ) is used for SPD and flash configuration purposes. The remaining blocks in the SD card are used for backup data. During backup operation, the backup data is read from the first DRAM device in a continuous byte stream and written into the single flash memory. The backup controller then repeats the process for the other DRAM devices until backups of all of the other devices are completed. During restore operation, the data is read from the single flash memory in a continuous byte stream and written into the first DRAM device. The backup controller then repeats the process for the other DRAM devices until all the other devices are completed. The backup controller streams read and write data to the flash memory using one single sequential read\/write operation. This mechanism allows the SD card to perform at maximum bandwidth, but has the side effect that the alignment of each DRAM backup image may cross SD card block boundaries if the length of each DRAM backup image is not a multiple of 512 bytes.","For dual SD\/MMC+ card operation, the first block of the SD card (bytes  to ) in slot  is used for SPD and flash configuration purposes. The first block of the other SD card in slot  is not used and is ignored. During backup operation, data is read from the first DRAM device in a continuous byte stream and written to both flash memories at the same time. The data stream is split into two flash write data streams by sending all even order bytes to slot  and all odd order byte to slot . The backup controller then repeats the process for the other devices until all the DRAM devices are completed. During restore operation, data is read from both flash memories which is combined by byte interleaving the data streams to form a single data stream that is written to the first DRAM. The backup controller then repeats the process for the other DRAM devices until all the devices are completed. The backup controller streams read and write data to the flash memory using one single sequential read\/write operation for each SD card. This mechanism allows the SD cards to perform at maximum bandwidth, but has the side effect that the alignment of each DRAM backup image may cross SD card block boundaries if the length of each DRAM backup image is not a multiple of 1 kbytes.","For quad SD\/MMC+ card operation, the first block of the SD card (bytes  to ) in slot  is used for SPD and flash configuration purposes. The first block of the other SD card in slot  is not used and is ignored. During backup operation, data is read from the first DRAM device in a continuous byte stream and written to all flash memories at the same time. The data stream is split into four flash write data streams by sending every 4 bytes to an interface. The backup controller then repeats the process for the other devices until all the DRAM devices are completed. During restore operation, data is read from both flash memories which is combined by byte interleaving the data streams to form a single data stream that is written to the first DRAM. The backup controller then repeats the process for the other DRAM devices until all the devices are completed. The backup controller streams read and write data to the flash memory using one single sequential read\/write operation for each SD card. This mechanism allows the SD cards to perform at maximum bandwidth, but has the side effect that the alignment of each DRAM backup image may cross SD card block boundaries if the length of each DRAM backup image is not a multiple of 2 kbytes.","The table below provides example backup times calculated using a worst case write\/read bandwidth of 20 Mbyte\/sec for each SD\/MMC card and 40 Mbyte\/sec for each MMC+ card. The calculation also includes the worst case SD\/MMC+ write interval for updating the flash configuration.",{"@attributes":{"id":"p-0088","num":"0087"},"tables":{"@attributes":{"id":"TABLE-US-00007","num":"00007"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"4","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"5","colwidth":"56pt","align":"center"}}],"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}},{"entry":[{},{},"One SD\/","Two SD\/",{}]},{"entry":[{},{},"MMC","MMC"]},{"entry":[{},{},"Interface","Interface"]},{"entry":[{},{},"Active","Active","Four MMC +"]},{"entry":["NVDIMM","Total","(20 Mbyte\/","(40 Mbyte\/","Interface Active"]},{"entry":["Size","Data","sec)","sec)","(160 Mbyte\/sec)"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["256 Mbyte","\u2002288 Mbyte","15 sec","\u20028 sec","2 sec"]},{"entry":["512 Mbyte","\u2002576 Mbyte","30 sec","15 sec","4 sec"]},{"entry":["\u20031 Gbyte","1152 Mbyte","58 sec","30 sec","8 sec"]},{"entry":["\u20032 Gbyte","2304 Mbyte","116 sec\u2002","59 sec","16 sec\u2002"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]}}}}},"DIMM  also includes self-test functionality. Self-test can be triggered using the PRODTEST input on the FPGA as well as through the NV I2C interface. The results of the self-test are stored permanently until the flash memory is erased through another self-test sequence. In one example, self test: takes over the DDR interface (FET switches are off); sets the SELFTEST test in progress bit high; fills DRAM memory with 0xA5; fills flash memory with 0x00; turn on progress LED; backups DRAM memory to flash memory; fill DRAM memory with 0x00; restore DRAM memory from flash memory; tests contents of DRAM memory; and, if an error is detected sets an error LED and stores the results in flash. If no error is found, the process loops back to fill the flash memory with 0x00. Self-test methods can be defined by various users of the system of , for example, they can be defined by a customer.","Visual indications on the board allow for diagnosing system problems with memory module particularly when multiple modules  are used within a system. In the following cases, a slow flash of an LED is 0.25 seconds on and 1 second off while a fast flash of an LED is 0.5 seconds on and 0.5 seconds off. The memory module has an LED to indicate the backup operation is occurring. Given that some configurations take multiple minutes to complete the backup operation, an LED indicates to a repair technician that the module  or capacitor bank must not be disturbed after a power-loss event.",{"@attributes":{"id":"p-0091","num":"0090"},"tables":{"@attributes":{"id":"TABLE-US-00008","num":"00008"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"182pt","align":"left"}}],"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}},{"entry":["Red LED","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Off","System power and capacitor power is off or memory module"]},{"entry":[{},"is operating in normal operation (POWER UP or IDLE"]},{"entry":[{},"state)."]},{"entry":[{},"If system power is off, the memory module and\/or the"]},{"entry":[{},"capacitor bank may be disconnected."]},{"entry":["Slow","RESTORE operation (flash to DRAM) operation in progress."]},{"entry":"Flash"},{"entry":["Fast Flash","BACKUP operation (DRAM to flash) operation in progress."]},{"entry":["On","Restore operation completed, waiting for DRAM to be"]},{"entry":[{},"flushed before transiting to IDLE"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}}}},"A visual indication is supplied for the backup power supply to indicate that the backup power is correctly connected, charging, fully charged or failed. This can be useful, for example, in a system with multiple modules , it is possible that repair technician must physically identify a failed module or capacitor for replacement.",{"@attributes":{"id":"p-0093","num":"0092"},"tables":{"@attributes":{"id":"TABLE-US-00009","num":"00009"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"168pt","align":"left"}}],"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}},{"entry":["Green LED","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Off","No backup power supply is connected or module is open."]},{"entry":["Slow Flash","Backup power supply is charging."]},{"entry":["Fast Flash","Backup power supply has failed self-test."]},{"entry":["On","Backup power supply is fully charged."]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}}}},"Visual indication LEDs are also used during burn-in testing. The red LED latches on if any of the self-tests failed during the burn-in testing. The green LED will flash during self-test as proof that the self-test operation is progressing. The green LED toggles at the end of each test period (write\/read DRAM and write read flash memory) while the test progresses.","For example, the external system can include various types of systems, for example, a mainframe, a server, a client, a network of various systems, etc. Volatile memory  can include, for example, Dynamic random access memory (DRAM), Z-RAM\u00ae, Static random access memory (SRAM), Twin Transistor RAM (TTRAM), etc. Non-volatile memory  can include, for example, Read-only memory (ROM), flash memory, Ferroelectric RAM (FeRAM), programmable metallization cell (PMC), etc. In some embodiments, backup power supply  can be included as part of DIMM , while in other embodiments it can be, for example, an external device. Non-volatile memory  and volatile memory  can be of various sizes and need not be the same size. During a backup operation various embodiments can move all data stored in volatile memory  to non-volatile memory  or some subset of the data stored in volatile memory . The same is true during a restore operation from non-volatile memory  to non-volatile memory . Some embodiments of  do not include each component and\/or function of . For example, some embodiments do not include isolation logic , some embodiments do store SPD information in volatile memory , some embodiments move all data stored in volatile memory  to non-volatile memory  at the same time (e.g., every DRAM device at once), and some embodiments move the data stored volatile memory  to non-volatile memory  in chunks, for example, one DRAM device at a time.","Controller  can be implemented, for example, using various FPGAs, controllers, processors, and\/or memories. In another embodiment, non-volatile controller  is an application-specific integrated circuit (ASIC) that includes a flash chip interface inside the controller. By incorporating the flash chip interfaces into the ASIC controller, external SD\/MMC+ controllers are not used, and save\/restore performance can be improved. In another embodiment, volatile memory  can be separated into various segments using various staring and ending addresses. These addresses can be configured by setting registers in controller  through the NVDIMM I2C bus. Which (and in what order) the segments defined by these addresses should be backuped and\/or restored is also controllable by setting registers in controller . Although the invention has been described and illustrated in the foregoing illustrative embodiments, it is understood that the present disclosure has been made only by way of example, and that numerous changes in the details of implementation of the invention can be made without departing from the spirit and scope of the invention, which is limited only by the claims that follow."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0009","num":"0008"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0010","num":"0009"},"figref":["FIG. 3","FIG. 1"]},{"@attributes":{"id":"p-0011","num":"0010"},"figref":["FIG. 4","FIG. 1"]},{"@attributes":{"id":"p-0012","num":"0011"},"figref":["FIG. 5","FIG. 1"]},{"@attributes":{"id":"p-0013","num":"0012"},"figref":["FIG. 6","FIG. 1"]},{"@attributes":{"id":"p-0014","num":"0013"},"figref":["FIG. 7","FIG. 1"]},{"@attributes":{"id":"p-0015","num":"0014"},"figref":["FIG. 8","FIG. 1"]},{"@attributes":{"id":"p-0016","num":"0015"},"figref":["FIG. 9","FIG. 2"]}]},"DETDESC":[{},{}]}
