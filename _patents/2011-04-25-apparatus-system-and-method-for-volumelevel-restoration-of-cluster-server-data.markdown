---
title: Apparatus, system and method for volume-level restoration of cluster server data
abstract: A setup module saves disk signatures identifying cluster disks for at least one source volume to a device distinct from the cluster disks. A copy module copies data with a volume-level restore from at least one snapshot volume to the at least one source volume, overwriting the disk signatures identifying the cluster disks so that the cluster disks cannot be accessed. A reset module rewrites the saved disk signatures to the cluster disks.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08386847&OS=08386847&RS=08386847
owner: International Business Machines Corporation
number: 08386847
owner_city: Armonk
owner_country: US
publication_date: 20110425
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","FIELD","BACKGROUND","Description of the Related Art","SUMMARY","DETAILED DESCRIPTION"],"p":["This is a continuation application of and claims priority to U.S. patent application Ser. No. 11\/625,428 entitled \u201cAPPARATUS, SYSTEM, AND METHOD FOR VOLUME-LEVEL RESTORATION OF CLUSTER SERVER DATA\u201d and filed on Jan. 22, 2007 for Neeta Garimella et al., which is incorporated herein by reference.","This invention relates to restoring data and more particularly relates to restoring cluster server data at a volume-level.","A data processing system may employ cluster servers for critical data processing tasks. Two or more servers may be configured as cluster servers. Each cluster server may monitor other cluster servers. If a first cluster server hangs or otherwise is unable to complete one or more tasks, a second cluster server may identify the problem and resume processing functions for the first cluster server.","Cluster servers often employ one or more cluster disks. The cluster disks may store data for each of the cluster servers. The storage capacity of the cluster disks may be divided among one or more logical volumes. The cluster disk logical volumes are referred to herein as source volumes.","The source volumes and cluster disks may employ a number of data locks and other safeguards to assure that data used by a first cluster server is not overwritten by a second cluster server. As a result, the plurality of cluster servers may share the source volumes and the cluster disks.","Because cluster servers typically perform critical tasks, a snapshot of the data stored on the source volumes is often backed up to one or more snapshot volumes. A plurality of snapshot instances may be stored on the snapshot volumes.","Occasionally, the cluster servers may require that data from a snapshot instance be restored to the source volumes. Unfortunately, because of the large numbers of discrete files and the large amount of data that must be restored, recovering data from the snapshot instance may be a lengthy process. Yet because of the critical nature of the tasks performed by the cluster server, a lengthy recovery process may be unacceptable.","From the foregoing discussion, there is a need for an apparatus, system, and method that restores cluster server data at volume level. Beneficially, such an apparatus, system, and method would allow cluster server data to be rapidly restored, minimizing service outages.","The present invention has been developed in response to the present state of the art, and in particular, in response to the problems and needs in the art that have not yet been fully solved by currently available data restoration methods. Accordingly, the present invention has been developed to provide an apparatus, system, and method for restoring cluster server data that overcome many or all of the above-discussed shortcomings in the art.","The apparatus to restore cluster server data at a volume level is provided with a first cluster server. In one embodiment, the first cluster server comprises a setup module, a copy module, and a reset module. The setup module saves disk signatures identifying cluster disks for at least one source volume to a device distinct from the cluster disks. The copy module copies data with a volume-level restore from at least one snapshot volume to the at least one source volume, overwriting the disk signatures identifying the cluster disks so that the cluster disks cannot be accessed. The reset module rewrites the saved disk signatures to the cluster disks.","A system of the present invention is also presented to restore cluster server data. The system may be embodied in a cluster server. In particular, the system, in one embodiment, includes a plurality of cluster servers, cluster disks, and snapshot disks.","The cluster disks include at least one source volume that stores data for the cluster servers. The snapshot disks include at least one volume that stores a backup instance of the at least one source volume.","A first cluster server of the plurality of cluster servers includes a setup module, a copy module, and a reset module. The setup module saves disk signatures identifying cluster disks for the at least one source volume to a device distinct from the cluster disks. The copy module copies data with a volume-level restore from at least one snapshot volume to the at least one source volume, overwriting the disk signatures identifying the cluster disks so that the cluster disks cannot be accessed. The reset module rewrites the saved disk signatures to the cluster disks.","A method of the present invention is also presented for restoring cluster server data. The method in the disclosed embodiments substantially includes the steps to carry out the functions presented above with respect to the operation of the described apparatus and system.","A setup module saves disk signatures identifying cluster disks for at least one source volume to a device distinct from the cluster disks. A copy module copies data with a volume-level restore from at least one snapshot volume to the at least one source volume, overwriting the disk signatures identifying the cluster disks so that the cluster disks cannot be accessed. A reset module rewrites the saved disk signatures to the cluster disks.","References throughout this specification to features, advantages, or similar language does not imply that all of the features and advantages that may be realized with the present invention should be or in any single embodiment of the invention. Rather, language referring to the features and advantages is understood to mean that a specific feature, advantage, or characteristic described in connection with an embodiment is included in the at least one embodiment of the present invention. Thus, discussion of the features and advantages, and similar language, throughout this specification may, but do not necessarily, refer to the same embodiment.","The embodiment of the present invention restores cluster server data. In addition, the present invention may reduce the time required to restore the data, shortening the time the data is unavailable to the cluster servers. Furthermore, the described features, advantages, and characteristics of the invention may be combined in any suitable manner in one or more embodiments. One skilled in the relevant art will recognize that the invention may be practiced without one or more of the specific features or advantages of a particular embodiment. In other instances, additional features and advantages may be recognized in certain embodiments that may not be present in all embodiments of the invention.","These features and advantages of the present invention will become more fully apparent from the following description and appended claims, or may be learned by the practice of the invention as set forth hereinafter.","Many of the functional units described in this specification have been labeled as modules, in order to more particularly emphasize their implementation independence. For example, a module may be implemented as a hardware circuit comprising custom VLSI circuits or gate arrays, off-the-shelf semiconductors such as logic chips, transistors, or other discrete components. A module may also be implemented in programmable hardware devices such as field programmable gate arrays, programmable array logic, programmable logic devices or the like.","Modules may also be implemented in software for execution by various types of processors. An identified module of executable code may, for instance, comprise one or more physical or logical blocks of computer instructions, which may, for instance, be organized as an object, procedure, or function. Nevertheless, the executables of an identified module need not be physically located together, but may comprise disparate instructions stored in different locations which, when joined logically together, comprise the module and achieve the stated purpose for the module.","Indeed, a module of executable code may be a single instruction, or many instructions, and may even be distributed over several different code segments, among different programs, and across several memory devices. Similarly, operational data may be identified and illustrated herein within the modules, and may be embodied in any suitable form and organized within any suitable type of data structure. The operational data may be collected as a single data set, or may be distributed over different locations including different storage devices.","Reference throughout this specification to \u201cone embodiment,\u201d \u201can embodiment,\u201d or similar language means that a particular feature, structure, or characteristics described in connection with the embodiment is included in at least one embodiment of the present invention. Thus, appearances of the phrases \u201cin one embodiment,\u201d \u201cin an embodiment,\u201d and similar language throughout this specification may, but do not necessarily, all refer to the same embodiment.","Furthermore, the described features, structures, or characteristics of the invention may be combined in any suitable manner in one or more embodiments. In the following description, numerous specific details are provided, such as examples of programming, software modules, user selections, network transactions, database queries, database structures, hardware modules, hardware circuits, hardware chips, etc., to provide a thorough understanding of embodiments of the invention. One skilled in the relevant art will recognize, however, that the invention may be practiced without one or more of the specific details, or with other methods, components, materials, and so forth. In other instances, well-known structures, materials, or operations are not shown or described in detail to avoid obscuring aspects of the invention.",{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 1","b":["100","100","110","115","120","125","130","125","130","125","130","120","115","120","115"]},"In one embodiment, the cluster servers  execute MICROSOFT\u00ae Cluster Server. The operating system may include Volume Shadow Copy Service application program interfaces as are well known to those of skill in the art.","The cluster servers  may provide computing services for the hosts . For example, the cluster servers  may execute tasks including application programs, data managements programs, and the like. The cluster servers  work closely together.","The hosts  may be computer workstations, servers, mainframe computers, and the like. The hosts  may communicate with the cluster servers  through the cluster connection . The cluster connection  may be a router, a server, or the like. The cluster servers  may also communicate through a private cluster connection .","The cluster servers  may provide high availability computing services. Thus if a first cluster server is unavailable, a second cluster server may be used in place of the first cluster server . The cluster servers  may also work together to balance data processing tasks among the cluster servers . Thus if the first cluster server is processing too many tasks, some tasks may be shifted to the second cluster server . The cluster servers  may also monitor each other, so that if the first cluster server fails, the second cluster server may assume the computing tasks of the first cluster server ","The cluster servers  may each store data to the cluster disks , facilitating the sharing of tasks among the cluster servers . The cluster disks  may be organized as one or more source volumes. The cluster server system  may employ locks and other logical restrictions to prevent the first cluster server from overwriting data of the second cluster server ","Because cluster server systems  typically process important tasks, the data of the cluster disks  may be backed up to the snapshot disks . The snapshot disks  may also be organized as one or more snapshot volumes. If data of one or more source volumes is ever lost and\/or corrupted, a backup instance of the data may be recovered from the snapshot volumes.","In one embodiment, the cluster disks  and\/or the snapshot disks  are organized as a storage area network (SAN). Alternatively, the cluster disks  and the snapshot disks  may be organized within a single SAN.","Unfortunately, copying a large amount of data and large number of files from the snapshot disks  to the cluster disks  may require an excessive time interval. As a result, the cluster server system  may be unable to provide computing services or provide computing services at a reduced level. The present invention efficiently restores the data from the snapshot volumes to the source volumes.",{"@attributes":{"id":"p-0041","num":"0040"},"figref":["FIG. 2","FIG. 1","FIG. 1"],"b":["200","200","120","200"]},"In one embodiment, the setup module  prepares an application for recovery. The application executes on a cluster server . The setup module  further directs the application to quiesce a data set of a source volume of a cluster server . The source volume may reside on the cluster disks .","The setup module  opens the source volume. In addition, the setup module  flushes each buffer of the source volume and closes the source volume. The buffers may temporarily store data written to the source volume and\/or read from the source volume. The setup module  further disables file system checks for the cluster disks  associated with the source volume. In addition, the setup module  saves disk signatures of the cluster disks  and disables device-level checks for the cluster disks  as will be described hereafter.","The copy module  copies data with a volume-level restore from a snapshot volume to the source volume. The reset module  rewrites the saved disk signatures to the cluster disks . In addition, the reset module  re-enables the device-level checks for the cluster disks  and resets at least one volume attribute on the at least one source volume.","In one embodiment, the reset module  unmounts the source volume, mounts the source volume, and re-enables the file system checks for the cluster disks . In addition, the reset module may direct the application to run a recovery operation. The cluster server apparatus  allows the data to be restored to the source volume.","The schematic flow chart diagrams that follow are generally set forth as logical flow chart diagrams. As such, the depicted order and labeled steps are indicative of one embodiment of the presented method. Other steps and methods may be conceived that are equivalent in function, logic, or effect to one or more steps, or portions thereof, of the illustrated method. Additionally, the format and the symbols employed are provided to explain the logical steps of the method and are understood not to limit the scope of the method. Although various arrow types and line types may be employed in the flow chart diagrams, they are understood not to limit the scope of the corresponding method. Indeed, some arrows or other connectors may be used to indicate only the logical flow of the method. For instance, an arrow may indicate a waiting or monitoring period of unspecified duration between enumerated steps of the depicted method. Additionally, the order in which a particular method occurs may or may not strictly adhere to the order of the corresponding steps shown.",{"@attributes":{"id":"p-0047","num":"0046"},"figref":["FIGS. 3 and 4","FIGS. 1 and 2"],"b":["300","300","120"]},"The data restoration method  begins, and in one embodiment, the copy module  backs up  data from the at least one source volume to the at least one snapshot volume. In a certain embodiment, there is a corresponding snapshot volume for each source volume. The copy module  may regularly back up  data according to the policy. For example, the copy module  may back up  data hourly.","The setup module  may prepare  an application for recovery. The application may be a database application program, a web services application, and the like. In one embodiment, the application is MICROSOFT\u00ae Exchange Server.","The setup module  further directs  the application to quiesce a data set of the at least one source volume of a cluster server . In addition, the setup module  may dismount a data set used by the application and residing on a source volume.","The setup module  opens  the at least one source volume. For example, the source volume may be configured to receive data from the at least one snapshot volume, wherein the data from the snapshot volume may overwrite the current data of the at least one source volume.","The setup module  flushes  each buffer of the at least one source volume. The buffers may be configured as a semiconductor memory, a reserved section of a hard disk drive, and the like. The opening  of the at least one source volume may enable the flushing  of the buffers. In addition, the setup module  closes  the at least one source volume.","The setup module  further disables  file system checks for the cluster disks  associated with the source volume. The file system checks may determine if the cluster disks  are functioning. In one embodiment, the setup module  disables  the file system checks by placing the cluster disks  in a normal cluster maintenance mode, such that functions such as \u201clooksalive,\u201d \u201cisalive,\u201d and the like cannot be used. The setup module  further saves  disk signatures of the cluster disks  as will be described hereafter.","Turning now to , the setup module  disables  device-level checks for the cluster disks . In one embodiment, the setup module  disables  the device-level checks by placing the cluster disks  in an extended maintenance mode. With the cluster disks  in extended maintenance mode, a cluster server  may be unable to write to the cluster disks .","The copy module  copies  data with a volume-level restore from the at least one snapshot volume to the at least one source volume. In one embodiment, the copy module  overwrites each source volume with the data of a snapshot volume. The copy module  may rapidly copy  the data using one or more methods as is well know to those of skill in the art. In addition, in some embodiments such as an International Business Machines Corporation (IBM) SAN Volume Controller, IBM DS6000-series, and IBM DS8000-series, the source volumes can be used before the data copy completes.","The reset module  rewrites  the saved disk signatures to the cluster disks  as will be described hereafter. In addition, the reset module  may re-enable  the device-level checks for the cluster disks . In one embodiment, the reset module  re-enables  the device-level checks by removing the cluster disks  from the extended maintenance mode.","The reset module  further resets  the at least one volume attribute on the at least one source volume. In one embodiment, resetting  the at least volume attribute makes the at least one source volumes writable. The reset module  unmounts  the at least one source volume. In addition, the reset module  mounts  the at least one source volume. Unmounting  and mounting  the at least one source volume may enable the cluster servers  to write to the source volumes.","The reset module  re-enables  the file system checks for the cluster disks . In one embodiment, the reset module  removes the cluster disks  from the normal cluster maintenance mode to re-enable  file system checks. In addition, the reset module  may direct  the application to run a recovery operation. For example, the reset module  may direct  MICRSOFT\u00ae Exchange Server to mount application databases.","The data restoration method  restores the cluster server data. By preparing the source volumes for receiving a volume-level restore, the data restoration method  improves the restoration of data.",{"@attributes":{"id":"p-0060","num":"0059"},"figref":["FIG. 5","FIG. 3","FIGS. 1-3"],"b":["500","500","330","500"]},"The cluster disks  comprise disk signatures . The disk signatures  identify the cluster disks . Each storage device of the cluster disks  may have a disk signature . The setup module  saves  the disk signatures  to a memory module . The memory module  may be a dynamic random access memory (DRAM) residing in a cluster server .","With the disk signatures  stored  to the memory module , the copy module  may rapidly copy  data from the snapshot disks  to the cluster disks . Although the disk signatures  may be overwritten during the copy  operation, the disk signatures  are still available for restoration to the cluster disks  as will be described hereafter.",{"@attributes":{"id":"p-0063","num":"0062"},"figref":["FIG. 6","FIG. 5","FIG. 5","FIGS. 1-5"],"b":["600","510","125","130","605","600"]},"The cluster disks with restored data  include the data needed by the cluster servers . However, the cluster servers  may not access the data as the cluster disks with restored data  do not have the disk signatures of the snapshot disks .",{"@attributes":{"id":"p-0065","num":"0064"},"figref":["FIG. 7","FIG. 6","FIGS. 1-6"],"b":["700","510","605","700"]},"The reset module  rewrites  the saved disk signatures  to the cluster disks with restored data . With the disk signatures , the cluster disks with restored data  can be accessed by the cluster servers , completing the restoration of cluster server data.","The present invention efficiently restores data for cluster servers .","The present invention may be embodied in other specific forms without departing from its spirit or essential characteristics. The described embodiments are to be considered in all respects only as illustrative and not restrictive. The scope of the invention is, therefore, indicated by the appended claims rather than by the foregoing description. All changes which come within the meaning and range of equivalency of the claims are to be embraced within their scope."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["In order that the advantages of the invention will be readily understood, a more particular description of the invention briefly described above will be rendered by reference to specific embodiments that are illustrated in the appended drawings. Understanding that these drawings depict only typical embodiments of the invention and are not therefore to be considered to be limiting of its scope, the invention will be described and explained with additional specificity and detail through the use of the accompanying drawings, in which:",{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIGS. 3 and 4"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 7"}]},"DETDESC":[{},{}]}
