---
title: Peer-to-peer engine for object sharing in communication devices
abstract: This invention describes a method for sharing of application specific objects between communication devices (e.g., a mobile communication device or a mobile phone) using middleware containing a peer-to-peer engine. This engine is completely peer-to-peer based and no servers are needed in the network. Especially games are seen as a promising potential application for the invention. An application registers to the peer-to-peer (P2P) engine when it wants to share or download files. The P2P engine takes care of the file sharing and informs when a new file has been downloaded so the application can start using it and the P2P engine delivers them to the appropriate application directories. The P2P engine can use either a 2G or 3G general packet radio system (GPRS), a wideband code division multiple access (WCDMA) or a Bluetooth as a transport for the file sharing and the choice of the transport is left to the user.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08316088&OS=08316088&RS=08316088
owner: Nokia Corporation
number: 08316088
owner_city: Espoo
owner_country: FI
publication_date: 20040706
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND ART","DISCLOSURE OF THE INVENTION","BEST MODE FOR CARRYING OUT THE INVENTION"],"p":["This invention generally relates to network information sharing and more specifically to sharing of application specific objects between communication devices (e.g., mobile phones) using middleware containing a peer-to-peer engine.","Currently there is no transparent way for applications in mobile phones to upload and download files which phone users consider important to share. Either sharing files is not possible at all or the sharing is very user consuming, because the phone user has to personally oversee the transfer. The user has to make sure the files are moved to the appropriate directory and subsequently a particular application uses or edits a configuration of the application to enable usage of these new files, i.e., FTP (File Transfer Protocol) or similar means have to be used. To enable easy transfer of files with as little actions from the user as possible, there should be some kind of file sharing engine. For a better user experience the user should see the transferred file as an object for the particular application, e.g., the user can be informed that there is a new circuit, \u201cSuzuka\u201d for a game \u201cFormula 1 2003\u201d available, and not just told that a track_suzuka_ver11.tra file was downloaded in a \u201cdownload\u201d directory.","Prior art solutions are file transfer solutions where the user has to know what the files are, what they contain, what directory they should be in and how to configure the applications to use them. These previous solutions are implementations of different file transfer protocols. In all these applications little or no middleware application logic is used.","The object of the present invention is to provide a methodology for sharing of application specific objects between communication devices (e.g., mobile communication devices or mobile phones) using middleware containing a peer-to-peer engine.","According to a first aspect of the invention, a method for providing object sharing between a communication device and a further communication device, comprising the steps of: sending an invite by a peer-to-peer engine of the communication device to a further peer-to-peer engine of the further communication device, wherein the invite signal contains information about at least one file or a part of the at least one file available for sharing and belonging to an application X in the communication device and the information is taken from a peer-to-peer database of the communication device by the peer-to-peer engine; and transferring the at least one file or the part of the at least one file to a further peer-to-peer database of the further communication device, if the further communication device supports the application X and initiates the transfer, thus providing the object sharing.","According further to the first aspect of the invention, the at least one file or the part of the at least one file must be stored in the peer-to-peer database in order to be the object for sharing and the at least one file or the part of the at least one file may be copied from the peer-to-peer database during the transferring.","Further according to the first aspect of the invention, the transferring from the communication device to the further communication device may be facilitated by the peer-to-peer engine and by the further peer-to-peer engine, respectively.","Still further according to the first aspect of the invention, after the step of sending the invite signal, the method may further comprise the steps of: determining whether the further communication device supports the application X and optionally contains at least one further file or a part of the at least one further file belonging to the application X for sharing; and sending, if the further communication device supports the application X, an ok signal by the further peer-to-peer engine of the further communication device to the peer-to-peer engine of the communication device, wherein the ok signal contains, if available for sharing, further information about the at least one further file or the part of the at least one further file and the further information is taken from the further peer-to-peer database by the further peer-to-peer engine. Still further, the method may further comprise the step of: completing the at least one further file or the part of the at least one further file in the peer-to-peer database of the communication device and optionally storing the at least one further file or the part of the at least one further file in the peer-to-peer database in order to be the object for sharing. Yet still further, the at least one further file or the part of the at least one further file after the completing may be moved or copied to a corresponding application directory X out of N application directories available in the communication device and, if the at least one further file or the part of the at least one further file is moved out of the peer-to-peer database, it may no longer be available for sharing in the communication device, wherein N is an integer of at least a value of one. Yet further still, the completing may include storing in the peer-to-peer database data regarding the at least one further file or the part of the at least one further file containing a file name, a file type, file meta-data, an application ID, a checksum, a file size, pointers to various file parts, pointers to various checksums of the corresponding file parts, an indication of a file availability for sharing and an indication of a file completeness.","According still further to the first aspect of the invention, all signals originated from and received by the peer-to-peer engine and the further peer-to-peer engine may be transported by second generation (2G) general packet radio system (GPRS) means, by third generation (3G) general packet radio system (GPRS) means, by code division multiple access (CDMA) means, by wideband code division multiple access (WCDMA) means, by Bluetooth means, by wireless local area networks (WLAN) means, or by upper memory block (UMB) means.","According further still to the first aspect of the invention, all the steps initiated by corresponding users of the communication device or the further communication device may be performed automatically by the peer-to-peer engine and the further peer-to-peer engine, respectively.","Yet still further according to the first aspect of the invention, the further information may include a file name, a checksum, a file type and a bit field describing what file parts are available to share regarding the at least one further file or the part of the at least one further file.","According yet further still to the first aspect of the invention, the method may further comprise the step of: completing the at least one file or the part of the at least one file in the further peer-to-peer database of the further communication device and optionally storing the at least one file or the part of the at least one file in the further peer-to-peer database in order to be the object for sharing. Still further, the at least one file or the part of the at least one file after the completing may be moved or copied to a corresponding application directory X available in the further communication device and, if the at least one file or the part of the at least one file is moved out of the further peer-to-peer database, it may no longer be available for sharing in the further communication device. Yet still further, the completing may include storing in the further peer-to-peer database data regarding the at least one file or the part of the at least one file containing a file name, a file type, file meta-data, an application ID, a checksum, a file size, pointers to various file parts, pointers to various checksums of the corresponding file parts, an indication of a file availability for sharing and an indication of a file completeness.","Still yet further according to the first aspect of the invention, the communication device may be a mobile communication device or a mobile phone.","According further to the first aspect of the invention, the information may include a file name, a checksum, a file type and a bit field describing what file parts are available to share regarding the at least one file or the part of the at least one file.","According to a second aspect of the invention, a communication device for providing object sharing between the communication device and a further communication device, comprising: a peer-to-peer engine, for sending an invite signal to a further peer-to-peer engine of the further communication device, wherein the invite signal contains information about at least one file or a part of the at least one file available for sharing and belonging to an application X in the communication device, for providing the at least one file or the part of the at least one file for transferring to a further peer-to-peer database of the further communication device, if the further communication device supports the application X and initiates the transfer, thus providing the object sharing; and a peer-to-peer database, for storing the information about the at least one file or the part of the at least one file, wherein the information is taken from a peer-to-peer database of the communication device by the peer-to-peer engine.","According further to the second aspect of the invention, the at least one file or the part of the at least one file must be stored in the peer-to-peer database in order to be the object for sharing and the at least one file or the part of the at least one file may be copied from the peer-to-peer database during the transferring.","Further according to the second aspect of the invention, the transferring from the communication device to the further communication device may be facilitated by the peer-to-peer engine and by the further peer-to-peer engine, respectively.","Still further according to the second aspect of the invention, after sending the invite signal, it may be determined whether the further communication device supports the application X and optionally contains at least one further file or the part of the at least one further file belonging to the application X for sharing, and, if it is determined that the further communication device supports the application X, an ok signal may be sent by the further peer-to-peer engine of the further communication device to the peer-to-peer engine of the communication device, wherein the ok signal contains, if available for sharing, further information about the at least one further file or the part of the at least one further file and the further information is taken from the further peer-to-peer database by the further peer-to-peer engine. Still further, after sending an ok signal, an acknowledgement signal may be sent by the peer-to-peer engine of the communication device to the further peer-to-peer engine of the further communication device, and the at least one further file or the part of the at least one further file may be transferred from the peer-to-peer further database to the peer-to-peer database, if the communication device initiates the transfer, thus providing further the object sharing. Further still, the at least one further file or the part of the at least one further file in the peer-to-peer database of the communication device may be completed and optionally stored in the peer-to-peer database in order to be the object for sharing. Yet further, the at least one further file or the part of the at least one further file after the completing may be moved or copied to a corresponding application directory X out of N application directories available in the communication device and, if the at least one further file or the part of the at least one further file is moved out of the peer-to-peer database, it may no longer be available for sharing in the communication device, wherein N is an integer of at least a value of one. Yet still further, the completing may include storing in the peer-to-peer database data regarding the at least one further file or the part of the at least one further file containing a file name, a file type, file meta-data, an application ID, a checksum, a file size, pointers to various file parts, pointers to various checksums of the corresponding file parts, an indication of a file availability for sharing and an indication of a file completeness.","According further to the second aspect of the invention, the all signals originated from and received by the peer-to-peer engine and the further peer-to-peer engine may be transported by second generation (2G) general packet radio system (GPRS) means, by third generation (3G) general packet radio system (GPRS) means, by code division multiple access (CDMA) means, by wideband code division multiple access (WCDMA) means, by Bluetooth means, by wireless local area networks (WLAN) means, or by upper memory block (UMB) means.","According still further to the second aspect of the invention, the further information may include a file name, a checksum, a file type and a bit field describing what file parts are available to share regarding the at least one further file or the part of the at least one further file.","According further still to the second aspect of the invention, the communication device may further comprise: a peer-to-peer management block, for managing the peer-to-peer engine and the peer-to-peer database.","According yet further still to the second aspect of the invention, the information may include a file name, a checksum, a file type and a bit field describing what file parts are available to share regarding the at least one file or the part of the at least one file.","Yet still further according to the second aspect of the invention, the communication device may be a mobile communication device or a mobile phone.","According to a third aspect of the invention, a computer program product comprising: a computer readable storage structure embodying computer program code thereon for execution by a computer processor with the computer program code characterized in that it includes instructions for performing the steps of the first aspect of the invention indicated as being performed by any component or a combination of components of the communication device or the further communication device.","According to a fourth aspect of the invention, middleware of a communication device for providing object sharing between the communication device and a further communication device, comprising: a peer-to-peer engine, for sending an invite signal to a further peer-to-peer engine of the further communication device, wherein the invite signal (contains information about at least one file or a part of the at least one file available for sharing and belonging to an application X in the communication device, for providing the at least one file or the part of the at least one file for transferring to a further peer-to-peer database of the further communication device, if the further communication device supports the application X and initiates the transfer, thus providing the object sharing; and a peer-to-peer database, for storing the information about the at least one file or the part of the at least one file, wherein the information is taken from a peer-to-peer database of the communication device by the peer-to-peer engine.","According further to the fourth aspect of the invention, the at least one file or the part of the at least one file must be stored in the peer-to-peer database in order to be the object for sharing and the at least one file or the part of the at least one file may be copied from the peer-to-peer database during the transferring.","The present invention provides a new methodology for sharing of application specific objects between communication devices (e.g., mobile communication devices or mobile phones) using middleware containing a peer-to-peer engine. This engine is completely peer-to-peer based and no servers are needed in the network. Although from a user perspective the transferred items in these peer-to-peer sessions are objects of a certain application, they are files for the peer-to-peer engine middleware, so the term \u201cfile\u201d can be also used instead of the term \u201cobject\u201d. Especially games are seen as a promising potential application of the present invention.","An application registers to the peer-to-peer (P2P) engine when it wants to share or download files. The P2P engine takes care of the file sharing and informs when a new file has been downloaded so the application can start using it. The P2P engine does not understand the contents of the file; it just delivers them to the appropriate application directories. The P2P engine can use a cellular connection, e.g., a second generation (2G) general packet radio system (GPRS), a third generation (3G) GPRS, a code division multiple access (CDMA), a wideband code division multiple access (WCDMA), etc., or a proximity radio connection, e.g., a Bluetooth, a wireless local area networks (WLAN), an upper memory block (UMB), etc. as a transport for the file sharing. The choice of the transport is left to the user.",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 1","b":"11"},"As shown in  a middleware layer  sits between an application layer  and a transport layer . Each of N application directories -, -, . . . , -N (N is an integer of at least a value of one) of the application layer  contains one of N different applications and files associated with them. Any of these N application directories can register with a peer-to-peer engine  of the middleware layer  when it wants to share or download files through a corresponding application programming interface (API) out of N APIs -, -, . . . , -N. The peer-to-peer engine (P2P)  takes care of the file sharing as described in more detail below and informs the appropriate application directory out of said of N application directories -, -, . . . , -N when a new file has been downloaded so the appropriate application directory can start using it. The P2P engine  does not understand the contents of the file but delivers them to the appropriate application directories. All signals related to file sharing (e.g., peer-to-peer sharing signals  and\/or peer-to-peer file transfer signals ) originated from and received by said peer-to-peer engine  through an interface  are transported, e.g., by second generation (2G) or third generation (3G) general packet radio system (GPRS) means -, by wideband code division multiple access (WCDMA) means -, or by Bluetooth means -, all of the transport layer . The choice of the transport means is left to the user.  only shows a few examples of the transport means. As it is pointed out above, in general, the transport means can be a broad class of connection including the cellular connection (e.g., the 2G GPRS, 3G GPRS, CDMA, WCDMA, etc.) or the proximity radio connection (e.g., the Bluetooth, WLAN, UMB, etc.).","Regarding the example of , the difference between the GPRS\/WCDMA transport and the Bluetooth transport regarding the present invention is that in the GPRS\/WCDMA transport the user cannot share files with all the users connected to GPRS\/WCDMA networks that have the same P2P engine. Instead, the user has to find other users and tell them that he\/she wants to share files with them. On the contrary, in the Bluetooth transport, a user communication base (a number of other users) is limited because of a small range, so the user can keep searching and scanning through the other users inside the Bluetooth coverage and share the files with them on a continuous basis. Another factor which makes Bluetooth transport easier is because the data transfer in Bluetooth transport is free, whereas it is not free in the GPRS\/WCDMA transport.","The middleware layer  also contains another important component defining the present invention: the peer-to-peer (P2P) database . The P2P database  contains the file or a part of said file that is shared and\/or under download. The user can decide if the downloaded file or the part of the file can be further shared after the download is completed. If that is the case, the file or the part of the file is completed as described below and saved in the P2P database . If, however, the user decides not to share the file or the part of the file further after the download is complete, then the file or the part of the file is moved to an appropriate application directory out of said N application directories -, -, . . . , -N. This will prevent sharing of these files, and information about the file is removed from the P2P database . If, however, the file is only copied from the P2P database  to the appropriate application directory out of said N application directories -, -, . . . , -N, the file can continue being shared.","Thus only the files being downloaded are always physically in the P2P database . Only files to be shared and completed files are stored in the in the P2P database . Most of the downloaded files are in the N application directories -, -, . . . , -N and the P2P database  only contains links to those files through the P2P engine . This ensures that a memory (or a disk space) is used as little as possible.","A peer-to-peer management block -M is for managing the peer-to-peer engine  and the peer-to-peer database  through the application programming interface (API) -M. For example, the user can access the shared files in addition to the application described above, delete temporarily files in the peer-to-peer database  (through the peer-to-peer engine ), change temporarily folders for the peer-to-peer database , etc.",{"@attributes":{"id":"p-0041","num":"0040"},"figref":"FIG. 2","i":"a ","b":"20"},"The content of any file entry in the P2P database  can be as follows:\n\n","The file downloaded into the P2P database  is complete when all the above information is available in the P2P database  for that file.","Generally, a peer-to-peer sharing protocol, according to the present invention, contains two parts: signaling (represented by the peer-to-peer sharing signal  in ) and a file transfer (represented by the peer-to-peer file transfer signal  in ). In the signaling protocol two participants are describing what files they have to share and what are they looking for. The file transfer protocol is used to transfer the files one part at a time. The transfer is one way only, so if both users want to download something from each other there are two file transfer sessions.",{"@attributes":{"id":"p-0045","num":"0054"},"figref":"FIG. 2","i":"b ","b":["24","24","24","1","24","2","24","3","24","4","24","5"]},"In the signaling protocol both parties offer the files they have to share. Based on this information and what files they already have, they start file transfer sessions to acquire desired files. These sessions can be one by one or simultaneous, based on implementation and terminal capabilities of the phones. In the beginning of the signaling protocol session there are three messages exchanged, \u201cinvite\u201d, \u201cok\u201d and \u201cacknowledgement\u201d corresponding to the invite signal -, the ok signal - and the acknowledgement signal -, respectively. The \u201cinvite\u201d describes the files to share belonging to an application X (one out of the N application directories -, -, . . . , -N) in an A party (e.g., the communication device  of ).","The description of the file, according to the present invention, can consist of, e.g., the file name, the file checksum, the file type and a bit field describing what are the parts the sharer has. E.g., 101100 would mean the sharer has parts 1, 3 and 4 of the file consisting of six parts.","If a B party (e.g., a further communication device with similar features as the communication device  of ) has the application X and some files to share whose owner is the application X, the B party sends the \u201cok\u201d message back, with a description what files it has. When the A party receives the \u201cok\u201d message it sends the \u201cacknowledgement\u201d message back and the A party starts a file transfer session to get some file it wants from the B party and similarly the B party starts its own file transfer session to get some file it wants from the A party (there are two separate transfer sessions as mentioned above). If the A or B party does not want any new files to be transferred, it does not start its file transfer session. In case the B party does not have application X, it sends the \u201ccancel\u201d message (corresponding to the cancel signal -) back and the signaling session for the application X files ends. In case neither party wants to transfer any file after the successful signaling session starts, the A or B party can send a \u201cbye\u201d message (corresponding to the bye signal -) after a timeout if no file transfer session is started. The \u201cbye\u201d message is followed by another \u201cbye\u201d message from the other end.","There are many possible variations to the procedures described above. For example, there can be a need for security features, which would ensure that the shared files are really generated by the correct application (one of the N application directories -, -, . . . , -N). There could be a need to sign the shared file by the corresponding application.","Also there can be several alternatives how files are shared automatically between the users. For example, a totally automatic solution will share automatically all files that are marked as shared in a database. In other words, in this solution all the files belonging to a certain application which the other side (user) does not have (assuming that the other side supports said application), these files are transferred \u201cautomatically\u201d to the other side. In a semiautomatic solution the middleware will ask another user if he\/she wants to download these specific objects (files) of a certain application to his\/her terminal (phone). The middleware will show, e.g., application meta-data and size of a file, etc. (as described above) to help the other side to make the decision. Yet in an alternative implementation, it can be also possible to invoke file sharing from the application menu. In an application menu there could be an option to start the object sharing with a specific user and the application would then ask the middleware to take care of the actual file sharing.","Furthermore, the signaling protocol could be an SIP (Session Initiation Protocol), the file sharing information could be in the payload of an \u201cinvite\u201d message (as described above). This payload can use an SDP (Session Description Protocol), which describes session capabilities of the sender. In the 200 ok response there is the SDP of the other end. These mechanics could easily be reused by this invention.",{"@attributes":{"id":"p-0052","num":"0061"},"figref":"FIG. 3"},"The flow chart of  represents only one possible scenario among many others. In a method according to the present invention, in a first step , the peer-to-peer (P2P) engine of the communication device  (device A) sends the invite signal - to a further P2P engine of a further communication device (device B). The invite signal describes the files (at least the one file) belonging to an application X (one of the N application directories -, -, . . . , -N) in the device A and available to share, wherein information on the files, taken from the P2P database  by P2P engine , is forwarded (the invite signal -) to the device B using transport layer means (e.g., the GPRS, WCDMA or Bluetooth means -, -, or -). In a next step , it is determined whether the device B supports said application X with further files (at least the one further file) belonging to said application X for sharing. If that is not the case (the device B does not support said application X), in a step , the further P2P engine of the device B sends the cancel signal - to the P2P engine  of the device A and the process stops. If, however, it is determined that the device B supports said application X, in a next step , the P2P engine of the device B sends the ok signal - to the P2P engine of the device A; the ok signal - describes the further files (at least the one further file) belonging to the application X in the device B to share, wherein information on the further files is taken from the further P2P database by the further P2P engine of the device B and forwarded (the ok signal -) to the device A using transport layer means described above.","In a next step , the P2P engine  of the device A sends the acknowledgment signal - to the further P2P engine of the device B. In a next step , it is determined whether the device A and\/or the device B want to transfer files belonging to the application X from the device B and\/or A, respectively. If that is not the case in a step , the devices A and B send a bye signal - to each other. If, however, it is determined that the device A and\/or the device B want to transfer files belonging to the application X from the device B and\/or A, in a next step , the devices A and\/or B transfer desired application X files to each other in the separate session (see the signal  in ); the files and further files are taken from the P2P database  and from the further data base, respectively, and downloaded to the further P2P database and to the P2P database  of the corresponding devices A and B.","In a final step , the transferred files are completed in the P2P database and in the further P2P database of the devices A and B and optionally stored in these P2P databases or copied to the corresponding applications (application directories -, -, . . . , -N) to be the objects for sharing. Alternatively, these transferred files can be moved to the corresponding applications (application directories -, -, . . . , -N) and then they are not available for sharing."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["For a better understanding of the nature and objects of the present invention, reference is made to the following detailed description taken in conjunction with the following drawings, in which:",{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 2","i":"a "},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 2","i":"b "},{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 3"}]},"DETDESC":[{},{}]}
