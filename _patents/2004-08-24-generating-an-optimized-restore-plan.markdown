---
title: Generating an optimized restore plan
abstract: A restore advisor may generate and apply a recovery plan to restore a database to a specified point in time. A restore/recovery scenario may be specified; resources, and backups available may be specified and one or more optimized restore plans may be generated. One or more alternate plans may be requested. The plans may be applied, verified or saved.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07650356&OS=07650356&RS=07650356
owner: Microsoft Corporation
number: 07650356
owner_city: Redmond
owner_country: US
publication_date: 20040824
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF ILLUSTRATIVE EMBODIMENTS"],"p":["The invention relates to restoring a database after a system failure and in particular to generating an optimized restore plan.","Restoring a database after a system failure or a data loss requires a plan to restore the database to the pre-failure state. For large databases or databases with high volumes of transactions, building the restore plan is a complex and tedious task. It typically requires identification of the backups of the database and determination of the correct order of application of the backups to bring the database to the specific point in time prior to the failure.","Depending on the specific conditions associated with the system failure, system resources available and backup media available, there may be several possible restore plans. Some plans may be less efficient than others. Some plans may be impossible to implement because of the unavailability of backup media or system resources. Frequently there is a sense of urgency associated with restoring the system to operation, so a restore plan must be developed quickly.","It would be helpful if there were a way to generate an optimized restore plan quickly and easily to aid in disaster recovery.","In addition to dealing with system crashes, it may be desirable to verify that a restore plan is available, should a crash occur. For example, a business may want to verify that, should a database crash, it could be recovered, and recovered in the shortest period of time possible.","It would be helpful if there were a way to generate an optimized restore plan quickly and easily so that the availability of backup media and the presence of an optimized restore plan could be verified.","It may be desirable to verify a duplicate database against a production database. For example, suppose someone has deleted data but the time at which the data was deleted is unknown. It may be helpful to be able to create and apply a restore plan to an intermediate point in time so that the two databases can be compared to determine when the data was deleted. It may be helpful to be able to create a copy of a database at a particular point in time, perhaps to determine the time at which a data loss occurred, or for other reasons such as, for example, for the purpose of an audit. An optimized restore plan would be helpful to create the duplicate database in the most efficient manner to a specified point in time.","A restore advisor may generate and apply a recovery plan to restore a database to a specified point in time. A restore\/recovery scenario may be specified; resources, and backups available may be specified and one or more optimized restore plans may be generated. One or more alternate plans may be requested. The plans may be applied, verified or saved.","Overview","Suppose that at 2 pm on a Tuesday, just when the maximum number of users is relying on a computer system, the database crashes. Suppose the last full backup (a copy of the entire database) was last taken at time t, to tape and the time of the crash is t+n. To restore the database to a time just before the crash will require restoring the last full backup and applying the transaction log to a point just before the crash.","Now suppose three transaction log backups were taken at times t, tand tto tape. Suppose further that a differential backup, (a copy of changes to databases since last full backup), was taken at tto CD and a fourth log backup was taken at tto CD. It is now t+n. What is the best (fastest) way to get the system back up and running? One way is to apply the last full backup (the backup at ) and then apply the four log backups in order (t, t, tand t) and then apply the log to a point just before the crash. Another way is to apply the last full backup (the backup at t) and then apply the differential backup (at time t), the transaction log backup at tand the log to a point just before the crash. What if the tape for the second log backup is defective? What if the CD on which the differential backup is stored is in Sacramento and the system is in Baltimore?","In accordance with some embodiments of the invention, an optimized restore plan to restore a database to a specified point in time is determined. In response to received input, an alternate plan may be determined. In some embodiments of the invention, the alternate plan is the next best plan, in terms of time to restoration of the database.","Exemplary Computing Environment",{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 1"},"Although not required, the invention can be implemented via an application programming interface (API), for use by a developer, and\/or included within the network browsing software which will be described in the general context of computer-executable instructions, such as program modules, being executed by one or more computers, such as client workstations, servers, or other devices. Generally, program modules include routines, programs, objects, components, data structures and the like that perform particular tasks or implement particular abstract data types. Typically, the functionality of the program modules may be combined or distributed as desired in various embodiments. Moreover, those skilled in the art will appreciate that the invention may be practiced with other computer system configurations. Other well known computing systems, environments, and\/or configurations that may be suitable for use with the invention include, but are not limited to, personal computers (PCs), automated teller machines, server computers, hand-held or laptop devices, multi-processor systems, microprocessor-based systems, programmable consumer electronics, network PCs, minicomputers, mainframe computers, and the like. The invention may also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network or other data transmission medium. In a distributed computing environment, program modules may be located in both local and remote computer storage media including memory storage devices.",{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 1","b":["100","100","100","100"]},"With reference to , an exemplary system for implementing the invention includes a general purpose computing device in the form of a computer . Components of computer  may include, but are not limited to, a processing unit , a system memory , and a system bus  that couples various system components including the system memory to the processing unit . The system bus  may be any of several types of bus structures including a memory bus or memory controller, a peripheral bus, and a local bus using any of a variety of bus architectures. By way of example, and not limitation, such architectures include Industry Standard Architecture (ISA) bus, Micro Channel Architecture (MCA) bus, Enhanced ISA (EISA) bus, Video Electronics Standards Association (VESA) local bus, and Peripheral Component Interconnect (PCI) bus (also known as Mezzanine bus).","Computer  typically includes a variety of computer readable media. Computer readable media can be any available media that can be accessed by computer  and includes both volatile and nonvolatile media, removable and non-removable media. By way of example, and not limitation, computer readable media may comprise computer storage media and communication media. Computer storage media includes both volatile and nonvolatile, removable and non-removable media implemented in any method or technology for storage of information such as computer readable instructions, data structures, program modules or other data. Computer storage media includes, but is not limited to, RAM, ROM, EEPROM, flash memory or other memory technology, CDROM, digital versatile disks (DVD) or other optical disk storage, magnetic cassettes, magnetic tape, magnetic disk storage or other magnetic storage devices, or any other medium which can be used to store the desired information and which can be accessed by computer . Communication media typically embodies computer readable instructions, data structures, program modules or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media. The term \u201cmodulated data signal\u201d means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal. By way of example, and not limitation, communication media includes wired media such as a wired network or direct-wired connection, and wireless media such as acoustic, RF, infrared, and other wireless media. Combinations of any of the above should also be included within the scope of computer readable media.","The system memory  includes computer storage media in the form of volatile and\/or nonvolatile memory such as read only memory (ROM)  and random access memory (RAM) . A basic input\/output system  (BIOS), containing the basic routines that help to transfer information between elements within computer , such as during start-up, is typically stored in ROM . RAM  typically contains data and\/or program modules that are immediately accessible to and\/or presently being operated on by processing unit . By way of example, and not limitation,  illustrates operating system , application programs , other program modules , and program data .","The computer  may also include other removable\/non-removable, volatile\/nonvolatile computer storage media. By way of example only,  illustrates a hard disk drive  that reads from or writes to non-removable, nonvolatile magnetic media, a magnetic disk drive  that reads from or writes to a removable, nonvolatile magnetic disk , and an optical disk drive  that reads from or writes to a removable, nonvolatile optical disk , such as a CD ROM or other optical media. Other removable\/non-removable, volatile\/nonvolatile computer storage media that can be used in the exemplary operating environment include, but are not limited to, magnetic tape cassettes, flash memory cards, digital versatile disks, digital video tape, solid state RAM, solid state ROM, and the like. The hard disk drive  is typically connected to the system bus  through a non-removable memory interface such as interface , and magnetic disk drive  and optical disk drive  are typically connected to the system bus  by a removable memory interface, such as interface .","The drives and their associated computer storage media discussed above and illustrated in  provide storage of computer readable instructions, data structures, program modules and other data for the computer . In , for example, hard disk drive  is illustrated as storing operating system , application programs , other program modules , and program data . Note that these components can either be the same as or different from operating system , application programs , other program modules , and program data . Operating system , application programs , other program modules , and program data  are given different numbers here to illustrate that, at a minimum, they are different copies. A user may enter commands and information into the computer  through input devices such as a keyboard  and pointing device , commonly referred to as a mouse, trackball or touch pad. Other input devices (not shown) may include a microphone, joystick, game pad, satellite dish, scanner, or the like. These and other input devices are often connected to the processing unit  through a user input interface  that is coupled to the system bus , but may be connected by other interface and bus structures, such as a parallel port, game port or a universal serial bus (USB).","A monitor  or other type of display device is also connected to the system bus  via an interface, such as a video interface . A graphics interface , such as Northbridge, may also be connected to the system bus . Northbridge is a chipset that communicates with the CPU, or host processing unit , and assumes responsibility for accelerated graphics port (AGP) communications. One or more graphics processing units (GPUs)  may communicate with graphics interface . In this regard, GPUs  generally include on-chip memory storage, such as register storage and GPUs  communicate with a video memory . GPUs , however, are but one example of a coprocessor and thus a variety of coprocessing devices may be included in computer . A monitor  or other type of display device is also connected to the system bus  via an interface, such as a video interface , which may in turn communicate with video memory . In addition to monitor , computers may also include other peripheral output devices such as speakers  and printer , which may be connected through an output peripheral interface .","The computer  may operate in a networked environment using logical connections to one or more remote computers, such as a remote computer . The remote computer  may be a personal computer, a server, a router, a network PC, a peer device or other common network node, and typically includes many or all of the elements described above relative to the computer , although only a memory storage device  has been illustrated in . The logical connections depicted in  include a local area network (LAN)  and a wide area network (WAN) , but may also include other networks. Such networking environments are commonplace in offices, enterprise-wide computer networks, intranets and the Internet.","When used in a LAN networking environment, the computer  is connected to the LAN  through a network interface or adapter . When used in a WAN networking environment, the computer  typically includes a modem  or other means for establishing communications over the WAN , such as the Internet. The modem , which may be internal or external, may be connected to the system bus  via the user input interface , or other appropriate mechanism. In a networked environment, program modules depicted relative to the computer , or portions thereof, may be stored in the remote memory storage device. By way of example, and not limitation,  illustrates remote application programs  as residing on memory device . It will be appreciated that the network connections shown are exemplary and other means of establishing a communications link between the computers may be used.","One of ordinary skill in the art can appreciate that a computer  or other client device can be deployed as part of a computer network. In this regard, the present invention pertains to any computer system having any number of memory or storage units, and any number of applications and processes occurring across any number of storage units or volumes. The present invention may apply to an environment with server computers and client computers deployed in a network environment, having remote or local storage. The present invention may also apply to a standalone computing device, having programming language functionality, interpretation and execution capabilities.","Generating an Optimized Restore Plan",{"@attributes":{"id":"p-0030","num":"0029"},"figref":["FIG. 2","FIG. 1"],"b":["202","218","110","204","202","206","202","204"]},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 3","b":"204"},"Referring now to , at t, a full backup (e.g., Backup  ) may be made. Backup   may contain a copy of the state of the database as it existed at t. At t a log backup (e.g., Backup  ) may be made. Backup   may contain transactions applied to the database from time  to time t. At t a log backup (e.g., Backup  ) may be made. Backup   may contain a log of transactions applied to the database from time t to time t. At t a log backup (e.g., Backup  ) may be made. Backup   may contain a log of transactions applied to the database from time t to time t. At t a differential backup (e.g., Backup  ) may be made. Backup   may contain changes to the database from time t (the time of the last full backup) to time t. At t a log backup (e.g., Backup  ) may be made. Backup   may contain a log of transactions applied to the database from time t to time t.","In some embodiments of the invention, a transaction log operates logically as a serial string of log records. Each log record includes the transaction and is identified by a log sequence number, LSN. An LSN may be a sequential number associated with each transaction, such that each new log record written to the logical end of the log is associated with an LSN than is higher than the LSN of the record before it. Thus, a transaction occurring earlier in time will have an LSN that is smaller than a transaction that occurs later in time. Similarly, if a first transaction has a first LSN, the next transaction will have an LSN that is higher than the LSN of the previous transaction.","When a backup is performed on database , information associated with the backup may be stored in source metadata database , as well as on the media storing the backup, here represented by storage media , , etc. The information that may be stored in source metadata database  and\/or on the storage media , , etc. may include an indicator of the type of storage media (tape, CD, disk, DVD, etc.), the volume identifier of the storage media, a beginning log sequence number (LSN) for the first transaction stored on the storage media, an ending LSN for the last transaction on the storage media, the type of backup performed, the drive or device on which the backup was performed, the date of the backup, etc.","Hence, for , information concerning Backup  , Backup  , Backup  , Backup  , Backup  , and Backup   may be stored in source metadata database , and\/or on the storage media. The information that may be stored in source metadata database  may include the volume identifier of the storage media, a beginning log sequence number (LSN) for the first transaction on the storage media, an ending LSN for the last transaction on the storage media, etc.","A restore advisor such as exemplary restore advisor  may reside on a client  as shown in . It will be appreciated that client  may reside on computer ,  or on another computer. Similarly restore advisor  may reside on computer ,  or on another computer and may be run against source database  to create target database  and target metadata database  from any location. The restore advisor  may be embedded within a database management tool and may be implemented as a pluggable component.","When the restore advisor  is invoked, an optimized restore plan such as restore plan  may be generated. An optimized restore plan may identify which backups must be applied in what order to recreate a database in the most efficient way possible given a set of constraints. In some embodiments one or more restore plans , etc. may be generated. The restore plans , etc. may be stored in source metadata database , target metadata database  or in a separate bank . Information about backups used by the restore advisor  to produce the restore plan(s) may be retrieved from one or more of: a source metadata database , a target metadata database , backup media , , etc., bank  or from user input.","A method for creating an exemplary optimized restore plan is illustrated in . At step  in response to the notification of a database system failure or data loss or notification of a desire to verify that a valid restore plan is available, or notification that a duplicate database is to be created as the database existed at a particular point in time, an optimized restore plan tool may be invoked and the tool may be launched.","A series of scenarios categorized by various events may be displayed. The events may include system failure, data loss, maintenance tasks, etc. For example, any or all of the following scenarios may be displayed for selection: restore or recover an existing database, restore or recover an existing database to a specific point in time, restore a subset of an existing database while the database remains online, restore a subset of a database to another location for investigation, restore damaged data pages of a database, create a new database from an existing database, move a database to a new location, restore a subset of a database to extract a portion of the data and so on. A suitable scenario may be selected.","At step  the user may be prompted for identification and\/or location of a source database, a target name and\/or destination for the recovery process, a source and\/or target metadata database that stores the backup history information, available system resources, available backups and backup history information and a point in time to which the database is to be recovered (e.g., a target restore time, such as, for example, \u201crestore to most recent possible\u201d, \u201crestore to transaction marked\u201d, \u201crestore to a specific date\/time\u201d. In some embodiments of the invention, instead of generating a restore plan to restore a database to a specified point in time, the restore plans is generated to restore a database to a particular checkpoint. A checkpoint, as described above, is a particular transaction that has been labeled. Alternatively, this information may be available from a source metadata database as described above and thus the identification of the source metadata database may be received.","The user may also specify the target date\/time of the recovery and the state of the database after it is recovered (e.g., \u201cwith no recovery\u201d or \u201cwith recovery\u201d. \u201cWith no recovery\u201d or \u201cwith recovery\u201d refers to the way in which incomplete transactions are handled. For example, if additional transaction logs will be applied, it may be desirable to specify restoring the database \u201cwith no recovery\u201d, meaning that incomplete transactions are not backed out. If further transactions logs will not be applied, it may be desirable to specify restoring the database \u201cwith recovery\u201d, meaning that incomplete transactions are backed out.)","At step  an appropriate plan of recovery for the database may be generated. In some embodiments of the invention, a bank of stored scenarios may be accessed to determine if a restore plan has already been generated for the specified scenario and database, etc. A plan may comprise one or more steps or actions to be taken to restore the database, in view of the constraints received in step . In some embodiments of the invention, the details of each plan step may be presented as a list of steps. Upon selection of one of the steps, details may be viewed and the backup device specified for the step may be changed.","In some embodiments of the invention, an alternate plan may be requested. For example, referring again to , suppose an optimized restore plan indicates that Backup   and Backup   are to be applied, in that order, but Backup   has a read error and is unusable. An alternate plan may be requested. In response to the request for the alternate plan, a second restore plan may be generated, for example, specifying that Backup  , Backup  , Backup   and Backup   should be applied, in that order.","At step  the plan may be executed, saved or verified (a \u201cDry Run\u201d) performed. In some embodiments of the invention, the restore plan is saved as a script file. The restore plan(s) may be saved in the source metadata database, a target metadata database or in a restore plan bank or datastore.","At step  the information acquired from step  may be stored in a source metadata database (such as source metadata database ) a target metadata database (such as target metadata database ). This information may be used to enable the restore advisor to \u201clearn\u201d from previous restore plans.","The various techniques described herein may be implemented in connection with hardware or software or, where appropriate, with a combination of both. Thus, the methods and apparatus of the present invention, or certain aspects or portions thereof, may take the form of program code (i.e., instructions) embodied in tangible media, such as floppy diskettes, CD-ROMs, hard drives, or any other machine-readable storage medium, wherein, when the program code is loaded into and executed by a machine, such as a computer, the machine becomes an apparatus for practicing the invention. In the case of program code execution on programmable computers, the computing device will generally include a processor, a storage medium readable by the processor (including volatile and non-volatile memory and\/or storage elements), at least one input device, and at least one output device. One or more programs that may utilize the creation and\/or implementation of domain-specific programming models aspects of the present invention, e.g., through the use of a data processing API or the like, are preferably implemented in a high level procedural or object oriented programming language to communicate with a computer system. However, the program(s) can be implemented in assembly or machine language, if desired. In any case, the language may be a compiled or interpreted language, and combined with hardware implementations.","While the present invention has been described in connection with the preferred embodiments of the various figures, it is to be understood that other similar embodiments may be used or modifications and additions may be made to the described embodiments for performing the same function of the present invention without deviating there from. Therefore, the present invention should not be limited to any single embodiment, but rather should be construed in breadth and scope in accordance with the appended claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The foregoing summary, as well as the following detailed description of illustrative embodiments, is better understood when read in conjunction with the appended drawings. For the purpose of illustrating the invention, there is shown in the drawings exemplary constructions of the invention; however, the invention is not limited to the specific methods and instrumentalities disclosed. In the drawings:",{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 4"}]},"DETDESC":[{},{}]}
