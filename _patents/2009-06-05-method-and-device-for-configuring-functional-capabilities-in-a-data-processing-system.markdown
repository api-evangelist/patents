---
title: Method and device for configuring functional capabilities in a data processing system
abstract: Configuring functional capabilities in a data processing system comprising entitlement data in a non-volatile storage. The position of the data processing system is determined. Based on said position, functional capabilities are changed based on position information comprised in the entitlement data. Changing functional capabilities consists of enabling functional capabilities, disabling functional capabilities, and both enabling and disabling functional capabilities.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08253552&OS=08253552&RS=08253552
owner: International Business Machines Corporation
number: 08253552
owner_city: Armonk
owner_country: US
publication_date: 20090605
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","BRIEF SUMMARY","DETAILED DESCRIPTION"],"p":["The present invention relates to the configuration of functional capabilities in a data processing system.","An important feature of computer systems is the ability to adjust the provided processing and memory capacity depending on workload requirements, or to provide backup capacity for disaster recovery situations. Modern computer systems such as the IBM System z provide the capability to activate and deactivate additional processing capacity concurrently to normal system operation\u2014i.e. the computer system does not have to be shut down or an operating system restarted to make use of the changed configuration. On Demand processor and memory capacity needs more physical capacity installed than enabled on computer systems. As long as there is dormant physical capacity available such capacity can be activated as the customer need demands. Additional processing capacity can be implemented using temporary processing resources that can be activated and deactivated as required on top of a permanent base configuration.","To prevent unauthorized activation of dormant capacity the activation is usually protected by a control system utilizing encryption as well as further secure methods binding the entitlement data to a specific machine. For example, U.S. Pat. No. 5,982,899 describes a method utilizing an unchangeable unique identifier that may be located within an integrated circuit chip. Temporary resource activation can be under control of an encrypted certificate using this unchangeable unique identifier. The Capacity on Demand features of IBM System z are described in U.S. Pat. No. 7,194,616 and J. Probst et al. \u201cFlexible configuration and concurrent upgrade for the IBM eServer z900\u201d, IBM J. Res. & Dev., Vol. 46, No 4\/5, July\/September 2002, pp. 551-558.","The invention is defined by the independent claims. Further advantageous embodiments of the present invention are defined by the dependant claims.","In one embodiment of the present invention is a method for configuring functional capabilities in a data processing system comprising entitlement data in a non-volatile storage comprising the steps of:\n\n","Another embodiment of the invention is a device for configuring functional capabilities in a data processing system comprising entitlement data in a non-volatile storage, the device comprising\n\n","The fact that the entitlement data can be shipped as part of the data processing system and can be resident on the data processing system allows an implementation of the data processing system, wherein firmware controls enablement of functional capabilities without the need to go back to the data processing system manufacturer and\/or seller with the position information and check for the entitlement at the time of activation. This means that the data processing system manufacturer and\/or seller does not need to know where the data processing system is located at any given time. The entitlement data is self contained on the data processing system.","Introduction","A state of the art computer system may be comprised of multiple processor books each of them providing processor and memory resources. The amount of resources may be identical or differ between the multiple processor books. All those resources may be combined to a single SMP (Symmetrical Multi Processor) system such that it does not matter how the enabled capacity is allocated from the physical capacity provided by multiple processor books, i.e. the entitlement for permanent and for temporary capacity is specified and charged at the system level.","The example implementation of a hardware capacity  of a computer system shown in  utilizes the unchangeable identifiers (ECID) , , ,  of each single processor book , , ,  to bind the entitlements for the physical resources of the corresponding processor books to their hardware implementation and prevent usage of the entitlement data contained in the associated entitlement records , , ,  for other processor books residing in the same computer system or in a different computer system. Therefore, there is a one to one relationship between a particular processor book and the associated entitlement record.","There is one major disadvantage with this approach: Sometimes processor books need to be exchanged for repair or upgrade purposes. When a processor book is being exchanged carrying the ECID for the encrypted entitlement record this record also must be exchanged to match the ECID of the replacing book and a new entitlement record with the appropriate processor and memory definitions must be created and loaded into the machine. Since the data is machine configuration specific it cannot be stored as a generic record but must be created for example on-line utilizing the current authorization definition of the failing processor book. This needs on-line access to the critical asset protection system. Also the certificate of tokens concept described in IPCOM000139433D does not solve this problem.",{"@attributes":{"id":"p-0029","num":"0032"},"figref":["FIG. 2","FIG. 1"],"b":["100","150","160","170","180","155","165","175","185","200","155","150","210","220","230","240","250","210","211","212","212","211","210","110","150","210","210"]},"Entitlement records , , ,  are linked to the System Anchor record  using the system unique ID  as linkage. Any number and type of entitlement records can be linked to the System Anchor record . The entitlement records , , ,  are also encrypted and thus cannot be changed or generated without authorization. The entitlement records , , ,  contain a unique identifier and specify resources at the system level and thus the total of resources is easy to calculate. The unique identifiers , , ,  must be equal to the system unique identifier . The resources are specified by the entitlement records , , ,  by their entitlement data , , ,  respectively.","Generation of a System Anchor Record","The System Anchor Record  is built during manufacturing of the computer system.  illustrates this process. In step  an unchangeable identifier of some proprietary chip contained in a book of the computer system is read from the respective book hardware and used as the ECID . In step  the serial number of the computer system is retrieved from some manufacturing database and used as the system unique ID . The system serial number may or may not be encoded with the ECID  as suggested by U.S. Pat. No. 5,982,899. The resulting data reflecting the ECID  and the system unique ID  is encrypted with the private key utilizing RSA or another asymmetrical encryption algorithm in step . The encrypted data builds the System Anchor record , which is written in step  into a non-volatile storage of a book of the computer system.","The format of the System Anchor record  may be specific or a common record format may be used for the System Anchor Record  and for the Entitlement Records , , ,  consisting of all elements needed for both types of records and utilizing only those elements needed for the respective record type. The entitlement records , , ,  contain entitlements for exploitation of hardware capability and hardware capacity in the entitlement data , , , , e.g. the number and type of processors and the amount of memory available to the computer system user. The hardware capacity shipped may exceed the capacity purchased by the computer system user. For example, an entitlement record may be permanent as entitlement record , which means that its entitlements are permanent, or it may be temporary only as the entitlement records , , , which means that its entitlements are valid temporarily only.","Generation and Distribution of Entitlement Records",{"@attributes":{"id":"p-0035","num":"0038"},"figref":"FIG. 4","b":["400","410","420","430","440","450","460","470"]},"Processing of Entitlement Records","Whenever the computer system initializes or when the customer or some automation tool decides to utilize temporary capacity the permanent and\/or the temporary entitlement records need to be validated. It must be ensured that the entitlement records belong to the respective computer system. For validation the chain ECID-S\/N-entitlement must be verified. The verification of the entitlements is illustrated in . In step  the computer system retrieves the hardware ECID directly from the hardware of processor book  and reads the anchor record from the non-volatile storage of processor book . Also the computer system reads all the entitlement records from the system non-volatile storage. In step  the computer system decrypts the anchor record and then verifies equivalence of the hardware ECID and the ECID stored in the anchor record in step . If a mismatch is found in step , this indicates manipulation and results in a fatal error in step . If a match is found in step  the correct system serial number is provided. Then the computer system continues with checking all entitlement records. In step  an entitlement record is decrypted using the public RSA key. Then in step  the entitlement record is checked by comparing the serial number (used as the system unique ID in the entitlement record) against the validated serial number of the anchor record. If a mismatch is found in step , then this indicates a manipulation of the entitlement record. Then the entitlement record is not accepted and marked \u2018unusable\u2019 in step . Only validated entitlement records will be accepted to enable system capacity in step .","Capacity entitled in permanent entitlement records is immediately enabled; capacity entitled in temporary entitlement records is made available to the customer for temporary upgrade whenever he decides to utilize this temporary capacity. The temporary upgrade and downgrade may be done manually or by automation to the extent as defined by the total of validated temporary entitlement records.","A simple embodiment only uses the non-volatile memory  of processor book  because the System Anchor record  only contains the value of ECID  as ECID . As long as processor book  stays in a configuration the other ECIDs , ,  are not used. Whenever processor book  is replaced by a new processor book the ECID  is obsolete and needs to be replaced by the ECID of the new processor book as well as the System Anchor record  must be replaced by a new System Anchor record to reflect the new ECID.","Since the System Anchor record  refers to processor book  it is recommended to store the System Anchor record  in the non-volatile memory  of processor book  only. The entitlement records , , ,  as system level configuration data, however, may not be stored in the non-volatile memories of the processor books but in some non-volatile system storage that is not exchanged as part of a processor book. An example is a hard disk storage of the computer system. This has the advantage that it is not required to transfer the entitlement records to the replacement hardware before the exchange. Another advantage is that is more difficult to clone the entitlement data and use it for a different computer system, for which it was not authorized by the manufacturer and\/or seller of the computer system.","Instead of processor book  also one of the other processor books , ,  could be used to store the system anchor record. But there is only one System Anchor record in use per computer system at the same time. For example, by defining an exchangeable component that is plugged in a dedicated slot of the computer system as the carrier of the System Anchor record, the management of the assignment of a System Anchor record to a particular computer system is simplified for the manufacturer and\/or seller. With this convention, only the subset of the exchangeable components comprising System Anchor records needs to be tracked separately.","Instead of the ECID , also another unchangeable identifier stored in the computer system can be used. The advantage of using ECID  is that it is guaranteed that it is always available for the System Anchor record  in case the processor book  is not broken. Otherwise, if the unchangeable identifier is stored in a different component, the System Anchor record can be unusable when this component is broken. However, if an unchangeable identifier is used which is stored in a component which cannot be replaced, the problem solved by the temporary entitlement records would not exist. In that case, all entitlement records will be associated to the computer system directly as the unchangeable identifier is then always available unless the entire computer system is (at least temporarily) broken.","Temporary Capacity","In the preferred embodiments of the invention, the flexible temporary capacity upgrade\/downgrade method and device for a computer system described in U.S. Pat. No. 7,194,616 are adapted accordingly. U.S. Pat. No. 7,194,616 introduces a so called Resource Controller that enables and disables processor capacity and other resources upon request. It enables the various resources up to a level as defined in Capacity Data Sets defining the maximum of permanent entitlements and the maximum of temporary entitlements. The entitlement records will be used as the Capacity Data Sets. The Capacity Data Sets are stored in a storage unit connected to a hardware console, which is part of the computer system.","This approach is not limited to protect resources of processor books. The entitlement records may include entitlements for I\/O (input\/output) adapters or other functions provided by the same computer system under the same system serial number, or separate entitlement records for such resources may be defined and linked to the System Anchor record.","The use of temporary capacity is under control of terms and conditions. Different types of temporary capacity with different terms and conditions for different purposes can be defined, e.g. one for backup capacity to be used for disaster recovery, or another one to be used for workload peaks. Appropriate use of temporary resources within the terms and conditions has to be enforced.","For example, for System z Capacity on Demand a set of temporary offerings is supported where each has its defined rules and limits, some of these rules and limits are specified in the order or in the billing system, some are hard coded in the System z firmware, and some are part of temporary entitlement records. However, each time a new offering type has to be introduced, the firmware needs to be changed because there are dedicated entitlement checking and backend processing paths for each offering type. Also some rules or terms and conditions even have to be enforced by manual intervention.",{"@attributes":{"id":"p-0048","num":"0051"},"figref":"FIG. 6","b":["600","605","610","600","610","600"]},"For type A, the firmware will check in step  if the activation request is for test purposes or for a real activation. Then in step  it will check if the associated entitlement record was used already more than 5 times for test purposes already. If that is the case, then the request  will be rejected in step . Otherwise or in case the request  was for a real activation, the firmware will check if a real activation is left for the entitlement record in step . If not, then the request  will be rejected also in step . Otherwise, the entitlement record will be activated in step . As part of the actual activation, the firmware will check in step  whether this was a real or a test activation, and a timer will be established and started in steps  and , respectively, by the firmware. This timer will expire 10 or 90 days after the activation, respectively. Once the timer is expired, the temporary capacity associated to the entitlement record will be disabled by the firmware.","For type B, the firmware will check if the associated entitlement record was already used once in step . If that is the case, then the request  will be rejected in step . Otherwise the entitlement record will be activated in step . After the activation, the firmware will report the activation time to the billing system of the manufacturer and\/or seller of the computer system in step . For example, such transmission can be performed using the Internet via a service processor and\/or a hardware console of the computer system.","Generation of Temporary Entitlement Records","When a customer orders temporary capacity, the temporary capacity entitlement records are generated as described for the entitlement records above. For the preferred embodiment of the invention, the following input is needed for the generation of a temporary entitlement record:\n\n","The desired entitlement data consists of a set of rules and corresponding limit values for the respective temporary capacity offering.","The selection of rules and limit values can be either done by the customer himself by showing him the complete list of rules that are supported in the machine, and let him decide which ones he wants to apply and what his limiting values should be, or the computer system manufacturer or seller could offer some pre-canned, pre-defined offerings that already contain \u201cbest practices\u201d rules and limits to simplify the ordering process for the customer.","For example, on a control panel of an entitlement record generator the following limiting values can be selected as desired, wherein the offering signature flags specify which rules\/limits are in effect:","Temporary Entitlement Record Generator",{"@attributes":{"id":"p-0057","num":"0062"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"147pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"MachineSN:","00000000000MNXK4"]},{"entry":[{},"UniqueRecordID","06665801"]},{"entry":[{},"Offering:","Type 02 \u2003\u2003Flags \u2003\u200300001001 \u200300100000"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}}}},"CPU Entitlement Definitions",{"@attributes":{"id":"p-0059","num":"0064"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"35pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"maxCPU#","n\/a","CPU tokens","n\/a"]},{"entry":[{},"maxCP_FC","n\/a",{},{}]},{"entry":[{},"maxSpeedSteps","n\/a",{},{}]},{"entry":[{},"maxMSU%","250","MSUtokens","n\/a"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]}}}}},"Specialty Engine Entitlement Definitions",{"@attributes":{"id":"p-0061","num":"0066"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"35pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"maxSAP#","6","SAP tokens","n\/a"]},{"entry":[{},"maxICF#","6","ICF tokens","n\/a"]},{"entry":[{},"maxIFL#","8","IFL tokens","n\/a"]},{"entry":[{},"maxzAAP#","8","zAAP tokens","n\/a"]},{"entry":[{},"maxzIIP#","8","zIIP tokens","n\/a"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]}}}}},"Expiration Conditions and Time Limits",{"@attributes":{"id":"p-0063","num":"0068"},"tables":{"@attributes":{"id":"TABLE-US-00004","num":"00004"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"77pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"21pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"ExpirationDate","Aug. 31, 2007","TimeExpiryGrace","\u20022"]},{"entry":[{},"#RealActivations","1","#RealActivationDays","90"]},{"entry":[{},"#TestActivations","0","#TestActivationDays","n\/a"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]}}}}},"In the example, a temporary entitlement record for the System z computer system with the serial number (MachineSN) 00000000000MNXK4 is created. The temporary entitlement record is given a unique record identifier by the entitlement record generator, which allows to uniquely identifying this particular temporary entitlement record. This record identifier can be overwritten by the user, e.g. for generating refill records. The Offering type and flags field is used to uniquely identify the offering type with respect to its terms and conditions and for billing purposes. For example, billing windows can be defined as 24-hour windows. Tokens according to IPCOM000139433D are decremented at the end of each billing window. The offering type can also be used e.g. to encode descriptive text to be displayed on the computer system panels.","This record comprises enablement data for a maximum of 6 SAPs (System Assist Processors) to be used by the System z Channel Subsystem (CSS), a maximum of 8 zAAPs (z Application Assist Processors) for Java processing in an operating system, a maximum of 8 IIPs (Integrated Information Processors), a maximum of 6 ICFs (Internal Coupling Facilities), and a maximum of 8 IFLs (Integrated Facilities for Linux). For example, \u201cIBM eServer zSeries 890 Technical Introduction\u201d, IBM Redbook, published by IBM Corporation, publication number SG24-6310-00, First Edition (May 2004), provides details for such System z computer system configurations.","The entitlement for CPU usage (standard Central Processors) to be used by the operating systems can be limited by the maximum number of CPUs plus their maximum speed delta (sub-capacity speed setting) relative to the permanent configuration (maxSpeedSteps), a MSU percentage, or a number of CP feature codes. MSU, sub-capacity settings, and CP feature codes are described e.g. in sections 1.3 and 1.4 of the above mentioned publication. The CP feature codes are used to encode the number of additional temporary CPs plus the number of permanent CPs with their changing speed (independent how many speed steps are added). The MSU percentage specifies how much MSU capacity relative to the permanent configuration can be added using this record. In this example, the maximum number of CPUs (maxCPU #), the maximum number of CP feature codes (MaxCP_FC) and the number of speed steps is not used for limiting CPU capacity, and therefore marked as n\/a (not applicable). The percentage of purchased MSUs that can be added using this temporary entitlement record is 250%. This means that 250% of the permanent MSUs are added, resulting in a total of 250%+100%=350% MSUs (permanent plus temporary MSUs).","The temporary entitlement record expires on Aug. 31, 2007 (ExpirationDate). No tokens will be used for any of the physical resources. The temporary entitlement record can be activated once (# RealActivations) for 90 days (# RealActivationDays). This temporary entitlement record cannot be activated for test purposes (# TestActivations), and so the duration for the test activation is not applicable (# TestActivationDays). The TimeExpiryGrace field specifies that 2 grace days are available before this temporary entitlement record is automatically deactivated after the expiration date or when the maximum number of activation days (90 in this example) is exceeded.","After processing the input data, the control panel will display the following signature data for the generated temporary entitlement record and also include this signature in the temporary entitlement record itself:\n\n","The signature flags provide the actual entitlement data of the temporary entitlement record, which was generated by the control panel for the input data. The \u20181\u2019 bits in the signature correspond one to one with the rule set that can be selected when generating temporary entitlement records. For example, the bits corresponding to fields where the user has entered \u2018n\/a\u2019 are 0, meaning this rule is not in effect for this temporary entitlement record. This also means the corresponding entitlement field is unlimited. This could be used e.g. for specifying that a temporary entitlement record can be activated an unlimited number of times\u2014by entering \u2018n\/a\u2019 in the # RealActivations field. Bits corresponding to fields where the user has entered entitlement limits are set to \u20181\u2019, telling the computer system that the corresponding rule needs to be verified and enforced.","In addition, the control panel can provide comments regarding the validity of the temporary entitlement records. In the above example, a warning could be provided to decrease the number of SAPs and other speciality engines in order to provide the required capacity for the CPs, given the physical machine configuration of machine SN 00000000000MNXK4.","Temporary Entitlement Records","According to the preferred embodiment of the invention, a flexible, version controlled certificate structure to control the temporary capacity will be used. An offering signature tells how to interpret this certificate structure. This certificate structure represents a set of rules that can be used in an offering in any combination, independent of each other. These rules are represented by control fields which can be grouped into resource limit fields (e.g. maximum number of processors or another representation of the processing capacity that can be added), time limit fields (e.g. expiration date or number of days a record can be active), and consumable token fields (e.g. processor day tokens or number of times this record can be activated). All temporary capacity entitlements are controlled via the same record structure.","A computer system according to an embodiment of the invention understands all these rules and therefore no changes to the firmware of the computer system are required when a new offering with a new combination of rules is defined. Not all rules are necessarily used for any given offering. The rules used for an offering can be defined by terms and conditions of the manufacturer or seller of the computer system, as well as by the customers desire to self-impose limits. If a certain rule is not in effect for an offering, this means this part of the offering is unlimited (used e.g. for specifying that a record can be activated an unlimited number of times).","Using this flexible certificate structure, new offerings can be easily generated by new combinations of existing rules, also without having to change the firmware of the computer system.","All the different control instances that are distributed across the computer system in the state of the art (e.g. number of activation days), order system (permanent to temporary capacity ratios), and back-end processing (expiration grace periods) can now be consolidated in one central control instance, that is, the temporary entitlement certificate. This means that a great number of Terms and Conditions of an offering are now directly and automatically controlled by the machine, rather than in the back-end processing and without relying on human audit.","Various methods to limit the temporary capacity entitlement can be used. For example, fixed processor counts or capacity settings for the target configuration can be used. But it is also possible to specify a range of target configurations that is automatically adjusted when the permanent configuration changes.","For example, an entitlement limit is the IBM System z MSU (Millions of Service Units) percentage. By using a percentage of the permanent configuration value rather than a fixed number, the range of possible target configurations is automatically adjusted after changes in the permanent machine capacity. Another example is the number of CP feature codes. A CP feature code limits the number of processors and\/or speed changes relative to the permanent configuration.","A version control is provided for the temporary entitlement records allowing adding new rules or changing the meaning of existing rules for future computer systems, if needed.",{"@attributes":{"id":"p-0079","num":"0085"},"figref":"FIG. 7","b":["700","700","710","700","720","720","64","730","740","750","750","740","730"]},"Activation of Temporary Capacity","Capacity from a temporary entitlement record can be activated either by manual action (via panels on a user console of the computer system) or via automation products that use application programming interfaces provided by the computer system. In both cases a data structure called activation level is received by the firmware of a computer system. This activation level contains a record identifier for the temporary capacity entitlement record from which resources should be activated, and information about the number and type of resources or other types of computer system capacity that should be activated.","The firmware of the computer system acts as a secure mechanism to import and control the activation request as illustrated in . When the firmware receives an activation level , it first checks in step  whether the corresponding entitlement record can be found in the non-volatile storage of the computer system. If not, the request is rejected immediately in step . The matching of an activation level with its corresponding temporary entitlement record is achieved by its unique record identifier.","If a matching entitlement record can be found, the firmware proceeds with step . The firmware does not need to know what type of offering is being processed. It just loops through all rules in the record, and compares the request specified within the activation level with the entitlement limits in the temporary capacity entitlement record.","The looping through all the rules in the temporary entitlement record is shown in more detail in . In step  it is determined, based on the offering signature, if the current rule is in effect for the temporary entitlement record. If not, the firmware continues with step . Otherwise, it is determined in step  if the request is within the allowed limits. Limiting factors could be record expiration conditions, maximum number of resources of a given type exceeded, or not enough tokens left in the token pools to satisfy this request. If any of the entitlement checks fails, the entire activation request is rejected in step . In step  the firmware determines now if all rules have been processed already. If not, the next rule will be processed in step .","If all entitlement checks have been passed, the requested resources are activated in step . After activation of these resources, the firmware loops through the rules again in step  and checks what back-end processes need to be started (e.g. decrement tokens in the entitlement record in non-volatile machine storage, setup timers to control expiration conditions, transmit certain data to the billing system, etc.). In step  the firmware determines again, if the current rule is in effect for the temporary entitlement record. If not, then the firmware continues with step . Otherwise, the firmware determines in step , which backend processed need to be started. Then in step  the firmware determines if all the rules have been processed for the entitlement record. If not, the next rule will be processed in step .","Multiple Temporary Capacity Offerings","As described above, permanent and temporary capacity is under control of entitlement records. As shown in  for a base configuration  of a computer system, the permanent entitlement record  and one temporary entitlement record  are stored in a secure storage . But different temporary entitlement records with different terms and conditions for different purposes could be defined, e.g. one for backup capacity to be used for disaster recovery, and another one to be used for workload peaks.","These temporary entitlement records are mutually exclusive, i.e. while a backup capacity record is active, no peak workload capacity can be activated, or vice versa. This dramatically restricts the way a customer can use his computer system as in the current System z computer systems only one temporary capacity record can be activated at a time. That is, when a computer system is used for regular production workload and also for reserve backup capacity, and temporary capacity is active to cover peak workloads, in a case of disaster of another computer system, there is no means to activate backup capacity without turning off the peak workload capacity first.",{"@attributes":{"id":"p-0089","num":"0095"},"figref":"FIG. 9","b":["940","950","940","960","970","940","940","980","990","940"]},{"@attributes":{"id":"p-0090","num":"0096"},"figref":"FIG. 10","b":["1000","1010","1020","1030","1040"]},"Also, in order to assist the customer in selecting the activation possibilities, for the entitlement data , ,  and their associated activation levels , ,  there is an associated valid movement list , ,  that shows at any given time all activation possibilities for the associated entitlement data based on the record entitlement concerning resource limits, currently available spare resources in the computer system, and taking into account all other concurrently active entitlement records at this time.","The activation levels , ,  and the valid movement lists , ,  can be stored in secure storage as well, but this is not mandatory since they are not critical entitlement data that is vulnerable to modifications. The valid movement lists , ,  can be recalculated at any given time, and the activation levels , ,  can be restored via panel actions or system management automation.","When a temporary entitlement record is installed in the computer system as described above, its firmware calculates the initial list of valid movements for this entitlement record and stores it. This is done by looping through all activation variations for this entitlement record, first filtering out all the positions that are not reachable because of insufficient record entitlement, and then filtering out all the positions that are not reachable because the machine does not have enough spare resources to activate the desired position. Especially, it needs to be ensured that all temporary entitlement records can be activated and deactivated in any order, so that all movements that would leave another currently active temporary entitlement record in a state where it can not be deactivated any more have to be filtered and must not appear in the list of valid movements.","This list can be generated in a 2-step approach for example. First, the computer system firmware loops through all possible configurations (which are a combination of number of processors and sub-capacity settings) of the computer system model. It then determines which delta in terms of processors and speed needs to be applied to the permanent computer system configuration (not considering other currently active temporary entitlement records) to reach the target configuration. These delta values are then checked against the temporary entitlement record limits. Delta values that exceed the temporary entitlement record limits are filtered out of this list. In a second step, the remaining list of delta values are checked against the current computer system configuration including the activation levels of all other currently active temporary entitlement records, and it is checked if enough spare resources are available in the computer system to apply those delta values to the current computer system configuration, or if applying these delta values would either result in a non-existent computer system configuration (e.g., due to exceeding the maximum sub-capacity speed setting for a computer system) or if it would leave other temporary entitlement records in a position where they can not be deactivated any more. If any of these conditions is true, the corresponding delta values are filtered out of the list. The remaining list of delta values comprises the list of valid movements for a temporary entitlement record.","When the first entitlement record with the associated entitlement data  gets activated, the firmware of the computer system receives an activation request command. This contains a requested activation level  structure that describes the desired target configuration. In step S the firmware of the computer system searches for the corresponding temporary entitlement record, and first checks that the request does not exceed the entitlement data of the temporary entitlement record. Then it checks whether enough spare resources are available to satisfy the request.","If all checks passed, the requested resources are activated in step S, and the activation levels  in the storage of the computer system is updated for this entitlement record. Then, the valid movement list  is recalculated. Otherwise, the activation request is rejected in step S.","When a second activation request and its activation level  for another entitlement record with the associated entitlement data  is received by the firmware, then in step S the firmware first checks again for the proper entitlement. Then it checks for available resources, and in step S it performs the actual activation. When the request was successful, it further checks in step S whether resources should be redistributed between the activation levels for the first and the second entitlement record. After the redistribution, the firmware writes the adjusted activation level  for the changed record back into storage of the computer system. Also, the valid movement list  is recalculated to reflect the current configuration of the computer system.","The same adjustment of activation levels and valid movement lists is performed for permanent model changes as well as for deactivations, for example to pick up pending resources for forced activation requests as described above. Also after activation, secure billing data is generated according to the rules in the entitlement record and sent to the billing system.","Location Awareness",{"@attributes":{"id":"p-0100","num":"0106"},"figref":"FIG. 11","b":["1100","1100","1110","1120","1130","1131","1132","1133","1134","1110","1120","1130","1131","1132","1133","1134","1140","1140","1150","1100"]},"The service element  maintains a rules database , which specifies system and\/or location specific rules for enabling system resources and functions. Further, the service element  is connected to a receiver . Preferably, the service element  comprises the receiver . In an alternative embodiment, the service processor  is connected to and comprises the receiver  instead of the service element .","The receiver  is connected to an antenna . Preferably, the receiver  comprises the antenna . Further, the receiver  comprises a private key  stored in a tamper protected storage and a processing unit (PU) . The receiver  can determine its local position using a dedicated service via signals received from the antenna . Examples for such services are the Global Positioning Signal (GPS) system or a Global System for Mobile Communication (GSM). Also combinations of GPS and GSM as e.g. described in U.S. Pat. No. 7,257,416 are possible. Preferably, the receiver uses GPS signals to determine the local position, which will be sent to the service element  as latitude\/longitude\/height coordinates, e.g. N 48.38745\u00b0\/E 8.56794\u00b0\/512.4 m. An implementation for a GPS based controller is described for example in U.S. Pat. No. 6,928,339 B2.","Before the receiver  sends the local position information to the service element , it is encrypted by the processing unit  using the private key . Preferably, the RSA (Rivest Shamir Adleman) algorithm is used for the encryption of the local position information. The service element  receives the encrypted local position information and passes it on to a firmware component that is interpreting the rules database  and controlling the actual enablement of the system resources. This firmware component can either run on one of the processors of the processor books  which has in-band control to other processors, I\/O, memory, or other resources\/functions of the computer system , or run on the service element  which can control these computer system resources\/functions out of band.","The firmware component receives the local position information and decrypts it using the public key corresponding to the private key . If the decryption fails, or unencrypted information is received from the service element , this is treated as invalid local position information.","The rules database  is stored in a non-volatile storage of the system element , e.g. on an integrated hard disk. The rules database  is generated and installed during manufacturing of the computer system . The rules database  can be changed by the service element  later on by receiving new data from the computer manufacturer and\/or seller. Such data can be provided to the service element  using a network connection to a server system and\/or using computer-readable media.","As shown in , the rules database  comprises a number of rules . Each rule consists of a function field , position information field , a violation rules field , and a function enablement indicator field . The function enablement field  indicates whether the function\/resource is enabled in the computer system . The function field  consists of entitlement data describing the function\/resource enabled by the rule . In the preferred embodiment of the invention, the entitlement data is implemented and processed in form of permanent and temporary entitlement records as described above. Examples for description data are the name of a specific resource of the computer system  such as the System z Crypto function, the maximum number and speed of processors of each type that may be enabled on the computer system , the maximum number and type of I\/O adapters that can be enabled, the maximum memory size allowed, certain other performance measures, etc.","The position information field  comprises either an indication that the rule  is position independent, i.e. the feature is enabled on all computer systems, or specific location information for the rule . Example location information data are the coordinates of the current local position plus a certain radius, a map area, etc. Preferably, the map area defines state boundaries. For example, this allows the manufacturer and\/or seller of the computer system  to be compliant with export regulation laws in case a certain function may only be enabled within the state boundaries of one or more countries, e.g. the member states of the European Union. Further, it allows preventing a resale of the entire computer system  from a market with cheaper prices to a market with higher prices. Another potential application is to bind the functionalities\/resources of a computer system to a dedicated customer, hence allowing price reductions for this customer without compromising the overall price structure for the product in the market.","If a function\/resource is enabled in the computer system  but the corresponding requirements (e.g. the location) are not met, certain penalty rules can be applied. Example penalties are the disablement of the function, possibly after a certain time delay, an alert to be sent to the manufacturer and\/or seller, penalty billings, etc. The violation rules field  comprises the applicable penalties for the rule .","The functions\/resources of the computer system  can be classified in:\n\n","The receiver  can belong to either of the first two classes. The functions\/resources, which are enabled based on the current local position, are only enabled if valid local position information is available and matches the rules for this specific function\/resource in the rules database . The functions\/resources do not necessarily need to be physical resources in the computer system . Any feature of a computer program executed on the computer system  can be chosen. Such features can be enabled or disabled based on a rule . A standardized application programming interface (API) can be provided, which is shared between the various computer programs executed on the computer system . Via this API, the rules database  can be modified and queried in order to enable support for additional features, which are not defined and controlled by the manufacturer and\/or seller of the computer system .","Since the location information in the rules database  generated by the manufacturer and\/or seller is typically in a granularity defining country\/state or even continent boundaries, the user of the computer system  can optionally specify his own rule databases to get better granularity for the location information in an embodiment of the invention. Also, the rules database  can optionally be further refined by area specific policies defined by the user himself, e.g. location specific power consumption considerations for a specific building on a site (e.g., power cost or heat considerations), location specific performance requirements, etc.","This is illustrated in . In country A, the user defines a first cell  and a second cell , and in country B a single third cell . The cells , ,  do not overlap and cover a part of the territories of the respective countries only. This allows to model zones and localities as described e.g. in US 2003\/0008661 A1. Further possible applications can be based on distributed computing services such as clustering, wherein other computer systems in the neighborhood of a computer system are integrated.","Activation or enablement of resources\/functions in the computer system  can not only be triggered by the initial setup, but also later during machine runtime by system automation software like workload managers which can activate resources\/functions based on policies and goal fulfillment, within the rules of the rules databases. This means part or all of the resources\/functions that are allowed according to the rules database could be activated. On each activation request the machine firmware would verify the request against the entitlement rules in the rules database, taking into account the current local position. If valid local position information is not available or the request exceeds the entitlement rules, the request is rejected.",{"@attributes":{"id":"p-0114","num":"0123"},"figref":"FIG. 13","b":["1300","1100","1160","1100","1305","1310","1305","1310","1170","1150"]},"In step  the service element receives initial local position information from the receiver . Then it will be checked in step  if valid position information is received. The validity is determined via the decryption using the public key. For example, invalid position information can be caused by the disconnection of the receiver  from the service element  or by connecting an unsupported receiver, which does not contain a supported private key. If no valid position information was received, then it will be checked in step  if a certain threshold of unsuccessful receive operations was already reached. If the threshold is not exceeded, then new local position information will be received in step . Subsequently, step  will be performed again.","If the threshold is already exceeded, then the firmware component will loop through all rules in the rules database  in step . In step  it will be determined if the resources\/functions specified by the current rule are already enabled. If so, then these resources\/functions will be disabled and the violation rules specified by the current rule will be processed in step . In step  it will be determined if the current rule is the last rule in the rules database . If not, then the next rule will be processed in step . Otherwise, after a predefined delay, the firmware component receives local position information again in step . Then in step  it will be determined, if a deviation from the previous local position information occurred. If not, then step  will be performed again. Otherwise the firmware component continues the execution with step  as described above.","If, in step , it is determined that the received local position information is valid, then the firmware component loops through all the rules in the rules database . Then it will be tested in step  if the local position information field of the current rule matches the current local position. If that is the case, then the resources\/functions specified by the current rule will be enabled in step . Then it will be determined in step  if the current rule is the last rule in the rule database . If not, then the firmware component continues with step  as described above. If the local position field does not match the current local position, then it will be checked in step  if the resources\/functions specified by the current rule are already enabled. If not, the firmware component continues with step . If the resources\/functions are already enabled, then they will be disabled and the violation rules in the current rule will be performed in step . Then the firmware component continues with step .","If it is determined in step  that the current rule is the last rule in the rules database , then new local position information is received in step  after a predefined delay. If a deviation to the previous local position information is detected in step , then the firmware component continues to re-evaluate the rules in the rules database  in step  for this new local position information as described above. For example, a deviation from the previous local position information can be declared if the new and the previous coordinates are more than twice the tolerance of a GPS position signal with a certain quality and sufficient satellites in view. If no new local position information is received, this can be handled either in step  as the detection of a deviation or step  as invalid local position information.","If no deviation from the previous position information and no invalid local position information are received, then the firmware component is in a steady state and will not change the enablement of the resources\/functions in the computer system . In this steady state the firmware component continues to periodically receive local position information and check for deviation and invalid local position information in order to decide whether the rules in the rules database  need to be re-evaluated.","Additional Embodiment Details","The described techniques may be implemented as a method, apparatus or article of manufacture involving software, firmware, micro-code, hardware and\/or any combination thereof. The term \u201carticle of manufacture\u201d as used herein refers to code or logic implemented in a medium, where such medium may comprise hardware logic [e.g., an integrated circuit chip, Programmable Gate Array (PGA), Application Specific Integrated Circuit (ASIC), etc.] or a computer readable medium, such as magnetic storage medium (e.g., hard disk drives, floppy disks, tape, etc.), optical storage (CD-ROMs, optical disks, etc.), volatile and non-volatile memory devices [e.g., Electrically Erasable Programmable Read Only Memory (EEPROM), Read Only Memory (ROM), Programmable Read Only Memory (PROM), Random Access Memory (RAM), Dynamic Random Access Memory (DRAM), Static Random Access Memory (SRAM), flash, firmware, programmable logic, etc.]. Code in the computer readable medium is accessed and executed by a processor. The medium in which the code or logic is encoded may also comprise transmission signals propagating through space or a transmission media, such as an optical fiber, copper wire, etc. The transmission signal in which the code or logic is encoded may further comprise a wireless signal, satellite transmission, radio waves, infrared signals, Bluetooth, etc. The transmission signal in which the code or logic is encoded is capable of being transmitted by a transmitting station and received by a receiving station, where the code or logic encoded in the transmission signal may be decoded and stored in hardware or a computer readable medium at the receiving and transmitting stations or devices. Additionally, the \u201carticle of manufacture\u201d may comprise a combination of hardware and software components in which the code is embodied, processed, and executed. Of course, those skilled in the art will recognize that many modifications may be made without departing from the scope of embodiments, and that the article of manufacture may comprise any information bearing medium. For example, the article of manufacture comprises a storage medium having stored therein instructions that when executed by a machine results in operations being performed.","Certain embodiments can take the form of an entirely hardware embodiment, an entirely software embodiment or an embodiment containing both hardware and software elements. In a preferred embodiment, the invention is implemented in software, which includes but is not limited to firmware, resident software, microcode, etc.","Furthermore, certain embodiments can take the form of a computer program product accessible from a computer usable or computer readable medium providing program code for use by or in connection with a computer or any instruction execution system. For the purposes of this description, a computer usable or computer readable medium can be any apparatus that can contain, store, communicate, propagate, or transport the program for use by or in connection with the instruction execution system, apparatus, or device. The medium can be an electronic, magnetic, optical, electromagnetic, infrared, or semiconductor system (or apparatus or device) or a propagation medium. Examples of a computer-readable medium include a semiconductor or solid state memory, magnetic tape, a removable computer diskette, a random access memory (RAM), a read-only memory (ROM), a rigid magnetic disk and an optical disk. Current examples of optical disks include compact disk-read only memory (CD-ROM), compact disk-read\/write (CD-R\/W), digital versatile disc-ROM (DVD-ROM), DVD-RAM, Blue-ray disc RAM (BD-RAM), BD-ROM.","The terms \u201ccertain embodiments\u201d, \u201can embodiment\u201d, \u201cembodiment\u201d, \u201cembodiments\u201d, \u201cthe embodiment\u201d, \u201cthe embodiments\u201d, \u201cone or more embodiments\u201d, \u201csome embodiments\u201d, and \u201cone embodiment\u201d mean one or more (but not all) embodiments unless expressly specified otherwise. The terms \u201cincluding\u201d, \u201ccomprising\u201d, \u201chaving\u201d and variations thereof mean \u201cincluding but not limited to\u201d, unless expressly specified otherwise. The enumerated listing of items does not imply that any or all of the items are mutually exclusive, unless expressly specified otherwise. The terms \u201ca\u201d, \u201can\u201d and \u201cthe\u201d mean \u201cone or more\u201d, unless expressly specified otherwise.","Devices that are in communication with each other need not be in continuous communication with each other, unless expressly specified otherwise. In addition, devices that are in communication with each other may communicate directly or indirectly through one or more intermediaries. Additionally, a description of an embodiment with several components in communication with each other does not imply that all such components are required. On the contrary a variety of optional components are described to illustrate the wide variety of possible embodiments.","Further, although process steps, method steps, algorithms or the like may be described in a sequential order, such processes, methods and algorithms may be configured to work in alternate orders. In other words, any sequence or order of steps that may be described does not necessarily indicate a requirement that the steps be performed in that order. The steps of processes described herein may be performed in any order practical. Further, some steps may be performed simultaneously, in parallel, or concurrently.","When a single device or article is described herein, it will be apparent that more than one device\/article (whether or not they cooperate) may be used in place of a single device\/article. Similarly, where more than one device or article is described herein (whether or not they cooperate), it will be apparent that a single device\/article may be used in place of the more than one device or article. The functionality and\/or the features of a device may be alternatively embodied by one or more other devices which are not explicitly described as having such functionality\/features. Thus, other embodiments need not include the device itself.",{"@attributes":{"id":"p-0128","num":"0137"},"figref":["FIG. 15","FIG. 9"],"b":["1500","1500","1502","1504","1500","1506","1508","1508","1508","1500","1510","1512","1506","1504","1502","1510","1512","1508","1510","1502","1510","1510","1506","1502"]},"Certain embodiments may be directed to a method for deploying computing instruction by a person or automated processing integrating computer-readable code into a computing system, wherein the code in combination with the computing system is enabled to perform the operations of the described embodiments.","At least certain of the operations illustrated in the figures may be performed in parallel as well as sequentially. In alternative embodiments, certain of the operations may be performed in a different order, modified or removed.","Furthermore, many of the software and hardware components have been described in separate modules for purposes of illustration. Such components may be integrated into a fewer number of components or divided into a larger number of components. Additionally, certain operations described as performed by a specific component may be performed by other components.","The data structures and components shown or referred to in the figures and the description are described as having specific types of information. In alternative embodiments, the data structures and components may be structured differently and have fewer, more or different fields or different functions than those shown or referred to in the figures.","Therefore, the foregoing description of the embodiments has been presented for the purposes of illustration and description. It is not intended to be exhaustive or to limit the embodiments to the precise form disclosed. Many modifications and variations are possible in light of the above teaching."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE SEVERAL VIEWS OF THE DRAWINGS","p":["The present invention and its advantages are now described in conjunction with the accompanying drawings.",{"@attributes":{"id":"p-0010","num":"0013"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0011","num":"0014"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0012","num":"0015"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0013","num":"0016"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0014","num":"0017"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0015","num":"0018"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0016","num":"0019"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0017","num":"0020"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0018","num":"0021"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0019","num":"0022"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0020","num":"0023"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0021","num":"0024"},"figref":"FIG. 12"},{"@attributes":{"id":"p-0022","num":"0025"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0023","num":"0026"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0024","num":"0027"},"figref":"FIG. 15"}]},"DETDESC":[{},{}]}
