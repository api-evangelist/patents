---
title: Enhanced virtual storage replication
abstract: Systems and methods of enhanced virtual storage replication are disclosed. An exemplary method comprises moving a virtual tape from a local virtual library to a remote virtual library. The method also comprises ejecting the virtual tape moved to the remote virtual library. The method also comprises recycling the ejected virtual tape at the local virtual library based on a remote retention policy.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08850142&OS=08850142&RS=08850142
owner: Hewlett-Packard Development Company, L.P.
number: 08850142
owner_city: Houston
owner_country: US
publication_date: 20090915
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","DETAILED DESCRIPTION"],"p":["Storage devices commonly implement data replication operations using local and remote virtual library storage (VLS) for data recovery, also commonly referred to as \u201cautomigration\u201d or \u201ctape caching.\u201d Automigration automatically mirrors virtual \u201ctapes\u201d on a local VLS to a remote device (either another VLS or a physical library).","A user may want to have different retention times for backup data on the local and remote libraries. For example, the user may want to store one month of backup data locally while storing six months of backup data at the remote library. However, strict identity between the local and remote libraries needed to implement automigration operations prohibits different retention times. By definition, strict identity or having the same data on both the local and remote libraries, necessitates the same retention time for both devices.","It may be possible to implement an out-of-band application programming interface (API) between the backup application and the virtual library (e.g. using the SMI-S or NDMP protocols) to allow the backup application to control the copy processes between the two virtual libraries. By allowing the backup application to control the copy processes, the local and remote tapes may be managed independently (e.g., have different barcodes and therefore be recognized as two different tapes by the backup application). However, this scheme would require significant changes to the backup application to support the API. Most if not all commercially available backup applications do not have this capability.","Systems and methods are disclosed for enhanced virtual storage replication. It is noted that the term \u201creplication\u201d is used herein to refer to backup operations including echo-copy and other proprietary and non-proprietary data operations now known or later developed. Briefly, a storage system is disclosed including a local storage device and a remote storage device. Data (e.g., backup data for an enterprise) is maintained in a virtual storage library at the local storage device. The data can be replicated to another virtual storage library at the remote storage device.","As briefly mentioned above, for automigration to function properly with the backup application there needs to be identity between the tapes on the local VLS and the remote device. Accordingly, automigration automatically matches barcode and tape sizes between the local VLS and remote devices. If the virtual tape is modified on the local VLS, the virtual tape is automatically copied to the matching remote tape.","It may be desirable to eject the tape from the remote device, e.g., for long-term archiving. In the case of a remote VLS, \u201cejecting\u201d the tape means moving the virtual tape out of the virtual library and into a designated location often referred to as a \u201cfire safe.\u201d The fire safe is \u201chidden\u201d from the backup application so that the remote tape appears to the backup application as having been ejected. Whether the remote tape is physically ejected or \u201cejected\u201d from the VLS, the matching tape at the local VLS is also ejected. Again, \u201cejecting\u201d the tape from the VLS is accomplished by removing the local tape to the local fire safe and then, for housekeeping purposes, automatically deleting the local tape from the fire safe after a predetermined time.","The systems and methods described herein enable an automatic tape recycling system for virtual library products. The systems and methods may be implemented between two virtual libraries (e.g., local and remote virtual libraries) to move the tape on the local virtual library to the remote virtual library. That is, after the remote copy is complete the local copy is automatically deleted and the remote copy is \u201cejected\u201d from the virtual library. The ejected tapes are then automatically \u201crecycled\u201d after a predetermined time so that the once-ejected tapes are reloaded back into the remote virtual library. The ejected tapes may be recycled based on a recycle policy (e.g., including user-defined criteria). In addition, new virtual tapes may be automatically created to feed into the virtual library as needed.","In exemplary embodiments, any backup application that supports tape-to-tape copy may be implemented without needing direct integration between the backup application and the virtual libraries. In addition, the customer can have different data retention times between the local virtual library and the remote virtual library. For example, the customer may store one month of backups locally while storing 6 months of backups at the remote virtual library.","Before continuing, it is noted that non-tape \u201clibraries\u201d may also benefit from the teachings described herein, e.g., files sharing in network-attached storage (NAS) or other backup devices. In addition, the remote virtual library (or more generally, \u201ctarget\u201d) may be physically remote (e.g., in another room, another building, offsite, etc.) or simply \u201cremote\u201d relative to the local virtual library. It is also noted that exemplary operations described herein for enhanced virtual storage replication may be embodied as logic instructions on one or more computer-readable medium. When executed by one or more processor, the logic instructions cause a general purpose computing device to be programmed as a special-purpose machine that implements the described operations.",{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 1","b":["100","110","120","100","120","120","125","125","130","130","100","140","142","140","100"],"i":["a","c ","a","c ","a","c "]},"It is also noted that the terms \u201cclient computing device\u201d and \u201cclient\u201d as used herein refer to a computing device through which one or more users may access the storage system . The computing devices may include any of a wide variety of computing systems, such as stand-alone personal desktop or laptop computers (PC), workstations, personal digital assistants (PDAs), server computers, or appliances, to name only a few examples. Each of the computing devices may include memory, storage, and a degree of data processing capability at least sufficient to manage a connection to the storage system  via network  and\/or direct connection .","In exemplary embodiments, the data is stored on one or more local VLS . Each local VLS  may include a logical grouping of storage cells. Although the storage cells  may reside at different locations within the storage system  (e.g., on one or more appliance), each local VLS  appears to the client(s) -as an individual storage device. When a client -accesses the local VLS  (e.g., for a read\/write operation), a coordinator coordinates transactions between the client -and data handlers for the virtual library.","Redundancy and recovery schemes may be utilized to safeguard against the failure of any cell(s)  in the storage system. In this regard, storage system  may communicatively couple the local storage device  to the remote storage device  (e.g., via a back-end network  or direct connection). In an exemplary embodiment, the back-end network  is a WAN and may have only limited bandwidth. As noted above, remote storage device  may be physically located in close proximity to the local storage device . Alternatively, at least a portion of the remote storage device  may be \u201coff-site\u201d or physically remote from the local storage device , e.g., to provide a further degree of data protection.","Remote storage device  may include one or more remote virtual library, system (VLS) -(also referred to generally as remote VLS ) for replicating data stored on one or more of the storage cells  in the local VLS . Although not required, in an exemplary embodiment, deduplication may be implemented for replication.","Deduplication has become popular because as data growth soars, the cost of storing data also increases, especially backup data on disk. Deduplication reduces the cost of storing multiple backups on disk. Because virtual tape libraries are disk-based backup devices with a virtual file system and the backup process itself tends to have a great deal, of repetitive data, virtual tape libraries lend themselves particularly well to data deduplication. In storage technology, deduplication generally refers to the reduction of redundant data. In the deduplication process, duplicate data is deleted, leaving only one copy of the data to be stored. However, indexing of all data is still retained should that data ever be required. Deduplication is able to reduce the required storage capacity.","With a virtual tape library that has deduplication, the net effect is that, over time, a given amount of disk storage capacity can hold more data than is actually sent to it. For purposes of example, a system containing 1 TB of backup data which equates to 500 GB of storage with 2:1 data compression for the first normal full backup.","If 10% of the files change between backups, then a normal incremental backup would send about 10% of the size of the full backup or about 100 GB to the backup device. However, only 10% of the data actually changed in those files which equates to a 1% change in the data at a block or byte level. This means only 10 GB of block level changes or 5 GB of data stored with deduplication and 2:1 compression. Over time, the effect multiplies. When the next full backup is stored, it will not be 500 GB, the deduplicated equivalent is only 25 GB because the only block-level data changes over the week have been five times 5 GB incremental backups. A deduplication-enabled backup system provides the ability to restore from further back in time without having to go to physical tape for the data.","Regardless of whether deduplication is used, the transfer of data from the local storage device to the remote storage device and data handling may be enhanced by enabling different retention times for data stored at the local and remote virtual libraries. Replication and data handling may also be enhanced by automatically recycling tapes that have been ejected from the remote virtual library based on a recycling policy. Enhanced virtual storage replication as such may be better understood by the following discussion and with reference to .",{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 2","b":["200","100","200","230","230","125","155","230","125","230","155","125","155"],"i":["a","b ","a ","b "]},"At the local VLS , automigration component may also include a replication manager . Replication manager  may cooperate with the automigration component at the remote VLS  to move at least one virtual tape from the local VLS  to the remote VLS . Replication manager  may be implemented as program code, and is enabled for managing replication of data between the local VLS  and remote VLS .","In order to replicate data from the local VLS  to the remote VLS , the replication manager  provides a software link between the local VLS  and the remote VLS . The software link enables data (e.g., copy\/move jobs, setup actions, etc.) to be automatically transferred from the local VLS  to the remote VLS . In addition, the configuration, state, etc. of the remote VLS  may also be communicated between the automigration components , ","It is noted that although implemented as program code, the automigration components , may be operatively associated with various hardware components for establishing and maintaining a communications link between the local VLS  and remote VLS , and for communicating the data between the local VLS  and remote VLS  for replication.","It is also noted that the software link between automigration layers , may also be integrated with deduplication technologies. In this regard, exemplary embodiments may be implemented over a low-bandwidth link, utilizing deduplication technology inside the virtual libraries to reduce the amount of data transferred over the link.","In use, the user can setup enhanced replication at the local VLS  via the replication manager , and run tape-to-tape copies in a user application  (e.g., the backup application) to replicate data from the local VLS  back into itself onto the tapes in a copy pool. These copy tapes are then automatically moved to the remote VLS  and new replacement tapes for subsequent copies are recycled\/created. Accordingly, any backup application that supports tape-to-tape copy may be implemented without needing any direct integration between the backup application  and the virtual libraries , .","The automigration component may also include a recycle manager  which may implement recycling operations using a recycle policy . When a modified tape is successfully copied to the matching tape on the remote VLS , the remote tape is automatically ejected (e.g., into the remote fire safe or \u201chidden\u201d location). The existing functionality therefore automatically ejects the matching local tape (e.g., into the local fire safe ), and then automatically deletes the local tape. This may occur immediately if the default expiration policy for ejected tapes is set to zero days, or at some other suitable time (e.g., during off-hours). Accordingly, the modified tape has been moved to the remote virtual library and is effectively stored in the remote fire safe ","The ejected tapes may be automatically replaced by new or recycled tapes for the next replication cycle. In this regard, the user may specify a retention policy defining how long to wait before recycling tapes. The retention policy may match the retention policy defined in the user's backup application.","In an exemplary embodiment, automigration components , may include separate retention policies, e.g., a local retention policy at the local VLS  and a remote retention policy at the remote VLS . Accordingly, the user can have different data retention times at the local VLS  and the remote VLS . For example, the user may store one month of backups locally while storing six months of backups remotely.","The user may also create a barcode policy  defining new tapes. Accordingly, the remote VLS  uses these policy settings to replace the ejected tapes. Tapes may be replaced by either moving existing tapes in the fire safe that are older than the defined recycle time in the recycle policy , or automatically create new tapes (e.g., if there are not enough tapes to replace the number of ejected tapes).","Alternatively, the user may define in the barcode policy  a minimum number of tapes specifying how many tapes should be in the copy pool . If this option is used, then if the number of recycled tapes is less than the minimum tapes number then the remaining tapes are automatically created based on the barcode policy  to meet this minimum number.","It should be noted that when an existing tape in the remote fire safe is recycled by moving the tape back into the remote VLS , this process automatically creates a matching tape in the local VLS  including tape information (e.g., the header originally written by the backup application).","If the user needs to restore from a remote tape in the remote virtual library, the user can move the tape out of the remote fire safe into the remote VLS  and either restore the tape directly from the remote VLS , or transfer the tape back to the local VLS  for restore operations.","It is noted that the \u201ceject\u201d and recycle operations may automatically repeat on any suitable basis. For example, these operations may be invoked on a periodic or other timing basis, or based at least in part on other parameters such as usage. In another example, the eject and recycle operations may only be invoked in response to user input.",{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 3","b":["300","310"]},"In operation , the virtual tape moved to the remote virtual library in operation  is ejected. For example, the virtual tape may be moved based on a local retention policy. In operation , the ejected virtual tape is recycled based on a remote retention policy. The retention policy may be user-defined. The local retention policy may define a different retention time than defined by a remote retention policy.","Other operations not shown in  may also be implemented in other embodiments. Further operations may include creating new virtual tapes on an as-needed basis. For example, creating new virtual tapes may be based on a barcode policy. The barcode policy may define a minimum number of virtual tapes for backup operations at the local virtual library. The new virtual tapes may be created when the number of virtual tapes available for backup operations at the local virtual library is less than the minimum number of virtual tapes defined in the barcode policy.","It is noted that when ejecting and recycling tapes (based on recycling and retention policies) the backup and recycling managers can manage the data in each virtual library without modification to the backup application. Note that the larger virtual libraries have multiple virtual library servers or \u2018emulations\u2019 of servers within one library, so the backup and recycling managers may dynamically control the replication jobs per server and evenly distribute the jobs across the servers based on job limits per server.","It is noted that retention times and recycling policies, such as described herein, may be based on any of a variety of different factors, such as, but not limited to, storage limitations, corporate policies, legal requirements, or as otherwise determined by the user.","It is noted that the exemplary embodiments shown and described are provided for purposes of illustration and are not intended to be limiting. Still other embodiments are also contemplated for enhanced virtual storage replication."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0005","num":"0004"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 3"}]},"DETDESC":[{},{}]}
