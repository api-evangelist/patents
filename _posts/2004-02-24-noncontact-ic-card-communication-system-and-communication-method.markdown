---
title: Noncontact IC card communication system and communication method
abstract: Communication processing is performed so as to correspond to multiple types of contactless IC cards having different specifications, such as command classes and security algorithms. Without performing a process for a command or response result communicated with an IC card, a reading device encapsulates the command or result into a command that is called a through command and that is independent of the type of IC card and delegates the process to a controller module. Thus, the reading device is independent of the type of IC card. A command and a process procedure which depend on the type of IC card are taken care of by a replaceable software module that is provided in the controller module and that corresponds to the card.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08143998&OS=08143998&RS=08143998
owner: Sony Corporation
number: 08143998
owner_city: Tokyo
owner_country: JP
publication_date: 20040224
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND ART","DISCLOSURE OF INVENTION","BEST MODE FOR CARRYING OUT THE INVENTION","INDUSTRIAL APPLICABILITY"],"p":["The present invention relates to contactless communication systems for performing transmission between a primary coil and a secondary coil by utilizing an electromagnetic induction effect. In particular, the present invention relates to a contactless-IC-card communication system and a communication method in which an IC card having a secondary coil transmits a response signal as a result of load variation in response to an electromagnetic-based query signal transmitted from a card reading device having a primary coil.","More specifically, the present invention relates to a contactless-IC-card communication system and a communication method in which a card reading device performs communication processing with a contactless IC card by using a predetermined command class and a security algorithm through a predetermined card-detection procedure. In particular, the present invention relates to a contactless-IC-card communication system and a communication method for performing communication processing for multiple types of contactless IC cards having different specifications, such as command classes and security algorithms.","One example of wireless communication means that are locally applicable is a contactless IC card.","This type of wireless communication is commonly achieved based on an electromagnetic induction principle. That is, the configuration includes, at least, an IC card having a memory function and a card reader\/writer that performs read\/write access on the memory of the IC card. An IC-card-side loop coil, which serves as a primary coil, and a card-reader\/write-side antenna, which serves as a secondary coil, form one transformer as a unit. The card reader\/writer transmits power and information to the IC card by similarly using an electromagnetic induction effect and the IC card is actuated by the supplied power to thereby be able to respond to a query signal from the card reader\/writer.","The card reader\/writer modulates current to be supplied to the antenna to thereby cause a loop-coil induced voltage on the IC card to be modulated. Due to the effect, the card reader\/writer can transmit data to the IC card. Also, a variation in load between loop-coil terminals of the IC card causes an impedance between antenna terminals of the IC card reader\/writer to change, so that a voltage and current passing through the antenna fluctuate. Due to the effect, the IC card returns a response to the card reader\/writer.","A contactless proximity communication system, typified by an IC card, is beginning to become widespread because of simplicity in operation. For example, with an IC card on which personal identification code, other personal authentication information, and value information of an electronic ticket or the like are stored, a card reader\/writer installed at a cash dispenser, an entrance of a concert venue, or a ticket gate of a station can perform authentication processing by performing contactless access to the IC card held by the user.",{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 9","b":["1","2","4","8","6","4","6","2"]},"The card reading\/writing device  constantly transmits a polling command to IC cards. When the user approaches the ticket gate machine  while carrying the IC card , the card reading\/writing device  installed on the ticket gate machine  detects the approaching of the IC card  (i.e., detects the card) and performs communication (collision avoidance and card determination) with the IC card . When the passage is permitted after the billing process and mutual authentication process are performed on the user, the passage gate  is opened to permit the user to pass through the ticket gate.","Recently, IC cards having memory spaces with relatively large capacities have emerged in conjunction with improvements in micro-fabrication technology. Since an IC card having a large-capacity memory can store multiple applications (or services) at the same time, one IC card can be used for multiple applications. For example, when many services, such as electronic money for electronic payment, an electronic ticket for entry into a specific concert venue, are stored on one IC card, the IC card can be applied to various applications.","Further, when an individual device is equipped with both functions of the IC card and the card reader\/writer, the IC card technology can be utilized for a versatile bidirectional proximity communication interface. For example, when a proximity communication system is constituted by such apparatuses as a computer and a home-electronic information apparatus, the communication is performed on a one-to-one basis. Also, one apparatus can communicate with a non-apparatus counterpart device (which will be referred to as a \u201ccard\u201d), such as a contactless IC card. In such a case, an application for performing one-to-many communication between one apparatus and multiple cards is also possible.","While IC cards are rapidly coming to widespread use, there is also a problem in that multiple interface standards coexist. For example, although international standardization for proximity contactless IC cards have been promoted based on ISO\/IEC 14443, there are still two types of specifications: type A and type B. Accordingly, in order to detect which type of card enters the operation space, the reader periodically and alternately transmits respective request commands (e.g., refer to \u201cRFID Handbook\u2014Principle and Application of Contactless IC Card\u201d by Ryoji Iga et al., pp 175-187 (Kabushikigaisha Software Kogaku Kenkyusho). Other than those standards, card venders that manufacture and sell IC cards and card reading devices provide various interface standards for their IC cards. Further, the current situation is that command classes are different from each other, even when interface standards are the same.","The biggest problem in the contactless IC card technology is that different standards preclude compatibility and thus compatibility cannot be achieved in many cases even if standards are the same. The reason is that, while specifications up to a certain portion are specified for each standard, other specifications are independently formulated, thus making it impossible to achieve compatibility in the following points.","(1) Difference in Upper Layer Protocol","(2) Difference in Command Class","(3) Difference in Command Execution Procedure","(4) Difference in Security Algorithm","(5) Difference in Data Structure in Memory Space on Card","Examples of the security algorithms include a mutual authentication scheme, an encryption scheme during data communication, checksum and MAC (message authentication code) generation methods. However, since those algorithms have security problems, the card venders do not make the specifications public.","With regard to minimum specifications including physical and electrical specifications, ISO\/IEC 14443 specifies procedures performed when a card reading device detects an IC card, such as initialization, collision avoidance, and card determination for each type, but does not have stringent rules with regard to procedures after card determination. Therefore, the current situation is that a card-reading command and other commands after card determination vary among card venders and thus compatibility is not maintained even the commands are within the same interface standard.","In order to overcome such a difference between standards of the card venders, for example, an approach in which a process (firmware) corresponding to a card type is burned on an IC chip of a single card reading device is employed. For example, in an example shown in , a process firmware corresponding to a card specification supplied by company A and a process firm ware corresponding to a card specification supplied by company B are burned on an IC-chip ROM (read only memory) in a card reading device, so that a corresponding firmware is selectively executed in accordance with a card detected via an antenna so as to achieve compatibility with the respective cards of the venders.","According to the example shown in , a single card reading device can perform processing for contactless IC cards of different card venders. However, in order to achieve compatibility with a new type of card, work for re-burning a firmware in the IC chip arises. This requires development cost and maintenance cost for the replacement work. Also, this approach cannot be used for all cases, since some card venders do not disclose their security algorithms related to card processing.","Other methods for overcoming such a difference between standards of the card venders involve a method in which a card-dependent process is stored in chip-module hardware, instead of burning a process on the IC chip, and the hardware is inserted in a slot of the card reading device. For example, in an example shown in , a card reading device is provided with a plurality of chip module slots for replaceably inserting chip modules for card processing. Thus, when a chip module for a process corresponding to a card specification supplied by company A and a chip module for a process corresponding to a card specification supplied by company B are inserted into the respective slots, a corresponding process firmware is selectively executed in accordance with a card detected via an antenna so as to achieve compatibility with the respective cards of the venders: company A and company B. Further, when it is desired to achieve compatibility with cards of another vender, the chip module can be removed and replaced.","According to the example shown in , a single card reading device can perform processing for contactless IC cards of different card venders. However, since this scheme restricts the number of chip modules that can be inserted into a reading device, card types that can be handled by one reading device are limited. Also, when card processing is changed or a card type is changed, work such as developing a new chip module and disassembling the card reading device to physically replace chip modules arises.","Thus, all of the methods described above achieve processing in which one reading device can perform processes multiple types of cards, but do not make it easier to achieve compatibility with cards other than predetermined card types.","Nowadays, requirements for constructing an open system that is not vulnerable to a difference for each vender are increasing, mainly, in AFC (automatic fare collection) systems of public transport facilities. This is because known AFC systems need to dependent on specific card venders and card-reading-device venders, thus making it difficult to construct a low-cost and highly-flexible AFC system. A further reason is that various types of cards and reading devices appear on the market in conjunction with the widespread use of contactless IC cards in recent years, thus making it realistic to construct a highly-versatile AFC system.","An object of the present invention is to provide a superior contactless IC card communication system and a communication method in which a card reading device can preferably perform communication processing with contactless IC cards by using a predetermined command class and a security algorithm through a predetermined card-detection procedure.","A further object of the present invention is to provide a superior contactless IC card communication system and a communication method which allow communication processing so as to correspond to multiple types of contactless IC cards having different specifications, such as command classes and security algorithms.","The present invention has been made to overcome the foregoing problems and provides a contactless-IC-card communication system that is compatible with multiple contactless-IC-card specifications including command classes different from each other.","The contactless-IC-card communication system includes a controller module unit for processing card-dependent commands that differ depending on the contactless-IC-card specifications; and","a through reader unit for encapsulating a card-dependent command received from a contactless IC card into a through command and delegating a process to the controller module unit, and for retrieving a card-dependent command from a through command received from the controller module and transmitting a resulting command to the contactless IC card.","The \u201csystem\u201d used herein refers to a combination in which multiple devices (or function modules for accomplishing specific functions) gather logically and does not particularly restrict whether or not the devices and function modules are provided in a single housing. Also, the \u201ccontact-IC-card specifications\u201d used herein include, at least, initialization and collision-protection procedures, application-level commands, and application-level protocols, and security requirements which are defined on \u201cinterface standards (or, interface specifications)\u201d that define electrical properties and data-link-level protocols.","According to the contactless-IC-card communication system of the present invention, the through reader unit can execute a card determination procedure that is common to contactless-IC-card interface standards including card detection, collision avoidance, and card determination.","Thus, without performing a process for a command or response result communicated between an IC card and the card reading device, the through reader unit, which serves as a card reading device, encapsulates the command or result into a command that is called a through command and that is independent of the type of IC card and delegates the process to a controller module. This makes it possible to provide a card reading device that is independent of the type of IC card.","The controller module unit selectively executes multiple software modules containing command classes corresponding to the respective contactless-IC-card specifications, processes a card-dependent command from the contactless IC card, and generates a card-dependent command for the contactless IC card. The software modules are modularized for the respective contactless-IC-card specifications, in units of programs in which command groups and security algorithms corresponding to the respective contactless-IC-card specifications as well as communication-process procedures are written.","Further, the controller module further includes a common-process executing software module for executing a process that is independent of a difference between the contactless-IC-card specifications.","The software modules are downloaded to the controller module unit from an external server or the like, for example, during the installation or maintenance of the system.","According to the contactless-IC-card communication system of the present invention, a command and a process procedure which depended on the type of IC card are taken care of by a replaceable software module that is provided in the controller module and that corresponds to the card. Merely replacing the software module can make it easier to achieve compatibility with a new type of IC card and to make a change to process content for a currently-available IC card.","Preferably, the controller module unit provides an application firewall function for preventing the software modules from interfering with each other and a secure execution environment for preventing the software modules from improperly accessing resources of the controller module.","The controller module unit can be configured so that it is shared by multiple card reading devices and is delegated by respective through reader units so as to perform a process for the card-dependent command.","In this case, upon obtaining a response signal from a card present in the contactless communication area, each through reader unit encapsulates the received card-dependent command into a through command and delegates the process to the integrated controller module unit. In the controller module unit, the software module corresponding to the captured card is started to generate a card-dependent command, encapsulate the generated command into a through command, and return the resulting command to the through reader unit that requested the processing. The through reader unit then retrieves the card-dependent command from the through command and transmits the resulting command to the card without change.","With this configuration, the controller module functions can be centrally managed and work for downloading necessary software modules can be completed by a single operation. This makes it possible to achieve cost reduction and maintenance simplification and to achieve system expansion with relative ease.","The present invention can eliminate a need for constructing a system based on the card of a specific vender and the reading device of a specific vender. Thus, transportation operators and so on who construct contactless-IC-card systems can easily procure system components and can design flexible systems that are independent of venders.","According to the present invention, in situations in which card-process content is changed or a new type of card is employed, compatibility with new card specifications can be achieved by externally replacing software without physically removing or disassembling a reading device, thereby making it possible to reduce maintenance cost.","According to the present invention, since information that is not disclosed by card venders, such as processes and security algorithms which are specific to card types, is concealed in the software modules, confidential information for each card vender is protected.","Further objects, features, and advantages of the present invention will become apparent from more detailed description based on an embodiment described below according to the present invention and the accompanying drawings.","An embodiment of the present invention will be described below in detail with reference to the drawings.","The present invention relates to a scheme in which a single reading system processes multiple contactless IC cards having different standards, such as command classes, for respective venders.",{"@attributes":{"id":"p-0055","num":"0054"},"figref":"FIG. 1","b":["10","10","11","11","12","11","13","20","20"]},"The software modules  are provided (modularized) for respective types of cards, in units of programs in which command groups and security algorithms corresponding to respective contactless-IC-card specifications as well as communication-process procedures are written. A software module that is called a common-process executing software module  and that performs a process independent of a card type is also provided.","In the present embodiment, the common-process executing software module  determines the type of detected card, performs processing for sorting a process to the software module  for the corresponding card, and performs a through-command process (described below). The process that is independent of a card type, as used herein, includes, for example, calling an AES (Advanced Encryption Standard) or DES (Date Encryption Standard) engine for performing encryption processing according to an encryption parameter received from the software module .","The software modules  for the respective cards of companies and the common-process executing software module  are downloaded from an external server  to the controller module  during the installation or maintenance of the system. In order to prevent the software modules from being analyzed or tampered with through tapping by a third party, the software modules  are downloaded using a secure scheme with an anti-tamper IC chip  and are stored in the IC chip .","The controller module  executes the common-process executing software module  and the software modules  corresponding to respective card specifications of companies, the modules being stored in the IC chip. In the present embodiment, the controller module  provides an application firewall function for preventing the software modules  from interfering with each other and a secure execution environment for preventing the software modules  from improperly accessing resources of the controller module .","The through reader  communicates with the contactless IC cards A, B, . . . at a physical\/electrical low-layer protocol level for card initialization, collision avoidance, card determination, and so on during card detection. That is, the through reader  communicates with each card, and without performing a process corresponding to a response result from the card, delegates the process to the controller module .",{"@attributes":{"id":"p-0061","num":"0060"},"figref":"FIG. 2","b":["10","16","13","12","17"]},"In the controller module , the corresponding software module is executed to process a card-dependent command contained in a through command. Specifically, the common-process executing software module  determines a card type and sorts a process to the software module  for the corresponding card. Then, the corresponding software module  is started, so that a command process procedure and a communication process procedure corresponding to the card type are executed.",{"@attributes":{"id":"p-0063","num":"0062"},"figref":"FIG. 3","b":["10","11","12","13","16","13","17"]},{"@attributes":{"id":"p-0064","num":"0063"},"figref":"FIG. 4","b":"10"},"The common-process executing software module  issues a card-capture instruction to the through reader . In response to the instruction, the through reader  alternately generates card-capture signals that differ depending on card standards.","Upon receiving a response signal from card A that is present in the contactless communication area of the through reader , the through-command processor  in the through reader  encapsulates the received response command into a through command and transmits the resulting command to the common-process executing software .","The common-process executing software module  determines a card type, sorts a process to the software module A for corresponding card A, and delegates a command process.","The software module A for card A has a command process corresponding to card A, a security algorithm, and a communication process procedure. When the software module A generates a card-dependent command, the common-process executing software module  encapsulates the command into a through command and transmits the resulting command to the through reader . The through-command processor  in the through reader  retrieves the card-dependent command from the through command and transmits the resulting command without change.","Also, upon receiving a response signal form card B that is present in the contactless communication area of the through reader , the through-command processor  in the through reader  encapsulates the received response command into a through command and transmits the resulting command to the common-process executing software module .","The common-process executing software module  determines a card type, sorts a process to the software module B for corresponding card B, and delegates a command process.","The software module B for card B has a command process corresponding to card B, a security algorithm, and a communication process procedure. When the software module B generates a card-dependent command, the common-process executing software module  encapsulates the command into a through command and transmits the resulting command to the through reader . The through-command processor  in the through reader  retrieves the card-dependent command from the through command and transmits the resulting command without change.",{"@attributes":{"id":"p-0072","num":"0071"},"figref":"FIG. 5"},"In the example shown in the figure, the automatic fare collection device includes a through reader  and a controller module  and can read cards corresponding to interface specifications that differ depending on card venders: company A, company B, and company C.","The controller module  provides an application firewall function for preventing the software modules  from interfering with each other and a secure execution environment for preventing the software modules  from improperly accessing resources of the controller module .","In order to be compatible with contactless IC card specifications of company A, company B, and company C, the automatic fare collection device pre-downloads the software modules A, B, and C, which process the cards of the respective companies, from the external server . In order to prevent the software modules from being analyzed or tampered with through tapping by a third person during the download process, the software modules  are downloaded using a secure scheme with an anti-tamper IC chip  and are stored in the IC chip .","The through reader  communicates with the contactless IC cards A, B, . . . at a physical\/electrical low-layer protocol level for card initialization, collision avoidance, card determination, and so on during card detection. That is, the through reader  communicates with each card, and without performing a process corresponding to a response result from the card, delegates the process to the controller module .","In response to a card-capture instruction from the controller module , the through reader  alternately generates card-capture signals that differ depending on the card standards of the companies.","When a response signal is obtained from a card that is present in the contactless communication area of the through reader , the through-command processor  in the through reader  encapsulates a card-dependent response command (proprietary command) into a through command (through-command) and transmits the resulting command to the controller module  without change to thereby delegate a command process.","In the controller module , the software module corresponding to the captured card is started to generate a card-dependent command, encapsulate the generated command into a through command, and pass the resulting command to the through reader . The through-command processor  in the through reader  retrieves the card-dependent command from the through command and transmits the resulting command to the contactless IC card without change.","In the through reader , the process for encapsulating the card-dependent command into the through command and the process for retrieving the card-dependent command from the through command and transmitting the resulting command are executed by a through command API (application programming interface). The through command API itself does not process the card-dependent command and thus can be used for all card interface specifications.",{"@attributes":{"id":"p-0081","num":"0080"},"figref":"FIGS. 6 and 7"},"In the example shown in , respective automatic fare collection devices are equipped with independent controller modules  and necessary software modules are downloaded to the respective controller module .","On the other hand, in the example shown in , multiple fare collection devices share one through reader . Each fare collection device includes only the through reader . Upon obtaining a response signal from a card present in the contactless communication area, each through reader  encapsulates the received card-dependent command into a through command and delegates the process to the integrated controller module . In the controller module , the software module corresponding to the captured card is started to generate a card-dependent command, encapsulate the generated command into a through command, and return the resulting command to the through reader  that requested the processing. The through reader  then retrieves the card-dependent command from the through command and transmits the resulting command to the contactless IC card without change.","In the example shown in , the controller module functions can be centrally managed and work for downloading necessary software modules can be completed by a single operation. This makes it possible to achieve cost reduction and maintenance simplification and to achieve system expansion with relative ease.",{"@attributes":{"id":"p-0085","num":"0084"},"figref":"FIG. 8","b":"12"},"The controller module  is implemented with a platform having a combination of an operating system (OS), a Java virtual machine (Java VM), and a Java API. The platform is not limited to such a configuration to achieve the present invention, but it is preferable that the platform be open and be based on a typical execution environment to allow various card vendors to freely develop an application.","The Java VM is a virtual computer that interprets and executes a program written in Java language, and executes a Java program that is converted into byte code by a Java compiler. The Java API is grouped (packaged) as a library of relevant classes and interfaces. The Java API and Java VM isolate a program and hardware.","The controller module  stores the software modules  for cards supplied by card venders. Each software module  is a module incorporating all communication process procedures, such as a command class and a security algorithm corresponding to the specification of each card vender and is written in Java applet.","Java applet is a small application written in Java language and can be distributed using a WWW (World Wide Web) technology. That is, Java applets are compiled in advance, are registered with a WWW server, and are specified with a tag \u201c<applet>\u201d in an HTML (hyper text markup language) document.","The controller module  downloads a necessary card-processing software module from the external server . In the process of downloading the software module, confidentiality needs to be ensured.","The platform of the controller module  provides an application firewall function for preventing the software modules  from interfering with each other and a secure execution environment for preventing the software modules  from improperly accessing resources of the controller module . The Java platform prepares an off-the-shelf (i.e., ready-made) security mechanism.","In order to prevent the software modules  from being analyzed and tampered with through tapping by a third party, the software modules  are implemented on an anti-tamper IC chip.","The controller module  is provided with an encryption coprocessor for DES (data encryption standard), AES (advance encryption standard), and so on and thus can achieve higher-speed encryption\/decryption processing.","The controller module  is also provided with an extension memory for caching (temporarily storing) a software component and so on.","Buses that interconnect the encryption coprocessor, the extension memory, and the controller module  have a scrambling mechanism for preventing tapping.","Supplement","The present invention has been described above in detail with reference to the particular embodiment. However, it is obvious that those skilled in the art can make a modification and substitution to the embodiment in a scope without departing from the substance of the present invention. That is, the present invention has been disclosed by way of example and what is described herein should not be construed as limiting. The substance of the invention is to be determined by taking the claims into account.","The present invention can provide a superior contactless-IC-card communication system and a communication method in which a card reading device can preferably perform communication processing with a contactless IC card by using a predetermined command class and a security algorithm through a predetermined card-detection procedure.","The present invention can further provide a superior contactless-IC-card communication system and a communication method which allow communication processing so as to correspond to multiple types of contactless IC cards having different specifications, such as command classes and security algorithms.","The present invention can eliminate a need for constructing a system based on a reading device of a specific vender and a card of a specific vender that provides more than one type of contactless IC card satisfying a specific contactless-IC-card specification. Thus, transportation operators and so on who construct contactless-IC-card systems can easily procure system components and can design flexible systems that are independent of contactless-IC-card specifications.","According to the present invention, in situations in which card-process content is changed or a new type of card is employed, compatibility with a new card interface specification can be achieved by externally replacing software without physically removing or disassembling a reading device, thereby making it possible to reduce maintenance cost.","According to the present invention, since information that is not disclosed by card venders, such as processes and security algorithms which are specific to card types, is concealed in the software modules, confidential information for each card vender is protected."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0042","num":"0041"},"figref":"FIG. 1","b":"10"},{"@attributes":{"id":"p-0043","num":"0042"},"figref":"FIG. 2","b":"10"},{"@attributes":{"id":"p-0044","num":"0043"},"figref":"FIG. 3","b":"10"},{"@attributes":{"id":"p-0045","num":"0044"},"figref":"FIG. 4","b":"10"},{"@attributes":{"id":"p-0046","num":"0045"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0047","num":"0046"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0048","num":"0047"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0049","num":"0048"},"figref":"FIG. 8","b":"12"},{"@attributes":{"id":"p-0050","num":"0049"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0051","num":"0050"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0052","num":"0051"},"figref":"FIG. 11"}]},"DETDESC":[{},{}]}
