---
title: Storage system using thin provisioning pool and snapshotting, and controlling method of the same
abstract: A storage system comprises a storage device from which a physical storage area is created for storing data processed in an external apparatus, a thin provisioning controller creating a physical storage area pool with a plurality of unit physical storage areas from the physical storage area, and creating a logical volume from the physical storage area pool, and a snapshot controller designating the logical volume as a primary volume, defining a secondary volume which is a partner of the primary volume as a combination of the primary volume and difference data, assigning unused one of the unit physical storage areas to the area into which the difference data is to be stored, and setting a volume pair created with the primary volume and the secondary volume into a synchronizing state and a non-synchronizing state.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08745344&OS=08745344&RS=08745344
owner: Hitachi, Ltd.
number: 08745344
owner_city: Tokyo
owner_country: JP
publication_date: 20110701
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND ART","CITATION LIST","Patent Literature","SUMMARY OF INVENTION","Technical Problem","Solution to Problem","Advantageous Effects of Invention","DESCRIPTION OF EMBODIMENTS"],"p":["The present invention relates to a storage system and a method of controlling the same.","As the virtualization technique for computer resources improves, a server virtualization which enables a plurality of virtual machines operated on a single physical server to concurrently execute a plurality of tasks is being used widely. Similarly, a capacity virtualization is widely being used, in which when an external apparatus such as a host computer demands a data storing area, unit physical storage areas are provided from a pool consisting of a plurality of the unit physical storage areas, each of which being created by dividing a physical storage area of a storage device. This capacity virtualization is generally known as a \u201cthin provisioning.\u201d","The virtual machine of the server virtualization each uses a logical volume (Logical Unit, LU) as a dedicated logical storage area for a data storage area. Such a configuration is usually employed that, where a snapshot pair is created with two LUs, a primary volume (PVOL) and a secondary volume (SVOL), the SVOL is assigned to the LU for the virtual machine. In this configuration, not an ordinary LU but a virtual volume (VVOL) is usually used for the SVOL. The VVOL is constructed from data stored in a PVOL and difference data from the data in the PVOL. When the VVOL is used for a data storage area of the virtual machine, the LU is not necessarily provided to each virtual machine and the storage device is efficiently utilized. The difference data is stored in an LU dedicated for storing only the difference data. A snapshot pair of the PVOL and the VVOL is created for each virtual machine and the snapshot pair is subject to a split status, then the VVOL can be used for a data storage area of the virtual machine to which the above VVOL is assigned. Using the function of the snapshot pair, data processing such as backup and restoration of data can be timely carried out.","In order to apply the snapshot function effectively, the technique disclosed, for example, in PTL 1 is proposed. PTL 1 discloses, for example, a storage system having a physical snapshot executing part writing updated data into both a primary storage device and a secondary storage device, a logical snapshot executing part writing input data into the primary storage device and difference data of difference between the input data and data prior to update into the secondary storage device, an update data determination part that, when creation of snapshot data is requested by an upper apparatus, determines whether or not there exist data to be updated in the primary storage device with respect to the creation request, a data update amount determination part that when the update data determination part detects presence of the updated data in the primary storage device, determines whether or not the data update amount in the primary storage device is larger than a predetermined amount, and a snapshot executing part selector that, when the data update amount determination part determines the data update amount in the primary storage device is larger than the predetermined amount, selectively drives the physical snapshot executing part, and, when the data update amount determination part determines the data update amount in the primary storage device is smaller than the predetermined amount or the data to be updated does not exist in the primary storage device, selectively drives the logical snapshot executing part. PTL 1 describes when creating snapshot data in the storage system, it can be prevented that a data space for saving data prior to update is filled with saved data from the primary (logical) volume and the process of creation of the snapshot data is abnormally aborted.",{"@attributes":{"id":"p-0006","num":"0000"},"ul":{"@attributes":{"id":"ul0001","list-style":"none"},"li":"PTL 1: Japanese Patent Application Laid-open Publication No. 2006-163729"}},"However, in PTL 1, there is not disclosed a configuration in which a thin provisioning technique is applied to the snapshot function which is referred to as a logical snapshot function or a quick shadow function in PTL 1 to enable efficient utilization of storage resources. PTL 1 does not disclose a technique for improvement of an access rate when accessing the VVOL by an external apparatus in the configuration that a VVOL is used for an SVOL of a snapshot pair, either.","The present invention has been made in order to solve the above and other problems, and an object thereof is to provide a storage system with a function of enabling creating a snapshot pair easily while efficiently utilizing storage resources by employing a thin provisioning and a controlling method of the same. Another object of the present invention is to provide a storage system enabling improvement of an access rate in accessing an SVOL in a snapshot pair created with the thin provisioning and a controlling method of the same.","One aspect of the present invention for achieving the above and other objects is a storage system comprising a storage device from which a physical storage area is created, the physical storage area being for providing a logical storage area storing data processed in an external apparatus, a thin provisioning controller creating a plurality of unit physical storage areas from the physical storage area of the storage device, creating a physical storage area pool as a set of the unit physical storage areas, and creating a logical volume as a unit logical storage area having a part of the unit physical storage areas included in the physical storage area pool, and a snapshot controller designating the logical volume as a primary volume, defining a secondary volume which is a partner of data copy including a data backup for the primary volume as a combined data of the data stored in the primary volume and difference data which is data different from the stored data in the primary volume, assigning unused one of the unit physical storage areas in the physical storage area pool as an area into which the difference data is to be stored, and setting a volume pair created with the primary volume and the secondary volume into a synchronizing state where the data stored in the primary volume and the data stored in the secondary volume are synchronized and a non-synchronizing state where the data stored in the primary volume and the data stored in the secondary volume are not synchronized.","Another aspect of the present invention is the above-mentioned storage system further comprising a primary volume data temporary storing area being a storage area for storing data read from the primary volume temporarily, and a pool data temporary storing area being a storage area for storing data to be written into the physical storage area pool, the storage system, when receiving a data write request for the secondary volume from the external apparatus, determining whether or not the data to be written in the data write request includes corresponding difference data, if it is determined that the data to be written in the data write request does not include corresponding difference data, when the data to be written is stored into the pool data temporary storing area, transmitting to the external apparatus information indicating that processing of the data write request is completed, reading primary volume data stored in a storage area including the data to be written from the primary volume and storing the primary volume data as read into the primary volume data temporary storing area, combining the primary volume data as read with the data to be written in the pool data temporary storing area, and storing the data as combined into the physical storage area pool.","According to one aspect of the present invention, a storage system with a function of enabling creating a snapshot pair easily while efficiently utilizing storage resources by employing a thin provisioning and a controlling method of the same are provided. According to another aspect of the present invention, a storage system enabling improvement of an access rate in accessing an SVOL in a snapshot pair created with the thin provisioning and a controlling method of the same are provided.","The embodiments for carrying out the present invention will be described hereinbelow, as referring to the appended drawings. It is to be noted that the functions of various programs to be mentioned below are realized by a CPU or a processor which reads the programs from memory and executes the same as referring to information stored in various management tables.","Firstly, a construction of a storage system  according to an embodiment of the present invention will be described.  shows an example of a connection configuration of the storage system . The storage system  includes a storage apparatus , at least one host computer, hereinafter \u201chost,\u201d , and a management computer .","The host  and the storage apparatus  providing a data storage area for the data processed by the host  are coupled with a first communication network  communicatively to each other. The first communication network  is, for example, a SAN (Storage Area Network) constructed using a Fibre Channel protocol (FC protocol). The first communication network  provides a data path for a data IO between the host  and the storage apparatus  as well as a data IO between the storage apparatuses .","The management computer , the host  and the storage apparatus  are coupled with a second communication network  communicatively to each other. The second communication network  is constructed as, for example, a LAN (Local Area Network). The second communication network  provides a data path for collecting configuration information and\/or performance information from the host  and the storage apparatus  by the management computer  and transmitting of management information to the host  and the storage apparatus  from the management computer  using a communication protocol considered appropriate.","It is to be noted that  as an example illustrates the storage system  including the two hosts , however, a single host , or three or more hosts  may be coupled in the storage system .","Then, a hardware configuration of the host  and the management computer  will be described.  shows an exemplary construction of a computer  which can be used as the host  or the management computer . The computer  includes a processor  such as a CPU (Central Processing Unit), MPU (Micro Processing Unit), or the like, a main memory , an auxiliary storage apparatus , an input\/output device , a data interface (data I\/F) , a management interface (management I\/F) , and an internal communication network  which communicatively couples the processor  to the management I\/F  to each other.","The main memory  is constructed with a volatile memory device including semiconductor memory such as a RAM (Random Access Memory) and a ROM (Read Only Memory), for example. The auxiliary storage device  may be constructed with a writable\/readable non-volatile storage device such as a hard disk drive (HDD), an SSD (Solid State Drive) or a read-only non-volatile storage device such as magneto optical media, and the like.","The input\/output device  may be constructed with an output device including a display device such as a CRT display and an LCD display, and an input device such as a keyboard, a mouse, and\/or a tablet. The data I\/F  and the management I\/F  are communication interface units respectively coupled with the first communication network  and the second communication network . Examples of the data I\/F  and the management I\/F  are an HBA (Host Bus Adapter) and a NIC (Network Interface Card), respectively. It is to be noted the data I\/F  may be omitted when the computer  is used as the management computer . It is also to be noted a service interface as a communication interface unit equivalent to the management I\/F  may be provided for communicating with another host  when the computer  is used as the host .","Then, a hardware configuration of the storage apparatus  will be described.  shows an exemplary hardware construction of the storage apparatus . The storage apparatus  includes a processor  such as a CPU or an MPU, a cache memory , a program memory , a disk controller , a storage device , a data I\/F , a management I\/F , and an internal communication network  communicatively coupling the processor  to the management I\/F  to each other.","The cache memory  provides a storage area for temporarily storing data to be written into the storage device  from the external apparatus such as the host  and data read from the storage device . The cache memory  is constructed with a semiconductor memory device such as a RAM. The program memory  includes a storage area for storing programs for implementing the functions of the storage apparatus  of the present embodiment and various data to be used by the programs. The program memory  is constructed with a semiconductor memory device such as a RAM. The cache memory  is provided with a temporary storing area for temporarily storing IO data to\/from a snapshot pair as will be described later.","The disk controller  is a control unit for processing data IO received from an external device such as the host . The disk controller  controls data writing and data reading between the cache memory  and the storage device , for example. The storage device  can be constructed with a readable\/writable non-volatile storage device such as an HDD, an SSD, or a magnetic tape apparatus. The storage device  provides a physical storage area defining a data storage area storing data from the host . As will be described later, a virtual volume (VVOL) which is a logical storage area virtualized by a RAID control and a virtualization control, is provided to the external apparatus.","The data I\/F  and the management I\/F  are communication interface units respectively coupled with the first communication network  and the second communication network , as the data I\/F  and the management I\/F  in the computer . It is to be noted, though not illustrated in the construction in , the storage apparatus  may be provided with a component corresponding to the input\/output device  of the computer .","Then, respective software configurations of the host , the management computer , and the storage apparatus  will be described.  show the software configurations of the host , the management computer , and the storage apparatus  of the present embodiment respectively.","First, the host  will be described. The host  has the respective operational parts including an OS , a data IO part , a service application , and a virtualization control part . The OS , the data IO part , the service application , and the virtualization control part  are stored in the auxiliary storage device  of the computer , for example, and are read out into the main memory  and executed by the processor .","The OS  is software implementing a fundamental function of the computer  as the host  such as a data input\/output processing and a memory management processing. Any OS which is suitable may be selected and used as the OS  from among those used for a general computer . The data IO part  carries out a data input\/output processing through the input\/output device , the data I\/F , and the management I\/F  under control by the OS .","The service application  operating on the OS  in the host , is an application program carrying out a data processing regarding the services provided by the host . The service application  uses the LU provided by the storage apparatus  as the data storage area.","The virtualization control part  is a program for server virtualization operating on the OS  and implements a function of creating one or more virtual servers and allows them to operate on the host  as a physical server. The server virtualization program may be selected and used from among the existing similar programs, which is considered appropriate. Optionally, the virtualization control part  may be omitted from the host .","Then, a description of the management computer  will be given. The management computer  has functional parts including an operating system (OS) , a data IO part , and a storage management part . The OS , the data IO part , and the storage management part  are stored in the auxiliary storage device  of the computer  and are read out into the main memory  and executed by the processor .","The OS  and the data IO part  are similar to the OS  and the data IO part  of the host .","The storage management part  receives general operational instructions on management through the input\/output device  and transmits the instructions to the storage apparatus . The storage management part  also has a function of monitoring an operation of the storage apparatus  with an SNMP (Small Network Monitoring Protocol), for example. It is to be noted that the construction of the management computer  may be provided in the storage apparatus .","Next, the storage apparatus  will be described. The storage apparatus  is provided with respective functional parts including an OS , and a disk controller  including a storage controller , a thin provisioning controller , and a snapshot controller . A set of management tables  is also stored in the storage apparatus , the tables recording various data to be used by the above functional parts. The OS , the storage controller , the thin provisioning controller , and the snapshot controller  are stored in the program memory , for example, and are read out and executed by the processor . The OS  is the same as the OS  of the management computer , for example.","The storage controller  has a function of managing a physical storage area provided by the storage device  as one or more RAID groups created according to an appropriate RAID level and of creating a logical volume (LU) as one or more logical storage areas based on the RAID groups. Further, the storage controller  carries out processing of a data write\/read request from the server , and various operation commands from the management computer . The function of writing data into an SVOL (VVOL) of a snapshot pair of the present embodiment as will be described later is implemented as a function of the storage controller .","The thin provisioning controller  creates a unit physical storage area or a page, for example, from the physical storage area belonging to the RAID group created by the storage controller  from the storage device  of the storage apparatus . The thin provisioning controller  has a function of capacity virtualization of creating a logical storage area by assigning a unit physical storage area such as a page to the data as necessary. It is to be noted that in a plurality of RAID groups, some RAID groups can be operated under thin provisioning and an ordinary LU may be created from the other RAID groups.","The snapshot controller  has a function of creating a PVOL and an SVOL from an LU created by the storage controller  or a thin provisioning pool, hereinafter \u201cpool,\u201d as a set of a number of unit physical storage areas, by the thin provisioning controller , and of creating a snapshot pair by coupling the PVOL and the SVOL and operating the pair. The functions of the thin provisioning controller  and the snapshot controller  will be described later more specifically. It is to be noted that, in the following description, the SVOL creating a snapshot is configured as a VVOL and the SVOL and the VVOL are substantially of the same configuration.","Next, the management tables  held in the storage apparatus  will be described. As shown in , a difference table , a pair assignment table , a thin provisioning management table , a snapshot job management table , a segment management table , a snapshot information table , a snapshot pair specific information table , a consistency group information management table , an LU information management table , and a VVOL information management table A are stored, for example, in the program memory  of the storage apparatus . A specific configuration example of each table will be described later.","Next, referring to , a logical configuration of a pool created by the thin provisioning controller  of the storage apparatus  will be described.  is a schematic diagram showing a logical configuration of a thin provisioning pool. In the example in , the RAID groups  are created from a plurality of the storage devices . The thin provisioning controller  creates a number of unit physical storage areas from the physical storage area included in the RAID group and allots the unit physical storage areas to data regarding a data write request by the host . The thin provisioning controller  has the host  recognize a logical volume (LU) with a certain logical storage capacity as a data storage area. As shown in , as far as data is not written by the host , each LU recognized by the host  does not have actual physical storage area. This indicates a state wherein no unit physical storage area is assigned to any of the storage area of the LU.","When the host  requests writing data into each LU, the thin provisioning controller  allots the unit physical storage areas to the LU into which the data is to be stored. This indicates a state wherein the unit physical storage areas are assigned to a part of the storage are of the LU. When the unit physical storage areas are assigned to the physical storage area corresponding to the entire storage capacity set to the LU, data cannot be written into the LU. As described above, the LU recognized by the host  in the storage system  of the present embodiment is a virtual LU created by the thin provisioning controller .","A PVOL as a primary logical volume of a snapshot pair created by the snapshot controller  of the present embodiment is configured as the virtual LU. On the other hand, an SVOL as a partner of the PVOL has a nominal storage area created by combination of the corresponding PVOL and difference data from the data stored in the PVOL, the difference data being stored in the thin provisioning pool  by the snapshot controller .",{"@attributes":{"id":"p-0075","num":"0074"},"figref":"FIG. 9","b":"155"},"When a snapshot pair is created with ordinary LUs, a PVOL is configured as an ordinary LU belonging to a specific RAID group. In contrast, a VVOL as an SVOL in a snapshot pair is obtained from combination of the data stored in the PVOL and the difference data as described referring to . However, in this configuration, there is a difference that the logical storage area to which the difference data is to be stored is in the ordinary LU belonging to the specific RAID group like the PVOL. Thus, an administrator of a storage system must predict a storage capacity to be required in advance and construct a pool including a plurality of LUs to which the difference data is to be stored before assigning a snapshot pair to the host  and starting operation. Further, the administrator must identify in advance the LU to be used as the PVOL, the LU to which the difference data for the SVOL are to be stored, and the pool from which the LU used for storing the difference data is created. It is to be noted that the construction simply referred to as a \u201cpool\u201d means a set of LUs for the difference data.","Here, in the construction in , when a snapshot function is set up using ordinary LUs, a shadow image function can be selected. As described in PTL 1 mentioned above, in the shadow image function, updating of the data stored in the PVOL is reflected to the SVOL on a real-time basis. This demands preceding preparation of an LU as the SVOL in the pool. When the shadow image function is realized using the thin provisioning pool, construction of such a snapshot pair created with two LUs used for the PVOL and the SVOL both created from the thin provisioning pool, hereinafter \u201cTP pool,\u201d will suffice.","In the storage system  of the present embodiment, the PVOL for creating a snapshot pair is created from the TP pool and the host  may be provided with an LU with an appropriate storage capacity. The SVOL is configured as a nominal VVOL as combination of the data stored in the PVOL and the difference data. Therefore, it is sufficient to keep a difference data storage area in the TP pool  and there is no need to create an ordinary LU for storing the difference data in advance.",{"@attributes":{"id":"p-0079","num":"0078"},"figref":"FIG. 10","b":["204","100","200","204","10","200","200"]},"The storage apparatus  provides a VVOL as an LU used as a data storage area for the host , actually for each of the virtual machines. Each VVOL functions as an SVOL creating a snapshot pair with a PVOL which is an ordinary LU.",{"@attributes":{"id":"p-0081","num":"0080"},"figref":["FIG. 11","FIG. 10"]},"On the other hand, the scheme of carrying out the process of creating a snapshot pair using the thin provisioning pool is shown in . As shown in , the three VVOLs create snapshot pairs with the respective PVOLs, each VVOL being defined as the data storage area for each of the three virtual machines operating on the host . In the exemplary configuration in  unlike the corresponding configuration in , the PVOL is created from the thin provisioning pool and the difference data for creating the VVOL are also stored in the thin provisioning pool. Therefore, a convenient configuration for an administrator of the storage system  is provided such that, as shown in , there is no need to create an LU for the PVOL and an LU for storing the difference data with respective predefined storage capacities in the snapshot pair creating process, and the process of creating a snapshot pair can be started simply with defining the LUNs, the RAID group ID, and a storage capacity of the PVOL. The process of creating a snapshot pair in the present embodiment will be described later referring to an exemplary process flow and the like.","Next, the management tables  used for storage control by the storage system  of the present embodiment will be described. As described referring to , the management tables  are stored in the program memory  of the storage apparatus , for example.","First, the difference table  will be described. An exemplary configuration of the difference table  is shown in . The difference table  records the information on whether or not difference data exists for each data stored in the PVOL and the storing location if the difference data exist for each of the snapshot pair created in the storage apparatus . The storage apparatus  refers to the difference table  when carrying out a write\/read process regarding the data in the VVOL.","The difference table  records the items of a pair ID , a difference bitmap table , and an LBA table  storing an address where a difference data is saved in mutually correlated manner. The pair ID  is an identification code appended to each snapshot pair created and held in the storage apparatus . The difference data bitmap table  and the LBA table  for storing a difference data saving address records the following items respectively regarding the data stored in the PVOL in the snapshot identified by the corresponding pair ID  if the difference data exists: a location of a difference data bitmap correlated with the address of the PVOL where a difference data is saved, and a location of a table indicating an LBA (Logical Block Address) of the difference data in the TP pool . Each of the records recorded in the difference table  is created by the snapshot controller  when a snapshot pair is created in the storage apparatus .","Next, the pair assignment table  will be described. An exemplary configuration of the pair assignment table  is shown in . The pair assignment table  records for each snapshot pair created in the storage apparatus  the information of the unit physical storage area in the TP pool  assigned to each snapshot pair. The pair assignment table  is updated when the storage apparatus  carries out a write process regarding the data of the VVOL.","The pair assignment table  records a pair ID , a chunk information ID , a TP pool ID , a chunk ID , and a used capacity  in mutually correlated manner. The pair ID  is an identification code appended to each snapshot pair created and held in the storage apparatus . The chunk information ID  is an identification code appended to the information on the unit physical storage area assigned from the TP pool  to the snapshot pair identified by the corresponding pair ID . The \u201cchunk\u201d is a name given to each unit physical storage area held in the TP pool . For example, a single chunk is defined as a physical storage area of 1 GB in size. The TP pool ID  is an identification code of the TP pool  to which belongs the chunk assigned to the snapshot pair identified by the corresponding pair ID . The chunk ID  and the used capacity  record an identification code of the chunk assigned to the snapshot pair identified by the corresponding pair ID  and a storage capacity used for the corresponding chunk, respectively. Each record recorded in the pair assignment table  is created by the snapshot controller  when the snapshot is created in the storage apparatus .","Next, the thin provisioning management table  will be described. An exemplary configuration of the thin provisioning management table  is shown in . The thin provisioning management table  records the information on the TP pool  created by the storage apparatus . The thin provisioning management table  is updated when the storage apparatus  adds or deletes the data of the PVOL or the VVOL of the snapshot pair.","The thin provisioning management table  records the items of a TP pool ID , a used HDD , an assigned area management ID , an unassigned area management ID , and a pool-over threshold  in mutually correlated manner. The TP pool ID  is an identification code assigned to the TP pools  created and held in the storage apparatus . The used HDD  identifies a storage device such as an HDD providing a physical storage area to the TP pool  identified by the corresponding TP pool ID . The assigned area management ID  is an identification code appended to the information indicating the storing address of the chunk to which data is already assigned in the corresponding TP pool . The unassigned area management ID  is an identification code appended to the information indicating the storing address of the chunk to which data is not yet assigned in the corresponding TP pool . The pool-over threshold  records a threshold level for determining generating a warning on the used capacity of the TP pool  identified by the corresponding TP pool ID . When the thin provisioning controller  determines that the used capacity has exceeded the pool-over threshold, the thin provisioning controller  can be configured to transmit a warning notice to the host  or the management computer  or to delete any LU to which data is not yet assigned. Each record recorded in the thin provisioning management table  is created when the TP pool  is created in the storage apparatus .","Next, the snapshot job management table  will be described. An exemplary configuration of the snapshot job management table  is shown in . The snapshot job management table  records the content of a request for a processing received from the host  for each snapshot pair held in the storage apparatus . The snapshot job management table  is updated when the storage apparatus  carries out the process as requested received for the data of the PVOL or the VVOL.","The snapshot job management table  records the items of a pair ID , a PVOL ID , a write data LBA , a write data length , a temporary cache area , a save area LBA , and a job status  in mutually correlated manner. The pair ID  is an identification code appended to each snapshot pair created and held in the storage apparatus . The PVOL ID  is an identification code appended to the PVOL of the snapshot pair identified by the corresponding pair ID . The write data LBA  records the LBA where the data on the data write request received from the host  is stored. The write data length  records a data length of the data to be written according to the data write request. The temporary cache area  records the storage area in the cache memory  for temporarily storing the data to be written when processing the data write request. The save area LBA  records the LBA where the data to be saved from the PVOL are stored when processing the data write request. The job status  records the status of processing of the data write request. Each of the records recorded in the snapshot job management table  is created when the storage controller  of the storage apparatus  has received a data write request from the host  and is updated in accordance with progress of processing of the data write request.","Next, the segment management tables A and B will be described. Exemplary configurations of the segment management tables A and B are shown in  respectively. The segment management tables A and B record control information for the temporary cache area set in the cache memory  of the storage apparatus . The segment management tables A and B are updated in accordance with progress of processing of the data write request from the host  by the storage controller . It is to be noted that the segment management tables A and B request control information for a write side (W side) and a read side (R side) of the temporary cache area respectively. Into the W side are written data to be written from the host  or saved data from a PVOL. The data written into the W side are subject to necessary processings such as generation of parity for storage into the storage device  and moved to the R side. The data written into the R side are stored into the storage device  by the storage controller .","The segment management tables A, B record the items of segment position IDs A, B, destaging disable bits A, B, and reading bits A, B, respectively in mutually correlated manner. The segment position IDs A, B record an identification code of a segment position which is information indicating a storage location in the temporary cache area where write data or saved data is stored. The destaging disable bits A, B record a destaging disable bit which is information indicating whether or not overwriting of write data onto the data stored at the corresponding segment positions A, B is permitted. If the overwriting is not permitted, \u201cON\u201d is recorded in the destaging disable bits A, B. The reading bits A, B record a reading bit which is information indicating whether or not reading of the data stored at the corresponding segment positions A, B is ongoing. If the reading is ongoing, \u201cON\u201d is recorded in the reading bits A, B.","Next, the snapshot information table  will be described. An exemplary configuration of the snapshot information table  is shown in . The snapshot information table  records information such as presence or absence of setting regarding a snapshot pair, a status, an attribute and the like of the snapshot pair as set for each LU held in the storage apparatus . It is to be noted that the LU constitutes either of a PVOL or an SVOL (VVOL) in a snapshot. The snapshot information table  is updated when the status, the attribute or the like of the snapshot pair is changed by the snapshot controller  of the storage apparatus .","The snapshot information table  records the items of an LU ID , a pair status , a pair attribute , a partner LUN , a VVOL ID , a secondary LU quantity , a restoration VVOL , a PVOL error flag , an available pool ID , a port ID A, and a target ID B in mutually correlated manner. The LU ID  records an LUN as identification number appended to a PVOL or an SVOL (VVOL) as an LU in the storage apparatus . The pair status  records as a status of each snapshot pair any of the following types: PAIR NOT DEFINED, RESTORATION, PRIMARY DATA AND SECONDARY DATA IDENTICAL (initial value), SPLIT, FAILURE, and STATUS MIXED. The pair attribute  records the types of PVOL (P) or SVOL (S). The partner LUN  records an LUN (ID) of the PVOL as a partner of the snapshot pair. The VVOL ID  records the VVOL ID appended to the VVOL when the LU is a VVOL. The secondary LU quantity  records a quantity of the SVOLs (VVOLs) in the snapshot pair. The restoration VVOL  records the VVOL ID appended to the VVOL where a restoration process is being carried out for the VVOL. The PVOL error flag  records ON when failure occurs to the PVOL or the SVOL constituting a snapshot pair and a snapshot function cannot be realized. The available pool ID  records an ID identifying the TP pool  assigned to the LU. If the TP pool  is not specified, the ID of the TP pool  to which the LU as the PVOL is assigned is recorded. The port ID A and the target ID B record a port number and a target ID of the data I\/F  of the host  respectively, providing connection information for the host , for the LU identified by the corresponding LU ID . Each record recorded in the snapshot information table  is generated when the thin provisioning controller  of the storage apparatus  creates each LU.","Next, the snapshot pair specific information table  will be described. One exemplary configuration of the snapshot pair specific information table  is shown in . The snapshot pair specific information table  records therein information such as a status, an attribute, and a processing option for each snapshot pair held in the storage apparatus . The snapshot pair specific information table  is updated when the status, an attribute, or the like of a snapshot pair is changed by the snapshot controller  in the storage apparatus .","The snapshot pair specific information table  records therein the items of a pair ID , an SVOL pair status , an LU ID , a partner LUN , a mirror number , a copy rate , a group designation , a group ID , an SVOL write receipt flag , an SVOL read\/write (r\/w) disable flag A, a snapshot (SS) split time B, a split mode C, a VVOL capacity predetermination mode D, a scheduling information E, an automatic deletion flag F, and a pair name G in mutually correlated manner.","The pair ID  is an identification code appended to each snapshot pair created and held in the storage apparatus . The SVOL pair status  records as a status of each snapshot pair any of the following types: PAIR NOT DEFINED, RESTORATION, PRIMARY DATA AND SECONDARY DATA MATCH (The initial value of the SVOL pair status  where the PVOL data and the SVOL (VVOL) data is synchronized.), SPLIT, FAILURE, and STATUS MIXED. The LU ID  is an identification code or an LUN appended to the PVOL in the corresponding snapshot pair. The partner LUN  is an identification code or an LUN appended to the SVOL (VVOL) in the corresponding snapshot pair. The mirror number  records the number (n\u22121) of the VVOLs subject to mirroring process to synchronize the data in the PVOL and the VVOL where the number of the PVOL to the number of the VVOL is 1 to n in a snapshot pair. The copy rate  is to designate the option for a copy execution rate in a mirroring process such as HIGH, NORMAL, and LOW. The group designation  records information indicating whether or not a consistency group, herein after CTG is defined for the corresponding snapshot pair so as to secure consistency in a data write sequence. The group ID  records, where a CTG is defined for the corresponding snapshot pair, an identification code for identifying the CTG. The SVOL write receipt flag  records ON when the data write request for a VVOL is received from the host . The SVOL read\/write (r\/w) disable flag A records ON where access to a specific VVOL is inhibited. The snapshot (SS) split time B records, where the corresponding snapshot pair is split, a date and a time when the split operation was carried out. The split mode C records information on whether or not the corresponding snapshot pair is split. The VVOL capacity predetermination mode D records, where a maximum storage capacity is set for the VVOL of the corresponding snapshot pair, the storage capacity. The scheduling information E records, where a schedule of carrying out resynchronization process for the corresponding snapshot pair is set, the schedule like EVERY ONE HOUR, or EVERYDAY. The automatic deletion flag F records option information on whether or not automatic deletion is carried out for the LU to which no data is assigned when the used capacity of the TP pool  assigned to the corresponding snapshot pair exceeds a predetermined threshold. The pair name G records, where a name is given to the corresponding snapshot pair, the name. Each record recorded in the snapshot pair specific information table  is generated when the snapshot controller  of the storage apparatus  creates each snapshot pair.","Next, the consistency group (CTG) information management table  will be described. An exemplary configuration of the CTG information management table  is shown in . The CTG information management table  records, where a consistency group is defined for each snapshot pair held in the storage apparatus , information such as a status, and an attribute of the consistency group. The CTG information management table  is updated when the status, the attribute, or the like of the CTG of the snapshot pair is changed by the snapshot controller  of the storage apparatus .","The CTG information management table  records therein the items of a consistency group (CTG) information , a use status , a copy type , a group name  in mutually correlated manner. The CTG information  records an identification code appended to the CTG as defined in the storage group. The use status  indicates for which snapshot pair the CTG is defined, and records the information that the CTG is in use if the CTG is defined. The copy type  records either of the types of \u201cshadow image (SI)\u201d and \u201csnapshot (SS).\u201d If a CTG is used for a non-synchronized pair, \u201cSS\u201d is recorded for the copy type . The group name  records a name given to the corresponding CTG. Each record in the CTG information management table  is created when the snapshot controller  of the storage apparatus  creates each snapshot pair and defines a CTG for the same.","Next, the LU information management table  will be described. An exemplary configuration of the LU information management table  is shown in . The LU information management table  records therein information such as a status, and an attribute of each LU held in the storage apparatus . The LU information management table  is updated when the status, the attribute or the like of each LU is changed by the thin provisioning controller  of the storage apparatus .","The LU information management table  records therein the items of an LU ID , a related RAID group ID , a data storage area information , a size , a managing controller ID , a host connection information , a pair ID , and a format-in-progress flag  in mutually correlated manner. The LU ID  records an identification code appended to the corresponding LU. The related RAID group ID  records an identification code of the RAID group providing the physical storage area constituting the corresponding LU. The data storage area information  records information such as a ratio of the storage area already assigned to data in the logical storage area for the corresponding LU, for example. The size  records the size of the logical storage area assigned to the corresponding LU. The managing controller ID  records an identification number appended to the controller managing control of the corresponding LU. The host connection information  records information such as a port number of the data I\/F  to be connected, and an identification code of a virtual machine where the corresponding LU is connected with the host . The pair ID  records an identification code appended to the snapshot pair created with the corresponding LU. The format-in-progress flag  records information indicating that formatting is in progress when the storage device  such as an HDD constituting a RAID group from which the corresponding LU is created is being formatted. Each record in the LU information management table  is created when each LU is created by the thin provisioning controller  of the storage apparatus .","Next, the VVOL information management table A will be described. One exemplary configuration of the VVOL information management table A is shown in . The VVOL information management table A records therein the information such as a status, and an attribute of each VVOL held in the storage apparatus . The VVOL information management table A is updated when the status, the attribute or the like of each VVOL is changed by the snapshot controller  of the storage apparatus .","The VVOL information management table A records therein the items of a VVOL ID A, a size A, a managing controller ID A, a host connection information A, an LU ID A, and a pair ID A in mutually correlated manner. The VVOL ID A records an identification code appended to the corresponding VVOL. The size A records the size of the logical storage area assigned to the corresponding VVOL. The managing controller ID A records an identification number appended to the controller managing control of the corresponding VVOL. The host connection information A records information such as a port number of the data I\/F  to be connected, and an identification code of a virtual machine where the corresponding VVOL is connected with the host . The LU ID A records, where the corresponding VVOL is defined as an LU, an identification code (LUN) appended to the LU. The pair ID A records an identification code appended to the snapshot pair created with the corresponding VVOL. Each record in the VVOL information management table A is created when each VVOL is created by the thin provisioning controller  of the storage apparatus .","Next, the snapshot control realized according to the configuration of the storage system  of the present embodiment as described above will be described referring to an example of a process flow and the like. First, a process carried out for preparing operation of a snapshot pair in the storage system  of the present invention will be described referring to .  shows an example of a process flow of preparation for a snapshot operation.","First, a PVOL which has been created from the TP pool  provided by the thin provisioning controller  of the storage apparatus  is connected with the host as a physical server (S). More specifically, a new LU is prepared in the LU information management table  by the thin provisioning controller , and \u201cCONNECTED\u201d is recorded in the host connection information .","Then, the snapshot controller  has the host  recognize the PVOL by recording the port ID A and the target ID B in the snapshot information table  (S). Here, a virtual machine has been created in the host  by installing and operating virtualization software corresponding to the virtualization controller  in the host  beforehand.","Pieces of data including the OS required to operate the virtual machine in the host  and an application operating on the OS as required are stored in the created PVOL and the PVOL is placed in an unmount status where the PVOL is not recognized by the host  (S, S). Then, the host  or the management computer  provides a command to the snapshot controller  of the storage apparatus  and has the snapshot controller  carry out a process of creating a snapshot pair (S). The snapshot pair creating process will be described later.","At S, the snapshot pair created in the snapshot pair creating process at S is split (S). An LU is assigned to the VVOL of the snapshot pair and the VVOL is connected with the host . The VVOL is subject to recognition by the virtual machine which is to use the VVOL and the snapshot operation preparation process is completed (S-S). More specifically, The LU assigned to the VVOL is recorded in the LU ID A and the host connection information A is changed to \u201cCONNECT\u201d in the VVOL information management table A.","According to the configuration as described above, when creating a snapshot pair, there is no need to create the LU storing difference data for constituting the VVOL after estimation of a required storage capacity beforehand and the preparation of a snapshot operation can be facilitated.","Next, the snapshot pair creating process of the present embodiment (S in ) will be described referring to .  shows an example of a process flow of creating a snapshot pair of the present embodiment. The snapshot pair creating process is carried out by the snapshot controller  of the storage apparatus .","First, the snapshot controller  receives a command for creating a snapshot pair from the host  and starts the snapshot pair creating process. The snapshot controller  refers to the copy type in the snapshot pair creating command as received and determines whether the designated copy type is a shadow image or a snapshot (S). If the snapshot controller  determines the copy type is a shadow image (S, shadow image), the snapshot controller  carries out the shadow image process as described in PTL 1 mentioned above and terminates the process (S). Since in the shadow image process, such an operation is made that the PVOL and the SVOL of the snapshot pair is synchronized, the shadow image process is not essential to the present embodiment.","If the snapshot controller  determines the copy type is a snapshot (S, snapshot), the snapshot controller  then determines whether or not the PVOL designated in the snapshot pair creating command is created from the TP pool  (S). If the snapshot controller  determines the PVOL is not created from the TP pool  (S, No), the snapshot controller  sends an error information and terminates the process (S). The error notification is made because, when the PVOL designated in the snapshot pair creating command is not created from the TP pool , the configuration of the PVOL as the condition of the present embodiment is not prepared and the snapshot pair creating process of the present embodiment cannot be carried out.","If the snapshot controller  determines the PVOL is created from the TP pool  (S, Yes), the snapshot controller  then determines whether or not a snapshot pair is already created including the PVOL designated in the snapshot pair creating command (S). If the snapshot controller  determines the snapshot pair is already created (S, Yes), the snapshot controller  moves the process to S. If the snapshot controller  determines the snapshot pair is not yet created (S, No), the snapshot controller  records the TP pool  from which the PVOL is created in the used pool ID  in the snapshot information table  as a difference data storing area for the snapshot pair to be created.","Then, the snapshot controller  records the information in the snapshot information table , the snapshot pair specific information table , the consistency group (CTG) information management table , and the VVOL information management table A according to the information included in the snapshot pair creating command and the predetermined initial value.","Then, the snapshot controller  determines whether or not an automatic split option is set in the snapshot pair creating command (S). The automatic split option is the information to be included in the snapshot pair creating command when the pair status of the snapshot pair as created is to be automatically changed from \u201cPAIR\u201d (data synchronized state) as the initial state to the split state (PSUS). If the snapshot controller  determines the automatic split option is set in the snapshot pair creating command (S, Yes), the snapshot controller  changes the record in the pair status  in the snapshot information table  to \u201cPSUS\u201d for the snapshot pair currently being processed and terminates the process (S). If the snapshot controller  determines the automatic split option is not set in the snapshot pair creating command (S, No), the snapshot controller  terminates the process without taking specific action.","According to the configuration as described above, in the snapshot operation preparation step, an administrator is allowed to create a snapshot pair without cumbersome operation of setting a detailed specification for a snapshot pair.","Next, the process for actual operation of the host  using the snapshot pair created according to the above process will be described.  shows an example of the process flow of the actual operation of the snapshot. The example of  assumes that the VVOL of the snapshot pair is assigned to a data storage area for the virtual machine created in the host  and the virtual machine is operated while data backup is carried out everyday with the VVOL.","The snapshot controller  of the storage apparatus  receives a command for starting the operation of the snapshot from the virtual machine of the host , creates a snapshot pair by carrying out the snapshot pair creating process S in , and records \u201cPSUS\u201d (Split state) as the pair status of the snapshot pair as created (S). Here, if the automatic splitting process is carried out in the snapshot pair creating process in S, the process of S can be omitted.","Then, the snapshot controller  connects the PVOL of the snapshot pair with the host  (the virtual machine) and has the virtual machine recognize the PVOL which uses the snapshot pair (S, S). According to the above process, the snapshot operation has been readily available, and the host  (the virtual machine) is used for the real operation while using the VVOL of the snapshot pair as the data storage area (S).","The snapshot controller  counts the time elapsed since the start of the operation by the host  and unmounts the PVOL after one day to hide the PVOL from the host  in the example in  (S). The snapshot controller  determines whether or not a command for restoration has been received from the host  (S). If the snapshot controller  determines that the restoration command is received (S, Yes), the snapshot controller  restores the data stored in the VVOL by overwriting the difference data for the VVOL with the data stored in the PVOL (S). According to the restoration process, the data stored in the VVOL which are used by the virtual machine can be turned into the state one day before.","If the snapshot controller  determines that the restoration command is not received (S, No), the snapshot controller  reflects the difference data for the VVOL onto the PVOL and resynchronizes the PVOL with the VVOL (S). Then, the snapshot controller  changes the pair status of the snapshot pair to \u201cPSUS,\u201d and moves the process to S (S). The above snapshot operation is continuously carried out while the host  using the snapshot operates.","According to the above snapshot operation process, the host  can be operated with high reliability while obtaining backup data regularly. It is to be noted, while a backup process is carried out everyday using a single VVOL in the example in , two or more VVOLs may be defined in the snapshot pair to hold the backup data for a longer time period or more frequently for the same time period, and the reliability of the operation of the storage system  can be improved. When a plurality of VVOLs are defined, the information of the VVOLs as defined is recorded in the snapshot information table , the snapshot pair specific information table , and the VVOL information management table A respectively.","Next, the process of writing data into a PVOL in the storage system  of the present embodiment will be described. In the present embodiment, each of the virtual machine in the host  uses a VVOL of a snapshot pair as a data storage area. Thus, the storage system  can be operated more efficiently by improving an access rate of accessing the PVOL creating the snapshot pair with the VVOL.",{"@attributes":{"id":"p-0125","num":"0124"},"figref":["FIG. 27","FIG. 27","FIG. 10","FIG. 27"],"b":["100","200","120","100","120","200","200","150"]},"The cache memory  is provided with a PVOL cache area A as a temporary storage area for the data to be written into the PVOL from the host  and for the data read from the PVOL and a pool cache area B as a temporary storage area for the difference data to be written into the pool and for the data read from the pool. The PVOL cache area A and the pool cache area B respectively have a write side (W side) as a storage area storing the write data from the host  and the data read from the PVOL as they are and a read side (R side) storing the data to be written into the PVOL or the pool, the data being the data stored in the W side with necessary parity data appended thereto.","The data process flow in the cache memory  carried out in accordance with the process of writing data into the PVOL from the host  will be described according to the order of the encircled number shown in  hereinbelow. The example in  assumes the state where the target data of the data write request from the host  do not have the difference data yet. First, the storage controller  writes the data included in the data write request into the W side of the PVOL cache area, refers to the difference table , and turns on the difference bit corresponding to the area into which the data is to be written.","Then, the storage controller  carries out the process of preventing the data to be written from being automatically written into the PVOL in order to protect the data stored in the area storing the data to be written in the PVOL. This write prevention process will be referred to as \u201cdestaging disable process\u201d hereinbelow. Here, the storage controller  transmits to the host  the notification that the data write process is completed in advance. This process is taken in order to determine that the data write process is completed when the data to be written are written into the cache memory  according to a predetermined process and to efficiently operate the storage system  by decreasing the time dedicated by the host  to the data write process. This process of advance notification of completion of write process will be referred to \u201cCopy-after\u201d hereinbelow.","Next, the storage controller  saves the data stored in the area into which the data to be written in the PVOL to the W side of the pool cache area and releases the destaging disable process. Then, the storage controller  generates a necessary parity data, appends it to the saved data in the W side of the pool cache area, and stores the saved data into the R side of the pool cache area. When the storage controller  finds the data to be stored into the storage device  in the PVOL cache area or the pool cache area of the cache memory , the storage controller  carries out the process for the parity generation above.","Next, the storage controller  stores the data in the R side of the PVOL cache area into the PVOL, and stores the data in the R side of the pool cache area into the storage area in the pool as the difference data, and then terminates the process.","Next, the data write process in the storage apparatus  of the present invention will be described.  schematically shows the data process flow in the storage apparatus  when the process of writing data into the VVOL from the host  is carried out in the present embodiment. The exemplary configuration in  is different from the configuration in  in that the PVOL and the VVOL substantially constituted from difference data creating a snapshot pair are created from the TP pool . Further, in the example of , the configuration regarding the cache memory  is basically the same as the configuration in  except that the temporary cache area C as the cache area temporarily storing the saved data from the PVOL is provided in the cache memory . The temporary cache area C is provided with the W side and the R side as the PVOL cache area A and the TP pool cache area B. The data process flow in the exemplary configuration in  will be described hereinbelow, also referring to the example of the data process flow in .","First, the storage controller  receives the data write request for the VVOL from the host  (S), then, carries out a difference management process S, a difference data saving process S, and a destaging disable process S, and transmits to the host  a notification of completion of data write process in advance (S). The contents of the difference management process S, the difference data saving process S, and the destaging disable process S will be more particularly described later referring to .","Then, the storage controller  reads the data stored in the area to be written in the PVOL as save data and writes the save data as read into the R side of the temporary cache area C (S). Here, the data stored in the area to be written in the PVOL are saved, and the storage controller  cancels the destaging disable process as the process of preventing writing into the PVOL (S).","Next, the storage controller  writes into the W side of the TP pool cache area B the save data of the PVOL from the R side of the temporary cache area C, merges the save data with the data to be written from the host  which have been already written to make the data to be written into the area to which data is not yet assigned in the TP pool  (S). At this stage, the save data from the PVOL are written into the TP pool cache area B by extracting a required part of the data saved in the temporary cache area C according to the write data LBA  and the write data length  recorded in the snapshot job management table .","Next, the storage controller  cancels the destaging disable process for the TP pool cache area B (S). Then, the storage controller  generates a necessary parity data, appends it to the saved data in the W side of the TP pool cache area B, and stores the saved data into the R side of the TP pool cache area B. When the storage controller  finds the data to be stored into the storage device  in the TP pool cache area B, the storage controller  carries out the process for the parity generation above (S).","Then, the storage controller  stores the data stored in the R side of the TP pool cache area B into the storage area of the TP pool  as the difference data (S).","Here, in the process of writing data into a VVOL, assume that the temporary cache area C is not provided as in the existing configuration in . According to this assumption, after transmission of the notification of completion of the data write process for the host , the data to be written stored in the W side of the TP pool cache area B are overwritten with the save data read from the PVOL as the data stored in the area to be written, and the data write process cannot be continued normally. In the present embodiment, the cache memory  is provided with the temporary cache area C, and the copy after process is realized which enables advance notification of completion of data write process to the host . Thus, improvement in the access rate for accessing from the host  is realized.","Next, the difference management process S in  will be described. An example of the flow of the difference management process S is shown in . In the difference management process S, the storage controller  refers to the difference table  and manages the state of the difference of the data to be written by the host .","First, the storage controller  selects the snapshot pair which is the target of the data write process from the difference table  (S). Then, the storage controller  refers to the corresponding part in the difference bitmap table according to the LBA of the data to be written (S), turns on the bit of the corresponding part if the bit is off, and terminates the process. According to the difference management process S, the area where difference data is created for the data stored in the PVOL is managed appropriately.","Next, the process S of the difference data saving will be described. An example of the flow of the difference data saving process S is shown in . In the difference data saving process S, the storage controller  refers to the difference table  and the thin provisioning management table  and manages the area for saving the difference data.","First, the storage controller  refers to the thin provisioning management table  and retrieves the chunk to which data is not yet assigned (S). Then, the storage controller  records the LBA of the chunk which is defined as the area for save data in the save data LBA table  recorded in the difference table  and terminates the process. According to the above process, the area for saving the difference data in the TP pool  for the data write process carried out by the storage controller .","Next, the process S of storing the save data into the temporary cache area C in  will be described. An example of the flow of the save data storing process S is shown in . In the save data storing process S, the storage controller  stores the data read from the target area of writing the data read from the PVOL into the temporary cache area C as the save data.","First, the storage controller  calculates the LBA for the data to be written as an area of the PVOL using the snapshot job management table  and the pair assignment table  in  (S). Then, the storage controller  refers to the temporary cache information, searches a free are in the temporary cache area C, and turns on the bit corresponding to the storage area to be used in the temporary cache information bitmap (S). The temporary cache information is the information managing the unit storage area in the temporary cache area C in the bitmap, and for example held in the cache memory .","Next, the storage controller  reads the save data from the PVOL (S), records the LBA in the temporary cache area C with respect to the data as read in the snapshot job management table , and terminates the process (S). According to the above process, the data stored in the area of a write target of the PVOL are saved.","According to the configuration described above, the data write request from the host  for the snapshot pair created from the TP pool  can be more efficiently processed. As a result, the efficiency of the availability from the host  of the snapshot pair can be improved.","Next, a process of reading data from a VVOL in the present embodiment will be described. As described referring to  and the like, the host  in the storage system  of the present embodiment operates while using a VVOL of a snapshot pair as a data storage area.  shows an example of the flow of the data read process. The data read process is carried out by the storage controller .","First, the storage controller  receives a data read request from the host  (S), refers to the difference table  (S), and determines whether or not the data to be read are difference data (S). If the storage controller  determines that the data to be read are difference data (S, Yes), the storage controller  reads the difference data to be read from the TP pool , transmits the data as read to the host , and terminates the process (S). If the storage controller  determines that the data to be read are not difference data (S, No), the storage controller  reads the data to be read from the PVOL, transmits the data as read to the host , and terminates the process (S). According to the above process, the data read process of the present embodiment is carried out.","Next, a process of restoring data from a VVOL to a PVOL in the present embodiment will be described.  shows an example of the flow of the data restoration process. The data restoration process is carried out by the snapshot controller  in order to restore the PVOL data when a logical failure has occurred to the LU used as the PVOL for example.","First, the snapshot controller  receives a data restoration request from the host  (S), changes the pair status  as usually set \u201cPSUS (Split status)\u201d in the snapshot information table  to \u201cCOPY.\u201d (S) Next, the snapshot controller  reads the difference data from the TP pool , and stores the difference data as read into the corresponding data storage area of the PVOL (S).","The snapshot controller  refers to the difference table , and determines whether or not a difference VVOL which is not a target of restoration and shares the difference data copied to the PVOL exists (S). If the snapshot controller  determines that the different VVOL exists (S, Yes), the snapshot controller  changes the data storage area to which the difference data is correlated to the corresponding data storage area in the PVOL, and terminates the process (S). If the snapshot controller  determines that the different VVOL does not exist (S, No), the snapshot controller  terminates the process without taking an action. According to the above process, the data of the PVOL can be restored using the VVOL as the SVOL when a failure has occurred to the PVOL in the storage system  of the present embodiment.","According to the embodiment of the present invention, a storage system with a function of enabling creating a snapshot pair easily while efficiently utilizing storage resources by employing a thin provisioning and a controlling method of the same are provided. Further, according to the embodiment, a storage system enabling improvement of an access rate in accessing an SVOL in a snapshot pair created with the thin provisioning and a controlling method of the same are provided.","While the present invention is described according to one embodiment thereof with referring to the accompanying drawings, it is to be noted that the present invention should not be taken limitative to the embodiment. Any modification, variation of the present invention and the equivalents thereof that do not depart from the spirit of the present invention will be within the scope of the present invention."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF DRAWINGS","p":[{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 1","b":"1"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 2","b":"10"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 3","b":"100"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 4","b":"200"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 5","b":"100"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 6","b":"106"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 7","b":"300"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 12"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 14","b":"1061"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 15","b":"1062"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 16","b":"1063"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 17","b":"1064"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 18A","b":"1065"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 18B","b":"1065"},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 19","b":"1066"},{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 20","b":"1067"},{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 21","b":"1068"},{"@attributes":{"id":"p-0034","num":"0033"},"figref":"FIG. 22","b":"1069"},{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 23","b":"106"},{"@attributes":{"id":"p-0036","num":"0035"},"figref":"FIG. 24"},{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 25"},{"@attributes":{"id":"p-0038","num":"0037"},"figref":"FIG. 26"},{"@attributes":{"id":"p-0039","num":"0038"},"figref":"FIG. 27"},{"@attributes":{"id":"p-0040","num":"0039"},"figref":"FIG. 28"},{"@attributes":{"id":"p-0041","num":"0040"},"figref":"FIG. 29"},{"@attributes":{"id":"p-0042","num":"0041"},"figref":["FIG. 30","FIG. 29"]},{"@attributes":{"id":"p-0043","num":"0042"},"figref":["FIG. 31","FIG. 29"]},{"@attributes":{"id":"p-0044","num":"0043"},"figref":["FIG. 32","FIG. 29"]},{"@attributes":{"id":"p-0045","num":"0044"},"figref":"FIG. 33"},{"@attributes":{"id":"p-0046","num":"0045"},"figref":"FIG. 34"}]},"DETDESC":[{},{}]}
