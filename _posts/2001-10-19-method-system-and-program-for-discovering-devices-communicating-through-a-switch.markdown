---
title: Method, system, and program for discovering devices communicating through a switch
abstract: Provided is a computer implemented method, system, and program for discovering a topology of a switch from an initiator device. The switch includes a plurality of switch ports. A plurality of Input/Output (I/O) devices are connected to the switch ports, wherein each I/O device and the initiator device connect to the switch through one of the switch ports. The initiator and I/O devices communicate on a first network configured by the switch and the initiator device communicates with the switch over a second network. The initiator device performs submitting a first query over the first network to the switch requesting a unique address of a plurality of I/O devices that are accessible to the initiator device over the first network. In response to the first query to the switch on the first network, the unique address of each I/O device is received from the switch. A second query is submitted over the second network to the switch for information on switch ports on the switch. In response to the second query to the switch over the second network, the information on the switch ports is received. Information on a topology of the switch ports and the initiator and I/O devices having the unique address is generated.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=06965559&OS=06965559&RS=06965559
owner: Sun Microsystems, Inc.
number: 06965559
owner_city: Santa Clara
owner_country: US
publication_date: 20011019
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","SUMMARY OF THE DESCRIBED IMPLEMENTATIONS","DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS","Additional Implementation Details"],"p":["1. Field of the Invention","The present invention relates to a method, system, and program for discovering devices communicating through a switch.","2. Description of the Related Art","A storage area network (SAN) comprises a network linking one or more servers to one or more storage systems. Each storage system could comprise a Redundant Array of Independent Disks (RAID) array, tape backup, tape library, CD-ROM library, or JBOD (Just a Bunch of Disks) components. One common protocol for enabling communication among the various SAN devices is the Fibre Channel protocol, which uses optical fibers or copper wires to connect devices and provide high bandwidth communication between the devices. In Fibre Channel terms the \u201cfabric\u201d comprises one or more interconnected switches, such as cascading switches, that connect the devices. The link is the two unidirectional fibers, which may comprise an optical wire, transmitting to opposite directions with their associated transmitter and receiver. Each fiber is attached to a transmitter of a port at one end and a receiver of another port at the other end.","The Fibre Channel protocol defines a fabric topology. A fabric includes one or more interconnected switches, each switch having multiple ports, also referred to as FPorts. A fiber link may connect an NPort, or node port, on a device to one FPort on the switch. An NPort refers to any port on a non-switch device. An NPort can communicate with all other NPorts attached to the fabric to which the NPort is connected, i.e., NPorts on the immediate switch or interconnected cascading switches.","Another common Fibre Channel topology is the arbitrated loop. The devices in an arbitrated loop are daisy chained together. An LPort is a port on a device that has arbitrated loop capabilities. An NLPort is a device port that is part of a loop and capable of communicating with other NPorts in a fabric. An FLPort is a switch port connected to a loop. In a private loop In a public loop topology, a switch FLPort is connected to the arbitrated loop, thereby allowing communication between the fabric devices and the loop devices. However, often legacy private loop devices are unable to communicate on a fabric because the private loop devices utilize an eight bit Arbitrated Loop Physical Address (ALPA), and do not have the 24 bit address that is used for communication on the fabric.","To migrate legacy private loop devices that are only capable of using the eight bit ALPA to a switched fabric, Q Logic Corporation provides the SANbox-16STD Fibre Channel switch that incorporates multiple private loop devices into a switched fabric. The QLogic switch includes multiple Segmented Loop Ports (SLPorts), which function as FLPorts and may have an attached private loop, also referred to as a looplet. Thus, the QLogic switch is comprised of multiple SLPorts, where each SL port may support a separate arbitrated loop that has attached private loop devices. The SL ports on the switch and any devices attached to looplets attached to the SLPorts are configured as a single logical Fibre Channel Arbitrated Loop (FC-AL), also referred to as a segmented loop. During initialization, the switch assigns unique eight bit Arbitrated Loop Physical Addresses (ALPAs) to each SLPort and to any device attached to a looplet on an SLPort to form a segmented loop. Within a segmented loop any device within one private looplet attached to one SLPort may communicate with any device in another private looplet attached to another SL port on the switch. Further details of the SANbox-16STD Fibre Channel switch are described in the QLogic publications \u201cSANbox-16STD Fibre Channel Switch: Installer's\/User's Manual,\u201d QLogic Publication No. 59012-03 Rev. A (August, 2000) and \u201cReducing the Complexity of Managing Private Loops\u201d, a White Paper (2000), downloaded from the Internet at \u201chttp:\/\/www.qlogic.com\/products\/pdf\/privateloops.pdf\u201d, which publications are incorporated herein by reference in their entirety.","In such segmented loop environments, a systems administrator may want to understand and visualize the topology of all the devices on the segmented loop, such as the relationship of devices in looplets attached to SLPorts on a switch, including devices in the same zone as well as other zones. Thus, there is a need in the art for improved techniques for ascertaining the topology of an arrangement of private loops attached to a switch.","Provided is a computer implemented method, system, and program for discovering a topology of a switch from an initiator device. The switch includes a plurality of switch ports. A plurality of Input\/Output (I\/O) devices are connected to the switch ports, wherein each I\/O device and the initiator device connect to the switch through one of the switch ports. The initiator and I\/O devices communicate on a first network configured by the switch and the initiator device communicates with the switch over a second network. The initiator device performs submitting a first query over the first network to the switch requesting a unique address of a plurality of I\/O devices that are accessible to the initiator device over the first network. In response to the first query to the switch on the first network, the unique address of each I\/O device is received from the switch. A second query is submitted over the second network to the switch for information on switch ports on the switch. In response to the second query to the switch over the second network, the information on the switch ports is received. Information on a topology of the switch ports and the initiator and I\/O devices having the unique address is generated.","In further implementations, at least one I\/O device is attached to a loop that is attached to the switch port through which the device connects to the switch.","In still further implementations, in response to the first query to the switch over the first network, switch addresses are received. The switch assigns the switch addresses to the I\/O devices attached to the switch ports. The topology information is generated to include the received switch addresses for the I\/O devices.","In yet further implementations, an additional query is submitted on the second network to at least one other initiator device connected to one switch port, wherein the at least one other initiator device generates topology information to determine topology information for I\/O devices to which the at least one other initiator device is capable of communicating on the switch. The topology information is updated with topology information received in response to the query on the second network to the at least one other initiator device.","Further, the initiator device generates the topology information for I\/O device ports and initiator ports, wherein each I\/O device and the initiator device are capable of including multiple ports.","In the following description, reference is made to the accompanying drawings which form a part hereof and which illustrate several embodiments of the present invention. It is understood that other embodiments may be utilized and structural and operational changes may be made without departing from the scope of the present invention.",{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 1","b":["2","4","4","4","4","6","2","4","4","4","4","8","8","8","10","10","10","10","10","10","10","10","10"],"i":["a","b","c","d ","a","b","c","d ","a","b","c ","a","b","c, d","e","f","g","a","b ","g "],"sub":["\u2014","\u2014"]},"In certain implementations, during initialization, the switch manager  assigns each device port , . . . a unique eight bit Arbitrated Loop Physical Address (ALPA), so that the switch ports , , , themselves are addressable using the eight bit ALPA address. Further, the switch manager  would assign each of the private loop devices , . . . a unique eight bit ALPA address, thereby configuring all the switch ports , , , and private loop devices , . . . as a single Fibre Channel Arbitrated Loop that utilizes the eight bit ALPA addressing scheme. In , one of the private loop devices comprises a host system that includes a discovery tool . Although only one host is shown in , the topology may include any number of host systems and private loop devices attached to the loops , , , limited by the capacity of the switch.","The switch manager  may assign an address to each device port. Thus, if the device, e.g., host, storage device, etc., includes adaptor cards with multiple ports, each port providing a communication channel to the device would be assigned a unique ALPA address, as well as have a unique address, such as a worldwide name. Additionally, each device having multiple ports may have a world wide name (WWN) which is the address of the device node aggregating multiple ports. The line shown in  illustrating the connection from the loops , , to the private loop devices , . . . should be interpreted to include multiple lines connecting the loop to the device , . . . if the device , . . . has multiple ports connecting to the loop , , ","In the implementation of , all the switch ports , , , and private loop devices , . . . on separate private loops , , behave as one large private loop. An example of a Fibre Channel technology that configures switch ports , , , and private loop devices , . . . as a single arbitrated loop is the segmented loop topology implemented in the QLogic Corporation's SANbox** 16STD Fibre Channel Switch, described in the QLogic publication \u201cSANbox-16STD Fibre Channel Switch: Installer's\/User's Manual,\u201d which was incorporated by reference above. The switch manager  may include functionality offered by the QLogic SANsurfer switch management application program, described in the QLogic Publication \u201cSANbox-8\/16 Switch Management User's Manual, QLogic Publication No. 59010-06 Rev. A (July, 2001), which publication is incorporated herein by reference in its entirety. The discovery tool  is an application program that may be run on any host to determine the physical topology of all the devices attached to the switch , including all the loop segments , , that function as one large arbitrated loop.","The switch manager  controls switch  management. The switch manager  is also assigned an Internet Protocol (IP) address to allow communication with the switch manager  over an additional network, such as a Local Area Network (LAN) utilizing alternative network technology, such as Ethernet network technology.  illustrates an additional network , such as an Ethernet LAN, that enables communication between the switch manager  and certain private loop devices , . . . , such as host and any other hosts. The network  is out-of-band with respect to the Fibre Channel communication enabled by the switch . In certain implementations, the switch manager  implements a web based management tool that allows hosts connected to the switch  to access and control the switch manager  using a web interface, such as a Hypertext Transfer Protocol (HTTP) web browser, over the network . The discovery tool  would communicate with the switch manager  over the network  using switch Application Programming Interfaces (APIs), which allow the discovery tool  to query the switch manager  for information on the switch  and devices attached to the switch .","The host executes the discovery tool  to discover the topology of all the private loop devices , . . . and switch ports on the switch . Certain types of switches , such as the QLogic SANbox switches discussed above, implement a non-standard topology, such as the QLogic segmented loop topology. Such non-standard switch topologies, such as the QLogic segmented loop technology, do not support standardized Fibre Channel methods for obtaining connectivity information, e.g., the standard Fibre Channel discovery techniques described in the publication \u201cFibre Channel Generic Services-3 (FC-GS-3), Rev. 7.01 \u201d, proposed draft published by the American Nat'l Standard of Information Technology (Nov. 28, 2000), which publication is incorporated herein by reference in its entirety.",{"@attributes":{"id":"p-0026","num":"0025"},"figref":["FIG. 3","FIG. 1","FIG. 3","FIG. 3"],"b":["104","104","104","104","100","110","110","110","104","104","104","104","4","4","4","4","104","104","110","110","110","110","104","104","110","110","110","110","110","110","110","110","110","112","112","206","110","110","110","200","100","112","112"],"i":["a","b","c","d ","a","b ","i ","a","b","c","d ","a","b","c","d ","a ","b","a","b","c","d ","c ","d ","e","f","g","h","i ","a ","h","a ","h ","a ","b","a","b ","i ","a ","b "],"sub":["\u2014","\u2014","\u2014"]},{"@attributes":{"id":"p-0027","num":"0026"},"figref":["FIG. 4","FIG. 7"],"b":["300","300","302","302","112","302","302","306","306","310","310","308","308","322","322","322","322","322","322","326","326","330","330","328","328","300","300"],"i":["a ","n","a, b","a ","n ","a ","n ","a ","n ","a ","n ","a","b ","m ","a","b ","m ","a ","m ","a ","m ","a ","n "],"sub":["\u2014","\u2014"]},{"@attributes":{"id":"p-0028","num":"0027"},"figref":["FIGS. 5 and 6","FIGS. 1 and 3","FIG. 2","FIG. 4","FIG. 5","FIG. 2"],"b":["12","112","112","10","110","110","4","4","4","4","30","2","12","12","112","112","300","400","12","112","112","300","400","402","450","12","402","2","100","450","30","2","112"],"i":["a","b ","a","a","h ","a","b","c","d","a","b ","a","b "]},"For the in-band communication, a loop is performed at blocks  through  for each initiator port i on the host , , in which the invoked discovery tool , , is executing. The discovery tool , , sends an inquiry command, such as a Small Computer System Interface (SCSI) inquiry command, using the in-band Fibre Channel network, to obtain the world wide name (WWN) and ALPA for every target device (e.g., , . . . in , . . . in ) port attached to the switch , . Note that if the initiator in which the discovery tool , , is executing is within a particular zone, then the in-band inquiry command would not discover target devices in other zones. The discovery tool ,  then generates (at block ) an initiator i port object and device port objects , . . . () for each target device port determined from the inquiry command and updates the generated objects with the world wide name (WWN) and ALPA for the ports determined from the inquiry command. The initiator port i object is then associated (at block ) with each of the generated device port objects , . . . to which the initiator port i can communicate. Control then proceeds (at block ) back to block  to generate topology information for the next initiator port in the host , , h in which the discovery tool , , is executing.","The discovery tool , , may begin the out-of-band operations from block  while the in-band operations at blocks  through  are executing or after  through  has completed. At block , the discovery tool , , uses switch APIs to query the switch ,  to determine the world wide name (WWN) of all initiator ports attached to any of the switch ports , , , (, , , (). The topology database  is updated (at block ) to include an initiator port object . . . for each determined initiator port and the WWN and switch port number fields in each generated initiator port object are updated to include the WWN and switch port number determined when querying the switch at block . Note that because this communication is out-of-band, the determined initiator ports may be in different zones from the initiator ports in the host , , in which the discovery tool , , is executing. The switch ,  is then queried (at block ) to determine the number of switch ports , , , , , , , ().","For each determined switch port j, a loop is performed at blocks  through . If switch port j does not have an attached initiator, then the discovery tool , , queries (at block ) the switch ,  to get all of the ALPAs of target device ports attached to the switch port j. There may be multiple ALPAs attached to switch port j if switch port j is attached to an arbitrated loop , , , , , (). A loop is then performed at blocks  through  for each determined ALPA k. At block , the discovery tool , , queries the topology database  to determine the WWN . . . of device port objects . . . having an ALPA value . . ., which would have been indicated in the device port object . . . at step , that matches ALPA k. In other words, the determined target device port having ALPA k attached to switch port j is in-band with respect to the host , , including the discovery tool , , ","With respect to , a loop is then performed at blocks  through  for each target device port m having an ALPA matching ALPA k. At block , the discovery tool , , queries the topology database  to determine the initiator port object of the source host , , associated with the target device port m object . . . If (at block ) the switch port of of the determined initiator port object is in the same zone as switch port j, to which the target device port m is attached, then the topology database  is updated (at block ) to reflect that the switch port number , . . . in the device port m object is switch port j. If (at block ), the switch port of the determined initiator port is in a different zone, then such different zone also includes target device port m. From the no branch of block  or block , control proceeds (at block ) to block  to consider the next determined target device port m.","After updating the switch port numbers , . . . for all of the device port objects associated with the initiator port object , control proceeds (at block ) back to block  to process the next ALPA k. After considering all ALPAs attached to the switch port j, control proceeds (at block ) back to block  to consider the next switch port , , , , , , , (). The result of the in-band and out-of-band processing at blocks \u2013 and blocks \u2013 is the topology database  having information objects for all the initiator ports within the host , from which the discovery tool , , is executing and for each target device to which the initiator ports can communication through the switch , , including the world wide name (WWN), ALPA, and switch port number for the initiator ports and all the associated target device ports.","If (at block  in ) an initiator port is attached to switch port j, then control proceeds to block  to consider the next switch port. After updating, the topology database  includes information on the target devices attached to the switch port to which the host , , can communicate, which includes those target devices in the same zone as the host. In such case, control proceeds to  to obtain information on target devices, including target devices in zones outside of the zone including the host invoking the discovery tool , , operations at block  () At block , the discovery tool , , queries (at block ) other host through their initiator port to retrieve the topology database  generated by the discovery tool , , executing in the queried initiator port. The discovery tool , , would include APIs to allow discovery tools executing in hosts to query other hosts for the topology databases  generated by the discovery tools , , , thereby allowing a sharing of topology databases  to provide topology information for all initiator and target devices attached to the switch, including information on target devices in other zones. At block , the discovery tool , , updates the topology database  with information from the retrieved topology database  to provide a full view of the devices attached to the switch. Because the queried initiator ports may be in different zones, the discovery tool , , is capable of updating its topology database  with the topology of devices in other zones that is provided by discovery tools executing in hosts having initiator ports in different zones.","With the above described implementations, a host that is attached to an arbitrated loop, such as one of the private arbitrated loops , , , , that is attached to a switch  that does not implement standard Fibre Channel discovery protocols may nevertheless ascertain the topology of the devices that are attached to switch ports on the same switch. For instance, in implementations where the switch ,  is utilizing the segmented loop technology of QLogic, the described implementations allow hosts to discover the topology of all hosts and devices attached to loops on the segmented loop switch ports of the switch when all the devices are assigned a unique eight bit ALPA.","The above described method, apparatus or article of manufacture for discovering a switch topology may be implemented using standard programming and\/or engineering techniques to produce software, firmware, hardware, or any combination thereof. The term \u201carticle of manufacture\u201d as used herein refers to code or logic implemented in hardware logic (e.g., an integrated circuit chip, Field Programmable Gate Array (FPGA), Application Specific Integrated Circuit (ASIC), etc.) or a computer readable medium (e.g., magnetic storage medium (e.g., hard disk drives, floppy disks,, tape, etc.), optical storage (CD-ROMs, optical disks, etc.), volatile and non-volatile memory devices (e.g., EEPROMs, ROMs, PROMs, RAMs, DRAMs, SRAMs, firmware, programmable logic, etc.). Code in the computer readable medium is accessed and executed by a processor. The code in which preferred embodiments of the configuration discovery tool are implemented may further be accessible through a transmission media or from a file server over a network. In such cases, the article of manufacture in which the code is implemented may comprise a transmission media, such as a network transmission line, wireless transmission media, signals propagating through space, radio waves, infrared signals, etc. Of course, those skilled in the art will recognize that many modifications may be made to this configuration without departing from the scope of the present invention, and that the article of manufacture may comprise any information bearing medium known in the art.","Certain implementations concerned a switch that utilized the segmented loop technology developed by QLogic. However, those skilled in the art will recognize that the discovery techniques described herein may apply to any other switch technologies that do not enable all the Fibre Channel discovery tools. In such case, the described discovery implementations may be used to gather device information from both a switch manager program and the devices themselves using a combination of in-band and out-of-band communications.","The described implementations provide a discovery technique used in a Fibre Channel architecture to allow discovery of devices attached to a Fibre Channel network that utilize an 8 bit ALPA addressing scheme. However, those skilled in the art will appreciate that the discovery techniques of the described implementations may be utilized with network transmission protocols other than Fibre Channel when groups of devices in the network use different addressing schemes. Accordingly, the invention is not limited to the Fibre Channel protocol environment, but may also be used to discover the topology of a switched network in non-Fibre Channel environments when information may be gathered by accessing the devices in the topology through different networks.","In described implementations, the switch ,  configured the switch ports and loop devices to have an eight bit ALPA address. In alternative implementations, alternative addressing schemes may be used.","The topology of ,  and  are provided for illustration. The described address mapping implementations may apply to any switch topology involving any number of interconnected switches, switch ports, and devices attached to either the switch port directly or through a loop attached to the switch port.","The described implementations involved the discovery of devices attached to ports on a single switch. In additional implementations, the discovery techniques of the described implementations may be used to discover devices across switches in the same fabric.","In the described implementations, the discovery tool was executed from a host system , , . Additionally, the discovery tool may be executed on loop or non-loop devices other than hosts, such as a network appliance capable of performing logical I\/O operations and capable of both in-band communication with the switch on a switch implemented network, e.g., the SAN, and out-of-band communication with other network devices on an additional network, e.g., an Ethernet.","In the described implementations, the loop devices and switch ports were queried for information concerning their eight bit ALPA and world wide name. Additionally, the loop devices and switch ports may be queried for additional information on the device that may be added to the switch port and loop device objects in the mapping.","The foregoing description of various implementations of the invention has been presented for the purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise form disclosed. Many modifications and variations are possible in light of the above teaching. It is intended that the scope of the invention be limited not by this detailed description, but rather by the claims appended hereto. The above specification, examples and data provide a complete description of the manufacture and use of the composition of the invention. Since many embodiments of the invention can be made without departing from the spirit and scope of the invention, the invention resides in the claims hereinafter appended."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Referring now to the drawings in which like reference numbers represent corresponding parts throughout:",{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIGS. 1","b":["2","3"]},{"@attributes":{"id":"p-0017","num":"0016"},"figref":["FIG. 4","FIGS. 5 and 6"]},{"@attributes":{"id":"p-0018","num":"0017"},"figref":["FIGS. 5 and 6","FIGS. 1 and 3"]}]},"DETDESC":[{},{}]}
