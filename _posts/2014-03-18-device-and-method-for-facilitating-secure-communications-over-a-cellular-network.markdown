---
title: Device and method for facilitating secure communications over a cellular network
abstract: A process for communicating utility-related data over at least one network is described. the process includes: collecting utility-related data at a hub device during a first predetermined period of time; securing the utility-related data at the hub device using digital envelopes during the first predetermined period of time; initiating by the hub device an autonomous wake up process during a second predetermined period of time; sending the secure utility-related data over a first network to a designated server via at least one User Datagram protocol (“UDP”) message during the second predetermined period of time; and receiving an acknowledgement of receipt message of the at least one UDP message from the designated server; wherein the first and second predetermined periods of time typically do not overlap, but may overlap.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09342293&OS=09342293&RS=09342293
owner: Trilliant Networks Inc.
number: 09342293
owner_city: Redwood City
owner_country: US
publication_date: 20140318
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","BACKGROUND","SUMMARY","DESCRIPTION OF THE PREFERRED EMBODIMENTS"],"p":["This application is a continuation of allowed U.S. application Ser. No. 13\/369,520, filed Feb. 9, 2012, entitled \u201cDEVICE AND METHOD FOR FACILITATING SECURE COMMUNICATIONS OVER A CELLULAR NETWORK\u201d, which claims benefit of priority to U.S. Provisional Patent Application No. 61\/441,375 filed Feb. 10, 2011 entitled \u201cDEVICE AND METHOD FOR FACILITATING SECURE COMMUNICATIONS OVER A CELLULAR NETWORK\u201d, both of which are incorporated herein by reference in their entirety.","1. Field of Embodiments","The embodiments described herein are generally directed to improved communications between HAN devices and head-end systems utilizing a communications hub function over a WAN such as a cellular network.","2. Summary of Related Art",{"@attributes":{"id":"p-0006","num":"0005"},"figref":["FIG. 1","FIG. 1"],"b":["10","15","20","25","30","35","15","20","15","20","15","20","20","15"]},"In order to track utility use data and provide such data or information related thereto to the service provider and\/or the subscriber, there must be communications from the Reporting Devices. Traditionally, such information had to be taken directly from the meter, i.e., a person had to walk up to the meter(s) at the subscriber premise and literally read the meter. Technology progressed, and the process was arguably improved through the use of stand-off or drive by meter reading, whereby a person could take readings using, e.g., RF communications, from a truck driving by and\/or walking by a premise. Currently, technology has advanced to the point where meter readings can be communicated remotely using WANs, e.g., cellular networks, without the need for a person to physically view or approach the individual meters or the subscriber premises. While this system and process is promising, there are some implementation hurdles due to the need to scale to millions, potentially billions, of subscriber premises and reporting devices. WAN bandwidth is not unlimited and it is clearly susceptible to overload. This degree of scaling presents challenges to the communication and processing processes as described further herein.","Referring back to , the current process for managing communications between the Reporting Devices  and the HES  is burdensome both on the WAN and the processing power of the components. Currently, Reporting Devices  are configured to report usage, alarm and other utility related data to their respective Comms Hubs . For example, individual Reporting Devices  may be programmed to report readings to the Comms Hub  which records the reported information at half-hour intervals and the Comms Hub in turn reports the totality of the collected and recorded information at a predetermined time to the HES in a batch process. The details of the local data reporting process within the Premise is not the subject of this patent application. Descriptions of such processes are known and available to those skilled in the art and described in the Attachments hereto which are incorporated by reference in their entirety. Using known batch processes, even if the Comms Hub reports data to the HES during off-peak cell usage times, the shear volume of communications can either overwhelm a network, such as a cell network or become prohibitively expensive, i.e., use of the cell is often subject to per call or per message tariffs.","By way of specific example, current processes for using system  of  require the following steps as shown in . In the prior art process, when the HES wants to get info from Comms Hub, the HES sends a Short Message Service (\u201cSMS\u201d), Message #1 (M#1) which tells the Comms Hub to wake up. When the Comms Hub wakes up, it establishes a high speed connection to the WAN, with instructions regarding where data from the Comms Hub needs to go M#2. In operation, M#2 facilitates using the high speed data connection of the WAN cloud (e.g., GPRS on GSM, CDMA2000 or the like), establishment of 2-way data communication between the Comms Hub and the HES. The WAN cloud mobile operator sets up an IP address for the Comms Hub so that is can communicate in both directions with the HES across the cell phone data network and the IP virtual LAN (IP-VLAN) to the HES. Accordingly, the connection for both WAN's cellular data network and IP network are established. The HES next sends an information request using the IP network to the Comms Hub M#3. In certain limited circumstances, the Comms Hub may send an acknowledgement message to the HES to acknowledge receipt of the information request M#4. Otherwise, the Comms Hub sends a response to the HES information request (M#3) which is M#5. The HES sends an acknowledgement message to the Comms Hub to acknowledge receipt of the response to the information request (M#5) which is M#6.","Accordingly, under the prior art messaging process, the HES must send an SMS message every time it wants to wake up a Comms Hub and wait for a reply to request information. Since the HES's request for meter read info from thousands and even millions of Comms Hubs, there are equally as many SMS messages to be sent each day. SMS messages are traditionally tariffed individually or tariffed with enough restrictions as to make their use precious. The SMS wakeup and response step takes time because SMS delivery can be slow and it takes time to set up the GPRS data network connection. This slows down the HES process and waists HES processing resources. As such, this wake up step is an expensive step in the prior art process. Further, the handshake-based IP protocols, e.g., TCP\/TLS, of the prior art process requires multiple messages within a single thread and real-time securitization which contributes to latency including decreased throughput, increased time on network, and increased processing time. There is a need in the art to utilize the existing infrastructure of in such a way that the SMS and IP message volume and latency are reduced\/minimized, but there is no compromise in security.","In accordance with an embodiment described herein, a process for communicating utility-related data over at least one network includes: collecting utility-related data at a hub device during a first predetermined period of time; securing the utility-related data at the hub device using digital envelopes during the first predetermined period of time; initiating by the hub device an autonomous wake up process during a second predetermined period of time; sending the secure utility-related data over a first network to a designated server via at least one User Datagram protocol (\u201cUDP\u201d) message during the second predetermined period of time; and receiving an acknowledgement of receipt message of the at least one UDP message from the designated server.","In accordance with an embodiment described herein, a process for communicating utility-related data over at least one network includes: collecting utility-related data from a first network at a hub device during a first predetermined period of time; securing the utility-related data at the hub device using digital envelopes during the first predetermined period of time; initiating by the hub device an autonomous wake up process during a second predetermined period of time; sending the secure utility-related data from the hub device over a second network to a designated server via at least one User Datagram protocol (\u201cUDP\u201d) message during the second predetermined period of time; and receiving an acknowledgement of receipt message of the at least one UDP message from the designated server.","This document includes the following acronyms and terms as defined in the tables set forth below:",{"@attributes":{"id":"p-0081","num":"0080"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"168pt","align":"left"}}],"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}},{"entry":["Acronym","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["ACSE","Association Control Service Element (DLMS UA)"]},{"entry":["APDU","Application Protocol Data Unit"]},{"entry":["API","Application Programming Interface"]},{"entry":["APS","Application Protocol Sub-layer (ZigBee)"]},{"entry":["ASE","Application Service Element (DLMS UA)"]},{"entry":["CBKE","Certificate Based Key Establishment (ZigBee)"]},{"entry":["COSEM","Companion Specification for Energy Meters (DLMS UA)"]},{"entry":["DE","Digital Envelope"]},{"entry":["DLMS","Device Language Message Specification (DLMS UA)"]},{"entry":["DLMS UA","DLMS Users Association"]},{"entry":["DNS","Domain Name Server (IETF)"]},{"entry":["DST","Daylight Savings Time (local time)"]},{"entry":["EUI","Extended Unique Identifier"]},{"entry":["GPRS","General Packet Radio Service (DLMS UA)"]},{"entry":["GSM","Global System for Mobile Communications (IEC)"]},{"entry":["HAN","Home Area Network"]},{"entry":["HES","Head End System"]},{"entry":["HHT","Hand Held Terminal"]},{"entry":["IC","Interface Class (DLMS UA) (standards group)"]},{"entry":["IEEE","Institute of Electrical and Electronics Engineers"]},{"entry":[{},"(standards group)"]},{"entry":["IETF","Internet Engineering Task Force (standards group)"]},{"entry":["IHD","In-Home Device"]},{"entry":["IP","Internet Protocol (IETF)"]},{"entry":["IPv4","Internet Protocol Version 4 (IETF)"]},{"entry":["ISMI","International Mobile Subscriber Identity"]},{"entry":["MAC","Medium Access Control (IEEE)"]},{"entry":["MLD","Management Logical Device (DLMS UA)"]},{"entry":["MSE","Manufacturer Specified Extension (additional"]},{"entry":[{},"ZigBee clusters)"]},{"entry":["MSIN","Mobile Subscriber Identification Number"]},{"entry":[{},"(part of IMSI)"]},{"entry":["OTA","Over The Air"]},{"entry":["PAN","Personal Area Network (IEEE)"]},{"entry":["PPP","Point to Point Protocol (IETF)"]},{"entry":["RPC","Remote Procedure Call"]},{"entry":["SMS","Short Message Service (IETF)"]},{"entry":["TCP","Transmission Communication Protocol (IETF)"]},{"entry":["TLS","Transport Layer Security (IETF)"]},{"entry":["TOU","Time Of Use"]},{"entry":["UDP","User Datagram Protocol (IETF)"]},{"entry":["UTC","Coordinated Universal Time"]},{"entry":["WAN","Wide Area Network"]},{"entry":["WPDU","Wrapper Protocol Data Unit (DLMS UA)"]},{"entry":["xDLMS","Extended Device Language Message Specification"]},{"entry":[{},"(DLMS UA)"]},{"entry":["ZCL","ZigBee Cluster Library"]},{"entry":["ZGD","ZigBee Gateway Device"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}}}},{"@attributes":{"id":"p-0082","num":"0081"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"77pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"140pt","align":"left"}}],"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}},{"entry":["Term","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Application Service","DLMS\/COSEM Application Service Elements:"]},{"entry":["Element","ACSE and xDLMS"]},{"entry":["Association Control","DLMS\/COSEM application layer service that"]},{"entry":["Service Element","controls the association of client application"]},{"entry":[{},"processes"]},{"entry":["channel mask","Channels available for use by the HAN devices"]},{"entry":["cluster","A related set of attributes and methods"]},{"entry":["Comms Hub","Communications hub that connects to the"]},{"entry":[{},"WAN and the HAN networks. It reports"]},{"entry":[{},"metering information and manages the"]},{"entry":[{},"metering and in-home devices."]},{"entry":["E-meter","Electricity meter"]},{"entry":["EUI-64","The 64 bit, IEEE administered EUI used to"]},{"entry":[{},"identify devices and as the MAC address"]},{"entry":["G-meter","Gas meter"]},{"entry":["Interface Class","(COSEM) an Interface Class (IC) is a generic"]},{"entry":[{},"format of a COSEM object specifying"]},{"entry":[{},"attributes, their data types, and the method for"]},{"entry":[{},"the server and client"]},{"entry":["Inter-PAN","Limited functionality connection established"]},{"entry":[{},"without forming a network"]},{"entry":["MAC address","The 64 bit globally unique address assigned to"]},{"entry":[{},"each IEEE802 device, which includes the HAN"]},{"entry":[{},"devices. The address is structured, and it"]},{"entry":[{},"identifies the manufacturer"]},{"entry":["Management Logical","DLMS\/COSEM element that reveals the"]},{"entry":["Device","internal protocol structure of a physical device"]},{"entry":["mobile operator","WAN GSM\/GPRS system operator (e.g.,"]},{"entry":[{},"Vodafone)"]},{"entry":["PAN coordinator","(IEEE802.15.4) the controller of the"]},{"entry":[{},"IEEE802.15.4 network"]},{"entry":["push","A Comms Hub initiated message to the Head"]},{"entry":[{},"End System"]},{"entry":["short address","The 16 bit IEEE802.15.4 address assigned to a"]},{"entry":[{},"device on joining the HAN network"]},{"entry":["smart meter network","The WAN and HAN networks and Comms"]},{"entry":[{},"Hub that provides communication services to"]},{"entry":[{},"the Head End System and HAN devices"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}}}},"The following documents are incorporated herein by reference in their entirety: \u201cUCAIug Home Area Network System Requirements Specification: A Work Product of the OpenHAN Task Force formed by the SG Systems Working Group under the Open Smart Grid (OpenSG) Technical Committee of the UCA International Users Group,\u201d Version 2.0\u2014Aug. 30, 2010; \u201cZigBee Smart Energy Profile Specification,\u201d ZigBee Profile: 0x0109; Revision 16, version 1.1, Mar. 23, 2011, Document 075356r16; ZigBee Smart Energy Test Specification, May 2008 ZigBee Document 075384r17; ZigBee Cluster Library Specification, ZigBee Document 075123r02ZB; and Institute of Electrical and Electronics Engineers, Inc., IEEE Std. 802.15.4-2003 & 2006, IEEE Standard for Information Technology\u2014Telecommunications and Information Exchange between Systems\u2014Local and Metropolitan Area Networks\u2014Specific Requirements\u2014Part 15.4: Wireless Medium Access Control (MAC) and Physical Layer (PHY) Specifications for Low Rate Wireless Personal Area Networks (WPANs); \u201cNetwork Specification\u201d Version 1.00, ZigBee Document 02130r10; \u201cDraft Smart Energy Profile Specification\u201d ZigBee Document 105638r08ZB Rev. 16 Ver. 0.9 Jul. 20, 2010; \u201cZigBee SE 1.x Extensions for UK\u201d Revision 1.0, filename: Zigbee_SE1.x_Extensions UK_rep1.doc, Date: 23 Nov. 2010; \u201cZigBee Over-The_Air Upgrading Cluster\u201d ZigBee Document 095264r18, Rev. 18, Version 1.0, Mar. 14, 2010; and \u201cNetwork Device: Gateway Specification\u201d Version 1.0, ZigBee Document 075468r35, Rev 35, Mar. 23, 2011. Further, many of these documents and the subject matter therein is updated periodically and those updates are appreciated by one skilled in the art and considered to be included herein.","As shown in the figures and discussed further herein, the Comms Hub acts as a coordinator and gateway between the WAN and HAN. Accordingly, the Comms Hub processor or processors are configured with necessary programming, e.g., firmware, in order to interface with the separate networks.",{"@attributes":{"id":"p-0085","num":"0084"},"figref":["FIG. 2","FIG. 1"],"b":["10","30","30","30","30","32","20","20","20","22","22","22"],"i":["a","b","x "]},"A more particular exemplary implementation of the general network component architecture \u2032 is illustrated in . The exemplary smart meter system of implement a mix of DLMS and ZigBee objects. One skilled in the art recognizes that these are exemplary objects and the architecture may be expanded to accommodate other protocols as well. In these deployments a Comms Hub A is in communication with one G-meter A, one E-meter Aand an IHD A. Deployments with multiple meters use the same ZigBee Gateway structure in the Comms Hub. The COSEM communication profiles for use on IPv4 networks provide the HES with the ability to communicate with the DLMS objects of the different Application Processes (AP) of an IP addressed node, i.e., the Comms Hubs (as shown in ). The DLMS protocol, supported on IP port 4059 of the Comms Hub cannot be used natively to access the DLMS objects implemented by HAN nodes such as the E-meters or the HHT. This protocol also cannot be used to access the ZigBee ZCL objects implemented by the Comms Hub or any of the different ZigBee HAN nodes. The ZigBee Gateway protocol is used to communicate DLMS messages to the DLMS HAN devices as shown in ","As is understood by those skilled in the art, the ZigBee Gateway specification implements remote interactions with ZigBee devices. The ZigBee Gateway protocol accesses both DLMS and ZCL objects on the Comms Hub and any of the devices on the ZigBee network.",{"@attributes":{"id":"p-0088","num":"0087"},"figref":"FIGS. 3and 3"},"The GPRS protocol is used to gain access to the mobile data network and to frame the data transmissions over the WAN. It is a connection-oriented protocol, and the connection is initiated by the Comms Hub. The data transmitted over the GPRS connection uses the IPv4 Network Layer and an IETF Transport Layer protocol. The IP transport port numbers are used to direct messages to different devices. The DLMS\/COSEM TCP and UDP port 4059 is used for the Comms Hub's DLMS physical device client application process. The ZigBee Gateway Device's (ZG) IP port assignment, 17756, allows the HES to communicate directly with the ZigBee clusters in the Comms Hub. These clusters include the control clusters for the E-meter(s), the IHD(s), and G-meter(s).","TCP\/TLS is used at the IP transport layer for HES initiated communications and UDP\/DE for push messages from the Comms Hub.","WAN messages use TLS security protocol for TCP and digital envelope security for UDP. The digital envelop layer is above the transport layer and below the xDLMS layer and the ZigBee APS layer.","TCP\/TLS DLMS messages use the DLMS\/COSEM transport layer wrapper. This wrapper identifies the source and destination client application processes within the device.","The DLMS\/COSEM application sub-layer Association Control Service Element provides services for the client application processes. These services include setting up the association of the client application processes between devices. The xDLMS services include get, set, action, event notification, and trigger event notification.","The ZigBee ZCL and Grip layer is used by the ZigBee Gateway described further below. The ZigBee Gateway allows the HIES to communicate with the DLMS and ZigBee objects in the HAN devices and Comms Hub.","The following paragraphs summarize various examples of the paths that messages may take either up or down through the stacks illustrated in . These listings represent general flows through the stack, not steps, and are intended to be exemplary. Further, additional stack\/layer details, message flows, and message formats are described throughout the specification.","In a first use case, a HES to Comms Hub stack sequence flow for a TCP DLMS get message sent to an E-meter by the HES through the Comms Hub communication layers includes the following flows (the WAN registration is already established): GPRS; IPv4 (destination address=the Comms Hub IP address); IP transport destination port (set to the ZigBee gateway, 17756); TCP (session established with the Comms Hub); TLS (decrypted at the Comms Hub using the TLS session key); ZigBee Gateway Grip header procedure call, sendDLMScommand, addressed to the E-meter's MAC address and ZigBee DLMS Tunnel cluster: (the Comms Hub places DLMS message in a ZigBee tunnel payload); ZigBee APS (set to the cluster source and destination IDs=Tunnel cluster); ZigBee Network (tunnel end point's short address=target E-meter address); Data Link Layer (destination address short address=target E-meter address); and PHY (IEEE802.15.4 radio).","In a second use case, a Comms Hub to HES stack sequence for a push using UDP\/DE for a DLMS message sent to the HES by the Comms Hub includes the following flows: DLMS physical device application process constructs a message (the Comms Hub push aggregator message); xDLMS (send a set.request to the Head End System); DLMS\/COSEM Push format: source application process tag, DLMS attributes (class ID, instance ID, attribute ID, value); Digital Envelope (encrypt and sign using certificates); UDP protocol: IP transport layer destination port (set to HES's IP transport port for the push messages, 54059); IPv4 (set to the HES's IP address); PPP; and GPRS.","In a third use case, a HES to Comms Hub stack sequence flow for a TCP ZigBee PutPrice cluster message sent to the Comms Hub Price cluster by the HES includes the following flows: GPRS; PPP; IPv4 (set to the Comms Hub's IP address); IP transport destination port (set to the gateway 17756 port); TCP (session established with the Comms Hub); TLS (decrypted at the Comms Hub using the TLS session key); ZigBee Gateway Grip header procedure call, PutPrice (addressed to Price cluster ID); and Price cluster payload.","More specifically, communications with the WAN may require registration with a GSM circuit switched network using either the 900 MHz or 1800 MHz band utilizing one or both of an external and internal antenna. This registration with the GSM circuit switched network does not create a connection to the HES.","The Head End System interface to the SMS service uses GDSP call (e.g., Vodafone API call: submitSMS( )). This call has the payload: UserName, Password, Head End System IP Address, source trusted number and token ID. Message flows are described further below.","The GPRS interface allows the Comms Hub to identify the mobile operator networks that are available, to connect to the selected network, and to disconnect from the network. Connections are established either by scheduled or ad hoc activities in the Comms Hub or as a result of an SMS wakeup from the Head End System. GPRS connections are not kept open by the Comms Hub. Referring generally to , each time the Comms Hub has a group of messages to send to or receive from the Head End System; it establishes the GPRS attachment and activates the PDP (Packet Data Protocol) context. At the end of the message exchange, the Comms Hub deactivates the PDP context and detaches from GPRS. The mobile operator authenticates the Comms Hub with the IMSI (International Mobile Security Identity) information stored in the SIM (Subscriber Identity Module) and transmitted during PDP activation process.","The payload of the SMS Wakeup Message sent from the HES has the comma separated, text based, order sensitive payload fields: <control>, <TokenId>, <ip_address>, <domain_name>. Additional details are found in Table 0 below.",{"@attributes":{"id":"p-0103","num":"0102"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"4"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"126pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 0"},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}},{"entry":["Name","Type","Range","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["<Control>","Text hex string","two characters","Control flags for SMS fields"]},{"entry":["<TokenId>","Hex integer","00000000 to","SMS token ID assigned by the Head"]},{"entry":[{},"string","FFFFFFFF","End System. Present if selected by the"]},{"entry":[{},{},{},"control flag"]},{"entry":["<IpAddress>","IP address","000.000.000.000","IP address of the Head End System"]},{"entry":[{},"(format: four","to","processor requesting the response."]},{"entry":[{},"bytes, each","255.255.255.255","Present if selected by the control flag"]},{"entry":[{},"byte an IPV4",{},{}]},{"entry":[{},"subaddress =",{},{}]},{"entry":[{},"w.x.y.z)",{},{}]},{"entry":["<DomainName>","Character","Up to 139","Fully qualified domain name of the"]},{"entry":[{},"string","characters","Head End System processor requesting"]},{"entry":[{},{},{},"the response. Present if selected by the"]},{"entry":[{},{},{},"control flag"]},{"entry":["<PortNum>","16 bit integer","full","The destination port number to be used"]},{"entry":[{},{},{},"by the SMS Wakeup Response,"]},{"entry":[{},{},{},"(This port payload option is only used in"]},{"entry":[{},{},{},"the development phase and is not"]},{"entry":[{},{},{},"supported by customer firewalls)"]},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}}]}}}}},"Control is a Text hex byte that encodes the test control flag bits to be used after selecting the network as follows: bit  set to 1 if the token ID is present (This value will always be present if the test is requested); bit  set to 1 if the destination IP Address of a particular Head End System processor is present; bit  set to 1 if the fully qualified domain name of a particular HES process is present (Note that if both the IP address and the domain name are both present, then only the domain name is used. If neither is provided, the Comms Hub uses the configured domain name); bit  set to 1 if the port number of the Head End System process is included; bits - reserved and set to 0 (Example: \u201c05\u201d text string sets the flag bits for the token ID, and domain name).","TokenId is the Token ID of the command assigned by the Head End System for inclusion with the push SMS wakeup response message sent by the Comms Hub. ip_address is destination IP address of the target Head End System to be used by the Comms Hub for the SMS wakeup response message. DomainName is the destination fully qualified domain name of the target Head End System to be used by the Comms Hub for the SMS wakeup response message. The limit on the size of the domain name is based on the maximum SMS size of 160 characters and the characters needed to transmit the comma delimitated control, TokenId, and request_time fields. PortNum is the HES port number to be used as the destination port in the IP transport layer of the SMS Response message. Used during development only.","The message flow diagram for the SMS wakeup is shown in . The Head End system sends the SMS wakeup API call using the Comms Hub's IMSI. This message sent by the mobile operator uses a trusted number as the source. The Comms Hub is configured to accept SMS messages from only trusted numbers which are configured by the Head End System and stored in non-volatile memory. The Head End System's wakeup message uses the mobile operator's API call submitSMS(payload). The payload includes, a control field that indicates what fields are present, the Head End System's IP address field, the Head End System's fully qualified domain name field and Head End System IP transport port field, the token ID field and the response protocol field. If the IP address or the domain name and port are not present, the Comms Hub uses the configured Head End System IP address and port. In the cases where the fully qualified domain name is used, the Comms Hub does a DNS lookup to get the HES IP address. The Token ID in the Comms Hub response links it to the SMS to the wakeup message that generated it.","The Comms Hub may not be able to always connect to the preferred mobile operator. When this happens the mobile operator sends the SMS message to the alternate mobile system the Comms Hub is registered on.","In accordance with a preferred process, SMS messages are minimized by programming the Comms Hubs to wake up at random times within a predetermined window of time to initiate data pushes to the HES. The Comms Hub messages are secured in advance of wake up and are pushed in bulk. More specifically, the messages can be secured by the CommsHub using Digital Envelopes (DE) before sending (discussed further below). DE uses RSA PKCS7 and IETF number as is known in the art. The securing step need not be performed on the fly, i.e., in real time. Accordingly, securitization at the Comms Hub does not contribute to the latency budget of the push process and utilizes the Comms Hub's limited processing power during an off-peak use time. After random, autonomous wake up during the predetermined window, the Comms Hub pushes multiple previously DE secured messages in bulk to the HES using UDP (User Datagram Protocol). UDP does not use handshakes or other negotiations like those of TCP and other IP protocols. Accordingly, the number of messages required to communicate between the HES and the Comms Hub is reduced. Further, UDP is a stateless protocol, treating each request independently, and not as a string, thus reducing latency, etc. that necessarily comes with allocating processing and memory capacity to tracking and completing related requests.","Referring to , the initial message in the improved communication process is a UDP bulk message push from the Comms Hub to the HES UDP#1. Since we do want some acknowledgement of receipt of the push messages by the HES, the HES sends an acknowledgement message in the form of a UDP push UDP_ACK#2, wherein the HES's UDP push includes bulk acknowledgements corresponding to each of the individual messages in UDP#1. There are UDP#1 sequence numbers that are matched with UDP_ACK#2. Accordingly, comparing and , the present embodiment reduces the number of messages to complete the reporting of data from the Comms Hub to the HES from 6 to 2 and eliminates the need for SMS messaging. Additional description of the two-message push embodiment is found with reference to .","The UDP messages include header information that optimizes the HES processing. During the time in which the HES is receiving an acknowledging the Comms Hub UDP#1 push messages, the HES is dedicating all processing resources to receipt, ACK and storage of the UDP#1 push messages. The processing of the UDP#1 push messages by the HES occurs later in most cases. Accordingly, in order to determine at the time of receipt what is in the UDP#1 push messages for storage and acknowledgement purposes, the UDP#1 headers include a reason code. In operation, after stripping of IP headers, the HES comes to a header section that allows the HES to determine where to store for future processing, e.g., this is an electric meter push, store in bucket A; this is a gas meter push, store in bucket B, this is an alarm, store in bucket C and add to UDP_ACK#2 instructions for Comms Hub to call the HES during next off-peak processing window of time. The DE security offers threes types of security encryption\/privacy, authentication, is the sending device's identity confirmed, and integrity, has the message been changed. Accordingly using DE, different parts of the UDP can have various levels of security. For example, the reason code does not need (and likely would not want) privacy encryption, but integrity protection would likely be used. Whereas the primary message data would require privacy encryption and integrity protection.","Additionally, every UDP_ACK#2 sends current clock configuration of the HES which is synchronized with outside world. Accordingly, this facilitates Comms hub clock synchronization which in turn synchronizes Reporting Devices using other existing protocols.","The presently described embodiment still allows for the HES to use SMS wake up messages and TCP\/TLS sessions for longer conversation between the HES and the Comms Hub, which is reserved for non-standard\/single thread messages. This may be required when there is an issue and the HES needs to speak with Comms Hub. Additional description found herein with reference to . For all Comms Hub initiated pushes, the preferred embodiment described herein is utilized.","IPv4 is used as the network layer for the WAN. One skilled in the art recognizes that this does not preclude migrating to IPv6 or other related upgrades in the future. The Comms Hub receives a dynamic IPv4 address and DNS addresses when PDP context is activated. The Head End System uses TCP\/LS and UDP\/DE protocols to communicate with the Comms Hub.","Similarly, communications with HAN devices follow recognized standards such as IEEE802.15.4 for the radio and MAC interface and ZigBee specifications, e.g., ZigBee Network, ZigBee APS and ZigBee application clusters, the current specifications of which are known to those skilled in the art and incorporated herein by reference. By way of example, HAN devices may use the Direct Sequence Spread Spectrum (DSSS) radio operating in the 2.4 GHz band. Additionally, the Comms Hub and the Hand Held Terminal (HHT) may form a temporary point-to-point connection for commissioning and service activities. See further description herein and U.S. patent application Ser. No. 13\/296,552 filed on Nov. 15, 2011, entitled \u201cMETHOD FOR SECURELY COMMUNICATING ACROSS MULTIPLE NETWORKS USING A SINGLE RADIO,\u201d which is incorporated herein by reference in its entirety.","In a particular embodiment, in order to address individual devices on the HAN (including the Comms Hub), the devices must be identified. Accordingly, each HAN device has an identifier, e.g., EUI-64 identifier, assigned to it by the manufacturer. This identifier is used as the HAN long device address. ZigBee devices select a short, 16 bit HAN short device address.","The Comms Hub selects a random 16 bit PAN-ID. The PAN-ID differentiates one Comms Hub network from another Comms Hub network in the neighborhood. The PAN ID can be read by the HES.","Similarly, for WAN Addressing the Comms Hub has a 15 digit IMSI that contains the Mobile Country Code, the Mobile Network Code and the MSIN. The MSIN is the individual subscriber identifier of the Comms Hub. The IMSI is used to authenticate the Comms Hub to the mobile operator. The IMSI is used by the HES to address SMS messages to a Comms Hub. The Comms Hub has an IP address, e.g., IPv4 address, which is used by the IP Network layer of the WAN protocol stack to communicate with the HES. The HES has one or more IP addresses, e.g., IPv4 addresses, and one or more fully qualified domain names. The multiple addresses and the domain name are used to load balance the network traffic and to differentiate energy service providers. The Comms Hub can be configured with the fully qualified domain name. It uses the domain name to call the DNS to resolve it into an IP address. When the HES sends a SMS message to the mobile operator's API, the operator sends the message from a trusted number. The trusted number is used by the Comms Hub to identify that the SMS message is from a qualified source. The Comms Hub is configured with up to three trusted numbers.","Referring to  the HES may communicate with any Comms Hub DLMS objects through the COSEM IP port, 4059, or through ZigBee Gateway DLMS calls. The Comms Hub implements the gateway option. The HES uses a second port, the ZGD IP port 17756, to communicate with the Comms Hub ZigBee objects. The ZGD port is also used to communicate with the HAN devices. DLMS messages sent to the HAN devices use the ZigBee DLMS Tunnel cluster to transmit across the HAN. ZigBee ZCL devices used the native ZigBee protocol across the HAN.","The ZigBee Gateway specification used by the HES implements Gateway Remote Interface Protocol (GRIP) Remote Procedure Calls (RPC) and the ZCL function category. The ZigBee Gateway components implemented by the Comms Hub are the GRIP Remote Procedure Calls and the ZigBee Cluster Library (ZCL) functions. The ZCL interface of the ZigBee Gateway allows interaction with any: ZigBee device including the Comms Hub itself through the use of EUI-64; ZigBee End Point supported on each device through the use of the End Point ID; Clusters implemented on each End Point through the use of the Cluster ID. This includes the ZigBee DLMS tunneling cluster to access DLMS objects on a remote ZigBee device; Classes within these Clusters through the use of the Class ID; and Attributes or Methods within these Classes through the use of the Attribute or Method ID.","The Gateway Remote Interface Protocol (GRIP) is a lightweight Remote Procedure Call (RPC) protocol used for calling a remote function and retrieving the results between a Comms Hub and a Host Application. Each GRIP frame consists of the following components: a GRIP Header which comprises frame controls and RPC controls and a GRIP Payload which contains information specific to the frame type. The GRIP Frame Format is shown in Table 1.",{"@attributes":{"id":"p-0121","num":"0120"},"tables":{"@attributes":{"id":"TABLE-US-00004","num":"00004"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"9"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"4","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"5","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"6","colwidth":"49pt","align":"center"}},{"@attributes":{"colname":"7","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"8","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"9","colwidth":"42pt","align":"center"}}],"thead":{"row":[{"entry":"TABLE 1"},{"entry":{"@attributes":{"namest":"1","nameend":"9","align":"center","rowsep":"1"}}},{"entry":["Octet: 1","1","2","1","1","0\/2","2","0\/2","Variable"]},{"entry":{"@attributes":{"namest":"1","nameend":"9","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Version","Frame","Transaction","Function","Function","Manufacturer","Function","RPC","RCP"]},{"entry":[{},"control","identifier","domain","category","code","identifier","status","payload"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"98pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"154pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"70pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["General header","RPC function identification fields","RPC function payload"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"252pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["GRIP Header","GRIP Payload"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}}},"The GRIP Header is sub-divided into a general header and a RPC function identification fields. The fields of the GRIP header appear in a fixed order as listed below: the Version field is 8-bits in length and specifies the version of the GRIP used by the sender of the frame (value of the version shall be set to 0x00); the Frame control field is 8-bits in length, set to 0x01 if the frame is a request to a GRIP entity, set to 0x02 if the frame is a response to a prior request; the Transaction identifier which is used to match a frame of type response with a frame of type request on the same communication channel between the same entities and is selected by the originator of the request and shall be unique for this request until the response is received or the transaction failed; the Function domain which specifies the scope of the API used to identify the function (field shall be set to 0x01); the Function category field is 8-bits in length and specifies the category of an RPC function (this field may have the values shown in Table 2); the Manufacturer code field is 16-bits in length and specifies the assigned manufacturer code for proprietary extensions to GRIP (field shall only be included in the frame if the function category field of the frame is set to 0x00); the Function identifier field is 16-bits in length and specifies a unique identifier for a function; the RPC status field specifies the status of the function which has been called in a prior request (The success value is unique and indicates that the prior request associated with this response was successfully received and well formatted, that the function in this request has been successfully performed and that the payload of the response contains the result of the function. It does not have any relation with the content of the function itself. This field is present only in frames of type response. The RPC status field may have the values shown in Table 3); and the payload field is of a variable number of octets in length and contains information specific to individual frame types.",{"@attributes":{"id":"p-0123","num":"0122"},"tables":{"@attributes":{"id":"TABLE-US-00005","num":"00005"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"4"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"105pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 2"},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}},{"entry":[{},"Function category","Value","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Manufacturer","0x00","Manufacturer extensions"]},{"entry":[{},"ZCL","0x03","Zigbee ZCL application layer"]},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}}]}}}}},{"@attributes":{"id":"p-0124","num":"0123"},"tables":{"@attributes":{"id":"TABLE-US-00006","num":"00006"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"98pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"147pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 3"},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}},{"entry":["RPC status","Value","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["SUCCESS","0x0000","An RPC operation has been executed successfully"]},{"entry":["CONNECTION_CLOSED","0x0100","The connection with a remote entity has been"]},{"entry":[{},{},"closed during an RPC operation"]},{"entry":["RPC_TIMEOUT","0x0101","The maximum duration allowed for an RPC"]},{"entry":[{},{},"operation elapsed without returning the results of"]},{"entry":[{},{},"the function that was called"]},{"entry":["TRANSACTION_ERROR","0x0200","A GRIP request is received with a \u201cTransaction"]},{"entry":[{},{},"identifier\u201d which already matches a function"]},{"entry":[{},{},"being performed by the Next Higher Layer Entity"]},{"entry":[{},{},"on this entity"]},{"entry":["FUNCTION_TIMEOUT","0x0201","The maximum duration allowed to wait for the"]},{"entry":[{},{},"execution of a function on the local entity where"]},{"entry":[{},{},"the function is performed elapsed"]},{"entry":["UNSUPPORTED_FUNCTION","0x0300","The RPC header of a GRIP request which has"]},{"entry":[{},{},"been received refers to a function that is not"]},{"entry":[{},{},"supported by this entity"]},{"entry":["BAD_PARAM_FORMAT","0x0301","The parameters received to execute the function"]},{"entry":[{},{},"have a bad format"]},{"entry":["FUNCTION_ERROR","0x0302","Any error occurring in the Next Higher Layer"]},{"entry":[{},{},"Entity when attempting to perform the function"]},{"entry":[{},{},"and retrieve its results which differs from the"]},{"entry":[{},{},"UNSUPPORTED_FUNCTION and the"]},{"entry":[{},{},"BAD_PARAM_FORMAT error status."]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}}}},"The SendDLMSCommand procedure is used to send and receive DLMS APDU in a generic manner. Table 4 shows the value assigned to the different fields of the GRIP protocol for the SendDLMSCommand request and response.",{"@attributes":{"id":"p-0126","num":"0125"},"tables":{"@attributes":{"id":"TABLE-US-00007","num":"00007"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"77pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 4"},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}},{"entry":["GRIP frame field","Request","Response"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Version","0x00","0x00"]},{"entry":["Transaction identifier","Present","Present"]},{"entry":["Frame control","0x01","0x02"]},{"entry":["Function domain","0x01","0x01"]},{"entry":["Function category","0x00","0x00"]},{"entry":["Manufacturer code","0x10C7","0x10C7"]},{"entry":["Function identifier","0x0000","0x0000"]},{"entry":["RPC status","Not present","Present"]},{"entry":["RCP payload","DlmsCommandParams","DlmsCommandResults"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}}}},"The SendDLMSCommand request and response is defined by the ASN.1 definitions as shown in . These structures are encoded using the Distinguished Encoding Rules (DER) as defined by the X.690 standard which is known to those skilled in the art.","The DlmsCommandParams ASN.1 definition describes the structure of the RCP payload of a SendDLMSCommand request. The different fields supported by this structure are listed in Table 5.",{"@attributes":{"id":"p-0129","num":"0128"},"tables":{"@attributes":{"id":"TABLE-US-00008","num":"00008"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"112pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 5"},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}},{"entry":["Name","Status","Type","Valid Range","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["timeout","M","32-bit","0x00000000-0xffffffff","Maximum period, in milliseconds,"]},{"entry":[{},{},"unsigned",{},"this procedure will block before"]},{"entry":[{},{},"integer",{},"returning a response. Set to 0xffffffff"]},{"entry":[{},{},{},{},"to disable this timeout, to wait for an"]},{"entry":[{},{},{},{},"infinite amount of time."]},{"entry":["address","M","64-bit","Any 64-bit, IEEE","The extended address of the target"]},{"entry":[{},{},"IEEE","address","device."]},{"entry":[{},{},"address",{},{}]},{"entry":["data","M","Octet String","DLMS APDU","This field contains the DLMS"]},{"entry":[{},{},{},{},"wrapper follow by the DLMS"]},{"entry":[{},{},{},{},"payload."]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]}}}}},"The DlmsCommandResults ASN.1 definition describes the structure of the RCP payload of a SendDLMSCommand response. The different fields supported by this structure are in Table 6.",{"@attributes":{"id":"p-0131","num":"0130"},"tables":{"@attributes":{"id":"TABLE-US-00009","num":"00009"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"140pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 6"},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}},{"entry":["Name","Status","Type","Valid Range","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":{}}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"6"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"6","colwidth":"119pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["status","M","8-bit unsigned","0 to 255","0x00","SUCCESS, Indicates that a"]},{"entry":[{},{},"Integer",{},{},"function successfully completed."]},{"entry":[{},{},{},{},"0x01","TIMEOUT, Indicates that the"]},{"entry":[{},{},{},{},{},"amount of time to complete the"]},{"entry":[{},{},{},{},{},"processing task was longer than"]},{"entry":[{},{},{},{},{},"the amount of time limited by the"]},{"entry":[{},{},{},{},{},"timeout parameter"]},{"entry":[{},{},{},{},"0x02","GENERAL ERROR, Indicates"]},{"entry":[{},{},{},{},{},"that a general error occurred and"]},{"entry":[{},{},{},{},{},"the function did not complete"]},{"entry":[{},{},{},{},{},"successfully."]},{"entry":[{},{},{},{},"0x03","PARAMETER_MISSING,"]},{"entry":[{},{},{},{},{},"Indicates that one or more"]},{"entry":[{},{},{},{},{},"required parameters were"]},{"entry":[{},{},{},{},{},"missing from the request."]},{"entry":[{},{},{},{},"0x04","PARAMETER_INVALID_VALUE,"]},{"entry":[{},{},{},{},{},"Indicates that one or more"]},{"entry":[{},{},{},{},{},"supplied parameters had an"]},{"entry":[{},{},{},{},{},"invalid value."]},{"entry":[{},{},{},{},"0x05","NETWORK_NOT_READY,"]},{"entry":[{},{},{},{},{},"Indicates that the ZigBee"]},{"entry":[{},{},{},{},{},"interface is not in a state to"]},{"entry":[{},{},{},{},{},"process the request."]},{"entry":[{},{},{},{},"0x06","EMPTY, Indicates that there are"]},{"entry":[{},{},{},{},{},"no results to be retrieved."]},{"entry":[{},{},{},{},"0x07","NOT_ALLOWED, Indicates that"]},{"entry":[{},{},{},{},{},"the action requested by the"]},{"entry":[{},{},{},{},{},"function is not allowed"]},{"entry":[{},{},{},{},"0x08","MEMORY_ERROR, Indicates"]},{"entry":[{},{},{},{},{},"that the function has not been"]},{"entry":[{},{},{},{},{},"successfully completed due to a"]},{"entry":[{},{},{},{},{},"memory error"]},{"entry":[{},{},{},{},"0x09","APS_FAILURE, Indicates a"]},{"entry":[{},{},{},{},{},"specific APS error"]},{"entry":[{},{},{},{},"0x0A","NETWORK_FAILURE,"]},{"entry":[{},{},{},{},{},"Indicates a network error."]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"140pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["data","M","Octet String","DLMS APDU","This field contains the DLMS wrapper"]},{"entry":[{},{},{},{},"follow by the DLMS payload."]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]}}]}}},"The SendZCLCommand procedure is invoked by a Host Application to send an arbitrary DLMS APDU to or through the Comms Hub. Upon invocation of the SendZCLCommand procedure, the Comms Hub shall ignore supplied parameters that are neither mandatory nor optional. Next the Comms Hub shall validate that all mandatory parameters are supplied. If one or more mandatory parameters are not supplied then it shall return a Status result of PARAMETER_MISSING. Next the Comms Hub shall validate that all supplied parameters have a valid value. If one or more parameters have an invalid value then it shall return a Status result of PARAMETER_INVALID_VALUE. The Comms Hub shall then assemble the DLMS request and forward it to the specified destination. On reception of the corresponding DLMS response, the Comms Hub assembles the SendZCLCommand response and forwards it to the Host Application. The Host Application operates in a synchronized mode. This means that the Host Application, after the transmission of it request, block until the reception of a response. A TIMEOUT status shall be returned by the Comms Hub if the total time of the processing task exceeds the timeout value specified in the SendZCLCommand request.","The byte streams set forth in (request) and (response) show typical, but exemplary SendDLMSCommand requests\/responses. Not all possible fields are shown and some optional fields might be removed. The byte stream is represented in the left column and the right column contains a short description. Value \u201cxx\u201d represents an octet and the value \u201cxx . . . \u201d represents an octet string. Fields defined in are encoded in DER as tag, length and value as defined by the X.690 standard.","The SendZCLCommand procedure is used to send and receive ZCL commands in a generic manner. Table 7 shows the value assigned to the different fields of the GRIP protocol for the SendZCLCommand request and response.",{"@attributes":{"id":"p-0135","num":"0134"},"tables":{"@attributes":{"id":"TABLE-US-00010","num":"00010"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"77pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 7"},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}},{"entry":["GRIP frame field","Request","Response"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Version","0x00","0x00"]},{"entry":["Transaction identifier","Present","Present"]},{"entry":["Frame control","0x01","0x02"]},{"entry":["Function domain","0x01","0x01"]},{"entry":["Function category","0x03","0x03"]},{"entry":["Manufacturer code","Not present","Not present"]},{"entry":["Function identifier","0x0300","0x0300"]},{"entry":["RPC status","Not present","Present"]},{"entry":["RCP payload","ZCLCommandParams","ZCLCommandResults"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}}}},"The SendZCLCommand procedure request and response is defined by the ASN.1 definitions shown in . These structures are encoded using the Distinguished Encoding Rules (DER) as defined by the X.690 standard ZCLCommandParams.","The ZCLCommandParams ASN.1 definition describes the structure of the RCP payload of a SendZCLCommand request. The different fields supported by this structure are in Table 8.",{"@attributes":{"id":"p-0138","num":"0137"},"tables":{"@attributes":{"id":"TABLE-US-00011","num":"00011"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"112pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 8"},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}},{"entry":["Name","Status","Type","Valid Range","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["timeout","M","32-bit","0x00000000-0xffffffff","Maximum period, in milliseconds,"]},{"entry":[{},{},"unsigned",{},"this procedure will block before"]},{"entry":[{},{},"integer",{},"returning a response. Set to 0xffffffff"]},{"entry":[{},{},{},{},"to disable this timeout, to wait for an"]},{"entry":[{},{},{},{},"infinite amount of time."]},{"entry":["dstAddress-mode","O","Integer","0x00-0xff","The addressing mode used for the"]},{"entry":[{},{},{},{},"DestinationAddress parameter."]},{"entry":[{},{},{},{},"0x02 = 16-bit address"]},{"entry":[{},{},{},{},"0x03 = 64-bit extended address"]},{"entry":[{},{},{},{},"If this parameter is omitted then it is"]},{"entry":[{},{},{},{},"assumed that a binding table entry"]},{"entry":[{},{},{},{},"exists in the Comms Hub that"]},{"entry":[{},{},{},{},"determines the destination."]},{"entry":["dst-address","O","Address","As specified by","If this parameter is omitted then it is"]},{"entry":[{},{},{},"the","assumed that a binding table entry"]},{"entry":[{},{},{},"DstAddrMode","exists in the Comms Hub that"]},{"entry":[{},{},{},"parameter","determines the destination."]},{"entry":["dst-endpoint","O","Endpoint ID","Any valid","The identifier for the endpoint on the"]},{"entry":[{},{},{},"endpoint ID","destination device to which the ZCL"]},{"entry":[{},{},{},{},"command is directed."]},{"entry":[{},{},{},{},"If this parameter is omitted then it is"]},{"entry":[{},{},{},{},"assumed that a binding table entry"]},{"entry":[{},{},{},{},"exists in the Comms Hub that"]},{"entry":[{},{},{},{},"determines the destination endpoint."]},{"entry":["profileID","O","16-bit","Any valid profile","The ZigBee application profile under"]},{"entry":[{},{},"Integer","ID","which the contents of this ZCL"]},{"entry":[{},{},{},{},"command are to be interpreted."]},{"entry":["clusterID","M","16-bit","Any cluster ID","The cluster identifier associated to the"]},{"entry":[{},{},"Integer",{},"ZCL command to send."]},{"entry":["src-endpoint","O","Endpoint ID","Any valid","The source endpoint on the ZigBee"]},{"entry":[{},{},{},"endpoint ID","Gateway for ZCL command."]},{"entry":["txoption","M","Bitmap","0000 xxxx","The transmission options for the"]},{"entry":[{},{},{},"(Where x can be","ASDU to be transferred. These are a"]},{"entry":[{},{},{},"0 or 1)","bitwise OR of one or"]},{"entry":[{},{},{},{},"more of the following:"]},{"entry":[{},{},{},{},"0x01 = Security enabled transmission"]},{"entry":[{},{},{},{},"0x02 = Use NWK key"]},{"entry":[{},{},{},{},"0x04 = Acknowledged transmission"]},{"entry":[{},{},{},{},"0x08 = Fragmentation permitted"]},{"entry":["radius","O","Integer","Any number up","The distance, in hops, that a"]},{"entry":[{},{},{},"to the maximum","transmitted frame will be allowed to"]},{"entry":[{},{},{},"radius of the","travel through the network."]},{"entry":[{},{},{},"network.",{}]},{"entry":["zcl-header","M","Octet String","ZCLHeader","General ZCL Frame Format as"]},{"entry":[{},{},{},{},"defined in Zigbee Cluster Library"]},{"entry":[{},{},{},{},"Specification incorporated herein by"]},{"entry":[{},{},{},{},"reference"]},{"entry":["zcl-payload","M","Octet string","Any valid ZCL","Frame payload as defined in Zigbee"]},{"entry":[{},{},{},"command","Cluster Library Specification"]},{"entry":[{},{},{},{},"incorporated herein by reference"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]}}}}},"The ZCLCommandResults ASN.1 definition describes the structure of the RCP payload of a SendZCLCommand response. The different fields supported are in Table 9.",{"@attributes":{"id":"p-0140","num":"0139"},"tables":{"@attributes":{"id":"TABLE-US-00012","num":"00012"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"140pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 9"},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}},{"entry":["Name","Status","Type","Valid Range","Description"]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":{}}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"6"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"6","colwidth":"119pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["status","M","8-bit",{},"0x00","SUCCESS, Indicates that a"]},{"entry":[{},{},"unsigned",{},{},"function successfully"]},{"entry":[{},{},"Integer",{},{},"completed."]},{"entry":[{},{},{},{},"0x01","TIMEOUT, Indicates that the"]},{"entry":[{},{},{},{},{},"amount of time to complete"]},{"entry":[{},{},{},{},{},"the processing task was longer"]},{"entry":[{},{},{},{},{},"than the amount of time"]},{"entry":[{},{},{},{},{},"limited by the Timeout"]},{"entry":[{},{},{},{},{},"parameter"]},{"entry":[{},{},{},{},"0x02","GENERAL ERROR,"]},{"entry":[{},{},{},{},{},"Indicates that a general error"]},{"entry":[{},{},{},{},{},"occurred and the function did"]},{"entry":[{},{},{},{},{},"not complete successfully."]},{"entry":[{},{},{},{},"0x03","PARAMETER_MISSING,"]},{"entry":[{},{},{},{},{},"Indicates that one or more"]},{"entry":[{},{},{},{},{},"required parameters were"]},{"entry":[{},{},{},{},{},"missing from the request."]},{"entry":[{},{},{},{},"0x04","PARAMETER_INVALID_VALUE,"]},{"entry":[{},{},{},{},{},"Indicates that one or"]},{"entry":[{},{},{},{},{},"more supplied parameters had"]},{"entry":[{},{},{},{},{},"an invalid value."]},{"entry":[{},{},{},{},"0x05","NETWORK_NOT_READY,"]},{"entry":[{},{},{},{},{},"Indicates that the ZigBee"]},{"entry":[{},{},{},{},{},"interface is not in a state to"]},{"entry":[{},{},{},{},{},"process the request."]},{"entry":[{},{},{},{},"0x06","EMPTY, Indicates that there"]},{"entry":[{},{},{},{},{},"are no results to be retrieved."]},{"entry":[{},{},{},{},"0x07","NOT_ALLOWED, Indicates"]},{"entry":[{},{},{},{},{},"that the action requested by"]},{"entry":[{},{},{},{},{},"the function is not allowed"]},{"entry":[{},{},{},{},"0x08","MEMORY_ERROR,"]},{"entry":[{},{},{},{},{},"Indicates that the function has"]},{"entry":[{},{},{},{},{},"not been successfully"]},{"entry":[{},{},{},{},{},"completed due to a memory"]},{"entry":[{},{},{},{},{},"error"]},{"entry":[{},{},{},{},"0x09","APS_FAILURE, Indicates a"]},{"entry":[{},{},{},{},{},"specific APS error"]},{"entry":[{},{},{},{},"0x0A","NETWORK_FAILURE,"]},{"entry":[{},{},{},{},{},"Indicates a network error"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"140pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["aps-status","M","Status","Any valid status","The Status reported by APSDE-"]},{"entry":[{},{},"Enumeration",{},"DATA.indication that delivered the"]},{"entry":[{},{},{},{},"ZCL command."]},{"entry":[{},{},{},{},"Note that if this parameter has any"]},{"entry":[{},{},{},{},"other value than SUCCESS then"]},{"entry":[{},{},{},{},"none of the optional parameters"]},{"entry":[{},{},{},{},"below are delivered."]},{"entry":["rxtime","O","Integer","Implementation","A time indication for the received"]},{"entry":[{},{},{},"specific","packet based on the local clock."]},{"entry":["dst-endpoint","O","Endpoint ID","Any valid","The endpoint on the Comms Hub to"]},{"entry":[{},{},{},"endpoint","which the ZCL command was"]},{"entry":[{},{},{},{},"directed."]},{"entry":["srcAddress-","O","Integer","0x00-0xff","The addressing mode for the source"]},{"entry":["mode",{},{},{},"address used."]},{"entry":[{},{},{},{},"0x02 = 16-bit short address"]},{"entry":[{},{},{},{},"0x03 = 64-bit extended address"]},{"entry":["src-address","O","Address","As specified by","The ZCL response command frame"]},{"entry":[{},{},{},"the Source-","was sent from this address."]},{"entry":[{},{},{},"AddressMode",{}]},{"entry":["src-","O","64-bit","Any 64-bit,","The extended address of the source"]},{"entry":["ieeeAddress",{},"IEEE","IEEE","device if it is known in the Comms"]},{"entry":[{},{},"address","address","Hub address manager tables."]},{"entry":["src-","O","Octet String",{},"This field is not supported."]},{"entry":["aliasAddress",{},{},{},{}]},{"entry":["src-endpoint","O","Endpoint ID","Any valid","An identifier for the endpoint on the"]},{"entry":[{},{},{},"endpoint ID","sending device that issued the"]},{"entry":[{},{},{},{},"command."]},{"entry":["profileID","O","16-bit Integer","Any valid","An identifier for the profile under"]},{"entry":[{},{},{},"ZigBee profile","which this command is to be"]},{"entry":[{},{},{},"ID","interpreted."]},{"entry":["clusterID","O","16-bit Integer","Any valid","An identifier for the cluster under"]},{"entry":[{},{},{},"cluster ID.","which this command is to be"]},{"entry":[{},{},{},{},"interpreted."]},{"entry":["zcl-header","O","Octet String",{},"General ZCL Frame Format as"]},{"entry":[{},{},{},{},"defined in Zigbee Cluster Library"]},{"entry":[{},{},{},{},"Specification, ZigBee Document"]},{"entry":[{},{},{},{},"075123r03ZB section 2.3.1."]},{"entry":["zcl-payload","O","Octet string","Any valid ZCL","Frame payload as defined in Zigbee"]},{"entry":[{},{},{},"command","Cluster Library Specification,"]},{"entry":[{},{},{},{},"ZigBee Document 075123r03ZB"]},{"entry":[{},{},{},{},"section 2.3.1."]},{"entry":{"@attributes":{"namest":"1","nameend":"5","align":"center","rowsep":"1"}}}]}}]}}},"The SendZCLCommand procedure is invoked by a host application to send an arbitrary ZCL frame to or through the Comms Hub. Upon invocation of the SendZCLCommand procedure, the Comms Hub shall ignore supplied parameters that are neither mandatory nor optional. Next the Comms Hub shall validate that all mandatory parameters are supplied. If one or more mandatory parameters are not supplied then it shall return a Status result of PARAMETER_MISSING. Next the Comms Hub shall validate that all supplied parameters have a valid value. If one or more parameters have an invalid value then it shall return a Status result of PARAMETER_INVALID_VALUE. The Comms Hub shall then assemble the ZCL request and forward it to the specified destination. On reception of the corresponding ZCL response, the Comms Hub assembles the ZCLCommandResults and forwards it to the Host Application. The Host Application operates in a synchronized mode. This means that the Host Application, after the transmission of it request block until the reception of a response. A TIMEOUT status shall be returned by the Comms Hub if the total time of the processing task exceeds the timeout value specified in the SendZCLCommand request.","The byte streams set forth in (request) and (response) show typical, but exemplary SendZCLCommand requests\/responses. The byte streams shows in this section are just examples, not all possible fields are shown and some optional fields might be removed. The byte stream is represented in the left column and the right column contains a short description. Value \u201cxx\u201d represents an octet and the value \u201cxx . . . \u201d represents an octet string. Fields defined in ASN.1 are encoded in DER as tag, length and value as defined by the X.690 standard.","Digital Envelopes are used to transfer information between the HES and the Comms Hub without establishing a TLS session. Digital Envelopes are transferred using UDP datagram. Each Digital Envelope consists of: A mandatory header as defined by the DigitalEnvelopHeader ASN.1 definition; An optional DigitalEnvelopPayload encoded as a CMS Data content type if not encrypted or as a CMS EnvelopedData content type if encrypted; and A mandatory signature encoded as a CMS SignedData.  is illustrative of these combinations.","The Digital Envelope Header is defined by this ASN.1 syntax shown in .","The Digital Envelop Header supports the following fields: Digital Envelope version number (0x01: Current version as defined in this section); reasonCode which identifies the purpose and type of message sent (see Table 10 below); commsHubMacAddress including MAC address of the sending Comms Hub; sequenceNumber including Unique number assigned to each Digital Envelope sent by the Comms Hub (For Acknowledgements Digital envelope sends by the Head End System, this field is set to the sequence number of the Digital Envelope acknowledged); deviceMacAddress including MAC address of the device that supplied the data included in the Digital Envelope (For example, a daily meter report by the Comms Hub uses the meter's MAC address in the deviceMacAddress field as does an alarm report associated with this meter. This field is not present for information directly reported by the Comms Hub); tokenId present in a \u201cSMS wakeup response\u201d or a \u201cCallback response\u201d Digital Envelope if a taken ID has been provided in the corresponding SMS wakeup or with a callback previously setup in an \u201cAcknowledgment\u201d Digital Envelope; pushCertificateSN including Serial number of the Push certificate currently available in the Comms Hub (This information is required by the HES to sign the acknowledgment with the appropriate key); currentTime including Current UTC time of the HES; timezoneID including Identifier of the timezone where this Comms Hub is installed (This information is required by the HES to return the appropriate DST information; field is available in the Digital Envelop only if previously configured); callbackTime which is an Optional field set if a callback to a service is required (This option is used by the Head End system to postpone the processing of a transaction with the Comms Hub outside to data acquisition period); callbackTokenId which is an Optional field used in conjunction with the callbackTime (When set, this identifier is included in the \u201cCallback Response\u201d Digital Envelop; field can be used by the service processing a callback to retrieve the initial reason of this scheduled call; callbackIpAddress which is an Optional field used in conjunction with the callbackTime (The requestor of a callback may use this field to specify the IP address of the service waiting for the callback or the requestor may set the domainName field or rely on the default address setting of the Comms Hub); callbackDomainName which is an Optional field used in conjunction with the callbackTime (The requestor of a callback may use this field to specify the fully qualified domain name of the service waiting for the callback or the requestor may set the IPAddress field or rely on the default address setting of the Comms Hub); callbackPortNum which is an Optional field used in conjunction with the callbackTime (The requestor of a callback may use this field to specify the IP port of the service waiting for the callback); dstStart including Start date and time of the current or next Daylight Saving Time period; and dstEnd including End date and time of the current or next Daylight Saving Time period (The dstStart and dstEnd are updated once a year prior to the Daylight Saving Time period).",{"@attributes":{"id":"p-0146","num":"0145"},"tables":{"@attributes":{"id":"TABLE-US-00013","num":"00013"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"168pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 10"},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"0x06: SMS Wakeup Response"]},{"entry":[{},"0x07: Switch GSM Network Test"]},{"entry":[{},"0x08: Callback Response"]},{"entry":[{},"0x09: Commission Request"]},{"entry":[{},"0x0A: OTA Status Report"]},{"entry":[{},"0x0B: OTA Image Request Alert"]},{"entry":[{},"0x0C: Decommission Request"]},{"entry":[{},"0x11: E-Meter Report"]},{"entry":[{},"0x12: G-Meter Report"]},{"entry":[{},"0x13: IHU Report"]},{"entry":[{},"0x14: Comms Hub Report"]},{"entry":[{},"0x21: E-Meter High Priority Report"]},{"entry":[{},"0x22: G-Meter High Priority Report"]},{"entry":[{},"0x23: IHU High Priority Report"]},{"entry":[{},"0x24: Comms Hub High Priority Report"]},{"entry":[{},"0x31: E-Meter Alarm"]},{"entry":[{},"0x32: G-Meter Alarm"]},{"entry":[{},"0x33: IHU Alarm"]},{"entry":[{},"0x34: Comms Hub Alarm"]},{"entry":[{},"0xFF: Acknowledgement"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}}}},"The Digital Envelop Header is encoded using the Distinguished Encoding Rules (DER). An exemplary byte stream is shown in .","Digital Envelop Payload is defined by the ASN.1 syntax shown in . Each DigitalEnvelopePayload is composed of zero, one or more PayloadContent. Each PayloadContent transport has either DLMS or ZCL content.","The dlmsContent data structure is used to include in a Digital Envelop a list of DLMS attributes. Each dlmsContent contains: sourceAP which is Application Process at the origin of this information; destinationAP which is Application Process within the Head End System responsible of processing this information (This field is optional, when not included this information is processed by the default Head End System Application Process); dlmsAttributes which is Sequence of one or more DLMS attributes, each one encoded as shown in Table 11 below.",{"@attributes":{"id":"p-0150","num":"0149"},"tables":{"@attributes":{"id":"TABLE-US-00014","num":"00014"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"182pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 11"},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"class-id: DLMS Interface Class identifier"]},{"entry":[{},"instance-id: DLMS OBIS code"]},{"entry":[{},"attribute-id: DLMS attribute identifier"]},{"entry":[{},"value: DLMS attribute value encoded in A-XER"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}}}},"The dlmsContent is encoded using the Distinguished Encoding Rules (DER) as shown in .","The zclContent data structure is used to send ZCL commands or ZCL attributes in a Digital Envelope. ZCL attributes are encoded using the standard ZCL \u201cReport attributes\u201d command, carrying one or multiple attributes. Attributes reported by the \u201cReport attributes\u201d command shall all originate from the same End Point, Cluster and all been either standard or manufacturer. When attributes from different End Points and\/or Clusters need to be transferred, multiple ZclContent are included in the same Digital Envelope. Each zclContent contains: clusterIdentifier which is ZigBee Cluster ID at the origin of this information; sourceEndpoint which is Endpoint at the origin of this information; destinationEndpoint which is Endpoint within the Head End System responsible of processing this information (This field is optional, when not included this information is processed by the default process); zclCommands including one or more ZCL commands as defined in the ZigBee Cluster Library each ZCL command has the format as shown in Table 12.",{"@attributes":{"id":"p-0153","num":"0152"},"tables":{"@attributes":{"id":"TABLE-US-00015","num":"00015"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"thead":{"row":[{"entry":"TABLE 12"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"frameControl: ZigBee ZCL \u201cFrame Control\u201d field."},{"entry":"manufactureCode: ZigBee \u201cManufacture Code\u201d field, present only"},{"entry":"if the \u201cManufacturer Specific\u201d flag within the \u201cFrame Control\u201d field is set."},{"entry":"transactionSeqNum: ZigBee ZCL \u201cTransaction Sequence Number\u201d field."},{"entry":"This field is not processed and can be set to any value."},{"entry":"commandId: ZigBee ZCL Command ID."},{"entry":"commandContent: ZCL command payload."},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]}}}}},"Each zclContent is encoded using the Distinguished Encoding Rules (DER) as shown in .","The CMS Data content type is used to carry a DigitalEnvelopePayload when not encrypted. The structure of the CMS Data is defined in RFC 5652 using the ASN.1 syntax as shown in . The CMS Data content type is encoded using the Distinguished Encoding Rules (DER) as shown in .","The CMS EncryptedData content type is used to carry an encrypted DigitalEnvelopePayload. The structure of the CMS EncryptedData is defined in RFC 5652 and relies on data types and Object Identifiers (OID) defined in a variety of other standards. The equivalent ANS.1 definition describes EncryptedData content type options used and is shown in . The CMS EncryptedData content type is encoded using the DER encoding rules. The CMS EncryptedData content type produces the byte stream as shown in . This process uses the AES-128 CBC mode as described in RFC 3565.","The EnvelopeData encryption structure is shown in . The steps of the encryption process include\n\n","The DigitalEnvelopePayload included in an EncryptedData content type is decrypted as shown in . The steps of the decryption process include:\n\n","The CMS SignedData content type is used to sign Digital Envelopes. This digital signature is used to verify the integrity of a Digital Envelope and authenticate the source of this information. The structure of the CMS SignedData is defined in RFC 5652 and relies on data types and Object Identifiers (OID) defined in a variety of other standards. The ASN.1 definition shown in  describes the SignedData content type used. CMS SignedData content type is encoded using the Distinguished Encoding Rule (DER). When used with the ECDSA signing algorithm, the Prime256v1 elliptic curve and the SHA256 message digest, the CMS SignedData content type produce the byte stream shown in .","The SignedData structure is constructed as follows and shown in :\n\n","The signature of each Digital Envelope received is verified in accordance with the following process and shown in :\n\n","Digital Envelopes are used to implement different interactions between the Comms Hub and the HES. The reasonCode field included in the header identifies both the purpose of the envelope and the type of information carried. The different reason codes supported are summarized in Table 13 below which identifies digital envelope types and contents (y=mandatory and o=conditional). For each type there is information for: The optional header fields included; The presence of a payload and its format (DLMS or ZCL); The presence of certificates and\/or certificate revocation list (CRL) in the signedData element of the digital envelops; The public key used in conjunction with the Comms Hub private key to derive a share secret used for encrypting the payload. On reception, the HES use its corresponding private key and the Comms Hub public key to obtain the same share secret; and The Comms Hub private key used for key derivation and signing.",{"@attributes":{"id":"p-0163","num":"0183"},"tables":{"@attributes":{"id":"TABLE-US-00016","num":"00016"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"9"},"colspec":[{"@attributes":{"colname":"1","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"6","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"7","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"8","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"9","colwidth":"42pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 13"},{"entry":{"@attributes":{"namest":"1","nameend":"9","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"DigitalEn-","DigitalEn-","DigitalEn-",{},"DigitalEn-","DigitalEn-","DigitalEn-","DigitalEn-"]},{"entry":[{},"velopHead-","velopHead-","velopHead-","DigitalEn-","velopHead-","velopHead-","velopHead-","velopHead-"]},{"entry":[{},"er.rea-","er.se-","er.de-","velopHead-","er.pushCer-","er.time-","er.cur-","er.call-"]},{"entry":["Description","sonCode","quenceNum","viceMacAd","er.tokenId","tificat","zoneID","rentTime","back . . ."]},{"entry":{"@attributes":{"namest":"1","nameend":"9","align":"center","rowsep":"1"}}},{"entry":["SMS Wakeup","0x06","y",{},{},"y","y"]},{"entry":"Response"},{"entry":["Switch GSM","0x07","y",{},{},"y","y"]},{"entry":"Network Test"},{"entry":["Call-back Response","0x08","y",{},{},"y","y"]},{"entry":["Commission Request","0x09","y","o"]},{"entry":["OTA Status Report","0x0A","y",{},{},"y","y"]},{"entry":["OTA Image Request","0x0B","y",{},{},"y","y"]},{"entry":"Alert"},{"entry":["Decommission","0x0C","y",{},{},"y","y"]},{"entry":"Request"},{"entry":["E-Meter Report","0x11","y","y",{},"y","y"]},{"entry":["G-Meter Report","0x12","y","y",{},"y","y"]},{"entry":["IHU Report","0x13","y","y",{},"y","y"]},{"entry":["Comms Hub Report","0x14","y",{},{},"y","y"]},{"entry":["E-Meter High","0x21","y","y",{},"y","y"]},{"entry":"Priority Report"},{"entry":["G-Meter High","0x22","y","y",{},"y","y"]},{"entry":"Priority Report"},{"entry":["IHU High Priority","0x23","y","y",{},"y","y"]},{"entry":"Report"},{"entry":["Comms Hub High","0x24","y",{},{},"y","y"]},{"entry":"Priority Report"},{"entry":["E-Meter Alarm","0x31","y","y",{},"y","y"]},{"entry":["G-Meter Alarm","0x32","y","y",{},"y","y"]},{"entry":["IHU Alarm","0x33","y","y",{},"y","y"]},{"entry":["Comms Hub Alarm","0x34","y",{},{},"y","y"]},{"entry":["Acknowledgement","0xFF","y",{},{},{},{},"y"]},{"entry":"(Commission request)"},{"entry":["Acknowledgement","0xFF","y",{},{},{},{},"y","o"]},{"entry":{"@attributes":{"namest":"1","nameend":"9","align":"center","rowsep":"1"}}}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"10"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"6","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"7","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"8","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"9","colwidth":"49pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},{},"DigitalEn-","DigitalEn-",{},{},{},{},"Public","Private key"]},{"entry":[{},{},"velopPay-","velopPay-","SignedDa-",{},{},{},"key use","use for key"]},{"entry":[{},{},"load.dlmsCon-","load.zclCon-","ta.cer-","SignedDa-","EncryptedData",{},"for key","derivation"]},{"entry":[{},"Description","tent(","tent (s)","tificates","ta.crls","content type","Payload","derivation","and signing"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"9","align":"center","rowsep":"1"}}]},{"entry":[{},"SMS Wakeup",{},{},{},{},{},{},{},"Operator"]},{"entry":[{},"Response",{},{},{},{},{},{},{},"Device"]},{"entry":[{},"Switch GSM",{},"y",{},{},"y","y","Push","Operator"]},{"entry":[{},"Network Test",{},{},{},{},{},{},{},"Device"]},{"entry":[{},"Call-back Response",{},{},{},{},{},{},{},"Operator"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"Commission Request","o","o","y",{},{},{},{},"Manufacturer"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"OTA Status Report",{},"y",{},{},{},{},{},"Operator"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"OTA Image Request",{},"y",{},{},{},{},{},"Operator"]},{"entry":[{},"Alert",{},{},{},{},{},{},{},"Device"]},{"entry":[{},"Decommission",{},{},"y",{},{},{},{},"Operator"]},{"entry":[{},"Request",{},{},{},{},{},{},{},"Device"]},{"entry":[{},"E-Meter Report","y","o",{},{},"y","y","Push","Operator"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"G-Meter Report",{},"y",{},{},"y","y","Push","Operator"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"IHU Report",{},"y",{},{},"y","y","Push","Operator"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"Comms Hub Report",{},"y",{},{},"y","y","Push","Operator"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"E-Meter High","y","o",{},{},"Y","y","Push","Operator"]},{"entry":[{},"Priority Report",{},{},{},{},{},{},{},"Device"]},{"entry":[{},"G-Meter High",{},"y",{},{},"Y","y","Push","Operator"]},{"entry":[{},"Priority Report",{},{},{},{},{},{},{},"Device"]},{"entry":[{},"IHU High Priority",{},"y",{},{},"Y","y","Push","Operator"]},{"entry":[{},"Report",{},{},{},{},{},{},{},"Device"]},{"entry":[{},"Comms Hub High",{},"y",{},{},"y","y","Push","Operator"]},{"entry":[{},"Priority Report",{},{},{},{},{},{},{},"Device"]},{"entry":[{},"E-Meter Alarm","y","o",{},{},"y","y","Push","Operator"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"G-Meter Alarm",{},"y",{},{},"y","y","Push","Operator"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"IHU Alarm",{},"y",{},{},"y","y","Push","Operator"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"Comms Hub Alarm",{},"y",{},{},"y","y","Push","Operator"]},{"entry":[{},{},{},{},{},{},{},{},{},"Device"]},{"entry":[{},"Acknowledgement",{},{},"y","o",{},{},{},"Commis-"]},{"entry":[{},"(Commission request)",{},{},{},{},{},{},{},"sioning"]},{"entry":[{},"Acknowledgement",{},{},{},"o",{},{},{},"Push"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"9","align":"center","rowsep":"1"}}]}]}}]}}},"The \u201cSMS Wakeup Response\u201d Digital Envelope is sent by the Comms Hub each time a SMS Wakeup Message is received. This envelope is sent just after the successful establishment of a GPRS connection to advertise the availability of the Comms Hub on the IP network to the HES. The byte stream of the \u201cSMS Wakeup Response\u201d Digital Envelope is represented in .","The \u201cSwitch GSM Network Test\u201d Digital Envelope is sent by the Comms Hub in response to a successful SelectGsmNework command. The payload of this Digital Envelope contains a SwitchGsmNetworkTest command. The byte stream of the \u201cSwitch GSM Network Test\u201d Digital Envelope is represented in .","The HES has the option to include in any of its Digital Envelope Acknowledgment a callback time. At this configured time, the Comms Hub establishment of a GPRS connection and sends a \u201cCall-back Response\u201d Digital Envelope to advertise the availability of the Comms Hub on the IP network. The byte stream of the \u201cCall-back response\u201d Digital Envelope is represented in .","The \u201cCommission Request\u201d Digital Envelope is sent by the Comms Hub to initiate its commissioning or the commissioning of a ZigBee Device. The payload of this Digital Envelope contains a \u201cCommissionRequest\u201d command. The byte stream of the \u201cCommissionRequest\u201d Digital Envelope is represented in .","The \u201cOTA Status Report\u201d Digital Envelope is sent by the Comms Hub each time the status of the OTA process of one of its associated ZigBee Device change. The payload of this Digital Envelope contains an \u201cOTAStatusReport\u201d command. The byte stream of the \u201cOTA Status Report\u201d Digital Envelope is represented in .","The \u201cOTA Image Request Alert\u201d Digital Envelope is sent by the Comms Hub to alter the Head End System when there is either a new image transfer required or all the image transfers are complete. The Head End System initiates a TCP\/TLS session in response to this alert. The byte stream of the \u201cOTA Image Request Alert\u201d Digital Envelope is represented in .","The \u201cDecommission Request\u201d Digital Envelope is sent by the Comms Hub to initiate its decommissioning or the decommissioning of an associated Zigbee Device. The payload of this Digital Envelope contains a \u201cDecommissionRequest\u201d command. The byte stream of the \u201cDecommission Request\u201d Digital Envelope is represented in .","Daily reports and real time alarms are transferred using a Digital Envelope with a reason code in the 0x10 to 0x3F range. The payload of these Digital Envelopes is specific to the type of device, the configuration of this device and the type of alarm reported. The octet stream of a report or alarm Digital Envelope is represented in .","The \u201cAcknowledgment\u201d Digital Envelope is sent by the Head End System each time it receives a Digital Envelope form the Comms Hub. The byte stream of the \u201cAcknowledgment\u201d Digital Envelope is represented in . The value sequenceNumber field within the \u201cAcknowledgment\u201d Digital Envelope mirrors the sequenceNumber of the Digital Envelope acknowledged. The absence of the currentTime field shall not be processed as an error by the Comms Hub. The callback fields are present in the Digital Envelope only if the HES needs to communicate with the Comms Hub later during that day. The dstStart and dstEnd are provided by the HES to keep these attributes up to date. These values are changed once a year. The \u201cAcknowlegment\u201d Digital Envelope of a \u201cCommissioning Request\u201d Digital Envelope contains the Commissioning and Manufacturer certificates. These certificates are included in the CMS SignedData certificate field. When the Head End System need to update Comms Hubs CRL, the new CRL is included in the CMS signedData crls field.","The Digital Envelope (DE) handshake in  corresponds to the exchange of Digital Envelopes during the commissioning of the Comms Hub, when the ReasonCode is set to \u201cCommission request\u201d and the deviceMacAddress is absent or equal to the MAC address of the Comms Hub. The HES dynamically selects the correct Commissioning certificate based on the Manufacturer Device certificate received. The Commissioning certificate use by the HES is issued from the Manufacturer Root certificate configured in the Comms Hub during its manufacturing.","The handshake in  corresponds to the transmission of a DE with a Reason Code between 0x10 and 0x3F including: E-meter report, G-meter report, IHU report, Comms Hub report, E-meter high priority report, G-meter high priority report, IHU high priority report, Comms Hub high priority report, E-meter alarm, G-meter alarm, IHU alarm, and Comms Hub alarm. As well as transmission of a DE for Switch GSM Network Test, OTA Status Report, OTA Image Request Alert, Commission request of ZigBee devices, and Decommission request. These are payload DE message flows.","The sequence in  is used to transmit a Digital Envelop message that has no payload. These messages have a Reason Code set to: SMS wakeup response or Callback response.","The certificate management security infrastructure of the dual protocol WAN specification is based on two PKIs, the Manufacturing PKI and the Operational PKI.","A Manufacturer PKI is created by each Comms Hub manufacturer and used to implement the following security services: Authentication of Comms Hubs during their initial deployment or redeployment and Authentication of the HES during the commissioning process.","During the deployment process, the Head End System takes ownership of the Comms Hubs by configuring in them operator certificates. The Operational PKI is managed by the operator of the Comms Hubs and is used to implement the following security services: Mutual authentication of Comms Hubs and the HES during a TLS handshake, Authentication of Digital Envelops sent by the Comms Hubs or the HES and Granting access rights.","The Manufacturing PKI consists of four certificates as shown in . These certificates are used as follows: The Manufacturer Root and Manufacturer are used to issue certificates and the Commissioning and Manufacturer Device are used for authentication during TLS handshakes and for Digital Envelops authentication.","Manufacturing certificates are unmanaged, their lifetimes are indefinite and they never get replaced. However, the uses of these certificates are strictly controlled by the system responsible for the Comms Hubs commissioning. This system maintains a list of the serial numbers of the Comms Hub expected to be installed and shall reject any Comms Hub with a certificate serial number not on this list or a serial number already used.","The Manufacturer Root certificate is the root of trust for the manufacturing PKI. It is used to issue Manufacturer and Commissioning certificates. The Manufacturer Root certificate has an indefinite lifetime; nevertheless this certificate may be replaced periodically. The replacement of the Manufacturer Root certificate has no impact on already issued Manufacturer Device certificates. When replaced, new Manufacturer certificates and the associated Commissioning certificate need to be reissued. The Manufacturer Root certificate is stored in the following locations: Manufacturer's Commercial CA (private Key); Manufacturing system (public key); HES (public key) and Comms Hub (public key). The Manufacturer Root certificate is a self-signed X.509 certificate with the following content. The subject field is composed of: The commonName field set to \u201cManufacturers Root\u201d; The organizationName field set to the commercial name of the manufacturer; and The countryName field set to the country code where this manufacturer is located. The issuer field set to the same values as the subject field. The validity field is composed of: the notBefore field set to the issuing date of this certificate and the notAfter field set to notBefore plus 99 years. The basicConstraints extension ({2 5 29 19}, with the cA field set to TRUE. The keyUsage extension {2 5 29 15}, with the keyCertSign and cRLSign fields set to TRUE.","The Manufacturer certificate is issued by the Manufacturer Root for each manufacturing site. This certificate is used to issue a Manufacturer Device certificate for each Comms Hub manufactured at this site. The Manufacturer certificate has an indefinite lifetime; nevertheless this certificate may be replaced periodically. The replacement of the Manufacturer certificate has no impact on already issued Manufacturer Device certificates. When replaced, the associated private key may be deleted to reduce the risk of compromise. The Manufacturer certificate is stored in the following locations: Manufacturing system (private key); HES (public key) and Comms Hub (public key). The Manufacturer Root certificate is a X.509 certificate with the following content. The subject field composed of: The commonName field set to a unique name assigned to this manufacturing site; The organizationUnitName field set to \u201cManufacturer\u201d; The organizationName field set to the commercial name of the manufacturer; and The countryName field set to the country code where this manufacturer is located. The issuer field is set to the subject field of the Manufacturers Root certificate. The validity field is composed of: the notBefore field set to the issuing date of this certificate and the notAfter field set to notBefore plus 99 years. The basicConstraints extension {2 5 29 19}, with the cA field set to TRUE. The keyUsage extension {2 5 29 15}, with the keyCertSign field set to TRUE.","The Manufacturer Device certificate is issued by the Manufacturer located on each site of manufacturing. This certificate is used to authenticate the Comms Hub during TLS handshakes and any Digital Envelop transmitted by the Comms Hub prior to its commissioning. The Manufacturer Device certificate has an indefinite lifetime and is not expected to be replaced during the lifetime of a Comms Hub. The Manufacturer Device certificate is stored in the following locations: Comms Hub (private Key); Manufacturing system (public key); and HES (public key). The Manufacturer Device certificate is a X.509 certificate with the following content. The subject field composed of: The commonName field set to serial number assigned to this Comms Hub; The organizationUnitName field set \u201cManufacturer Device\u201d; The organizationName field set to the commercial name of the manufacturer; and The countryName field set to the country code where this manufacturer is located. The issuer field is set to the subject field of the Manufacturer certificate. The validity field composed of: the notBefore field set to the issuing date of this certificate and the notAfter field set to notBefore plus 99 years. The keyUsage extension {2 5 29 15}, with the digitalSignature and the keyAgreement fields set to TRUE.","The Commissioning certificate is issued by the Manufacturer Root to the operator. The manufacturer is also responsible for providing the list of the serial numbers of the Comms Hubs manufactured for this operator. This list should be used by the operator to limit which Comms Hubs is accepted in its system. The Commissioning certificate may have a limited or unlimited lifetime. If the lifetime is limited, the manufacturer should support issuing of new Commissioning certificates for each Manufacturer Root created for the Comms Hubs lifetime to allow their re-deployment. The Commissioning certificate is stored in the HES (private Key). The Commissioning certificate is a X.509 certificate with the following content. The subject field composed of: The commonName field set to name of this operator; The organizationUnitName field set to \u201cCommissioning\u201d; The organizationName field set to the commercial name of the manufacturer; The countryName field set to the country code where this manufacturer is located. The issuer field is set to the subject field of the Manufacturer Root certificate. The validity field composed of: the notBefore field set to the issuing date of this certificate and the notAfter field set to notBefore plus 99 years. The keyUsage extension {2 5 29 15}, with the digitalSignature and the keyAgreement fields set to TRUE.","The Operational PKI consists of the eight certificates as shown in . These certificates are used as follows: The Operator's Root, Enterprise and Operator certificates are used to issue certificates; The Server and Operator Device certificates are used for authentication during TLS handshakes following commissioning; The Push and Operator Device certificates are used for Digital Envelops authentication; and The Authorization Signing certificate is used to sign command(s) or to grant privileges during TLS session. Privileges are granted by signing an Authorization certificate for a specific validity period and a set of privileges.","Operational certificates are managed because they are intended to be used continuously over a potentially long period of time, during which there is a need to renew their security.","The Operator's Root certificate is the root of trust for the operational PKI. It is used to issue Enterprise and Operator certificates. The lifetime of the Operator's Root certificate might be, e.g., 10 years. When the Operator's Root certificate is updated, all the Comms Hubs need to be configured with a new chain of certificates issued for that new Operator Root. During the update process, the Head End System shall be able to establish a TLS session with either set of certificates. The set of certificates used by the Head End System depends of the certificates returned by the Comms Hub during the TLS handshake. The Operator's Root certificate is stored in the following locations: Operator's Commercial CA (private Key); HES (public key); Comms Hub (public key). The Operator's Root certificate is a self-signed X.509 certificate with the following content. The subject field composed of: The commonName field set to \u201cOperator's Root\u201d; The organizationName field set to the operator name and The countryName field set to the country code where this operator is located. The issuer field set to the same values as the subject field. The validity field is composed of: the notBefore field set to the issuing date of this certificate and the notAfter field set to notBefore plus the Operator's Root certificate lifetime. The basicConstraints extension {2 5 29 19}, with the cA field set to TRUE. The keyUsage extension {2 5 29 15}, with the keyCertSign and cRLSign fields set to TRUE.","The Operator certificate is issued by the Operator's Root. This certificate is used to issue an Operator Device certificate for each Comms Hub and the Authorization Signing certificate. The lifetime of the Operator's certificate might be, e.g., five years. When the Operator certificate is updated, all the Comms Hubs need to be configured with a new Operator certificate and an Operator Device certificate issued from it. The Operator certificate is stored in the following locations: Operator's Commercial CA (private Key); Head End System (public key); and Comms Hub (public key). The Operator certificate is a X.509 certificate with the following content. The subject field composed of: The commonName field set to \u201cOperator\u201d; The organizationName field set to the operator name; and The countryName field set to the country code where this operator is located. The issuer field is set to the subject field of the Operator's Root certificate. The validity field composed of: The notBefore field set to the issuing date of this certificate and The notAfter field set to notBefore plus the Operator certificate lifetime. The basicConstraints extension {2 5 29 19}, with the cA field set to TRUE. The keyUsage extension {2 5 29 15}, with the keyCertSign field set to TRUE.","The Operator Device certificate is issued for each Comms Hub by the Operator. This certificate is used to authenticate the Comms Hub during the TLS handshake and to sign Digital Envelopes sent by the Comms Hub. The lifetime of the Operator Device certificate might be, e.g., 2 years. The update of the Operator Root, Operator and Operator Device certificate should be coordinated to avoid a discrepancy in there expiration dates. To avoid a higher layer certificate with an expiration prior to a lower layer certificate, the Operator certificate should be updated 2 years prior of its expiration and the Operator Root should be updated 5 years prior of its expiration. The Operator certificate is stored in the following locations: Comms Hub (private key); Operator's Commercial CA (public Key); and Head End System (public key). The Operator Device certificate is a X.509 certificate with the following content. The subject field composed of: The commonName field set to the serial number assigned to this Comms Hub; The organizationUnitName field set to \u201cOperator Device\u201d; The organizationName field set to the operator name; and The countryName field set to the country code where this operator is located. The issuer field is set to the subject field of the Operator's certificate. The validity field composed of: The notBefore field set to the issuing date of this certificate and The notAfter field set to notBefore plus the Operator Device certificate lifetime. The basicConstraints extension {2 5 29 19}, with the cA field set to FALSE. The keyUsage extension {2 5 29 15}, with the digitalSignature and keyAgreement fields set to TRUE. The extKeyUsage extension {2 5 29 37}, with the KeyPurposeId field set to serverAuth {1 3 6 1 5 5 7 3 1}.","An Enterprise certificate is issued by the Operator's Root. This certificate is used to issue a Server certificate used during the TLS handshake with the Head End System and the Push certificate used to encrypt Digital Envelops and sign Digital Envelop acknowledgments. The lifetime of the Enterprise certificate might be 5 years. When the Enterprise certificate is updated, new Server and the Push certificates need to be issued for the Head End System. The new Push certificate also needs to be distributed to all the Comms Hubs. During the distribution process, the Head End System should continue using the old Push certificate for Comms Hub not yet updated. The Enterprise certificate is stored in the following locations: Operator's Commercial CA (private Key); Head End System (public key); and Comms Hub (public key). The Enterprise certificate is a X.509 certificate with the following content. The subject field composed of: The commonName field set to \u201cEnterprise\u201d; The organizationName field set to the operator name; and The countryName field set to the country code where this operator is located. The issuer field is set to the subject field of the Operator's Root certificate. The validity field is composed of: The notBefore field set to the issuing date of this certificate and The notAfter field set to notBefore plus the Enterprise certificate lifetime. The basicConstraints extension {2 5 29 19}, with the cA field set to TRUE. The keyUsage extension {2 5 29 15}, with the keyCertSign field set to TRUE.","The Server certificate is issued by the Operator. This certificate is used to authenticate the Head End System during TLS handshakes. The lifetime of the Server certificate might be 5 years. The update of the Server certificate should be coordinated with the Enterprise and Operator Root certificates to avoid a certificate higher in the PKI hierarchy with an expiration date prior to a certificate lower in this hierarchy. The update of the Server certificate has no impact on the configuration of the Comms Hub since the trust anchor uses during the TLS handshake is the Operator Root. The Server certificate is stored in the following locations: Head End System (Private key) and Operator's Commercial CA (public Key). The Server certificate is a X.509 certificate with the following content. The subject field composed of: The commonName field set to the name assigned to the HES; The organizationUnitName field set to \u201cServer\u201d; The organizationName field set to the operator name; and The countryName field set to the country code where this operator is located. The issuer field is set to the subject field of the Enterprise certificate. The validity field composed of: The notBefore field set to the issuing date of this certificate and The notAfter field set to notBefore plus the Server certificate lifetime. The basicConstraints extension {2 5 29 19}, with the cA field set to FALSE. The keyUsage extension {2 5 29 15}, with the keyAgreement field set to TRUE. The extKeyUsage extension {2 5 29 37}, with the KeyPurposeId field set to clientAuth {1 3 6 1 5 5 7 3 2}.","The Push certificate is issued by the Operator. This certificate is used to sign digital Envelops sent by the Head End System and for key derivation (ECDH) during the encryption and decryption process. The lifetime of the Push certificate might be 5 years. The update of the Push certificate should be coordinated with the Enterprise and Operator Root certificates to avoid a certificate higher in the PKI hierarchy with an expiration date prior to a certificate lower in this hierarchy. When updated, the Push certificate needs to be distributed to all the Comms Hubs to enable the encryption of Digital Envelops using this new public key. During the upgrade process, the Head End System shall be able to transfer Digital Envelops with Comms Hubs still using the old Push certificate and Comms Hubs configured with the new Push certificate. The Push certificate is stored in the following locations: Head End System (Private key); Operator's Commercial CA (public Key) and the Comms Hub (public key). The Server certificate is a X.509 certificate with the following content. The subject field composed of: The commonName field set to the name assigned to the HES; The organizationUnitName field set to \u201cPush\u201d; The organizationName field set to the operator name; and The countryName field set to the country code where this operator is located. The issuer field is set to the subject field of the Enterprise certificate. The validity field is composed of: The notBefore field set to the issuing date of this certificate and The notAfter field set to notBefore plus the Push certificate lifetime. The basicConstraints extension {2 5 29 19}, with the cA field set to FALSE. The keyUsage extension {2 5 29 15}, with the digitalSignature and keyAgreement fields set to TRUE.","An Authorization Signing certificate is issued by the Operator. This certificate is used to either sign commands or to sign the Authorization certificate. Authorization certificates are transferred during an already establish TLS session to acquired access rights. The lifetime of the Authorization Signing certificate might be 5 years. When updated, the Authorization Signing certificate needs to be distributed to all the Comms Hubs to enable the authentication of commands or Authorization certificates. Comms Hubs shall store and use at least two Authorization certificates. This allows the distribution of a new Authorization certificate while still using the old one on all the Comms hubs. The Authorization Signing certificate is stored in the following locations: Head End System (Private key) and Operator's Commercial CA (public Key). The Authorization Signing certificate is a X.509 certificate with the following content. The subject field composed of: The commonName field set to the name assigned to the HES; The organizationUnitName field set to \u201cAuthorization Signing\u201d; The organizationName field set to the operator name; and The countryName field set to the country code where this operator is located. The issuer field is set to the subject field of the Operator certificate. The validity field is composed of: The notBefore field set to the issuing date of this certificate and The notAfter field set to notBefore plus the Authorization Signing certificate lifetime. The basicConstraints extension {2 5 29 19}, with the cA field set to FALSE. The keyUsage extension {2 5 29 15}, with the keyCertSign field set to TRUE.","The Authorization certificate is issued by the Operator. This certificate is used to grant privileges on an already establish TLS session. It is recommended that lifetime of the Authorization certificate is very limited, a day or a week. It is also recommended that it target a specific device or group of devices. The Authorization certificate is a X.509 Attribute Certificate as defined by RFC5755. The exact content of this certificate needs to be defined to align with the DLMS authorization levels.","All certificates used by the Dual Protocol WAN specification comply with the X.509 standard. The X.509 standard supports multiple options and extensions and  describes the equivalent ANS.1 definition for the general structure of a certificate and the specific options and extensions used. When encoded using the Distinguished Encoding Rules (DER), certificates produce the byte stream shown in . This byte stream is just an example; more extensions can be added and some optional fields might be removed. The mandatory content of each certificate is defined in the \u201cFormat\u201d paragraph of each certificate. The byte stream is represented in the left column; the right column contains a short description. Value \u201cxx\u201d represents an octet and the value \u201cxx . . . \u201d represents an octet string.","The IETF Transport Layer Security (TLS) protocol is used to secure TCP sessions. The TLS protocol supports a number of cipher suite. The Comms Hub, as a minimum, shall support the cipher suite TLS_ECDHE_ECDSA_WITH_AES128_GCM_SHA256. The different components of this cipher suite are listed in Table 14.",{"@attributes":{"id":"p-0197","num":"0217"},"tables":{"@attributes":{"id":"TABLE-US-00017","num":"00017"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"105pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"91pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE 14"},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Asymmetric key generation","ECC curve secp256r1"]},{"entry":[{},"Symmetric key agreement","ECDHE"]},{"entry":[{},"Symmetric cipher","AES-128"]},{"entry":[{},"Symmetric cipher mode","GCM"]},{"entry":[{},"Hash function","SHA-256"]},{"entry":[{},"Signature","ECDSA\/SHA-256"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}}}},"Each TLS session start by a handshake during which authentication and share symmetrical key derivation are performed. The logic implemented during this handshake depends of the value of the ChCommissioningState attribute of the Comms Hub Control cluster.","When the ChCommissioningState attribute is set to NOT_COMMISSIONED or DECOMMISSIONED, the Comms Hub shall perform the TLS handshake shown in . Invalid TLS credentials from either the Head End System or the Comms Hub result in the abortion of the TLS session establishment.","When the ChCommissioningState attribute is set to COMMISSIONED, the Comms Hub shall perform the Normal TLS handshake shown in . Invalid TLS credentials from either the Head End System or the Comms Hub result in the abortion of the TLS session establishment.","The Comms Hub initiates communications to the Head End System when it has a scheduled message to send or when there is an event to report in real-time. The first step in initiating any communication to the Head End System is to connect to the WAN. The actual implementation of the flows is specific to the interfaces provided by the GSM modem vendor and is a design issue. Some aspects of the interaction with the mobile operator may also be specific to that operator.","The Comms Hub initiates communications with the Head End System when it has information to send. A Comms Hub initiated communication is called a Push. A Push can be triggered by a scheduled operation such as a meter usage report or by an alarm\/event that has to be reported in real-time. Reported events include the installation of firmware upgrades. A push schedule can be either one-time or reoccurring. Schedules are either set by the Comms Hub or by ZigBee commands and attributes or by COSEM scheduling ICs from the Head End System. Daily meter usage reports shall be scheduled by the Comms Hub to occur at a random time in a transmission window. The push operation uses the UDP\/DE protocols in the WAN stack.","A simple UDP\/DE push message flow example is shown in . At the start of the process Comms Hub has a scheduled or real-time report to transmit to the Head End System. In a cellular WAN it starts off by opening a GPRS and PDP connection with the mobile operator's system which is not shown here. If needed the Comms Hub does a DNS look up to resolve the Head End System's fully qualified domain name into an IP address using DNS. When that is done, the Comms Hub sends a Push message that contains the message to the Head End System's IP address. This message is secured by a digital envelope described above. In this example, the Head End System has no messages for the Comms Hub so it sends a simple Push ACK message to the Comms Hub with no callback time. If there is a call back time the Comms Hub uses that information to either keep the data connection up or schedule a latter connection. For a cellular WAN system; If the Comms Hub is also finished communicating, it terminates the PDP and GPRS WAN connections as described below.","There are cases where the Head End System receives a Push message and wants to continue communicating to the Comms Hub. This may occur when the Push message is an alarm, and the Head End System needs to react to it by getting or setting parameters. This case may also occur when the Head End System has information to send like a firmware image. In these cases, the Head End System either wants the Comms Hub to keep the data connection up, or it wants the Comms Hub to callback at a scheduled time. The Head End System communicates what it wants in the Push ACK message. This acknowledgement message's callback time field can have a time value or the stay-awake value, \u201cnow\u201d.","The example shown in  shows a case where the Head End System asks the Comms Hub to stay awake. The push operation is the same as that in . However, when the Head End System sends its Push ACK message, it asks the Comms Hub not to close the WAN connection by setting the callback time to \u201cnow\u201d. The Head End System then initiates a TCP connection and sets up a TLS session to continue to communicate with the Comms Hub. Data connection stays open until the TLS and TCP sessions are closed. After this, the Comms Hub terminates the PDP and GPRS WAN connections if it is using a cellular WAN.","The Comms Hub's Push messages and the Head End System's Push ACK messages use the Digital Envelope header formats described above. The Push messages contain all the protocol specific parameters necessary to identify the sender and the destination application processes. The Push payload is used to send the value(s) of attribute(s) that make up the upstream report. The Push ACK has no payload.","The Comms Hub keeps the GPRS connection closed for most of the time. The Comms Hub only opens it for short periods when data is pushed upstream. Therefore, when the Head End System needs to initiate communications with the Comms Hub, it has to send a message using SMS to tell the Comms Hub to establish a GPRS connection. This is the SMS wakeup message. The SMS wakeup message is a short message that tells the Comms Hub to wake up. It is a Class 0 message with no storage in the SIM. No information or acknowledgement is sent back to the Head System by the Comms Hub using SMS.","The Head End System propagates its clock to the entire smart meter network. The Head End System periodically distributes clock information to each Comms Hub using one of the DLMS Clock setting methods such as preset_adjustment_time. The Head End System also keeps the Comms Hub daylight savings configuration current with the local time by setting the enable, disable, start, end, and deviation parameters using the DLMS Clock setting methods. The clock synchronization can be incorporated as needed in the scheduled push operation in either the TCP message exchange or the UDP\/DE acknowledgement message.","The Comms Hub and HAN devices receive firmware image upgrades from the Head End System. For the HAN devices the image is transferred via the Comms Hub. The Head End System downloads firmware via the WAN to all the HAN devices. The firmware image is first transferred to the Comms Hub and from there the image is transferred to the targeted devices. The WAN transfer to the Comms Hub uses the OTA image transfer process flow in . The HAN transfer from the Comms Hub to the HAN devices uses the ZigBee OTA Upgrade cluster and its methods. The Comms Hub may store each firmware image in non-volatile memory until all the devices needing it have successfully downloaded it and verified its integrity.","The firmware activation time can be controlled by the Comms Hub using the ZigBee OTA Upgrade cluster's Upgrade End Response message. The activation time sent by this message can immediately activate the firmware or set a time for its activation. The Comms Hub maintains a log of the progress of each firmware image upgrade that can be read by the Head End System. The security of the firmware updates is protected by digital certificates signed by the manufacturer.","The OTA process is divided in two parts to simplify its description, the OTA image transfer is described in this section and the OTA activation is described below. The first part of the OTA Upgrade process consists of the downloading images from the Head End System and distributing them to each ZigBee device. This process consists of the following steps per . The OTA download process is triggered by the Head End System with the transmission of a new Image Set to the OTA Upgrade server in the Comms Hub. The Head End System requests a data connection using the SMS Wakeup message. The Comms Hub establishments a data connection and sends a Push message after which the Head End System sets up a TCP session and the Comms Hub a TLS connection. The transmission by the Head End System of an Image Set, the transfer is performed using the WriteImageSet command. On reception of the WriteImageSet command, the OTA Upgrade server selects a first image file to be downloaded and update its Image Transfer Status. The Comms Hub compares the Image Set information just received against the version of each Image Type registered on its network. It then starts downloading each image file from the Head End System. The download from the Head End System to the OTA Upgrade server is done using the OTA Upgrade server's \u201cNextImageTransferResponse\u201d command. The download of image files stops when no more space is available in the Comms Hub to receive more data. The Comms Hub then frees up space by transferring the image to each target device that requests it. When the Comms Hub is part of the upgrade, its Image file is always transferred first and is not erased for each subsequent downloads. Images files downloaded from the Head End System are transferred to ZigBee target devices using the standard OTA commands and processes as summarized herein.","When the distribution of the Image files to the target devices is completed the OTA Upgrade sever downloads a second batch of Image files from the Head End System. This Comms Hub initiated service consist of: The transmission of the push \u201cOTAStatusReport\u201d message; The establishment of a TLS session by the Head End System and the transmission of an \u201cNextImageTransferResponse\u201d command by the OTA Upgrade server; and On reception of the \u201cNextImageTransferResponse\u201d command, the Head End System's OTA Upgrade client downloads the requested image file.","The transmission by the Head End System of an Image Set using the WriteImageSet command and the OTA Upgrade server selection and update to its Image Transfer Status are repeated until all the image files are downloaded or the Set ID is aborted by the Head End System.","The OTA activation represents the second and final part of the OTA upgrade process and is shown in . The second part of the OTA Upgrade process consists of the activation of the image files already distributed to the different ZigBee devices. This process consists of the following steps:\n\n","The OTA Abort Process flow is shown in . The AbortOtaProcess starts by the reception of an AbortOtaProcess command imitated by the Head End System to the OTA Upgrade server.\n\n","The \u201cZigBee Device OTA download\u201d process shown in  is implemented using the standard ZigBee OTA Upgrade cluster. Steps are as follows:\n\n","Commissioning is the process by which a HAN device registers with the Comms Hub and Head End System and the Comms Hub and device are configured. At the end of the commissioning process the device has joined the network, gotten its operational parameters and commenced operating. The commission process does not specify how the installer starts the commissioning and talks to the Comms Hub.","The commissioning message flow between the Comms Hub and the Head End System is shown in . The process starts with an external stimulus to the Comms Hub that may be a button push or a command on an external interface. The commissioning process in steps that are illustrative of the behavior of the Head End System but not required. These behaviors include the tearing down of the TCP\/TLS sessions between stages of the process and the generation of text messages to the installer. The Head End System may manage the TCP\/TLS sessions to minimize the number open processes it has during periods where it is waiting for an action from the Comms Hub. The commission protocol supports this but does not require it. The Head End System's communication of the status of the commissioning process to the installer is also optional. The content of the messages and when they are sent is exemplified, but not limited to the following:\n\n","The exception processing for invalid IMSI, MAC address, Serial Number all cause the Head End System to send a Commission message that aborts the commission processes in the Comms Hub. The commissioning process is also aborted if the Comms Hub report it is not successful in steps 4.1 or 10.1 above.","The commissioning message flow between the Comms Hub and the Head End System for commissioning an E-meter is shown in . The process shown in is for an E-meter that is not integrated with the Comms Hub. An integrated device's commissioning process is similar to that of the Comms Hub described above.\n\n","The exception processing for invalid MPAN, MAC address, Serial Number all cause the Head End System to send a Commission message that aborts the commission processes in the Comms Hub. The commissioning process is also aborted if the Comms Hub reports it is not successful in step 6.0 or if the E-meter fails to join the network and get its keys in steps 8.x. The installer can abort the process in step 7.1 if the Head End System sends information to the installer that is not correct.","The commissioning message flow between the Comms Hub and the Head End System for commissioning a G-meter is shown in and \n\n","The exception processing for invalid MPRN, MAC address, Serial Number all cause the Head End System to send a Commission message that aborts the commission processes in the Comms Hub. The commissioning process is also aborted if the Comms Hub reports it is not successful in step 6.0 or if the E-meter fails to join the network and get its keys in steps 8.x. The installer can abort the process in step 7.1 if the Head End System sends information to the installer that is not correct.","The commissioning message flow between the Comms Hub and the Head End System for commissioning an IHD is shown in and \n\n","The exception processing for invalid MAC address and Serial Number all cause the Head End System to send a Commission message that aborts the commission processes in the Comms Hub. The commissioning process is also aborted if the Comms Hub reports it is not successful in step 6.0 or if the IHD fails to join the network and get its keys in steps 7.x.","The decommissioning process removes sensitive data from the target device and the Comms flub and then takes the device off the HAN network. The target device may or may not be in the factory default state after decommissioning. the decommission process may be initiated by either the Head End System or a service technician referred to as an installer in this section. The WAN specification does not specify how the installer starts the decommissioning and talks to the Comms Hub. The installer's interface and messaging protocol is outside of the scope of this WAN interface specification.","The flow diagrams in  show the decommissioning process initiated by an installer. The same processes are followed when the decommissioning is initiated by the Head End System. In the HES case, each decommissioning flow starts with the first Decommission command from the Head End System. Also in this case, all messaging to and from the installer will not be present.","The Comms Hub decommissioning message flow between the Comms Hub and the Head End System is shown in .\n\n","The E-meter decommissioning message flow between the Comms Hub and the Head End System is shown in .\n\n","The exception processing for invalid MAC address, and Serial Number cause the Head End System to send a Decommission message that aborts the decommission processes in the Comms Hub.","The G-meter decommissioning message flow between the Comms Hub and the Head End System is shown in .\n\n","The IHD decommissioning message flow between the Comms Hub and the Head End System is shown in .\n\n","The client application processes for the Comms Hub are organized as processes in ZigBee clusters. Each device in the HAN has a control cluster with the virtual devices attributes and the associated methods. The control clusters are defined by the cluster ID and endpoint ID. Meters of the same type have a common cluster ID. The Comms Hub has one control cluster that the HES uses to manage and monitor it. The Comms Hub clusters provide: control and monitoring for each HAN device: G-meter(s), E-meter(s), IHD(s) and the Comms Hub; OTA updates using the extensions to the OTA Upgrade cluster set up image sets for Comms Hub to download for each HAN device and provide firmware updates for all the HAN devices; scheduling of the Comms Hub activities, such as pushing meter reports to the HES and getting E-meter data: Push message processing which is the process that collects meter information that is pushed at the scheduled time, e.g., includes events that are reported but don't have to be pushed to the HES in real-time; Communication stack management which configures the communication stack layers using the Comms Hub Control cluster attributes for TCP-UDP, IPv4, PPP setup, and GPRS modem setup; Security via the Security Control cluster that controls the WAN and HAN security, setting up certificates, updating keys and controlling white lists and black lists; Log maintenance via the Log Control cluster is used to configure events for logging and reporting and to manage the logs maintained for each of the HAN devices and the Comms Hub; Time management via the ZigBee Time Control cluster manages the Comms Hub clock synchronization process with the HES and sets the parameters used by the ZigBee Time cluster used by the HAN devices; Device commissioning and decommissioning via the Commissioning Control cluster which defines the processes used by the Comms Hub to commission HAN devices (these processes are used by the HHT to initiate and monitor the commissioning and decommissioning actions and by the HES to control the commissioning of devices); Storage and forwarding of ZigBee Smart Energy information via extensions to the Smart Energy clusters which allow the HES to send tariff and price calculation information to the ZigBee meter and display devices.","In the preferred embodiments described herein, the Comms Hub communicates with the HAN devices using the ZigBee network stack. These communications' application payloads can be either DLMS\/COSEM payloads or ZigBee application payloads. There are two ZigBee network stacks: one stack with a full APS for HAN device communications, and one with Inter-PAN and a stub APS that is used only by the HHT. The HHT forms a simple point-to-point connection with the Comms Hub. The messages sent use the IEEE 802.15.4 physical layer, the data link layer, and the ZigBee network layer. At the network layer the HHT messages are diverted to a stub Application Protocol Sub-layer that provides an application interface, which allows transmission of messages without the formation of a HAN network.","The HAN network architecture is based on the IEEE 802.15.4 physical layer using the 2.4 GHz DSSS radio, the IEEE 802.15.4-2006 MAC, the ZigBee network layer, the ZigBee Smart Energy Profile Specification, ELS cluster extensions, and relevant ZigBee application clusters. Detailed descriptions of these specifications are known to those skilled in the art and are thus considered part of this application. The application data flows between the clusters of the Comms Hub, E-meter, G-meter and IHD are shown in . Each cluster in a device has an interface for a client, a server, or both. The clusters communicate to the clusters of other devices using the ZigBee network stack.","Most clusters communicate directly with their corresponding cluster in other devices. However, the G-meter is a battery operated device that keeps its radio turned off most of the time. It is configured to generate periodic metering messages to the Comms Hub. To support regular access to the G-meter data by the IHD, the Comms Hub provides a mirror cluster, the Gas Mirror. The Gas Mirror is based on the ZigBee Metering client. It presents the G-meter data to other HAN devices. The mirror allows battery devices to store data in the Comms Hub for other devices to retrieve. To accomplish this, the G-meter's Gas Metering server cluster is bound to the Gas Metering client cluster in the Comms Hub. The IHD then binds its Metering client cluster to the Comms Hub's Gas Metering Mirror server cluster that has the stored mirror information. Occasionally the G-meter is also required to get information stored in the Comms Hub. The Comms Hub indicates what information should be retrieved using the Notification status bits that are periodically read by the G-meter.","The IHD may also bind its Meter client cluster to the E-meter's Electric Meter server cluster so that it can collect electrical usage data. The E-meter may implement ZigBee Clusters to support its communications on the ZigBee network and its DLMS communication to the HES using a ZigBee DLMS Tunnel to the Comms Hub.","Various additional communication flows between the HES, Comms Hub and HAN devices are described below.","Referring to , an exemplary communication for a gas meter (G-meter) is shown. The G-meter is a sleepy device that communicates only with the Comms Hub. It uses a data push model wherein at scheduled times, it transmits data to the Comms Hub or reads data from the Comms Hub. The Comms Hub does not initiate communications with the G-meter and it does not do unsolicited reads or writes. In , the G-meter initiates a scheduled transmission by turning on its radio and sending its Meter cluster data to the Comms Hub. The G-meter then reads the Notification register in the Comms Hub. The register has flags that tell the G-meter to gets different types of data or to just stay awake and receive commands from the Comms Hub. The first time this register has no flags set and the G-meter goes to sleep. The second time the G-meter wakes up it reads the Notification and sees the flag that asks it to stay awake. The Comms Hub then sends what every command it has ready after which the G-meter's radio goes to sleep. If any of the Notification register flag bits for operations are set, the G-meter can perform those operations now or later. The G-meter clears the Notification bits as operations are performed. The stay-awake flag in the Get Notification Flags Response remains active so long as the Comms Hub has commands to send to the G-meter.","The Gas Mirror cluster in the Comms Hub acts like a proxy for the G-meter's Gas Meter cluster. The G-meter is a battery operated device that only turns its radio on when it needs to communicate with the Comms Hub. The Comms Hub cannot initiate communications with the G-meter. As shown in , the G-meter turns on its radio and sends its Gas Meter clusters data to the Comms Hub at scheduled intervals where it is stored in the Gas Mirror. This enables the IHD to retrieve gas usage data from the Comms Hub at any time as if it was communicating with the G-meter.","The Comms Hub communicates with the E-meter using DLMS\/COSEM. The COSEM messages are sent using the ZigBee DLMS Tunnel cluster. These communications are initiated by the Comms Hub to get meter usage data and management information for the E-meter. This process is shown in . The read operation is started by Comms Hub. It first establishes a tunnel with the E-meter and then does a DLMS association with the E-meter before doing any DLMS operations. The tunnel setup and association is not shown in . The read sequence shown is a simple two-way message transaction that may be repeated several times to gather all the data the Comms Hub needs.","The Comms Hub communicates with the E-meter using the ZigBee application layer clusters associated with joining, binding, and commissioning. The ZigBee cluster connections between the Comms Hub and the E-meter are shown in . Most operations like those associated with the TOU calendar, price calculation and time maintenance are done using DLMS and ZigBee.","The Comms Hub polls each E-meter for alarms and events at a configurable rate that can be as fast as once per 7.5 seconds. The Comms Hub also polls each E-meter for meter metrics at a configurable rate that is typically set to be once a day just after midnight. All the scheduled polls by the Comms are randomized in a small window to prevent data flooding in a neighborhood containing many Comms Hubs.","Both the Head End System's COSEM applications and the Comms Hub's COSEM applications can communicate over the HAN network with the E-meter using the ZigBee DLMS Tunnel cluster.","The DLMS defined WPDU contains the DLMS Wrapper Header and the DLMS APDU. The ZigBee OTA Tunnel TransferData command carries the WPDU as shown in Table 15 below.",{"@attributes":{"id":"p-0246","num":"0410"},"tables":{"@attributes":{"id":"TABLE-US-00018","num":"00018"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"center"}}],"thead":{"row":{"entry":[{},"TABLE 15"]}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]},{"entry":[{},"ZigBee","DLMS WPDU"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"7"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"4","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"5","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"6","colwidth":"28pt","align":"center"}},{"@attributes":{"colname":"7","colwidth":"35pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Size","2 bytes","2 bytes","2 bytes","2 bytes","2 bytes","\u2014"]},{"entry":{"@attributes":{"namest":"1","nameend":"7","align":"center","rowsep":"1"}}},{"entry":["Field","TunnelID","version","Source","Destination","Length","APDU"]},{"entry":["Name",{},{},"wPort","wPort",{},"(payload)"]},{"entry":{"@attributes":{"namest":"1","nameend":"7","align":"center","rowsep":"1"}}}]}}]}}},{"@attributes":{"id":"p-0247","num":"0411"},"figref":"FIG. 62"},"The Head End System sends various sets of information to the HAN devices using the ZigBee Message, Price, TOU Calendar, and Password cluster put commands. The Head End System accomplishes this by setting the appropriate information in the appropriate Comms Hub cluster. The HAN devices either poll the Comms Hub clusters for the information, or are sent it use the ZigBee Publish commands. The modes are shown in Table 16.",{"@attributes":{"id":"p-0249","num":"0413"},"tables":{"@attributes":{"id":"TABLE-US-00019","num":"00019"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"4"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"84pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"28pt","align":"left"}}],"thead":{"row":[{"entry":"TABLE"},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}},{"entry":["Cluster","E-meter, IHD","G-meter","HHT"]},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Message","Pushed by the Comms","Notification is sent","Publish"]},{"entry":[{},"Hub to the IHD. DLMS is","following a G-meter",{}]},{"entry":[{},"used to send messages to","communication.",{}]},{"entry":[{},"the E-meter","G-meter then polls",{}]},{"entry":["Price","Pushed by the Comms","Notification is sent","N\/A"]},{"entry":[{},"Hub to the IHD. DLMS is","following a G-meter",{}]},{"entry":[{},"used to send price","communication.",{}]},{"entry":[{},"information to the E-meter","G-meter then polls",{}]},{"entry":["TOU","Pushed by the Comms","Notification is sent","N\/A"]},{"entry":["Calendar","Hub to the IHD. DLMS is","following a G-meter",{}]},{"entry":[{},"used to send TOU","communication.",{}]},{"entry":[{},"information to the E-meter","G-meter then polls",{}]},{"entry":["Password","Pushed by the Comms","Notification is sent","N\/A"]},{"entry":[{},"Hub to the IHD. DLMS is","to the G-meter to stay",{}]},{"entry":[{},"used to send password","awake and then the",{}]},{"entry":[{},"information to the E-meter","password is published."]},{"entry":{"@attributes":{"namest":"1","nameend":"4","align":"center","rowsep":"1"}}}]}}}}},"In the example shown in , the Head End System sends a display message to the IHD's ZigBee Message Cluster. In this example the Head End System already has a WAN connection to the Comms Hub, so it sends the a ZigBee gateway sendZclCommand containing the putTextMessageSet command to the Comms Hub using the MAC address of the IHD. This Head End System message is acknowledged by the IHD if the putTextMessageSet command requests a confirmation. The Comms Hub receives the Head End System ZigBee gateway message and generates a ZigBee DisplayMessage command addressed to the IHD. Since the confirmation control field is set, the IHD sends a response back and the Comms Hub. The Comms Hub then creates an alert to the Head End System informing it that the message has been delivered. This alert may be sent in real-time or at the end of the day.","A point-to-point connection between a hand-held terminal (\u201cHHT\u201d) and the Comms Hub is established and used for commissioning the Comms Hub. The authority given the HHT depends on a certificate it is issued by the manufacturer or operator. The connection may be established as described in U.S. patent application Ser. No. 13\/296,552 filed on Nov. 15, 2011, entitled \u201cMETHOD FOR SECURELY COMMUNICATING ACROSS MULTIPLE NETWORKS USING A SINGLE RADIO,\u201d wherein the HHT is able to find the Comms Hub and to communicate with it, without having to join the HAN network. The '552 application is incorporated herein by reference in its entirety.","An exemplary HHT Inter-PAN flow is shown in . It represents the flow used for commissioning. The HHT first discovers the devices in its vicinity by sending Data Frame requests on the configured channels and listening for responses. The Data Frame includes response filtering information which may include a MAC address and allowed RSSI level. These messages may be unicast in which case only the targeted Comms Hub replies or they may be broadcast and the HAN devices will determine if they respond based on the payload information. This information can be used to limit the response to that of the target Comms Hub. The Comms Hub uses its configured MAC address list to decide if it should respond to the Data Frame request. Typically this will be a MAC address black list used to block known bad devices. On receipt of the Data Frame response, the HHT operator selects the target Comms Hub. This selection can be confirmed by the operator matching the source MAC address of a response to the MAC address on the Comms Hub label.","The HHT then contacts the Comms Hub to initiate the ZigBee CBKE protocol. This message exchange generates a private, symmetric key shared between the two devices. With the symmetric key in place, both devices can now send secure ZigBee messages. The Comms Hub receives messages from many sources in the HAN network. It knows to apply the Inter-PAN key to the messages received with the APS Frame Type field set to 0b11. The first message received by the Comms Hub is the HHT's certificate. This certificate identifies the activities the HHT is authorized to perform.","The HHT is now authorized to send commands to the Comms Hub and receive responses. The HHT operates an inactivity timer t2 that alerts it when to renew the symmetric key and a certificate. When the HHT decides that it is finished it does not renew the key. The Comms Hub's inactivity timer is set to t1. When the t1 timer expires the Comms Hub revokes the key and the certificate. The value of t2 is set to be less than the value of t1."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE FIGURES","p":[{"@attributes":{"id":"p-0013","num":"0012"},"figref":["FIG. 1","FIG. 1"],"i":"b; "},{"@attributes":{"id":"p-0014","num":"0013"},"figref":["FIG. 1","FIG. 1"],"i":"a; "},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIGS. 2-2"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIGS. 3-3"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIGS. 8-8"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIGS. 10-10"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 12"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 15"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 16"},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 17"},{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 18"},{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 19"},{"@attributes":{"id":"p-0034","num":"0033"},"figref":"FIG. 20"},{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 21"},{"@attributes":{"id":"p-0036","num":"0035"},"figref":"FIG. 22"},{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 23"},{"@attributes":{"id":"p-0038","num":"0037"},"figref":"FIG. 24"},{"@attributes":{"id":"p-0039","num":"0038"},"figref":"FIG. 25"},{"@attributes":{"id":"p-0040","num":"0039"},"figref":"FIG. 26"},{"@attributes":{"id":"p-0041","num":"0040"},"figref":"FIG. 27"},{"@attributes":{"id":"p-0042","num":"0041"},"figref":"FIG. 28"},{"@attributes":{"id":"p-0043","num":"0042"},"figref":"FIG. 29"},{"@attributes":{"id":"p-0044","num":"0043"},"figref":"FIG. 30"},{"@attributes":{"id":"p-0045","num":"0044"},"figref":"FIG. 31"},{"@attributes":{"id":"p-0046","num":"0045"},"figref":"FIG. 32"},{"@attributes":{"id":"p-0047","num":"0046"},"figref":"FIG. 33"},{"@attributes":{"id":"p-0048","num":"0047"},"figref":"FIG. 34"},{"@attributes":{"id":"p-0049","num":"0048"},"figref":"FIG. 35"},{"@attributes":{"id":"p-0050","num":"0049"},"figref":"FIG. 36"},{"@attributes":{"id":"p-0051","num":"0050"},"figref":"FIG. 37"},{"@attributes":{"id":"p-0052","num":"0051"},"figref":"FIG. 38"},{"@attributes":{"id":"p-0053","num":"0052"},"figref":"FIG. 39"},{"@attributes":{"id":"p-0054","num":"0053"},"figref":"FIG. 39"},{"@attributes":{"id":"p-0055","num":"0054"},"figref":"FIG. 40"},{"@attributes":{"id":"p-0056","num":"0055"},"figref":"FIGS. 41-41"},{"@attributes":{"id":"p-0057","num":"0056"},"figref":"FIG. 42"},{"@attributes":{"id":"p-0058","num":"0057"},"figref":"FIG. 43"},{"@attributes":{"id":"p-0059","num":"0058"},"figref":"FIG. 44"},{"@attributes":{"id":"p-0060","num":"0059"},"figref":"FIG. 45"},{"@attributes":{"id":"p-0061","num":"0060"},"figref":"FIG. 46"},{"@attributes":{"id":"p-0062","num":"0061"},"figref":"FIG. 47"},{"@attributes":{"id":"p-0063","num":"0062"},"figref":"FIG. 48"},{"@attributes":{"id":"p-0064","num":"0063"},"figref":"FIG. 49"},{"@attributes":{"id":"p-0065","num":"0064"},"figref":"FIGS. 50-50"},{"@attributes":{"id":"p-0066","num":"0065"},"figref":"FIG. 51-51"},{"@attributes":{"id":"p-0067","num":"0066"},"figref":"FIGS. 52-52"},{"@attributes":{"id":"p-0068","num":"0067"},"figref":"FIGS. 53-53"},{"@attributes":{"id":"p-0069","num":"0068"},"figref":"FIG. 54"},{"@attributes":{"id":"p-0070","num":"0069"},"figref":"FIG. 55"},{"@attributes":{"id":"p-0071","num":"0070"},"figref":"FIG. 56"},{"@attributes":{"id":"p-0072","num":"0071"},"figref":"FIG. 57"},{"@attributes":{"id":"p-0073","num":"0072"},"figref":"FIG. 58"},{"@attributes":{"id":"p-0074","num":"0073"},"figref":"FIG. 59"},{"@attributes":{"id":"p-0075","num":"0074"},"figref":"FIG. 60"},{"@attributes":{"id":"p-0076","num":"0075"},"figref":"FIG. 61"},{"@attributes":{"id":"p-0077","num":"0076"},"figref":"FIG. 62"},{"@attributes":{"id":"p-0078","num":"0077"},"figref":"FIG. 63"},{"@attributes":{"id":"p-0079","num":"0078"},"figref":"FIG. 64"}]},"DETDESC":[{},{}]}
