---
title: Multi-phase file system restore with selective on-demand data availability
abstract: A selective restore technique for restoring file systems within computer systems provides on-demand access during the restore process, while preventing users from slowing the restore process by generating random accesses to files that have not yet been restored, early in the restore process. The restored files are grouped into multiple groups of files, which correspond to multiple phases of the restore process. On-demand requests may be locked out for some or all users during the first one or more phases of the restore, while they are permitted for the subsequent phases, ensuring that critical files needed by all users will be available before the backup process is interrupted by on-demand accesses. The groups are generally organized by elapsed time since last access or modification, and may be organized at restore time or during periodic back-up operations so that the files may be similarly organized in the backup media.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08204863&OS=08204863&RS=08204863
owner: International Business Machines Corporation
number: 08204863
owner_city: Armonk
owner_country: US
publication_date: 20091221
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","BRIEF SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE INVENTION"],"p":["1. Field of the Invention","The present invention is related to storage file systems within computer systems, and more specifically to a multi-phase system restore methodology that selectively provides on-demand data availability.","2. Description of Related Art","In large-scale computer systems, after a catastrophic event such as storage hardware failure, a total system failure, or when a software upgrade must be backed-out due to problematic changes to the operating system or other components of the software, a system restore may need to be performed. In the past, system operators and users had to wait until a complete file system restore was performed, before accessing any of the files contained in the file system. In a computer system with very large amounts of storage, the down-time associated with a system restore is significant and since operations in many organizational components of an entity may come to a halt with the file system off-line, e.g., accounting, order entry, etc., the costs associated with such system downtime can be very large.","U.S. Pat. No. 7,234,077 discloses techniques for providing on-demand access to files during a restore process, so that files within the file system can be accessed by users without waiting for the restore process to complete. However, random access of files during a restore process can be a very costly penalty, especially when the backup medium is a sequential-access medium such as magnetic tape. Therefore, a single user or program can slow down a restore process by requesting resources that require a tape unit to reposition, locate and retrieve the demanded file and then return to streaming the restore image. Further, in large storage file systems, the number of tape units may be less than the number of tapes that hold the backup image, and the requested file may be on an un-mounted tape volume, requiring a tape volume to be un-mounted, the tape containing the file mounted and then finally the original tape volume mounted again to resume the restore process. Even in a completely automated tape library, such a sequence can require several minutes to perform.","Therefore, it would be desirable to provide on-demand access to files within a file system during a restore process without introducing inordinate system delay and while supporting streaming of the file system backup image(s) from multiple volumes.","The invention is embodied in a computer-performed method, computer program product and computer system that provides selective on-demand file availability when restoring a file system within a computer system. The computer system is a computer system executing a program for carrying out the method and the computer program product is a program for carrying out the method.","The method copies files to restore a file system and selectively interrupts the copying to retrieve a file when an on-demand access to the file is made during the restore process. The files are organized into groups of files, and the copying is performed in multiple phases corresponding to each group of files. The copying is only interrupted to perform an on-demand access according to the group currently being copied and optionally based on a permission level of an entity making the request, so that a restore of critical files is not slowed down by users accessing files that have not yet been restored.","The criteria used for grouping the files is arbitrary and is selected by the file system administrator. For example, the selected criteria may be the elapsed time since the last access to or modification of the files, the owner of the files, the file name or the full directory path. The grouping may be performed during the backup operation, which allows the data to be pre-ordered to improve the streaming of the restored data. Alternatively, the grouping may be done during the restore operation to meet the requirements of the restored file system. As another alternative, the files can be grouped during the backup operation, but filtered during the restore operation to select a subset of the files in each group. For example, the restore might restore only files belonging to the initial workload scheduled for the restored file system.","The foregoing and other objectives, features, and advantages of the invention will be apparent from the following, more particular, description of the preferred embodiment of the invention, as illustrated in the accompanying drawings.","The present invention relates to computer backup and restore systems, and in particular to file system restore operations performed from multiple streaming devices. On-demand access to files is provided, but not arbitrary on-demand access as in previous techniques. In the present invention, certain portions of the restore process proceed while blocking or delaying on-demand access to files, which ensures that all essential files will be restored before users are permitted to slow the restore process by running applications or accessing data that require files that have not yet been restored and generating consequent on-demand requests for the required files. An administrative override may be provided that permits on-demand access to files for certain programs and\/or users even during a restore phase that would otherwise block on-demand access to files. The first phase of the file restore generally includes system files and\/or files known to be needed by applications that are frequently used.","Referring now to , a networked computer system in which an embodiment of the present invention is practiced is depicted in a block diagram. A workstation computer system  includes a processor CPU coupled to a memory MEM that contains program instructions for execution by CPU, including a virtual file system (VFS) interface A, which provides a native file system interface to the particular operating system executed by workstation computer system , for example the WINDOWS operating system. Workstation computer  is also depicted as including a graphical display Display and input devices Input Devices, such as mice and keyboards, for interacting with user interfaces including login screens and other user interfaces for interacting with other computers connected to the network, for example, administration screens for administering selection of the assignment of files to particular restore phases used by the techniques of the present invention, and to control or edit scheduling of the backup processes and initiate the restore processes of the present invention. Workstation computer system also includes a hard disc controller HDC  that interfaces processor CPU to local storage device A and a network interface that couples workstation computer system  to network , which may be fully wireless, fully wired or any type of hybrid network. VFS interface A provides a uniform set of application programming interfaces (APIs) that provide access to resources, such as local storage A or remote storage such as storage devices B and C, which are coupled to network  by network disc controller (NWDC) .","A server rack computer system , having at least one server memory SMEM and a server processor SCPU is also shown coupled to network . A different VFS client B is provided and executed within server rack  to provide suitable native APIs for accessing storage within server rack , networked storage devices B and C, as well as storage device A within workstation computer system , if storage device A is shared. A system configuration as is generally used with the present invention will include a large number of workstation computer systems such as workstation  and a large number of server racks such a server rack . Storage within such a computer system will also generally include large arrays of storage devices. However, the techniques of the present invention are not dependent on scale and therefore can be practiced within smaller system configurations, as well. A number of backup and restore devices A-D, e.g., magnetic tape drives, are coupled to network  for generating multiple backup\/restore images on media MEDIA, such as backup tapes, as will be described in further detail below. The backup operations of the present invention can be controlled by either or both of VFS client A and B or another process executing within server rack  workstation computer system  or another system coupled to network  including processes executing within controllers within networked storage devices B and C.","Network  may include wireless local area networks (WLANs), wired local-area networks (LANs), wide-area networks (WANs) or any other suitable interconnection that provides communication between workstation computer system  and server rack , storage devices A-C, and any other systems and devices coupled to network . Further, the present invention concerns backup and restore functionality that is not limited to a specific computer system or network configuration. Finally, the specification of workstation computer system  and server rack  and the location of their specific memory MEM and file system interface objects A and B does not imply a specific client-server relationship or hierarchical organization, as the techniques of the present invention may be employed in distributed systems in which no particular machine is identified as a server, but at least one of the machines provides an instance and functionality of a program or object that performs backup and restore operations in accordance with an embodiment of the present invention. The objects or interfaces process accesses according to methods and structures of the present invention, as described in further detail below.","Referring now to , a file system restore method in accordance with an embodiment of the present invention is illustrated in a flowchart. In the depicted method, a restore phase Pis first set to the initial phase P(step ). Prior to performing the restore operation, the file system name space is restored on the storage device(s) storing the file system, and may also include restoring the file attributes including access control lists (ACLs) associated with the files. Next, restore phase Pis started from multiple streaming restore sources (step ). During streaming of restore phase P, an on-demand access request is received for a file (step ). If phase Ppermits on-demand access (decision ), or a permission level of the entity requesting the on-demand access is sufficient to provide an administrative override (decision ), then a random access to retrieve the file out-of-order on one of the streams is performed on one of the devices (step ) and then borrowed stream\/device returns to streaming restore phase Ponce the file has been retrieved (step ). If phase Pdoes not permit on-demand access (decision ) and there is no administrative override (decision ), then the on-demand access request is denied or delayed until a later phase of the restore process (step ), depending on the program interface design. In either case, the on-demand access request can be re-asserted in a subsequent phase that will permit on-demand access, if the file has not already been restored at that time. Until the last restore phase Pis completed (decision ), phase Pis set to next phase P(step ), and steps - are repeated.","While the process depicted in  assumes that files are previously assigned to the various restore phases Pand it is advantageous to do so because the files can be arranged in order within the restore images, it is possible to select the files for each phase during the restore. For example, as illustrated in , which depicts another method in accordance with an embodiment of the invention, the restore may be performed from a continuous set of restore images, one corresponding to each of backup and restore devices A-D with the phases determined on-the-fly during the restore process, which may be according to file counts, an elapsed system time since the restore began or by observing file characteristics such as the time elapsed since modification or access as is alternatively used to partition the file system restore in phases Pduring backup as described above (step ). The restore phases can also be partitioned according to files needed execute particular applications and or partitioned according to other policy decisions that specify which files are more critical than others. The policies may be implemented in a policy language if the VFS includes such a feature. Once the information needed to apply the phase assignment policies has been gathered, for example, as a list of files to be backed up for each phase P, the backup process is commenced (step ) and the administrative policy is applied to group the files into phases P(step ). Then, backup images for each phase Pare generated (step ), which will also generally be multiple backup images for restoring via multiple backup devices. Therefore, each tape or other backup media will contain an image having a portion of the files for each phase Pso that the files for each phase Pcan be streamed from the multiple devices, increasing the speed at which the file system can be restored.","As mentioned above, if the backup process generates information that groups the files into phases P, as opposed to determining the phases P, on-the-fly during the restore process, then the backup process can also order the files on the tape or other media read by backup and restore devices A-D to improve streaming during the restore process. Also as mentioned above, the backup process can generate a single file system image that is striped across the multiple media volumes, or the backup process can partition the files for each phase across the multiple media volumes. In addition to the phasing of file copies\/file restore, attributes of the files may also be restored in phases. For example, attributes that may be quickly set without encountering long delays, e.g., attributes that are set in a file inode, may be set during the phase in which the files themselves are copied, while the setting of extended attributes that are stored separately is delayed until a later phase and in some embodiment, until all of the files have been copied.","Finally, it is not necessary to run a complete restore process in order to practice the techniques of present invention. For example, an administrator may choose to restore only one restore phase such as phase Pto restore critical files, and permit the remainder of the files to be restored via on-demand access requests. In particular, systems that employ a hierarchical storage manager generally do not include enough reserved hard drive space to store all of the data that is potentially available to the system. Therefore, the phased restore of the present invention can be used to restore a state, that while not exactly the file system state at the time the restore event was necessitated, generally includes the same frequently accessed files, while letting other files be loaded in an on-demand fashion from tape media. The grouping of the files into restore partitions may also be used for \u201cbatch\u201d processing, so that the files selected for a particular restore phase match the batch job that will be run after the particular restore phase has been completed, rather than a batch job that was running when the backup was made or when the file system was lost or damaged, necessitating the restore. The particular files needed for the next batch job might not have been recently accessed or modified when the previous backup was generated, but can be identified in the overall backup and selectively restored according to the necessity of these files for the next batch job.","While the invention has been particularly shown and described with reference to the preferred embodiments thereof, it will be understood by those skilled in the art that the foregoing and other changes in form, and details may be made therein without departing from the spirit and scope of the invention."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE SEVERAL VIEWS OF THE DRAWING","p":["The novel features believed characteristic of the invention are set forth in the appended claims. The invention itself, however, as well as a preferred mode of use, further objectives, and advantages thereof, will best be understood by reference to the following detailed description of the invention when read in conjunction with the accompanying Figures, wherein like reference numerals indicate like components, and:",{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 3"}]},"DETDESC":[{},{}]}
