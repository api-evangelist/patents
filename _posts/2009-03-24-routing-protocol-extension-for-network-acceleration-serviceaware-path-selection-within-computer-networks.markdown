---
title: Routing protocol extension for network acceleration service-aware path selection within computer networks
abstract: In general, techniques are described by which a path through a network may be selected based on service information. For example, a network device may include one or more interfaces, a control unit, and an integrated network acceleration device that provides a first set of services. The interfaces may receive service information that describes a second set of services provided by another network device. The control unit then determines, based on the service information, whether the other device shares any services in common with the integrated device. If so, the control unit selects a path through the network that includes the other device and causes the integrated device to apply the shared service to a portion of the traffic. The interfaces forward this portion along the determined path to the other device such that the other device applies the shared network acceleration services to the portion of the network traffic.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08094575&OS=08094575&RS=08094575
owner: Juniper Networks, Inc.
number: 08094575
owner_city: Sunnyvale
owner_country: US
publication_date: 20090324
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"p":["The invention relates to computer networks and, more particularly, routing network traffic within computer networks.","In a typical network environment, client devices request and download content stored within network servers. Exemplary content includes web pages that may contain one or more of text, graphics, video, and sound data. Other examples of content include files, multimedia data streams (e.g., audio or video data streams), electronic messages, and data tables. Upon receiving the content requests, the network servers typically retrieve the requested content, break the requested content into packets, and transmit the packets to the requesting client device. Routers and other network infrastructure direct these packets through the network to the client devices, which, in turn, reconstruct the content from the packets and present the content to users via applications residing on the client devices.","The network may experience a variety of issues that result in decreased download speeds at the client devices. These issues include a large volume of content requests to a single network server that overload or otherwise diminish the capacity of the network server to timely service the requested content. Moreover, network congestion and limited network bandwidth may impact client download speeds. To increase download speeds and reduce bandwidth consumption, a network administrator may deploy one or more intermediate network devices, referred to as network acceleration devices, located between the client devices and the servers. These intermediate network devices may apply one or more network acceleration services to network traffic passing between the client devices and the servers in order to address the above listed issues or other issues that adversely affect download speeds. In the respect, the intermediate network devices may seek to optimize delivery of data to and from the client devices.","In general, techniques are described by which intermediate network devices within a network perform route resolution and path selection based on information that describes network acceleration services offered by network acceleration devices deployed throughout the network, such as standalone Wide Area Network (WAN) acceleration (X) devices (which may be referred to as \u201cWX devices\u201d) and routers having integrated network acceleration devices. This service-aware path selection may be achieved by the network acceleration devices exchanging network acceleration service information that describes the type of acceleration services provided by each respective one of the devices. Moreover, the network acceleration devices may exchange information describing their individual amount of resources available to provide the services, e.g., a number of connections to which acceleration services may be applied as defined by a license, hardware capabilities, software versions, and the like. The information may also describe the current utilization of those resources with respect to acceleration services, e.g., a number of connections to which the acceleration services are currently being applied. In this respect, each network device may receive network acceleration service information that describes both the network acceleration services each device provides and the available bandwidth or resource utilization currently available by each respective device to provide the indicated services. The network acceleration devices may implement a modified routing protocol so as to opaquely embed the service information in routing communications exchanged by way of a routing communication session.","Upon exchanging the service information, each network acceleration device within the network may maintain a database detailing service information for each network acceleration device within the network or network system. The collection of service information may be organized in the form of a service topology representing the network acceleration devices and their differing acceleration services. Each network acceleration device utilizes the database of service information and the defined service information topology when performing route resolution and selection of paths through the network along which to forward traffic. Based on the service topology, for example, each network device may form adjacencies with other acceleration devices so as to engineer traffic paths through the network that flow through particular network acceleration devices, thereby allowing the network acceleration devices along to path to apply the desired acceleration services to network traffic. Moreover, the path selection may be based on the type of network acceleration services applied by the different network acceleration devices relative to the particular type of traffic, as well as, the acceleration services provided by the network acceleration device selecting the path. Path selection may also be based on the current utilization of the resources of each network acceleration device to provide a certain amount or form of load balancing.","As a result, the network acceleration devices may perform constraint-based routing to actively select a path through the network by which to forward traffic so as to facilitate the application of acceleration services. Considering that application of acceleration services often requires a pair of network acceleration devices to cooperate, e.g., one device to compress the traffic and another device to decompress the traffic, the techniques may select a path between these pairs so as to ensure the pair of network acceleration devices provides at least one common acceleration service by which to accelerate traffic. In this respect, rather than select a path based solely on a number of hops or some other conventional path selection criteria that may lead to randomly assigned pairs or adjacencies of network acceleration devices, the techniques may enable network acceleration devices to actively select a path that includes one or more pairs of network acceleration devices that share at least one network acceleration service.","Moreover, the path selection techniques may base path selection on the type of traffic and whether the shared service applies to the particular type of traffic. Further still, the service-aware path selection techniques may base path selection on the resource utilization and therefore provide a form of load balancing so as to ensure adequate utilization, e.g., neither over-utilization nor under-utilization, of network acceleration devices. The techniques may also enable network administrators to more freely deploy network acceleration devices within the network, as these devices (either dynamically or via administrator configuration) may perform traffic engineering based, not only on link connectivity information (e.g., link state or learned routes), but on the learned service information as well. The network acceleration devices, again by virtue of utilizing service information during path selection, may select a path through multiple network acceleration devices that provide different types of acceleration services so as to layer application of two or more acceleration services.","In operation, a router may comprise an integrated network acceleration device that includes a service engine. The router may be viewed as logically having three different functional planes, a forwarding plane for forwarding packets, a routing plane for executing routing sessions and maintaining a routing topology of the network, and a service plane for providing additional services to the packets. A control unit or other processing unit may implement both the forwarding and the routing planes. The service plane may be coupled to the routing plane via a switch or other form of high-speed backplane, where the service plane may include one or more service cards. The service card, in this instance, may implement the integrated network acceleration device and may be referred to as a \u201cWX service card\u201d for this reason. The WX service card may comprise or implement the service engine that applies one or more network acceleration services. While described herein with respect to a router having an integrated network acceleration device, the techniques may also apply to stand-alone network acceleration devices, such as stand-alone WX devices, and should not be limited to the exemplary embodiments set forth below.","Initially, the routing engine implemented by the control unit may determine first service information that describes a first set of acceleration services provided by a first service engine included within the WX service card. The routing engine may implement a so-called \u201cservice\u201d Application Programming Interface (API) to communicate with the service plane and determine the service information. The routing engine, meanwhile, may also receive second service information that describes a second set of acceleration services provided by a second service engine included within a different adjacent or second router. The routing engine may implement one or more protocols of a class of protocols referred to as Interior Gateway Protocols (IGPs) by which to receive this second service information. For example, the routing engine may implement an Open-Shortest Path First (OSPF) protocol by which to receive this second service information.","Specifically, the routing engine may receive this second service information via a Link State Advertisement (LSA) in accordance with the implemented one or more IGPs, such as OSPF. This LSA may include the second service information as opaque information, which as the name suggests may refer to information that is hidden from those network devices within the network that do not understand the service information. For this reason, the LSA may be referred to as an \u201copaque LSA.\u201d In any event, the routing engine may store both the first and second service information to a database included within the routing engine as the above described service topology. The routing engine may also receive other LSAs, opaque or otherwise, in accordance with the one or more implemented IGPs, such as OSPF, that include link information describing a state of each link within the network, as well as, possibly an available bandwidth of each link, which may be used for traffic engineering purposes. This routing engine may store this link information to this or another database as a network topology.","After performing this initial initialization phase whereby the routing engine determines and stores both the service and the network topology, the routing engine may enable the forwarding plane to begin receiving packets. The forwarding plane may comprise one or more interface cards, also coupled to the control unit by the switch or other high-speed backplane, that receive a packet, which includes a destination to which the packet is destined. The control unit may implement the forwarding plane as a forwarding engine comprised of a flow control unit. The flow control unit may determine a flow to which the packet corresponds. If determined to be a new flow, e.g., a flow for which the flow control unit has not yet received a packet, the flow control unit forwards the packet to the routing engine, which classifies the packet to determine an application to which the packet corresponds. An application as used herein refers to a protocol of Layer 7 (L7) of the Open System Interconnect (OSI) model, such as a HyperText Transfer Protocol (HTTP), a Session Initiation Protocol (SIP), or a File Transfer Protocol (FTP). While described herein as classifying the packet as corresponding to a particular application, the routing engine may classify the packet as corresponding to any type of packet, wherein the type may refer to a L3 protocol, a particular pattern or any other classifiable characteristic of the packet.","Upon classifying the packet, the routing engine may then identify at least one of the first set of accelerations services to apply to the packet based on the determined application to which the packet corresponds. The routing engine may maintain a service configuration that is keyed by application types and the routing engine may access the service configuration to determine the at least one of the first set of acceleration services. This service configuration may be input by an administrator or other network user. The routing engine, using the identified at least one of the set of network acceleration services as a key, determine whether the second set of acceleration services described by the second service information shares the identified at least one of the first set of acceleration services. In other words, the routing engine may attempt to pair the integrated WX service card with the second router, or more particularly, the second WX service card integrated within the second router. In the respect, the routing engine of the first router may intelligently select WX device adjacencies based on the service information.","Based on a determination that the second router shares at least one service in common with the identified at least one services described by the first service information, the routing engine may select a path through the network that includes the second router. The routing engine may, in order to select the path, provide an address associated with the second router to the one or more IGP protocols, which may perform a form of \u201cloose\u201d constraint based path selection to select the path through the second router. The routing engine may then, again via the service API, communicate with the WX service card to request that the WX service card negotiate a service connection over which the WX service cards of both the first and second routers may apply the determined one or more shared or common services.","Upon successfully negotiating the service connection, the routing engine may forward the packet back to the forwarding plane along with an update indicating to the forwarding plane that it should forward all packets associated with the same flow as that of the returned packet to the service plane. The update may also specify the one or more shared services. The forwarding plane may then forward the packet to the WX service card along with an indication of the one or more shared services, whereupon the first service engine may apply the indicated one or more shared services to the packet in order to accelerate delivery of the packet. The service card may then forward the accelerated packet back to the forwarding plane, which may, in turn, forward the accelerated packet along the determined path such that the second service engine included within the second WX service card of the second router applies the at least one shared acceleration service to reconstruct, from the accelerated packet, the packet forwarded via the path. In this manner, the router may intelligently select WX service adjacencies based on service information in order to perform service-aware path selection by which to more efficiently apply shared or common services rather than rely on conventional path selection techniques and correct placement of network acceleration devices to ensure efficient application of services.","In one embodiment, a method comprises determining, with a first router, first service information that describes a first set of acceleration services provided by a first service engine included within the first router, receiving, with the first router, a routing protocol message having second service information that describes a second set of acceleration services provided by a second service engine included within a second router, receiving, with the first router, a packet, wherein the packet identifies a destination to which the packet is destined and classifying, with the first router, the packet to determine a software application to which the packet corresponds. The method further comprises identifying, with the first router, at least one of the first set of accelerations services to apply to the packet based on the determined application to which the packet corresponds, determining, with the first router, whether the second set of acceleration services described by the second service information shares the identified at least one of the first set of acceleration services, based on the determination, invoking a protocol on the first router to select a path through the network that includes the second router, wherein the path includes a plurality of next hops from the first router to the destination, and wherein the first router selects the path through the network so that the second router is positioned along the path between the first router and the destination, based on the determination, applying, with the first service engine of the first router, the at least one shared acceleration service to the packet in order to accelerate delivery of the packet, and forwarding, with the first router, the accelerated packet along the determined path such that the second service engine of the second router along the path applies the at least one shared acceleration service to reconstruct, from the accelerated packet, the packet forwarded via the path.","In another embodiment, a first router included within a network comprises a first service engine that provides a first set of acceleration services, a control unit that determines first service information that describes the first set of acceleration services provided by the first service engine, and at least one interface card that receives a routing protocol message having second service information that describes a second set of acceleration services provided by a second service engine included within a second router and receives a packet that identifies a destination to which the packet is destined. The control unit further classifies the packet to determine a software application to which the packet corresponds, identifies at least one of the first set of accelerations services to apply to the packet based on the determined application to which the packet corresponds, determines whether the second set of acceleration services described by the second service information shares the identified at least one of the first set of acceleration services, and invokes, based on the determination, a protocol on the first router to select a path through the network that includes the other router, wherein the path includes a plurality of next hops from the router to the destination, and wherein the router selects the path through the network so that the other router is positioned along the path between the router and the destination. The first service engine applies the at least one shared acceleration service to the packet in order to accelerate delivery of the packet. The at least one interface card forwards the accelerated packet along the determined path such that the second service engine of the second router along the path applies the at least one shared acceleration service to reconstruct, from the accelerated packet, the packet forwarded via the path.","In another embodiment, a network system comprises a first network that includes a first router, wherein the first router includes a first service engine that provides a first set of acceleration services and a control unit that determines first service information that describes the first set of acceleration services provided by the first service engine. The network system further includes a second network that includes a second router, wherein the second router includes a second service engine that provides a second set of acceleration services. The first router further includes at least one interface card that receives a routing protocol message having second service information that describes the second set of acceleration services provided by the second service engine included within the second router and receives a packet that identifies a destination to which the packet is destined. The control unit further classifies the packet to determine a software application to which the packet corresponds, identifies at least one of the first set of accelerations services to apply to the packet based on the determined application to which the packet corresponds, determines whether the second set of acceleration services described by the second service information shares the identified at least one of the first set of acceleration services, and invokes, based on the determination, a protocol on the first router to select a path through the network that includes the other router, wherein the path includes a plurality of next hops from the router to the destination, and wherein the router selects the path through the network so that the other router is positioned along the path between the router and the destination. The first service engine applies the at least one shared acceleration service to the packet in order to accelerate delivery of the packet. The at least one interface card forwards the accelerated packet along the determined path such that the second service engine of the second router along the path applies the at least one shared acceleration service to reconstruct, from the accelerated packet, the packet forwarded via the path.","In another embodiment, a computer-readable medium comprising instructions for causing a programmable processor to determine, with a first router, first service information that describes a first set of acceleration services provided by a first service engine included within the first router, receive, with the first router, a routing protocol message having second service information that describes a second set of acceleration services provided by a second service engine included within a second router, receive, with the first router, a packet, wherein the packet identifies a destination to which the packet is destined, classify, with the first router, the packet to determine a software application to which the packet corresponds, and identify, with the first router, at least one of the first set of accelerations services to apply to the packet based on the determined application to which the packet corresponds. The instructions further cause the processor to determine, with the first router, whether the second set of acceleration services described by the second service information shares the identified at least one of the first set of acceleration services, based on the determination, invoke a protocol on the first router to select a path through the network that includes the second router, wherein the path includes a plurality of next hops from the first router to the destination, and wherein the first router selects the path through the network so that the second router is positioned along the path between the first router and the destination, based on the determination, apply, with the first service engine of the first router, the at least one shared acceleration service to the packet in order to accelerate delivery of the packet, and forward, with the first router, the accelerated packet along the determined path such that the second service engine of the second router along the path applies the at least one shared acceleration service to reconstruct, from the accelerated packet, the packet forwarded via the path.","The details of one or more embodiments of the invention are set forth in the accompanying drawings and the description below. Other features, objects, and advantages of the invention will be apparent from the description and drawings, and from the claims.",{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 1","b":["10","12","12","12","12","12","12"]},"As shown in , network system  includes a plurality of routers A-D (\u201crouters \u201d), each of which includes an integrated network acceleration device, such as least one service card that provides network acceleration services.  illustrates this integrated network acceleration device as Wide Area Network (WAN) acceleration (X) devices A-D (\u201cWXs \u201d) included within respective ones of routers . While described with respect to a router generally, in some instances, the techniques may be implemented by dedicated or stand-alone network acceleration devices separate from a router or other similar network device, such as a stand-alone Wide Area Network (WAN) acceleration (X) device or \u201cWX device\u201d for short. In these instances however, it should be noted that the WX device may perform routing functions and therefore may represent a router having an integrated acceleration device. As a result, while applicable to dedicated network acceleration devices, the techniques are described below with respect to routers having an integrated network acceleration device in the form of a service card for ease of illustration purposes, although the techniques may apply to stand-alone WX devices that provide reduced or limited routing functions to select paths through the network.","Referring again to , router A couples to each of Wide Area Networks A, B (\u201cWANs \u201d) via links A, B, respectively. Each of Routers B and C also couple to each of WANs A, B via links C, D, respectively. WANs  may each comprise a public or private network that is available for lease or purchase by private entities or businesses so as to couple remote locations and\/or networks together. Although not shown in  for ease of illustration purposes, WANs  may provide access to a public network, which may include any publicly accessible network, such as the Internet. Typically, the public network comprises a packet-based network that transmits packets according to an Internet Protocol (IP)\/Transmission Control Protocol (TCP).","Router A resides at the edge of a remote or branch network . Likewise, routers B, C each resides at the edge of an enterprise or campus network . Branch network  may represent a small network used by a remote location or office of a large enterprise or business. Branch network  may comprise a local area network (LAN) that operates according to one of the family of Institute of Electrical and Electronics Engineers (IEEE) 802.X Ethernet standards. Campus network  may represent a larger network used by the main office or location of the large enterprise or business. Campus network  may also comprise a LAN that operates according to one of the family of IEEE 802.X Ethernet standards. Typically, data and other resources, such as templates, documents, manuals, accounting figures, employee information, applications, and any other information or application pertinent to operation of both the remote and main offices of the large enterprise, are stored in a centralized location.","Campus network  also includes a data center , which may provide a centralized location for the storage of the above described data, applications, and other resources. Data center  may represent a plurality of servers, which may each store in a centralized fashion the above described data, applications, and other resources. This data and other resources may be referred to herein generally as \u201ccontent.\u201d That is, data center  may include one or more data servers, web servers, application servers, databases, computer clusters, mainframe computers, and any other type of server, computing element, and\/or database commonly employed by an enterprise or business to facilitate the operation of the enterprise or business. These servers and\/or databases may comprise \u201cblades\u201d or other cards that are inserted into large racks. The racks may provide a common backplane or switch fabric to interconnect the various servers and\/or databases to one another, as well as, to campus network .","Data center  may support one or more of a variety of protocols or software interfaces by which these servers of data center  may serve the content. Exemplary protocols or software interfaces include a HyperText Transfer Protocol (HTTP), a Common Internet File System (CIFS) protocol, a File Transfer Protocol (FTP), a Secure Socket Layer (SSL) protocol, a Messaging Application Programming Interface (MAPI), a Transmission Control Protocol (TCP), and a Session Initiation Protocol (SIP).","By connecting to campus network , data center  may be accessible by any devices included within campus network  and any devices, e.g., one or more of a plurality of endpoint devices A-N (\u201cendpoint devices \u201d), of branch network . Each of endpoint devices  may comprise a laptop computer, a desktop computer, a workstation, a mainframe computer, a personal digital assistant (PDA), a cellular phone, a smart phone, or any other device capable of accessing a network. Campus network  may provide such a centralized location for the storage of data, applications, or other computing resources to reduce costs associated with distributed data storage.","Distributed data storage architectures typically required each location to maintain its own separate database or server for use in storing data pertinent to each respective location. For example, assuming, for purposes of illustration, that campus and branch networks  and  implemented distributed data storage, branch network  may also have included a remote data center, e.g., servers similar to data center , for storing data and other resources or content pertinent to the operation of the branch office. In this distributed data storage example, data center  would usually only store and serve content pertinent to the operation of campus network .","As network infrastructure lies in both of networks  and , the enterprise or business may be required to have dedicated Information Technology (IT) staff at both the remote location, e.g., the branch office, and the main location, e.g., the main office, to service both the remote and central data centers, which may increase expenses. Even if no dedicated IT staff is provided for servicing the remote data center, the enterprise may be required to send IT staff to the remote location, e.g., branch network , to service the remote servers, which may increase costs and otherwise impinge upon the operation of the branch office. Moreover, issues, e.g., data loss, may arise when the data and other resource or, more generally, the content of branch network  needs to be synchronized with content stored to data center  of the main office or campus.","Centralized storage of the content, however, reduces, if not eliminates many of these issues by placing all of the equipment necessary for data storage within a centralized location that is easily accessible by a dedicated and centrally located IT staff. Furthermore, as a result of next generation Internet network acceleration services and web development, centrally located data center  may serve web-based applications that enable remote users to access data and other resources stored to data center  through a web-browser executed by each of endpoint devices . Because only a web-browser is required, branch offices may no longer require dedicated IT staff on site. Moreover, because content may be deployed remotely, the IT staff need not travel to the remote office. Again, by virtue of centralizing the content, IT costs may be significantly reduced. As a result, centralized data centers, such as those in which data centers  may each resides, are setting the standard by which large enterprises or businesses store and maintain data, as well as, remotely distribute new and update old applications.","While centralized storage of content may decrease costs, this centralized architecture typically requires that branch network  maintain access to campus network . Commonly, large enterprises or businesses may lease or purchase a dedicated line or connection that couples branch network  and campus network  together to ensure privacy or otherwise prevent unauthorized access to networks  and . A network service provider may lease or sell this line to the enterprise or business and usually charges various prices depending on the speed and\/or bandwidth of the line. For example, a service provider may offer for lease a digital signal 1 (\u201cDS1\u201d) or T-carrier 1 (\u201cT1\u201d) line (e.g., a dedicated line having 1.536 mega-bits per second of bandwidth) for a first price per month and a DS3 or T3 line (e.g., a dedicated line having 44.736 mega-bits per second of bandwidth) for a second, higher price per month. Depending on the bandwidth required between branch network  and campus network , the enterprise or business may choose either to purchase one or more of either or both the T1 or T3 line.","For purposes of illustration, it is assumed that links A-D (\u201clinks \u201d) are leased or purchased from one or more network service providers that own and operate WANs , e.g., the above mentioned AT&T and Verizon. Notably, the term \u201clink\u201d may used herein to refer to the physical connection (such as the cables or other communications mediums running between one or more central offices of WANs  and networks , ), while \u201cline\u201d refers to a service (such as a T1 line or T3 line) carried by the link. Often, however, the terms are used interchangeably as a T1 or T3 line generally accompanies the leasing of one or more links. That is, a customer may request a T1 line service and, as part of that service, the service provider leases a dedicated link to the customer as part of providing the T1 line service. As a result, links  may also be referred to herein as \u201clines .\u201d","Considering that bandwidth concerns may, in part, control the selection of lines, the business or enterprise may attempt to reduce the bandwidth required between branch network  and campus network  in order to, again, reduce costs by enabling the enterprise to subscribe to a line that provides (and lease a link capable of supporting) less bandwidth. To this end, branch network  and campus network  may update one or more respective intermediate network devices, e.g., routers A-C, with an integrated network acceleration device, e.g., WXs A-C, to reduce bandwidth consumption through application of one or more network acceleration services to traffic traversing WANs .","Network acceleration services may include any action by WXs A-C to improve performance of network system , e.g., by reducing bandwidth consumption and thereby increase available bandwidth. In other words, network acceleration services may include, for example, caching of content, compressing packets or other discrete data units of the network traffic, application acceleration, or any combination of the above, as well as, any other action that improves network performance. Example data compression network acceleration techniques are described in U.S. Pat. No. 7,167,593, entitled \u201cSYSTEM AND METHOD FOR INCREMENTAL AND CONTINUOUS DATA COMPRESSION\u201d, issued Jan. 23, 2007, incorporated herein by reference.","These integrated network acceleration devices, e.g., WXs A-C, may represent proxy devices that divide each TCP or other protocol sessions into three discreet TCP session: (1) a first TCP session having terminations at an endpoint device  and WX A, (2) a second TCP session having terminations at WX A and WXs B for example, and (3) a third TCP session having terminations at either of WXs B and data center . In this respect, WXs  may represent TCP proxies that apply network acceleration services to the second or intermediate TCP session. The various TCP sessions may therefore represent TCP tunnels between the various devices.","That is, endpoint device A may intend to establish a single TCP session with a particular destination, e.g., a server of data center , by which to access content stored to that destination. WX A may intercept this TCP session request and reply to the session as if WX A was the intended destination, thereby establishing the first TCP session or tunnel of the three. WX A may then establish a second or intermediate TCP session with WX B, which may then establish a third TCP session with data center . As a separate TCP session exits between WXs A, B, these WXs A, B may apply network acceleration services to optimize delivery of data and traffic destined for and received from data center  without interfering with the first and second TCP sessions.","The integrated network acceleration devices, e.g., WXs A, B, may, for example, locally cache content previously requested by a client device, such as one or more of endpoint devices , in order to optimize (or reduce if not eliminate) bandwidth consumption directed to subsequent requests for the same data. That is, WX A may, instead of issuing the request for the same content previously requested possibly by another one of client devices  and thereby consuming bandwidth, cache the previously requested content and, without sending the request to data center  or the public network, service the request using the locally cached content, thereby preserving bandwidth.","The intermediate network devices, e.g., WXs A, B, may also communicate with one another via the second TCP session so as to optimize or compress traffic, and thereby reduce bandwidth consumption, by replacing identified sequences of data with, for example, symbols, where the symbols represent the respective identified sequences using fewer bits. Often, these compression services require pairs of WX devices, such as WXs A, B, where one compresses the traffic and the other un-compresses the traffic. WX A may, for example, apply a compression service that compresses the network traffic according to one of a plurality of compression algorithms, while WX B applies the same compression service to uncompress the traffic. Each of the plurality of compression algorithms may be tailored to a specific type of layer seven (L7) network application, e.g., a HyperText Transfer Protocol (HTTP) application, Skype, Telnet, FTP or a specific transport layer protocol (TCP) and each may represent a particular compression service. Consequently, different network acceleration devices (WXs ) may apply different acceleration services for different types of network traffic.","WXs A, B may also apply an application-specific acceleration service having a particular algorithm designed to accelerate or optimize the retrieval of content for a specific network application. For example, an HTTP acceleration service may enable more efficient retrieval of HyperText Markup Language (HTML) pages. Typically, each HTML page comprises a plurality of objects, e.g., images, templates, Java Scripts, etc., and WX A may apply an HTTP acceleration service to each HTML request to more efficiently download the plurality of objects, thereby \u201caccelerating\u201d the retrieval of HTML pages requested via HTTP.","To determine an application to which each packet belongs, integrated network acceleration devices A, B may classify each packet of the network traffic as belonging to a particular application and\/or protocol and apply one or more corresponding network acceleration services (e.g., caching, compression, or application-specific acceleration) to improve network performance. In this manner, WXs  may apply network acceleration services to improve the performance of network system .","In the example of , WX A may communicate with WX B via one of a plurality of paths A, B to apply network acceleration services. A \u201cpath,\u201d as used herein, may refer to one or more links, such as links , by which an intermediate network device may connect to another intermediate network device. For example, path B comprises a direct connection between WX A to WX B via links B, D. Path A comprises an indirect connection between WX A to WX B, as a third intermediate network device, e.g., router D, lies along path A between WX A and WX B. Path A may be referred to as a \u201cconnecting path\u201d in that path A comprises at least one connecting hop through a third intermediate network acceleration device D positioned between WXs A, B. Path A may also be referred to as an \u201cindirect path\u201d for similar reasons. Path B may be referred as a \u201cdirect path\u201d in that WX A couples directly (e.g., without connecting or coupling to any intervening third network acceleration devices) to WX B.","That is, path A may represent a path through a WAN in which at least one intermediate network acceleration device capable of applying optimization or network acceleration services lies. Path A, for example, may comprise a path through WAN A in which WX A couples to WX D via link A and WX D couples to WX B via link C. As application of services may require pairs of WX devices, a path may comprise one or more pairs of WX devices, where each pair applies a different set of network optimization or acceleration services. Path A, for example, may comprise a first pair of intermediate network acceleration devices, e.g., WX A and WX D, applying a first set of services and a second pair of intermediate network acceleration devices, e.g., WX D and WX B, applying a second set of services. WX D may apply substantially similar set or different set of optimization or network acceleration services to those described above with respect to WXs A, B. While shown as only comprising a path having one connecting hop to a single intermediate network acceleration device or WX D, path A may comprise a plurality of connecting hops to a plurality of intermediate network acceleration devices similar to that of WX D, where each pair of intermediate network acceleration devices may apply one or more network optimization or acceleration services.","Path B, however, may represent a path through a WAN, or other network, in which a first network acceleration device and a second intermediate network device directly couple to one another without any other intermediate network acceleration device lying along the path. That is, path B may, as shown in the example of , comprise a path through WAN B in which WX A couples to WX B directly via links B, D. While shown as comprising two links, path B may comprise any number of links so long as none of those links route through an intermediate network acceleration device similar to that of WX D capable of providing network acceleration services, otherwise, path B may not be representative of a \u201cdirect\u201d path.","As further shown in the example of , WX A may also couple to WX C via one or more of paths C, D. Path C may be similar to path A in that path C represents an indirect or connecting path by which WX A connects to WX C via the same connecting hop of WX D. Path D may be similar to path B in that path D represents a direct path connecting WX A to WX C without any intervening connecting hop involving an intermediate network acceleration device.","Generally, these paths  may each comprise one or more \u201chops\u201d arranged in a series, where a \u201chop\u201d refers to a traversal of a single link along the path. In other words, each of paths  may comprise one or more links from a given source to a given destination within network system . Each hop of paths  may identify, usually by an address, a network device that terminates each link included within the path. Routers  may implement a routing protocol to select these paths through the network by communicating information concerning these hops or the links interconnecting the hops to one another.","For example, in accordance with a class of routing protocols referred to as \u201clink state routing protocols,\u201d routers  may exchange information concerning states of links to which each of routers  couple. An example link state protocol may include an Open Shortest Path First (OSPF) routing protocol. In accordance with the OSPF routing protocol, routers  may exchange Link State Advertisements (LSAs) that describe the state of these links to which each of routers  couple.","An exemplary LSA may describe the state of each link by specifying link state information that includes information concerning a destination or \u201cnext hop\u201d reached by the link, a cost associated with each link (e.g., bandwidth each link supports), as well as, whether the link is up (e.g., active) or down (e.g., inactive). Routers  may propagate the LSA from one another such that each of routers  may maintain link state information concerning all of the links within network .","From this link state information, routers  may construct a topology of network system . This topology constructed based on the link state information may be referred to as a \u201cnetwork link topology\u201d or simply, \u201clink topology\u201d or \u201cnetwork topology.\u201d The network topology may comprise a graph data structure, whereby each link forms a corresponding edge of the graph and each destination or hop to which each link connects forms a node of the graph. Routing devices, such as routers , may maintain this network or link topology in a database.","Routers  may utilize this link topology to resolve paths through network  by traversing the graph data structure and selecting the series of one or more hops that form the path. Often, when resolving paths, hops may be referred to as the \u201cnext hop\u201d in that a path may be resolved by iteratively selecting, from a given source, the \u201cnext hop\u201d along the path until a given destination is reached. In accordance with the OSPF routing protocol, routers  may resolve paths through network system  by traversing the graph to construct a shortest path tree data structure using a method derived from Dijkstra's algorithm. A shortest path tree data structure may represent a sub-graph of the graph or network topology that is constructed such that the distance between the selected node, e.g., one of routers , and the one of routers  constructing the short path tree is minimal. While constructing the shortest path tree, each of routers  may prefer paths with lower associated costs to resolve any two or more paths that comprise the same distance to one of the other nodes. That is, if two paths between the selected node and one of the other nodes comprise the same distance, e.g., number of hops, the path to the one of the nodes may be resolved by selecting the path with the lowest overall cost.","One or more of routers  may also implement an extension to the routing protocol that facilitates traffic engineering. Traffic engineering refers to a process whereby dynamic properties are considered during the path selection process. For example, a Traffic Engineering (TE) extension to the OSPF protocol, with the combined result referred to commonly as an OSPF-TE routing protocol, may facilitate traffic engineering within the OSPF protocol. Typically, those of routers  that implement the OSPF-TE protocol transmit these dynamic link properties, such as a maximum reservable bandwidth property, a reserved bandwidth property, and\/or an available bandwidth property, via an opaque LSA. An \u201copaque LSA\u201d refers to an LSA that includes fields of information for a particular extension of a link state protocol, such as the TE extension, where those network devices that do not implement the extension may opaquely forward the information particular to the extension without otherwise processing or acknowledging the presence of this information in the LSA.","Regardless of how these dynamic link properties are communicated, those of routers  that implement the OSPF-TE protocol may dynamically update the network topology based on these dynamic link properties. These routers  may then engineer the forwarding of traffic by selecting paths through network system  based on the current state of the links as represented by the dynamic link properties. If a link for example along a selected path becomes congested, e.g., the available bandwidth property for that link indicates a low available bandwidth, those of routers  that implement the OSPF-TE protocol may reroute one or more paths around the congested link to alleviate the congestion and thereby dynamically improve performance with network system . In this manner, those of routers  that implement the OSPF-TE protocol may perform \u201ctraffic engineering\u201d based on dynamic link properties to alleviate congestion within network system .","In accordance with the principles of the invention, one or more of routers  may perform the service-aware path selection techniques to generally select paths through network system  based on service information that describes network acceleration services provided by one or more of integrated WX devices . These service-aware path selection techniques may augment standard path selection of the routing protocol, as describe above, such that those of routers  that implement the service-aware path selection may perform constraint-based routing to select paths based not only on the link state information (as represented by the network topology) but also on the network acceleration service information. In this respect, routers  may become \u201caware\u201d of services provided along each of paths  through the network system and are able to select paths such that one or more integrated network acceleration devices  apply network acceleration services to network traffic traveling the particular path.","For example, a first network device, such as router A, may receive service information that describes a set of one or more network acceleration services provided by a network acceleration device B integrated within router B of campus network . WX device B, as described above, is integrated within a second router, router B, different from router A. This service information may include an identifier assigned to either WX B or router B, such as an IP address or Media Access Control (MAC) address, and one or more of the above described network acceleration services provided by WX B. Router A may receive this service information using a link state protocol, such as the above described OSPF protocol, that has been extended in accordance with the techniques described herein so as to include the additional network acceleration service information. Moreover, router A may receive this service information via an opaque LSA, where the service information is embedded within an opaque field of the opaque LSA, similar to the dynamic link properties described above. This opaque LSA that includes service information in an opaque field may be generally referred to herein as a \u201cservice LSA.\u201d More specifically, as this service LSA provides information concerning network acceleration services, this LSA may be referred to as an \u201cacceleration service LSA\u201d or a \u201cnetwork acceleration service LSA.\u201d","Router A may then, upon receiving this security information via the service LSA, construct a service table that comprises a plurality of entries, one for each of the plurality of WX devices . This table, in other words, may include an entry for WX A that is integrated within router A. In this respect, a routing engine or other control component or control unit of router A may poll or otherwise determine a set of one or more network acceleration services provided by WX A integrated within router A. This aspect of the invention is described below in more detail with respect to . Briefly, however, the routing engine of router A may, for example, implement an Application Programmer Interface (API) by which to interface with WX A, where one such API function or command may enable the routing engine to poll or otherwise determine the set of network acceleration services provided by WX A integrated within router A. Router A, upon learning or otherwise determining this set of network acceleration services may store this service information to a corresponding entry of the \u201cservice\u201d table.","Accordingly, each entry may store service information for a corresponding one of the plurality of WX devices . This service table may represent a \u201cservice topology\u201d or \u201cnetwork acceleration service topology\u201d that defines the services, resources and location of devices within the network that are capable of providing network acceleration services. Router A may maintain the service topology as an additional layer of information on top of the network topology. Router A may utilize the service topology in conjunction with the network topology to determine and then select one of paths  through the network. For example, the service information is injected into the routing protocol as a constraint for inclusion within constraint-based routing and path selection.","Once selected, router A may determine whether the selected path exists and, if not, establish the path via a protocol, such as a Multi-Protocol Label Switching (MPLS) signaling protocol or a proprietary point-to-point path signaling protocol. Examples of MPLS signaling protocols include a Label Distribution Protocol (LDP) and a resource reservation protocol (RSVP). In LDP, the established path is referred to as a \u201cLabel Switched Path\u201d or \u201cLSP,\u201d and paths , as shown in , may be referred to as LSPs A-D (\u201cLSPs \u201d). LSPs  may also be generally referred to as a Multi-Protocol Label Switched (MPLS) path, as LDP comprises one protocol of the suite of MPLS protocols.","As shown in , router A may determine or select paths  through network system  based on the service topology. Router A may, in some instances, determine or select one or more of paths  dynamically, automatically, or without administrative input by overlaying the service information or topology on top of the network topology and thereby leverage the path selection process of the traffic engineering protocols, such as the OSPF-TE protocol, to perform the service-aware path selection techniques described herein. Alternatively or in conjunction with this dynamic path selection, one or more of paths  may be configured or provisioned statically by an administrator. Often, one or more of paths  are dynamically determined, such as path A, while another path, such as path B, is statically provisioned as a backup to path A (thereby possibly providing so-called \u201chigh availability\u201d).","In instances where paths  are dynamically determined, router A may determine or select one of paths  based on service information learned from each of routers B-D concerning one or more network acceleration services provided by WX devices B-D integrated within respective edge routers B-D. Router A may also determine or select this one of paths  based on service information determined for its own integrated WX A. Router A may select one of paths  based on both the service information determined for or learned from WX A and the service information learned from each of router B-D due to the paired nature of network acceleration services described above. That is, network acceleration services often require a pair of WXs  to cooperate in order to successfully accelerate network traffic via the intermediate or second TCP connections represented by paths .","As a result, router A may first determine the set of network acceleration services provided by WX A. Next, router A may access the service table or database to determine whether the set of acceleration services provided by WX A shares at least one acceleration service in common with the set of acceleration services provided by each respective one of WXs B-D. If no network acceleration services are shared between WX A and one of WXs B-D currently being analyzed, router A may eliminate the corresponding one of routers B-D. If, however, one of WXs B-D currently under analysis shares at least one network acceleration service in common with WX A, router A may store or otherwise identify these \u201ccommon\u201d WX devices. Router A may, for example, store an IP address of those routers B-D in which these common ones of WXs B-D are integrated.","Router A may then return one or more addresses identifying one or more of routers B-D that satisfy this common network acceleration service criteria. In some instances, the service information maintained by router A may indicate an available bandwidth property or some other dynamic property, similar to those described above for the OSPF-TE extension, related to the utilization of each of the plurality of WXs . For example, the service information learned for each of WXs  may define total resources as a number of connections to which network acceleration services may be applied by the corresponding one of WXs  (e.g., as defined by a license) and the utilization of those resources as a number of connections to which the corresponding one of the network acceleration services are currently being applied by the corresponding one of the WXs . Router A may then select one or more routers B-D through which to route network traffic based not only on the network acceleration services provided by each of WXs  but also on the resource availability or more generally utilization of each corresponding one of WXs . In this respect, the techniques may enable a form of load balancing.","After determining those of WXs B-C that are \u201ccommon\u201d to WX A and the corresponding addresses of routers B-D in which these common WXs are integrated, router A may resolve the network topology to determine one of paths  through network system  that flows through the identified addresses according to the traffic engineering protocol. That is, router A may determine or select one of paths  that flows through the identified one or more of routers .","As an example, router A may receive network traffic destined for data center  of campus network  from one or more of endpoint devices  and identify a type of at least a portion of the network traffic. This type may refer to a protocol to which the portion of the network traffic corresponds, such as a HyperText Transfer Protocol (HTTP), a Session Initiation Protocol (SIP), a File Transfer Protocol (FTP), or any other application layer protocol, where \u201capplication layer\u201d refers to layer seven (L7) of the Open Systems Interconnect (OSI) networking model. Often, these L7 protocols are referred to as an \u201capplication\u201d for short and router A may therefore determine an application to which portions of the received network traffic corresponds. While described herein with respect to application layer protocols, the techniques may apply to protocols of other layers of the OSI model.","Router A may determine the application or type by applying protocol decoders in a manner similar to that described above with respect to WX A. Alternatively, router A may forward the network traffic to WX A to identify the various types of corresponding portions of the received network traffic. In any event, router A may determine that a portion of the network traffic corresponds to a given application and then determine whether WX A provides any network acceleration services capable of accelerating the determined type of network traffic. If not, router A may forward this portion of the network traffic without otherwise forwarding the portion of the network traffic to WX A or even so much as selecting one of paths , as WX A is not capable of applying any network acceleration services to accelerate the determined type of network traffic.","However, if determined to provide at least one network acceleration service capable of accelerating the determined type of network traffic, router A may access the service topology to identify one or more of WXs B-D that share or provide this same or common network acceleration service as described above. Router A may identify, for example, that WX B provides this common or shared network acceleration service and return an IP address identifying router B. Router A may then access the network topology and resolve path B in accordance with a traffic engineering protocol based on the returned IP address associated with router B. Router A may establish this path B through network system . Next, router A forwards this portion of the network traffic to WX A and instructs WX A to negotiate application of the identified common network acceleration service with WX B, as is commonly required to apply such paired or shared network acceleration services.","This negotiation usually occurs via a Universal Datagram Protocol (UDP) or TCP session, such as the above described second TCP session. WX A may include information within packets that initiate the session requesting application of the common services. WXs A, B may, in this respect, negotiate application of the identified common network acceleration services while establishing the second TCP session or via an alternative UDP control session.","Assuming for purposes of illustration that this negotiation succeeds, WX A may apply the identified network acceleration service. In this respect, router A applies by way of WX A the at least one shared acceleration service to at least a portion of the network traffic destined for the destination of the selected path in order to accelerate delivery of the portion of the network traffic. Router A may then forward this accelerated portion of the network traffic to router B via established path B over the established second TCP session. Router B may receive this portion of the network traffic and, by virtue of the forgoing negotiation and association of the services with the second TCP session, apply the shared network acceleration service to reconstruct, from the accelerated portion, the portion of the network traffic forwarded via path B. In other words, router A forwards the accelerated portion of the network traffic along determined path B such that router B along the path applies the at least one shared acceleration service to reconstruct, from the accelerated portion, the portion of the network traffic forwarded via the path. After reconstructing or applying the shared network acceleration service to the portion (which may be better stated as applying an inverse version of the shared network acceleration service), router B may forward the reconstructed portion of the network traffic to its intended destination within campus network , e.g., data center , via the above described third TCP session.","As another example, router A may receive the network traffic destined, again, for data center  from one or more of endpoint devices  via the above described first TCP session and for another or second portion of the network traffic identify the type of this other or second portion of the network traffic in the manner described above. Router A may next access the security topology to determine first whether WX A provides a network acceleration service capable of accelerating the identified type of traffic and second, assuming WX A provides such a service, whether any one of WXs B-D provide the same network acceleration service as that required to accelerate the identified type of service. Again, these WXs B-D that provide this same service may be referred to as \u201ccommon\u201d WXs in that these pairs of WXs, e.g., WX A and each those common WXs, have this service in common.","For purposes of illustration, rather than assuming as in the above example that a single WX B provides the common service, two WXs, WX B and WX C are assumed to both have this service in common or share the same service with WX A. In this instance, router A may access the service topology and return two IP addresses, each of which identify router B and router C respectively. Based on these IP addresses, router A may select one of paths  by which to accelerate this second portion of the network traffic. Router A may then access the network topology and resolve path B in accordance with a traffic engineering protocol based on both of the returned IP addresses associated with routers B, C. Router A may therefore identify multiple paths, e.g., paths B, D, through network system  by which to apply network acceleration services. In accordance with the traffic engineering protocol, router A may select the one of paths B, D associated with the lowest cost in the network topology. Once selected, router A may proceed as described above to establish the selected one of paths B, D and WX A and the one of WXs B, C that reside within the selected one of routers B, C may negotiate, e.g., establish the second TCP session, and apply the common service. Router A forwards this accelerated second portion of the network traffic to the selected one of routers B, C, which reconstructs the second portion before forwarding this portion to the intended destination, data center , via the third TCP session.","In instances where the service information includes resource utilization indicating, for example, a total number of connections currently used and a total number of connections allowed by license, router A may, rather than provide two IP addresses, only provide a single IP address on which to perform path resolution. In other words, router A may select between two or more common WX devices, e.g., WXs B, C in the above example, based on the service information and, particularly, the resource utilization of the service information rather than on the network topology. Router A may select the one of WXs B, C that has the lowest resource utilization in these instances to perform a form of load balancing.","While described as occurring strictly based on either the service information or the network topology, the techniques described herein may be implemented such that router A selects between two or more competing paths, such as paths B, D based on a combination of the service information and the network topology. In these instances, router A may implement algorithms that balance or otherwise weigh these varying factors and perform path selection according to the resulting weighed cost. To illustrate, router A may assign a percentage weight of 40% to the resource utilization of the service information and another percentage weight of 60% to the total path cost defined by the network topology. Router A may then calculate a weighted average cost using these weights to balance the service information and the cost information of the network topology in order to provide a more nuanced or granular path selection algorithm. The techniques therefore should not be strictly limited to any particular path selection algorithm described herein buy may instead only described one aspect or embodiment of a particular path selection algorithm that incorporates the service-aware path selection techniques.","As yet another example, router A identify two or more common network acceleration services between WX A and one or more of WXs B-D. In instances where WX A shares two or more network acceleration services with a single one of WXs B-D, router A may implement the service-aware path selection techniques and select one of paths  in a manner similar to selecting one of paths  when WX A and one of WXs B-B share a single common network acceleration service. WX A and the common one of WXs B-D may however in this instance apply both network acceleration services. In instances where two or more WXs B-D each share a different network acceleration service with WX A, router A may select a path through the two or more routers B-D in which the common two or more of WXs B-D are integrated. Path A provides an example of a path through routers D, B in which common WXs D, B are integrated. Router A may perform a form of constraint-based path selection in these instances with a constraint requiring that the selected path travel through each of the identified routers B-D.","That is, router A may identify two different ones of routers B-D that each includes an integrated WX B-D that applies one of the common network acceleration services. Router A may then resolve the network topology to select path A, for example, and forward the portion of network traffic to router D, where WX D applies the first common network acceleration service, which then forwards this portion to router B, where WX B applies the second common network acceleration service. In this manner, router A may layer application of network acceleration services by selecting a path, such as path A, that flows through two or more routers  that include integrated WXs .","In some instances, router A may establish a path in accordance with a protocol that enables ordering of the hops along the path. For example, the MPLS signaling protocol may enable router A to specify a path that includes an ordered arrangement of hops, such that the path first flows through router D and next through router B. In this manner, router A may establish paths to arrange the order in which two or more network acceleration services are applied to the portion of traffic that travels the established path.","For portions of the network traffic for which WX A provides no network acceleration services, router A may resolve a path through network system  based only on the network topology in the manner described above. Assuming path B is associated with a lower cost than path D and both of paths B, D comprise the same distance to respective routers B, C, router A may select path B for this portion of the network traffic, as it provides the least expensive path through network system .","When resolving the network topology to select or determine each of paths  in accordance with the service topology, router A in effect layers the security topology on top of the network topology. In this respect, router A determines, in effect, one or more WXs B-C through which the path should flow in accordance with the security topology and then resolves a path that flows through those hops in accordance with the network topology. As mentioned above, router A may select those WXs  based on dynamic link properties to facilitate, if not maximize, utilization of WXs  and prevent over-utilization of WXs , which may delay if not prevent delivery of the network traffic. Router A may leverage the traffic engineering (TE) protocol, such as the OSPF-TE protocol, to determine these dynamic link properties of links .","Alternatively, router A may leverage the traffic engineering (TE) protocol, such as the OSPF-TE protocol, by utilizing the dynamic link properties transmitted in accordance with the TE protocol to determine a utilization, availability and\/or capacity of each of links . Based on this information, the TE protocol may, as implemented by router A, for example, inherently select paths through WXs  that are underutilized. Thus, if two or more of WXs, such as WXs B, C, provide the same common service, router A, in accordance with the TE protocol, may select a path through network system  that routes the network traffic to the one of routers B, C having an underutilized link. In this manner, router A may implement the service-aware path selection techniques to more efficiently utilize WXs .","Once selected or determined, router A may establish paths  through network system  in accordance with a network protocol, such as the MPLS signaling protocol described above. Each of paths  may comprise \u201cthrough\u201d or \u201ctransit\u201d paths in that the destination of each of these paths resides outside of network system . As a result, each of paths  terminate at either of routers B, C, each of which then forwards the incoming network traffic as outgoing network traffic. Often transit paths are defined within service provider networks to facilitate the transfer of large amounts of network traffic from one end of a network to another end in order to connect one network to another network, such as branch network  and campus network . While described with respect to transit paths, the techniques should not be limited to transit paths but may apply to selecting other types of paths, such as paths that terminate within network system  or \u201cterminating\u201d paths.","In this manner, routers  may become more aware of services provided by remote WXs B-D and intelligently form peering sessions or so-called \u201cadjacencies\u201d by which to apply shared or common network acceleration services. Router A, as described above, may therefore facilitate utilization of WXs  by leveraging the dynamic link properties of the TE protocol to select paths, such as paths , through underutilized WXs . Additionally, router A may, by maintaining the service topology in accordance with the service-aware path selection techniques described herein, layer application of network acceleration services by selecting a path through network system  that routes network traffic through two or more of WXs  integrated within routers .","Furthermore, router A, by maintaining the service topology in accordance with the service-aware path selection techniques, may enable administrators more freedom in positioning WXs  within network system . For example, an administrator may position WXs  at any location within network system  and routers  may dynamically inform one another of the location of WXs , as well as, the network acceleration services offered by these WXs . Routers  may then route traffic to those routers  having the integrated WXs  regardless of the locations of the WXs  within network system  in accordance with the service-aware path selection techniques described herein.",{"@attributes":{"id":"p-0085","num":"0084"},"figref":["FIG. 2","FIG. 1","FIG. 1"],"b":["26","26","12","12","26","12","12","26","12","12","26"]},"For purposes of illustration, however, router  is described below as if router  resides in the same context as that of router A or, in other words, that router  is representative of router A. In this context, router  may receive network traffic  from one or more of endpoint devices, such as endpoint devices  shown in , located within a branch network  and forwards this traffic  via one or more paths  through one or more WANs  to a destination within campus network , such as data center . Router  may implement the service-aware path selection techniques to intelligently select one of paths  by which to forward portions of network traffic .","As shown in , router  includes a forwarding plane  that forwards network traffic , a routing plane  responsible for routing network traffic , and a service plane  that applies one or more services, including network acceleration services, to at least a portion of network traffic . Forwarding plane  may include a flow control unit  and a forwarding component . Flow control unit  may represent a software and\/or hardware module that determines to which flow each packet or data unit of network traffic  belongs.","Forwarding component  may represent a software and\/or hardware component, such as one or more interface cards (not shown in ), that forwards network traffic . Forwarding component  may represent a central or distributed forwarding engine, where a distributed forwarding engine is distributed across a plurality of interface cards and a central forwarding engine resides in a central location or control unit of router . Forwarding component  may forward network traffic  in accordance with a Forwarding Information base  (\u201cFIB \u201d). FIB  may comprise an association or table of mappings identifying an interface by which to forward a particular packet or data unit of traffic . U.S. Pat. No. 7,184,437 provides details on an exemplary embodiment of a router that utilizes a radix tree for route resolution, the contents of which is incorporated herein by reference in its entirety. Moreover, forwarding plane  may be provided by dedicated forwarding integrated circuits normally associated with high-end routing and forwarding components of a network router. U.S. Patent Application 2008\/0044181, entitled MULTI-CHASSIS ROUTER WITH MULTIPLEXED OPTICAL INTERCONNECTS, describes a multi-chassis router in which a multi-stage switch fabric, such as a 3-stage Clos switch fabric, is used as a high-end forwarding plane to relay packets between multiple routing nodes of the multi-chassis router. The entire contents of U.S. Patent Application 2008\/0044181 are incorporated herein by reference.","In some instances, forwarding plane  may be distributed over a plurality of interfaces or interface cards in a multi-chassis router. In other instances, forwarding plane  may be located in a central location, such as a processing or control unit of router A. Typically, routing plane  resides in a central location, such as the control unit of router . Thus, while not shown in , router  may comprise a control unit, such as a programmable processor, and other hardware, such as memory, e.g., dynamic and\/or static Random Access Memory (RAM) and storage devices, such as hard drives, compact disk (CD) drives, digital video disk (DVD) drives, and the like. This memory or, more generally, computer-readable storage medium, may comprise or store instructions that cause the programmable processor to perform the secure path selection techniques described herein. In other words, the instructions may comprise one or more software or computer programs that the control unit executes to implement the secure path selection techniques described herein. In this respect, this hardware may include the following modules described with respect to routing plane .","Routing plane  includes a routing engine  that resolves routes through network  in accordance with one or more of a plurality of routing protocols. Routing engine  may include a classifier module , an Interior Gateway Protocol (IGP) module  (\u201cIGP module \u201d), a service aware module , a Multi-Protocol Label Switching (MPLS) module  (\u201cMPLS \u201d). Classifier module  represents a module comprising hardware and\/or software to receive portions of network traffic , e.g., packets, and classify those packets based on information contained within a header, a payload, or both the header and the payload of the packet. Classifier module  may determine, based on this information, to which of a plurality of flows, sessions, connections and applications each of these received packets of traffic  corresponds.","Classifier module  may determine to which flow a particular one of packets of traffic  corresponds by extracting information referred to as a \u201cfive-tuple\u201d from each packet. Each flow represents a flow of packets in one direction within the network traffic. A five-tuple comprises a source Internet Protocol (IP) address, a destination IP address, a source port, a destination port, and a protocol. Typically, the five-tuple is found within the header of each of the packets of traffic  and classifier module  may parse or otherwise extract the five-tuple from the header of each of these packets to identify to which flow each of the packets corresponds. Classifier module  may also extract and utilize additional information to identify a flow, such as a source media access control (\u201cMAC\u201d) address and a destination MAC address.","Classifier module  may also, based on this information, identify an application-specific protocol or application to which each of the received packets of traffic  corresponds. Classifier module  may, for example, determine, based on a source port of the five-tuple, whether each packet of traffic  corresponds to an HTTP application, e.g., a web browser. In particular, classifier module  may include application specific modules  that determine to which type of application each packet of traffic  is associated. Application specific modules  may comprise, for example, a HyperText Transfer Protocol (HTTP) module that inspects each packet to determine whether each packet comprises a HTTP packet, a File Transfer Protocol (FTP) module that inspects each packet to determine whether each packet comprises a FTP packet, etc.","Classifier module  may also maintain a service configuration  (\u201cservice config \u201d), where service configuration  represents data, rules or other information that defines associations among network acceleration services, such as the below described services , and a flow, a session, a connection, an application, a protocol, a port, a path or other classifiable characteristic of network traffic . In this respect, service configuration  may comprise one or more rules that define associations between network acceleration services and one or more identifiable characteristic of network traffic , such as a port number. Usually, an administrator or other network user defines this service configuration data so as to statically define associations between the network acceleration services and particular aspects of network traffic .","IGP  may represent any software and\/or hardware module that implements an interior gateway protocol, such as the OSPF protocol, an Intermediate System to Intermediate System (IS-IS) routing protocol, an Interior Gateway Routing Protocol (IGRP), an Routing Information Protocol (RIP), or any other interior protocol. While described herein with respect to IGPs, the techniques should not be limited in this respect, but may include Exterior Gateway Protocols (EGPs), such as a Border Gateway Protocol (BGP). IGP  may generally represent a module that stores and maintains data referred to above as a network topology.  illustrates this data as \u201cnetwork topology \u201d and IGP  may maintain this data within a traffic engineering (TE) database (DB)  (\u201cTE DB \u201d). TE DB  may be referred to as a \u201ctraffic engineering\u201d DB  in that the network topology stored to this database may be used by IGP  to perform traffic engineering.","Service aware module  may represent a software and\/or hardware module that stores and maintains data referred to above as a service topology that defines the services, resources and location of devices within the network that are capable of providing network acceleration services.  illustrates this data as \u201cservice topology \u201d and service aware module  maintains this data within a service TE DB , where DB  may be referred to as a \u201ctraffic engineering\u201d DB in that routing engine  may also utilize this service topology when performing traffic engineering. Service aware module  may include a service Application Programming Interface (\u201cservice API \u201d) by which service aware module  may request or otherwise determine network acceleration services provided by service plane . While described herein as an API, service API  may represent one exemplary embodiment by which to determine services provided by service plane  and the techniques may be implemented so as to determine these services in other ways, such as by way of a proprietary protocol, periodic updates, etc.","MPLS module  may comprise one or more hardware and\/or software modules that each implements a different one of the various protocols included under the general label of \u201cMPLS,\u201d such as the above described signaling protocol referred to as LDP, which routing engine  may utilize in establishing a path determined in accordance with the service-aware path selection techniques described herein.  illustrates two exemplary MPLS protocol modules, \u201cLDP A\u201d and \u201cRSVP B,\u201d each of which implement the Label Distribution Protocol (LDP) and the resource reservation protocol (RSVP), respectively.","The techniques however should not be limited to these two exemplary protocols and may be implemented with any MPLS or tunneling protocol, including proprietary path selection or point-to-point protocols. MPLS  may therefore generally represent any module that implements a protocol capable of establishing a path through a network and, while described with respect to these MPLS signaling protocols, the techniques should not be limited to these exemplary protocols. To illustrate, the techniques may be implemented with respect to a proprietary point-to-point protocol that establishes a point-to-point connection between adjacent WXs. In this sense, the proprietary point-to-point protocol may establish a path between WXs over which the second TCP session may be established such that the common services may be negotiated and applied. Regardless, the techniques may be implemented with respect to any protocol capable of establishing a path between WX devices.","Service plane  may include one or more service cards, such as a WX service card , installed within router . WX service card  may represent a card inserted into a chassis of router  (not shown in ). Router  may therefore be referred to as a \u201cmulti-chassis\u201d router . Router  may include a backplane or other high-speed switch by which to couple to service plane  generally and to each of the one or more service cards, in particular. WX service card  may provide the functionality described above with respect to WXs  and may therefore represent a WX device integrated within router . In other words, WX service card  may represent WX A assuming as described above that router  represents router A.","This integrated WX device, or WX service card , may include a service engine  that applies one or more of network acceleration services  to network traffic . Network acceleration services  include a number of different network acceleration services, such as Non-uniform Spectral Compression (NSC) service A (\u201cNSC A\u201d), a Lempel-Ziv (LZ) compression service B (\u201cLZ B\u201d), a HyperText Transfer Protocol (HTTP) acceleration service C (\u201cHTTP C\u201d), a File Transfer Protocol (FTP) acceleration service D (\u201cFTP D\u201d), and a Common Internet File System (CIFS) acceleration service (\u201cCIFS N\u201d). Although not shown in  for ease of illustration purposes, service engine  may comprise a cache, which it utilizes to provide additional network acceleration services.","Initially, upon powering up, activating, starting or otherwise enabling router , both IGP  and service aware module  may generate link or network topology  and service topology , which each respectively storing these topologies  and  to TE DB  and service TE DB . That is, TE DB  may represent, in general, a storage device that stores a current or up-to-date topology  of a network system, such as network system . Service TE DB  may represent a storage device that stores a current or up-to-date service topology  in accordance with the secure path selection techniques described herein. In other words, service aware module  may dynamically update security TE DB  with a full picture of all network acceleration devices within the network system, which may be referred to as a \u201cservice topology.\u201d","In order to generate this service topology , service aware module  may, in order to determine services  provided by WX service card , first invoke service API  in order to issue a request to WX service card . This request may request WX service card  to supply data listing services . This same request may also request the above described utilization information or service aware module  may invoke service API  to issue another request that requests this utilization information. In this manner, service aware module  may determine services  provided by WX service card  as well as possibly the current utilization of WX service card . Often, the request for services comprises a different or separate request for utilization, as the services do not change or are not updated as frequently as that of the utilization. Thus, rather than repeatedly receive the same services  for each request and a different utilization, service aware module  may issue separate requests, one for the services and a different or separate request for the utilization. This may be particularly beneficial in that service aware module  may repeatedly poll or otherwise determine the utilization at a high frequency in order to perform the form of load balancing described herein. By issuing discreet requests for utilization, service aware module  may limit the impact on WX service card  in servicing these requests.","WX service card  may service these requests and determine, based on the request, data describing either services  or utilization, e.g., a total number of connections available by license and a number of currently utilized connections, or both services  and utilization. Regardless of the composition of the data or information, this data may generally be characterized as \u201cservice information.\u201d WX service card  may forward this service information back to service aware module  via a return service API  function call. Although not shown in  for ease of illustration purposes, service card  may also implement a service API similar to service API  in order to communicate with service aware module .","Upon receiving this service information via service API , service aware module  may store this service information to service TE DB  as service topology . Particularly, service aware module  may create a new entry within a service table or other data structure defined by service topology , where this service entry is keyed or associated with the IP address assigned to router  and stores the service information. After determining and storing this security information, service aware module  may employ encryption\/decryption unit  to encrypt the service information. Encryption\/decryption unit  may represent a module that implements encryption and decryption algorithms for encrypting and decrypting data. In this instance, encryption\/decryption unit  may encrypt the determined service information. Once encrypted, service aware module  may forward this encrypted service information to IGP . IGP , upon receiving this information, may generate an opaque LSA that includes an opaque filed defining this encrypted service information and forward this opaque LSA to forwarding component , which in turn, may forward this opaque LSA as outgoing network traffic  to adjacent network devices within network system .","Meanwhile, IGP , to generate network topology , may receive LSAs from other network devices via forwarding component . These LSAs may arrive as incoming network traffic . IGP  may process these LSA similar to IGP , which parses these LSAs to determine network or link data. IGP  may then store this link data to TE DB  as network topology , thereby maintaining network topology  within TE DB . IGP  may also receive opaque LSAs from other adjacent network devices, e.g., routers B-D, that include an opaque field defining service information. IGP  may upon determining that the LSA comprises this type of opaque LSA, parse the service information from the LSA and forward the security information to service aware module . Service aware module  may employ encryption\/decryption unit  to decrypt the service information, if encrypted. Service aware module  may next update and therefore maintain service TE DB  with this received service information to accurately reflect the service topology of the network system, such as network system . As described above, this service information may not only include information indicating network acceleration services provided by a corresponding network acceleration device (whether integrated or stand-alone) but also availability or other utilization information concerning the availability of these services, or more generally, the availability of the corresponding network acceleration device. In this manner, IGP  may create, e.g., store data defining, and maintain network topology , while service aware module  in cooperation with IGP  may create, e.g., store data defining, and maintain service topology .","After determining both of network topology  and service topology  in this manner, router  may begin receiving network traffic . More specifically, flow control unit  of forwarding plane  may receive network traffic  and, for each discrete data unit or packet, of network traffic , flow control unit  may identify a flow to which each of these packets correspond based on a five tuple defined in a header of each of the packets. Flow control unit  may maintain a table or other data structure (not shown in ), which may be referred to herein as a \u201cflow table,\u201d to store those flows that are currently active within network system . Flow control unit  may parse the five tuple from each of the packets and utilize this five tuple as a key into the flow table. If an entry exists in the flow table for the parsed five tuple, flow control unit  may access this entry to determine an action to take with respect to packets of this identified flow. This action may comprise forwarding the packet to its destination without applying any service, providing a particular class or Quality of Service (QoS), or applying one or more services, including one or more of services , to the packet prior to forwarding the packet to its intended destination.","Assuming that router  has just begun to receive the packets of network traffic , the flow table likely does not store many, if any, flows. Flow control unit  may therefore not determine a flow entry within the flow table that corresponds to the extracted five-tuple. In these instances, flow control unit  may classify the packet as a new flow and update the flow table with a new flow entry that is associated with the extracted five-tuple. Flow control unit  may take a default action with respect to packets associated with new flows, whereby flow control unit  forwards these new packets, which are shown in  as new packets , to routine engine  for classification.","Upon receiving new packets  from flow control unit , routing engine  passes these new packets  to classifier module , which proceeds to identify a network application to which these new packets  correspond. Classifier module  may iteratively invoke application specific modules  until one of application specific modules  positively identifies an application to which each of new packets  corresponds. Classifier module  may alternatively invoke two or more of application specific modules  in parallel to speed identification of the corresponding application for each of new packets . Regardless, classifier module  may classify these new packets  by identifying one of these exemplary manners an application to which each of these new packets  correspond. This classification may also be referred to as determining a type of each of new packets .","Once classified, classifier module  may next determine whether to apply one or more network acceleration services  to the flows to which new packets  correspond based service configuration . That is, classifier module  may utilize the rules or policies defined by service configuration  in order to determine whether, for example, to apply services  to flows associated with particular application types determined by application specific module . In this respect, routing engine  and more particularly classifier module  may determine whether WX service card  provides services capable of accelerating network traffic of the particular identified type. Alternatively, classifier module  may not make this determination and instead pass the type to service aware module , which may then access service topology  to determine whether WX service card  provides this service. In any event, it is assumed for purposes of illustration, however, that service configuration  indicates that router  apply at least one of services  to at least one of the flows to which one of new packets  corresponds.","After determining to apply one of services  to a flow to which one of new packets  corresponds, classifier module  may pass the type, e.g., determined application to which the one of new packets  corresponds, and intended destination to routing engine . Routing engine  may then utilize this type and destination to intelligently select one of paths  by which to ensure application of the at least one of services  identified by service configuration  in accordance with the service-aware path selection techniques described herein.","Specifically, routing engine  may forward the type to service aware module , which may access service access service topology  within service TE DB  to determine whether any one of WXs B-D provide the at least one of services  indicated by service configuration  for this type of application. Service aware module  may access the service table defining service topology  and retrieve any entries that provide this same or common one of services . Each retrieved entry may define a corresponding IP address by which to reach the WX device that provides this common service, and service aware module  may extract these IP addresses. In some instances, service aware module  determines that a single one of WXs B-D provide the common service, retrieves the corresponding entry and extracts the IP address associated with the one of routers B-D in which the determined one of WXs B-D is integrated.","In other instances, service aware module  may determine two or more of WXs B-D each provide the same or common service. To resolve this conflict, service aware module  may then access the utilization information included within the service information defined by service topology  and select the one of the two or more WXs B-D associated with a lower dynamic utilization property. In other words, service aware module  may select the one of the common WXs having a lower utilization of available connections, as calculated on a percentage basis. In any event, service aware module  may identify one of WXs B-D that provides a service in common with WX service card . Service aware module  forwards the address associated with this selected one of WXs B-D to IGP , which may utilize this address in resolving the paths through the network system.","IGP  may receive both the addresses associated with the selected common one of WXs B-D from service aware module  as well as the intended destination of the packet from classifier module . IGP  may perform a form a \u201cloose\u201d or constraint-based routing using these addresses in that the path selection performed by IGP  uses the addresses a loose constraint when selecting hops through which the path must flow. The addresses may specify mandatory hops, however the IGP  may choose any other hops to construct the path from the given source to the given destination. IGP  may select the path based on the dynamic link properties stored within network topology  to account for bandwidth utilization.","While described as separate components, IGP  may incorporate or otherwise include various portions of service aware module  as an extension of one of the IGP protocols, such as OSPF. In this respect, OSPF or another one of the protocols represented by IGP  may be extended to base route resolution on service topology . In these instances, IGP  may perform constraint-based route resolution in a manner that accounts for service topology  to select a path through the network to ensure network acceleration services are applied to the received traffic.","After determining one of the paths, IGP  may establish the path through the network in accordance with a link state protocol, such as one of Multi-Protocol Label Switching (MPLS) signaling protocols, e.g., LDP or RSVP. IGP  may therefore forward the path, or one or more addresses identifying each hop along the path, to one of MPLS signaling protocol modules , e.g., LDP A or RSVP B, whereupon this one of MPLS module  establishes an LSP through the network system that corresponds to the determined path in accordance with, for example, LDP.","As an example, MPLS module  or some other path establishing protocol may, when establishing a given path, indicate for applicable hops of the path, e.g., those hops that provide network acceleration services, the services to be applied along with an identifier identifying the network acceleration device, e.g., one of WXs B-D, that provides the services. MPLS module  may include this information in a path setup request that it transmits throughout the network in order to setup or negotiate the path.","After establishing the path, service aware module  may once again invoke a service API  to issue a negotiation request to WX service card . This negotiation request may include the address associated with the common WX and request that WX service card  negotiate with the common one of WXs B-D identified by the address to establish a connection by which to apply the one or more shared or common services. WX service card  may perform this negotiation and return the result of the negotiation to service aware module . If the negotiation is unsuccessful, service aware module  may, in instances of only a single common WX, return this result to routing engine , which issues an update (shown in  as one of updates ) to flow control unit  indicating that the flow associated with this packet are not to be forwarded to service card  or otherwise undergo application of services . In instances of two or more common WXs, service aware module  may proceed to request that IGP  form another path over which connection negotiations with a next, more utilized, one of the common WXs can occur. In other words, service aware module  may proceed to request that WX service card  negotiate with the common WXs in order of increasing utilization until either none of WXs will agree to apply the share services or one of the common WXs will agree to apply the shared services. The first negotiation however likely results in agreement, especially considering that the least utilized common WX is contacted first.","Routing engine  may then, after establishing the path and negotiating application of the one or more services, update flow control unit  such that flow control unit  forwards a portion of network traffic  to WX service card , as shown in  as service traffic . This update is shown in  as one of updates . In particular, routing engine  may receive the setup request information via the one of MPLS modules  and configure a bitmap variable in forwarding plane , one for each path, route or LSP currently traversing edge router . The bitmap variable may indicate that the forwarding engine forward traffic received via a particular path to the internal WX service card . The bitmap variable may also indicate which of services  corresponding WX service card  applies to the received traffic. Forwarding plane  may then forward the portion of traffic , e.g., service traffic , to WX service card , for example, along with a communication indicating those of services  to apply to service traffic  based on the bitmap variable.","In this manner, routing engine  may identify a hop along the established path for a given flow as corresponding to WX service card . Routing engine  may, in some instances, update an entry that includes the bitmap variable corresponding to the flow for which the path was established such that flow control unit  forwards a portion of traffic  to WX service card  prior to forwarding this traffic  as outgoing traffic . Each flow entry may identify the flow by its corresponding five-tuple, and identify via the bitmap variable whether to apply one or more of services  provided by WX service card .","Flow control unit  may then, upon receiving network traffic , access the flow table and determine whether a packet or data unit of network traffic  includes a five-tuple associated with one of the flow entries of the flow table. If associated with an entry that indicates none of services  are to be applied, flow control unit  may forward the packet as outgoing network traffic . However, if flow control unit  determines that one or more of services  are to be applied to the packet, flow control unit  forwards the packet or data unit to WX service card . Service module  of WX service card  may then apply the identified one or more of services . WX service card , after applying the one or more of services , forwards the packet back to flow control unit .","Forwarding component  may also receive information from routing engine  indicating the established path by which to forward service traffic  processed by WX service card . Forwarding component  may store this path information to FIB  and upon receiving service traffic  of outgoing traffic , forward service traffic  in accordance with the path information stored to FIB . In particular, forwarding component  may access FIB  to determine which of available paths  to forward service traffic . Upon determining the path, forwarding component  may update service traffic  with any headers, labels (such as MPLS labels), tags or other information typically required to route service traffic  along the path. FIB  may indicate the output interface by which to forward this updated service traffic, whereupon forwarding component  may forward updated service traffic  via this interface to the network system.","In some instances, the established path may, as described above, traverse two or more of WXs B-D, either external or internal to routers, whereupon these additional network acceleration devices may each apply one or more network acceleration services to service traffic . Service aware module  may identify each of these WXs B-D by an associated address (e.g., an address identifying corresponding ones of routers B-D) and define an order in which the path is to traverse each of these WXs B-D as well as request that WX service card  negotiate with both of these common WX via service API . IGP  may also perform the loose constraint based path selection to select a path through the network system that traverses these identified common WXs in the order specified by service aware module . In most other respect, routing engine  may operate in a manner similar to that described above with respect to a single common WX to establish the path, negotiate application of the services, update flow control unit , forward traffic to WX service card  and otherwise forward traffic along the established path. In this manner, one or more network acceleration services may be layered upon one another so as to apply multiple services to traffic traversing a particular path.","While processing packets is described above with respect to an internal network acceleration device, e.g., WX service card , the techniques may also apply to external network acceleration devices in a similar manner. Moreover, while various module included within routing engine  are described as receiving service information, LSAs, opaque LSAs and other communications for ease of discussion, routing engine  may generally receive these communications via forwarding plane , e.g., interface cards, forwarding component  and\/or flow control unit .","FIGS. A,B are flow charts illustrating example operation of a network device, such as router  of , in performing the service-aware path selection techniques described in this disclosure. Although described with respect to edge router  of , the techniques may be implemented by any network device capable of selecting paths through the network, such as routers B-D of . With respect to routers B and C, in particular, these routers B, C may perform the techniques in order to select paths by which to accelerate traffic from campus network  to branch network . Thus, the techniques should not be limited to the exemplary embodiment described herein.","Referring first to , an administrator or other network user may initially specify or otherwise provide service configuration  to router . In particular, this administrator may interact with a user interface presented by a UI module (not shown in ) executing within routing engine  to input data defining service configuration . Typically, the administrator specifies service configuration  in order to initialize or before enabling router , however classifier module  may come pre-configured with a standard or base service configuration. In other embodiments, service information is learned and aggregated dynamically by querying components of the service card. Regardless of how service configuration  is loaded, router  may receive data defining service configuration  that defines associations between services  and particular flows, sessions, connections, application, or any other identifiable or classifiable characteristic of a particular packet ().","During this initialization phase, router  and, more particularly, service aware module  may determine service information describing services  provided by WX service card  (). In particular, service aware module  may, as described above, invoke service API  and issue a request via service API  requesting that WX service card  provide data describing services . WX service card  may respond to this request by issuing a response via service API  that includes data defining services . Service aware module , also as a part of determining the service information, may issue another request via service API  to determine the utilization of WX service card . Again, as described above, WX service card  may issue a response via service API  identifying the utilization. Service aware module  may in this manner determine service information, which may include both the data defining services  and the utilization information, and store this data to service TE DB  as service topology . While shown as determining this service information only once in , service aware module  may periodically poll, via service API , WX service card  for service information. Often, this repeated polling involves a request only for the utilization so as to properly maintain an accurate representation of service topology .","After determining this security information, service aware module  may forward this service information to IGP , which may generate an opaque LSA in accordance with a link state protocol, such as the above described OSPF, and store this service information to an opaque field. Service aware module  may, in some instances, encrypt this service information prior to forwarding the service information to IGP  using encryption\/decryption module . Regardless, IGP  may forward this opaque LSA via forwarding component  to adjacent network devices, such as routers B-D. IGP  may also receive opaque LSAs from these adjacent network devices that also specify security information concerning, for example, WXs B-D. IGP  may extract the security information from these opaque LSAs and forward the security information to service aware module , which, if encrypted, may decrypt the service information using encryption\/decryption module  prior to updating service topology  of service TE DB  with the received service information. In this manner, routing engine  may exchange service information with adjacent network devices and update service topology  based on this so-called \u201cservice exchange\u201d (, ).","Meanwhile, IGP  may determine link information describing the state of links to which router  couples (). IGP  may store this link information to TE DB  as network topology . IGP  may generate one or more LSAs, store this link information to appropriate fields of the LSAs and transmit these LSAs to adjacent network devices. IGP  may also receive LSAs from the adjacent network devices, e.g., routers B-D, extract the link information and update network topology  in accordance with the received link information. In this manner, routing engine  and more particular IGP  exchange link information with adjacent network devices and update network topology  based on this so-called \u201clink exchange\u201d (, ). While shown as occurring during an initialization phase or during a phase prior to receipt of network traffic, routing engine  may, in parallel with or while receiving network traffic, continually generate and receive both opaque LSAs storing service information and LSAs storing link information, extract this information and update respective service topology  and link topology  within service TE DB  and TE DB . In this respect, routing engine  may maintain network topology  and service topology  to accurately reflect the current link and service conditions within the network system.","Referring to , which illustrates a service application phase that may occur after the initialization phase shown in , router , and more particularly, flow control unit  of forwarding plane  included within router , may receive a packet of network traffic  (). Flow control unit  may determine whether this packet corresponds to a new flow in the manner described above (). If the packet corresponds to a new flow (\u201cYES\u201d ), flow control unit  may forward the packet to routing plane  as one of new packets . Routing engine  of routing plane  may forward this packet to classifier module , which may in the manner described above classify the packet in order to determine both the type, e.g., an application to which the packet corresponds, and the intended destination, e.g., an IP destination address (). Classifier module  may, for example, invoke application specific modules  to determine the application to which the packet corresponds or type of the packet. Based on this type, classifier module  may access service configuration  to determine, as one example, whether to apply one or more of services  to this determined type of packet ().","Assuming service configuration  associates one or more of services  with the determined type, classifier module  may determine that one or more of services  apply to the determined type of packet (\u201cYES\u201d ). While described herein as determining a type of packet by determining an application to which the packet corresponds, this type may refer to any classifiable characteristic of the packet, including a particular source and\/or destination port number, a particular source and\/or destination IP address, a particular protocol, a particular payload length or packet length, a particular pattern included within either or both the header or payload of the packet or any other classifiable aspect of a packet. The techniques therefore should not be strictly limited to a particular application.","After determining that WX service card  is to apply one or more of services  to the determined type of packet, classifier module  may forward the determined one or more services  to service aware module . Upon receiving these one or more services , service aware module  may, as described above, access service topology  within service TE DB  to identify those of WXs B-D that provide at least one of the same or common services as those received one or more services . These identified one or more of WXs B-D may be referred to herein as \u201ccommon\u201d WXs, and service aware module  may, in this manner, identify one or more common WXs based on service topology  ().","Assuming that service aware module  identifies at least one common WX (\u201cNO\u201d ), service aware module  may then forward the address of the common WX to IGP . IGP  may, having previously received the determine destination from classifier module , access network topology , determine, based on network topology , one of paths  to the destination through the network system using a form of \u201cloose\u201d constraint-based routing in the manner described above and invoke one of MPLS modules  to establish the determined one of paths  through the network system (). IGP  may return the path back to service aware module .","In response to this path, service aware module  may invoke service API  to transmit a request specifying an address associated with the selected common ones of WXs B-D, e.g., an address associated with corresponding ones of routers B-D, to WX service card  requesting that WX service card  establish an acceleration adjacency with that common WX and negotiate the application of the common one or more of services  (). WX service card  may transmit a response to this negotiation request via service API  to service aware module  indicating a result of the negotiation.","Assuming again for purposes of illustration that the negotiation was successful (\u201cYES\u201d ), service-aware path selection module  may forward the address associated with the common one or more of WXs B-D to routing engine . Routing engine  may then generate and issue an update, e.g., one of updates , to flow control unit  that causes flow control unit  to update the flow table in the manner described above ().","Routing engine  may then forward the packet back to flow control unit , which may once again determine whether the packet corresponds to a new flow (). As flow control unit  updated the flow table in response to the one of updates , flow control unit  may determine that the flow to which the packet corresponds is not a new flow (\u201cNO\u201d ). Flow control unit  may determine based on the updated entry for this determined flow that the one or more identified ones of services  discussed above are to be applied to the packet and forward the packet as one packet of service traffic  to WX service card  of service plane  in the manner described above (\u201cYES\u201d ). Service engine  of WX service card  may then apply the one or more of services  to this packet before forwarding the packet back to forwarding plane , where forwarding component  may forward the packet via the determined path through the network system, as described above (, ).","In some instances, flow control unit  may receive both the one of updates  and the packet from routing engine  and may, based on the one of updates , determine both that the flow to which the packet corresponds is not new and that the one or more services  indicated in the one of updates  are to be applied to the packet without accessing the flow table. In other words, the techniques should not be limited to the exemplary embodiment or implementation described herein and may be implemented in a manner that optimizes performance or otherwise improves the speed with which flow control unit  makes these determinations.","The above assumptions presumed that service configuration  indicated that one or more services  were to be applied to the determined type of packet (\u201cYES\u201d ), that at least one of WXs B-D provided a service in common or the same as the determined one or more of services  (\u201cNO\u201d ), and that negotiation with these one or more common WXs was successful (\u201cYES\u201d ). However, a failed common WX determination causes routing engine  to return the packet to forwarding plane  without updating the flow table to indicate application of one or more of services  to the flow to which this packet corresponds. If more than one common WX is identified however and negotiation with a first common WX does not succeed (\u201cNO\u201d \u2033), service aware module  may select a second or next common one of WXs B-D and cause IGP  to determine and establish a path to the intended destination (). Service aware module  may then cause WX service card  to negotiate the application of common services over the established path (). This process may determine until no common WX are available for adjacent service application (\u201cNO\u201d ) or until a successful negotiation occurs for application of the common services with one of the common WXs (\u201cYES\u201d ).","As a result, flow control unit  having not received one of updates  for the flow to which the packet corresponds, may not update the flow table to indicate that one or more of services  are to be applied to the flow to which the packet corresponds. Thus, flow control unit  may receive the packet from routing engine , determine that the packet does not correspond to a new flow (\u201cNO\u201d ), as flow control unit  may add an entry to the flow table for the flow prior to forwarding the packet to routing engine , but determine based on the flow entry to which the packet corresponds that no services are to be applied to this packet (\u201cNO\u201d ). Flow control unit  may, in response to this determination, forward the packet to packet forwarding engine , which may in turn forward the packet based on the destination identified within a header of the packet (). In other words, router  may forward the packet, in these instances, without applying one of services  to the packet. Again, while described as being separate from IGP , service aware module  may reside or be included within IGP  such that IGP  is extended to include service aware module . In these embodiments, IGP  may perform the constraint-based routing in the manner described above. In other words, IGP  may receive from classifier module  an application type of the packet as well as the services to be applied to the packet. IGP  may then access service topology  of service TC DB  to identify common WX and then select a path based upon both service topology  and network topology . That is, IGP  may identify the common WXs and select a path based on network topology  to the selected common WX. In this respect, IGP  may be extended to utilize service topology  in order to select a path through network topology .","Thus, while described as separate components, the techniques may be implemented such that IGP  is extended to perform some if not all of the functionality described with respect to service aware module . In this respect, a router  may invoke a protocol, e.g., IGP , on to select a path through the network that includes the second router having the common WX, such that the path includes a plurality of next hops from the first router to the destination. Router  therefore selects the path through the network so that the second router is positioned along the path between the first router and the destination.",{"@attributes":{"id":"p-0139","num":"0138"},"figref":["FIG. 4","FIG. 4","FIG. 4"],"b":["106","106","106","106","106"]},"As shown in , LSA  includes an LSA header . LSA header  comprises an LSA age field A (\u201cLSA age A\u201d), an options field B (\u201coption B\u201d), an LS type field C (\u201cLS type C\u201d), a link state identifier field divided into an opaque type field D (\u201copaque type D\u201d) and an opaque ID field E (\u201copaque ID E\u201d), an advertising router field F (\u201cadvertising router F\u201d), a link state sequence number field G (\u201cLS sequence number G\u201d), a link state checksum field H (\u201cLS checksum H\u201d) and a length field I (\u201clength I\u201d). Although shown as comprising fields A-I (\u201cfields \u201d), LSA header  may comprise more or less fields than that shown in .","LS age field A typically specifies the age of the LSA  in seconds and is used to distinguish between two LSAs specifying the same LSA sequence number in their respective LS sequence number field F. Options field B may specify which optional capabilities are associated with the LSA . LS type field C indicates the format and function of the LSA , i.e., the type of LSA. Particular to opaque LSAs, LS type field C may identify the topological range of distribution of LSA . For example, if LS type field C stores a \u201c9,\u201d LSA  associated with LSA header  is distributed on a link-local scope, indicating that LSA  is not to be flooded beyond a local (sub) network. Alternatively, if LS type field C stores a \u201c10,\u201d LSA  is distributed on an area-local scope, indicating that LSA is not to be flooded beyond their area of origin. Generally, LS type field C can be any value within the range of 9-11 for opaque LSAs, where a value of \u201c11\u201d indicates that LSA  can be flooded throughout an entire autonomous system. In this respect, the LS type field may limit the distribution of opaque LSA  and control the extent to which security topology  may extend or cover.","LS type filed C may, therefore, indicate whether LSA  is an intra or inter area opaque LSA. The link state ID field typically identifies a portion of the routing domain that is being described by LSA . For opaque LSAs, such as LSA , the link-state ID of the opaque LSA is divided into opaque type field D and opaque ID E. An opaque type set to \u201c1\u201d indicates a traffic engineering LSA. LSA  may generally comprise an opaque type field D set to \u201c1\u201d to indicate that opaque information  relates to traffic engineering. Alternatively, opaque type field D may be set by IGP , for example, to any other value agreed upon to indicate that opaque information  stores security information. Opaque ID field E defines a unique ID identifying the portion of the routing domain that is being described by LSA .","Advertising router field E may specify the OSPF router identifiers of the LSA 's originator. LS sequence number field F may comprise a signed 32-bit integer that OSPF modules, such as IGP module  uses to detect old and duplicate LSAs. LS checksum field G may indicate whether the LSA accompanying LSA header  contains errors, and IGP module  may employ LS checksum field G to discard possibly faulty LSAs . Length field H indicates the length of LSA .","IGP  may generate LSA , such that LSA header  identifies this LSA  as an opaque LSA. In this respect, IGP  may generate LSA  in accordance with RFC 5250. Specifically, IGP  may set LS type field C to one of values 9-11 depending on the topological scope desired. IGP  may further specify the correct opaque type in opaque type field D. Typically, as mentioned above, IGP  specifies an opaque type of \u201c1\u201d in opaque type field D to indicate that LSA  is an opaque LSA defining traffic engineering metrics or information. IGP  may generate the remaining field E-I in accordance with the OSPF or OSPF-TE protocol. IGP  may set length field I to the appropriate length depending on the amount of opaque information .","IGP  may then insert security information received from service aware module  as opaque information  of LSA . RFC 5250 generally provided no restrictions upon the type of information a traffic engineering LSA, such as LSA , may store in opaque information . Thus, IGP  may again leverage the OSPF protocol to define service information within opaque information . As LSA  may include service information, LSA  may be referred to herein as a \u201cservice\u201d LSA. A \u201cservice\u201d LSA may represent one example of advertisement or data unit that includes service information and the techniques should not be limited to LSAs. In some instances, service aware module  may encrypt the service information such that only other service aware modules similar to service aware module  may decrypt this service information stored as opaque information  in LSA .","IGP  may prepend or otherwise edit the service information to indicate that opaque information  defines service information. As a result, other IGP or OSPF modules may, upon encountering opaque information  determine that this opaque information includes service information for processing by a service aware module, similar to service aware module . IGP  may then transmit LSA  so as to inform other network devices that operate in accordance with the service-aware path selection techniques of the service provided by integrated WX service card .",{"@attributes":{"id":"p-0147","num":"0146"},"figref":"FIG. 5","b":["114","114"]},"As shown in , router  includes a control unit  that comprises a routing engine  and a forwarding engine . Control unit  may comprise any combination of hardware and software that implement the techniques described in this disclosure. As mentioned above, control unit  may comprise one or more processors, Application Specific Integrated Circuits (ASICs), integrated circuits or any other processing or control unit or element or combination thereof, and a memory or storage device. In some instances, the memory or storage device (e.g., generally, a computer-readable storage medium) may comprise the above described instruction that cause the programmable processor to perform the techniques described herein. These instructions may form a computer or software program or other executable module that the programmable processor is capable of executing.","Routing engine  may be substantially similar to routing engine  of  in that routing engine , although not shown in , may include modules and database similar to those described above with respect to routing engine  that perform the service-aware path selection techniques. Routing engine  may generally store, update and maintain routing information or link information stored within TE DB  to accurately reflect the topology of the network and other entities. TE DB  may be substantially similar to TE DB . Routine engine  may also in accordance with the techniques described herein store, update and maintain service information within service TE DB , which may be substantially similar to service TE DB .","Routing engine  may, as described above, determine or select a path based on service information received from other network security devices and maintained within service TE DB . In accordance with routing information stored in TE DB , forwarding engine  may maintain forwarding information within FIB  that associates network destinations with specific next hops and corresponding interfaces ports. FIB  may be substantially similar to FIB . Routing engine  may install the determined path in forwarding engine , such that forwarding engine  may maintain FIB  in this manner.","Router  further includes a set of interface cards (IFCs) A-N (\u201cIFCs \u201d) for communicating packets via inbound links A-N (\u201cinbound links \u201d) and outbound links A-N (\u201coutbound links \u201d) and a WX service card . Each of IFCs  couple to and communicate with control unit  via switch . Switch  may comprise any communication medium capable of communicatively coupling one or more endpoints, e.g., IFCs , control unit , and WX service card . Forwarding engine  may receive packets forwarded via switch  from IFCs  and forward those packets via switch  and IFCs  on outbound links A-N according to forwarding information stored to FIB . In this manner, forwarding engine  provides the forwarding functionality of router . WX service card  may be substantially similar to WX service card  of .","As described above, router  may receive the packets or more generally, network traffic, via incoming links , whereupon IFCs  forward those packets via switch  to forwarding engine . Forwarding engine  may maintain information requiring that packets associated with particular flows, as one example, should be first sent to WX service card  prior to forwarding those packets via one of outbound links .","Forwarding engine  may then forward these packets to WX service card  for processing or servicing in the manner described above. After servicing, WX service card  may forward the packets back to forwarding engine  via switch , whereupon forwarding engine  forwards the packets via one of outbound links  associated with the determined path.","WX service card  may therefore comprise any card or other removable processing unit that may be inserted into a slot. WX service card  may, once inserted into the slot, interface with switch , whereby WX service card  may receive, service (e.g., apply one or more security services) and forward packets. In this manner, any network device may implement the service-aware path selection techniques described herein to decrease administrator oversight through automatic discovery of and routing to network acceleration devices and possibly promote more efficient utilization of network acceleration devices.","Various embodiments of the invention have been described. These and other embodiments are within the scope of the following claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF DRAWINGS","p":[{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIGS. 3A and 3B"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 5"}]},"DETDESC":[{},{}]}
