---
title: Computer realizing high-speed access and data protection of storage device, computer system, and I/O request processing method
abstract: In a computer, a logical partition for calculation in which an OS and an application operate and a logical partition for storage for providing a storage function are constructed. In the logical partition for calculation, a device corresponding to a storage device is provided, while the logical partition for storage provides a volume. A memory space that can be shared by the both logical partitions is prepared, and management information describing a sorting destination or a sorting method of an I/O request issued by an application is provided in the memory. If the logical partition for calculation receives an I/O request from the application, the partition refers to the management information and sorts the I/O request to the storage device or the logical partition for storage. The logical partition for storage processes the received I/O request by the storage function and transmits the result to the storage device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09075527&OS=09075527&RS=09075527
owner: Hitachi, Ltd.
number: 09075527
owner_city: Tokyo
owner_country: JP
publication_date: 20141229
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"p":["This is a continuation application of U.S. Ser. No. 13\/807,410, filed Dec. 28, 2012. This application claims priority from National Stage of PCT\/JP2012\/007983, filed Dec. 13, 2012. The entire disclosures of all of the applications listed above are hereby incorporated by reference.","The present invention relates to a computer which realizes data protection while bringing out access performances of a storage device, a computer system, and an I\/O request processing method.","In processing of transactions for important data, a storage system provided with high data protection functions is indispensable. On the other hand, in primary processing or search\/analysis processing capable of retry processing, high speed is given emphasis in some cases.","At present, high-speed devices to be mounted on servers and storages including products such as PCIe-SSD, which couples an SSD (Solid State Drive) with a high-speed protocol such as PCIe (PCI Express), and products such as All Flash Storage on which only an SSD is mounted, have appeared.","[PTL 1] Japanese Patent Laid-Open No. 2008-97225","[PTL 2] U.S. Patent No. 2011\/0289267","As described in PTL 1, a high-performance storage system utilizing the respective characteristics of both a low-speed device such as an HDD (Hard Disk Drive) and a high-speed device such as an SSD has been proposed. However, in this case, a storage controller makes a bottleneck and there is a problem that the performances of the high-speed device such as the SSD cannot be fully brought out. On the other hand, by directly coupling a high-speed device to a server, the performance can be brought out without going through the storage controller, but there is a problem that storage functions such as a data protection function provided in the storage controller cannot be fully utilized.","Moreover, as in PTL 2, in order to improve a Read performance of an application by utilizing a high-speed device, there is a method in which the high-speed device is directly coupled to the server, the high-speed device is used for a cache application, and the Write from the application is handled by writing data via write-through in the storage device coupled to an external device so as to realize both the high-speed access and data protection, but it is not necessary to protect data of all the write data and there is a problem that the Write performance cannot be fully brought out.","The present invention has an object to provide data access means which can bring out both functionality of a storage controller and an I\/O performance of a storage device in data access to the storage device.","In the present invention, in order to solve at least one of the above-described problems, a computer is logically partitioned, and a logical partition for compute and a logical partition for storage are prepared. Regarding I\/O from the compute partition, it is determined whether the logical partition for storage is passed or not in accordance with I\/O contents, the I\/O is sorted, and an access is made to a storage device group.","Moreover, in the present invention, in order to solve at least one of the above-described problems, a computer for compute and a computer for storage are prepared, and regarding I\/O from the computer for compute, it is determined whether the computer for storage is passed or not in accordance with I\/O contents, the I\/O is sorted, and an access is made to a storage device group.","According to the present invention, a computer capable of flexible use according to user needs for a case where a high-speed access to a storage device is needed and for a case where data is to be protected can be provided.","Embodiments of the present invention will be described below by using the drawings.","In the following embodiments, since portions having the same structural parts and given the same reference numerals perform the same operations in principle, duplicated explanation is omitted.","A first embodiment of the present invention will be described below by referring to . The embodiments are only an example for realizing the present invention and care should be taken that they do not limit a technical scope of the present invention.",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 1","b":["10","10","11","12","13","14","15","16","10","15","16","15","16","13","10"]},"The memory  of the node  is provided with a logical partitioning program , an I\/O control program , a storage control program , a shared table , and one or more OS (Operation System)\/applications . The logical partitioning program  constructs one or more logical partitions on the node, and the OS can be operated independently in each logical partition. The I\/O control program  controls an I\/O request from the OS\/application . The storage control program  provides functions including a management function of the storage device groups  and , a shared storage function of receiving and responding to a storage I\/O from inside the node or from outside the node, a function of data protection, data copying and the like. The shared table  holds information to be shared by the I\/O control program  and the storage control program . That is, the memory  comprises a shared portion including the shared table , a portion for compute partition, and a portion for storage partition.","Moreover, the computer system is provided with a network , a management computer , a memory  of the management computer , a CPU , an NIC , and a management program . The management computer  and the network  are not indispensable, and the management program  may be provided in one of the nodes  so that the entire computer system is managed, for example.","The management program  manages the entirety of this computer system. The management computer  can obtain necessary information from the node  and can control the node  via the network .","Moreover, a storage apparatus  is coupled to the node . Here, the storage apparatus  is a shared storage apparatus such as a SAN (Storage Area Network) storage apparatus  or the like. The storage apparatus  is not indispensable. In this embodiment, the storage apparatus  is used as equipment including various storage functions by using the storage device as a storage medium.",{"@attributes":{"id":"p-0040","num":"0039"},"figref":"FIG. 2","b":["10","10","101","102","100","100","12","11","13","15","16","10"]},"In this embodiment, in the compute partition , the I\/O control program  and the OS\/application  are held on the memory  and are executed by the CPU . In the storage partition , the storage control program  is held on the memory  and is executed by the CPU . To the storage partition , the storage device group  is assigned. Moreover, a shared storage section  and the storage device group  are assigned to and shared by both the compute partition  and the storage partition . The shared storage section , here, is a part of the memory  on the node  and holds the shared table . In this embodiment, the I\/O control program  is present in the compute partition , but the I\/O control program  may be a part of the logical partitioning program .",{"@attributes":{"id":"p-0042","num":"0041"},"figref":"FIG. 3","b":"120"},"A device management module  manages a device configuration and a RAID (Redundant Array Inexpensive Disk) configuration of the storage device groups  and  assigned to the storage partition . The management of the device configuration, here, means management of whether or not the storage device can be shared by the storage partition  and the compute partition , the storage device is used in the RAID configuration or used as a device capable of direct access (hereinafter referred to as a Raw access), and this management information is held in the device configuration table . Moreover, the device management module  can instruct the logical partitioning program  to change assignment of the storage device to the logical partition. Moreover, the management of the RAID configuration means that the RAID level and the configuration of the storage device are managed, and this management information is held in a RAID configuration table . The device management module  is provided with a management GUI (Graphical User Interface) and an API (Application Programming Interface).","The I\/O processing module  executes cache control to an I\/O request from a host, an I\/O access I\/O request to a RAID configuration module  and an External storage connecting module , and a response to a host. Moreover, the I\/O processing  is provided with functions specific to a storage apparatus such as copying, snapshot, backup, mirroring, tiering and the like. The host, here, is the compute partition  in the node  or another node or server outside the node  provided with the storage control program.","The RAID configuration module  executes conversion processing of an I\/O request to a logical block address and a physical block address and executes the I\/O request to the storage device.","The External storage connecting module  comprises a logical volume corresponding to the storage device and the storage apparatus  in order to make a Raw access to the storage device and the storage apparatus  and executes the I\/O request to the storage device and the storage apparatus .","The device driver  includes a driver of the storage device, a driver for coupling to the compute partition , and a driver of the I\/O device .",{"@attributes":{"id":"p-0048","num":"0047"},"figref":["FIG. 4","FIGS. 7"],"b":["130","126","131","132","133","5","6","9"]},{"@attributes":{"id":"p-0049","num":"0048"},"figref":"FIG. 5","b":["131","501","501"]},"A column  holds whether the storage device can be shared by the storage partition  and the compute partition  or not. This information is held or obtained by API on the basis of the specification of the storage device. A column  identifies whether the storage device is used in the RAID configuration or in Raw access. If \u201cRAID\u201d is entered here, it is used in the RAID configuration, and if \u201cRaw\u201d is entered, it is used in the Raw access. This table  may be created by the storage control program , the I\/O control program  or the management program  or may be stored in advance.",{"@attributes":{"id":"p-0051","num":"0050"},"figref":"FIG. 6","b":["132","601","601","603","501","131","132","120","110","35"]},{"@attributes":{"id":"p-0052","num":"0051"},"figref":"FIG. 7","b":["126","701","702","40"]},"A column  holds an identifier of a host at an assignment destination. The assignment, here, indicates that the volume is accessible from the host. Here, the compute partition  in the node is described as, for example, by combining identification information such as an identifier of a logical partition at an assignment destination as \u201cAPP LPAR1\u201d and an identifier of a logical volume to the logical partition (LUN (Logical Unit number) and the like, for example) as a, b, c . . . , \u201cAPP LPAR1-a\u201d or the like. Moreover, in the case of a host outside the node, an identifier of a WWN or SCSI Name is held. Furthermore, if there is no assignment destination, \u201cnone\u201d is described. This table  may be created by the storage control program , the I\/O control program  or the management program  or may be stored in advance.",{"@attributes":{"id":"p-0054","num":"0053"},"figref":"FIG. 8","b":"110"},"A virtual device configuration module  comprises a virtual device as a block device accessed from the OS\/Application . A detailed flow will be described in .","A mode switching module  is provided with a function of switching a path of the I\/O access from the OS\/application  to the storage.","An I\/O sorting module  is provided with a function of sorting the I\/O access to the storage by mode. The detailed flow will be described in .","A RAID configuration module  executes conversion processing of the I\/O request to the logical block address and the physical block address and executes the I\/O request to the storage device.","A device driver  is a driver of the storage device, a driver to be coupled to the storage partition , and a driver of the storage I\/O.",{"@attributes":{"id":"p-0060","num":"0059"},"figref":"FIG. 9","b":["133","901","101","902","111","110","903","904"]},"Here, a \u201cfirst path\u201d indicates a case where a path of accessing a storage device via the storage control program  of the storage partition  is used as an I\/O access path to the device. A \u201csecond path\u201d indicates a case where the storage device is directly accessed from the compute partition . If the first path is used, here, the data protection function and the data control function and the like provided in the storage control program  can be used. On the other hand, if the second path is used, the storage control program  is bypassed and the storage device is directly accessed, whereby the performance of the storage device can be effectively exerted.","Moreover, the column  holds the identifier of the device connected through the path in the column  as an I\/O access destination. For example, since the column  for an I\/O of a virtual device B is the second path, the transmission destination  has a device identified as 2b.","A column  holds a RAID level and a configuration of the virtual device. If \u201cRaw\u201d is entered, it is not a RAID configured device. If a device with RAID configured is a target, the RAID level and the configuration are described as \u201cRAID5(4D+1P)\u201d or the like. This is equal to the column  of the RAID configuration table .",{"@attributes":{"id":"p-0064","num":"0063"},"figref":"FIG. 10","b":["15","942","943","16","941","941","942","943","931","932","933","120","102","931","932","933","911","912","913","110","101","942","943","922","923","101","942","922"]},"A virtual device  which the I\/O control program configures and shows to the OS\/application  corresponds to the devices  and , the virtual device  corresponds to the devices  and , and the virtual device  corresponds to the device . Here, even if the device  includes a plurality of devices, it is converted to the single virtual device  by the RAID configuration module  of the I\/O control program . The virtual devices  and  are provided with I\/O access paths by a first path  and a second path , and in the first path, the I\/O control program  executes the I\/O access corresponding to the devices  and , respectively, while in the second path, the I\/O access corresponding to the devices  and  is executed, respectively.","Though not shown, regarding the I\/O access from the device  to the Raid area , the RAID control is executed through the RAID configuration section operating on the compute partition .",{"@attributes":{"id":"p-0067","num":"0066"},"figref":["FIG. 11","FIG. 10","FIG. 10","FIG. 10","FIG. 10","FIG. 7","FIG. 6","FIG. 10"],"b":["111","110","1001","111","911","912","913","922","923","911","912","913","120","102","922","923","111","126","120","102","703","125","1002","111","111","702","126","601","603","132","911","912","913","120","1","3","4","111","922","923"]},"At Step , the virtual device configuration module  determines whether there is a set of devices corresponding to the same storage device in the multiple paths. Here, the virtual device configuration module  obtains a set of devices whose storage device identifiers obtained at Step  match between the device (, , and  in ) corresponding to the volume configured by the storage control program  and the device ( and  in ) directly corresponding to the storage device. In the example in , the sets of the devices  and  and the devices  and  are applicable. If there is a set of the devices, the routine proceeds to Step  and if not, the virtual device configuration module  moves to Step . At Step , the virtual device configuration module  configures a virtual device. Here, the virtual device configuration module  configures a virtual device corresponding to the set of the devices obtained at Step . In the example in , the virtual device  is configured to the set of the devices  and  and the virtual device  is configured to the set of devices  and . At Step , the virtual device configuration module  configures the virtual device corresponding to the applicable device. In , the virtual device  corresponding to the device  is configured. However, the configuration of the virtual device at this step is not indispensable and the OS\/application  may directly use the device .","At Step , the virtual device configuration module  updates the virtual device configuration table . Here, the identifier of the configured virtual device is entered in the column , and if the virtual device is configured at Step , \u201cYes\u201d is entered in the column , while if the virtual device is configured at Step , \u201cNone\u201d is entered in the column . Moreover, for the columns  and , it is assumed that a path according to default setting arbitrarily configured by a user or the like is selected. In the column , the RAID level\/configuration is registered. If the RAID is configured for the target device of the virtual device created at Step  and Step , the RAID level and configuration are registered therein, while if not, \u201cRaw\u201d is registered. The case where the RAID has been configured is that the target (column ) of the volume configuration table  to the applicable device at Step  is the array group (\u201cAG1\u201d or the like). At Step , if there is an unconfigured device for which the corresponding virtual device is not configured for the device detected at Step , the virtual device configuration module  moves to Step .",{"@attributes":{"id":"p-0070","num":"0069"},"figref":["FIG. 12","FIG. 9","FIG. 10"],"b":["113","1101","113","150","1102","113","113","133","904","1103","1104","905","1103","113","912","913","120","102","1104","113","906","133"]},"Regarding the access mode to the virtual device, such a case is expected that a user selects an access path of data in accordance with a use case using the data of the system in introduction of the system. The \u201cfirst path\u201d is selected if the user wants to use functions provided in the storage control program . The functions here mainly include snapshot, backup, disaster recovery, thin provisioning, data migration, virtualization of storage tiers and the like. On the other hand, the \u201csecond path\u201d is selected if the user wants to effectively bring out the data access functions without using the above-described functions.","At Step , the I\/O sorting module  moves to Step  if the RAID is configured or to Step  if not on the basis of the information obtained at Step . At Step , the I\/O sorting module  executes RAID area access processing by the RAID configuration module  for the device of the second path corresponding to the applicable virtual device. Here, the device of the second path is a device directly corresponding to the storage device. In the RAID area access processing, the processing such as conversion of the I\/O access request to the physical address and the logical address of the storage device, appropriate partitioning\/integration of the access processing to the target device, parity calculation and writing in the device during writing access and the like on the basis of the RAID level\/configuration indicated by the column  of the applicable virtual device of the applicable host in the virtual device configuration table . As a result, reading\/writing with respect to the device in which the RAID is configured is realized. At Step , the I\/O sorting module  sorts the I\/O access request to the device of the second path corresponding to the applicable virtual device.",{"@attributes":{"id":"p-0073","num":"0072"},"figref":"FIG. 13","b":["120","941","942","125","15","16","123","943","40","124"]},"The Raw-accessed VOL C () is the Raw area  on the storage device and has no RAID configuration. Thus, if an access is made to the Raw area  through the RAID configuration module , data cannot be recognized correctly. Thus, if an access is to be made to the Raw area , as in this figure, the access is made via the External storage connecting module  so that the Raw area  can be used while using the storage partition .",{"@attributes":{"id":"p-0075","num":"0074"},"figref":"FIG. 14","b":["150","1301","120","1302","120","114","110","1303","120","114","1301","1302","1303","1301","120","1301","1302"]},{"@attributes":{"id":"p-0076","num":"0075"},"figref":"FIG. 15","b":["112","1401","112","112","1402","112","1403","1406","133","112"]},"At Step , the mode switching module  waits for I\/O completion of the device driver  in the compute partition . Subsequently, at Step , the mode switching module  waits for execution completion of the I\/O request to the volume corresponding to the applicable virtual device in the storage control program . Here, a completion notice is made by the storage control program  and the mode switching module  via an information exchange interface or the like. At Step , the mode switching module  changes the mode of the applicable virtual device of the virtual device configuration table  to the second path. On the other hand, at Step , the mode switching module  waits for I\/O completion of the device driver  in the compute partition . Subsequently, at Step , the mode switching module  changes the mode of the applicable virtual device of the virtual device configuration table  to the first path.","The switching of the access mode may be dynamically changed by a discrimination program to be provided in the I\/O control program . In this case, the I\/O control program  collects performance information from access frequency from the OS\/application  to the virtual device, OS\/application , the file system, the driver or the storage control program  and detects portions which become I\/O queues or I\/O processing necks. As a result, switching is made from the first path to the second path for data with I\/O access frequency higher than a predetermined threshold value or data in which waiting for I\/O processing occurs more frequently than the others in the OS\/application , the file system, and the driver. On the other hand, switching is made from the second path to the first path for the data with I\/O access frequency lower than the predetermined threshold value or data in which waiting for I\/O processing occurs less frequently than the others. As a result, the access path can be optimized in accordance with data and higher performance improvement can be realized.","Moreover, the I\/O control program  provides a user with GUI specifying a threshold value for performing the above-described path switching through the management computer . Specific examples of the threshold value include a threshold value as an index for determining the above-described I\/O queue or I\/O processing neck and a threshold value of I\/O access frequency.","The method of using the RAID area  and the Raw area  separately has been described for the storage device groups  and . Subsequently, a method of moving the data stored in the RAID area  and the Raw area  to another area by means of data migration and not only presence of use of the storage control program  but of further using the RAID area  and the Raw area  separately in accordance with use applications of the data will be described by using .","For example, such a case is expected that data of processing with high importance placed on data protection such as online transaction processing and significant processing such as a core system is stored in the RAID area  and the data is moved from the RAID area  to the Raw area  if a part of the data is used so as to execute data analysis processing or the like. As a result, a more flexible system according to the use application of the data can be provided to a user.","Here, if the data is migrated from the RAID area  to the Raw area  in the migration, there is a problem that processing of the system cannot be stopped for the data migration. In a method described in , in the I\/O control program , the data temporarily held in a device for migration is selected as an access path so that the data is migrated without a stop and the above-described problem can be also solved.",{"@attributes":{"id":"p-0083","num":"0082"},"figref":"FIG. 16","b":["35","1601","35","120","1602","35","110","943","1603","35","120","943","1604","35","120","1605","35","110","1604","101"]},{"@attributes":{"id":"p-0084","num":"0083"},"figref":["FIG. 17","FIG. 16","FIG. 16"],"b":["40","1701","1601","1702","1602","1703","1604","1704","1604","1705","1605"]},"Moreover, the data migration from the Raw area  to the RAID area  can be also realized by the similar method.","Though not shown, the above-described system and apparatus are provided with configurations required for executing processing as an information processing device such as input\/output devices represented by a display and a keyboard, for example, and processing at each section is executed by the respective hardware in connection. Moreover, each processing can be realized by hardware by a processing section for executing that by forming an integrated circuit or the like. The same also applies to an embodiment below.","Embodiment 2 is a system in which a node is separated to each of a logical partition which is a compute partition and a logical partition which is a storage partition without using logical partitioning and is realized by separate computers, and similarly to Embodiment 1, a computer system capable of flexible use according to user needs for the case where high-speed access is desired to a storage device and a case where data protection is desired will be described.",{"@attributes":{"id":"p-0088","num":"0087"},"figref":"FIG. 18","b":["15","10","1800","1840","10","120","150","110","1800","1850","130","1850","20","1840","1800","101"]},"As a result, by separating the resources between the OS\/application  and the storage control program , interference of the resources can be eliminated.","The above-described Embodiment was explained such that the I\/O control program  has the I\/O sorting means but it may be so configured that a program for realizing the I\/O sorting means and related information may be introduced into a computer. Moreover, the program for realizing the I\/O sorting means may be stored in a storage device in the computer or an external storage apparatus in advance or may be introduced into the external storage apparatus when necessary through a detachable storage medium or a communication medium (network of wired, wireless, optical and the like or by means of a carrier wave or a digital signal on the network).",{"@attributes":{"id":"p-0091","num":"0000"},"ul":{"@attributes":{"id":"ul0001","list-style":"none"},"li":{"@attributes":{"id":"ul0001-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0002","list-style":"none"},"li":[{"@attributes":{"id":"ul0002-0001","num":"0090"},"b":"10"},{"@attributes":{"id":"ul0002-0002","num":"0091"},"b":"11"},{"@attributes":{"id":"ul0002-0003","num":"0092"},"b":"12"},{"@attributes":{"id":"ul0002-0004","num":"0093"},"b":"13"},{"@attributes":{"id":"ul0002-0005","num":"0094"},"b":"14"},{"@attributes":{"id":"ul0002-0006","num":"0095"},"b":["15","16"]}]}}}}],"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND ART","CITATION LIST","Patent Literature","SUMMARY OF INVENTION","Technical Problem","Solution to Problem","Advantageous Effects of Invention","DESCRIPTION OF EMBODIMENTS","Embodiment 1","Embodiment 2","REFERENCE SIGNS LIST"],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF DRAWINGS","p":[{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 12"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 15"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 16"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 17"},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 18"}]},"DETDESC":[{},{}]}
