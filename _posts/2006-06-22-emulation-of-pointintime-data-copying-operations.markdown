---
title: Emulation of point-in-time data copying operations
abstract: A host computer system (host) includes an application that generates I/O commands for a first type of point-in-time (PIT) copy operation, and an I/O subsystem coupled to a data storage system capable of performing a second type of PIT copy operation. The host processes the I/O commands as part of an emulation of the first type of PIT copy operation, including determining whether the I/O commands require modification for the emulation, and if so whether they are of a back-end type or an out-of-band type. The I/O commands that do not require modification are processed without modification via the I/O subsystem. For the back-end I/O commands, (i) an intercept condition is set, (ii) the I/O commands are processed via the I/O subsystem, and (iii) upon completion with the intercept condition set, the results are modified so as to indicate to the application that the first type of PIT copy operation can be performed on the storage volumes. For the out-of-band I/O commands, (i) corresponding commands of the second type of PIT copy operation are processed via the I/O subsystem in lieu of the out-of-band I/O commands, and (ii) upon completion of the substituted I/O commands, corresponding results are returned to the application as though the out-of-band I/O commands had been processed by the I/O subsystem. Using this technique, a host that initiates only PIT copying operations of the first type can be used with storage systems that support second-type PIT copying operations.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07571293&OS=07571293&RS=07571293
owner: EMC Corporation
number: 07571293
owner_city: Hopkinton
owner_country: US
publication_date: 20060622
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"p":["The invention pertains to the field of data storage systems, and more particularly to point-in-time copying operations in data storage systems.","It is known to perform so-called \u2018point-in-time\u2019 copying of data in data storage systems for a variety of purposes, including data backup, data mining\/analysis, etc. In a point-in-time copying operation, a source storage volume as it exists at the beginning of the operation is copied to a target volume. Upon completion, the target volume contains an exact copy of the source volume as existing at the time the copy operation was initiated. Various known mechanisms may be used to handle ongoing data reads and writes while the copying operation is in progress.","In data processing systems employing so-called \u201cmainframe\u201d host computers, such as zSeries\u00ae servers sold by IBM Corporation, a particular point-in-time copying utility known as Flashcopy\u00ae may be utilized. Flashcopy provides a point-in-time copy of a logical volume (in whole or in part) with almost instant availability of both the source and target volumes for continuing data accesses. The Flashcopy operation includes an \u201cestablish\u201d phase in which a Flashcopy relationship is established between source and target volumes, followed by a \u201ccopy\u201d phase in which the data is copied from source to target volume. By default, copying occurs in the background such that normal I\/O processing can continue. The Flashcopy relationship is automatically terminated once all source volume tracks have been copied to the target volume, unless an option referred to as \u201cpersistent Flashcopy\u201d is utilized, in which case the relationship must be explicitly ended or withdrawn by an application program. The Flashcopy functionality is carried out primarily by a controller in response to Flashcopy I\/O commands issued by an application program in the host computer.","An alternative point-in-time data copying utility known by the name SNAP is sold by EMC Corporation. SNAP is supported on EMC's SYMMETRIX\u00ae storage systems. Beyond the firmware support within the SYMMETRIX systems, SNAP relies on an application program interface (API) that is incorporated into a host computer. SNAP functions are invoked via the SNAP API, which communicates with the SNAP firmware within the SYMMETRIX to carry out the functions. SNAP is largely a superset of Flashcopy, i.e., SNAP includes the main features of Flashcopy as well as additional features not included in Flashcopy. Among other things, SNAP has the capability of performing point-in-time copying of volumes that are mirrored utilizing Symmetrix Remote Data Facility (SRDF) also sold by EMC Corporation. Although Flashcopy has analogous functionality, it is limited to use with a proprietary remote copying technique known as Peer-to-Peer Remote Copy (PPRC) and does not support SRDF for example. Flashcopy also has other limitations not present in SNAP.","Many data processing systems that can benefit from the utilization of one type of point-in-time copying service, such as SNAP, may include host computers that generate commands according to another type of point-in-time copying service such as Flashcopy. It would be desirable to enable the use of the first type of point-in-time copying service in such systems without requiring any significant change to the host computers, such that users' investment in host computers is protected while providing expanded functionality and\/or performance.","In accordance with the present invention, a data processing system is disclosed that includes a host computer system having (i) an application that generates input\/output (I\/O) commands for a first type of point-in-time (PIT) copy operation, and (ii) an I\/O subsystem coupled to a data storage system that is capable of performing a second type of PIT copy operation. The first type of PIT copy operation is directed to respective storage volumes of the data storage system. In an illustrative embodiment, the first and second types of PIT copying operations are Flashcopy and SNAP operations respectively.","The host computer processes the I\/O commands as part of an emulation of the first type of PIT copy operation. The processing includes determining whether the I\/O commands require modification for purposes of the emulation, and if so whether they are of a back-end type or an out-of-band type. The back-end I\/O commands require modification of results reported to the application upon completion, and the out-of-band I\/O commands require substitution by corresponding I\/O commands of the second type of PIT copy operation for purposes of the emulation. Generally, the results for the back-end I\/O commands are modified to indicate that the first type of PIT copying operation can be performed on the volumes to which the I\/O commands are directed, even though the data storage system may not support the first type of PIT copying operation. The substitution for the out-of-band commands is to perform an analogous function utilizing the support available within the data storage system for the second type of PIT copying operation. Several specific examples are given in the description below.","For those of the I\/O commands that do not require modification for purposes of the emulation, such I\/O commands are processed without modification via the I\/O subsystem of the host computer. For the back-end I\/O commands, (i) an intercept condition is set, (ii) the back-end I\/O commands are processed via the I\/O subsystem, and (iii) upon completion of the back-end I\/O commands with the intercept condition set, the results of the back-end I\/O commands are modified so as to indicate to the application that the first type of PIT copy operation can be performed on the storage volumes to which the first type of PIT copy operation is directed. For the out-of-band I\/O commands, (i) corresponding commands of the second type of PIT copy operation are processed via the I\/O subsystem in lieu of the out-of-band I\/O commands, and (ii) upon completion of the substituted I\/O commands, corresponding results are returned to the application as though the out-of-band I\/O commands had been processed by the I\/O subsystem.","Using the disclosed technique, a data processing system having a host computer that initiates only PIT copying operations of the first type, such as zSeries server that initiates Flashcopy operations, can be used in conjunction with storage systems that support second-type PIT copying operations such as SNAP. This can be of particular benefit when the second-type PIT copying operation has certain capabilities not present in the first-type PIT copying operation. Specific examples of such expanded capabilities include the following:","Host enabled, no need to upgrade microcode to enable new features","On consistency operation, read I\/O is allowed to be processed","Allow FlashCopy and Snap on the same devices","Allow FlashCopy to Virtual Devices","Default to an incremental FlashCopy if a session already exists","Allow more than one hop on remote FlashCopy","Allow incremental FlashCopy at dataset level","Allow FlashCopy across physical controllers","Perform remote FlashCopy via Remote Data Facility (RDF) (versus PPRC only)","Allow multiple Consistency Groups within a logical subsystem (LSS)",{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 1","b":["10","12","10","12"]},"The mainframe host  includes a storage-related application program (application)  that performs storage-related input\/output (I\/O) operations via an I\/O interface  and I\/O Supervisor\/Channel Subsystem (IOS\/CSS)  (also referred to as an I\/O subsystem herein). Also in the mainframe host  is a Symmetrix Control Facility (SCF)  which includes an operating environment shown as FLS , as well as a SNAP application program interface (SNAP API) . The SCF  is a bundle of software that can be included on a zSeries platform specifically to support third-party storage systems  such as SYMMETRIX systems.","The storage system  includes a controller  and a number of storage volumes . In operation, the controller  receives storage requests (reads, writes) from the mainframe host  and accesses the data stored on the corresponding volumes . Although not shown in , the storage system  may include a cache disposed between the controller  and the volumes  for reduced latency and improved performance. Those skilled in the art will appreciate that the presently disclosed techniques may be used either with or without such a cache.","In one embodiment, the storage-related I\/O operations of the application  may include issuing I\/O commands of a data copying utility or service known as Flashcopy\u00ae, a registered trademark of IBM Corporation. Generally, Flashcopy can be used to create \u201cpoint-in-time\u201d copies of logical volumes (in whole or in part) which may be used for any of a variety of purposes, including for example backup, testing, data mining\/analysis, etc. In data processing systems in which an IBM mainframe host is coupled to an IBM Enterprise Storage System (ESS), the ESS includes operating firmware that responds to Flashcopy commands and carries out Flashcopy operations on storage volumes of the ESS. In the system of , it is assumed that the storage system  supports a different type of point-in-time copying service from the type that is invoked by the application . In the case of a SYMMETRIX storage system for example, it may support a point-in-time copying service referred to as SNAP (a reference to the \u201csnapshot\u201d nature of the service). Much of the present description is based on an embodiment in which Flashcopy commands are being carried out via SNAP in particular. However, those skilled in the art will appreciate that the disclosed techniques are applicable to more generally to systems in which a first point-in-time (PIT) copying service is emulated via a second, different PIT copying service.","As known in the art, I\/O processing in the mainframe host  may take the form of I\/O commands that are executed by the application  and performed by the IOS\/CSS  in the form of \u201cchannel programs\u201d that include collections of \u201cchannel control words\u201d or CCWs. This general form may be used for all I\/O activity, whether related to Flashcopy or not. The present description focuses specifically on Flashcopy-related I\/O operations initiated by the application . It is assumed that these I\/O operations fall into one of three categories as follows:\n\n","Specific examples of CCWs in categories 2 and 3 are given below.",{"@attributes":{"id":"p-0032","num":"0034"},"figref":["FIG. 2","FIG. 1"],"b":["12","30","14","32","18","34","36","32","34","38","14"]},{"@attributes":{"id":"p-0033","num":"0035"},"figref":"FIG. 3","b":["26","40","42","12","14"]},{"@attributes":{"id":"p-0034","num":"0036"},"figref":["FIG. 4","FIG. 2"],"b":["38","14","46"]},"The task EFLIOTSK  passes the I\/O Supervisory Block (IOSB) associated with the I\/O operation to a module EFLSCAN , which is invoked along with a second module EFLIOXIT  as a CCW monitor. EFLSCAN  passes CCWs of interest to EFLIOXIT, which translates them into corresponding calls to the SNAP API . Specific CCWs and translations are described below. EFLSCAN  has access to a \u201csense area\u201d that can be returned by EFLIOXIT  when a condition is detected, such condition typically being a command reject with a reason code. For those conditions, a unit check is simulated to the application  via post-status processing EFLIOPST . The application  can then process the returned sense data.","The following table summarizes, for the emulation of Flashcopy by SNAP in particular, the CCWs of interest and the manner in which they are handled:",{"@attributes":{"id":"p-0037","num":"0039"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"105pt","align":"left"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["CCW","How handled","Notes"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}},{"entry":["SNSS","Back-end"]},{"entry":["Read Msg ID","Out of band"]},{"entry":["PSF\/DSO","Both","See below"]},{"entry":["RSSD","Both","Can be intercepted or handled by"]},{"entry":[{},{},"SNAP routines"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Specific handling of PSF\/DSO commands"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"105pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["CCW","How handled","SNAP API Routines"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}},{"entry":["Prepare RSSD","Back-end"]},{"entry":["Establish FC","Out of band","Query Session Details (for"]},{"entry":[{},{},"Incremental and Restore Handling)"]},{"entry":[{},{},"Snap Establish"]},{"entry":["Withdraw FC","Out of band","Snap Change nocopy to copy"]},{"entry":[{},{},"Snap Stop snap to device"]},{"entry":[{},{},"Snap Cleanup on source device"]},{"entry":["Consistency Group","Out of band","Snap Activate"]},{"entry":"Thaw"},{"entry":["Read Features","Back-end"]},{"entry":["Read relationship","Out of band","Snap Session List"]},{"entry":["table",{},"Snap Extent Information"]},{"entry":["FC capability","Out of band","Snap Session List"]},{"entry":[{},{},"Snap Extent Information"]},{"entry":[{},{},"Snap Query Indirect"]},{"entry":[{},{},"Snap Query Protection"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}]}}},"While this invention has been particularly shown and described with references to preferred embodiments thereof, it will be understood by those skilled in the art that various changes in form and details may be made therein without departing from the spirit and scope of the invention as defined by the appended claims.","In particular, it will be appreciated by those skilled in the art that the basic functionality of carrying out FlashCopy operations using corresponding SNAP operations may be realized within a storage controller such as controller  () rather than within a mainframe host such as host . In such an embodiment, the FlashCopy commands are not intercepted or modified within the host  as described above, but rather simply sent to the storage system  via the I\/O interface  and IOS\/CSS  in the normal fashion. The controller  then performs a mapping or translation of the FlashCopy commands to corresponding SNAP commands such as described in the above table, and provides appropriate FlashCopy responses to the host  based on the results of the execution of the SNAP commands. It should be noted that in such an embodiment there is no use of the \u201cback-end\u201d processing described above, which is specific to the host-based technique. All FlashCopy commands are carried out by firmware within the controller , and corresponding responses are returned to the host in accordance with the specification of the FlashCopy commands."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The foregoing and other objects, features and advantages of the invention will be apparent from the following description of particular embodiments of the invention, as illustrated in the accompanying drawings in which like reference characters refer to the same parts throughout the different views. The drawings are not necessarily to scale, emphasis instead being placed upon illustrating the principles of the invention.",{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 4"}]},"DETDESC":[{},{}]}
