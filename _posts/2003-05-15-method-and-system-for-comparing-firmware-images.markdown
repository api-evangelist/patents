---
title: Method and system for comparing firmware images
abstract: A method and system for comparing firmware images of add-in cards of a computer system, and updating if difference exist.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07080243&OS=07080243&RS=07080243
owner: Hewlett-Packard Development Company, L.P.
number: 07080243
owner_city: Houston
owner_country: US
publication_date: 20030515
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","NOTATION AND NOMENCLATURE","DETAILED DESCRIPTION"],"p":["Computer systems, like home computers or high-end computers operated as servers, utilize firmware. Firmware may be programs executable by a processor, but the programs may be stored in non-volatile solid-state memory, such as read-only memory (ROM). In computer systems such as these, the firmware may provide functionality such as low level input\/output programs, power-on self tests (POST) procedures, and the like.","Add-in cards or devices of a computer system may rely on their own firmware. These add-in devices may comprise modems, network interface cards (NICs), graphics drivers, disk driver controllers, and the like. In cases where multiple add-in devices of the same family are present, differing firmware versions and\/or release numbers may cause incompatibilities or inoperability among the multiple devices.","Updating firmware, whether of the computer system or add-in cards, may be a time-consuming and labor-intensive process. Updating may require booting the computer system from an externally-supplied device, such as a floppy disk drive or a CD ROM, copying an updated firmware image from the externally-supplied device into the computer system, and then flashing or updating the image into the appropriate non-volatile device.","Certain terms are used throughout the following description and claims to refer to particular system components and methods. As one skilled in the art will appreciate, computer companies may refer to components and methods by different names. This document does not intend to distinguish between components and methods that differ in name only. In the following discussion and in the claims, the terms \u201cincluding\u201dand \u201ccomprising\u201dare used in an open-ended fashion, and thus should be interpreted to mean \u201cincluding, but not limited to . . . \u201d. Also, the term \u201ccouple\u201dor \u201ccouples\u201dis intended to mean either an indirect or direct connection. Thus, if a first device couples to a second device, that connection may be through a direct connection, or through an indirect connection via other devices and connections.","The following discussion is directed to various embodiments of the invention. Although one or more of these embodiments may be preferred, the embodiments disclosed should not be interpreted, or otherwise used, as limiting the scope of the disclosure, including the claims. In addition, one skilled in the art will understand that the following description has broad application, and the discussion of any embodiment is meant only to be exemplary of that embodiment, and not intended to intimate that the scope of the disclosure, including the claims, is limited to that embodiment.","At least some of the embodiments of the invention were developed in the context of add-in cards being drive array controllers in a computer system. Embodiments of the invention discussed in the following specification are, therefore, related to the developmental context; however, the systems and methods described herein are not limited only to utilizing the techniques with respect to drive array controllers. Many other add-in cards, devices, and systems within a computer system may utilize the methods and systems described herein.",{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 1","b":["100","100","100","10","100","10","10","12","14","10"]},"The main memory array  may couple to a host bridge  through a memory bus , and the host bridge  may comprise a memory control unit (not specifically shown) that controls transactions to the main memory array  by asserting the necessary control signals during memory accesses. The main memory array  may function as the working memory for the CPU  and may comprise any memory device or array of memory devices in which programs and data may be stored. The main memory array  may comprise any suitable type of memory such as dynamic random-access memory (DRAM), or any of the various types of DRAM devices such as synchronus DRAM (SDRAM), extended data output DRAM (EDO-DRAM), or RAM-bus DRAM (RDRAM).","In at least some embodiments of the invention, computer system  may be a server system, and therefore may not have a dedicated display device. If the computer system  did have a dedicated display device, such a device may be implemented by coupling a graphics driver add-in card to the host bridge  by way of an Advanced Graphics Port (AGP) bus or other suitable bus. Alternatively, the graphics driver card may couple to a primary expansion bus , or one of a variety of secondary expansion buses, for example Peripheral Components Interconnect (PCI) bus . Likewise, computer system  may not comprise a dedicated keyboard and pointing device; however, these devices may be utilized, and if present they may couple to the CPU by way of a controller (not specifically shown) coupled to the PCI bus .","Computer system  may also comprise a second bridge logic device  that may bridge the primary expansion bus  to various secondary expansion buses, such as the PCI bus . The second bridge logic device may, in some embodiments, be referred to an Input\/Output Controller Hub (ICH). Any available chipsets may be utilized to implement the bridge logic devices, such as chipsets provided by Intel Corporation and ServerWorks, Inc. The primary expansion bus  may comprise a Hub-Link bus, which is a proprietary bus of the Intel Corporation; however, computer system  is not limited to any particular type of primary expansion bus, and thus other suitable buses may be equivalently used.",{"@attributes":{"id":"p-0018","num":"0017"},"figref":["FIG. 1","FIG. 1"],"b":["50","50","50","50","22","20","50","50","50","52","52","52","50","100","50","100"]},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 2","b":["50","50","20","100","54","50","56","50","50","58","60","62","64"]},"The controller processor  may execute programs that reside on ROM  by copying the programs to the array controller memory . Executing programs stored in the ROM , the controller processor  may implement functionality, such as operating the hard drives  as a RAID system. The controller processor  may comprise any available processor, such as a Power PC\u00ae 405 processor manufactured by IBM. The controller processor  may couple to each of a plurality of hard drives , by way of a Small Computer System Interface (SCSI) component . While  only shows two hard drives  and two SCSI components , any number of hard drives and SCSI components may be equivalently used, including multiple hard drives coupled to a single SCSI component.","Referring to , the computer system  may comprise several drive array controllers , with each drive array controller  possibly comprising a ROM device  storing a firmware image to be executed by the controller processor . It is possible that the firmware images across multiple drive array controllers  may vary. Some of the reasons for the variation may be, without limitation: newer drive array controllers may be installed having later versions of firmware; and some drive array controllers  may have had their programs updated (to provide added functionality or to fix known problems). Regardless of the reason, inconsistencies between the firmware images of the drive array controllers  may cause interoperability problems, inoperability, or improper operation.","Drive array controllers , in accordance with embodiments of the invention, may have the capability of reading one or more of a vendor identification number, a product identification number and a firmware version number from each of the other drive array controllers  in the computer system . If any of the drive array controllers  within the same family of controllers have different firmware versions than the testing array controller, the testing array controller may flash a copy of its firmware to the other array controller(s). A discussion of a mechanism by which this may occur requires a brief digression into the relationships between hardware and software in exemplary computer system .","Intel Corporation has defined a specification, known as the Extensible Firmware Interface (EFI) specification, that defines a model for the interface between an operating system of a computer and the computer system's hardware. As of the writing of this specification, EFI version No. 1.10, released Jan. 7, 2003, is the latest version. This EFI specification may be obtained from the Intel. Before proceeding, it should be understood that while at least some of the embodiments of the present invention may be implemented in a system that is EFI compliant, the systems and methods are equally applicable in non-EFI-compliant systems.",{"@attributes":{"id":"p-0024","num":"0023"},"figref":["FIG. 3","FIG. 3","FIG. 3"],"b":["70","72","74","76","70","74","76","78","72","74","78","80","72"]},"During pre-boot procedures (before the operating system is given control of the computer system), various pieces of firmware may be executed. The EFI specification may allow programs in each EFI option ROM to execute in the pre-boot time frame to perform specific tasks. Thus, an EFI option ROM in each of the drive array controllers , for example, may be given an opportunity during the pre-boot sequence to execute programs on the CPU  of the host computer system . In accordance with embodiments of the invention, ROM  within each drive array controller  may contain EFI option ROM programs relating to checking and possibly updating firmware in each of the drive array controllers . Alternatively, an independent EFI option ROM  may be used ().","Turning now to , in accordance with embodiments of the invention, the EFI option ROM  (or if combined with other ROM-based functionality, that portion of the programs on the ROM  designated as EFI option ROM) within each of the drive array controllers  may comprise programs to implement the flow diagrams of . In particular, the process may start (block ) and proceed to the program scanning the secondary expansion bus, such as PCI bus , for other similar add-in cards, such as drive array controllers (block ). It should be understood, however, that while the embodiments of the invention described thus far may have the drive array controllers  coupled to a PCI bus, any suitable bus now in use, or after developed, may be equivalently utilized.","After scanning the secondary expansion bus (block ), a determination may be made whether there are other drive array controllers present (block ). If no other drive array controllers are present within the computer system, the process may simply end (block ). If, however, additional drive array controllers are present, the next step in the process may be to read information regarding those additional controllers (block ). In particular, the program may read a vendor identification number (vendor ID), a product identification number (product ID), and\/or a representation of a firmware version for each of the controllers (block ). Thereafter, the program may make a determination as to whether any of the other controllers are of the same product family as the inquiring drive array controller (block ). If other drive array controllers are from the same product family, the program may make a determination of whether any of the controllers have different firmware (block ). In some embodiments, this may be a determination of whether the firmware in the additional controllers is newer, better, and\/or has updated capabilities as compared to the firmware in the drive array controller whose EFI option ROM is currently being executed. In at least some embodiments of the invention, the determination may be made by comparing firmware version numbers, with newer, better, and\/or updated firmware having larger firmware version numbers; however, other mechanisms may be used to identify difference in firmware, such as alphabetic or alpha-numeric listings, and use of these alternative mechanism is within the contemplation of the invention.","If any of the additional controllers have firmware that is different, the program may then make a determination of whether the firmware should be replaced with the firmware image of the drive array controller whose EFI option ROM is currently being executed (block ). If there are other controllers whose firmware is newer, better, and\/or more updated than the firmware of the drive array controller whose EFI option ROM is currently executing, then the newer, better, and\/or updated firmware of the additional controller(s) should not be replaced by the current firmware. If this is the case, the process may simply end (block ). If the drive array controller whose EFI option ROM is executing has the newest, best, and\/or most updated firmware, then it may be advantageous to copy, or flash, the firmware image to the remaining controller. In embodiments where age and\/or capability of firmware are tracked based on a firmware version number, these determinations may be made by comparisons of firmware version numbers.","The next step in the process may be a determination of whether a user would like to update the firmware in the remaining controllers (block ). The determination illustrated by block  may take many forms. In some embodiments of the invention, a user may select whether to proceed on a controller-by-controller basis. Alternatively, the user may simply affirm a desire to update the firmware image on all the drive array controllers whose firmware version number is older than the firmware of the array controller whose EFI option ROM is currently being executed. In yet other embodiments of the invention, the answer to the question may be determined in advance, and thus no user input at the time of upgrade may be required.","Regardless of the precise mechanism by which the question is answered regarding whether to upgrade the firmware image of a drive array controller, if the question is answered in the affirmative, the program being executed may copy its own firmware image in its entirety to the main memory array  of the computer system  (block  of ). At least some of the drive array controllers may have software images that exceed one megabyte in size. While handling a file whose size exceeds one megabyte may be commonplace in post-boot procedures (with the operating system in charge), handling a file of this size may be more difficult in the pre-boot sequences. However, computer systems operated in compliance with the EFI specification, may ease difficulties in handling large files in pre-boot sequences. In particular, in EFI-compliant systems, addressable memory in the main memory array  above the one megabyte boundary may be available for use in the pre-boot sequence. By contrast, in non-EFI-compliant systems, only small portions of the main memory array  below the one megabyte boundary may be utilized. Thus, embodiments of the invention operated in an EFI-compliant system may perform the steps identified by block  directly; that is, the image may be copied in its entirety to main memory array . However, in alternative embodiments of the invention in non-EFI-compliant systems, copying and flashing may be accomplished through a series of smaller copying and flashing steps.","Returning again to , once the image has been copied to main memory (block ), the EFI option ROM program may flash the image to a drive array controller whose firmware is being upgraded (block ). Thus, the EFI option ROM within each drive array controller  may comprise program utilities for performing the flash operation.","Once the flash operation is complete, a determination may be made as to whether there are any additional controllers that require firmware updates (block ). If no other array controllers need an update, the process may end (block ). If an additional controller or controllers need to be updated, then the process may retreat to the flashing step (block ) for each additional controller.","The above discussion is meant to be illustrative of the principles and various embodiments of the present invention. Numerous variations and modifications will become apparent to those skilled in the art once the above disclosure is fully appreciated. For example, steps illustrated in  may be combined, altered, re-arranged, or omitted without departing from the embodiments of the invention. Scanning for other add-in cards illustrated by block  may be combined with reading pertinent information, illustrated by block . It is intended that the following claims be interpreted to embrace all such variations and modifications."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["For a detailed description of the embodiments of the invention, reference will now be made to the accompanying drawings in which:",{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 4A"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 4B"}]},"DETDESC":[{},{}]}
