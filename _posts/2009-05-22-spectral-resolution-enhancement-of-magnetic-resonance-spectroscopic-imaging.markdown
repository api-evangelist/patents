---
title: Spectral resolution enhancement of magnetic resonance spectroscopic imaging
abstract: A method and apparatus for enhancing the spectral resolution of magnetic resonance spectroscopic (MRS) measurements include receiving time domain echo data from an MRS measurement for an MRS volume in a subject. Also received are high spatial resolution complex signal values within the MRS volume based on magnetic resonance imaging (MRI) measurements. Frequency-domain content is determined for the echo data based at least in part on the complex signal values. For example, in some embodiments, receiving complex signal values includes receiving high spatial resolution complex signal values within the MRS volume for each of two different echo time settings. The frequency-domain content of the echo data is corrected for a lineshape profile based on high resolution frequency dispersion values for the MRS volume determined from differences in the complex signal values for the two different echo time settings.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08143890&OS=08143890&RS=08143890
owner: Trustees of Columbia University in the City of New York
number: 08143890
owner_city: New York
owner_country: US
publication_date: 20090522
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","STATEMENT OF GOVERNMENTAL INTEREST","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION","1. Overview of MRS","2. Overview and Theory of Enhanced Spectral Resolution for MRS","3. Method for Enhanced Spectral Resolution of MRS","4. Apparatus for Enhancing Spectral Resolution of MRS Data","5. Example Embodiments","6. Computer Hardware Overview","7. Extensions and Modifications"],"p":["This application claims benefit of Provisional Appln. 61\/056,103, filed May 27, 2008 under 35 U.S.C. \u00a7119(e).","This invention was made with partial government support for Zhengchao Dong by the New York State Psychiatric Institute (NYSPI). The government has certain rights in the invention.","1. Field of the Invention","The present invention relates to magnetic resonance spectroscopy (MRS), and in particular to enhancing spectral resolution of MRS and MRS imaging (MRSI) by de-convolving the effects of spatial variations in the base magnetic field (B) determined from magnetic resonance imaging (MRI). In the following, the base magnetic field or static magnetic field may represent the combination of the external magnetic field and the macroscopic effects of the tissue susceptibility.","2. Description of the Related Art","Nuclear magnetic resonance (NMR) studies magnetic nuclei by aligning them with an applied constant magnetic field (B) and perturbing this alignment using an alternating magnetic field (B), orthogonal to the constant magnetic field. The resulting response to the perturbing magnetic field is the phenomenon that is exploited in magnetic resonance spectroscopy (MRS) and magnetic resonance imaging (MRI).","The elementary particles, neutrons and protons, composing an atomic nucleus, have the intrinsic quantum mechanical property of spin. The overall spin of the nucleus is determined by the spin quantum number I. If the number of both the protons and neutrons in a given isotope are even, then I=0. In other cases, however, the overall spin is non-zero. A non-zero spin is associated with a non-zero magnetic moment, \u03bc, as given by Equation 1a.\n\n\u03bc=\u03b3\u2003\u2003(1a)\n\nwhere the proportionality constant, \u03b3, is the gyromagnetic ratio. It is this magnetic moment that is exploited in NMR. For example, nuclei that have a spin of one-half, like Hydrogen nuclei (H), a single proton, have two possible spin states (also referred to as up and down, respectively). The energies of these states are the same. Hence the populations of the two states (i.e. number of atoms in the two states) will be approximately equal at thermal equilibrium. If a nucleus is placed in a magnetic field, however, the interaction between the nuclear magnetic moment and the external magnetic field means the two states no longer have the same energy. The energy difference between the two states is given by Equation 1b.\n\n\u0394\u2003\u2003(1b)\n\nwhere  is Plank's reduced constant. Resonant absorption will occur when electromagnetic radiation of the correct frequency to match this energy difference is applied. The energy of photons of electromagnetic radiation is given by Equation 2.\n\n\u2003\u2003(2)\n\nwhere f is the frequency of the electromagnetic radiation and h=2\u03c0 . Thus, absorption will occur when the frequency is given by Equation 3.\n\n\/(2\u03c0)\u2003\u2003(3)\n","The NMR frequency f is shifted by the \u2018shielding\u2019 effect of the surrounding electrons. In general, this electronic shielding reduces the magnetic field at the nucleus (which is what determines the NMR frequency). As a result, the energy gap is reduced, and the frequency required to achieve resonance is also reduced. This shift of the NMR frequency due to the chemical environment is called the chemical shift, and it explains why NMR is a direct probe of chemical structure.","Applying a short electromagnetic pulse in the radio frequency range to a set of nuclear spins simultaneously excites all the NMR transitions. In terms of the net magnetization vector, this corresponds to tilting the magnetization vector away from its equilibrium position (aligned along the external magnetic field, B). The out-of-equilibrium magnetization vector precesses about the external magnetic field at the NMR frequency of the spins. This oscillating magnetization induces a current in a nearby pickup coil acting as a radio frequency (RF) receiver, creating an electrical signal oscillating at the NMR frequency. A portion of this time domain signal (intensity vs. time) is known as the free induction decay (FID) and contains the sum of the NMR responses from all the excited spins. In order to obtain the frequency-domain NMR spectrum (intensity vs. frequency) for magnetic resonance spectroscopy (MRS) and MRS imaging (MRSI), this time-domain signal is Fourier transformed.","Spectral resolution refers to the ability to distinguish two closely spaced peaks in any spectrum. It is one of the important criteria that define the quality of MRS and MRSI. Low spectral resolution can obscure the information available from molecules of interest, such as metabolites, in a volume of tissue, thus making difficult or impossible the detection and quantification of some or all of those metabolites.","Reduced spectral resolution is a special problem for in vivo proton MRS (H MRS) of the brain, for several reasons. First, the chemical shift differences of different brain metabolites are relatively small (i.e, the spectral peaks are inherently very close to each other), and the line splitting caused by J-coupling further reduces the separation of the peaks in the spectrum. J-coupling (also called indirect dipole-dipole coupling) is the coupling between two nuclear spins due to the influence of bonding electrons on the magnetic field running between the two nuclei. Consequently, spectral lines of some molecules intrinsically overlap and might not be distinguished. Second, magnetic field inhomogeneity caused by the spatial variation of the static external field Band by local susceptibility differences of different tissues may produce linebroadening and distortion of lineshape, and thereby, reduce spectral resolution. As a result, some lines that are intrinsically separated may overlap in standard MSR measurements and can not be resolved within the portion of the spectrum associated with the metabolites. Third, motion of the person being imaged may produce linebroadening and reduce spectral resolution.","Many techniques have been developed to improve the spectral resolution of in vivo MRS. These techniques can be classified into two categories representing either acquisition or processing of the spectral data.","Within the category of data acquisition, the most commonly employed strategy for improving spectral resolution is the automated techniques for improving the homogeneity of the magnetic field B. Fast and high order shimming techniques have been implemented on modern scanners to make Bmore uniform across a subject being scanned, yet these methods cannot eliminate all variation in local magnetic fields that are caused by the differing magnetic susceptibilities of various interposed tissues within the body. To image at higher magnetic field strengths is another strategy to increase spectral resolution, as well as the signal-to-noise ratio (SNR) of the MRS. Theoretically, doubling the field strength should double the differences in chemical shifts and the separations peaks in the metabolic spectrum. Unfortunately, the observed benefit of higher field strengths in improving spectral resolution is much lower than theoretically predicted. For example, spectral resolution at 3 Tesla (T, 1 T=1 Newton per Ampere per meter) only increases marginally compared with spectral resolution obtained at 1.5 T. Two reasons for this are that scanners with higher field strengths come with greater inhomogeneity of their magnetic fields, and the higher fields shorten the Trelaxation times of metabolites, both of which increase linewidths of the spectrum. The Trelaxation time is the time for precessing nuclei to fall out of alignment with each other (returning the net magnetization vector to a non-precessing field) and thus stop producing a signal. In addition, the upper limit on field strength is constrained by practical and safety considerations. Techniques of fast acquisition of data can reduce the total scan time and thereby reduce the likelihood that the person being imaged moves, and this will indirectly reduce the linebroadening caused by subject motion. Other acquisition-based techniques that are designed to improve spectral resolution include higher spatial resolution MRSI and 2 dimensional (2D) J-resolved MRSI. However, both of these techniques usually require long scan times which cannot be afforded in many clinical and research applications.","Most processing methods to improve spectral resolution are either borrowed or modified from those commonly used in processing conventional Nuclear Magnetic Resonance (NMR), but these usually produce very limited improvements of spectral resolution for data acquired in vivo. The method of Positive Exponential Multiplication (PEM), for example, multiplies the free induction decay (FID, defined above) with a positive exponential function. Although this operation can increase the spectral resolution, it also increases noise in the signal and reduces its overall SNR. This is a price that usually cannot be afforded with the in vivo data, because the SNR of in vivo MRS is typically already very low. A method similar to PEM is the double exponential multiplication (DEM), which transforms the Lorentzian lineshape to a Gaussian lineshape, which has a narrower linewidth at the bottom of a peak than the former does. With carefully selected exponential factors, DEM can improve spectral resolution while largely preserving the SNR. Because the lineshape of in vivo MRS is more Gaussian than Lorentzian, however, DEM has limited applicability for in vivo MRSI. Another processing-based method is the spectral de-convolution using the isolated singlet of water as a reference. An assumption of this approach is that the water peak and metabolic peaks have an identical lineshape, which is not always true for in vivo MRSI due at least to two reasons: 1] the differences in distribution profiles; and 2] the chemical shift artifacts. Moreover, acquiring an MRSI for water doubles the total MRSI scan time (about 30 minutes per scan), which cannot be afforded in many clinical and research applications. Because of these inherent difficulties, the existing processing-based methods have limited applicability for improving spectral resolution in MRSI in vivo.","Techniques are provided for enhancing the spectral resolution of magnetic resonance spectroscopy (MRS).","In one set of embodiments, a method includes receiving time domain echo data from an MRS measurement for an MRS volume in a subject. Also received are high spatial resolution complex signal values within the MRS volume based on magnetic resonance imaging (MRI) measurements. Frequency-domain content is determined for the echo data based at least in part on the complex signal values.","In another set of embodiments, a method includes collecting time domain echo data (such as FID data) for an MRS volume in a subject using an MRS system. Also collected are high spatial resolution complex signal values in the MRS volume using a magnetic resonance imaging (MRI) mode of the MRS system. Frequency-domain content of the echo data is determined based at least in part on the complex signal values.","In other embodiments, an apparatus or a computer-readable medium is configured to perform one or more steps of the above methods.","A method and apparatus are described for enhancing the spectral resolution of magnetic resonance spectroscopy (MRS) and, consequently magnetic resonance spectroscopic imaging (MRSI). In the following description, for the purposes of explanation, numerous specific details are set forth in order to provide a thorough understanding of the present invention. It will be apparent, however, to one skilled in the art that the present invention may be practiced without these specific details. In other instances, well-known structures and devices are shown in block diagram form in order to avoid unnecessarily obscuring the present invention.","Some embodiments of the invention are descried below in the context of detecting brain metabolites in magnetic resonance spectroscopic imaging (MRSI). However, the invention is not limited to this context. In other embodiments one or more other constituents in a magnetic resonance spectroscopy (MRS) volume are determined for imaging or non imaging operations on human or non-human or inanimate subjects, in vivo or not.",{"@attributes":{"id":"p-0046","num":"0045"},"figref":"FIG. 1A","b":["101","110","102","104","110"],"sup":"\u22123 "},{"@attributes":{"id":"p-0047","num":"0046"},"figref":["FIG. 1B","FIG. 1A"],"b":["151","152","154","151","160","110","160","162","162","164","166","168"],"sup":"6","sub":["r","0","r ","0 ","0"],"i":["a ","b"]},{"@attributes":{"id":"p-0048","num":"0047"},"figref":["FIG. 2","FIG. 1B"],"b":["201","152","154","260","263","263","263","263","263","263","263","162","166","160","263","163","162","160","263","168","160","263","260"],"sub":"0","i":["a","b","c","d","e ","f ","a ","c ","b ","d ","d "]},"The inventors have discovered that desirable improvement in resolution of MR spectra can be obtained more efficiently than extant approaches. These techniques significantly enhance the spectral resolution of MRS and MRSI by correcting local field in-homogeneities caused both by the main field Band susceptibility differences of the tissues. A second, time-consuming water MRSI scan is not required. Certain embodiments are validated and demonstrated by phantom and in vivo experiments. The results show that these techniques can not only enhance the spectral resolution, and improve the lineshape but also increase the SNR of both MRS and MRSI.","At a given magnetic field strength, spectral resolution is related to linewidth of the spectrum, which is in turn determined jointly by the natural linewidth and linebroadening that is caused by inhomogeneity of the magnetic field. Microscopically, the linewidth of a metabolite spectrum from a particular MRS volume of a subject can be regarded as a combination of many spectral lines originating from tiny sub-volumes of the particular volume, each of these having their natural linewidths but with their differing frequencies altered slightly by the small strength differences of local field where the sub-volumes are located. Mathematically, this combination is described as a procedure of convolution of the natural linewidth and the profile of the lineshape. For in vivo MRSI, the profile of lineshape or the lineshape function is determined largely by the linebroadening caused by the field inhomogeneity in the static magnetic field, B.","The inventors have determined that the profile of the lineshape can be derived from the summation of the spectral lines with infinite linewidths. After de-convolving the measured spectra from the lineshape function that is derived from the measured field mapping, the inventors discovered that the linewidth is reduced significantly and thereby the spectral resolution of the in vivo MRS is enhanced. The inventors have designated some embodiments of this method as Spectral Resolution Amelioration by De-convolution (SPREAD). The field mapping can be generated with one or two MRI scans about three minutes each or less.","The following theoretical description is provided for purposes of more thoroughly explaining the disclosed embodiments. However, the invention is not limited by the completeness or accuracy of the following theoretical description.","A particular MRS volume is excited and all or part of the echo measured from that particular volume by using phase encoding (PE) magnetic gradient pulses with gradient magnitude G(t) and duration \u03c4 that impose spatial information on the MR signals of nuclei in the subject, as is well known in the art. The properties of the gradient pulses are expressed by a wavenumber k in the spatial-frequency (wavenumber) domain. A vector wavenumber {right arrow over (k)} is defined by Equation 4a.",{"@attributes":{"id":"p-0054","num":"0053"},"maths":{"@attributes":{"id":"MATH-US-00001","num":"00001"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mover":{"mi":"k","mo":"\u2192"},"mo":"=","mrow":{"mi":"\u03b3","mo":"\u2062","mrow":{"msubsup":{"mo":"\u222b","mn":"0","mi":"\u03c4"},"mo":"\u2062","mrow":{"mrow":[{"mover":{"mi":"G","mo":"\u2192"},"mo":"\u2061","mrow":{"mo":["(",")"],"mi":"t"}},{"mo":"\u2146","mi":"t"}],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.2em","height":"0.2ex"}}}}}}}},{"mrow":{"mo":["(",")"],"mrow":{"mn":"4","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"a"}}}]}}}},"br":{}},{"@attributes":{"id":"p-0055","num":"0054"},"maths":{"@attributes":{"id":"MATH-US-00002","num":"00002"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mtable":{"mtr":[{"mtd":{"mrow":{"msub":{"mrow":{"mi":"S","mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}},"msub":{"mover":{"mi":"k","mo":"\u2192"},"mi":"n"}},"mo":["=","\u2062"],"mi":{},"mrow":{"msubsup":{"mo":"\u222b","mrow":[{"mrow":{"mrow":{"mo":"-","mi":"SW"},"mo":"\/","mn":"2"},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"R"},{"mi":"SW","mo":"\/","mn":"2"}]},"mo":"\u2062","mrow":{"mo":"\u222b","mrow":{"mrow":[{"mi":"\u03c1","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mover":{"mi":"r","mo":"\u2192"},"mo":",","mi":"f"}}},{"mo":"\u2146","mover":{"mi":"r","mo":"\u2192"}},{"mo":"\u2146","mi":"f"}],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062"],"msup":{"mi":"\u2147","mrow":{"mrow":[{"mi":"j","mo":["\u2062","\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mn":"2","mrow":{"mi":"\u03c0","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mrow":{"msub":{"mover":{"mi":"k","mo":"\u2192"},"mi":"n"},"mo":"\u00b7","mover":{"mi":"r","mo":"\u2192"}},"mo":"+","msub":{"mi":["ft","d"]}}}}},{"mi":["j2","\u03c0","\u0394"],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mrow":{"mi":"f","mo":"\u2061","mrow":{"mo":["(",")"],"mover":{"mi":"r","mo":"\u2192"}}},"msub":{"mi":["t","d"]}}],"mo":"+"}},"mstyle":[{"mspace":{"@attributes":{"width":"0.2em","height":"0.2ex"}}},{"mspace":{"@attributes":{"width":"0.2em","height":"0.2ex"}}}]}}}}}},{"mtd":{"mrow":{"mo":["=","\u2062"],"mi":{},"mrow":{"msubsup":{"mo":"\u222b","mrow":[{"mrow":{"mrow":{"mo":"-","mi":"SW"},"mo":"\/","mn":"2"},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"R"},{"mi":"SW","mo":"\/","mn":"2"}]},"mo":"\u2062","mrow":{"mo":"\u222b","mrow":{"mrow":[{"mo":["[","\u2062","]"],"mrow":{"mrow":{"mi":"\u03c1","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mover":{"mi":"r","mo":"\u2192"},"mo":",","mi":"f"}}},"mo":"\u2062","msup":{"mi":"\u2147","mrow":{"mi":["j","\u03c0\u0394"],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mn":"2","mrow":{"mi":"f","mo":"\u2061","mrow":{"mo":["(",")"],"mover":{"mi":"r","mo":"\u2192"}}},"msub":{"mi":["t","d"]}}}},"mstyle":{"mspace":{"@attributes":{"width":"0.2em","height":"0.2ex"}}}},{"mo":"\u2146","mover":{"mi":"r","mo":"\u2192"}},{"mo":"\u2146","mi":"f"}],"mo":["\u2062","\u2062","\u2062","\u2062"],"msup":{"mi":"\u2147","mrow":{"mi":"j","mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mn":"2","mrow":{"mi":"\u03c0","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mrow":{"msub":{"mover":{"mi":"k","mo":"\u2192"},"mi":"n"},"mo":"\u00b7","mover":{"mi":"r","mo":"\u2192"}},"mo":"+","msub":{"mi":["ft","d"]}}}}}},"mstyle":{"mspace":{"@attributes":{"width":"0.2em","height":"0.2ex"}}}}}}}}}]}},{"mrow":{"mo":["(",")"],"mrow":{"mn":"4","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"b"}}}]}}}},"br":[{},{},{}],"sub":["n ","d","1","2","D "],"in-line-formulae":[{},{}],"i":["f","{right arrow over (r)}","B","{right arrow over (r)}"]},"As described in more detail below, \u0394f can be derived from MRI measurements; and such derivation has been used to create images at MRI spatial resolution called field maps that indicate spatial variations in \u0394B by virtue of Equation 5. MRI spatial resolution provides imaging volume elements (voxels) that are much smaller than a typical MRS voxel. For example, an MRSI voxel is approximately three orders of magnitude larger than a high resolution MRI voxel (e.g., an MRSI voxel is on the order of cubic centimeters, cm, and a MRI voxel is on the order of cubic millimeters, mm, where 1 mm=10meters and 1 cm=10meters).","In the case of conventional two spatial dimensions (2D) MRSI, as is well known, there are Nx phase encoding steps in the x direction and Ny phase encoding steps in the y direction, where x and y directions are perpendicular to each other and to the direction z. The static magnetic field Bis often in the z direction, but need not be. In this case, Equation 6a expresses the relationship between the wavenumber vectors.\n\n()=1,2()\u2003\u2003(6a)\n\nThis results in Nx*Ny phase encoded signals, which are represented by a three dimensional (3D) matrix in wavenumber space, with two spatial dimensions and one time domain spectral dimension as given by Equation 6b.\n",{"@attributes":{"id":"p-0058","num":"0057"},"maths":{"@attributes":{"id":"MATH-US-00003","num":"00003"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"msub":{"mrow":[{"mo":["{","}"],"msub":{"mrow":[{"mi":"S","mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}},{"msub":[{"mi":["k","nx"]},{"mi":["k","ny"]}],"mo":","}]}},{"msub":[{"mi":["N","x"]},{"mi":["N","y"]}],"mo":["\u00d7","\u00d7"],"mi":"D"}]}},{"mrow":{"mo":["(",")"],"mrow":{"mn":"6","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"b"}}}]}}}},"br":{}},{"@attributes":{"id":"p-0059","num":"0058"},"maths":{"@attributes":{"id":"MATH-US-00004","num":"00004"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"msub":{"mi":["s","V"]},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}},{"msubsup":{"mo":"\u222b","mrow":[{"mrow":{"mrow":{"mo":"-","mi":"SW"},"mo":"\/","mn":"2"},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"V"},{"mi":"SW","mo":"\/","mn":"2"}]},"mo":"\u2062","mrow":{"mo":"\u222b","mrow":{"mrow":[{"mo":["[","]"],"mrow":{"mrow":{"mi":"\u03c1","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mover":{"mi":"r","mo":"\u2192"},"mo":",","mi":"f"}}},"mo":"\u2062","msup":{"mi":"\u2147","mrow":{"mi":["j","\u03c0","\u0394"],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mn":"2","mrow":{"mi":"f","mo":"\u2061","mrow":{"mo":["(",")"],"mover":{"mi":"r","mo":"\u2192"}}},"msub":{"mi":["t","d"]}}}}},{"mo":"\u2146","mover":{"mi":"r","mo":"\u2192"}},{"mo":"\u2146","mi":"f"}],"mo":["\u2062","\u2062","\u2062","\u2062"],"msup":{"mi":"\u2147","mrow":{"mi":"j","mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mn":"2","mrow":{"mi":"\u03c0","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mrow":{"msub":{"mover":{"mi":"k","mo":"\u2192"},"mi":"n"},"mo":"\u00b7","mover":{"mi":"r","mo":"\u2192"}},"mo":"+","msub":{"mi":["ft","d"]}}}}}},"mstyle":{"mspace":{"@attributes":{"width":"0.2em","height":"0.2ex"}}}}}}],"mo":"="}},{"mrow":{"mo":["(",")"],"mn":"7"}}]}}}},"br":{},"sub":"0 "},"It is further assumed, for purposes of explanation, that \u03c1({right arrow over (r)},f) is constant across the MRS voxel V. Equation 7 then can be written as expressed in Equation 8.",{"@attributes":{"id":"p-0061","num":"0060"},"maths":{"@attributes":{"id":"MATH-US-00005","num":"00005"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"msub":{"mi":["s","V"]},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}},{"mrow":[{"msubsup":{"mi":["s","V"],"mn":"0"},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}},{"msub":{"mo":"\u222b","mi":"V"},"mo":"\u2062","mrow":{"msup":{"mi":"\u2147","mrow":{"mi":["j","\u03c0\u0394"],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mn":"2","mrow":{"mi":"f","mo":"\u2061","mrow":{"mo":["(",")"],"mover":{"mi":"r","mo":"\u2192"}}},"msub":{"mi":["t","d"]}}},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.2em","height":"0.2ex"}}},"mrow":{"mo":"\u2146","mover":{"mi":"r","mo":"\u2192"}}}}],"mo":"\u00b7"}],"mo":"="}},{"mrow":{"mo":["(",")"],"mn":"8"}}]}}}},"br":{},"sub":["V","d","V","d"],"sup":"0"},"The ideal signal s(t) can be recovered from the measured signal s(t) by dividing the lineshape profile in a point-by-point manner as given in Equation 9.",{"@attributes":{"id":"p-0063","num":"0062"},"maths":{"@attributes":{"id":"MATH-US-00006","num":"00006"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"msubsup":{"mi":["s","V"],"mn":"0"},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}},{"mrow":[{"msub":{"mi":["s","V"]},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}},{"msub":{"mo":"\u222b","mi":"V"},"mo":"\u2062","mrow":{"msup":{"mi":"\u2147","mrow":{"mi":["j","\u03c0\u0394"],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mn":"2","mrow":{"mi":"f","mo":"\u2061","mrow":{"mo":["(",")"],"mover":{"mi":"r","mo":"\u2192"}}},"msub":{"mi":["t","d"]}}},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.2em","height":"0.2ex"}}},"mrow":{"mrow":{"mo":"\u2146","mover":{"mi":"r","mo":"\u2192"}},"mo":"."}}}],"mo":"\/"}],"mo":"="}},{"mrow":{"mo":["(",")"],"mn":"9"}}]}}}},"br":{},"sub":["V","d","V","d"],"sup":"0"},"As mentioned above and described in more detail below, \u0394f is derived from MRI measurements on much smaller MRI voxels. Because the typical MRS voxel is approximately 3 orders of magnitude larger than a high resolution MRI voxel, in some embodiments, the integration in the denominator in Equation 9 is approximated by the summation of the integrand over all high resolution MRI voxels in the lower resolution MRS voxel. This approximation is expressed in Equation 10.",{"@attributes":{"id":"p-0065","num":"0064"},"maths":{"@attributes":{"id":"MATH-US-00007","num":"00007"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"msub":{"mo":"\u222b","mi":"V"},"mo":"\u2062","mrow":{"msup":{"mi":"\u2147","mrow":{"mi":["j","\u03c0\u0394"],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mn":"2","mrow":{"mi":"f","mo":"\u2061","mrow":{"mo":["(",")"],"mover":{"mi":"r","mo":"\u2192"}}},"msub":{"mi":["t","d"]}}},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.2em","height":"0.2ex"}}},"mrow":{"mo":"\u2146","mover":{"mi":"r","mo":"\u2192"}}}},{"munderover":{"mo":"\u2211","mrow":{"mi":"i","mo":"=","mn":"1"},"mi":"N"},"mo":"\u2062","msup":{"mi":"\u2147","mrow":{"mi":["j","\u03c0\u0394"],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mn":"2","mrow":{"mi":"f","mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["v","i"]}}},"msub":{"mi":["t","d"]}}}}],"mo":"\u2248"}},{"mrow":{"mo":["(",")"],"mn":"10"}}]}}}},"br":{}},"In other embodiments, described in more detail below, the lineshape profile based on the MRI measurements is modified to better match the processing performed on the MRSI data and to account for PSF effects. Furthermore, in some embodiments, the lineshape profile is further modified to prevent spikes in the de-convolved spectrum where the lineshape profile crosses zero. In some embodiments, the lineshape profile is further modified to prevent noise amplification where the signal amplitude falls to values comparable to the noise level.","Equation 9 was derived under the assumption that the spin density \u03c1({right arrow over (r)},f) is constant within a voxel V, which is clearly not always true, especially in voxels consisting of multiple tissue types. In such circumstances, the lineshape is a function of both the field inhomogeneity and the concentrations of metabolites. However, field inhomogeneity is dominant and the effect of the spatial varying concentration within the voxel is small. Moreover, the two effects are independent and the final lineshape after de-convolution would be concentration weighted compared to the ideal lineshape. This approximation is often acceptable. In other embodiments, spin density variations within a voxel are estimated or assumed and accounted for in the lineshape profile determined and applied.",{"@attributes":{"id":"p-0068","num":"0067"},"figref":["FIG. 7","FIG. 7"],"b":["700","720","720","730","710"]},"In step , MRS time-domain echo data is collected from one or more MRS volumes in a subject. For example, free induction decay (FID) data is collected during step . Step  includes operating an MRS apparatus or system to deliver one or more phase encoded pulses and measure the phase encoded currents in a receiving antenna coil. This includes performing any shimming to make the static magnetic field Bas spatially uniform as possible. Step  also includes receiving the echo data at a data processing device, such as a general purpose computer. Any method may be used to perform step .","For example, in an illustrated embodiment, during step , MRS data was acquired using a whole-body 3 T scanner (Signa 3.0 T, GE Healthcare, Waukesha, Wis.) equipped with a single-channel volume coil for transmission and a standard quadrature head coil for receiving radiofrequency (RF) signals. Scout images in 3 orthogonal planes were first acquired for the localization of MRSI images. MRSI data were acquired using a multi-planar MRSI pulse sequence as described in Duyn J H, Gillen J, Sobering G, van Zijl P C, Moonen C T, \u201cMultisection proton MR spectroscopic imaging of the brain,\u201d 1993, 188(1) pp 277-282. Image slices were placed in the axial plane and were angulated so as to parallel the anterior commissure-posterior commissure (AC-PC) line. The parameters used for data acquisition were as follows. Field of View (FOV) was set to 24\u00d724 cm. Number of slices was set to 4. Nominal number of phase encoding (PE) steps in the x and y directions was set to 16\u00d716 (data were sampled in an inscribed circle of diameter 16 in wavenumber space, resulting in an actual number of 180 PEs). Slice thickness was set to 10 mm, with spacing between slices set to 2 mm. The nominal MRS voxel size was therefore 2.25 cm. Repetition time (TR) was set to 2800 ms after an echo time (TE) of 144 ms. Spectral width of the RF receiver was 2000 Hz. An asymmetric echo with a long tail was acquired with 512 complex data points. Outer volume lipid signal was suppressed with user-placed saturation bands. Water suppression was realized by the CHESS pulses imbedded in the phase encoded sequence as described in Haase A, Frahm J, Hanicke W, Matthaei D., \u201cH NMR chemical shift selective (CHESS) imaging,\u201d 1985, 30(4) pp 341-344.","In step , MRI complex signal data is collected from multiple high resolution MRI voxels within each MRS volume at two different echo times. Step  includes operating an MRS apparatus or system to deliver one or more phase encoded pulses and measure the phase encoded currents in a receiving antenna coil at the two echo times. This includes performing any shimming performed during step  to make the static magnetic field Bas spatially uniform as possible. Step  also includes receiving the complex signal data at a data processing device, such as a general purpose computer. Any method may be used to perform step . For example, in some embodiments, an MRI scan can be run with TE1 and then another MRI scan with TE2, at three to four minutes each. In some embodiments, a single MRI scan can be run with embedded TE1 acquisition and different TE2 acquisition.","In an illustrated embodiment, during step , immediately following step , high resolution MR images for field mapping were acquired using a commercial 3D MRI pulse sequence called Incoherent RF Spoiled Gradient Echo (SPGR). The slices of the 3D SPGR were parallel to the slices of the MRSI and the imaged volume of the 3D SPGR is slightly larger than that of the MRSI. The echo times of the two MR images were 8 and 10.5 ms, respectively. Other imaging parameters for the field mapping MRI sequence were as follows. The FOV was set to 24\u00d724 cm. The slice thickness was set to 2 mm. The in-plane resolution was 256\u00d7256, resulting in a nominal spatial resolution of 1.7 mm. TR was set to 13 ms. The flip angle was set to 11. The RF receiver bandwidth, SW was 15.6 kHz. As a result, each MRSI slice covers 5 MRI slices and each MRS volume overlaps 1280 MRI voxels. To ensure identical field inhomogeneity during both the MRSI scan and MRI scan, only first order shimming was performed for MRSI, and the same shim values were kept for the MRI scans. All wavenumber space data for MRI were saved in complex form to facilitate generating the field maps. In addition, all MRI data were saved in the conventional magnitude form in the well-known DICOM format.","Step  follows step  in a preferred embodiment, because the shimming, PE encoding and other operational settings of the MRS measurement are already in place for the corresponding MRI measurements. In some embodiments, the shimming scan is done first; then the MRI scans are done without further shimming; then the MRSI scan is done without further shimming. In this way, both MRI and MRSI scans have the same shimming, and thus the same magnetic field inhomogeneity.","During step , frequency dispersion is computed for each MRS volume based on differences in MRI complex signal data for the two echo times, as described in more detail in the next section.","In step , the frequency dispersion is de-convolved from the MRS echo data to obtain corrected echo data. Step  includes determining a lineshape profile based on the frequency dispersion. In some embodiments, step  includes determining and applying modifications to match the wavenumber space processing in the MRS data processing, or suppressing spikes at zero crossing of the lineshape profile, or suppressing noise amplification, or performing other corrections, or some combination, as described in more detail in a later section.","In step , the frequency-domain content (e.g., the MRS spectrum) is computed for the corrected echo data. The resulting spectrum has enhanced spectral resolution.","These embodiments have several advantages over the long standing spectral de-convolution technique using internal water as a reference, as described in Macri M A, Garreffa G, Giove F, Guardati M, Ambrosini A, Colonnese C, Maraviglia B, \u201cIn vivo quantitative 1H MRS of cerebellum and evaluation of quantitation reproducibility by simulation of different levels of noise and spectral resolution,\u201d 2004, 22(10), pp 1385-139. The lineshape of unsuppressed water signal depends not only on spatial variation of the magnetic field Bbut also on the distribution of water content of the brain. When more than one tissue types with differing water contents, such as gray matter and white matter in a human brain, especially cerebrospinal fluid, co-exist in significant quantities in an MRS voxel, the lineshape of water signal will deviate from the lineshape caused purely by field inhomogeneity. On the other hand, the illustrated embodiments eliminate lineshape distortion caused solely by field inhomogeneity. The Trelaxation time of tissue water is shorter than those of most metabolites and, therefore, the water signal decays more rapidly than metabolite signals in the time domain. Consequently, noise amplification and spike artifacts often occur at both ends of the resultant de-convolved signal, when water signal becomes smaller than the metabolite signals. Therefore, the gain in resolution improvement is often at the price of deteriorated SNR. On the other hand, Trelaxation time of the reconstructed lineshape signal is virtually infinite, and the lineshape signal decays slower than any metabolite signals. Therefore, the noise amplification and spike artifacts can largely be avoided. Internal water signal requires measuring the water MRSI in addition to the metabolite MRSI, which means double the total MRSI scan time. This is often unaffordable in many situations. Although the illustrated embodiments include MRI measurements for and computations of magnetic field maps, the time for measuring and determining these maps is about three minutes or less, only a small portion of the time for MRSI scan.","The illustrated embodiments, such as SPREAD, improve the spectral resolution by narrowing the linewidth and correcting lineshape distortion. These embodiments effectively increase the separations between spectral peaks, without increasing their absolute frequency differences, which is different from the strategies of imaging at higher magnetic field. Preliminary results showed that the SPREAD embodiment increased the spectral resolution by up to 50% and more in a phantom and up to 25% and more in human scans, which is higher than the increase of spectral resolution from 1.5 T to 3 T (see, for example, Dydak U, Schar M, \u201cMR spectroscopy and spectroscopic imaging: comparing 3.0 T versus 1.5 T,\u201d 2006, 16(2) pp 269-283). A current comparison study on the SNR of proton MRS between 3 T and 7 T, shows that the SNR only improved marginally at 7 T against 3 T (Y Li et al., 16 (2008), p 1592). This is likely because the increased linewidth at higher magnetic field strength can almost completely offset the increase in the chemical shifts. Another advantage of the SPREAD embodiment over the higher magnetic field strength strategy is that the SPREAD embodiment improves the lineshape of the spectrum and therefore allows improving the accuracy of the spectral fitting. Furthermore, the SPREAD embodiment avoids the adverse effects of higher magnetic field strengths, such as decreased SNR, increase chemical shift artifact, as well as increased RF field (B) inhomogeneity.","The performance of the illustrated embodiments for spectral resolution enhancement depends on the accurate field mapping and, thereby, the accurate reconstruction of the experimental lineshape. In general, the higher the resolution is, the more accurate the field mapping is. However, higher resolution may require longer measurement time, or result in lower SNR. The latter is detrimental for the accuracy of field mapping. In our pilot study, we found that the experimental lineshape reconstructed from ten 2D field maps of 1 mm thick was not superior to that reconstructed from 5 field maps of 2 mm thick, under the condition that the measurement time and the in-plane resolution of each slice was the same. This is likely because the benefit of higher spatial resolution was balanced by the disadvantage of lower SNR. 3D MRI sequence is preferable for high resolution field mapping in some embodiments, as it can generate MR images with much higher SNR than the 2D mode can.","3.1 Magnetic Field Mapping","During step , the frequency dispersion is determined in the course of performing magnetic field mapping as taught by Willcott M R, 3rd, Mee G L, Chesick J P., \u201cMagnetic field mapping in NMR imaging,\u201d 1987, 5(4) pp 301-306.","For purpose of illustrating how frequency dispersion is derived from MRI measurements at two different echo times, consider the following description.  is a graph  that illustrates an example applied magnetic field B for a one dimensional high spatial resolution MRI measurement. The horizontal axis  is distance in the x direction (e.g., in mm), perpendicular to the direction of the constant magnetic field B. The vertical axis  is magnetic flux density (e.g., in Tesla, T). The constant magnetic field in the z direction, B, is plotted as curve  and shows small variations as x varies. A change in the z direction magnetic field with changes in x position is called the gradient magnetic field G and is applied to distinguish different volumes within a subject for spatial encoding. The resulting magnetic field B from the gradient G is also plotted in the graph . The subject  occupies x positions between position  and position  on the x axis . A point x is depicted within the subject , and represents a high resolution MRI voxel location, with a width comparable to the width of the tick mark. MRSI uses electromagnetic wave returns from voxels that each represents a wider range of x values, so one dimensional low resolution voxels are depicted along the x axis, including voxel and voxel , collectively referenced hereinafter as MRSI voxels .","Along the x direction, the magnetic field is given by Equation 11.\n\n\u2003\u2003(11)\n\nThe frequency fof a proton with gyromagnetic ratio \u03b3 at point xis given by Equation 12.\n\n()\u2003\u2003(12)\n\nIn the presence of G, nuclei at different positions x have different resonant frequencies, and their signals (the so called wavenumber signal) can thus be spatially encoded. After data acquisition, a spatial Fourier Transform (FT) is used to decode the signal and recover the position of the signal within the subject.\n","At an initial time, t0, the protons in the field B are perturbed with a magnetic field in the y direction, perpendicular to x and z, and those perturbed protons precess about the z direction with a frequency equal to the magnetic resonance frequency f. If data is collected after a delay of TE1, then the protons have precessed by an angle associated with a phase \u03b21 that is related to the precession frequency. For example, at point x, \u03b21, in units of radians, is given by Equation 13a.\n\n\u03b21()=21=2()*1\u2003\u2003(13a)\n\nThe measured MRI signal at position xis given by Equation 13b.\n\n1(1)=0*exp(1)=0*exp(21)\u2003\u2003(13b)\n\nwhere exp( ) is a function that raises the natural constant e to the power of the value inside the parentheses, j is the square root of \u22121, and s(x,t) is a complex number. The raw data from an MRI measurement with echo time=TE1 is a vector of complex number with phases of \u03b21 that vary with x. The phase is determined from these measurements of s1(x,t) by a function of the real and imaginary parts as measured by quadrature receiver coils in the MRS apparatus (e.g., \u03b2=arctan (imaginary part\/real part)). By analogy, in a two dimensional case the raw data is a matrix of complex numbers with phases \u03b21 that vary with x and y.\n",{"@attributes":{"id":"p-0084","num":"0083"},"figref":["FIG. 4A","FIG. 4A"],"b":["401","402","404","405","412","414"]},"If data is collected after a delay of TE2, then the protons have precessed by an angle associated with a phase \u03b22 that is related to the precession frequency. For example, at point x, \u03b22, in units of radians, is given by Equation 13c.\n\n\u03b22()=22=2()*2\u2003\u2003(13c)\n\nThe measured MRI signal at position xis given by Equation 13d.\n\n2(2)=0*exp(*\u03b22)=0*exp(*22)\u2003\u2003(13d)\n\nThe raw data from an MRI measurement with echo time=TE2 is a vector of complex number with phases of \u03b22 that vary with x. By analogy, in a two dimensional case the raw data is a matrix of complex numbers with phases \u03b22 that vary with x and y.\n",{"@attributes":{"id":"p-0086","num":"0085"},"figref":["FIG. 4B","FIG. 4A","FIG. 4B","FIG. 4A"],"b":["451","402","404","401","405","462","464"]},"The only difference between s1(x,t) from Equation 13b and s2(x,t) from Equation 13d is the phase angles. The phase angle difference is given by Equation 14.\n\n\u0394\u03b2=\u03b22\u2212\u03b21\u2003\u2003(14)\n\nThe distribution of precession frequency fis derived from the spatial distribution of \u0394\u03b2 using Equation 15a and Equation 15b.\n\n=\u0394\u03b2\/(2)\u2003\u2003(15a)\n\nwhere \u03942\u22121\u2003\u2003(15b)\n\nDifferencing on a voxel by voxel basis gives a vector of \u0394f values for 1D MRI data and a matrix of \u0394f values for 2D MRI data.\n","If there is frequency dispersion, such as caused by variations in the static magnetic field B, then the difference in the two measured values s1(x,t) and s2(x,t) at different positions x, corrected for different values of the gradient G, will not reflect the same value of f. The spread of frequency among close positions is denoted the dispersion, \u0394f. A lineshape profile for an MRS volume is based on the dispersion of f at all MRI voxels within an MRS volume, as described in more detail in a later section. For purposes of illustration, an example lineshape profile associated with the value fis depicted in , e.g., for one high resolution MRI voxel at location xwithin MRSI voxel .  is a graph  that illustrates an example lineshape profile for the one-dimensional high spatial resolution MRI measurement of , according to an embodiment. In the time domain the lineshape profile is an oscillating function with a period related to f. The Fourier transform to the frequency domain shows a peak at fwith width related to the intrinsic linewidth, so the lineshape profiles are shown in the frequency domain. The horizontal axis  is frequency; and, the vertical axis  is intensity. A lineshape profile  is plotted, which shows a peak at f. The peak shape is Lorentzian and the width is very small for lineshape profile .  is a graph  that illustrates an example lineshape profile for the one-dimensional low spatial resolution MRSI measurement, according to an embodiment. The frequency axis  and intensity axis  are as described above for . The lineshape profile  is plotted for MRSI voxel based on Equation 10. With an inhomogeneous Bacross the MRSI voxel , the peak shape is distorted and non-Lorentzian, and the width, broadened by \u0394B (related to frequency dispersion \u0394f), is many times wider for lineshape profile  compared to lineshape profile .",{"@attributes":{"id":"p-0089","num":"0088"},"figref":["FIG. 4C","FIG. 4A","FIG. 4B","FIG. 4C"],"b":["471","402","404","401","475","472","474","471"],"sub":"0"},"In an illustrated embodiment, MR images in the complex format were reconstructed from wavenumber space data by applying spatial Fast Fourier Transform (FFT) processing, well known in the art, following a 2D spatial filtering with a Hamming window function, also well known. The phase unwrapping procedure was performed using a program provided by Dr. Peled (see, N. Saad, S. Peled, \u201cEasy 3D Phase Unwrapping\u201d, 13 (2005), p2251). However, complex conjugate multiplication of the paired MR images with different TEs were used as the input instead of the individual MR images for computational efficiency and robustness, as described in Meyer C, Irarrazabal P., \u201cMagnetic field inhomogeneity correction in MRI using estimated linear magnetic field map,\u201d U.S. Pat. No. 5,617,028, 1997. These unwrapped phase images were converted into field maps as represented by the frequency deviations across the slices.","3.2 Lineshape Profile","In step , the effects of the frequency dispersion determined during step  is de-convolved from the MRS echo data. Any method may be used to do this. In the illustrated embodiment, a lineshape profile is first determined that is matched to each MRS volume (voxel) in the MRSI.",{"@attributes":{"id":"p-0092","num":"0091"},"figref":["FIG. 5","FIG. 4A","FIG. 4C","FIG. 5","FIG. 5"],"b":["501","502","504","575","572","574","510","511","510","511"]},"In the illustrated embodiment, the lineshape profile for each voxel in the matrix of a 2D MRSI slice was determined from these field maps as follows to match the processing of each MRS volume. Synthetic echo signals with the form of\n\n\n\nwere synthesized for MRI voxels in an MRI slice. The values {\u0394f} were obtained from the field mapping and {t} started from a negative value synchronized with the start of data acquisition of the pulse sequence so as to form echoes at the time point t=0. This gives a 3D dataset, with two spatial dimensions of the same resolution as the MRI and one spectral dimension of the same spectral resolution as the actual MRSI data. The above procedure is repeated for all MRI slices; and the datasets corresponding to each MRSI slice are added together. A series of 2D spatial inverse Fourier Transforms were performed to transform the spatial signals for all MRSI slices back into wavenumber space. The resulting lineshape profile is L(t) given by Equation 16a.\n\n()=\u222b\u2003\u2003(16a)\n\nwhere j is the square root of \u22121. Note that the phase encoding dimension in the wavenumber space is the same as the spatial dimensions of the MRI slice (e.g., 256\u00d7256). The wavenumber space data in the two phase encoding dimensions is cropped into the size of the phase encoded wavenumber space in the MRSI (e.g., 24\u00d724). In the illustrated embodiment, the non-zero wavenumber space data were in an inscribed circle in the square of the nominal phase encoded wavenumber space. The cropped wavenumber space data is filtered with the Hamming window function as done for the measured MRSI data. The data then undergo another Fourier Transform back into spatial domain with a half voxel shifting in both x and y directions.\n","In some embodiments, the lineshape profile can be obtained by directly simulating the phase encoding procedure of the real-world MRSI data acquisition. In this realization, the synthesized echo (e.g., the synthesized FID signals) are modified by multiplying them with phase encoding functions in the form of exp(j2\u03c0{right arrow over (k)}*{right arrow over (r)}), and by integrating the product over the whole MRSI volume V. The resultant lineshape signal for the voxel V is |L(t,k)| given by Equation 16.",{"@attributes":{"id":"p-0095","num":"0094"},"maths":{"@attributes":{"id":"MATH-US-00008","num":"00008"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"mi":"L","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":["t","d"]},{"mover":{"mi":"k","mo":"\u2192"},"mi":"n"}],"mo":","}}},{"msub":{"mo":"\u222b","mi":"V"},"mo":"\u2062","mrow":{"msup":{"mi":"\u2147","mrow":{"mrow":[{"mi":"j","mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mn":"2","mrow":{"mi":"\u03c0","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"msub":{"mover":{"mi":"k","mo":"\u2192"},"mi":"n"},"mo":"\u00b7","mover":{"mi":"r","mo":"\u2192"}}}}},{"mi":["j","\u03c0\u0394"],"mo":["\u2062","\u2062","\u2062","\u2062","\u2062","\u2062"],"mstyle":[{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}],"mn":"2","mrow":{"mi":"f","mo":"\u2061","mrow":{"mo":["(",")"],"mover":{"mi":"r","mo":"\u2192"}}},"msub":{"mi":["t","d"]}}],"mo":"+"}},"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.2em","height":"0.2ex"}}},"mrow":{"mo":"\u2146","mover":{"mi":"r","mo":"\u2192"}}}}],"mo":"="}},{"mrow":{"mo":["(",")"],"mrow":{"mn":"16","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"b"}}}]}}}},"br":[{},{}],"sub":["n ","n"]},"In some embodiments, step  includes de-convolving the lineshape profile for an MRS voxel from the echo data to produce corrected echo data. In the illustrated embodiment, spectral de-convolution was based on Equation 9. Ideally, this de-convolution eliminates the linebroadening caused by the field inhomogeneity; and spectra are obtained with natural linewidths.","A 3D lineshape signal (2 spatial dimensions and 1 spectral dimension) for each MRSI slice and at the in-plane resolution of the MRSI voxel was constructed from field maps within the MRSI slice, using the method described above.","However, at both ends of the echo, the amplitude of the time-domain lineshape profile in the denominator approaches zero. Two adverse consequences may result: 1] when the profile decays to the noise level of the acquired signal and below, noise amplification may occur; and 2] when the amplitude of the profile approaches zero, spikes may appear in the de-convolved signal.","To suppress the noise at the ends of the echo and the spikes at zero-reaching points, a modified Wiener filtering window was applied to the signal. Therefore, the de-convolution was performed as expressed by Equation 17a.\n\n()=()\u00b7()\/()\u2003\u2003(17a)\n\nwhere L(t) is the lineshape function taking the PSF effects into account, computed as described above in Equation 16a (or Equation 16b in some embodiments) for each MRS voxel, and w(t) is the time domain modified Gaussian-Wiener window function as defined in Equation 17b.\n",{"@attributes":{"id":"p-0100","num":"0099"},"maths":{"@attributes":{"id":"MATH-US-00009","num":"00009"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"mi":"w","mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}},{"mrow":{"mi":"G","mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}},"mo":"\u2062","mfrac":{"msup":{"mrow":{"mo":["\uf603","\uf604"],"mrow":{"msub":{"mi":["L","V"]},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}}},"mn":"2"},"mrow":{"msup":{"mrow":{"mo":["\uf603","\uf604"],"mrow":{"msub":{"mi":["L","V"]},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}}},"mn":"2"},"mo":"+","mrow":{"mi":"\u03b1","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"msub":{"mi":["K","V"]},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}}}}}}],"mo":"="}},{"mrow":{"mo":["(",")"],"mrow":{"mn":"17","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"b"}}}]}}}},"br":[{},{},{}],"sub":["V ","V,max","v,max"],"in-line-formulae":[{},{},{},{}],"i":["L","\/S"]},{"@attributes":{"id":"p-0101","num":"0100"},"maths":{"@attributes":{"id":"MATH-US-00010","num":"00010"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"msub":{"mi":["K","V"]},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}},"mo":"=","mfrac":{"msup":[{"mi":"\u03c3","mn":"2"},{"mrow":{"mo":["\uf603","\uf604"],"mrow":{"msub":{"mi":["s","V"]},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","d"]}}}},"mn":"2"}]}}},{"mrow":{"mo":["(",")"],"mrow":{"mn":"17","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"d"}}}]}}}},"br":{},"sup":"2 "},{"@attributes":{"id":"p-0102","num":"0101"},"maths":{"@attributes":{"id":"MATH-US-00011","num":"00011"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msup":{"mi":"\u03c3","mn":"2"},"mo":"=","mover":{"mrow":{"munder":{"mo":"\u2211","mi":"\u03b4"},"mo":"\u2062","msup":{"mrow":{"mo":["\uf603","\uf604"],"mrow":{"msub":{"mi":["s","V"]},"mo":"\u2061","mrow":{"mo":["(",")"],"msub":{"mi":["t","\u03b4"]}}}},"mn":"2"}},"mi":"_"}}},{"mrow":{"mo":["(",")"],"mrow":{"mn":"17","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"e"}}}]}}}},"br":{}},"Although the de-convolution without Wiener filtering can ideally recover the spectra with natural linewidth, its performance is vulnerable to noise and to the zero-crossing points at the end of the time domain signal. Therefore the Wiener filtering was used in the spectral de-convolution in an illustrated embodiment. The results show that with Wiener filtering the performance of the de-convolution is more stable and robust. In case the first few points of the time domain signal were corrupted by the switching of the analog-to-digital converter (ADC), a cosine window function is applied in some embodiments. The cosine window acts mainly on the corrupted points to increase the robustness of the method. Because the signals at the ends of the echo are very small, the cosine factor of the window function has little effect on the lineshape of the resultant spectrum after de-convolution. In various other embodiments other filtering windows are applied, including but not limited to Gaussian, Cosine-Gaussian, Lorentzian, Cosine-Lorentzian, modified Cosine or Half-Cosine, alone or in some combination.","In an illustrated embodiment, the uncorrected echo data s(t) is also conditioned before performing the de-convolution given by Equation 17a. The measured wavenumber space MRSI data were Fourier transformed into spatial domain following a Hamming window filtering and a half voxel shifting, which is the same as a step in lineshape profile formation for the illustrated embodiment, described above. The water residue in each voxel spectrum is removed using the SVD-based Matrix Pencil Method because it can eliminate water components without phase distortion. The resultant signal for the MRS voxel V is still denoted by s(t). The spatial time domain MRSI data after water-removal were submitted to the de-convolution procedure represented by Equation 17a. After de-convolution, the time domain data were zero-padded to 2048 points and transformed to frequency domain to obtain the more ideal MR spectrum. In various other embodiments, other conditioning is used, such as applying a window function selecting from a group including, among others, a Hamming window, a Hanning window, and a Gaussian window, alone or in any combination.","In the illustrated embodiments, all programs used for implementing SPREAD were written in MATLAB\u2122 (The MathWorks, Inc, Natick, Mass.). The most time-consuming part of SPREAD is the reconstruction of the lineshapes from the field maps. For an MRSI slice consisting of 5 MRI field mapping slices with 256\u00d7256 in-plane MRI resolution, the reconstruction of the lineshapes of 16\u00d716 MRSI voxels took about 32 seconds on a PC with a 4G Hz processor.","Synchronization of the time domain signals, to align the peaks of the echoes, is beneficial for the procedure of de-convolution in some embodiments, otherwise the resultant signal would suffer from phase and lineshape distortions, as well as deteriorated spectral resolution. The position of the echo peak is calculated from the timing of the pulse sequence and, if needed, is adjusted by measuring the echo of the water signal acquired in a single voxel MRS using the same pulse sequence and timing, but without phase encoding. In various other embodiments, other synchronization methods are applied. Once the position is determined, the value is used in forming the lineshape signals according to the field maps for all MRSI data acquired with the same timing parameters.","3.4 Enhanced Spectrum",{"@attributes":{"id":"p-0107","num":"0106"},"figref":["FIG. 6A","FIG. 5","FIG. 2","FIG. 2"],"b":["601","511","152","154","260","263","263"],"sub":["V","d"],"i":["c ","d "]},{"@attributes":{"id":"p-0108","num":"0107"},"figref":["FIG. 6B","FIG. 5","FIG. 6A"],"b":["651","152","154","660","263","662","664","266","668","263"],"sup":"0","sub":["V","d"],"i":["c ","d. "]},"In some embodiments, one or more steps of the method  are incorporated into an MRS scanning system or apparatus.  is a block diagram that illustrates an example MRS system , according to an embodiment. The system  includes a scanning apparatus  and a computer\/controller . Although a subject  for MRS scanning is depicted in , subject  is not part of the MRS system .","The scanning apparatus  includes a Bmagnet , an x-gradient magnet , a y-gradient magnet , a z-gradient magnet , a group of shim coils (e.g., shim coils and ), a radio frequency (RF) transmitter , an RF receiver , a communications interface , and a processor . As depicted, the components of scanner  are standard and well known in the art.","The computer\/controller  sends signals to the communications interface  in scanner  that causes the scanner to operate the gradient magnets ,  and  and the RF transmitter  and RF receiver  to obtain NMR data.","In the illustrated embodiment, computer\/controller  includes process  to enhance spectral resolution. Process  performs one or more steps of method . For example, process  causes scanner  to collect MRSI echo data at each of 24\u00d724 MRSI voxels (e.g., voxels  depicted in ) and to collect complex MRI data at each of 256\u00d7256 MRI voxels for each of two echo times, TE1 and TE2. The collected data is received at computer\/controller  or another computer and used to determine MRSI spectra with enhanced spectral resolution, using additional steps of method .","In some embodiments, process  is performed by processor  within scanner . In various embodiments, one or more steps of method  are performed by multiple processors on scanner  or computer\/controller  or other computers connected to computer\/controller  via a network.","In an example embodiment, the subject was a spectroscopy phantom. The field homogeneity was deliberately destroyed in the y-direction by changing shimming parameters. Severe field inhomogeneity was seen in the interface between liquid and air. Thus the linewidth of the MRS peak for protons in water was increased and the lineshape distorted. Because the water concentration was homogenous in the phantom, the linewidth and lineshape could only be altered by spatial variation of the magnetic field. Using the MRI field mapping data, lineshapes in the frequency domain were constructed as described above and compared to the measured peaks of H in water.  is a scan that illustrates an example magnetic field map that depicts frequency dispersion in a phantom, according to an embodiment. The scan is divided onto a grid that corresponds to MRSI voxels. The horizontal axis  is MRSI voxel column number. The vertical axis  is MRSI voxel row number. The grayscale bar indicates the \u0394f scale in Hertz. Because both large negative and large positive values are dark, the dark negative areas  and dark positive areas  are indicated in the scan . MRSI voxel  is indicated for which spectra are computed.","In the MRSI voxels adjacent to the liquid-air interface, such as MRSI voxel , the lineshapes were severely distorted and the linewidth was broadened.  is a graph  that illustrates an example MRS measurement of the spectrum of water in an MRSI voxel  of the phantom. The horizontal axis  is frequency sample points. The vertical axis  is intensity in arbitrary units. The measured lineshape profile  is distorted and broad.  is a graph  that illustrates an example reconstructed lineshape profile for the MRS voxel based on integrating the lineshape profiles of the MRI voxels in the MRSI voxel, according to an embodiment. The horizontal axis  is frequency sample points, as in . The vertical axis  is intensity in arbitrary units. The reconstructed lineshape profile  based on integrating the dispersion terms from the MRI voxels over the MRSI voxel  is plotted. It is noted that these lineshapes can not be described by Lorentzain, Gaussian, and Voigt functions and constitute a challenge for the spectral fitting. The computed lineshapes in such MRSI voxels are identical to measured lineshapes of water. However, the widths of the computed lineshapes are narrower than those of water, because the measured water signal has an intrinsic linewidth that is not included in the computed linewidths.","A spectrum from a voxel in the region with strong magnetic field inhomogeneity in the phantom was observed, in which the peaks of Creatine (at 3.04 MHz) and Choline (at 3.24 MHz) severely overlap and can not be resolved.  is a graph  that illustrates an example MR spectrum from the MRSI voxel  after removing the water peak, according to an embodiment. The horizontal axis  is frequency sample points. The vertical axis is intensity in arbitrary units. Data were measured with water suppression. Residual water was further suppressed by SVD-based method. However, the water residue is still sizable because of its bad lineshape. The residual spectrum  is plotted and includes a peak and peak .  is a graph  that illustrates an example MR spectrum corrected by the lineshape profile of  after removing the water peak, according to an embodiment. The horizontal and vertical axes are as described for . The residual spectrum  is plotted and includes a peak , peak and peak . After SPREAD treatment, the peak is clearly separated into two peaks and  for Choline and Creatine, respectively, which therefore could be easily resolved. Furthermore the distorted NAA peak is resolved as peak with a better, more-Lorentzian lineshape.","Compared to the magnetic field for the phantom, the magnetic field in the human brain is highly inhomogeneous (see for example,  and ). Consequently, the metabolite spectrum exhibits severe spectral overlap, lineshape distortion and linebroadening (see for example,  for MRS volume ). As a result, the overlapping Cr and Cho peaks can not be resolved from peak . In addition, the singlet NAA peak can not be fitted accurately, because of the lineshape distortion. After de-convolution by SPREAD (see for example, ), the adjacent Cr and Cho peaks  and , respectively, are very well separated and the lineshape distortion for NAA peak  is corrected.","In the illustrated embodiments, the effect of eddy current on the lineshape is not included and therefore the lineshape distortion caused by eddy current is not corrected. This may prevent the application of such embodiments to very short echo time, when an eddy current effect may be pronounced. However, this constraint is very weak for modern scanners equipped with active shielding and therefore the eddy current effects are practically small. In some embodiments, the effect of eddy currents is included explicitly.","In the illustrated embodiment, additional measurement time for the field mapping images is involved. However, the increase in time is only three to eight minutes, which is a small portion of the total MRSI measurement time.","In the illustrated embodiments, use is made of a standard quadrature coil as the RF receiving antenna. In other embodiments, use is made of a multi-channel coils as the RF receiving antenna. Such embodiments involve more robust field mapping techniques, because the SNR of the images from individual coil components vary dramatically across the field of view.","In another embodiment, improved spectral resolution is applied to the human lower leg. The accurate measurement of intramyocellular lipids (IMCL) in muscle is important for understanding lipid utilization in a variety of diseases, such as diabetes. However, such measurements can be obscured by overlap with extramyocellular lipids (EMCL). Traditionally, IMCL has been measured by biopsy. In recent years, proton MRS and MRSI have been employed to assess EMCL and IMCL stores in vivo. The spectral lines of EMCL and IMCL depend on both their chemical shifts and the \u201cbulk magnetic susceptibility\u201d (BMS) effects of EMCL, with the latter being altered by the orientation of the muscle fiber with respect to the external magnetic field B. While the main IMCL peak appears at 1.3 ppm, the peak of EMCL may spread in the range of 1.3-1.5 ppm, depending on the fiber orientation related to B.","Due to the dual inhomogeneities of the magnetic fields, Band local BMS, the proton MRS of calf muscle suffer from severe spectral overlap. As a result, accurate separation of the spectral peaks of EMCL and IMCL, and therefore, accurate measurement of IMCL are difficult. The SPREAD method was applied to improve the spectral resolution of proton MRSI acquired on the aforementioned scanner at 3 T.","In this embodiment, measurements were on the right legs of two healthy male volunteers. The protocol was approved by the local Institutional Review Board. MR scans were carried out on a 3 T whole body scanner (GENERAL ELECTRIC\u2122, of Fairfield, Conn.) with a home-built bird cage coil (inner diameter 14 cm) serving as transmitter and receiver. Commercial MRSI sequence with PRESS localization (PROBE-P CSI) was used for MRSI data acquisition. The parameters are as follows: Field of View=17 cm\u00d717 cm; number of slices=1; slice thickness=12 mm; number of phase encoding=32\u00d732; spectral width=4000 Hz; number of data points in FID=1024; TR\/TE=1200 ms\/27 ms; total scan time=21 min.","Immediately following the MRSI scan, MR images were measured for the purpose of field mapping. A commercial MRI sequence 2 dimensional SPGR was used for data acquisition. The parameters are as follows: FOV=17 cm\u00d717 cm; slice thickness=3 mm; number of slices=6; number of TEs=2 (TE1=2.3 ms and TE2=5.8 ms); TR=500 ms; SW=50 MHz; flip angle=60 degree. The MRI volume completely covered the MRSI volume and the MRI slices were parallel to MRSI slice. Automatic shimming was turned off. Complex raw data were saved in addition to the conventional images in DICOM format.",{"@attributes":{"id":"p-0125","num":"0124"},"figref":["FIG. 11","FIG. 12","FIG. 13"],"b":["1101","1102","1104","1108"]},{"@attributes":{"id":"p-0126","num":"0125"},"figref":["FIG. 12","FIG. 11","FIG. 11","FIG. 13","FIG. 11"],"b":["1201","1102","1104","1205","1212","1214","1108","1108"]},{"@attributes":{"id":"p-0127","num":"0126"},"figref":"FIG. 13","b":["1301","1302","1304","1301","1310","1320","1310","1310","1310","1310","1320","1320","1320","1320","1320","1320","1310","1320","1310"],"i":["a","b ","c","a","b","c ","d"],"sub":"3 "},"Note that the main spectral peak of IMCL from (CH)group overlapped severely with the main peak of EMCL and the CHpeaks of both EMCL and IMCL (not shown). After SPREAD, the two main peaks and are better separated and the small peaks of CHfrom IMCL and EMCL, respectively, can be seen. These two small peaks can be included in the spectral fitting, for accurate measurement of IMCL. Peak assignment is based on Machann et al. (European Journal of Radiology, v 67, pp 275-484, 2008).",{"@attributes":{"id":"p-0129","num":"0128"},"figref":"FIG. 10","b":["1000","1000","1010","1000","1010","1010","1002","1010","1002","1010","1010","1002"]},"Computer system  also includes a memory  coupled to bus . The memory , such as a random access memory (RAM) or other dynamic storage device, stores information including computer instructions. Dynamic memory allows information stored therein to be changed by the computer system . RAM allows a unit of information stored at a location called a memory address to be stored and retrieved independently of information at neighboring addresses. The memory  is also used by the processor  to store temporary values during execution of computer instructions. The computer system  also includes a read only memory (ROM)  or other static storage device coupled to the bus  for storing static information, including instructions, that is not changed by the computer system . Also coupled to bus  is a non-volatile (persistent) storage device , such as a magnetic disk or optical disk or flash drive, for storing information, including instructions, that persists even when the computer system  is turned off or otherwise loses power.","In many embodiments, information, including instructions, is provided to the bus  for use by the processor from an external input device , such as a keyboard containing alphanumeric keys operated by a human user, or a sensor. A sensor detects conditions in its vicinity and transforms those detections into signals compatible with the signals used to represent information in computer system . Other external devices coupled to bus , used primarily for interacting with humans, include a display device , such as a cathode ray tube (CRT) or a liquid crystal display (LCD) or a plasma screen, for presenting images, and a pointing device , such as a mouse or a trackball or cursor direction keys, for controlling a position of a small cursor image presented on the display  and issuing commands associated with graphical elements presented on the display .","In the illustrated embodiment, special purpose hardware, such as an application specific integrated circuit (IC) , is coupled to bus . The special purpose hardware is configured to perform operations not performed by processor  quickly enough for special purposes. Examples of application specific ICs include graphics accelerator cards for generating images for display , cryptographic boards for encrypting and decrypting messages sent over a network, speech recognition, and interfaces to special external devices, such as robotic arms and medical scanning equipment that repeatedly perform some complex sequence of operations that are more efficiently implemented in hardware.","Computer system  also includes one or more instances of a communications interface  coupled to bus . Communication interface  provides a two-way communication coupling to a variety of external devices that operate with their own processors, such as printers, scanners and external disks. In general, the coupling is with a network link  that is connected to a local network  to which a variety of external devices with their own processors are connected. For example, communication interface  may be a parallel port or a serial port or a universal serial bus (USB) port on a personal computer. In some embodiments, communications interface  is an integrated services digital network (ISDN) card or a digital subscriber line (DSL) card or a telephone modem that provides an information communication connection to a corresponding type of telephone line. In some embodiments, a communication interface  is a cable modem that converts signals on bus  into signals for a communication connection over a coaxial cable or into optical signals for a communication connection over a fiber optic cable. As another example, communications interface  may be a local area network (LAN) card to provide a data communication connection to a compatible LAN, such as Ethernet. Wireless links may also be implemented. Carrier waves, such as acoustic waves and electromagnetic waves, including radio, optical and infrared waves travel through space without wires or cables. Signals include man-made variations in amplitude, frequency, phase, polarization or other physical properties of carrier waves. For wireless links, the communications interface  sends and receives electrical, acoustic or electromagnetic signals, including infrared and optical signals that carry information streams, such as digital data.","The term computer-readable medium is used herein to refer to any medium that participates in providing information to processor , including instructions for execution. Such a medium may take many forms, including, but not limited to, non-volatile media, volatile media and man-made signals on transmission media. Non-volatile media include, for example, optical or magnetic disks, such as storage device . Volatile media include, for example, dynamic memory . Transmission media include, for example, coaxial cables, copper wire, fiber optic cables, and waves that travel through space without wires or cables, such as acoustic waves and electromagnetic waves, including radio, optical and infrared waves. Computer-readable storage medium is used herein to refer to computer-readable media excluding signals on transmission media.","Common forms of computer-readable media include, for example, a floppy disk, a flexible disk, a hard disk, a magnetic tape, or any other magnetic medium, a compact disk ROM (CD-ROM), a digital video disk (DVD) or any other optical medium, punch cards, paper tape, or any other physical medium with patterns of holes or knobs, a RAM, a programmable ROM (PROM), an erasable PROM (EPROM), a FLASH-EPROM, or any other memory chip or cartridge, signals on a carrier wave, or any other medium from which a computer can read.","Network link  typically provides information communication through one or more networks to other devices that use or process the information. For example, network link  may provide a connection through local network  to a host computer  or to equipment  operated by an Internet Service Provider (ISP). ISP equipment  in turn provides data communication services through the public, world-wide packet-switching communication network of networks now commonly referred to as the Internet . A computer called a server  connected to the Internet provides a service in response to information received over the Internet. For example, server  provides information representing video data for presentation at display .","The invention is related to the use of computer system  for implementing the techniques described herein. According to one embodiment of the invention, those techniques are performed by computer system  in response to processor  executing one or more sequences of one or more instructions contained in memory . Such instructions, also called software and program code and logic, may be read into memory  from another computer-readable medium such as storage device . Execution of the sequences of instructions contained in memory  causes processor  to perform one or more of the method steps described herein. In alternative embodiments, hardware, such as application specific integrated circuit , may be used in place of or in combination with software to implement the invention. Logic may be encoded in circuitry or other hardware to perform one or more steps of the invention. Thus, embodiments of the invention are not limited to any specific combination of hardware and software, unless otherwise stated.","The signals transmitted over network link  and other networks through communications interface , carry information to and from computer system . Computer system  can send and receive information, including program code, through the networks ,  among others, through network link  and communications interface . In an example using the Internet , a server  transmits program code for a particular application, requested by a message sent from computer , through Internet , ISP equipment , local network  and communications interface . The received code may be executed by processor  as it is received, or may be stored in storage device  or other non-volatile storage for later execution, or both. In this manner, computer system  may obtain application program code in the form of a signal on transmission media such as a carrier wave.","Various forms of computer readable media may be involved in carrying one or more sequence of instructions or data or both to processor  for execution. For example, instructions and data may initially be carried on a magnetic disk of a remote computer such as host . The remote computer loads the instructions and data into its dynamic memory and sends the instructions and data over a telephone line using a modem. A modem local to the computer system  receives the instructions and data on a telephone line and uses an infra-red transmitter to convert the instructions and data to a signal on an infra-red carrier wave serving as the network link . An infrared detector serving as communications interface  receives the instructions and data carried in the infrared signal and places information representing the instructions and data onto bus . Bus  carries the information to memory  from which processor  retrieves and executes the instructions using some of the data sent with the instructions. The instructions and data received in memory  may optionally be stored on storage device , either before or after execution by the processor .","In the foregoing specification, the invention has been described with reference to specific embodiments thereof. It will, however, be evident that various modifications and changes may be made thereto without departing from the broader spirit and scope of the invention. The specification and drawings are, accordingly, to be regarded in an illustrative rather than a restrictive sense."],"GOVINT":[{},{}],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The present invention is illustrated by way of example, and not by way of limitation, in the figures of the accompanying drawings and in which like reference numerals refer to similar elements and in which:",{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 1A"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 1B"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 3A"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":["FIG. 3B","FIG. 3A"]},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 3C"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 4A"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 4B"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":["FIG. 4C","FIG. 4A","FIG. 4B"]},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0031","num":"0030"},"figref":["FIG. 6A","FIG. 5","FIG. 2"]},{"@attributes":{"id":"p-0032","num":"0031"},"figref":["FIG. 6B","FIG. 5"]},{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0034","num":"0033"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 9A"},{"@attributes":{"id":"p-0036","num":"0035"},"figref":"FIG. 9B"},{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 9C"},{"@attributes":{"id":"p-0038","num":"0037"},"figref":"FIG. 9D"},{"@attributes":{"id":"p-0039","num":"0038"},"figref":["FIG. 9E","FIG. 9C"]},{"@attributes":{"id":"p-0040","num":"0039"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0041","num":"0040"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0042","num":"0041"},"figref":"FIG. 12"},{"@attributes":{"id":"p-0043","num":"0042"},"figref":"FIG. 13"}]},"DETDESC":[{},{}]}
