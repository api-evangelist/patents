---
title: Methods, systems and arrangements for wireless communication with near-field communication terminals
abstract: A variety of near-field devices, methods and systems are implemented in various fashions. One implementation is directed to a mobile station () with an over-the-air (OTA) transceiver () for communication with a trusted service manager. The mobile station also has a near-field communications transceiver () for communication with a terminal reader using file-identifiers of a first size. A memory () is used for storing files arranged according to two different sets of files, the first set of files identified by file-identifiers of a first size and the second set of files identified by file-identifiers of a second size that is a different size from the first size. A processor () provides access by the OTA transceiver () to the stored files. Access by the near-field communications transceiver () is provided to the stored files by running either a Java-based emulator for accessing the first set of files or Java APIs to access the second set of files.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08521084&OS=08521084&RS=08521084
owner: NXP B.V.
number: 08521084
owner_city: Eindhoven
owner_country: NL
publication_date: 20090522
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"p":["The present invention relates generally to wireless communications, and more specifically, to mobile stations that interface with near-field communications terminals.","In order to ensure interoperability of transport systems, the American Public Transit Association (APTA) has published the Universal Transit Fare Card Standards (UTFS).","For the applicative data protocol, the UTFS specifications rely on ISO 7816-4 standards. The UTFS and other ISO7816-4 based public transportation specifications are rapidly becoming standardized for mass transit organizations; however, adhering system integrators are still using DESFire plastic cards, which not only meet the ISO 7816-4 specifications but also compete on cost-effectiveness compared to Java cards. DESFire cards are massively deployed in advanced public transportation around the world, and some government infrastructures (e.g., NASA and United States Department of Defense). A DESFire card is a microprocessor-based card, compliant to all 4 levels of ISO\/IEC 144443A, running a special purpose operating system (OS), referred as the DESFire OS. As a contactless card relying on NFC technology, a DESFire card can be typically read at a distance of ten centimeters by a Proximity Coupling Device (PCD) or Terminal Reader. It features a memory capacity of four Kilobytes. The DESFire OS features the possibility to have several applications and multiple files.","Mobile Network Operators are also planning to rollout NFC enabled Mobile Stations while delegating the OTA provisioning of virtual cards into UICCs, emulating plastic cards. In the near future, NFC-value added services are going to be deployed over Global System for Mobile (GSM) (2.5G), Universal Mobile Telecommunications System (UMTS) (3G) and other next-generation networks in NFC-enabled Mobile Stations. A typical Mobile Station shall be composed of a UMTS Integrated Circuit Chip (UICC) and a NFC chip-enabled handset leveraging both on Java technology. Along with storing user subscriber information, the UICC can contain banking, event ticketing, transit, loyalty and other applications provisioned over-the-air (OTA).","The GSM Association (GSMA) refers entities having this important OTA provisioning role in the mobile NFC ecosystem as Trusted Service Managers. These Trusted Service Managers shall mainly rely on 3GPP, ETSI-SCP and Global Platform technical specifications for the OTA provisioning mechanisms. Applications based on proprietary technologies such as Mifare Classic and DESFire require other provisioning mechanisms not addressed by the current technical specifications.","A variety of near-field communication related devices, methods and systems are implemented in various fashions.","One embodiment of the present invention includes a mobile station with an over-the-air (OTA) transceiver for wireless communication with a trusted service manager. The mobile station also has a near-field communications transceiver for communication with a terminal reader that uses a data exchange protocol that includes file-identifiers of a first size. A memory is used for storing files arranged according to two different sets of files, the first set of files identified by file-identifiers of a first size and the second set of files identified by file-identifiers of a second size that is a different size from the first size. A processor is used for providing access by the OTA transceiver to the stored files, and providing access by the near-field communications transceiver to the stored files by running, as a default, a Java-based emulator for accessing the first set of files, and otherwise running one or more Java application-programming interfaces (APIs) to access the second set of files.","Another embodiment of the present invention relates to a method for use with a mobile station having an over-the-air (OTA) transceiver for wireless communication with a trusted service manager, a near-field communications transceiver for communication with a terminal reader that uses a data exchange protocol that includes file-identifiers of a first size, a memory for storing files and a processor. Files stored in the memory are arranged according to two different sets of files, the first set of files identified by file-identifiers of a first size and the second set of files identified by file-identifiers of a second size. The processor is used to provide access by the OTA transceiver to the stored files, and provide access by the near-field communications transceiver to the stored files by running, as a default, a Java-based emulator for accessing the first set of files, and otherwise running one or more Java APIs to access the second set of files.","Another embodiment of the present invention relates to a system having a trusted service manager, a terminal reader, and a mobile station. The mobile station has an over-the-air (OTA) transceiver for wireless communication with the trusted service manager. The mobile station also has a near-field communications transceiver for communication with a terminal reader that uses a data exchange protocol that includes file-identifiers of a first size. A memory stores files arranged according to two different sets of files, the first set of files identified by file-identifiers of a first size and the second set of files identified by file-identifiers of a second size. A processor is used for providing access by the OTA transceiver to the stored files, and providing access by the near-field communications transceiver to the stored files by running, as a default, a Java-based emulator for accessing the first set of files, and otherwise running one or more Java APIs to access the second set of files.","The above summary is not intended to describe each embodiment or every implementation of the present disclosure. The figures and detailed description that follow more particularly exemplify various embodiments.","While the invention is amenable to various modifications and alternative forms, specifics thereof have been shown by way of example in the drawings and will be described in detail. It should be understood, however, that the intention is not to limit the invention to the particular embodiments described. On the contrary, the intention is to cover all modifications, equivalents, and alternatives falling within the scope of the invention including aspects defined by the appended claims.","The present invention is believed to be applicable to a variety of different types of processes, devices and arrangements for use with wireless communications, and in particular, to approaches for use with mobile stations that communicate using near-field communications and\/or over-the-air communications. While the present invention is not necessarily so limited, various aspects of the invention may be appreciated through a discussion of examples using this context.","Consistent with an example embodiment of the present invention, a mobile station is implemented. The mobile station includes a cellular transceiver for wireless communication with a trusted service manager. A near-field communications (NFC) transceiver communicates with a terminal reader using a data exchange protocol (e.g., DESfire) that includes file-identifiers of a first size. A memory stores files arranged according to two different sets of files, the first set of files (e.g., DESfire) identified by file-identifiers of a first size and the second set of files identified by file-identifiers of a second size (e.g., formatted according to Java, Global System for Mobile (GSM) (2.5G) or Universal Mobile Telecommunications System (UMTS) (3G)). A processor provides access, by the cellular transceiver, to the stored files. The processor also provides access, by the NFC transceiver, to the stored files. The processor runs, as a default, a Java-based emulator for accessing the first set of files. If a selection of a specific file is otherwise provided, the processor implements the selected file, which may include one or more Java APIs associated with the second set of files.","Aspects of the invention can be useful for a mobile station that interfaces with systems using otherwise incompatible communication protocol. In particular, the systems may use file systems that have different file-identification protocols. Software configured for one of the file-identification protocols would not properly handle data requests formatted according to a different file-identification protocol. The mobile station includes emulation software that emulates one of the file-identification protocols. This can be particularly useful for use with external sources (e.g., terminal readers) that are only configured to use the emulated file-identification protocols.","Aspects of the invention can be useful for allowing a Trusted Service Manager to configure the mobile station. Configuration can include, for example, initialization of the mobile device. Various files can be created or modified during initialization, such as personalized data for a particular mobile station user or security information for verifying future transactions. Configuration can also include subsequent modification of stored files including, but not limited to, updates to security information or to software applications.","In a specific embodiment of the present invention, the mobile station includes a handset that allows for both over-the-air (OTA) communications and near-field communications. As used herein OTA denotes communications capable of transmitting at distances exceeding a meter, whereas, near-field communications (NFC) only operate a distances less than about a meter. A specific type of OTA communications are cellular-based communications, such as GSM (2.5G) or UMTS (3G).","One embodiment of the present invention relates to a specific type of NFC chip (e.g., a smartcard) that complies with ISO 14443A and also with ISO 14443-4. A particular example provides Data Encryption Standard\/Triple Data Encryption Standard (DES\/3DES) encryption of stored and transmitted data. A NFC IC chip using the Mifare-DESFire protocol is a specific example of such an embodiment. While the invention is not so limited, the following discussion is directed toward such a specific embodiment.","Stored files in such a Mifare Objects include legacy Mifare applications. The objects are essentially grouped into two types:\n\n",{"@attributes":{"id":"p-0028","num":"0029"},"figref":"FIG. 1A","b":["102","150","104","112","108","106","102","150","112","116","120","124","114","122","118","126"]},"Memory  contains software code that, when executed on processor , provides an interface to transceivers operating according to either protocol. In a specific instance, the new protocol is a Java protocol operating using various Java files\/applets. In a specific instance, the legacy protocol is a non-Java protocol. For Remote Stations  that operate using the new protocol, access requests to the Java files\/applets are accomplished using file identifiers that have a first format. For Remote Stations  that operate using the legacy protocol, access requests to legacy files are accomplished using a second format. The second format includes a file\/application identifier that is not supported within the new format. Moreover, an implementation that used conventional mechanisms to decode the legacy format would either detect an improper request or erroneously decode the request. Accordingly, the processor  uses the second format as the default format. If processor  determines that the access request is consistent with the first format, processor  uses the conventional mechanisms.","In one embodiment, the processor  is further configured to use conventional Java applets (associated with the new protocol) to perform one or more functions associated with the legacy protocol. For example, one or more cryptography functions may be common (or similar) to both protocols.","In a specific embodiment, transceiver  is implemented using a NFC transceiver that is powered via a radio-frequency (RF) signal received from one of the remote stations. In one instance, transceiver  is implemented using a cellular transceiver. The mobile station  can include various functionality associated with the cellular transceiver including, but not limited to, mobile phone, personal digital assistant, mobile television and Internet access.",{"@attributes":{"id":"p-0032","num":"0033"},"figref":"FIG. 1B"},"In a particular embodiment, the Mobile Station provides full compliance to all levels of ISO 14443A by operating in a card emulation mode. The Mobile Station can also be compliant with the ISO 14443-4 Protocol and Parameter Selection (PPS) feature of a DESFire card, which allows a non-symmetrical information interchange baud rate.","The Mobile Station hosts two applications responsible for the provisioning mechanisms of Mifare applications. These applications are the Trusted Proxy MIDlet and the Mifare4Mobile Applet.","The Trusted Proxy MIDlet is located in the Java handset stack, which features Java Specific Requests (JSR) ,  and . The Trusted Proxy MIDlet is triggered by a short message service (SMS)-PUSH from the Trusted Service Manager consistent with JSR . The Trusted Proxy MIDlet uses JSR  to forward the Trusted Service Manager's Application Protocol Data Units (APDUs) to the Mifare4Mobile Applet. The Trusted Proxy MIDlet also uses the NFC push mechanism from JSR  for generating an alert indicating that an unauthorized reader attempted to communicate with the DESFire emulated card.","The Mifare4Mobile Applet is a Card Application Toolkit Applet that can securely communicate over a wireless network with a trusted backend provisioning system via ENVELOPE APDUs. As defined by ISO 7816-4, an ENVELOPE APDU is used to transmit APDUs or part of APDUs or other data strings that otherwise could not be transmitted by the available protocols. This transmission protocol is reinforced by the JSR , which mandates that all APDUs coming to the UMTS Integrated Circuit Chip (UICC) via the network need to be in ENVELOPE format.","As a Java Card application, the Mifare4Mobile Applet can install and delete classic Mifare Objects. The Mifare4Mobile Applet is provisioned into the UICC using ETSI and Global Platform card specifications. It has the \u2018Default Selected\u2019 application privilege when the UICC is emulating an ISO14443 card. This privilege allows it to handle any APDU commands during a proximity transaction except the ISO 7816-4 defined SELECT and MANAGE_CHANNEL commands, which are handled by the Java Card Runtime Environment (JCRE).","The ISO 7816-5 specifications define Application Identifiers (AIDs) as parameters for an application selection command via the ISO 7816-4 SELECT command. An AID consists of the concatenation of an RID (Registered Application Provider Identifier) and a PIX (Proprietary Application Identifier Extension). The RID has a length of five bytes, whereas the PIX has a variable length of between zero and eleven bytes. Thus, the length of an ISO 7816-5 compliant AID varies between five to sixteen bytes. RIDs can be registered through the ISO standardization group.","The Mifare4Mobile Applet uses the ISO7816-5 registered DESFire AID which has the following hexadecimal string value: \u201cD2 76 00 00 85 01 00\u201d.","As the Trusted Service Manager's on-card component, the Mifare4Mobile Applet is able to interface with the DESFire OS emulation and to provision DESFire Applets.","The Trusted Service Manager's backend system is composed of Secure OTA Channels, Secure Connectors and a Core Platform. The OTA Channels are used for secure sessions with Mobile Stations over the Mobile Network Operator's wireless network. The Connectors are used for secure web-based sessions with Service Providers. The Core Platform represents the central component of the Trusted Service Manager's backend system. This backend system embeds a secure and fast-queriable database to store provisioning-related information. Besides scalability and robustness, the backend system can include logic for communicating with Mobile Stations that host the Trusted Proxy and Mifare4Mobile Applet.",{"@attributes":{"id":"p-0042","num":"0043"},"figref":"FIG. 2"},"To comply with the Mifare4Mobile solution, the DESFire read-only seven-byte UID is required to be set into the UICC's Mifare memory emulation before deployment.","A DESFire Applet uses for its applicative data structure, the ISO 7816-4 defined Application Protocol Data Unit (APDU) protocol. These APDU-structured commands are referred to as DESFire commands. In terms of security, all data are protected using cryptographic algorithms, such as DES, 3DES or Advanced Encryption Standard (AES). However, a standard DESFire OS does not integrate with standard Java Card technology. Specifically, DESFire Applets are not Java Card Applets. Consequently, legacy DESFire Applets running on DESFire cards cannot be provisioned into Java cards using ETSI-SCP specifications.","The DESFire OS emulation has the following features\n\n","The DESFire OS has an ISO 7816-4 compliant organization for its file system.","As Java Card technology does not provide APIs for ISO 7816-4 file system, the Mifare4Mobile Applet relies on its Toolkit functionality to read and write in the GSM file system. Thus, the Mifare4Mobile Apple can interface with the entire DESFire file system emulation, which has a capacity of 896 files, and 28 directories where a directory represents a DESFire Applet. The emulation takes into account that a DESFire file is addressable by one-byte identifier whereas a GSM file is addressable by a two-byte identifier. The security feature of the GSM file system via access conditions combining Personal Identity Numbers (PINs) and Personal Unblocking Keys (PUKs) is also leveraged by associating each DF containing a DESFire Applet with a Card Holder Verification (CHV) corresponding to the application key.","The DESFire emulation has two categories of files:\n\n","The root of the DESFire file system is in a DF relative to the MF of the GSM file system, which has the \u20183F00\u2019 reserved value. Thus, the DF containing the DESFire file system is referred to as DFMifare4Mobile with the value XXXX. If desired, this value can be reserved by the appropriate standard body.","A DESFire Applet has five types of files divided into three groups:\n\n","The DFMifare4Mobile can contain at least 28 DFs where each DF is a DESFire Applet, containing up to 32 DESFire Applet files.",{"@attributes":{"id":"p-0052","num":"0069"},"figref":"FIG. 3"},"All commands and data frames exchanged between the Mobile Station and the Terminal Reader are using block format as defined in ISO 14443-4.","The Mifare4Mobile Applet implements all 35 DESFire commands (listed hereafter), which are based on ISO 71816-4 APDU structure.","Nine Proximity Integrated Circuit Chip (PICC) Level Commands:\n\n","Six Security Level Commands:\n\n","Nine Application Level Commands:\n\n","Eleven Data Manipulation Commands:\n\n","The Mifare4Mobile Applet uses the Java Card cryptographic APIs to emulate the security features of a DESFire card prior to data transmission. Encryption algorithms include DES, 3DES and AES. Cryptographic checksum can also be supported.","Each application can include a key file. The four different file access rights featured in a DESFire card are also supported. These access rights are:\n\n","A one-byte access right key is associated to each file. The value 0xE refers to \u2018Free\u2019 access while 0xF refers to \u2018Never\u2019 access conditions. Access to user data is granted on the application level. For each application, a maximum of fourteen user definable keys can be assigned to control access to data stored in the DESFire emulation.","Terminal Readers access DESFire cards via all four levels of ISO 14 4443 and optional ISO 7816-4 commands (APDUs).","The DESFire OS uses a proprietary AID standard based on Mifare standards, which assign a three-byte AID for a DESFire Applet. The Mifare Standardization group mandates the following AID format convention for DESFire Applets:",{"@attributes":{"id":"p-0064","num":"0120"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"70pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"77pt","align":"center"}}],"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["DESFire AID Byte 0","DESFire AID Byte 1","DESFire AID Byte 2"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"6"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"4","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"5","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"6","colwidth":"42pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["Nibble 0","Nibble 1","Nibble 2","Nibble 3","Nibble 4","Nibble 5"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"140pt","align":"center"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["0xF","Mifare Classic AID","0x0 . . . 0xF"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}]}}},"The three-byte DESFire AID encapsulates the Mifare Classic AID.","The first nibble of the DESFire AID is fixed to 0xF to indicate Mifare classic AID is used. The next four nibbles hold the Mifare Classic AID. The last nibble ranges from zero to sixteen to support multiple DESFire AIDs within the context of one Mifare classic AID. The DESFire Applet AID 0xFFFFFF is reserved as it is used to store general issuer information.","In ISO 14443A card emulation mode, an NFC enabled Mobile Station would not understand the data exchange protocol initiated by the NFC terminal reader (PCD) if no SELECT [AID] command conforming to both ISO 7816-4 and ISO 7816-5 is issued. To remedy to this problem, the emulating Mobile Station is required to set the Mifare4Mobile Applet as the default selected Applet, which acting as a proxy, forwards the APDUs of the NFC Terminal to the DESFire Applet. This implicit selection mechanism allows the Mobile Station to emulate a DESFire card via the Mifare4Mobile Applet. Accordingly, when a SELECT command is used, the selected application will be use and when no SELECT command is used the Mifare4Mobile Applet is used.",{"@attributes":{"id":"p-0068","num":"0124"},"figref":["FIG. 4","FIG. 4"]},{"@attributes":{"id":"p-0069","num":"0125"},"figref":["FIG. 5","FIG. 5"]},"Service Providers provision actual DESFire Applets into plastic DESFire cards by programming them. This pre-issuance method consists of using DESFire command sets while leveraging on ETSI-SCP. Initialization data is loaded into access right pre-configured files.",{"@attributes":{"id":"p-0071","num":"0127"},"figref":"FIG. 6"},"While the present invention has been described above and in the claims that follow, those skilled in the art will recognize that many changes may be made thereto without departing from the spirit and scope of the present invention."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"p":["The invention may be more completely understood in consideration of the following detailed description of various embodiments of the invention in connection with the accompanying drawings, in which:",{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 1A"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 1B"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
