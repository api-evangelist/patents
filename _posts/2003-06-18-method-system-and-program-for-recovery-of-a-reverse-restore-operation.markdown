---
title: Method, system, and program for recovery of a reverse restore operation
abstract: Disclosed is a technique for processing interruption of an operation that transfers data between a source and a target. An indication that a reverse restore operation has been interrupted is received. It is determined whether designation of at least one of an original source and an original target has been reversed. The settings of one or more relation indicators are also determined. Processing to be performed is identified based on the determinations of whether designations have been reversed and based on the settings of the one or more relation indicators.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07124323&OS=07124323&RS=07124323
owner: International Business Machines Corporation
number: 07124323
owner_city: Armonk
owner_country: US
publication_date: 20030618
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION","Additional Implementation Details"],"p":["This application is related to the following commonly assigned and co-pending U.S. patent applications:","U.S. patent application Ser. No. 10\/464,918, entitled \u201cMETHOD, SYSTEM, AND PROGRAM FOR REVERSE RESTORE OF AN INCREMENTAL VIRTUAL COPY,\u201d by S. Werner, et al.; and","U.S. patent application Ser. No. 10\/465,118, entitled \u201cMETHOD, SYSTEM, AND PROGRAM FOR INCREMENTAL VIRTUAL COPY,\u201d by S. Werner et al.;","each of which is filed on the same date herewith, and which is incorporated by reference herein in its entirety.","1. Field of the Invention","The present invention is directed to recovery of a reverse restore operation.","2. Description of the Related Art","Computing systems often include one or more host computers (\u201chosts\u201d) for processing data and running application programs, direct access storage devices (DASDs) for storing data, and a storage controller for controlling the transfer of data between the hosts and the DASD. Storage controllers, also referred to as control units or storage directors, manage access to a storage space comprised of numerous hard disk drives connected in a loop architecture, otherwise referred to as a Direct Access Storage Device (DASD). Hosts may communicate Input\/Output (I\/O) requests to the storage space through the storage controller.","In many systems, data on one storage device, such as a DASD, may be copied to the same or another storage device so that access to data volumes can be provided from two different devices. A point-in-time copy involves physically copying all the data from source volumes to target volumes so that the target volume has a copy of the data as of a point-in-time. A point-in-time copy can also be made by logically making a copy of the data and then only copying data over when necessary, in effect deferring the physical copying. This logical copy operation is performed to minimize the time during which the target and source volumes are inaccessible.","A number of direct access storage device (DASD) subsystems are capable of performing \u201cinstant virtual copy\u201d operations, also referred to as \u201cfast replicate functions.\u201d Instant virtual copy operations work by modifying metadata such as relationship tables or pointers to treat a source data object as both the original and copy. In response to a host's copy request, the storage subsystem immediately reports creation of the copy without having made any physical copy of the data. Only a \u201cvirtual\u201d copy has been created, and the absence of an additional physical copy is completely unknown to the host.","Later, when the storage system receives updates to the original or copy, the updates are stored separately and cross-referenced to the updated data object only. At this point, the original and copy data objects begin to diverge. The initial benefit is that the instant virtual copy occurs almost instantaneously, completing much faster than a normal physical copy operation. This frees the host and storage subsystem to perform other tasks. The host or storage subsystem may even proceed to create an actual, physical copy of the original data object during background processing, or at another time.","One such instant virtual copy operation is known as a FlashCopy\u00ae operation. A FlashCopy\u00ae operation involves establishing a logical point-in-time relationship between source and target volumes on the same or different devices. The FlashCopy\u00ae operation guarantees that until a track in a FlashCopy\u00ae relationship has been hardened to its location on the target disk, the track resides on the source disk. A relationship table is used to maintain information on all existing FlashCopy\u00ae relationships in the subsystem. During the establish phase of a FlashCopy\u00ae relationship, one entry is recorded in the source and target relationship tables for the source and target that participate in the FlashCopy\u00ae being established. Each added entry maintains all the required information concerning the FlashCopy\u00ae relationship. Both entries for the relationship are removed from the relationship tables when all FlashCopy\u00ae tracks from the source extent have been physically copied to the target extents or when a withdraw command is received. In certain cases, even though all tracks have been copied from the source extent to the target extent, the relationship persists.","The target relationship table further includes a bitmap that identifies which tracks involved in the FlashCopy\u00ae relationship have not yet been copied over and are thus protected tracks. Each track in the target device is represented by one bit in the bitmap. The target bit is set when the corresponding track is established as a target track of a FlashCopy\u00ae relationship. The target bit is reset when the corresponding track has been copied from the source location and destaged to the target device due to writes on the source or the target device, or a background copy task.","In the prior art, as part of the establishment of the logical point-in-time relationship during the FlashCopy\u00ae operation, all tracks in the source cache that are included in the FlashCopy\u00ae relationship must be destaged to the physical source volume, e.g., source DASD, and all tracks in the target cache included in the FlashCopy\u00ae must be discarded. Further details of the FlashCopy\u00ae operations are described in the copending and commonly assigned U.S. patent application Ser. No. 09\/347,344, filed on Jul. 2, 1999, entitled \u201cMethod, System, and Program for Maintaining Electronic Data as of a Point-in-Time\u201d, which patent application is incorporated herein by reference in its entirety.","Once the logical relationship is established, hosts may then have immediate access to data on the source and target volumes, and the data may be copied as part of a background operation. A read to a track that is a target in a FlashCopy\u00ae relationship and not in cache triggers a stage intercept, which causes the source track corresponding to the requested target track to be staged to the target cache when the source track has not yet been copied over and before access is provided to the track from the target cache. This ensures that the target has the copy from the source that existed at the point-in-time of the FlashCopy\u00ae operation. Further, any destages to tracks on the source device that have not been copied over triggers a destage intercept, which causes the tracks on the source device to be copied to the target device.","Instant virtual copy techniques have been developed, at least in part, to quickly create a duplicate copy of data without interrupting or slowing foreground processes. Instant virtual copy techniques, such as a FlashCopy\u00ae operation, provide a point-in-time copy tool. Instant virtual copy techniques may be used for a variety of applications, including, for example, data backup, data migration, data mining, testing, etc. For example, an instant virtual copy technique may be used for the creation of a physical \u201cbackup\u201d copy of the source data, to aid in disaster recovery.","Although the instant virtual copy techniques are useful for copying large amounts of data, conventional instant virtual copy techniques may be improved.","Provided are a method, system, and program for processing interruption of an operation that transfers data between a source and a target. An indication that a reverse restore operation has been interrupted is received. It is determined whether designation of at least one of an original source and an original target has been reversed. The settings of one or more relation indicators are also determined. Processing to be performed is identified based on the determinations of whether designations have been reversed and based on the settings of the one or more relation indicators.","The described implementations of the invention provide a method, system, and program for processing an interrupt of a reverse restore operation that performs a reverse incremental virtual copy operation.","In the following description, reference is made to the accompanying drawings which form a part hereof and which illustrate several implementations of the present invention. It is understood that other implementations may be utilized and structural and operational changes may be made without departing from the scope of the present invention.","An incremental virtual copy operation is an enhancement to an instant virtual copy operation. With the incremental virtual copy operation, only the blocks of data that were updated on source and target volumes since the last copy operation (e.g., instant virtual copy operation) from the source volume to the target volume are copied. A reverse restore operation is an enhancement to an incremental virtual copy operation. With the reverse restore operation, updates may be made to a source or target volume of an instant virtual copy. Then, the changes from the original target volume may be applied back to a corresponding original source volume, making the original source volume a point-in-time copy of the original target volume.","Implementations of the invention provide recovery of a reverse restore operation. That is, when the reverse restore operation is interrupted by some type of error event (e.g., hardware and\/or software failures), implementations of the invention provide recovery by either undoing the operation and restoring the status of data to its original state (e.g., by performing a roll back operation) or by completing the reverse restore operation (e.g., by performing a roll forward operation starting at a roll forward point). Implementations of the invention determine the processing to be performed based on whether designations of source and target have been reversed (e.g., an original source is designated as a new target and\/or an original target is designated as a new source) and on the setting of one or more indicators, which will be referred to herein as \u201crelation\u201d indicators.",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIGS. 1A and 1B","b":["100","140","190","120","130","122","132","130","120"],"i":["a,b, . . . l ","a,b . . . n ","a,b . . . m, "]},"The source storage  includes one or more volumes which may be divided into blocks of storage  containing blocks of data, and the blocks of storage  are further divided into sub-blocks of storage (\u2013where a and p may be any integer value) that contain sub-blocks of data. A volume may be any logical or physical element of storage. In certain implementations, the blocks of data are contents of tracks, while the sub-blocks of data are contents of sectors of tracks.","Target storage  maintains copies of all or a subset of the volumes of the source storage . Additionally, target storage  may be modified by, for example, host . Target storage  includes one or more volumes which may be divided into blocks of storage  containing blocks of data, and the blocks of storage  are further divided into sub-blocks of storage (\u2013where a and p may be any integer value) that contain sub-blocks of data. A volume may be any logical or physical element of storage. In certain implementations, the blocks of data are tracks, while the sub-blocks of data are sectors of tracks.","For ease of reference, the terms tracks and sectors will be used herein as examples of blocks of data and sub-blocks of data, but use of these terms is not meant to limit implementations of the invention to tracks and sectors. The implementations of the invention are applicable to any type of storage, block of storage or block of data divided in any manner. Moreover, although implementations of the invention refer to blocks of data, alternate implementations of the invention are applicable to sub-blocks of data.","The storage controller  includes a source cache  in which updates to tracks in the source storage  are maintained until written to source storage  (i.e., the tracks are destaged to physical storage). The storage controller  includes a target cache  in which updates to tracks in the target storage  are maintained until written to target storage  (i.e., the tracks are destaged to physical storage). The source cache  and target cache  may comprise separate memory devices or different sections of a same memory device. The source cache  and target cache  are used to buffer read and write data being transmitted between the hosts source storage , and target storage . Further, although caches  and  are referred to as source and target caches, respectively, for holding source or target blocks of data in a point-in-time copy relationship, the caches  and  may store at the same time source and target blocks of data in different point-in-copy relationships.","Additionally, the storage controller  includes a nonvolatile cache . The non-volatile cache  may be, for example, a battery-backed up volatile memory, to maintain a non-volatile copy of data updates.","The storage controller  further includes system memory , which may be implemented in volatile and\/or non-volatile devices. The system memory  includes a read process  for reading data, a write process  for writing data, an incremental virtual copy process , a reverse restore process , and a reverse restore recovery process . The read process  executes in system memory  to read data from storages  and  to caches  and , respectively. The write process  executes in system memory  to write data from caches  and  to storages  and , respectively. The incremental virtual copy process  executes in system memory  to perform an incremental virtual copy operation that transfers data from source storage  to target storage . The incremental virtual copy process is described further in the cross-referenced patent application \u201cMETHOD, SYSTEM, AND PROGRAM FOR INCREMENTAL VIRTUAL COPY,\u201d by S. Werner, et al., Ser. No. 10\/465,118, which is incorporated herein in its entirety. The reverse restore process  executes in system memory  to perform a reverse restore operation that reverses the roles of the original source and original target and transfers data from the original target storage  to the original source storage . The reverse restore process is described further in the cross-referenced patent application \u201cMETHOD, SYSTEM, AND PROGRAM FOR REVERSE RESTORE OF AN INCREMENTAL VIRTUAL COPY,\u201d by S. Werner, et al., Ser. No. 10\/464,918. The reverse restore recovery process  executes in system memory  to perform recovery operations for a reverse restore process  that is interrupted (e.g., by an error event).","In certain implementations of the invention, there may be multiple reverse restore recovery processes . In certain implementations of the invention, the reverse restore recovery process  may be executed at another storage controller connected to storage controller  instead of, or in addition to, execution at the storage controller . The system memory  may be in a separate memory devices from caches  and  or may share a memory device with one or both caches  and .","Implementations of the invention are applicable to the transfer of data between any two storage mediums, which for ease of reference will be referred to herein as source storage and target storage or as first storage and second storage. For example, certain implementations of the invention may be used with two storage mediums located at a single storage controller, as illustrated in . Moreover, certain alternative implementations of the invention may be used with two storage mediums located at different storage controllers, different physical sites, etc. Also, for ease of reference, a block of data in source storage will be referred to as a \u201csource block of data,\u201d and a block of data in target storage will be referred to as a \u201ctarget block of data.\u201d When the indication of which storage is source storage and which storage is target storage is reversed, for ease of reference, the original \u201csource block of data\u201d will be referred to as the \u201cnew target block of data,\u201d and the original \u201ctarget block of data\u201d will be referred to as the \u201cnew source block of data.\u201d","In certain implementations, removable storage (instead of or in addition to target storage ) may be used to maintain copies of all or a subset of the source storage , and the implementations of the invention transfer data to the removable storage rather than to the target storage. The removable storage may reside at the storage controller .","The storage controller  may further include a processor complex (not shown) and may comprise any storage controller or server known in the art, such as an Enterprise Storage Server\u00ae (ESS), 3990\u00ae Storage Controller, etc. The hosts may comprise any computing device known in the art, such as a server, mainframe, workstatation, personal computer, hand held computer, laptop telephony device, network appliance, etc. The storage controller  and host system(s) communicate via a network , which may comprise a Storage Area Network (SAN), a Source Area Network (LAN), Wide Area Network (WAN), the Internet, an Intranet, etc. The source storage  and target storage  may each comprise an array of storage devices, such as Direct Access Storage Devices (DASDs), Just a Bunch of Disks (JBOD), Redundant Array of Independent Disks (RAID), virtualization device, etc.","Additionally, although  illustrates a single storage controller, one skilled in the art would know that multiple storage controllers may be connected via a network (e.g., a Source Area Network (LAN), Wide Area Network (WAN), the Internet, etc.), and one or more of the multiple storage controllers may implement the invention.","When host  wishes to update a block of data in source storage , host  writes data to a block of storage in source cache . Write operations modify the block of storage in source cache  synchronously (i.e., writing host  waits for the operation to complete), and then, in a background process, source cache  content is written to source storage . A write operation may update data, write new data, or write the same data again. Writing data in source cache  to source storage  is called a destage operation. Copying all or a portion of a block of data from source storage  to source cache  is a staging operation. Likewise, data may be staged and destaged between target storage  and target cache . Moreover, data may be staged from source storage  to target cache .",{"@attributes":{"id":"p-0048","num":"0047"},"figref":"FIG. 2","b":["200","210","220","212","214","216","222","118","200","200","120","130","124","134","200","120","130","200","120","130","130","120","130"]},"A source change recording structure  is used to monitor updates to blocks of data within portions of data in the source storage  for which an incremental virtual copy relationship has been established. The source change recording structure  includes an indicator (e.g., a bit) for each block of data in the source storage  that is part of the incremental virtual copy relationship. When an indicator is set to a first value (e.g., one), the setting indicates that the block of data has been updated since the last copy operation (e.g., an incremental virtual copy operation or a reverse restore operation). When an indicator is set to a second value (e.g., zero), the setting indicates that the block of data has not been updated since the last copy operation (e.g., an incremental virtual copy operation or a reverse restore operation).","A target change recording structure  is used to monitor updates to blocks of data in the target storage  after an incremental virtual copy relationship has been established. The target change recording structure  includes an indicator (e.g., a bit) for each block of data in the target storage  that is part of the incremental virtual copy relationship. When an indicator is set to a first value (e.g., one), the setting indicates that the block of data has been updated since the last copy operation. When an indicator is set to a second value (e.g., zero), the setting indicates that the block of data has not been updated since the last copy operation.","In certain implementations of the invention, each structure , , and  comprises a bitmap, and each indicator comprises a bit. In each structure , , and , the nth indicator corresponds to the nth block of data (e.g., the first indicator in each structure , , and  corresponds to the first data block). Although the structures , , and  have been illustrated as three separate structures, the structures may be combined in any form without departing from the scope of the invention. In certain implementations of the invention, there is a copy of each structure for each volume. In certain alternative implementations of the invention, there is a single copy of each structure for all volumes. Moreover, although structures  and  are referred to as source and target, respectively, in the illustration, the designation of source and target may be changed when the storage  is to be treated as a target, while storage  is to be treated as a source.","A source reversal in progress indicator (SRIP)  is stored in nonvolatile cache  and is used to indicate whether or not a reverse restore operation is in progress for a source portion of data. Although the source reversal in progress indicator  is illustrated as being stored in nonvolatile cache , the source reversal in progress indicator  may be stored in nonvolatile cache  or elsewhere. In particular, when the source reversal in progress indicator  is set to a first value (e.g., one), the setting indicates that a reverse restore operation is in progress. When the source reversal in progress indicator  is set to a second value (e.g., zero), the setting indicates that a reverse restore operation is not in progress. A source reversal in progress indicator  is a type of relation indicator. When a reversal of source and target occurs, the source reversal in progress indicator  is associated with the original source (i.e., new target).","Moreover, the nonvolatile cache  stores toggle indicators  that indicate whether a toggle operation is pending for a portion of data in storage  or . In certain implementations of the invention, there is one toggle indicator for the source change recording structure and one toggle indicator for the target change recording structure (i.e., there is a toggle indicator per volume). Although the toggle indicator  is illustrated as being stored in nonvolatile cache , the toggle indicator  may be stored elsewhere. When the toggle indicator  is set to a first value (e.g., one), the setting indicates that a toggle operation is pending. When the toggle indicator  is set to a second value (e.g., zero), the setting indicates that a toggle operation is not pending. A toggle indicator  is a type of relation indicator. Each toggle operation resets the toggle indicators  for either the source or target change recording structure  or  to indicate that no changes have occurred since the last copy operation (e.g., an incremental virtual copy operation).","Additionally, the nonvolatile cache  stores a merge complete indicator  that indicates whether a merge of change recording structures  and  is complete. Although the merge complete indicator  is illustrated as being stored in nonvolatile cache , the merge complete indicator  may be stored in nonvolatile cache  or elsewhere. When the merge complete indicator  is set to a first value (e.g., one), the setting indicates that merging of the source and target change recording structures  and  is complete. When the merge complete indicator  is set to a second value (e.g., zero), the setting indicates that merging of the source and target change recording structures  and  is not complete. A merge complete indicator  is a type of relation indicator.","A target reversal in progress indicator (TRIP)  is stored in nonvolatile cache  and is used to indicate whether or not a reverse restore operation is in progress. Although the target reversal in progress indicator  is illustrated as being stored in nonvolatile cache , the target reversal in progress indicator  may be stored in nonvolatile cache  or elsewhere. In particular, when the target reversal in progress indicator  is set to a first value (e.g., one), the setting indicates that a reverse restore operation is in progress. When the target reversal in progress indicator  is set to a second value (e.g., zero), the setting indicates that a reverse restore operation is not in progress. A target reversal in progress indicator  is a type of relation indicator. When a reversal of source and target occurs, the target reversal in progress indicator  is associated with the original target (i.e., new source).",{"@attributes":{"id":"p-0056","num":"0055"},"figref":"FIG. 3","b":["116","300","120","130"]},"In block , the incremental virtual copy process  updates indicators in the target copy structure  to indicate that all of the blocks of data corresponding to the indicators are to be retrieved from source storage for a staging operation and to indicate that all blocks of data are to be copied from source storage to target storage for a physical copy operation. In certain implementations of the invention, the indicators in the target copy structure  are set to one.","In block , the incremental virtual copy process  updates the indicators in the source change recording structure  to indicate that the source blocks of data corresponding to the indicators have not been updated since the last copy operation (e.g., incremental virtual copy operation). In certain implementations of the invention, all of the indicators in the source change recording structure  are set to zero. In block , the incremental virtual copy process  updates the indicators in the target change recording structure  to indicate that the target blocks of data corresponding to the indicators have not been updated since the last copy operation (e.g., incremental virtual copy operation). In certain implementations of the invention, all of the indicators in the target change recording structure  are set to zero.",{"@attributes":{"id":"p-0059","num":"0058"},"figref":["FIG. 4","FIG. 4","FIG. 4","FIG. 4"],"b":["117","120","130","117","400","117","140","120","130","140"]},"When portions (e.g., storage, volumes, tracks, sectors, etc.) of data in the source storage  are originally treated as source portions of data, and portions of data in the target storage  are originally treated as target portions of data, a reversal of the designations of source and target treats the portions of data in the target storage  as source portions of data and treats the portions of data in the source storage  as the target portions of data. Then, copying is performed from the new source to the new target (e.g., from storage  to storage ). When the indication of which portions of data are to be treated as source and target is reversed, for ease of reference, the portions of data that are to be treated as source may be referred to as \u201cnew source\u201d portions of data (e.g., new source storage or new source block of data), and the portions of data that are to be treated as target may be referred to as \u201cnew target\u201d portions of data (e.g., new target storage or new target block of data). Moreover, if there is an interruption in the processing of , the reverse restore operation, the logic of , B, and C is performed.","In block , the TRIP indicator  is set to indicate that a reverse restore operation is in progress for a new source (i.e., the original target), and a toggle indicator  for the new source (also referred to as \u201ca new source toggle indicator\u201d ) is set to indicate that a toggle operation is pending for the new source. At this time, the setting of the SRIP indicator  indicates that a reverse restore operation is not in progress for the new target (i.e., the original source). In block , the SRIP indicator  is set to indicate that a reverse restore operation is in progress for a new target (i.e., the original source), and a toggle indicator  for the new target (also referred to as \u201ca new target toggle indicator\u201d) is set to indicate that a toggle operation is pending for the new target. The SRIP indicator  is set when processing a reverse restore for the original source relation entry by updating the relation entry, and the TRIP indicator  is set when processing a reverse restore for the original target relation entry by updating the relation entry. A source relation entry holds information about the source, such as identifying a corresponding target. A target relation entry holds information about the target, such as identifying a corresponding source.","In block , the reverse restore process  updates indicators in the source change recording structure  for the new source to indicate that the new source blocks of data have not been updated since the last copy operation (e.g., incremental virtual copy operation or reverse restore operation) and updates the toggle indicator for the new source to indicate that a toggle operation is not pending for the new source and that a copy of the source change recording structure  was made before updating the source change recording structure . In certain implementations of the invention, all of the indicators in the source change recording structure  are set to zero.","In block , the reverse restore process  updates the indicators in the target change recording structure  for the new target to indicate that the new target blocks of data have not been updated since the last copy operation (e.g., incremental virtual copy operation or reverse restore operation) and updates the toggle indicator for the new target to indicate that a toggle operation is not pending for the new target and that a copy of the target change recording structure  was made before updating the target change recording structure . In certain implementations of the invention, all of the indicators in the target change recording structure  are set to zero.","In block , the reverse restore process  updates indicators in the new target copy structure  for the new target with indicators in the copies of the new source and new target change recording structures  and  and a merge complete indicator  is set to indicate that a merge is complete. In certain implementations of the invention, the copy of the source change recording structure  is merged with the copy of the target change recording structure  using an \u201cOR\u201d operation, and the result of the \u201cOR\u201d operation is stored in the target copy structure .","In block , the reverse restore process  updates an indication that the original source is acting as the new target and sets the SRIP indicator  to indicate that a reverse restore operation is not in progress. In block , the reverse restore process  updates an indication that the original target is acting as the new source and sets the TRIP indicator  to indicate that a reverse restore operation is not in progress.",{"@attributes":{"id":"p-0066","num":"0065"},"figref":"FIG. 5","b":["114","500","114","520","114","530","560","530","114","120","130","540","550"]},"In block , the indicator for the block of data in the target change recording structure  is updated to indicate that the target block of data has changed since the last copy operation (e.g., incremental virtual copy operation). In certain implementations of the invention, the indicator in the target change recording structure  is set to one. In block , the indicator for the block of data in the source change recording structure  is updated to indicate that the source block of data has changed since the last copy operation (e.g., incremental virtual copy operation). In certain implementations of the invention, the indicator in the source change recording structure  is set to one. In block , the write operation is performed by the write process .",{"@attributes":{"id":"p-0068","num":"0067"},"figref":"FIG. 6","b":["112","600","620","112","630","660","630","120","640","650"]},"In block , the read process  reads (i.e., stages) the block of data from source storage . In block , the read process  reads (i.e., stages) the block of data from target storage . In block , the read process  performs a normal read of the block of data.",{"@attributes":{"id":"p-0070","num":"0069"},"figref":"FIG. 7","b":["700","710","200","730","720","720"]},"In block , the block of data is read in accordance with the logic of . In block , the block of data is destaged to target storage (which may be either storage  or , depending on the designation of source and target). In block , an indicator in the target copy structure  is updated for the block of data to indicate that the block of data has been copied. In certain implementations of the invention, the indicator in the target copy structure  is set to zero.",{"@attributes":{"id":"p-0072","num":"0071"},"figref":["FIGS. 8A","FIGS. 8A"],"b":["8","8","8","8","120","130"]},"The logic of , B, and C will be described with reference to , which illustrates a table  describing states and recovery actions in accordance with certain implementations of the invention. For the example described herein, volume A of table  is designated as an original source volume, and volume B is designated as an original target volume. In particular, table  includes a column for a row identifier (e.g., a number), an indication of whether volume A (e.g., a source volume) is a source or target, an indication of whether any relation indicators are currently set for volume A, an indication of whether a volume B (e.g., a target volume) is a source or target, an indication of whether any relation indicators are currently set for volume B, and recovery actions that are performed based on the indications.","Control begins in block  with recognition that the reverse restore operation has been interrupted. In block , if it is determined that the source and target have not been reversed yet and no relation indicators have been set such that processing is required (e.g., set as indicated in following blocks \u2013), processing is done, otherwise, processing continues to block . In particular, when the SRIP and TRIP indicators have been set to indicate that a reverse restore operation is not in progress and a merge complete indicator is set to indicate that merging of the change recording structures is complete, it is determined that the relation indicators are set such that processing is not required. For example, in row  of table , volume A is initially designated as a source, volume B is initially designated as a target, no relation indicators have been set to first values, and no action is required.","In block , if the designation of the original source is not reversed, the designation of the original target is reversed, a SRIP indicator is set to indicate that a reverse restore operation is not in progress, a TRIP indicator is set to indicate that a reverse restore operation is in progress, and a new source toggle indicator is set to indicate that a toggle operation is pending, processing continues to block , otherwise, processing continues to block . In block , a roll back operation is performed, and the original target is designated as a target. A roll back operation \u201crolls back\u201d processing that has occurred. Additionally, since the designation of the original target was reversed (i.e., set to source), this designation is again reversed. For example, in row  of table , the designation of volume A has not been reversed (i.e., volume A is still a source), the designation of volume B has been reversed so that volume B is a source, the TRIP indicator is set to indicate that a reverse restore operation is in progress, and the new source indicator for volume B has been set to indicate that a toggle operation is pending. Then, a roll back operation is performed, and volume B is designated as a target.","A toggle operation resets indicators in the change recording structures to indicate that no changes to the source and target have occurred since the last copy operation (e.g., incremental virtual copy operation or reverse restore operation). In particular, in order to correctly recover from a reverse restore operation that was interrupted, implementations of the invention determine whether the change recording structures were toggled. Therefore, before the roll forward point, a call to \u201cprepare to toggle\u201d is issued to both the source and target change recording structures, and this sets a toggle indicator to indicate that a toggle operation is pending. Once the change recording structure has been reset, the corresponding toggle indicator is set to indicate that the toggle operation is complete. When recovery of the interruption is performed, a check of the toggle indicator and the merge complete indicator is used to determine whether the toggle operation has completed. When a toggle indicator is set to indicate that a toggle operation is not pending and a merge complete indicator is set to indicate that merging is not complete, then it is determined that a toggling operation has completed.","Moreover, the toggle indicator for the source change recording structure is set when the TRIP indicator is set to indicate that reversal of the target is in progress. The recovery of the incremental virtual copy relationship toggles the source change recording structure after the roll forward point.","In block , if the designation of the original source and original target have been reversed, the SRIP and TRIP indicators have been set to indicate that a reverse restore operation of both source and target is in progress, and both a new source toggle indicator and a new target toggle indicator are set to indicate that a toggle operation is pending, processing continues to block , otherwise, processing continues to block . In block , a roll forward operation is performed, starting with the processing of block  in . For example, in row  of table , the designation of volume A has been reversed to target, the SRIP indicator is set to indicate that a reversal of the original source is in progress, the new target toggle indicator is set to indicate that a toggle operation is pending, the designation of volume B has been reversed to source, the TRIP indicator is set to indicate that a reversal of the original target is in progress, and the new source toggle indicator is set to indicate that a toggle operation is pending. Then, a roll forward operation is performed, starting with the processing of block  in .","In block , if the designation of the original source and original target have been reversed, the SRIP and TRIP indicators have been set to indicate that a reverse restore operation of both source and target is in progress, a new target toggle indicator is set to indicate that a toggle operation is pending, and a new source toggle indicator is set to indicate that a toggle operation is not pending, processing continues to block , otherwise, processing continues to block . In block , a roll forward operation is performed, starting with the processing of block  in . For example, in row  of table , the designation of volume A has been reversed to target, the SRIP indicator is set to indicate that a reversal of the original source is in progress, the new target toggle indicator is set to indicate that a toggle operation is pending, the designation of volume B has been reversed to source, the TRIP indicator is set to indicate that a reversal of the original target is in progress, and the new source toggle indicator is set to indicate that a toggle operation is not pending. Then, a roll forward operation is performed, starting with the processing of block  in .","In block , if the designation of the original source and original target have been reversed, the SRIP and TRIP indicators have been set to indicate that a reverse restore operation of both source and target is in progress, and a merge complete indicator is set to indicate that merging of the change recording structures is not complete, processing continues to block , otherwise, processing continues to block . In block , a roll forward operation is performed, starting with the processing of block  in .","In certain implementations of the invention, once the TRIP indicator is set in the target relation entry to indicate that a reverse restore operation is in progress, the roll forward point is reached. In certain implementations of the invention, if the reverse restore operation is interrupted by error after passing the roll forward point, the new target relation entry is recovered before the recovery of a new source relation entry.","For example, in row  of table , the designation of volume A has been reversed to target, the SRIP indicator is set to indicate that a reversal of the original source is in progress, the designation of volume B has been reversed to source, and the TRIP indicator is set to indicate that a reversal of the original target is in progress. Then, a roll forward operation is performed, starting with the processing of block  in .","In block , if the designation of the original source and original target have been reversed, the SRIP and TRIP indicators have both been set to indicate that a reverse restore operation is in progress, and a merge complete indicator is set to indicate that merging of the change recording structures is complete, processing continues to block , otherwise, processing continues to block . In block , a roll forward operation is performed, starting with the processing of block  in .","For example, in row  of table , the designation of volume A has been reversed to target, the SRIP indicator is set to indicate that a reverse restore operation is in progress, the merge complete indicator is set to indicate that the merge is complete, the designation of volume B has been reversed to source, and the TRIP indicator is set to indicate that a reverse restore operation is in progress. Then, a roll forward operation is performed, starting with the processing of block  in .","In block , if the designation of the original source and original target have been reversed, the SRIP indicator is set to indicate that a reverse restore operation is not in progress, and the TRIP indicator has been set to indicate that a reverse restore operation is in progress, processing continues to block , otherwise, processing continues to block . In block , a roll forward operation is performed, starting with the processing of block  in . For example, in row  of table , the designation of volume A has been reversed to target, the SRIP indicator is set to indicate that a reverse restore operation is not in progress, the designation of volume B has been reversed to source, and the TRIP indicator is set to indicate that a reverse restore operation is in progress. Then, a roll forward operation is performed, starting with the processing of block  in .","In block , if the designation of the original source and original target have been reversed, and no relation indicators are set such that processing is required (e.g., set as indicated in preceding blocks \u2013), processing continues to block , otherwise, processing continues to block . In block , it is recognized that no processing is needed. For example, in row  of table , the designation of source and target have been reversed, and no relation indicators are set, so no action is required.","In block , relation indicators are reset as needed. For example, the SRIP indicator  and TRIP indicator  may be reset to indicate that a reverse restore operation is not in progress. For example, in row  of table , the designation of volume A has been reversed to target, the designation of volume B has been reversed to source, and no relation indicators have been set to first values. No action is required for these states.","Thus, in certain implementations of the invention, the reverse restore operation is achieved by monitoring writes (i.e., updates) and recording changes to tracks for volumes participating in an incremental virtual copy relationship. After an initial incremental virtual copy operation, the direction of the incremental virtual copy operation may be reversed and tracks that have been updated on either a source or a target volume may be copied from the original target volume to the original source volume, without copying the entire original target volume. Implementations of the invention provide recovery of a reverse restore operation. That is, when the reverse restore operation is interrupted by some type of error event (e.g., hardware and\/or software failures), implementations of the invention provide recovery by either undoing the operation and restoring the status of data to its original state (e.g., by performing a roll back operation) or by completing the reverse restore operation (e.g., by performing a roll forward operation).","Enterprise Storage Server, FlashCopy, and 3990 are registered trademarks or common law marks of International Business Machines Corporation in the United States and\/or other countries.","The described techniques for recovery of a reverse restore operation may be implemented as a method, apparatus or article of manufacture using standard programming and\/or engineering techniques to produce software, firmware, hardware, or any combination thereof. The term \u201carticle of manufacture\u201d as used herein refers to code or logic implemented in hardware logic (e.g., an integrated circuit chip, Programmable Gate Array (PGA), Application Specific Integrated Circuit (ASIC), etc.) or a computer readable medium, such as magnetic storage medium (e.g., hard disk drives, floppy disks, tape, etc.), optical storage (CD-ROMs, optical disks, etc.), volatile and non-volatile memory devices (e.g., EEPROMs, ROMs, PROMs, RAMs, DRAMs, SRAMs, firmware, programmable logic, etc.). Code in the computer readable medium is accessed and executed by a processor. The code in which preferred embodiments are implemented may further be accessible through a transmission media or from a file server over a network. In such cases, the article of manufacture in which the code is implemented may comprise a transmission media, such as a network transmission line, wireless transmission media, signals propagating through space, radio waves, infrared signals, etc. Thus, the \u201carticle of manufacture\u201d may comprise the medium in which the code is embodied. Additionally, the \u201carticle of manufacture\u201d may comprise a combination of hardware and software components in which the code is embodied, processed, and executed. Of course, those skilled in the art will recognize that many modifications may be made to this configuration without departing from the scope of the present invention, and that the article of manufacture may comprise any information bearing medium known in the art.","The term \u201ccopy operation\u201d herein may refer to various types of operations, including, for example: establishing an incremental virtual copy relationship, \u201cincrementing\u201d an incremental virtual copy operation, or \u201creverse restoring\u201d an incremental virtual copy relationship.","The logic of , , , , , A, B, and C describes specific operations occurring in a particular order. In alternative implementations, certain of the logic operations may be performed in a different order, modified or removed. Moreover, operations may be added to the above described logic and still conform to the described implementations. Further, operations described herein may occur sequentially or certain operations may be processed in parallel, or operations described as performed by a single process may be performed by distributed processes.","The illustrated logic of , , , , , A, B, and C may be implemented in software, hardware, programmable and non-programmable gate array logic or in some combination of hardware, software, or gate array logic.",{"@attributes":{"id":"p-0094","num":"0093"},"figref":"FIG. 10","b":["100","140","1000","1000","1002","1004","1010","1005","1004","1010","1006","1010","1004","1002","1008","1012","1002","1014","1002","1000"]},"The computer architecture  may comprise any computing device known in the art, such as a mainframe, server, personal computer, workstation, laptop, handheld computer, telephony device, network appliance, virtualization device, storage controller, etc. Any processor  and operating system  known in the art may be used.","The foregoing description of implementations of the invention has been presented for the purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise form disclosed. Many modifications and variations are possible in light of the above teaching. It is intended that the scope of the invention be limited not by this detailed description, but rather by the. claims appended hereto. The above specification, examples and data provide a complete description of the manufacture and use of the composition of the invention. Since many implementations of the invention can be made without departing from the spirit and scope of the invention, the invention resides in the claims hereinafter appended."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Referring now to the drawings in which like reference numbers represent corresponding parts throughout:",{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIGS. 1A and 1B"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIGS. 8A","b":["8","8"]},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 10"}]},"DETDESC":[{},{}]}
