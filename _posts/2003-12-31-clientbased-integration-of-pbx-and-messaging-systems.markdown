---
title: Client-based integration of PBX and messaging systems
abstract: This invention integrates instant messaging, presence, and other collaborative capabilities with conventional PBX functionality through use of a PBX-Messaging Integration Client (PMIC). The invention in its several embodiments features a method and system for using the PMIC-based computer interface to perform off-hook/on-hook presence notification for a PBX phone, establish media sessions concurrent with PBX telephonic communication, execute custom call treatment in conjunction with a PBX phone, implement call transfer capability between a PBX phone and numerous other devices, and provide PBX call control. The PBX is generally enabled with computer telephony integration (CTI) and, depending on the embodiment, a Voice-over-Internet Protocol (VoIP) such as Session Initiation Protocol (SIP). The invention empowers enterprise workers with a diverse, unified and integrated set of both PBX functions and SIP-based collaboration tools.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07804949&OS=07804949&RS=07804949
owner: Alcatel Lucent
number: 07804949
owner_city: Paris
owner_country: FR
publication_date: 20031231
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF THE INVENTION","BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"p":["The present invention relates to a technique for integrating one or more user interfaces with a PBX phone system. In particular, the invention relates to a method and system for providing off-hook\/on-hook presence notification for a PBX phone, establishing media sessions concurrent with PBX telephonic communication, customized call treatment for a PBX phone, call transfer capability between a PBX phone and numerous other devices, and PBX call control.","Private Branch Exchange (PBX) telephone systems are used in many businesses to enable workers to make and receive calls from the Public Switched Telephone Network (PSTN) and other PBX phones within the enterprise. PBX systems also provide a host of telephonic services to the enterprise workers including call forwarding, transferring, conferencing, voice mail, personalized greetings, and the like.","In many cases, an enterprise worker's phone resides on the desktop in immediate proximity to the worker's personal computer. The personal computer may provide tools for word processing, viewgraph editing, email, and web browsing, as well as other communications tools such as instant messaging, buddy lists, presence, video, and other tools for collaboration. Instant messaging allows people with network access to send text messages and other media to other individuals listed in a buddy or contact list. An instant text message is sent in near-real time to a contact where it is then displayed in a graphical user interface window within the context of an on-going text-based conversation. In addition to text messages, instant messaging may also be used within chat sessions and custom chat rooms where friends or co-workers can interact and share media. Some instant messaging applications are also enabled with a presence protocol used by a one person to determine whether a buddy or contact is \u201cpresent\u201d online and to subscribe to changes in the presence state or information.","Despite the prevalence of PBX phones and communications-enabled personal computers in the enterprise, there is an absence of sufficient integration between these two types of communication systems. For example, an enterprise worker's instant messaging application may be aware of the worker's online presence but is oblivious to the worker's telephonic presence, i.e. buddies do not know that a worker is occupied on his PBX phone. Or, as a second example, although a worker sets up a voice session to another worker by dialing a PBX extension, an entirely separate process must be followed to setup a session for exchanging a document. Therefore, there is a need for a solution that integrates the PBX system and communications applications on enterprise workers' computers to provide greater interoperability, simplified PBX control, and enhanced sharing and collaboration.","The invention in its several embodiments features a method and system for using a computer interface to perform off-hook\/on-hook presence notification for a PBX phone, establish media sessions concurrent with PBX telephonic communication, execute custom call treatment in conjunction with a PBX phone, implement call transfer capability between a PBX phone and numerous other devices, and provide PBX call control. The PBX is generally enabled with computer telephony integration (CTI) capabilities and may also, depending on the embodiment, be enabled with Voice-over-Internet Protocol (VoIP) capabilities such as Session Initiation Protocol (SIP). The computer interface may be any number of computer appliances including personal computer also enabled with CTI, for example.","In one embodiment, the invention relates to a presence notification method for communicating an enterprise worker's on-phone\/off-phone presence state to other workers using a computer interface operatively coupled to a system comprising a private branch exchange (PBX) and a first PBX phone. The presence notification method preferably comprises the steps of: receiving from the PBX a first message indicating an off-hook state of the first PBX phone; consulting a subscriber table including the identity of one or more presence-state subscribers; and transmitting a second message to at least one of the one or more presence-state subscribers indicating the off-hook state of the first PBX phone.","In a second embodiment, the invention relates to a method for establishing a collateral communication session between a plurality of enterprise workers' computer interfaces in response to a call between the workers. The collateral communication session, referred to herein as a concurrent media session, may take a number of forms including text messaging, document exchange, desktop sharing, and video, for example. The method for establishing concurrent media session setup using a first computer interface operatively coupled to a system comprising a private branch exchange (PBX) and a second computer interface preferably comprises the steps of: receiving from the PBX a first message signifying that the second PBX phone has called the first PBX phone; transmitting a second message from the first computer interface to the second computer interface requesting a media session; determining whether the media session request has been accepted at the second computer interface; and establishing a media session between the first computer interface and second computer interface if the session request message is accepted.","In a third embodiment, the invention relates to a method for performing custom call treatment allowing a recipient of an incoming PBX call to respond to the call by transferring the call to another device or responding with an instant message, for example, depending on various factors including the caller, the time, and date. The call treatment method in a first computer interface operatively coupled to a system comprising a private branch exchange (PBX) and a first PBX phone preferably comprises the steps of: receiving from the PBX a first message indicating an incoming call; determining from a call routing table maintained by the first computer interface an incoming call response to the incoming call; and transmitting a group of one or more messages based on the incoming call response, wherein the group comprises a second message answering the incoming call.","In a fourth embodiment, the invention relates to a method for transferring a call between an enterprise worker's PBX phone and an associated computer interface. The call transfer method in a first computer operatively coupled to a system comprising a private branch exchange (PBX) and a first PBX phone, preferably comprises the steps of: transmitting to the PBX a first message for transferring a telephone call associated with the first PBX phone; establishing a voice-over-IP session between the PBX and the first computer; and replacing the telephone call to first PBX phone with a call to the first computer via the voice-over-IP session.","In a fifth embodiment, the present invention relates to a method of controlling PBX telephone calls to a worker's PBX phone using a computer interface operatively coupled to a system comprising a PBX and a first PBX phone. The PBX call control method preferably comprises the steps of: receiving from the PBX a first message indicating the presence of a telephone call associated with the first PBX phone; and transmitting to the PBX a call control message, such as a call-hold command, or call-forwarding command directing the PBX to another PBX phone or VoIP client, for example.",{"@attributes":{"id":"p-0042","num":"0041"},"figref":"FIG. 1","b":["100","110","130","132","110","131","133","102","100"]},"Also operating within the enterprise is a data communications network  embodied in or operably coupled to a local area network (LAN), a wide area network (WAN), a metropolitan area network (MAN), the Internet Protocol (IP) network , or a combination thereof. The communications network  operably couples a plurality of computers enabled with a PBX-Messaging Integration Client (PMIC) - distributed throughout the enterprise to each other and to the resources available through the World Wide Web using Ethernet and or the transmission control protocol (TCP)\/IP protocol suite. Each of the PMICs - is generally associated with an individual enterprise worker. In most cases, an individual's PMIC is located in the immediate proximity to the individual's phone, thus giving rise to a logical association between a user PMIC and a user phone. The logical association between a PMIC, a phone, and a single user exist for a multiplicity of enterprise workers including a first user , second user , and third user , and so on.","In the preferred embodiment, the PBX  is enabled with a computer telephone integration (CTI) protocol, which refers to a signaling convention by which the PMICs - may control and monitor PBX functions. In the preferred embodiment, the PMICs - are adapted to act as individualized clients for: (1) placing and answering PBX calls without a PBX phone, (2) routing incoming call directed PBX extensions to other devices, (3) forwarding calls away from PBX phones to other devices, and (4) placing calls on hold. In addition to receiving CTI commands, the PBX or the CTI client associated thereto is also adapted to transmit CTI messages upon occurrence of certain events, as is described in greater detail below. Also in the preferred embodiment, the PMIC provides an interface to presence, instant messaging, document exchange, desktop sharing and other capabilities typically resident in applications such Microsoft's Real-Time Communications (RTC) Messenger.",{"@attributes":{"id":"p-0045","num":"0044"},"figref":"FIG. 2A","b":["110","140","142","110","220","102","100","222","130","132","224","150","202","220","222","224","202","200","204","206","208"]},"Signaling and voice communications between the PBX  and phones - are conventionally performed using a digital protocol, although an analog protocol may also be employed. The digital protocol, referred to herein a private digital signaling and voice (PDSV) protocol, comprises a signaling convention that includes operation-codes used to exchange voice communications as well control signals. Although well understood by those skilled in the art, PDSV protocols are generally proprietary implementations and differ between vendors. The major CTI standards are Telephony Application Programming interface (TAPI) and Telephony Services Application Programming Interface (TSAPI), as well as the European Communications Manufacturers Association (ECMA) standard for CTI, namely the Computer Supported Telecommunications Applications (CSTA) protocol.","Illustrated in  is a functional block diagram of a PBX processing module . The PBX processing module  in the preferred embodiment incorporates one or more software and or firmware components that cooperate with switch control  to provide the PBX services . The PBX processing module  may include an operating system , e.g. UNIX-based system or proprietary implementation, that in turn supports a CTI message handler  adapted to generate and respond to various CTI commands in the manner set forth in greater detail below. When a CTI registration command is used to associate a PBX with a PMIC, for example, the CTI message handler  is adapted to transmit various event messages to the PMIC is response to various types of activities involving one or more PBX phones. In particular, the CTI handler  in the preferred embodiment is adapted to transmit a CTI off-hook event to a registered PMIC in response to an off-hook signal received from the associated PBX phone, transmit a CTI on-hook event to a registered PMIC in response to an on-hook signal from the associated PBX phone, transmit a incoming-call event to the PMIC associated with a PBX phone to which the PBX transmits a ring signal, a first call-answered event to the PMIC when the associated phone is used to answer an incoming call, and transmit a second call-answered event to the PMIC associated with the PBX phone used to place a call to another PBX phone when it is answered.","Illustrating in a  is a functional block diagram of a PBX phone typical of user phones -. The user PBX phone preferably includes a handset and base unit  comprising a phone microprocessor module  that enables incoming and outgoing calls. The phone microprocessor module , in combination with the user interface logic , transmits input from the dial pad  and display relevant information at display . The phone microprocessor module , in cooperation with coder\/decoder , conveys incoming voice signals to an audio user interface (AUI)  speaker and outgoing voice signals received at an AUI  microphone to the PDSV interface .","Illustrated in  is a functional block diagram of a user's PMIC-. The PMIC  generally includes the hardware and software necessary to provide access to and exchange voice and control signals with another VoIP client including, in some embodiments, the PBX . In particular, the PMIC  comprises a processing module , display , tactile user interface  preferably including a keyboard, a AUI  with sound card and speaker, and a network interface card (NIC)  operably coupled to the data communications network .","The processing module  generally comprises hardware components including a central processing unit , computer memory , and random access memory (RAM). As illustrated in , the processing module  may further comprise software and or firmware components including a PMIC controller  and a PMIC graphical user interface (GUI)  used by the enterprise worker to monitor and configure the PMIC  as well as bridge between the PBX domain and the VoIP domain. The PMIC  in the preferred embodiment is adapted to monitor calls involving a PBX phone -, intervene in calls under certain circumstances in a manner defined by the user, and establish media sessions on behalf of an enterprise worker in parallel with a telephone call.","Upon receipt of an incoming call, the PMIC  generally consults routing logic  to whether to forward an incoming call to another PBX phone or other device, for example, or respond with a message transmitted via the network . In the process of monitoring calls involving a user's PBX phone, the PMIC  may consult the subscriber table  to identify any Instant Messaging (IM) buddies in a contact list of changes in the enterprise worker's telephonic presence. In some circumstances, the PMIC  may also consult the concurrent media session (CMS) handler  to initiate transmission of an instant message, text chat or other voice and\/or video media session between the PMICs of the users that are engaged in telephonic communication.","PMIC processing module  further comprises a CTI client , preferably a CTI protocol stack, and Real-Time Communications (RTC) client  running on top of an operating system  such MS WINDOWS also by Microsoft Corporation. The CTI client  together with its CTI application programming interface (API)  provides the underlying functionality used to implement the various call control functionality embodied in the PMIC processing of the preferred embodiment. The RTC client  with RTC API  provides support for the Session Initiation Protocol (SIP) used in some embodiments to enable the CMSs, as discussed in greater detail below.","Although the PMICs - in the preferred embodiment are personal computers, one skilled in the art will appreciate that any of a variety of processing devices including desktop computers, laptop computers, personal digital assistants (PDA), Internet-enabled appliances, or mobile communication devices such as cellular phones may be adapted for purposes of this invention.","Illustrated in  is a state diagram characterizing the PBX with which the preferred embodiment interoperates. The PBX  generally monitors (state ) the trunk lines to PSTN  as well as the internal phones -. The operation of the PBX  characterized by the method of  generally falls into at least one of three different categories, namely, an outgoing call placed by a PBX user phone - to a device external to the PBX , a internal call placed by a user phone - to another phone - within the PBX , and or an incoming call to a user phone - from a device external to the PBX .","When a call is initiated by a user phone -, an off-hook signal is transmitted from the phone to the PBX  with \u201cdigits\u201d or dual-tone multi-frequency (DTMF) signals representing a phone number or a PBX extension number. If the off-hook signal  is accompanied by the phone number to an external phone, the PBX  transitions to an external call-placed state , illustrated in greater detail in the external call process  of . Referring to , the PBX  identifies the digits representing external phone number received (step ) from user phone and transmits (step ) a connection request out to the PSTN . Since the preferred embodiment of the PBX  is enabled with CTI, the PBX also transmits (step ) off-hook plus dialed-number events to the associated caller's computer - via the IP network . The off-hook and dialed-number events are messages used to notify a device registered with the PBX, i.e. the caller's PMIC, that user phone has transitioned from on-hook to off-hook to make the call. In the preferred embodiment, a client on the network  must have registered for the notification at the PBX  using a registration event, e.g. a CTI message, requesting notifications about the state of user phone - identified by its extension number. Once registered, the PBX  directs the off-hook plus dialed-number events registered client.","Referring again to , if the off-hook signal  is transmitted from the PBX phone - is accompanied by an extension number of a PBX phone - within the PBX , the PBX transitions to an internal call-placed state  illustrated in greater detail in the internal call process  of . Referring to , the PBX  identifies the extension number received (step ) from user phone and transmits (step ) a ring signal to the call recipient's phone. The PBX also transmits (step ) an off-hook plus dialed-number event with the recipient's extension number to the caller's PMIC - via the IP network . The off-hook dialed-number event is preferably a CTI message, used to notify the caller's computer that caller's phone is now in the off-hook state as well as the particular extension dialed. In the preferred embodiment, the off-hook plus dialed-number event including the extension is transmitted indirectly from the PBX  through a CTI Server to the caller's computer, although the PBX may be used to directly transmit the event to the caller's PMIC.","Referring to , if the PBX  receives an answered signal  from the external call recipient, the PBX transitions from the external call-placed state  to the PDSV voice communication state . Similarly, an off-hook signal  from the call recipient in response to the internal call-placed  will also cause the PBX  to transition to the PDSV voice communication state . The PDSV voice communication state  represents the processing necessary for the PBX  to maintain voice communication, which may involve switch control  operations such as analog-to-digital conversion and filtering, signaling and the like. If the call recipient answers using is a PBX phone, the PBX  may also send a call-answered event comprising the extension of the call recipient's PBX phone to the same registered client that the off-hook plus dialed-extension event was sent. The PDSV voice communication generally continues until a calling or called party goes on-hook  and terminates the voice communication (state ).","At any time during the PDSV voice communications (state ), the call in progress may be transferred to another device. If the PBX  is enabled with a VoIP protocol, for example, the PBX can transfer the call in response to a transfer command , e.g. a CTI message, with an identifier specifying the device to which the voice communication is to be redirected. If transferred to a VoIP client in the enterprise worker's PMIC, for example, the PBX  attempts to establish a VoIP session (state ) and transfer the caller side of the communication to a VoIP device. In the session setup process  associated with the session setup (state ) illustrated in , the PBX  uses the identifier from the transfer command received (step ) to determine in the transfer selection mode (step ) where to forward the VoIP call. A transfer command including a universal resource (URI) designating the caller's PMIC, for example, causes the PBX  to issue (step ) a session request message, e.g., a SIP INVITE, to a VoIP client in the caller's PMIC. If the PBX  receives a SIP OK message  in response to the session request message, the SIP OK testing (step ) is answered in the affirmative and SIP VoIP session (state ) replaces the prior PDSV communication between the caller's phone and PBX . The PBX  may also be adapted to transfer calls to other resources (step ) including other PBX phones or external phones, for example.","After the SIP VoIP session is established (state ), a participant in the session may terminate the session and effectively end the call (state ) by issuing a VoIP termination message such as a SIP BYE message . In the alternative, the participant may transfer the call back to a phone set (state ) using a transfer command  including the appropriate phone extension.","Any time during the PDSV voice communications (state ), the call in progress may be placed on hold (state ) by a hold PDSV operation code from the user's PBX phone or by a hold command  received by the PBX  from the user's PMIC  via the network . Similarly, the call may be taken off hold in response to the appropriate operation code or an un-hold command from the user's PMIC .","In addition to outgoing calls discussed above, the PBX  is also enabled to facilitate incoming calls. When a call  is directed to a user phone - from either another PBX user phone - or external PSTN line, the PBX  transitions into the initial call receiving state . As illustrated the call receiving procedure  of  associated with the initial call receiving state  of , the PBX  transmits (step ) the incoming connection request to the recipient's phone in the form of a ring signal. The PBX  in the preferred embodiment also transmits (step ) an incoming-call event, e.g. a CTI message, via the network  to notify the recipient's PMIC of the connection request.","In the preferred embodiment, the incoming call may be answered at the recipient's PBX phone or by way of a CTI answer event received by the PBX  from the user's PMIC via the network . Upon receipt of an off-hook signal  from the PBX phone, the PBX  transitions to the call answered (state ) illustrated in more detail in the call answered process  of . As shown, receipt of the off-hook signal (step ) causes the PBX  to transmit (step ) a first call-answered event, e.g., a CTI message, notifying the recipient's PMIC that the call has been accepted at the associated PBX phone. If the call is also initiated from a PBX phone - within the PBX system , internal-caller testing (step ) is answered in the affirmative and the PBX  generates a second call-answered event transmitted (step ) to the caller's PMIC. The second call-answered event, e.g. a CTI message, notifies the caller's PMIC when the call is answered by the call recipient at the recipient's PBX phone or other device. Subsequent PDSV voice communications in state  are analogous to that discussed above in context of PDSV voice communication state .","When the incoming call is answered at the call recipient's PMIC, the PBX  generally receives an answer command accompanied by a transfer command from the PMIC. The transfer command includes a URI designating the user's PMIC or a SIP user agent therein and the PBX  transitions to the PBX's VoIP session setup state  consistent with the VoIP session setup state  discussed above. If the session request message issued by the PBX  is accepted, the PBX transitions into the PBX's VoIP session (state ) and the PDSV voice communication terminated. The recipient may subsequently transfer  the call between the PDSV voice communication (state ) and the VoIP session (state ) in the manner described above.","If the transfer command  received while in the initial call receiving (state ) includes a URI designating a phone, computer, or user agent other than that of the recipient, the PBX  effectively transfers the call to the other device and returns to monitoring the phone status (state ).","Illustrated in  is a state diagram characterizing the PMIC for extending the scope and control of a PBX system and extending the scope of the presence sensing into the telephonic domain. The PMIC process  is preferably embodied in one or more user computers within an enterprise that may have a new or existing PBX system consistent with operations discussed above. Each user computer - is adapted to execute the PMIC process , thereby making them PMICs. The plurality of PMICs that interoperate with one another and the PBX  constitute a PMIC system. In general, there is a one-to-one relationship between a PMIC and an enterprise worker's PBX phone.","A PMIC generally monitors (state ) the IP network  for messages transmitted by the PBX  as well as other PMICs in the enterprise. The messages from the PBX  generally fall into one of two categories, namely, call-placed messages indicating that the PBX phone - with which the PMIC is associated is being used to place a call or incoming call messages indicating that the associated PBX phone is receiving a call from either another PBX user phone or external line.","When the PBX phone associated with the PMIC is used to place a call, the PMIC receives the off-hook event  generated by PBX  and transitions into the on-phone presence-state (P-S) processing (state ). The P-S processing (state ) is illustrated in greater detail in the on-phone P-S processing method  of . As illustrated, the PMIC consults (step ) its local subscriber table  to identify the call recipient's presence-state subscribers. A P-S subscriber is party that has registered to receive notice of a co-worker's online presence and or telephonic availability. If one or more subscribers are identified (step ), an on-phone event, e.g., a SIP message, is transmitted (step ) to each subscriber to indicate that the party whose presence-state is being monitored has picked up the PBX phone. Referring to , the PMIC then indirectly monitors the telephonic communications (state ) by listening for any CTI events signifying a change in the ongoing telephonic communication.","When the PBX phone associated with the PMIC receives a call, the PMIC receives an incoming-call event  and transitions to a call-routing mode (state ) in which the PMIC consults its routing logic . The routing logic  is customized by the user and prescribes the action to be taken in response to an incoming call. In the preferred embodiment, the PMIC is adapted to perform one or more of the following: (1) permit the incoming call to ring at the user PBX phone without intervention, (2) transfer the incoming call to the user's PMIC, (3) transfer the incoming call to another device. e.g., the user's cell phone, (4) transfer the incoming call to another PBX phone, or (5) transmit an instant message to the caller. In the preferred embodiment, the user can define individual call-routing rules that prescribe how to respond to the incoming calls as a function of when the call is received, the telephone number or extension of the caller, the time of day and day of week, and the user's presence-state, for example.","If the routing logic  prescribes no action and the call recipient answers the PBX phone, the PMIC receives an off-hook event  from the PBX . The PMIC process  advances to an on-phone presence-state (state ), as illustrated in , as well as a concurrent media session (CMS) setup (state ). The on-phone presence-state (state ) is consistent with the on-phone P-S processing (state ) described above. As illustrated in the CMS setup procedure  of  associated with the CMS setup (state ), the PMIC uses the extension and or phone number from the off-hook event received (step ) to determine (step ) whether to initiate a media session concurrently with the telephonic communication that began when the phone was answered. A media session as used herein refers to a network-domain dialogue between the caller and call recipient established and maintained separate from the telephonic communication. In the preferred embodiment, the concurrent media session may take one of more of the following four forms: (1) a \u201cmessage session\u201d such as a SIP instant message, (2) a \u201ctext session\u201d such as a SIP text chat session, (3) a \u201cmultimedia session\u201d in which a SIP video or audio is exchanged, (4) a document exchange session, or (5) computer GUI interface sharing such as a window-based operating system's \u201cdesktop sharing.\u201d","Referring again to , the CMS testing (step ) is answered in the affirmative if, for example, call recipient's PMIC is configured to automatically attempt to initiate a CMS with all incoming PBX calls, or if the incoming call is from a PBX extension included in a group of one or more numbers pre-selected or otherwise approved by the call recipient. The selection of the type(s) of CMS(s) to be established are determined from user-defined CMS configuration parameters maintained by the call recipient's PMIC handler . A CMS configuration parameter may be set with a default value so that a text chat session or a video session, for example, is automatically established in response to a telephone call. Independent of the initial session type, either user may then manually escalate to a supplemental CMS including document share, screen share mode, or video session, for example. The one or more CMSs are initiated with a session request, e.g., a SIP message, directed from the recipient's PMIC to the caller's PMIC or other SIP conference calling center, e.g., a multi-point control unit known to those skilled in the art. If the session request is accepted with a SIP OK message, the session-request-answered testing (step ) is indicated in the affirmative and the media session launched (step ) between the PMICs of the caller and recipient. In the preferred embodiment, the CMS may be maintained or terminated separate and independent of the telephonic communication. Alternately, the CMS sessions could be terminated with the telephone communication session ended.","Referring again to , the PMIC process  proceeds to passively monitor (state ) the network  for any events signifying a change in the ongoing telephonic communication. When the phone is hung up, for example, the PBX  transmits an on-hook event , e.g. a CTI message, to the recipient's PMIC that causes the PMIC process  to transition to the off-phone P-S processing (state ). In the off-phone P-S processing of , associated with the phone P-S state , the PMIC consults (step ) its local subscriber table  to identify the call recipient's current presence-state subscribers. If one or more subscribers are identified, the subscriptions testing (step ) is answered in the affirmative and each subscribers sent (step ) an P-S status event, e.g., a SIP message, indicating the availability status of the call recipient immediately prior to going off-hook to answering the call. In an alternate embodiment, the availability status sent to each subscriber is on-line status.","Apart from the monitoring function (state ), the PMIC in some embodiments is also adapted to issue commands to the PBX  to alter the telephonic communication involving the associated PBX phone. In the preferred embodiment, the caller may alter the ongoing telephonic communication by taking one of the following actions: (1) terminate the call, (2) place the call on hold, (3) transfer the call, or (4) establish a conference call with one or more additional parties. The user may terminate the call from the PMIC by issuing a terminate command , e.g. a CTI message, that instructs the PBX  to end (state ) voice communications with the user' PBX phone. The user may also issue a hold command A, e.g., a CTI message, to temporarily discontinue the voice communications, after which the PMIC process  resumes passively monitoring (state ) the PBX . An analogous release-hold command B may be issued by the user from the PMIC to remove the hold and enable voice communication.","Prior to ending the call, the user may also transfer the call from the PBX phone to another device by issuing a transfer command to the PBX . Depending on the identifier-URI, phone number, or extension-the PBX  may transfer the call to the user's PMIC, the user's cell phone, or another PBX extension, for example. When transferred by command  to the user's PMIC, the PMIC process  transitions to the PMIC session setup (state ) in which the PMIC and PBX  exchange SIP INVITE and OK messages necessary to establish a VoIP session (state ) to replace the telephonic communication. While in the PMIC VoIP session (state ), the user acting through the PMIC GUI  can issue a PBX phone transfer command  to restore the telephonic communication (state ), issue a SIP BYE  message to end the call (state ), or issue an external-device transfer command  causing the PBX  to forward (state ) the call to any device specified by the user.","In addition to permitting an incoming call to be answered at the user's PBX phone, the call routing logic  may be configured to cause the PMIC in the call routing mode (state ) to automatically respond with one or more of the following actions: (1) transfer an incoming call to the PMIC session setup (state ), transfer or forward the call to an external device (state ), or (3) reply with a message to the caller's PMIC using an Instant Message. In the preferred embodiment, routing logic  is configured by the user to direct calls depending on the caller's identification, the time, and the date, for example.","The flow diagrams in  discussed below illustrate various aspects of the PMIC processing  of the preferred embodiment. These figures are provided by way of example and not limitation.","Illustrated in  is flow diagram depicting the method of distributing telephonic presence-state notices in the PBX system . Prior to configuring a user's PMIC to perform P-S notification, a user generally transmits a registration command to the PBX  to associate the user's PMIC with the user's phone extension. This causes the PBX  to transmit subsequent event messages pertaining to the user's PBX phone to the user's PMIC. The class of events transmitted by the PBX to a PMIC generally includes, but is not limited to: off-hook plus digits events, off-hook plus extension events, extension-dialed events, transfer events, incoming-call events, and answer events. In the following examples illustrated in  through , the first user PBX phone  is identified by extension number x1234, the first user PMIC  identified by URI 1234@proxy.com, the second user PBX phone  is identified by extension number x5678, and the second user PMIC  identified by URI 5678@proxy.com.","The registration command  causes the PBX  to send to the first user's PMIC various CTI events relating to the first user's phone . The registration command  may require that the first user  enter a user identifier and password, although other forms of authentication may be implemented. Similarly, the PBX  is able to associate CTI commands from this first user's  PMIC  with the phone  extension.","At some later point in time, when the first user  picks up the phone , an off-hook signal  is relayed by the PBX  to the first user PMIC  in the form of an off-hook event, preferably a CTI off-hook message . Receipt of the CTI event stimulates the PMIC  to automatically change the presence-state for the first user to \u201con-phone\u201d state. As prescribed by the on-phone presence-state processing , the PMIC  consults (method ) its subscriber table  and transmits a notify message ,  to all subscribers ,  by way of the associated PMICs , . The notify message is preferably a SIP on-phone message advertising the change in the first user's telephonic availability.","When the first user completes the call, the on-hook signal  from the first user phone  causes the PBX  to send the first user's PMIC  an on-hook event , preferably a CTI message. As prescribed by the off-phone present state processing , the PMIC  consults (method ) the subscriber table  and notifies all subscribers ,  of the change in the presence state by way of a SIP notify messages , . In the preferred embodiment, the presence state indicated by the SIP notify messages ,  is the presence state that existed just prior to the placement of the call. In an alternative embodiment, the presence state sent when the user goes off-phone may be \u201con-line\u201d notice. The selection between the two embodiments might be a user-manageable setting.","One skilled in the art will appreciate that the linkage between the PBX phone operation and the presence state is performed entirely within the associated PMIC endpoint itself. Moreover, the presence-state for the user is changed automatically based on receipt of a CTI event without the user manually changing his or her presence state via GUI interaction or other manual input. A principal advantage of this method of presence integration is that it can completely coexist and fully interoperate with all other presence servers, presence collection\/distribution servers, and any other SIP proxy servers that might be operational within the network . The proposed method is also highly scalable, since it each PMIC is only responsible for the presence management of its associated user PBX phone.","In some embodiments, the PBX  is both the source of CTI events and recipient of CTI commands. One skilled in the art will recognize, however, the a PBX may employ a separate and external CTI server (not shown) that provides fan-out capability, user authentication, and other CTI management tasks, as well as protocol translation between the PBX and the CTI client, for example.","Illustrated in  is a flow diagram demonstrating the use of a networked intermediate server with which the PBX and one or more PMICs may interoperate. The CTI server  is adapted to relay messages between the PBX  and one or more PMICs using CTI and\/or extensible Markup Language (XML) protocols between the CTI server  and the one or more PMICs , . The proxy server  relays CTI messages between the CTI server  and the PBX  using the CSTA CTI protocol, for example. Other protocol translations might also be possible including, but not limited to, HTTP using Get or Post messages via a dedicated IP socket, or SIP using textual information transmitted with SIP MESSAGEs sent between the CTI server  and a PMIC.","As illustrated in , a first user PMIC  transmits a registration command , preferably a CTI or XML message, to the CTI server . The registration command  comprises the extension number of the first user phone  and enables the CTI server  to create an association between the first user PBX phone  and the first user PMIC . When the first user phone  is used to place a call or answer a call, the PBX  relays the off-hook signal  to the CTI server  in the form of a CTI off-hook event . The server , in turn, forwards the CTI\/XML off-hook event  to the first user PMIC . Reception of CTI off-hook event  stimulates a change in first user's presence state that is propagated to any subscribers via an off-phone notification event , e.g., a SIP message. Similarly, an on-hook signal  is transmitted to the CTI server  in the form of a CTI on-hook event , then transmitted to the first user PMIC  in the form of CTI\/XML off-hook event . The first user identifies (step ) the presence state subscribers to be sent a SIP notify event . One skilled in the art will appreciate that the presence state management in the one or more PMICs of  is functionally equivalent to those in , independent of whether the event messages originating from the PBX  are sent directly to the PMICs or indirectly via the CTI server .","Illustrated in  is a flow diagram demonstrating the procedure for establishing a first category of CMS between calling parties. In this example, a CMS in the form of a SIP session is automatically initiated between a caller and recipient in the PBX system  in response to a telephone call. For purposes of demonstration, let the first user phone  have extension number x1234 and the second user phone  have extension number x5678. When the first user  depresses Dual Tone Multi Frequency (DTMF) keys on the PBX phone  to call the second user , an off-hook signal  comprising the call recipient's extension is transmitted to the PBX . In addition to the ring signal  transmitted (step ) to the second user's phone , the PBX  also generates (step ) an extension-dialed event  to the caller's computer, PMIC , as notice that a call has been placed to the extension number x5678. Similarly, the second user's PMIC  is notified via the incoming-call event  of the incoming call from extension x1234.","If the incoming call is answered with off-hook signal , the PBX  puts the first user phone  and second user phone  in telephonic voice communication . The CTI-enabled PBX  also responds to the off-hook signal  with a first call-answered event  transmitted (step ) to the second user's PMIC  as well as a second call-answered event  transmitted (step ) to the first user's PMIC .","In response to the first call-answered event , the second user's PMIC  automatically initiates (step ) a media session, preferably a SIP chat session, concurrent with the telephonic voice communication . The process of initiating (step ) the media session is set forth in greater detail in CMS setup  of . In this example, the media session is a SIP session including a simple SIP:MESSAGE message sent from second user's PMIC  to the first user's PMIC . In order to generate this SIP message , in the preferred embodiment, the second user's PMIC  derives the SIP URI of the first user's PMIC  in accordance with a SIP dial-plan. The dial-plan associates an extension, e.g., abcd, included in an event message with a SIP URI, e.g., SIP:abcd@someproxy.com. In this manner, the second user PMIC  extracts the extension number  from the incoming-call event  and generates a SIP MESSAGE transmitted to SIP: 1234@proxy.com. Other suitable dial-plans that allow the call recipient's PMIC to deduce the caller's URI from the calling extension are also possible. For example another dialing plan might associate extension 1234 with SIP:user91234@proxy.com where user 1234's PMIC has this SIP URI.","After the SIP exchange is completed with SIP OK , SIP text messaging windows are open on both first user's PMIC  and second user's PMIC , thereby allowing the first user  and second user  to text chat with one another concurrent with the voice communication . One skilled in the art will appreciate that there is no need for the first user  or second user  to appear on each other's contact lists, nor a need for either user to lookup an IP address or SIP URI. Instead, the SIP session is established automatically based on the PBX call.","Illustrated in  is a flow diagram demonstrating a second procedure for establishing a CMS between calling parties. In this example, the various signals, CTI event messages, and SIP messages in  are replicated from  beginning with the off-hook plus dialed number signal  through the SIP MESSAGE . Here, however, the presence of the SIP MESSAGE , and the corresponding SIP: OK, has established a line of communication between first user  and second user  that may be exploited to open additional forms of communication. After the SIP session signified by SIP MESSAGE  has been between established, either the first user  or the second user  may escalate the interaction to other forms of supplemental CMS using built-in capabilities of RTC, for example. In the preferred embodiment, either call participant may establish a supplemental CMS, e.g., a document exchange or a screen sharing session, that runs in parallel to the SIP:MESSAGE . The supplemental CMS  may be manually selected (step ) by a user via the user's PMIC GUI  or other form of selection input device.","Illustrated in  is a flow diagram demonstrating a third procedure for establishing a CMS between calling parties. Here, the various signals, CTI event messages, and SIP messages are replicated from  beginning with the off-hook plus dialed number signal  through the SIP MESSAGE . In this example, the first user  and second user  have desktop video cameras used by the CMS handler  of each user's PMIC ,  to automatically setup (step ) a supplemental CMS such as video session  with the primary CMS session . The call recipient's CMS handler  automatically issues an additional SIP INVITE containing video session description protocol (SDP) information. In the preferred embodiment, the video session is a user-manageable setting, thereby allowing a call recipient to configure the CMS handler  to: (1) automatically enable and start the camera for every call, (2) fully disable the camera to prevent the camera from starting, (3) manual enable the camera to start at the discretion of the user, or (4) selectively enable the camera to start depending on the caller identification, i.e., caller ID.","As illustrated in more detail below, the integration of a CTI client capability into a PMIC permits the user to execute standard telephone set control functions from the individual's computer. In the preferred embodiment, the PMIC is adapted to transmit PBX call control commands including, but not limited to, make-call commands to initiate a call, answer-call commands to accept an incoming call, hold-call commands to temporarily pause an on-going call at the PBX, transfer-call commands to redirect a call between the PBX phone and user PMIC or other device, conference-call commands to establish a call with three or more parties, and forward-call commands to direct a call to a device specified by the user.","Illustrated in  is a flow diagram demonstrating a PBX-supported call initiated from a PMIC. First, the user enters a destination telephone number into the user's PMIC GUI and activates a make-call routine in the PMIC controller. The PMIC issues a make-call command  that causes the PBX  to issue a ring signal  to the user's phone . After the handset is picked up and an off-hook signal  transmitted, the PBX  places the call to the destination number corresponding to second user phone , for example, via a ring signal . When the second user phone  is answered and an off-hook signal  transmitted, the parties are enabled for telephonic voice communications , . In another embodiment, the caller's PBX phone  automatically enters a hands-free speakerphone mode and the recipient called immediately after the destination number is entered at the PMIC .","Illustrated in  and  are flow diagrams demonstrating an on-going communications being transferred between a user PBX phone and the associated PMIC. In this embodiment, the PMIC is adapted to interoperate with a PBX  enabled with SIP or other VoIP protocol in addition to CTI client functionality. This PBX system, referred to as a SIP-PBX, has native SIP capabilities including the ability to make and receive SIP voice calls.","As illustrated in , an enterprise worker may transfer an on-going call on the PBX phone to the user's PMIC. At any time during a telephonic voice conversation ,  between the first user phone  and the second user phone , a user may transfer the call from to his or her PMIC  by issuing a PMIC transfer command , preferably a CTI message, comprising the identifier of the device to which to transfer the call. In the case of a PMIC  enabled with a SIP user agent, the transfer command  may include the SIP URI used by the PBX  to execute a call transfer to the PMIC SIP voice client. When the SIP INVITE  to 5678@proxy.com is accepted by the PMIC  by means of a SIP OK message , the PBX  bridges the first leg of the conversation  with the first user phone  in the PDSV domain with the second leg of the conversation  with the second user PMIC  in the SIP domain. In the preferred embodiment, the SIP URI is derived from extension number of the user phone with which it is associated.","As illustrated in , the second user  may at any time transfer the SIP domain call  directed to the second user PMIC  back to the second user PBX phone  A PBX phone transfer command , e.g. a CTI message, comprising the  second user's phone extension, number x5678, is issued by the second PMIC  to the PBX . Upon receipt, the PBX  terminates the SIP session with a SIP BYE message  and enables the PDSV voice communication  between the PBX  and the second user phone .","As illustrated in , a PMIC may also be used to answer an incoming call destined to a PBX phone independently of the user's PBX phone. In response to an incoming call , the PBX  in the preferred embodiment transmits a ring signal  an incoming-call event , e.g. a CTI message, to the call recipient's PMIC . The second user  may then click an answered button in the PMIC GUI causing it to issue an answer command  and transfer command . The transfer command  comprises the identification of the device to which the call is to be forwarded. The identification of the PMIC  is the SIP URI, SIP:5678@proxy.com. In response, the PBX  issues a SIP INVITE message , to which the PMIC  automatically responds with a SIP OK message . The subsequent conversation between the caller  and recipient  includes PDSV domain voice  between the caller  and SIP PBX , and SIP domain VoIP  between the SIP PBX  and recipient's PMIC .","Illustrated in  and  are flow diagrams demonstrating an incoming call to a PBX phone being automatically processes by an associated PMIC without user intervention. In , the PMIC answers an incoming call to a user's PBX phone and then forwards the call to another device previously specified by the user. In response to an incoming call , the PBX  in the preferred embodiment transmits ring signal  to the second user phone  and an incoming-call event  to the call recipient's PMIC . Upon receipt of the incoming-call event , the second user PMIC  implements call routing processing (state ) that dictates how this call is to be treated. If the call routing logic  of  indicates that the call should be transferred to another device, the second user PMIC  issues an answer-call command  preventing the PBX  from forwarding the call in accordance with its no-answer procedure, e.g. voice mail . The second user PMIC  also issues to the PBX  a call-transfer command  identifying the destination device to which the call is to be forwarded, e.g., device ABCD. The destination device may be another PBX extension, a PSTN telephone, or a SIP user agent.","The call routing logic  in the preferred embodiment comprises user-managed preferences include forwarding criteria and the action to be taken when the forwarding criteria are satisfied. These criteria may include the phone number or extension of the calling party and the time-of-day and date, for example. The call routing logic  may dictate that (1) on Wednesday evenings the call should be answered and transferred to PBX phone extension number x6789, on (2) Thursday evenings the call should be answered and transferred to John@acme.com, and (3) at all other times, the call is not answered by the PMIC, thereby allowing the PBX  to automatically forward to call voicemail  if not answered.","The call routing logic  in some embodiments may also depend on the presence state of its user. For example, if a user's presence state is set to \u201caway,\u201d determined either via manual operation or automatically in the absence of keyboard activity for a period of time, the call routing logic  may be configured to forward to an incoming call to the extension of an administrative assistance. Similarly, an incoming call might be directed to the SIP user agent of another enterprise colleague selected by the user, thereby providing an alternative point of contact while the user is unavailable or out of the office. In the preferred embodiment, the call routing logic  is in the form of a script created by the user, although it may also be configured via a graphical and or menu-based interface on the PMIC GUI .","The call routing logic  of a PMIC in some embodiments also includes the SIP text messaging and document transfer capabilities as part of the call treatment for incoming and outgoing calls at the PBX phone. Illustrated in  is a flow diagram demonstrating an instant message being transmitted by a PMIC in response to an incoming call. The PBX  responds to incoming call  with ring signal  and an incoming-call event , sent to the call recipient's PMIC . Upon receipt of the incoming-call event , the second user PMIC  implements call routing processing  that dictates how this call is to be treated. When configured accordingly, the second user's PMIC  transmits an instant message  from the user's PMIC to the caller's PMIC . The caller's SIP URI, SIP: 1234@proxy.com, is derived from the caller's extension, number x1234, learned by the second user's PMIC  from the preceding incoming call event .","The instant message may include a standardized greeting or a customized Instant Message including information specifically intended for the caller about. A person may, for example, generate a personal message including the anticipated return time or an alternate contact number. Similarly, the call routing logic  in some embodiments is adapted to transmit a document that may contain text, graphics, spreadsheet, or other information of interest to the caller in response to an incoming call directed to a specific PBX extension.","After the instant message , the incoming call may further processed in any number of ways defined by the call routing logic . In this example, the second PMIC  causes the PBX  to transfer the incoming call to device ABCD using transfer command .","In some embodiments, the caller's PMIC may also be configured to respond to the call recipient's instant message with another instant message sent to the call recipient's PMIC . For example, when the second user  receives a telephone call from extension number x, the call routing logic  generates the appropriate URI and sends an instant message to SIP:SecondUser@pda.com to inform the second user  that the first user phone , i.e., extension number x1234, had called. The call routing logic  may be tailored to inform a call recipient of the call and the time of the call.","The call routing logic  may also be configured to automatically send an instant message when an outbound call is placed from the PBX phone associated PMIC. A specific SIP emergency message, for example, may be sent to a pre-selected SIP user when the Emergency  number is dialed.","Illustrated in  is a functional block diagram of a user PMIC with a plurality of selectable SIP user agents. In addition to Microsoft's RTC SIP client  and a CTI client  discussed above, a PMIC  may further include one or more additional SIP instant messaging applications such as a SAMETIME client  by IBM Lotus Corp. and\/or any other commercial SIP User Agent Client The user may select one of the plurality of SIP client via PMIC GUI , for example, by entering a user-selectable parameter causing the SIP\/IM selection module  to use the selected SIP client for subsequent IM exchanges. To aid in the selection, the various features supported by each individual SIP client may be indicated as present or not present, or selectable and non-selectable. As with other GUIs, the features that are not present in a particular client may be indicated by representing the feature in greyed-out text or icon form. To the degree that two or more SIP clients support common functionality, in the preferred embodiment the user experience is identical and independent of the SIP client selected.","Illustrated in  is a CTI server with which the present invention may be made to interoperate with one of a plurality of different types of PBX systems. The CTI server  in this embodiment comprises a plurality of PBX interfaces from which the network administrator may choose. Using the PBX selection , for example, the system administrator may configure the CTI server  to use either PBX-A interface , PBX-B interface , or PBX-C interface , depending on the hardware and vendor requirements of the PBX . CTI server  capable of communicating with multiple types of PBXs using a single common CTI interface  protocol to\/from a CTI client are available from Genesys Telecommunications Laboratories, Inc. of San Fransisco, Calif., for example. In this manner, the PMIC is generally able to provide the functionality of the several embodiments in a manner independent of the type PBX system or vendor.","Although the description above contains many specifications, these should not be construed as limiting the scope of the invention but as merely providing illustrations of some of the presently preferred embodiments of this invention.","Therefore, the invention has been disclosed by way of example and not limitation, and reference should be made to the following claims to determine the scope of the present invention."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The present invention is illustrated by way of example and not limitation in the figures of the accompanying drawings, and in which:",{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 2A"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 2B"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 4A"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 4B"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIGS. 5A and 5B"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 12A"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 12B"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 15"},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 16A"},{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 16B"},{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 16C"},{"@attributes":{"id":"p-0034","num":"0033"},"figref":"FIG. 17"},{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 18A"},{"@attributes":{"id":"p-0036","num":"0035"},"figref":"FIG. 18B"},{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 19"},{"@attributes":{"id":"p-0038","num":"0037"},"figref":"FIG. 20A"},{"@attributes":{"id":"p-0039","num":"0038"},"figref":"FIG. 20B"},{"@attributes":{"id":"p-0040","num":"0039"},"figref":"FIG. 21"},{"@attributes":{"id":"p-0041","num":"0040"},"figref":"FIG. 22"}]},"DETDESC":[{},{}]}
