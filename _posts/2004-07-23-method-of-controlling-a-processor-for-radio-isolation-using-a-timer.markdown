---
title: Method of controlling a processor for radio isolation using a timer
abstract: A method of operating a radio-frequency (RF) circuitry and a signal-processing circuitry in a mobile telephone apparatus includes at least partially disabling the signal-processing circuitry while transmitting or receiving signals. In one example, a processor is efficiently disabled by generating and servicing an interrupt of relatively high priority. One advantage of this example is that preexisting, legacy code can be maintained, while still achieving the desired objectives. The processor can be enabled by generating and servicing a second high priority interrupt.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07761056&OS=07761056&RS=07761056
owner: ST-Ericsson SA
number: 07761056
owner_city: Geneva
owner_country: CH
publication_date: 20040723
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION"],"p":["This patent application relates to, and incorporates by reference, the following U.S. patent applications, which are each incorporated by reference herein: Ser. No. 10\/898,058, titled \u201cAPPARATUS USING INTERRUPTS FOR CONTROLLING A PROCESSOR FOR RADIO ISOLATION AND ASSOCIATED METHODS\u201d, filed on Jul. 23, 2004; Ser. No. 10\/898,057, titled \u201cAPPARATUS USING INTERRUPTS FOR CONTROLLING A PROCESSOR FOR RADIO ISOLATION AND ASSOCIATED METHODS\u201d, filed on Jul. 23, 2004.","This patent document relates generally to real-time systems and, more particularly, to systems and methods for controlling real-time systems, such as a highly integrated RF system.","In various types of circuits, interference can cause problems with the operation of the circuits. These types of problems may be especially evident in highly integrated systems, where the operation of one portion of a device can interfere with the operation another portion of the device. For example, in a circuit containing both RF circuitry and digital circuitry, interference between the RF and digital circuitry can cause significant disturbance to the RF circuits, making the implementation on an integrated circuit very difficult.","In a typical prior art RF receiver, transmitter, or transceiver, RF circuitry generally resides in a different circuit partition (e.g., integrated circuit (IC), die, etc.) than does signal-processing circuitry (e.g., baseband), partly due to the problem of interference. RF circuitry typically includes analog circuitry that has a relatively high sensitivity to noise and interference. Furthermore, the RF circuitry in some applications, for example, in a mobile telephone apparatus, may have to detect signals as small as a few nano-volts in amplitude. The performance of a device may suffer as a result of noise and interference from sources external or even internal to the communication apparatus.","In a typical communication apparatus, such as a mobile telephone apparatus, digital circuitry produces digital signals with relatively small rise and fall times, or with fast transitions or sharp edges. Furthermore, those signals often have relatively high frequencies. As a result, these high frequency signals, and their harmonics, can interfere with, and adversely impact the performance of, the RF circuitry. As a result, typical prior art communication devices use more than one circuit partition. For example, one partition may include the RF circuitry, while a second partition includes the digital circuitry.","Using more than one partition for RF circuitry and the digital circuitry, however, has several disadvantages, such as increased component count, size, and overall cost, and more potential for decreased reliability and increased manufacturing failures. Therefore, a need exists for highly integrated devices having all circuitry in one partition. For example, in the field of RF communication devices, there is a need for a highly integrated RF apparatus that includes a complete radio in one partition, die, IC, etc.","This invention contemplates methods relating to highly integrated RF apparatus. In one embodiment, a method according to the invention of controlling a mobile telephone apparatus, includes between bursts, using a processor to process signals received during a previous burst and to prepare signals for the next burst, using a timer to determine when a burst begins, and at least partially disabling the processor to minimize noise in the apparatus during the burst.","In another embodiment, a method of minimizing interference between a transceiver formed on an integrated circuit and digital circuitry formed on the same integrated circuit includes operating the digital circuitry in a first mode of operation when the transceiver is not transmitting or receiving signals, operating the digital circuitry in a second mode when the transceiver is transmitting or receiving signals, and using a timer to determine the timing of the transition from the first mode the second mode.","In another embodiment, a method of controlling a mobile telephone apparatus having a processor and a transceiver includes using the processor to process information in preparation for transmission or reception of RF signals, using a timer to determine the timing of the transmission or reception of RF signals, before the transmission or reception of RF signals, disabling at least a portion of the processor to reduce interference between the processor and the transceiver, activating the transceiver to facilitate the transmission or reception of RF signals, deactivating the transceiver after the transmission or reception of RF signals, and enabling the processor after the transceiver is deactivated.","Other features and advantages of the present invention will be apparent from the accompanying drawings and from the detailed description that follows below.","This invention relates to highly integrated RF and digital systems. In one application of the invention, the concepts described below obviate the need for partitioning RF circuitry and digital circuitry (e.g., signal-processing circuitry), as well as address challenges relating to such integration. In one exemplary embodiment of the present invention, in a communication system, RF circuitry and signal-processing circuitry (e.g., digital signal processor (DSP), microprocessor, microcontroller, general-purpose logic circuitry, and the like) may reside in the same circuit partition. Of course, the present invention may be used with any other desired system or device.","Generally, in one example, one aspect of the present invention relates to time-domain isolation of different parts of an apparatus (e.g., isolating RF circuitry from digital circuitry in time). In an example of a communication system having signal processing circuitry and RF circuitry, the RF circuitry generally operates when the signal-processing circuitry is inactive, and vice-versa. Note, however, that the operation of the RF circuitry and the signal-processing circuitry may overlap by some amount. As a consequence, the digital switching noise and associated harmonic content do not interfere with the performance of the RF circuitry, and vice-versa. Another aspect of the present invention relates to techniques for efficiently stopping and starting signal processing circuitry to achieve the time-domain isolation mentioned above.","In order to provide a context for understanding this description, the following description illustrates one example of an environment in which the present invention may be used. Of course, the invention may also be used in many other types of environments (e.g., a real-time operating system based system). Techniques of the present invention maybe used for any desired applications, including a wireless transmission system such as mobile or cellular communication devices or other wireless devices.","Examples of systems where the present invention may be used include but are not limited to, Global System for Mobile communications (GSM), General Packet Radio Service (CPRS), Enhanced Data rates of GSM Evolution (EDGE), Time Division Multiple Access (TDMA), Personal Communications Service (PCS), Personal Communications System (PCS), or any similarly configured communication system.",{"@attributes":{"id":"p-0027","num":"0026"},"figref":["FIG. 1","FIG. 1","FIG. 1"],"b":["10","10","10","12","14","16","14","10","16","18","20","12","18","20","22","22","16","20"]},{"@attributes":{"id":"p-0028","num":"0027"},"figref":["FIG. 2","FIG. 2"]},"Referring to , communication systems or apparatus according to exemplary embodiments of the invention use a plurality of RF time-slots A, B, C, and so on. Such systems or apparatus also employ a plurality of signal-processing time-slots A, B, and so on. Generally, during RF time-slots A-C, the system or apparatus (e.g., the RF front-end circuitry  shown in ) may receive RF signals or transmit RF signals, process the received signals, and perform any other desired manipulation of the data. Subsequently, during signal-processing time-slots A-B, the system or apparatus (e.g., the baseband ) may perform signal-processing tasks.","Alternatively, during RF time-slots A-C, the system or apparatus may transmit RF signals. In this mode of operation, during signal-processing time-slots A-B, the system or apparatus (e.g., the baseband ) performs signal-processing tasks (e.g., voice, data) and performs any other desired manipulation of the data. Subsequently, during RF time-slots A-C, the system or apparatus (e.g., the RF front-end circuitry ) may process transmit signals and perform RF operations (for example, up-conversion) and transmit an RF signal.","Note that the signal-processing tasks performed during signal-processing time-slots A-B constitute various signal-processing functions in an RF communication apparatus. Examples of such tasks include modulation, coding, decoding, and the like. Also note that depending on the specific protocol, architecture, and circuitry used, the system or apparatus may receive and transmit simultaneously, as desired. Typically, though, the system either transmits signals or receives signals during any of the RF time-slots, or in bursts. For example, a GSM-compliant system or apparatus, such as a mobile telephone, either receives or transmits RF signals in one or more bursts of activity during RF time-slots. Note that the RF and signal processing time-slots can overlap or otherwise vary from that shown in . Also, the positions of the RF or signal processing time-slots in a GSM frame may change over time.","Note that the RF time-slots A-C shown in  may have the same or different durations, as desired. Generally, the RF time-slots A-C may have unequal lengths so as to accommodate a wide variety of circuitry, systems, protocols, and specifications, as desired. Each of the RF time-slots A-C may include several other time-slots or a frame, depending on the particular communication protocol or technique used. For example, in a GSM application, each RF period may include a GSM slot, multiple slots, or multiple frames used to transmit, receive, or monitor.","Similarly, the signal-processing time-slots A-B shown in  may have similar or dissimilar durations, as desired. Generally, the signal-processing time-slots may have unequal lengths so as to accommodate a broad array of signal-processing apparatus, circuitry, algorithms, and processing techniques. Each of signal-processing time-slots A-B may include several other time-slots or time divisions, depending on the particular communication protocol and\/or signal-processing techniques and the particular circuitry and technology used. For example, a signal-processing time-slot may include several time-slots, with a portion of a particular circuitry active or processing signals during one or more of the time-slots.","Furthermore, the signal-processing tasks may be performed in a serial or multiplexed manner (e.g., by sharing hardware to perform a variety of tasks), in a parallel manner (e.g., by using dedicated hardware for each signal-processing task), or in a combination of the two techniques, as desired. The choice of signal-processing hardware, firmware, and software depends on the design and performance specifications for a given desired implementation, as persons of ordinary skill in the art who have the benefit of the description of the invention understand.","To accomplish the isolation illustrated in , the RF circuitry and the signal-processing circuitry can be activated and deactivated, in correspondence with transitions from one time-slot to another. The activation and deactivation may be accomplished in a variety of ways. As mentioned above, another aspect of the present invention relates to techniques for efficiently stopping and starting processors and other circuitry.","Efficiently starting and stopping a general purpose processor and\/or a digital signal processor presents several challenges. It is desirable to safely stop a processor with minimum latency, so that a maximum amount of time can be allocated for processing tasks while the radio (or other RF circuitry) is not in use. Simply stopping a clock to a processor may leave the processor (as well as the processor bus, memories, or peripheral devices) in an invalid state, or a state which may not be capable of returning to normal operations. By carefully implementing a stopping procedure (e.g., the procedures described below), the buses are well suited for data movement. In addition, with an efficient stopping procedure, time spent before the radio use can be used more effectively, where tasks required in preparation for radio use can occur as close to the start of the radio use as possible. In one example, the state of the processors while the radio is used is maintained, but can also be transitioned quickly back to normal operation after use of the radio. An efficient processor restarting procedure will minimize the time that the processor will spend restarting, allowing more time for processing other tasks.","When implementing stopping and starting procedures, there are several considerations that can be taken into consideration. Again, as described above, in order to maintain the best possible RF performance, noise associated with digital logic switching should be controlled during critical times (e.g., when a radio is transmitting or receiving). One method to control the digital switching noise is to stop all of the switching, or at least minimize it. Ideally, the stopping and starting techniques should be safe for the overall system, such that the states of the processor pipelines are not impacted by spurious clocks, for example. It is also desirable to stop the processor at a specific time, since use of the radio is dictated by a prescribed schedule. It is desirable to stop the processor as quickly as possible in order to maximize the amount of time that the processor is available to process tasks.","While the techniques of the present invention for efficiently stopping and starting one or more processors can be implemented in a number of ways, following is a description of techniques for stopping and starting a processor that is controlled using an interrupt architecture. Generally, an interrupt is a signal received by a processor that causes a temporary halt in the execution of a program while some other task is performed. After the task is performed, control returns to the original program. If multiple interrupts are received, the interrupts are serviced based on a priority system, where the highest priority interrupts are serviced first. It is common for a real time system (e.g., a mobile telephone, etc.) to utilize interrupts to control the operation of the system. Such a system may include a processor, an interrupt handler program, an interrupt controller, and a sequencer, or interrupt generator.",{"@attributes":{"id":"p-0039","num":"0038"},"figref":["FIG. 3","FIG. 1","FIG. 3","FIG. 3"],"b":["40","40","42","14","42","44","46","48","44","46","42","42","48","50","52","50","54","42","56","54","50","58","56","50","60","62","54","50","64","66"]},"Examples of peripheral devices include, but are not limited to, a Universal Asynchronous receiver\/transmitter (UART), a Subscriber Identity Module (SIM) card interface, a Direct Memory Access (DMA) controller, external interrupt sources, etc.","In the embodiment shown in , interrupts can be generated by the system timer , peripheral devices  and , as well as other devices that may not be shown in . When one or more interrupts are received by the interrupt controller , the interrupt controller  determines what processing path to take next, at least partly depending on the relative priorities of received interrupts. The interrupt controller  then sends control signals the interrupt logic  of the MCU  via line .","Generally, the present invention efficiently stops and starts a processor by (1) providing a way to trigger a transition; and (2) providing procedures to efficiently stop and start the processor. In one example, a transition is triggered by generating and servicing an interrupt of relatively high priority (described in more detail below). One advantage of using this triggering technique, is that preexisting, legacy code can be maintained, while still achieving the desired objectives. Upon receiving the interrupt of relatively high priority, the processor is stopped or started such that the processor can operate in a normal, processing mode, and in a low noise, low power, sleep-like state mode (described in more detail below).","In one example, the present invention configures a first interrupt of relatively high priority that will be generated when the processor is to be stopped (i.e., immediately before radio use). A second interrupt of relatively high priority is configured which will be generated when the processor is to be restarted (i.e., immediately after radio use).  is a diagram illustrating a typical legacy interrupt map.  lists N interrupts (labeled 1 through N), sorted by priority, where interrupt 1 has the highest priority, and interrupt N has the lowest priority. The priorities of the interrupts are labeled 0 through N\u22121, where the lowest numbers correspond to the highest priorities.","As mentioned above, the present invention can be implemented without disturbing preexisting legacy code (i.e., code corresponding to the N interrupts illustrated in ).  is a diagram illustrating an interrupt map, including two new interrupts used to trigger the stopping and starting of the processor. Like ,  lists the N legacy interrupts (labeled 1 through N). Two new interrupts (N+1 and N+2) are also shown. The new interrupts (N+1 and N+2) are re-mapped such that they have the highest priorities. In this example, interrupt N+1 has a priority of \u22121, which is higher than all of the normal, legacy interrupts. Interrupt N+1 can also be thought of as the \u201c\u22121 interrupt\u201d. In one example, interrupt N+1 triggers a shut down interrupt routine (described below) and is generated prior to radio use. Interrupt N+2 has a priority of \u22122, which is higher than all of the normal, legacy interrupts, as well as interrupt N+1. Interrupt N+2 can be thought of as the \u201c\u22122 interrupt\u201d. In one example, interrupt N+2 triggers a restart interrupt routine (described below) and is generated after radio use. Note that the terms \u201c\u22121 interrupt\u201d and \u201c\u22122 interrupt\u201d are merely just convenient names given to the interrupts and that other nomenclature can be used, as desired. Generally, the two new interrupts are configured to have a higher priority than all of the legacy interrupts.","As mentioned, the present invention may use any desired procedures for starting and stopping a processor.  is a flowchart illustrating the operation of the present invention. The process begins with step -, where one or more interrupts are generated and received by the interrupt controller. Generally, as interrupts are received, the interrupt controller will make a decision as to the next processing step that the processor will take. If multiple interrupts are received, the interrupt with the highest priority will be serviced first. At step -, the process determines whether a shut down interrupt (e.g., the \u22121 interrupt described above) was received. If not (i.e., a normal, legacy interrupt was received), the process proceeds to step -, where the new interrupt is processed. In the case where a previously received higher priority interrupt has not yet been completed, this processing is continued. The process the goes back to step -. Note that, between received interrupts, the processor is performing general processing tasks. If, at step -, it was determined that a shut down interrupt (\u22121 interrupt) was received (i.e., usage of RF circuitry is about to start), then the process proceeds to step -, where the shut down interrupt service routine is processed.",{"@attributes":{"id":"p-0046","num":"0045"},"figref":["FIG. 7","FIG. 7"],"b":["6","16","6","20"]},{"@attributes":{"id":"p-0047","num":"0046"},"figref":["FIG. 8","FIG. 6"],"b":["6","10"]},{"@attributes":{"id":"p-0048","num":"0047"},"figref":["FIG. 7","FIG. 4"],"b":["7","10","7","12"]},"Next, at step -, any unneeded buses may be idled. Similarly, the ability to access memory (e.g., RAM) is limited to the processor. In addition, if desired, any peripheral devices that are not designed to operate during use of the radio can be isolated from the processor. Isolating peripheral devices from the processor can be achieved in response to the shut down interrupt, or can be achieved separately from the process outlined in . Examples of techniques for idling a bus and isolating peripheral devices are described in U.S. patent application Ser. No. 10\/814,426, filed on Mar. 3, 2004, titled \u201cCOMMUNICATION APPARATUS IMPLEMENTING TIME DOMAIN ISOLATION WITH RESTRICTED BUS ACCESS\u201d, which is incorporated by reference herein.","At step -, the processor finishes any required processing needed to prepare for radio use. Next, at step -, the processor is instructed to wait for an interrupt. The wait for interrupt instruction is a general instruction that causes the processor to essentially stall until such time as an interrupt is received by the processor. Since no lower priority interrupt can be generated, the normal operations of the processor are stopped. In another example, the processor can be stalled by instructing the processor to wait for a bit to be set. The combination of these tasks results in a quiet processor environment.","Since there are no further operations on the processor, the processor clock can be disabled (step -) without the need to precisely coordinate the clock stop time between the processor, the processor's bus, memories, and peripherals. This essentially decouples the clock stopping and starting from the processor stopping and starting. There are numerous ways of disabling a clock signal. In one example, a clock signal can be disabled by gating a clock source. In another example, a clock signal can be disabled by removing the assertion of a clock enable from state holding elements. Note that the steps outlined in  may be performed in a different order, as desired. Also, not all of the steps are required, depending on the system, noise requirements, etc. Similarly, other steps could also be included in the process.","In another example, a processor can be disabled by simply stopping the processor clock, and hoping that all is well when the clock signal returns. This method would seem to be less reliable than the method illustrated in . In another example it is possible that the code is in the correct function to stop the processor at precisely the right time to stop the processor in the same manner described, through the use of the wait for interrupt instruction. In this example, the method relies on the tasks executed on the processor to be synchronized to the network timebase. While this method would work, a new software protocol may be required for implementation. If the use of a simple clock stop is attempted, it would be possible to have synchronization of all clock domains to ensure that no domain received additional clocks relative to the others.",{"@attributes":{"id":"p-0053","num":"0052"},"figref":["FIG. 8","FIG. 8"],"b":["8","10","8","12","8","14","8","16","8","18","8","20"]},"Referring more specifically to the example of a GSM application,  shows an example of a GSM data frame  and the relative timing of the shut down and restart interrupts. Frame  includes 8 slots, which may correspond to bursts of data. In one example, for GSM speech, slot  represents a receive slot, slot  is a monitor slot, and slot  constitutes a transmit slot. The remaining slots are unused for RF activity. Of course, the transmit, receive, and monitor slots could also be in different positions. In addition, it is possible to have multiple transmit or receive slots in the same frame. In the GSM frame example, and referring to the discussion of  above, the GSM slots , , and  are RF time-slots, with the remaining slots, in the context of this example, being signal-processing time-slots. For each of the RF time-slots,  also shows the relative timing of the \u22121 and \u22122 interrupts (a more detailed view of the relative timing of the \u22121 and \u22122 interrupts is shown in ). As shown, the \u22121 interrupt is generated slightly before the beginning of each RF time-slot, due to the time required to process the shut down interrupt service routine (see ). Similarly, the \u22122 interrupt is generated after the end of each RF time-slot to restart the processor. The precise timing of the interrupts can vary, as desired.",{"@attributes":{"id":"p-0055","num":"0054"},"figref":["FIG. 10","FIG. 10","FIG. 10","FIG. 7","FIG. 8","FIG. 10"],"b":["7","18","8","10"]},"From the preceding description it is apparent that the present invention can be implemented in many ways to provide various advantages. One novel advantage of the present invention is that the invention provides a processor able to minimize noise created by digital circuitry. Another advantage of the present invention is the provision of the ability to quickly transition from high performance processing to low noise modes and back, with a minimum amount of overhead. In addition, the low noise modes cannot be accidentally exited, although it could be exited earlier than originally expected.","In the preceding detailed description, the invention is described with reference to specific exemplary embodiments thereof. Various modifications and changes may be made thereto without departing from the broader spirit and scope of the invention as set forth in the claims. The specification and drawings are, accordingly, to be regarded in an illustrative rather than a restrictive sense."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The present invention is illustrated by way of example and not limitation in the figures of the accompanying drawings, in which like references indicate similar elements and in which:",{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 10"}]},"DETDESC":[{},{}]}
