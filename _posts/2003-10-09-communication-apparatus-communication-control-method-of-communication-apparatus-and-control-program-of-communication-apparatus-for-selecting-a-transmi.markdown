---
title: Communication apparatus, communication control method of communication apparatus, and control program of communication apparatus for selecting a transmission path for image data
abstract: In a communication apparatus corresponding to an analog communication path of a voice band and a network communication path, high-speed and high-reliability data communication are performed by selecting an appropriate communication path without troublesome user operation. A communication apparatus which performs IP communication and analog communication via an ADSL gateway obtains the IP address of a destination station from an SIP proxy server and transmits/receives communication data to/from the destination station on an IP network by a file transmit/receive protocol such as FTP, HTTP or the like, when the telephone number of the destination station corresponds to a VoIP network. The apparatus performs analog facsimile communication on a line switching network when the telephone number of the destination station does not correspond to the VoIP network. The apparatus performs the analog facsimile communication on the VoIP network or the line switching network when the destination station corresponds to the VoIP network but does not have any digital communication means.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08037138&OS=08037138&RS=08037138
owner: Canon Kabushiki Kaisha
number: 08037138
owner_city: Tokyo
owner_country: JP
publication_date: 20031009
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["TECHNICAL FILED","BACKGROUND ART","SUMMARY OF THE INVENTION","BEST MODE FOR CARRYING OUT THE INVENTION","Embodiment 1","Embodiment 2"],"p":["The present invention relates to a communication apparatus which includes an IP (Internet Protocol) communication means and transmits\/receives communication data to\/from a destination station discriminated by a telephone number, a control method of the communication apparatus, and a control program for the communication apparatus.","In recent years, a broadband communication line such as an ADSL (Asymmetric Digital Subscriber Line) which can perform high-speed data transmission is in widespread use. The ADSL is characterized in that a metallic cable same as a telephone line is used as a fine for a subscriber, whereby the identical line can be used for both an analog telephone service and a network connection service. That is, by inserting a frequency division filter called a splitter between the communication line and a communication terminal equipment, the line for transmitting a voice band signal can be separated from the line for transmitting digital data.","When the same line is used for the analog telephone service, various structures such as \u201cADSL modem+splitter+computer\u201d, \u201cADSL modem+splitter+router\u201d and the like can be considered as the structure of subscriber's equipments. On one hand, for example, the structure that the ADSL modem and the splitter are unified can be considered as an ADSL gateway which is used in consideration of common use with the telephone service.","In the ADSL gateway like this, for example, a modular jack is provided so that an analog telephone can be connected to the line which is used to transmit the voice band signal, whereby communication can be performed by connecting a communication apparatus such as the telephone or a facsimile machine to the modular jack.","Moreover, a CSMA\/CD (Carrier Sense Multiple Access with Collision Detector) connection interface such as Ethernet\u2122 is provided in the ADSL gateway so as to achieve high-speed digital communication. Thus, by connecting a PC (personal computer) or the like to the CSMA\/CD interface, data can be downloaded at high speed from a WWW server or the like. However, as the interface between the ADSL gateway and network equipments such as the PC and the like, an interface such as a USB (Universal Serial Bus) or the like is used in addition to the CSMA\/CD interface.","The terminal equipment such as the PC which is used by connecting it to the server can achieve high-speed communication, and on one hand the terminal equipment such as the telephone or the facsimile device which performs transmit\/receive with a destination terminal equipment in real time via a line switching network (analog communication path) uses an analog band. In an analog facsimile procedure, although any problem does not likely occur when merely black-and-white binary image data or so is transmitted, a problem that it takes a long time occurs when color image data of a large amount (according to a JPEG (Joint Photographic Experts Group) format or the like) taken by a digital camera or the like is transmitted,","In order to transmit communication data such as the image data or the like at high speed, the facsimile machine is connected to the CSMA\/CD interface, the image data is uploaded to a file server in the form of packet (e.g., using a protocol such as FTP (File Transfer Protocol), HTTP (HyperText Transport Protocol) or the like), and the uploaded image data is then downloaded from the server by the destination terminal equipment. However, in this case, there occur problems that it is necessary for the receiving side to take the trouble to access the file server to receive the data and that an advantage of real-time communication is lost. Besides, when the destination address of the receiving side is notified to the server and when the data is downloaded on the initiative of the receiving side, a mechanism to notify the receiving side of the data having been uploaded is necessary. For this reason, it is difficult to achieve the communication by a simple operation of merely designating a telephone number of a communication destination as in the conventional facsimile machine.","In consideration of this point, Japanese Patent Application Laid-Open No. H10-107938 (called document 1 hereinafter) discloses the technique to perform image communication via a server on an IP network. That is, in the document 1, a first terminal equipment on an image transmitting side calls the server including the first terminal equipment, connects with the computer network via the server including the first terminal equipment, and further designates a second terminal equipment being the receiving side of the image communication. Then, a server of the network including the second terminal equipment calls the second terminal equipment, the first terminal equipment sends the image data to the server including the second terminal equipment via the computer network in a form suitable for this network, and the server including the second terminal equipment converts the received image data of the form suitable for the computer network into facsimile image data and further sends the converted image data to the second terminal equipment via a public network, whereby the second terminal equipment reproduces an image from the received facsimile image data.","Further, Japanese Patent Application Laid-Open No. H9-247334 (called document 2 hereinafter), Japanese Patent Application Laid-Open No. H10-133967 (called document 3 hereinafter) and the like propose many kinds of methods of transmitting an image in the form of electronic mail by inputting an Internet address of a communication destination.","Furthermore, Japanese Patent Application Laid-Open No. 2000-354127 (called document 4 hereinafter), Japanese Patent Application Laid-Open No. 2001-197279 (called document 5 hereinafter) and the like propose a method of relaying facsimile image transmission in real time on the Internet by applying ITU-T (International Telecommunication Union Telecommunication Standardization Sector) Recommendation T.38.","(Document 1)",{"@attributes":{"id":"p-0012","num":"0000"},"ul":{"@attributes":{"id":"ul0001","list-style":"none"},"li":["Japanese Patent Application Laid-Open No. H10-107938\n\n(Document 2)\n","Japanese Patent Application Laid-Open No. H9-247334\n\n(Document 3)\n","Japanese Patent Application Laid-Open No. H10-133967\n\n(Document 4)\n","Japanese Patent Application Laid-Open No. 2000-354127\n\n(Document 5)\n","Japanese Patent Application Laid-Open No. 2001-197279"]}},"However, in the document 1, it is necessary in the terminal equipment on the transmitting side to perform dial-up connection with the server, perform a log-in process including an authentication procedure and the like, and then input a terminal equipment number of the transmission destination. Therefore, it is impossible to perform the image transmission only by inputting the telephone number as in the conventional facsimile machine.","Further, in the documents 2 and 3, it is necessary to input a mail address when the image data is transmitted via the Internet. Besides, since the image is transmitted as the electronic mail, the image data are accumulated in a server, whereby a problem that it is necessary for the receiving side to receive the image data by accessing the server according to an electronic mail reading protocol such as POP (Post Office Protocol) or the like occurs.","Furthermore, in the documents 4 and 5, it is necessary to provide a gateway dedicated for processing the protocol of ITU-T Recommendation T.38. Besides, since an ordinary telephone line is used between the terminal equipment and the Internet, transmission speed is the same as that in case of facsimile transmission utilizing a conventional telephone switching network.","Besides, the conventional communication technique has been developed independently in regard to each of a facsimile field, an IP communication field and the like, whereby there is a problem that the respective technical fields are not yet integrated adequately. For example, a user is required to be familiar independently with each of an operation specific in the facsimile machine and operations on the PC specific in various IP communication. Further, as seen from the view of manufacturing corporations which provide hardware\/software, it is necessary to provide completely different software\/hardware in regard to each of the facsimile field, the IP communication field and the like, although data communication in each technical field is not so different essentially. Within this meaning, it is desired to, by favorably integrating the necessary technical parts of the respective fields such as the facsimile field, the IP communication field and the like, enable the data communication which can be easily operated, is excellent in versatility, and can be easily applied inexpensively.","An object of the present invention is to solve the above conventional problems, and to be able to perform high-speed and high-reliability data communication by selecting an appropriate communication path without troublesome user operation in a communication apparatus corresponding to an analog communication path of a voice band and a network communication path.","To achieve the foregoing objects, in one embodiment, the invention provides a communication apparatus which includes IP (Internet Protocol) communication means and transmits\/receives communication data to\/from a destination station discriminated by a telephone number. The communication apparatus has an IP address obtaining means for obtaining an IP address of the destination station from an SIP (Session Initiation Protocol) proxy server based on the telephone number of the destination station, and a facsimile communication means for performing facsimile communication on a line switching network. A converting means converts a signal that the facsimile communication means transmits\/receives into data on an IP network, and an IP network connecting means connects to the IP network. A control means controls to, if it is able to transmit\/receive communication data on the IP network based on a predetermined file transmit\/receive protocol, start to transmit\/receive image data to\/from the destination station based on the predetermined file transmit\/receive protocol, via the IP network connecting means, using the obtained IP address of the destination station, in response to the acquirement of the IP address by said IP address obtaining means. But, if it is not able to transmit\/receive communication data on the IP network based on the predetermined file transmit\/receive protocol, the control means causes the facsimile communication means to start transmission\/reception of image data to\/from the destination station based on a predetermined file transmit\/receive protocol, in response to the acquirement of the IP address of the destination station by the IP address obtaining means, and causes the converting means to execute conversion of the signal that the facsimile communication means transmits\/receives and transmit\/receive thus converted signal to\/from the destination station via the IP network connecting means.","Hereinafter, the embodiment of the present invention will be explained in detail with reference to the attached drawings. In the following, an image communication apparatus will be shown as an example of a communication apparatus.",{"@attributes":{"id":"p-0036","num":"0039"},"figref":["FIG. 1","FIG. 1"],"b":["101","102","103","104","105","106","107","108","109","111","110","112","113","105","107","113"]},"Although the details of the structures of the ADSL gateways  and  will be later explained in detail. The contract of the subscriber regarding these gateways is a common type contract including a telephone service and an IP communication service. Thus, the analog telephone interface  and the CSMA\/CD interface  acting as the network interface are provided between the image communication apparatus  and the ADSL gateway , and similarly the analog telephone interface  and the CSMA\/CD interface  acting as the network interface are provided between the image communication apparatus  and the ADSL gateway  (however, the network interface is not limited to the CSMA\/CD interface).","The analog telephone interface  and the CSMA\/CD interface  provided between the image communication apparatus  and the ADSL gateway , and the analog telephone interface  and the CSMA\/CD interface  provided between the image communication apparatus  and the ADSL gateway , can be respectively utilized for the communication.","More specifically, the analog telephone interfaces  and  can be utilized for telephone call and analog facsimile communication based on ITU-T Recommendation T.30 (hereinafter, simply called \u201cRecommendation T.30\u201d or \u201cT.30\u201d as long as there is no confusion).","For example, a predetermined protocol such as PPPoE (Point-to-Point Protocol over Ethernet\u2122) or the like is used on the path of the CSMA\/CD interfaces  and , whereby the connection with ISP (Internet Service Provider) is established, and the global IP address on the side of WAN (wide area network) and the private IP address on the side of LAN (local area network) are determined as described above. In such a condition, the image communication apparatuses  and  can utilize arbitrary services (e.g., services on TCP(UDP)\/IP (Transmission Control Protocol (User Datagram Protocol)\/Internet Protocol) such as FTP (File Transfer Protocol), HTTP (HyperText Transport Protocol) or the like, VoIP and the like) on the IP network .","In the present invention, the image communication apparatuses (e.g.,  and  in ) are connected to perform the communication by partially utilizing the VoIP protocol (ITU-T Recommendation H.323) and SIP (RFC (Request For Comment) 2543) on the IP network , thereby enabling to perform high-speed communication. By the way, the details of VoIP and SIP will be described later.",{"@attributes":{"id":"p-0042","num":"0045"},"figref":["FIG. 2","FIG. 1","FIG. 2"],"b":["105","107","201","202","201","201","203"]},"Numeral  denotes a key operation unit which consists of dials and operation buttons for facsimile transmission\/reception, and numeral  denotes an LCD (liquid crystal display) unit.","Numeral  denotes a CIS (contact image sensor) which converts an original image into an analog signal, and numeral  denotes a read control unit which converts the analog signal output from the CIS  into digital data. The converted digital data is then transferred to the RAM  under the control of the CPU .","Numeral  denotes an MH (Modified Huffman) processing unit (MH coding and decoding processing unit) which performs data compression by performing MH coding to the read image data when the image data is transmitted, and decodes the MH coded image data when the image data is received.","Numeral  denotes an FMDM (facsimile modem) which modulates the MH coded data and converts into the analog signal of a voice band capable of being transferred on an analog line when the image data is transmitted. When the image data is received, the FMDM  demodulates the received analog signal and then outputs the MH coded data.","Numeral  denotes an NCU (network control unit) which includes an interface function for an analog communication line.","Numeral  denotes a card I\/F (interface) to which a memory card storing a JPEG (Joint Photographic Experts Group) image taken by a digital camera can be connected. Here, a standard of the memory card can be arbitrarily determined, for example, a card standard according to PCMCIA (Personal Computer Memory Card International Association) may be utilized. Moreover, the data to be stored in the memory card is not limited to image data but may be data to be processed by a computer.","Numeral  denotes a JPEG processing unit which is used to encode (compress) another-format image data input via the card I\/F into JPEG image data and decode (decompress) received JPEG image data.","Numeral  denotes an LANC (LAN controller) which transmits\/receives the data based on the CSMA\/CD protocol to\/from the ADSL gateway.","Numeral  denotes a record processing unit which converts the received image data into print raster data and prints the converted data. Here, a record system of the record processing unit  can be arbitrarily determined, for example, an electrophotographic system and an ink-jet system can be used.",{"@attributes":{"id":"p-0052","num":"0055"},"figref":["FIG. 3","FIG. 1","FIG. 3"],"b":["106","108","215","216"]},"Numeral  denotes a CPU which performs a packet composition\/decomposition for voice and data input to the ADSL gateway, a communication procedure process to a VoIP server, and the like. Numeral  denotes a ROM which stores a program to operate the ADSL gateway, and numeral  denotes a RAM which is used when the data to be transmitted\/received by the ADSL gateway is buffered and when the program is executed.","Numeral  denotes a CSMA\/CD I\/F circuit which is connected to the CSMA\/CD interface  () and performs a frame composition\/decomposition process when the digital data is transmitted\/received to\/from the image communication apparatus.","The ADSL gateway in the present embodiment also corresponds to VoIP, that is, numeral  denotes a voice coding process unit which performs a coding and decoding process based on a voice coding system (refer to ITU-T Recommendation G.711, G729, etc.) used in VoIP.","Numeral  denotes a selection switch which switches a voice bus according to whether the data is transmitted to the voice terminal equipment connected to the ADSL gateway in a voice band or as the digital data in an out-of-voice band.","Numeral  denotes an analog telephone I\/F circuit to which the voice terminal equipment such as an analog telephone or the like is connected via the analog telephone interface  () so as to be able to transmit\/receive the voice signal to\/from the voice terminal equipment.","Next, communication control in the above structure will be explained. In the following, a process to be performed in a case where the image is transmitted from the first image communication apparatus  to the second and third image communication apparatuses  and  will be explained. Here, it is assumed that the JPEG image data taken by the digital camera is transmitted to the second image communication apparatus , and the image data read by a scanner is transmitted as G3 facsimile data (MH coded image) to the third image communication apparatus .",{"@attributes":{"id":"p-0059","num":"0062"},"figref":["FIGS. 7A","FIGS. 7A"],"b":["7","8","9","9","105","107","7","8","9","9","201","202","201","202"]},{"@attributes":{"id":"p-0060","num":"0063"},"figref":["FIGS. 7A","FIGS. 9A and 9B","FIGS. 4 to 6","FIGS. 7A","FIGS. 4 to 6","FIGS. 7A"],"b":["7","8","7","8","9","9","7","8","9","9"]},"When a destination is input by the key operation unit  of the image communication apparatus (step S in ), the input destination number is analyzed to judge whether or not the communication to the destination is performed via a VoIP network. For example, if it is assumed that a telephone number is 050-1234-5678, it is judged based on the numbers of three figures from the head that the communication is performed to the destination capable of performing the communication via the VoIP network (step S), and the processes from a step S and following steps are performed. Here, it should be noted that, at the present time, the prefix \u201c050\u201d being the numbers of three figures from the head is determined as the number indicating a telecommunication carrier of the IP telephone using the VoIP network. However, it is needless to say that such a rule is determined in Japan, and may be changed properly when other number plans in foreign countries are applied. When it is judged that the communication is performed to the destination via no VoIP network, the later-described processes shown in  are performed. Here, in the above case, it is judged based on the prefix being the numbers of three figures from the head whether or not the communication is performed via the VoIP network, however, the present invention is not limited to this. That is, such a judgment may be performed based on a table where a proper judgment condition as to whether or not the destination can perform the communication via the VoIP network has been stored in regard to the telephone number of each destination.","When the destination can perform the communication via the VoIP network, the image communication apparatuses  and  communicate with each other on the IP network, without using an analog voice line, by partially using VoIP\/SIP according to the communication sequence as shown in .","First, in a step S of , a packet of request-to-send (RTS) including the telephone number information is sent to the ADSL gateway  via the CSMA\/CD interface . In this case, the private IP address (192.168.0.1) of the ADSL gateway  is involved in the transmission destination address of such an RTS packet and then sent.","The ADSL gateway  which received the RTS packet inquires of the SIP proxy server  being an IP service agency as to the IP address of the destination (step S).","Then, the SIP proxy server  decompresses the telephone number into URL (Uniform Resource Locater) such as \u201c8. 7. 6. 5. 4. 3. 2. 1. e164. arpa\u201d (step S), and retrieves the DNS server  (step S).","The SIP proxy server  which received the URI of the destination ADSL gateway  from the DNS server  (step S) converts the URI of the destination ADSL gateway  into the global IP address (192.198.0.1) and the port number of the destination (step S), and sends the obtained address and number to the ADSL gateway  (step S).","The ADSL gateway  which received the global IP address of the destination sends an RTS ACK (acknowledge) command of a predetermined format including the received IP address to the image communication apparatus  (step S). Based on the RTS ACK command, the image communication apparatus  can know the global IP address (and other necessary parameters) of the destination.","Then, the ADSL gateway  which received the global IP address of the destination sends a session start request message of SIP to the ADSL gateway  by using the received address (step S). The ADSL gateway  which received the request message (step S in ) sends a reception message to the image communication apparatus  (step S in ). At that time, the ADSL gateway  receives an on-calling message from the ADSL gateway  (step S).","In a case where the image communication apparatus  is in the receivable state at a time when the reception message is received, the image communication apparatus  sends a response message to the ADSL gateway  (step S in ). The ADSL gateway  which received the response message sends it to the ADSL gateway  (steps S in  and S in ), whereby the response message is then sent from the ADSL gateway  to the image communication apparatus  (step S). Here, it should be noted that the response message includes the IP address and the port number information of the ADSL gateway  of the destination.","Incidentally, the IP telephone protocol (VoIP) of communicating a voice packet is used in the calling process until now. Ordinarily, in the voice communication as in VoIP, UDP (User Datagram Protocol) is used because a real-time response is thought to be more important than data reliability. Besides, ordinarily, in the IP telephone protocol (VoIP), it is assumed that the voice communication is performed hereafter, whereby UDP suitable for the voice packet communication is successively used.","By the above steps S to S and the sequence to be executed in these steps as shown at the upper half of , the image communication apparatus  and the image communication apparatus  can be connected to each other by a socket API (Application Programming Interface) corresponding to the predetermined port number on TCP(or UDP)\/IP, whereby it is possible to start the data transmission\/reception between the apparatuses  and .","In the image communication apparatus , the image data is set up to the TCP\/IP frame and sent, and the IP address of the ADSL gateway  is added as the destination address. In regard to the TCP\/IP packet sent to the ADSL gateway  via the ADSL gateway  and the IP network , the destination address is converted into the private IP address of the image communication apparatus  by the ADSL gateway . Then, this packet is sent to the image communication apparatus . In this image communication, justifiably the CSMA\/CD interface  is used between the image communication apparatus  and the ADSL gateway .","At this time, an arbitrary protocol can be used as a file transfer protocol corresponding to the upper layer of TCP\/IP used for the image data sending. More specifically, generally used FTP (File Transfer Protocol) or HTTP (HyperText Transport Protocol), a system to which these protocols are applied (also including a dedicated system, the encrypted version of FTP or HTTP, a protocol such as IPP (Internet Printing Protocol) or IPPFAX based on HTTP defined by IEEE (Institute of Electrical and Electronic Engineers), etc.) and the like can be used.","Prior to the image data sending, the image communication apparatus  sends an image RTS (request-to-send) message to the image communication apparatus . Then, when an image send permission message is received from the image communication apparatus , the image communication apparatus  initiates the file transfer protocol to start the image send process.","At the stage that it is decided to perform the image communication, it is preferable to perform the subsequent image send process by switching UDP utilized in VoIP\/SIP until now with attaching importance to real-time communication of the packet data, to TCP with attaching importance to reliability of the packet data, and by using the port number capable of executing TCP. Here, UDP may be switched to TCP at either a timing when the image send permission message is received and the image communication is established as described above or a timing after the response message was notified to the image communication apparatus  as in the step S. In this manner, when it intends to send the image, the image RTS message is sent prior to the transmission of the image data, whereby it is possible to accurately notify the destination whether the telephone call is desired or the image communication is desired, and it is also possible to select the protocol suitable for voice communication\/image communication.","In the image communication apparatus , the CPU  reads the JPEG data stored in the memory card via the card I\/F  (step S), and transfers the read data to the LANC . In the LANC , the data of a determined amount are packeted, the obtained packet is added to the header, and then the image data is transmitted to the destination of the previously received global IP address (192.198.0.1) of the ADSL gateway  (step S).","The ADSL gateway  which received the image data transfers the received data to the image communication apparatus  after converting the IP address as described above. Then, the image communication apparatus  which received the image data deletes the header thereof in the LANC  and stores the JPEG data in the RAM  (step S in ).","When all the JPEG data are sent from the image communication apparatus  to the image communication apparatus  (step S in ), the image communication apparatus  sends an end-of-receive message to the image communication apparatus  (step S in ), and the image sending ends (step S).","In the image communication apparatus , the received JPEG data is decompressed in the JPEG processing unit  (step S in ), the decompressed data is converted into four color data of C, M, Y and K in the record processing unit  (step S), and the converted color data is printed and output by the printer unit (step S).","By the above procedure, high-speed image sending can be achieved. Here, if it is assumed that the data size of the JPEG image taken by the digital camera is 300 KB and an upload send speed of the ADSL line is 1 Mbps, a time required for data sending is at longest about 300K\u00f7(1000K\u00f78)=2.4 seconds.","In the above, it is thought that the image of JPEG format is sent between the image communication apparatuses  and . However, it is needless to say that an image file (also non-image data) of G3 format or TIFF (Tag Image File Format)\/G3 format can be naturally sent under substantially the same communication control as above. When it is thought that the image of G3 format is sent, a send speed on the analog communication path is only 56 Kbps or so in maximum. Moreover, in fact, it is thought that the effective speed is further lowered due to execution of T.30 protocol. Thus, if the above communication procedure is used to send the image of G3 format, it is possible to remarkably increase the facsimile communication speed. Incidentally, when the data of G3 format (or data of another format) is received, it is needless to say that the processes on the receiving side shown in the steps S to S of  should be of course replaced by the following processes, that is, the received data of G3 format (or data of another format) is decoded (S), a process such as color conversion or the like is performed to the decoded data if necessary (S), and the processed data is reproduced (S).","On one hand, when it is judged in the step S that the destination number is not communicated via the VoIP network, for example, when the destination number is \u201c03-1234-5678\u201d, it is judged based on the numbers of three figures from the head that the communication is to be performed to the destination (e.g., image communication apparatus ) via the line switching network, and the line of the analog telephone interface  of the ADSL gateway  is captured (step S). Subsequently, a DTMF (Dial Tone Multi Frequency) signal corresponding to the telephone number is sent to the ADSL gateway  via the analog telephone interface  (step S). Then, the ADSL gateway  sends the DTMF signal corresponding to the destination number onto a voice band channel, and there is set up the connection to the line switching network  via a gateway (not shown) of a VoIP service agency. Alternatively, when there is set up the direct connection from the ADSL gateway  to the line switching network , the following processes are the same.","When the connection to the line switching network is set up, the same facsimile communication as that based on conventional Recommendation T.30 is performed according to the sequence shown in . That is, the reception notification is first performed to the image communication apparatus  being the destination terminal equipment. When a response is sent from the image communication apparatus  (step S), the ADSL gateway  notifies the image communication apparatus  of the sent response by reversing the polarity of the analog signal interface connected to the image communication apparatus . After that, the communication based on the facsimile communication procedure (T.30) is started (step S).","The image communication apparatus  sends a CNG (calling tone) (step S), and the image communication apparatus  which received the CNG sends a DIS (digital identification signal). Then, the image communication apparatus  which received the DIS (step S) sends a DCS (digital command signal) and a TCF (training check field) (step S), and the image communication apparatus  which received the DCS and TCF sends a CFR (confirmation to receive).","When the image communication apparatus  receives the CFR (step S), the image data sending is started. In the image data sending, the A\/D (analog-to-digital) conversion is conducted to the analog signal input from the CIS  as an original is being transported under the control of the read control unit  (step S), and the MH coding process is executed to the converted image data by the MH processing unit  (step S), whereby the data compression is executed. Subsequently, the MH coded image data is input and modulated into the analog signal in the FMDM  (step S), and the modulated signal is sent to the ADSL gateway  via the NCU  (step S).","In the ADSL gateway , the signal which was input via the analog telephone interface  is sent to the communication line as it is by using the voice band channel, and further sent to the image communication apparatus  via the line switching network . Then, in the image communication apparatus , the received image data is demodulated by the FMDM , decoded by the MH processing unit , converted into the four color data of C, M, Y and K by the record processing unit , and printed and output by the printer unit. The above reception process is substantially the same as that in and after a step S later described.","On one hand, a process to be performed in a case where facsimile sending is performed from the image communication apparatus  which does not have any means for connecting with the IP network and thus can connect with only the line switching network  to the image communication apparatus  (or ) will be explained. In this case, the image communication apparatus  performs the processes subsequent to the steps S to S in  as the receiving-side apparatus.","In the image communication apparatus , when a dial call to the image communication apparatus  is executed, the ADSL gateway  which received the dial call notifies the image communication apparatus  of the reception of the dial call, via the analog telephone interface  (step S in ). Then, when the image communication apparatus  responds to the notification (step S), the image communication apparatus  recognizes the response from the image communication apparatus  by recognizing the reverse of polarity, and then starts the image data sending according to the facsimile communication procedure of T.30.","First, the image communication apparatus  sends a CNG, and the image communication apparatus  which received the CNG (step S) sends a DIS (step S). Then, the image communication apparatus  which received the DIS sends a DCS and a TCF, and the image communication apparatus  which received the DCS and TCF (step S) sends a CFR (step S).","When the image communication apparatus  receives the CFR, the image data sending is started. In the image data sending, the A\/D conversion is conducted to the analog signal input from the CIS  as an original is being transported under the control of the read control unit , and the MH coding process is executed to the converted image data by the MH processing unit . Subsequently, the MH coded image data is input and modulated into the analog signal in the FMDM , the modulated signal is sent to the communication line via the NCU , and the data is further sent to the ADSL gateway  via the IP network .","In the image communication apparatus  which received the image data via the ADSL gateway  (step S), the received image data is demodulated by the FMDM  (step S), decoded by the MH processing unit  (step S), converted into the four color data of C, M, Y and K by the record processing unit  (step S), and printed and output by the printer unit (step S).","As above, according to the present embodiment, on the IP network, the image communication apparatus  can transmit\/receive at high speed the image data to\/from the image communication apparatus having the function of connecting with the VoIP network, without using the analog communication path. Besides, the image communication apparatus  can transmit\/receive the image to\/from the conventional image communication apparatus only having the facsimile function according to the facsimile communication procedure.","In the image communication on the IP network according to the present embodiment, by partially utilizing the SIP protocol used in the VoIP network, it is possible to know the IP address and the port number of the destination and send the image data at high speed by using specific services (HTTP, FTP, etc.) on TCP(or UDP)\/IP.","Furthermore, the user on the transmitting side only has to input the telephone number to designate the destination and does not need to perform other troublesome operations. That is, only by inputting the prefix of the telephone number, it is possible to designate whether or not to send the image to the destination via the VoIP network.","In the present embodiment, the image data is sent to the image communication apparatus  connected to the VoIP network in the form of packet by using the specific services (HTTP, FTP, etc.) on TCP(or UDP)\/IP via the CSMA\/CD interface . However, it is assumed that the image communication apparatus connected to the VoIP network is the terminal equipment only having the conventional facsimile communication function. For example, it is assumed that the ADSL gateway  and the image communication apparatus  are interconnected by only the analog telephone interface .","In such a case, the image communication apparatus  sends the facsimile image via the analog telephone interface  according to the conventional facsimile procedure because it is impossible to perform the IP communication via the CSMA\/CD interface .",{"@attributes":{"id":"p-0097","num":"0100"},"figref":["FIG. 6","FIG. 6","FIG. 4"],"b":["105","108","107","107","105","107"]},"Thus, after this, the image communication apparatus  sends to the image communication apparatus  the image according to the same facsimile procedure of Recommendation T.30 as that in the conventional facsimile communication as shown in . Here, it should be noted that the facsimile communication according to Recommendation T.30 is performed in the form of analog communication using the voice band. In this case, the VoIP network may be used, or the line switching network  may be used as described above. However, when the VoIP network is used, the account proportional to the communication distance can be evaded, whereby it is advantageous in communication costs. Here, in the actual communication, it is needless to say that the transmitting side (image communication apparatus ) is controlled by the procedure same as that shown in  and the receiving side (image communication apparatus ) is controlled by the procedure same as in and after the step S shown in .","In the above embodiment, that the image is sent by the procedure same as the convention facsimile procedure because the image communication apparatus  on the receiving side notifies, in the response message, the image communication apparatus  that the image communication apparatus  is the terminal equipment connected only by the analog telephone interface. However, the present invention is not limited to this, that is, the image may be sent according to the conventional facsimile procedure as described below. That is, in the above explanation, the image communication apparatus  sends the image RTS message to the image communication apparatus  after receiving the response message and before sending the actual image data. On one hand, when the image communication apparatus  does not receive the image send permission message from the image communication apparatus , the image communication apparatus  sends the image according to the conventional facsimile procedure by using the voice band. Thus, it is possible to absolutely perform the communication even with the apparatus which cannot understand the protocol according to the present invention but can merely perform the conventional facsimile communication.","In the above embodiment, it is supposed that dial information is notified to the ADSL gateway via the CSMA\/CD interface when the image is sent from the image communication apparatus  to the image communication apparatus . However, such dial information may be notified to the ADSL gateway in the form of DTMF signal by utilizing the analog telephone interface.","Moreover, in the above embodiment, the image communication apparatus (, ) and the ADSL gateway (, ) are assumed as the physically independent apparatuses. However, the same effect as above can be obtained even if the ADSL gateway and the image communication apparatus are unified. That is, by unifying the ADSL gateway and the image communication apparatus, it becomes unnecessary to exchange commands between the ADSL gateway and the image communication apparatus because the ADSL gateway and the image communication apparatus are connected by a dedicated bus or the like without using CSMA\/CD interface, and it is thus possible to increase communication efficiency.","Moreover, in addition to the above structure of \u201cADSL modem+splitter\u201d, a router or the like for sharing the IP connection with another network terminal equipment may be unified as the structure of the line interface portion shown as the ADSL gateway in the above embodiment. Besides, the function as the gate keeper for VoIP and the function as the facsimile gateway of Recommendation T.38 may be included in the line interface portion shown as the ADSL gateway.","Moreover, in the above, the ADSL service is supposed as the network communication service. However, the technique of the present invention, particularly the transfer technique that VoIP\/SIP is utilized in the former half of the communication, and FTP, HTTP or the like is utilized in the latter half of the communication, is not limited to the ADSL service. That is, the technique of the present invention can be executed likewise in other networks such as an FTTH (Fiber To The Home) network, an ATM (Asynchronous Transfer Mode) network and the like if these networks are in the network communication environments capable of utilizing VoIP\/SIP. Even when the networks such as the FTTH network, the ATM network and the like different from the ADSL network is utilized, it is only necessary to change the network interface (ADSL modem  in ) on the WAN side to the interface suitable for the utilized network, that is, other structures may be the same as those shown in the above embodiment. Besides, when it is necessary to execute fall back to the analog communication (), the technique of the present invention can be executed likewise if there is an analog communication means of some kind in addition to the IP communication means between the line interface (ADSL gateway in the above case) and the image communication means (image communication apparatus in the above case).","Moreover, in the above, the example that the image data is sent from the calling side is explained. However, it is needless to say that the procedure of the present invention can be used even in a case where the image data is sent in the opposite direction, that is, polling sending\/receiving is performed. Particularly, when the IP communication is performed in the latter half of the communication, the procedure of the present invention can be easily achieved by using the file transmit\/receive protocol (such as FTP) which supports bi-directional transfer. Besides, when the analog communication path is utilized, it only has to perform ordinary polling communication defined according to Recommendation T.30.","As apparent from the above explanation, according to the present invention, in the communication apparatus which includes the IP communication means and transmits\/receives the data to\/from the destination station discriminated by the telephone number, the control method of the communication apparatus, and the control program for the communication apparatus, the structure of (1) obtaining the IP address of the destination station from the predetermined server based on the telephone number of the destination station, and (2) transmitting\/receiving the communication data on the IP network to\/from the destination station, based on the predetermined file transmit\/receive protocol by using the obtained IP address of the destination station is adopted, whereby it is possible to obtain the beneficial effect that it enables to perform high-speed and high-reliability data communication without requiring any troublesome user operation.","In addition, the structure of transmitting\/receiving the communication data to\/from the destination station by using the voice band via the analog communication path established on the line switching network or the IP network when it is impossible to transmit\/receive the communication data on the IP network based on the predetermined file transmit\/receive protocol is adopted, whereby it is possible to obtain the beneficial effect that it enables to select the appropriate communication path from either the analog communication path of the voice band or the network communication path and perform high-speed and high-reliability communication without requiring any troublesome user operation.","Hereinafter, the embodiment of the present invention will be explained in detail with reference to the attached drawings. In the following, an image communication apparatus will be shown as an example of a communication apparatus.",{"@attributes":{"id":"p-0108","num":"0111"},"figref":["FIG. 10","FIG. 10"],"b":["1101","1102","1103","1104","1105","1106","1107","1108","1109","1111","1110","1112","1105","1107"]},"Although the details of the structures of the ADSL gateways  and  will be later explained in detail. The contract of the subscriber regarding these gateways is a common type contract including a telephone service and an IP communication service. Thus, the analog telephone interface  and the CSMA\/CD interface  acting as the network interface are provided between the image communication apparatus  and the ADSL gateway , and similarly the analog telephone interface  and the CSMA\/CD interface  acting as the network interface are provided between the image communication apparatus  and the ADSL gateway  (however, the network interface is not limited to the CSMA\/CD interface).","The analog telephone interface  and the CSMA\/CD interface  provided between the image communication apparatus  and the ADSL gateway  and the analog telephone interface  and the CSMA\/CD interface  provided between the image communication apparatus  and the ADSL gateway  can be respectively utilized for the communication.","More specifically, the analog telephone interfaces  and  can be utilized for telephone call and analog facsimile communication based on ITU-T Recommendation T.30 (hereinafter, simply called \u201cRecommendation T.30\u201d or \u201cT.30\u201d as long as there is no confusion). Incidentally, the signals supplied from the analog telephone interfaces  and  are respectively routed from a station switching equipment to a not-shown line switching network.","For example, a predetermined protocol such as a PPPoE (Point-to-Point Protocol over Ethernet\u2122) or the like is used on the path of the CSMA\/CD interfaces  and , whereby the connection with ISP (Internet Service Provider) is established, and the global IP address on the side of WAN (wide area network) and the private IP address on the side of LAN (local area network) are determined as described above. In such a condition, the image communication apparatuses  and  can utilize arbitrary services (e.g., services on TCP(UDP)\/IP (Transmission Control Protocol (User Datagram Protocol)\/Internet Protocol) such as an FTP (File Transfer Protocol), an HTTP (HyperText Transport Protocol), the VoIP and the like) on the IP network .","In the present invention, the image communication apparatuses (e.g.,  and  in ) are connected to perform the communication by partially utilizing the VoIP (ITU-T Recommendation H.323) and an SIP (RFC (Request For Comment) 2543) on the IP network , thereby enabling to perform high-speed communication. By the way, the details of the VoIP and the SIP used in the present invention will be described later.",{"@attributes":{"id":"p-0114","num":"0117"},"figref":["FIG. 11","FIG. 10","FIG. 11"],"b":["1105","1107","1201","1202","1201","1201","1203"]},"Numeral  denotes a key operation unit which consists of dials and operation buttons for facsimile sending\/reception, and numeral  denotes an LCD (liquid crystal display) unit.","Numeral  denotes a CIS (contact image sensor) which converts an original image into an analog signal, and numeral  denotes a read control unit which converts the analog signal output from the CIS  into digital data. The converted digital data is then transferred to the RAM  under the control of the CPU .","Numeral  denotes an MH (Modified Huffman) processing unit (MH coding and decoding processing unit) which performs data compression by performing MH coding to the read image data when the image data is sent, and decodes the MH coded image data when the image data is received.","Numeral  denotes an FMDM (facsimile modem) which modulates the MH coded data and converts into the analog signal of a voice band capable of being transferred on an analog line when the image data is sent. When the image data is received, the FMDM  demodulates the received analog signal and then outputs the MH coded data.","Numeral  denotes an NCU (network control unit) which is connected to the analog telephone interface  () as an interface for an analog communication line.","Numeral  denotes a card I\/F (interface) to which a memory card storing a JPEG (Joint Photographic Experts Group) image taken by a digital camera can be connected. Here, a standard of the memory card can be arbitrarily determined, for example, a card standard according to PCMCIA (Personal Computer Memory Card International Association) may be utilized.","Numeral  denotes a JPEG processing unit which is used to encode (compress) another-format image data input via the card I\/F into JPEG image data and decode (decompress) received JPEG image data.","Numeral  denotes an LANC (LAN controller) which is connected to the CSMA\/CD interface  () and sends\/receives the data based on a CSMA\/CD protocol to\/from the ADSL gateway.","Numeral  denotes a record processing unit which converts the received image data into print raster data and prints the converted data. Here, a record system of the record processing unit  can be arbitrarily determined, for example, an electrophotographic system and an ink-jet system can be used.",{"@attributes":{"id":"p-0124","num":"0127"},"figref":["FIG. 12","FIG. 10","FIG. 12"],"b":["1106","1108","1215","1216"]},"Numeral  denotes a CPU which performs a packet composition\/decomposition for voice and data input to the ADSL gateway, a communication procedure process to a VoIP server, and the like. Numeral  denotes a ROM which stores a program to operate the ADSL gateway, and numeral  denotes a RAM which is used when the data to be sent\/received by the ADSL gateway is buffered and when the program is executed.","Numeral  denotes a CSMA\/CD I\/F which performs a frame composition\/decomposition process when the digital data is sent\/received to\/from the image communication apparatus. The CSMA\/CD I\/F  is connected to the CSMA\/CD interface  ().","The ADSL gateway in the present embodiment also corresponds to the VoIP, that is, numeral  denotes a voice coding process unit which performs a coding and decoding process based on a voice coding system (refer to ITU-T Recommendation G.711, G.729, etc.) used in the VoIP.","Numeral  denotes a selection switch which switches a voice bus according to whether the data is sent to the voice terminal equipment connected to the ADSL gateway in a voice band or as the digital data in an out-of-voice band.","Numeral  denotes an analog telephone I\/F to which the voice terminal equipment such as an analog telephone or the like can be connected so as to be able to send\/receive the voice signal to\/from the voice terminal equipment. The analog telephone I\/F  is connected to the above analog telephone interface  ().","Next, communication control in the above structure will be explained. In the following, a process to be performed in a case where the image is sent from the first image communication apparatus  to the second image communication apparatus  and a process to be performed in a case where the second image communication apparatus downloads the image from the WWW server  will be explained. Incidentally, in the present embodiment, a case where the image to be sent is represented by the image data of JPEG format (e.g., JPEG image data taken by a digital camera) will be mainly explained.","Next, the operations by the above structure will be explained.",{"@attributes":{"id":"p-0132","num":"0135"},"figref":["FIGS. 15A","FIGS. 15A"],"b":["15","16","1105","1107","15","16","1201","1202","1201","1202"]},{"@attributes":{"id":"p-0133","num":"0136"},"figref":["FIG. 13","FIGS. 15A","FIG. 13","FIGS. 15A"],"b":["15","16","15","16"]},"<Image Sending from First Image Communication Apparatus to Second Image Communication Apparatus>","When a telephone number of a destination is input by the key operation unit  of the image communication apparatus  (step S), a packet of request-to-send (RTS) including the telephone number information is sent to the ADSL gateway  via the CSMA\/CD interface  (step S). In this case, the private IP address (192.168.0.1) of the ADSL gateway  is involved in the sending destination address of such an RTS packet and then sent.","The ADSL gateway  which received the RTS packet sends a session request message (INVITE message) of the SIP to the SIP proxy server  of an IP service agency (step S). The session request message is composed based on the specifications of the SIP, and the telephone number information input in the step S and the telephone number information of the ADSL gateway being the sending-source information are included in the destination of the header of this message. Furthermore, the IP address of the SIP proxy server  is stored at the sending-destination IP address of the IP packet which stores the session request message, and the IP address of the ADSL gateway  is stored at the sending-source IP address of the IP packet. Besides, a content type \u201capplication\/sdp\u201d is described in the header of the session request message so as to indicate that the data based on an SDP (Session Description Protocol) is included in the message body. Further, in the SDP data of the message body, it is described that the medium is a JPEG image (\u201cimage\/jpeg\u201d), whereby it is possible to perceive that the ADSL gateway  sends\/receives the JPEG image data hereafter.","Then, the SIP proxy server  decompresses the telephone number in the header of the received session request message into URL (Uniform Resource Locater) (or URI (Uniform Resource Identifier)) such as \u201c8. 7. 6. 5. 4. 3. 2. 1. e164. arpa\u201d (step S), and sends a retrieving request to the DNS server  (step S).","When the IP address of the ADSL gateway  of the destination is received from the DNS server  (step S), the SIP proxy server  changes the sending-destination IP address in the packet received from the ADSL gateway  into the global IP address of the ADSL gateway  received from the DNS server, changes the sending-source IP address for the IP address of the SIP proxy server , and then sends the session request message to the ADSL gateway  (step S).","The ADSL gateway  which received the session request message sends a reception message to the image communication apparatus  (step S in ). The reception message includes medium classification information described in the session request message previously received from the ADSL gateway , whereby the image communication apparatus  can perceive that the sending (receiving if viewed from the image communication apparatus ) of the JPEG image has been requested.","In the above, the image communication apparatus  can perceive that the sending (receiving if viewed from the image communication apparatus ) of the JPEG image has been requested, based on the medium classification information described in the session request message. However, the present embodiment is not limited to this, that is, a request of sending (receiving if viewed from the image communication apparatus ) of the JPEG image may be notified in a confirmation response in a later-described step S. Moreover, a request of sending (receiving if viewed from the image communication apparatus ) of the JPEG image may be notified before getting \u201cGET\/index.html HTTP\/1.0\u201d as a data getting message of the HTTP in a step S after the confirmation response in the step S.","At the same time, the ADSL gateway  sends an on-calling message to the SIP proxy server . Here, the sending-source telephone number information described in the heater of the received session request message is stored at the destination in the header of the on-calling message, and the IP address of the SIP proxy server  being the sending-source IP address of the session request message is stored as the sending-destination IP address. The SIP proxy server  which received the on-calling message changes the sending-destination IP address for the IP address of the ADSL gateway  and also changes the sending-source IP address for the IP address of the SIP proxy server . Then, the proxy server  send thus changed on calling message, and the ADSL gateway  receives it (step S).","The image communication apparatus  receives the reception message, and sends a response message to the ADSL gateway  if it is in a receivable state (step S in ).","The ADSL gateway  which received the response message further sends the response message to the SIP proxy server  as well as the previous on-calling message. Then, the SIP proxy server  changes only the sending-destination IP address for the IP address of the ADSL gateway  this time, and the ADSL gateway  thus receives the response message (step S in ).","Subsequently, the response message is sent from the ADSL gateway  to the image communication apparatus  (step S). The ADSL gateway  can perceive the IP address of the ADSL gateway  by means of the sending-source IP address included in the received response message, whereby it subsequently becomes possible to directly send the packet to the ADSL gateway  (further to image communication apparatus ) without using the SIP proxy server  (step S).","The image communication apparatus  which received the response message sends a response confirmation message to the image communication apparatus  (step S), whereby it is possible to start sending\/receiving of the image data between the image communication apparatus  and the image communication apparatus .","As described above, both the IP addresses (i.e., global IP addresses of ADSL gateways  and ) have been already known between the data sending and receiving devices, whereby it subsequently becomes possible to send and receive the image data by utilizing the data send\/receive protocol on the arbitrary TCP (UDP)\/IP. As the data send\/receive protocol on the TCP(UDP)\/IP, the generally used FTP (File Transfer Protocol), the generally used the HTTP (HyperText Transport Protocol), a system to which these protocols are applied (also including a dedicated system, the encrypted version of the FTP or the HTTP, a protocol such as an IPP (Internet Printing Protocol), an IPPFAX based on the HTTP defined by IEEE (Institute of Electrical and Electronic Engineers), etc.) and the like can be used. In the following, the method of sending\/receiving the image data by using the HTTP will be described.","The image communication apparatus  which perceived, based on the previous session request message, that the image communication apparatus  intends to send the JPEG image data establishes HTTP connection (exchanging of SYN and ACK), and further sends the message \u201cGET\/index.html HTTP\/1.0\u201d as the data getting message of the HTTP to the image communication apparatus  (steps S and S in ).","Then, the image communication apparatus  which received the data getting message (step S in ) sends a message \u201cHTTP\/1.1 200 OK\u201d as the response message to the image communication apparatus  (step S in ). Besides, a content type \u201cimage\/jpeg\u201d is described in the message to indicate that the JPEG image data is sent.","Moreover, the image communication apparatus  which received the response message (step S) sends a JPEG image sending request message \u201cGET\/image.jpeg HTTP\/1.0\u201d as the message to request the sending of the JPEG image (step S). As above, because the HTTP is used, it takes the format that the image communication apparatus  requests the image to the image communication apparatus .","The image communication apparatus  which received the above message (step S) sends a response message \u201cHTTP\/1.0 200 OK\u201d (step S in , step S in ). Then, the image communication apparatus  starts to send the JPEG image data subsequent to the response message.","The image data is set up to the TCP\/IP frame and sent, and the IP address of the ADSL gateway  is added as the destination address. In regard to the TCP\/IP packet sent to the ADSL gateway , the sending-destination address is converted into the private IP address of the image communication apparatus  by the ADSL gateway . Then, this packet is sent to the image communication apparatus .","In the image communication apparatus , the CPU  reads the JPEG data stored in the memory card via the card I\/F  (step S), and transfers the read data to the LANC . In the LANC , the data of a certain amount are packeted, the IP address (192.198.0.1) of the previously received destination ADSL gateway  is added as the header of the packet, and the obtained packet is sent (step S).","The ADSL gateway  which received the image data transfers the received data to the image communication apparatus  after converting the IP address thereof as described above. Then, the image communication apparatus  which received the image data (step S in ) starts a process necessary to record the received JPEG image by the record processing unit . That is, the image communication apparatus  deletes the header thereof in the LANC  and stores the JPEG data in the RAM  to give the data to the record processing unit  via appropriate scheduling.","When all the JPEG data are sent from the image communication apparatus  to the image communication apparatus  (step S in , step S in ), the image sending ends. The received JPEG data is decompressed in the JPEG processing unit  (step S), the decompressed data is converted into four color data of C, M, Y and K in the record processing unit  (step S), and the converted color data is printed and output (step S).","By the above procedure, high-speed image sending can be achieved. Here, if it is assumed that the data size of the JPEG image taken by the digital camera is 300 KB and an upload send speed of the ADSL line is 1 Mbps, a time necessary for data sending is at longest about 300K\u00f7(1000K\u00f78)=2.4 seconds.","In the above, it is thought that the image of JPEG format is sent between the image communication apparatuses  and . However, it is needless to say that an image file (also non-image data) of G3 format or TIFF (Tag Image File Format)\/G3 format can be naturally sent under substantially the same communication control as above. When it is supposed that the image of G3 format is sent, a send speed on the analog communication path is only 56 Kbps or so in maximum. Moreover, in fact, it is supposed that the effective speed is further lowered due to execution of the T.30 protocol. Thus, if the above communication procedure is used to send the image of G3 format, it is possible to remarkably increase the facsimile communication speed.","Incidentally, when the data of G3 format (or data of another format) is received, it is needless to say that the processes on the receiving side shown in the steps S to S of  should be of course replaced by the following processes, that is, the received data of G3 format (or data of another format) is decoded (S), a process such as color conversion or the like is performed to the decoded data if necessary (S), and the processed data is reproduced (S).","As described above, according to the present embodiment, the image communication apparatus  can send\/receive the image at high speed without using the analog communication path to\/from another image communication apparatus having the function to connect the VoIP network. Thus, the calling side only has to input the telephone number, as well as the conventional facsimile apparatus of PSTN (Public Switched Telephone Network) connection type or the like, whereby it is very easy.","In the image communication on the IP network according to the present embodiment, by partially utilizing the SIP used in the VoIP network, it is possible to know the IP address and the port number of the destination and send the image data at high speed by using specific services (HTTP, FTP, etc.) on the TCP(or UDP)\/IP.","Furthermore, the user on the sending side only has to input the telephone number to designate the destination and does not need to perform other troublesome operations. That is, only by inputting the prefix of the telephone number, it is possible to designate whether or not to send the image to the destination via the VoIP network.","In the present embodiment, the IP address of the sending destination is added to the image data packet to be sent. However, the same effect as above can be obtained by such a process that the sending-source image communication apparatus adds the IP address of the SIP proxy server to the image data and then the SIP proxy server converts the added IP address into the IP address of the sending destination.","<Image Sending from WWW Server to (Second) Image Communication Apparatus>","In the above embodiment, the HTTP is used to send the communication data. As is generally known, the HTTP is widely used to download various kinds of data files from the WWW server on the Internet.","On one hand, the image communication apparatus in the above embodiment can be structured as a (network-corresponding) facsimile machine or a so-called multifunctional image processing apparatus. Besides, supporting HTTP transfer is helpful not only in the data sending\/receiving as in the above embodiment but also in causing the image communication apparatus to function as a WWW browser terminal equipment (or a general-purpose Internet terminal equipment).","In order to show the above, a state of communication between the WWW server and the second image communication apparatus of the present invention will be explained with reference to . Here,  shows the sequence of the form same as that shown in , and, in this sequence, the step numbers shown in  correspond to the respective steps shown in . Incidentally, because the step S and the following steps in the processes of the image communication apparatus shown in  are equivalent to the processes of the WWW server, the step S and the following steps will be cited as the processes of the WWW server in the following.","When it is instructed by the key operation unit  of the image communication apparatus  to print (or display) the contents downloaded from the WWW server and the URL of the access destination is input (step S), PPP (Point-to-Point Protocol) connection is established via an access server of an ISP (Internet Service Provider) if necessary at this stage (i.e., if image communication apparatus  is unconnected to IP network  via ADSL gateway ).","Then, HTTP connection (typically, port No. 80 is used) is established between the image communication apparatus  and the WWW server  registered (or arbitrary) in the image communication apparatus  (step S). Incidentally, an authentication process to check the ID and the password between the image communication apparatus  and the access server of the ISP or the like is performed when the PPP connection is established, and the authentication process to check the ID and the password between the image communication apparatus  and the WWW server  if necessary when the HTTP connection is established. Moreover, the image communication apparatus  refers to the DNS server  if necessary when the HTTP connection is established.","When the HTTP connection is established, the image communication apparatus  sends a data getting message of the HTTP (step S). For example, if the URL of the access destination is \u201chttp:\/\/www.canon.com\/index.html\u201d, a message \u201cGET\/www.canon.com\/index.html HTTP\/1.0\u201d is sent.","Then, the WWW server  which received this message (step S in ) sends the message \u201cHTTP\/1.1 200 OK\u201d as the response message to the image communication apparatus  (step S). Besides, the content type \u201cimage\/jpeg\u201d is described in the message to indicate that the JPEG image data is sent.","The image communication apparatus  which received the response message (step S in ) sends the JPEG image sending request message \u201cGET\/image.jpeg HTTP\/1.0\u201d as the message to request the sending of the JPEG image (step S). However, the data to be get need not be the JPEG image, and the portion \u201c\/image.jpeg\u201d of each HTTP message may be an arbitrary file name of arbitrary form.","Then, the WWW server  which received the above message (step S in ) sends the response message \u201cHTTP\/1.0 200 OK\u201d (step S in , step S in ).","Subsequently, the image data (or arbitrary file data) is set up to the TCP\/IP frame and sent to the image communication apparatus  (step S in ), and the global IP address of the ADSL gateway  is used as the sending-destination address. In regard to the TCP\/IP packet sent to the ADSL gateway , when the ADSL gateway  receives the image data of HTTP packet format, as described above, the ADSL gateway  converts the global IP address of sending destination into the private IP address and then sends the image data to the image communication apparatus . The image communication apparatus  which received the image data starts to prepare a recording process of the received JPEG image. That is, the header is deleted in the LANC  and the JPEG data is stored in the RAM .","When all the JPEG data are sent from the WWW server  to the image communication apparatus  (step S in ), the received JPEG data is decompressed in the JPEG processing unit  in the same manner as above (step S), the decompressed data is converted into four color data of C, M, Y and K in the record processing unit  (step S), and the converted color data is recording-output (step S). Here, in the present embodiment, the recording output of the image data is shown by way of example. But, it is of course possible to apply an output (reproduction) method of displaying the data on a display.","As described above, the image communication apparatus can download the JPEG image data file or another arbitrary data file from the WWW server and then output (reproduce) the downloaded data file.","As is apparent from the above explanation, the image data sending according to the present invention is performed in the procedure quite the same as the ordinary download process based on the HTTP. That is, the image communication apparatus according to the present invention has the excellent advantage that both the function as the WWW browser terminal equipment (or general-purpose Internet terminal equipment) and the function as the (network-corresponding) facsimile machine, the multifunctional image processing apparatus or the like can be achieved by the simple and low-cost hardware\/software structure.","Although the above embodiment premises that the image data to be sent and received is recording-output, it is needless to say that the data sending technique according to the present invention is similarly applied to other methods such as a displaying-output method, and even in other methods, the same effect as described above can be obtained in regard to the data sending.","When the image data (or data of another format) is sent according to the HTTP, the image communication apparatus (or WWW server) on the sending side sends the image data correlated with a markup language such as an HTML (Hyper Text Markup Language) or the like. The image communication apparatus, on the receiving side, which received the markup language and the image data can display them in the same procedure as that in case of displaying a markup language and image data received from the WWW server. At this time, if a user interface (GUI) which is substantially the same as the ordinary WWW browser is used, it is possible by the same user operation as that for the WWW browser to perform the data operations quite the same as those generally performed by the WWW browser, for example, printing of the image data (or data of another format), storing of the image data, transferring of the image data to another terminal equipment. Of course, when a tag indicating data printing or file storing or a reference tag (link) to another data is included in the HTML downloaded from the WWW server, it is possible to perform displaying according to the included tag. Moreover, by the user interface (GUI) substantially the same as the ordinary WWW browser, a user can perform the data printing, the file storing, jumping to another data, and the like according to the corresponding tags.","Furthermore, all the processes capable of being performed to the WWW server data can be similarly performed to the data sent from the image communication apparatus on the sending side, according to their data structures (i.e., structures of tag, MIME (Multipurpose Internet Mail Extensions) identifier and the like). Thus, it becomes unnecessary for the user to remember a quite different operation for each image communication or each reference to the WWW data.","Moreover, in the above embodiment, the image communication apparatus (, ) and the ADSL gateway (, ) are assumed as the physically independent apparatuses. However, the same effect as above can be obtained even if the ADSL gateway and the image communication apparatus are unified. That is, by unifying the ADSL gateway and the image communication apparatus, it becomes unnecessary to exchange commands between the ADSL gateway and the image communication apparatus because the ADSL gateway and the image communication apparatus are connected by a dedicated bus or the like without using CSMA\/CD interface, and it is thus possible to increase communication efficiency.","Moreover, in addition to the above structure of \u201cADSL modem+splitter\u201d, a router or the like for sharing the IP connection with another network terminal equipment may be unified as the structure of the line interface portion shown as the ADSL gateway in the above embodiment. Besides, the function as the gate keeper for the VoIP and the function as the facsimile gateway of Recommendation T.38 may be included in the line interface portion shown as the ADSL gateway.","Moreover, in the above, the ADSL service is supposed as the network communication service. However, the technique of the present invention, particularly the transfer technique that the VoIP\/SIP is utilized in the former half of the communication, and the FTP, the HTTP or the like is utilized in the latter half of the communication, is not limited to the ADSL service. That is, the technique of the present invention can be executed likewise in other networks such as an FTTH (Fiber To The Home) network, an ATM (Asynchronous Transfer Mode) network and the like if these networks are in the network communication environments capable of utilizing the VoIP\/SIP. Even when the networks such as the FTTH network, the ATM network and the like different from the ADSL network are utilized, it is only necessary to change the network interface (ADSL modem  in ) on the WAN side to the interface suitable for the utilized network, that is, other structures may be the same as those shown in the above embodiment. Besides, even when it is necessary to use the analog communication path, the technique of the present invention can be executed likewise if there is an analog communication means of some kind (VoIP gate keeper, facsimile gateway according to ITU-T Recommendation T.38, or the like) in addition to the IP communication means between the line interface (ADSL gateway in the above case) and the image communication means (image communication apparatus in the above case).","Moreover, in the above, the example that the image data is sent from the calling side is explained. However, it is needless to say that the procedure of the present invention can be used even in a case where the image data is sent in the opposite direction, that is, polling sending\/receiving is performed. That is, when the HTTP is used in data sending, it is merely required that the data sending side has the function as the HTTP server side, and the data receiving side has the function as the HTTP server side. This is because it is irrelevant whether the apparatus on the calling side or the apparatus on the called side has the above function. Then, the HTTP data sending in the latter half of the communication can be achieved only by exchanging the HTTP message in the direction opposite to the above direction.","In the above embodiment, the explanations of authentication and security measures are omitted for simplification. However, when the HTTP is used in the data sending as in the above embodiment, it is not preferable for the image communication apparatus on the sending side to always leave its HTTP port open for unspecified number of communication partners, no it is necessary to take some kinds of actions on authentication and security. For example, it is supposed to authenticate the user ID and (or) the password (both previously allocated to image communication apparatus, or determined by user) at the stage of establishment of the HTTP connection (step S in , and step S in each of ), to cause the image communication apparatus on the sending side to open the HTTP port only in regard to the IP address on the receiving side gotten by the previous SIP communication only during the data sending period (steps S to S in , and steps S to S in ) (such port control or packet filtering can be performed not only by image communication apparatus but also by gateway (ADSL gateway)), and the like.","As described above, in the present invention, the communication apparatus on the calling side sends the data communication request based on the SIP by using the input telephone number, and then starts the communication procedure conforming to the HTTP. Therefore, the apparatus on the calling side only has to perform the simple user operation through the medium of telephone number, and it is possible to easily and inexpensively apply both a WWW browsing function using the HTTP and a real-time one-to-one (PTP: Peer To Peer) data receiving function between data sending and receiving apparatuses to the communication apparatus on the data receiving side. Moreover, even when the communication apparatus is connected particularly to the line service such as the ADSL, it is possible to avoid a problem of the conventional facsimile machine that throughput thereof seriously degrades by the data communication performed in the voice band.","As apparent from the above explanation, according to the present invention, in the communication method and apparatus which send\/receive, by the IP communication, the communication data between the communication apparatuses discriminated by the telephone numbers, and the control program for the communication apparatus, the structure that the first communication apparatus obtains the IP address of the second communication apparatus from the predetermined server based on the telephone number of the second communication apparatus and sends the data communication request to the second communication apparatus, and the communication apparatus on the data receiving side of the first and second communication apparatuses sends the data sending request to the communication apparatus on the data sending side based on the data send\/receive protocol conforming to the HTTP and sends\/receives the communication data on the IP network based on the data send\/receive protocol, is adopted. Therefore, the apparatus on the calling side only has to perform the simple user operation through the medium of telephone number, it is possible to easily and inexpensively apply both the WWW browsing function using the HTTP and the real-time one-to-one (PTP) data receiving function between the data sending and receiving apparatuses to the communication apparatus on the data receiving side, and it is further possible to achieve the high-speed data communication on the IP communication path based on the data send\/receive protocol conforming to the HTTP. That is, according to the present invention, it is possible to obtain the significant effects of providing the communication system which can perform the high-speed data communication by the simple calling operation through the medium of telephone number, is excellent in versatility, and can be easily applied inexpensively."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0019","num":"0022"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0020","num":"0023"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0021","num":"0024"},"figref":["FIG. 3","FIG. 1"]},{"@attributes":{"id":"p-0022","num":"0025"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0023","num":"0026"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0024","num":"0027"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0025","num":"0028"},"figref":["FIGS. 7A and 7B","FIG. 7"]},{"@attributes":{"id":"p-0026","num":"0029"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0027","num":"0030"},"figref":["FIGS. 9A and 9B","FIG. 9"]},{"@attributes":{"id":"p-0028","num":"0031"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0029","num":"0032"},"figref":["FIG. 11","FIG. 10"]},{"@attributes":{"id":"p-0030","num":"0033"},"figref":["FIG. 12","FIG. 10"]},{"@attributes":{"id":"p-0031","num":"0034"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0032","num":"0035"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0033","num":"0036"},"figref":["FIGS. 15A and 15B","FIG. 15"]},{"@attributes":{"id":"p-0034","num":"0037"},"figref":"FIG. 16"}]},"DETDESC":[{},{}]}
