---
title: Routable network subnet relocation systems and methods
abstract: A system and method for relocating a subnet to a remote location includes a tether router coupled to an anchor router via a link. The tether router is coupled to a plurality of nodes, each node corresponding to a network address of a plurality of network addresses allocated to a user. The plurality of network addresses is allocated to the user by a lease broker. The link may include a private tunnel for traversing a mechanism that otherwise hinders communication from the tether router to the anchor router, such as a network address translation (NAT) mechanism.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07653746&OS=07653746&RS=07653746
owner: University of Southern California
number: 07653746
owner_city: Los Angeles
owner_country: US
publication_date: 20030801
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATION","GOVERNMENT'S INTEREST IN APPLICATION","BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"p":["This application claims priority under 35 U.S.C. \u00a7 119(e) to provisional application having Ser. No. 60\/400,822 filed Aug. 2, 2002, entitled \u201cSystem for Network Subnet Relocation,\u201d the entire content of which is hereby incorporated by reference.","This invention was made with government support under Contract Nos. F30602-98-1-0200 and F30602-01-2-0529 awarded by the Air Force Research Laboratory. The government has certain rights in the invention.","1. Field","The present invention concerns relocating network subnets, i.e., portions of a network to a location remote from the original network.","2. Background","Often it is desirable to run applications on a network or device in a location remote from the location where such applications are ordinarily run. For example, a programmer may wish to run an application at a location remote from a usual \u201chome\u201d network in which sites containing services necessary for that application are available. The programmer in this instance may face a quandary. Services necessary for the proper execution of the application at the remote location or device are available from the programmer's \u201chome\u201d network, but, for whatever reason, may be unavailable for the application. That is, the programmer running the application on the remote location can not take advantage of necessary services that are available from the \u201chome\u201d network. Such services may either be located on the \u201chome\u201d network, or if located elsewhere, accessible from the \u201chome\u201d network.","The connection failure may result from a wide variety of obstacles. In the most simple scenario, the \u201chome\u201d network and remote device or network may not be connected together. As another illustration, communications between the networks may not be routable due to incompatible network protocols, unfulfilled encryption requirements, or intervening devices in the network link, such as firewalls or network translation devices, etc. that tend to prevent or obstruct the routing of data between the networks. Alternatively, the network infrastructure may in some way be inadequate for delivery of such services to the remote network or the coordination of services between networks. Another scenario is that the remote location may not have enough network addresses to support all the devices necessary to run the applications. The programmer faces inherent obstacles and potentially significant network and service configuration problems.","A common infrastructure where such problems abound is the Internet. As a simple illustration, a programmer may wish to run a presentation at a remote site on the internet, such as a corporate or governmental intranet. A seamless execution of the demonstration may require that the applications that are the subject of the demonstration have access to other services on the Internet, such as a file server, DNS server, or the like, wherein the latter services are located at remote sites. Just as well, various services on the Internet may require access to these remote programs being run at the remote location on the exemplary intranet. The programmer in this situation would ideally like to have \u201ctrue\u201d Internet services at the remote location, meaning seamless access to necessary Internet sites (and vice versa) for the purposes of running the presentation.","Ordinarily, communications occur on the Internet through the routing of IP packets with a transport protocol like TCP or UDP. However, the corporate intranet may reside behind one or more devices that make such communication impractical or impossible. Such devices may include a firewall, a network address translation (NAT) box, or another device that otherwise obfuscates services or hinders communication between the Internet and the corporate intranet.","A NAT box is a mechanism that, among other functions, runs an algorithm that enables a network to use one set of IP addresses for internal traffic and another set for external traffic. In many cases, the NAT box itself has only one IP address known to components on the Internet. External sites on the Internet thus cannot identify, or associate with a routable IP address, components located behind the NAT box. Accordingly, these external sites can not initiate communicate with the internal sites or components behind the NAT box using standard IP routing. When running an application or site on the corporate intranet, necessary or desirable services residing on the Internet therefore can not route data between components on the corporate intranet or aid in the execution of the application. Likewise, depending on the network configuration, the application being run on the corporate intranet may have problems initiating communications with sites on the Internet for needed services. Communication may be desirable for many reasons, such as to transmit results of an application to a local site, to resolve or obtain network addresses, to send or receive e-mails, to use remote databases or libraries, to call remote code or libraries for local execution, etc.","Virtual private networks (\u201cVPNs\u201d) can often take advantage of the principles of encapsulation to provide users on a remote network with secure access to another network. Encapsulation is the process of inserting the components of a first network protocol within the packets of a second network protocol. Unfortunately, traditional VPNs only provide for the allocation of a single network address. As such, a remote subnet cannot be established. Moreover, VPNs lack continuous connectivity properties; that is, VPN connections need to be re-established whenever, for example, an address parameter changes. As an illustration of this fact, in accessing a VPN through a cable modem, the VPN may need to be torn down and re-established when the IP address at the cable modem interface changes.","Accordingly, a need exists in the art to configure and allocate a remote network such that the remote network has access to necessary services and sites without being obscured by firewalls and other devices that hinder communication, and such that communications on the remote network can remain independent of underlying networks.","A system and method relocates network subnets. In one aspect, a local or \u201chome\u201d network is coupled to an anchor router. The anchor router is coupled via a link to a tether router. The tether router is coupled to a subnet. Either the subnet or link may be preconfigured or negotiated on demand. The link may in one aspect be secure, and may include one or more physical or virtual connections. In another aspect, a remote subnet is configured by lease wherein delegation of the subnet is performed on demand. A lease broker is contacted to obtain a leased subnet. The tether router and anchor router then connect via a link, which link is configured appropriate to the leased subnet. The lease broker mechanism may reside in separate or unrelated devices, or it may reside in the same device as the anchor router. In another aspect, the link is virtual and set up as a tunnel. The tunnel may include one or more physical links or virtual links. Multiple leases may occur in one or more operations. Similarly, multiple virtual encapsulation tunnels may be established with one tether router. In yet another aspect of the invention, a system and method is provided wherein a block of routable, contiguous addresses are allocated at a remote location and a tunnel is established between the addresses at the remote location and a local network. One or more services, or the appropriate routing, are then set up at each end of the tunnel to establish globally routable addresses and seamless access to services resident on the local network (e.g., a collection of related web sites on the Internet) and the remote subnet. In another aspect, a remote subnet and tunnel is established to traverse a NAT box, firewall, or other service-obfuscating device(s). Through the use of the remote subnet, \u201creal\u201d Internet service is thereby provided to components on a network otherwise obscured from direct communications with remote Internet sites. In another aspect, the configuration of the subnet is maintained, and the tunnel is adapted to re-establish its connection as a result of changing address parameters or other variables. In still another aspect, an apparatus is disclosed, such as a PC or portable computing device, which includes a tether router configured to connect to a remote subnet and a processor configured to establish a tunnel between the tether router and a remotely located anchor router. In yet another aspect, a remote subnet is established in part to isolate traffic on the remote subnet from unrelated or insecure traffic on an underlying remote network.","Other embodiments of the present invention will become readily apparent to those skilled in the art from the following detailed description, wherein it is shown and described only certain embodiments of the invention by way of illustration. As will be realized, the invention is capable of other and different embodiments and its several details are capable of modification in various other respects, all without departing from the spirit and scope of the present invention. Accordingly, the drawings and detailed description are to be regarded as illustrative in nature and not as restrictive.","The detailed description set forth below in connection with the appended drawings is intended as a description of various embodiments of the present invention and is not intended to represent the only embodiments in which the present invention may be practiced. Each embodiment described in this disclosure is provided merely as an example or illustration of the present invention, and should not necessarily be construed as preferred or advantageous over other embodiments. The detailed description includes specific details for the purpose of providing a thorough understanding of the present invention. However, it will be apparent to those skilled in the art that the present invention may be practiced without these specific details. In some instances, well-known structures and devices are shown in block diagram form in order to avoid obscuring the concepts of the present invention. Acronyms and other descriptive terminology may be used merely for convenience and clarity and are not intended to limit the scope of the invention. In addition, for the purposes of this disclosure, the term \u201ccoupled\u201d means \u201cconnected to\u201d and such connection can either be direct or, where appropriate in the context, can be indirect, e.g., through intervening or intermediary devices or other means.","The present invention provides a system, method and apparatus for making remote a network subnet, and for making remote a block of routable network addresses. While certain embodiments of the invention are described in the context of the Internet, the invention is generally applicable to all types of network environments. Through the principles of the present invention, a block of contiguous, routable addresses is allocated remotely to form a subnet. The subnet may comprise a series of connected nodes that comprise various resources and services. In one embodiment, each node on the subnet corresponds to one of the plurality of allocated addresses from the block. Where the Internet is involved, the resources and services in the subnet may be used to provide Internet services to a device on a network (such as a LAN, intranet, etc.) obscured by a firewall, NAT, or other mechanism that impairs global routability.","Seamless applications may be run in a remote location on the subnet. The subnet may attach to devices on a network such as a local area network, wide area network, or corporate or governmental intranet, during the course of which resources and service from the Internet may be directly accessed via the subnet. Using the principles of the present invention, web sites that are ordinarily local to the programmer may communicate with sites on the remote subnet\u2014and hence with a device coupled to the subnet or part of the subnet\u2014as if the subnet were local to those sites. In essence, an \u201cextension cord\u201d to those sites is established via the subnet. In one embodiment, the sites to which the programmer desires access are effectively reproduced at the programmer's remote location via the subnet, which is coupled to the sites by a link. The programmer may then run applications at a remote location and communicate with the sites, using the subnet, as if they were local to the remote network.","Through the use of the tunneling technique as described further herein, one embodiment of the present invention provides the ability of the remote subnet to traverse services on a network, such as a firewall, network address translation mechanism, or the like, and instead directly access services on the Internet. (The mechanism which hinders service may vary depending on the network configuration, and may be in software or in hardware.) In kind, applicable services on the Internet with the appropriate permissions may directly access the individual nodes on a network coupled to, or forming part of, the subnet (such as one or more devices on a corporate intranet), and thereby traverse an intervening firewall or other device that may otherwise prevent that communication from occurring.","\u201cSubnet relocation\u201d is a term for relocating network subnets to a location remote from the original network. A \u201cnetwork subnet\u201d or \u201csubnet\u201d can be a portion of a network. A \u201crelocated network subnet\u201d may act as an effective extension of the portion of the network to a remote (relocated) place. In essence, a relocated network subnet is configured such that it \u201cmirrors\u201d a first set of nodes of one network to a second set of nodes at a second network in a remote location. This mirroring capability and the flexibility and utility of the relocated network subnet are made possible, in part, through the allocation of a block of routable network addresses for use at the remote location. In an embodiment involving the Internet, these addresses may be known, static IP addresses. Such addresses may be used, among other purposes and depending on the configuration, to correspond to nodes on the relocated subnet.","In one embodiment, data traffic that is transmitted by some arbitrary node on an unrelated network and intended for a host device on the first set of nodes is forwarded to a corresponding host or location on the remote subnet. Similarly, data that is transmitted from a node on the remote subnet is forwarded to its corresponding device at the first set of nodes. The network subnet in this embodiment may be the collection of nodes at the first location, and the relocated network subnet may be the collection of nodes at the second, remote location. The relocated subnet of this embodiment effectively reproduces the set of nodes at the first location. In the context of the Internet, the remote subnet may use IP addresses that are fixed and globally routable. In general, any appropriately configured device on the Internet may be able to communicate with a node on the remote subnet. In configuring a remote subnet in the context of the Internet, among other things, a DNS server may be used to associate the fixed IP addresses with the domain of the subnet.",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 1","b":["10","20","10","98","10","98","50","98","20","40","30","50","50","50","30","30","30","20","40","30"]},"Tether Router","The function of the tether router  in the most basic embodiment is to route data to and from the relocated subnet  via the link . Tether router  may be composed of a single device, or of a plurality of devices, depending on the implementation. Tether router  may transmit data  from subnet  that is addressed to non-subnet locations back to anchor router  over link . This function is illustrated in . Data  comes from a device in subnet  and is routed through tether router  over link  and through anchor router  to its destination.","Tether router  may also transmit data  received on link  and addressed to a location in subnet . This function is shown in . Further, tether router  may provide any number of other services local to subnet , as conceptually illustrated in  by lines . Such services might include, for example, a DHCP (\u201cDynamic Host Configuration Protocol\u201d) server , a DNS (\u201cDomain Name Service\u201d) server , and other services (not shown) such as a web cache, a file server, an SMTP (\u201cSimple Mail Transfer Protocol\u201d) server, etc. These services need not reside directly on tether router , but may be accessible by tether router . Tether router  may enable configuration of the services  or it may enhance remote operations by routing necessary services from the network  via anchor router  and link  to subnet . Tether router  may assist in enabling configuration of the link  or in routing of data between tether router  and anchor router .","As shown in , a block of routable network addresses are allocated to the remote subnet , as illustrated conceptually by arrow . The network addresses in this embodiment may be placed in the routing table of the tether router; however, other means may be used to store the allocated block of network addresses. In this embodiment, the network addresses, or a portion thereof, may be used to correspond or \u201cmap\u201d to the collection of nodes . Depending on the configuration, certain network addresses of the allocated block may be used for other purposes, such as for identifying services coupled directly or indirectly to tether router , for identifying virtual devices for configuration purposes. Not all IP addresses in the allocated block need by actually used. Tether router  may be composed of more than one router, and more than one routing table may be used to store the network addresses. Further, in certain embodiments, the routing functionality of the tether router  may be performed exclusively in hardware or software, or a combination thereof. In an embodiment involving the Internet, the block of addresses may be static IP addresses, such as a block assigned or leased by a company to a user for the purpose of establishing a remote subnet (see below). One or more DNS servers may be set up, such as one connected to anchor router , to enable forward lookups of these addresses. (One ore more DNS servers may also be coupled to the tether router at the remote location). The operation of the tether router and the utilities of the configurations shown in  are discussed further below in connection with various embodiments.","Anchor Router","The function of the anchor router in the most basic embodiment is to route data to and from the network  via the link . The anchor router  effectively acts as the coordination entrypoint for subnet  to the rest of the network . As with tether router , anchor router  may consist of a single physical device, or a plurality of devices. Anchor router  may perform various functions. First, referring to , anchor router  may transmit data  from the rest of network  to tether router  over link . The data  may then be delivered to a service, site, or other address on subnet .","Referring to , anchor router  may also transmit data  received on link  to the rest of network . The data  may be addressed to any node on network , or to anchor router  itself.",{"@attributes":{"id":"p-0041","num":"0040"},"figref":"FIG. 7","b":["20","40","59","40","50"]},"Subnet Lease","In another embodiment, a subnet lease is performed. In other words, the delegation of the remote subnet is performed on demand. This embodiment adds a lease broker  to the system, as illustrated in . Subnet lease includes the following phases. First, tether router  contacts lease broker  to obtain a leased subnet. This communication is illustrated by line . Second, as shown in , tether router  and anchor router  thereupon connect via link , and are configured accordingly to establish new subnet . After this phase, services may be installed, or the minimum routing requirements for data to travel between the leased subnet and network  may be established. The mechanism for establishing a link (such as a tunnel) may be performed by the lease broker. The lease broker functionality may, but need not, reside on the same device or network as the anchor routing mechanism. In one embodiment, a block of addresses is leased by a lease broker such as a company with appropriate network equipment. The company may be in the business of leasing or allocating such addresses. Separate from the lease broker, a link (such as a tunnel) is then configured between the subnet comprising the block of addresses (or a portion thereof) and the anchor router coupled to the network from which direct communication is desired. The lease broker  is shown in this example as being connected to network ; however, lease broker  need not be configured in this manner.","A single tether may rent blocks of addresses from multiple lease brokers to establish connections with multiple anchor routers. Alternatively, a tether router may rent several blocks from a single lease broker to establish a plurality of remote subnets. In other embodiments, multiple subnets may be leased in a single operation. Further, a single tether router according to one embodiment may rent blocks of addresses that correspond to multiple anchor routers. Networks running non-conflicting protocols can, in this illustration, be concurrently provided to a remote location. For example, a first network running an IPv4 protocol may be coupled to a first anchor and then to a tether via a first tunnel, and a second network running an IPv6 protocol may be coupled to a second anchor and then to the same tether via a second tunnel. Network communications can then be provided to the remote location using the resources and protocols of both networks.","Generally, the lease process encompasses certain parameters which may be negotiated between server and client. However, the specifics of tunnel establishment may vary widely depending on numerous factors. These design details are not necessary to the practice of the invention. Where a lease broker or rental site is involved, in general (a) the rental site and the client (such as a tether router) \u201cagree\u201d to the lease and (b) certain information is ultimately passed to the server (such as the anchor router) such that the server can configure its end of the tunnel. The client may negotiate certain parameters with the lease broker, including, for example (i) parameters regarding the block of addresses (such as the number of addresses), (ii) parameters concerning the services desired or necessary for the configuration (such as DNS or DHCP services, etc.), and (iii) parameters pertaining to the tunnel (such as any keys for encryption or any NONCE (nonsense random string) to commence the handshake procedure).","The handshake may in various embodiments take place over a secure channel. In one embodiment, TCP\/SSL is used. The use of such protocols may, but need not, involve the client authenticating itself via a certificate or otherwise. A password may be used in certain embodiments to authorize the lease. Likewise, the server may, but need not, authenticate itself, such as through the use of a certificate as is known in the art.","After negotiating the parameters with the lease broker, the lease broker may communicate these parameters to the anchor site. These communications may take place over a secure channel. Additionally, as noted elsewhere in this specification, the lease broker may itself be a part of the anchor site, in which case the information need not be communicated. Instead, the anchor is simply triggered to commence its procedures (e.g., in software). After these steps are accomplished, tunnel setup is established in embodiments where the link is composed of a tunnel. Tunnel setup according to certain exemplary embodiments is discussed further below.","Tunnel Setup","If link  in  is virtual, the link is a tunnel between anchor router  and tether router . A tunnel provides encapsulated data transfer over an existing communication path. In particular, a tunnel is a virtual path that enables one network to send its data via another network's connections. Tunneling works by encapsulating a network protocol within packets carried by the second network. An example of tunneling is Microsoft's PPTP technology which enables organizations to use the Internet to transmit data across a virtual private network. It performs this task by embedding its own network protocol within the TCP\/IP packets carried by the Internet. For the purposes of this disclosure, a tunnel may include one or more physical links. Likewise, one or more virtual encapsulation tunnels may connect to an anchor or tether. The particulars regarding the number of tunnels depend on various factors and are typically network and configuration specific.","A tunnel suitable for subnet relocation does not require knowledge of any client endpoint information. For example, where the tether router  is considered to be the client, the tether router may reside behind a NAT device. In this example, tether router  would be inaccessible as an IP address, as would the subnet nodes to which tether router  may be coupled.","In one embodiment, a tunnel suitable for subnet relocation may include a heartbeat and automatic reconnect mechanism. In the latter embodiment, where the link is somehow corrupted or interrupted, the link can self re-establish. The tunnel is then configured to maintain its connection between the anchor router and tether router in spite of events that may temporarily produce a connectivity glitch, such as where electrical interference occurs or where an address parameter changes.","A tunnel need not be restricted to any particular protocol, and tunnels of all types of protocols with a variety of parameters are matters of design choice that do not depart from the scope of the present invention. While certain protocols may be advantageous for certain configurations or infrastructures, any suitable encapsulation protocol can be used for the tunnel. Exemplary protocols include, for example, IP, UDP, TCP, PPP, PPoE, GRE, PPTP, and others. Further, the tunnel may optionally incorporate various types of encryption protocols, such as IPsec of IP, a custom protocol, etc. As noted above, a tunnel may include one or more physical links or virtual links. Further, the tether router may be connected to a plurality of encapsulation tunnels, each of which may be connected to either the same or a different anchor router.","By establishing one or more tunnels and remote subnets, a programmer can isolate secure traffic running on the remote subnets from an underlying network that may carry unrelated or insecure traffic. For instance, where a user is at a hotel, the user may connect a tether router box to the hotel's network. Thereupon, the user may establish a tunnel back to an anchor router to enable secure communications from desired sites. The tunnel in this embodiment effectively uses the hotel's underlying physical network while isolating the traffic transmitted by or addressed to the remote subnet(s) from, e.g., access by the hotel or other individuals using the hotel's network who may not be authorized to access that traffic. The user may then connect the tether box through an Ethernet or other port to one or more remote devices, such as PCs, etc., for communication with the anchor sites via the tunnel(s). As noted elsewhere in this specification, in one embodiment the tunnels used are secure connections, such as by using IPsec, UDP-level encryption, or any appropriate encryption technique.","Tunnel setup algorithms may vary widely. A tunnel setup algorithm according to an exemplary embodiment is depicted in flow chart form in . In this embodiment, UDP is chosen as the protocol to transmit packets over IP due to UDP's effectiveness at traversing NAT and similar devices.","The tunnel setup process may, as in this embodiment, commence with a request by the client to a server to set up a tunnel. In this example, at step  in , a client (such as tether router ) informs the server (such as anchor router ) to set up a tunnel over a secure channel using Secure Sockets Layer (SSL) and a pre-shared secret (i.e., X.509 keys) (step ). The client hands the server a NONCE (nonsense random string), a key to authenticate itself to the server, and a pair of keys used to secure the tunnel (step ). The client also chooses two ports for communication (one for the client and one for the server) (step ). The server could challenge its port, and provide an alternative port. Notably, these steps can be performed in myriad ways depending on the methodology chosen. For example, issues pertaining to which entity chooses which ports, the use of the specific encryption technology or the choice or use of keys and the method of identifying the entities are all matters of design choice that do not depart from the scope of the present invention.","Thereupon, the client commences its half of the tunnel (step ). In particular, the client sends in the encapsulated dummy traffic (e.g., ping packets) over that tunnel containing the NONCE originally transmitted to the server (step ). The client thereupon waits for a REPLY signal from the server (step ).","Meanwhile, the server performs steps to commence its half of the tunnel (step ). The server is listening on the chosen port and decapsulates received packets (step ). As the server decapsulates received packets, it checks their NONCE (step ). When it finds a packet with a NONCE corresponding to the NONCE submitted in step , the server checks the IP address and source port information contained within that packet. Using this method, the server learns the apparent IP address and source port of the packet sent by the client (step ). Notably, the IP address and source port information is labeled \u201capparent\u201d because a NAT device or other service-obfuscating mechanism may alter both pieces of information. The server sends a REPLY signal to that address and port (step ). The server then waits for a REPLY ACK signal from the client.","Referring next to , the client receives the REPLY sent by the server and begins using its portion of the tunnel for data transfer (step ). Specifically, after the client receives the REPLY (step ), the client terminates its generation of dummy traffic from step and sends a REPLY ACK to the server (step ). The client then begins transferring data over the tunnel (step ).","The server receives the REPLY ACK from the client (step ). At that point, a tunnel is established and the server can start receiving and transmitting data to and from the client over the tunnel (step ).","Tunnel setup may be as simple as follows: In one scenario, the server listens on a particular port and waits for a NONCE from any address. The client transmits the NONCE to the server (The packet's outer address may change en-route, e.g., if a NAT is present in the path). When the server receives the NONCE, it concludes that this is the correct address for the client. At this point, after appropriate handshaking, communications over the tunnel may commence.","Regardless of the specific methodology of tunnel setup, a connection is established between the anchor and tether. The nature of that connection (whether it is secure, etc.) can be dictated by the needs of the application and the network configuration. Because a tunnel is established directly between the server (anchor router) and client (tether router) in the embodiment above, any NAT or other device obscuring network service or otherwise hiding IP address is traversed, and full routability exists between the two devices over the tunnel. Thus, a device on the subnet and\/or coupled to the tether router can directly route data to and from a device on the network coupled to the anchor router. In one embodiment, each node that is part of the subnet coupled to the tether router corresponds to a unique IP address, and the subnet corresponds to a block (or portion of the block) of contiguous, fixed, IP addresses that are globally routable. (The subnet may also use certain addresses of the block for other purposes such as configuration.)","Notably, although the anchor and tether routers correspond to the server and client, respectively, in the example above, the anchor router need not be one device. For example, the anchor router may include a plurality of routers and\/or computers, etc., and the tether router may include a plurality of routers and\/or computers, etc., each for routing packets, performing services, and the like.","The lease broker  described in  on one hand, and the mechanism that configures the tunnel on the other, need not be one in the same. The functionality to set up the tunnel may reside in a separate box which may incorporate the tether router. In one embodiment, the tether router is compact and portable. The tether router may also exist as a stand-alone computer or PC. The lease broker  may, for example, be a company with a service on the Internet to rent blocks of fixed IP addresses. In such a case, an individual with a tether router box can rent a block of addresses, and then use the box to establish a private tunnel that enables the routing of information to and from the block of address back to the anchor router, i.e., the portion of the original network where communications otherwise would have been directed. The block of addresses essentially acts as an extension cord. For example, if an individual maintains a web site on a network in Kansas City, and she wishes to perform a demonstration in Hawaii on a private corporate intranet where the demonstration requires the use of services resident on the Kansas City web site, the individual can rent a block of IP addresses (from the corporation or an independent lease broker) in Hawaii, assign certain of the IP addresses to devices in Hawaii, and set up a private tunnel between the local IP addresses and the network in Kansas City. In so doing, the individual can run the presentation on the intranet in Hawaii and transparently obtain the services from her web site via the private tunnel and connected subnet. In addition, if third parties send information (e.g., e-mail) to the web site, the information can be transparently redirected to the remote location in Hawaii via the private tunnel.",{"@attributes":{"id":"p-0062","num":"0061"},"figref":["FIG. 11","FIG. 11"],"b":["80","80"]},"In this example, the remote subnet  provides a set of hosts behind a NAT box. The subnet  and included hosts have a \u201creal\u201d Internet connection with \u201creal\u201d Internet host addresses. All externally-bound traffic on the subnet  is sent via the tether router  through a tunnel  to the anchor router . Traffic from anchor router  is thereby delivered to the Internet  through router . In this embodiment, a UDP protocol is used to transmit packets from tether router  to anchor router , because the UDP protocol typically enables traversal of the NAT box . It should be noted that the use of UDP is a matter of design choice and other protocols for tunnel  may be used without departing from the scope of the invention. Anchor router  may advertise to other networks that it is the default router for communications to be transmitted to nodes on subnet . Accordingly, all packets destined for subnet  and originating from the Internet  are routed to anchor router . There, the packets are properly encapsulated and possibly encrypted or authenticated (as desired) into UDP\/IP format and transmitted over tunnel  to tether router , which properly decapsulates and decrypts or authenticates them (as needed) e.g., into TCP\/IP, for transmission to the designated node(s) on subnet . It should be noted that router  must not have an alias in the leased block, e.g., 192.0.2.0\/24, or the router  will not route packets to anchor router . This is because the nodes on the subnet  have the same alias. Anchor router  represents the point of contact between the Internet  and subnet , and also corresponds to the server-side of the tunnel.","While the number of ports and type of network interface on tether router  are largely a matter of design choice, in one embodiment, port  on tether router is a wide area network (\u201cWAN\u201d) interface-based port, and port  is a local area network interface port such as an Ethernet port, etc. The tunnel  in this embodiment comprises a virtual connection between tether router  and anchor router .","Assuming that subnet  has a domain name entitled example.net, then DNS server  is configured to serve the example.net domain. Thus, nodes on the Internet that are configured to commence communications with a node on subnet  can perform a forward lookup on DNS server  to ascertain that node's IP address.","Exemplary Subnet Configuration","Following is an exemplary configuration of a remote subnet, configured using Unix\u2122 network-based commands. It should be understood that the operating system, network-specific details, etc., may all vary widely and are not necessary to the practice of the invention. The example given includes a series of examples of code that may be used to configure the server-side (anchor router ) and tunnel .","In this example, a block of IP addresses are leased to the client from 192.0.2.0 through 192.0.2.255. A description of the assignment of IP addresses in this embodiment is as follows:","192.0.2.0\/24\u2014rented block","10.0.0.6\u2014tether router's interface IP address on the WAN (the address it \u201cthinks\u201d it is using)","172.16.0.55\u2014tether router's packets appear to be sourced from","192.168.0.33\u2014anchor router's IP address","It is presumed that IP addresses 192.0.2.0\/24, 172.16.0.55, and 192.168.0.33 are visible on and routable from the entire Internet. A portion of the allocated addresses are assigned to various resources and services, and UDP ports for the tunnel are identified:","192.0.2.1\u2014tether router's allocated IP address","192.0.2.2\u2014IP address of tether router side of the tunnel","192.0.2.3\u2014IP address of anchor router side of the tunnel","192.0.2.4\u2014virtual IP address of tether router side of the tunnel","192.0.2.5\u2014virtual IP address of anchor router side of the tunnel","2882\u2014tether port of the tunnel","2883\u2014anchor port of the tunnel","As is evident from this illustration, the fact that a block of addresses is allocated for use in a relocated network subnet does not require that all such addresses be actually assigned for use. Further, certain IP addresses of the block may be assigned to virtual devices, such as for the purpose of tunnel configuration or for other reasons. Depending on the subnet configuration and objectives for a given embodiment, these additional assignments of virtual addresses may or may not be performed.","Thereupon, a tunnel interface is set up, and configured appropriately, such as with the following commands:","# make a tunnel device with the appropriate wrappers","ifconfig ng0 192.0.2.2 192.0.2.3 netmask 255.255.255.0","udp_tunnel ng0 10.0.0.6:2882 192.168.0.33:2883","Generally, the \u201cifconfig\u201d command allows the operating system to set up network interfaces and allow the user to view information about the configured network interfaces. In this example, \u201cng0\u201d is a new interface on which tunneling software is being run. The \u201cudp_tunnel\u201d is a user-provided program that attaches to the interface (ng0) and uses the provided source (10.0.0.6) and destination (192.168.0.33) addresses, and provided source (2882) and destination (2883) UDP port numbers.","It may be necessary to traverse a firewall for the tunneled packets. Note that tunnel  effectively \u201cpunches a hole\u201d in the NAT box , or other device such as a firewall, for traffic destined for nodes on subnet . Exemplary code for performing this configuration may be as follows:","# Punch a hole in the firewall for tunneled packets.","# Allow tunneled packets out","ipfw add 400 allow udp from me 2882 to 192.168.0.33 2883","# Allow tunneled packets in","ipfw add 401 allow udp from 192.168.0.33 2883 to me 2882","The tunnel setup and subnet configuration may then be completed:","# everything goes into the tunnel except things to the anchor","# which goes over the pre-existing DEFAULT_ROUTE","route add default -interface ng0","route add 192.168.0.33 DEFAULT_ROUTE","# Start pinging the server.","# $NONCE=the nonce","ping -p $NONCE 192.0.2.3","# when it succeeds . . .","# Create the IPIP tunnel inside the other tunnel","ifconfig gif0 192.0.2.4 192.0.2.5 netmask 255.255.255.0 tunnel 192.0.2.2 192.0.2.3","setkey . . . (configure IPsec on that tunnel if desired)","# Default route points to the IPIP tunnel","route delete default","route add default -interface gif0","In addition to the above steps, commands may be performed to configure protection for the subnet. Such commands may, for example, accomplish the following procedures: (i) enable the transmission of all packets, including those to the WAN ISP, over the tunnel; (ii) prevent MTU blackholes; (iii) drop transited packets and forward only leased addresses; and (iv) commence the transmission of keepalive packets. In addition, the interface on the LAN side may be configured, and services may be set up on the local side.","Hence, all packets destined for subnet  (example.net) are routed to the anchor router  and to the tunnel . In particular, all packets destined for IP address 192.0.2.0 through 192.0.2.255 are passed to the tunnel interface configured above.","The connections to the subnet  can be just as easily disabled. The operations above are simply \u201cundone\u201d in the reverse order. The tunnel  may then be brought down, and the subnet is removed from the routing table of the anchor router . The NAT box  is restored to its previous configuration.","In another embodiment of the invention, a computing apparatus includes one or more processors, a plurality of ports, and routing functionality to perform two principal functions: (i) tether router and (ii) tunnel setup. The apparatus may be a stand-alone computer or PC, or a portable box with the appropriate circuitry and power interface. The routing functionality may include a standard router as known in the art. The ports may be used to connect to a network or directly to devices such as a laptop computer or a PDA, etc. The tunnel setup may be performed by software running on the one or more processors. Alternatively, one processor may be dedicated or hardwired to perform tunnel setup functions, whether alone or in conjunction with additional circuitry.",{"@attributes":{"id":"p-0110","num":"0109"},"figref":"FIG. 12","b":["90","91","90","92","92","91","96","93","95","90","94","98","90","97","91","93","95","99","91","94","105","98","106","90"]},"As in the example above, a user in Hawaii may like to run a presentation over a corporate intranet. Various services needed by the user to run the presentation reside at Internet sites in Kansas City. The intranet is behind a NAT mechanism that allocates hidden IP addresses to nodes on the corporate intranet. The user thereupon contacts a lease broker in Hawaii to obtain a block of addresses. Upon receiving appropriate compensation, the lease broker allocates a block of fixed, contiguous, IP addresses to the user. The lease broker in this embodiment is an independent entity, unrelated to the corporation with the intranet. The user has a portable apparatus  which incorporates a tether router. Using an existing network connection point such as a DSL line, the user couples a port  on the apparatus to the DSL line, using intervening circuitry if required. In this example, the user also has a laptop computer containing the presentation. The computer is coupled to another port  on the apparatus. Thereupon, the tether router functionality of the apparatus is configured, either manually through control panel  or automatically by code executed on processor  (or both), to attach to the nodes which correspond to the IP addresses allocated by the lease broker. Thereupon, a remote subnet is established, with apparatus  acting as tether router  from . The tether router may also be coupled directly to devices on the corporate intranet or to one or more routers which directly access the intranet.","Independently, a tunnel is established between the tether router and a router in Kansas City coupled to the user's sites (i.e., the anchor router). In one embodiment, the portable apparatus  includes functionality for setting up the tunnel. The tunnel setup may be performed by code executed on processor  and stored in memory . The tunnel is established between the tether router (part of apparatus ) and the anchor router in Kansas City. (Alternatively, the tunnel may be configured via a computer connected to a port on a tether router  in .) At this point, the user can run the presentation with direct access to services located at the Austin sites. Communications to and from the sites are sent via the tunnel to the remote subnet, traversing the NAT associated with the intranet.","In an alternative embodiment, the tether router and tunnel setup functionality may be embodied in a stand-alone PC or other computer. The PC may use a web based configuration that enables a user to automatically connect to and configure the remote subnet. The PC may be optimized to include a DHCP server, DNS server, web cache, etc. Once the tether router and tunnel are set up, clients running a diversity of operating systems (such as Unix or Windows) can simply plug to the tether router and operate seamlessly in the subnet environment using a web-based interface.","Although particular embodiments of the invention have now been described, it is of course to be understood that the invention is applicable to a broad variety of other embodiments. In short, the invention is limited solely by the claims that now follow."],"GOVINT":[{},{}],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Aspects of the present invention are illustrated by way of example, and not by way of limitation, in the accompanying drawings, wherein:",{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":["FIG. 10A","FIG. 10"]},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 12"}]},"DETDESC":[{},{}]}
