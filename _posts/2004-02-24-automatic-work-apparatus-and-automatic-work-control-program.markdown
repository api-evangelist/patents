---
title: Automatic work apparatus and automatic work control program
abstract: The automatic work apparatus extracts the target image of which photos are taken by the left and right CCD cameras, specifies the spatial position of the target and executes an operation to the target by the arm. Two regions, the central region and the peripheral ones, allocated to the image taken by the CCD camera so that if the target image stays in the peripheral region of the image then the cameras are rotated to take the target image in the central portion and the position determining module determines the spatial position of the target and then tasks are done for the targets. The relative distance from the target is adjusted by transfer equipment. This invention is applicable to an automatic work apparatus that can operate a predetermined operation for moving target and an automatic operation control program to carry out such operation.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07403836&OS=07403836&RS=07403836
owner: Honda Motor Co., Ltd.
number: 07403836
owner_city: Tokyo
owner_country: JP
publication_date: 20040224
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","BRIEF SUMMARY OF INVENTION","DETAILED DESCRIPTION OF THE INVENTION"],"p":["The present invention relates to an automatic work apparatus and automatic work control program which are used or implemented in robots or automotive vehicles that have cameras to observe and detect the objects in mages.","Automatic work apparatuses are conventionally well-known in use of various automatic works for specific tasks, operations and services. For example, assembly shop robots assemble parts and weld robots carry out welding operation in the product manufacturing factories. In use of the conventional robotic apparatuses, people first teach the robots the particular operation such that the robots grasp the parts, which are conveyed in a line, in certain timing and put them into a predetermined position to be assembled. Then the robots repeat the motions or replay the behavior as the people have taught beforehand as described above.","However, these robots can consistently do the identically same motion as being previously taught and there is less flexibility of the line designing and part alternation or exchangeability in the production line. Due to the consistent robotic motion, additional and preparatory works as setting parts in a certain position or aligning them by an automatic aligner before the robotic operation starts. Moreover, it is difficult for the robot to grasp the parts which are moving in the conveying line and therefore a sequential operation is necessary such that the parts stop in the line and the robots grasp them for the next assemble motion. This results in rather long time assembly process.","Therefore highly autonomic automatic work apparatus that can observe and detect the objects (we call them as targets hereinafter) which are moving and can take actions for them for assembling or fabrication in a consistent timing matched to the motion of the targets.","On the other hand, various technologies have recently been developed in image processing and several technologies for acquisition and tracking have been disclosed. For example, there is a technology that measures the position of the target and track the motion of the target by using the image obtained monitoring camera that has a finish eye lens (see reference 1). There is a technical paper that reports a robot that traces the ball bouncing by a camera and detects the instantaneous position of the ball and hit it back to the ball player (see reference 2).","Reference 1:",{"@attributes":{"id":"p-0007","num":"0000"},"ul":{"@attributes":{"id":"ul0001","list-style":"none"},"li":["Published Japanese Patent Application: JP, 06-167564, A(1994)\n\nReference 2:\n","\u201cA Beach Ball Volley Playing Robot with a Human\u201d, the Robotics Society of Japan, No. 5, Vol. 18, pp 105-111 (2000)"]}},"For the case when a general stereoscopic camera that has two objection lens system is used for the position detection of the moving tart, the viewing angle is obtained only for 60 deg in horizontal direction even though the substantially uniform position precision of the image to be specified and detected. For such a narrow viewing angle, it is not possible to consistently keep grasping the target which moves in various directions or to continuously keep detecting and tracking of the position of the target. In order to assist the narrow viewing angle, a high-speed rotational mechanism to drive the camera to direct the target for continuous tracking is necessary. Furthermore, it is difficult to support the simultaneous detection and tracking of plural targets in a wide spatial range in its simple detecting and tracking system in each moment. For the case when a precise action against the moving target is necessary, the conventional detecting and tracking system is not sufficient.","On the other hand, since wide viewing angle is necessary to cover the monitoring in wide range view to follow the moving targets, a technology of stereoscopic application technology using fish eye lenses has been proposed for the purpose of obtaining such wide viewing angles. However, the peripheral sight views cannot provide a well-precise position due to the condensed images in the peripheral area obtained in the use of fisheye lens, which is a characteristic of the lens.","One of the various applications of the present invention is related to the problem described above. Addition to such application, the present invention has further advantages to provide an automatic work apparatus that supports the manufacturing operation.","The present invention provides a system realized by an apparatus and program controlling thereof so that the system features to construct an automatic work apparatus to work for the predetermined tasks by detecting and tracking the targets regarding the spatial position on the basis of the images obtained by plural observing camera devices that have lenses of non-central projection such as fisheye lenses, wherein the system comprises a rotational drive unit to change the direction of the observing camera devices, a target image extracting unit that extracts the image of the targets from the images taken by the observing camera device and a rotation controller that controls the rotational drive unit in accordance with the certainty obtained by the evaluation of the target position information in response to the target position that is specified in the images by the target image extracting unit.","In addition, the present invention features to construct an automatic work apparatus to operate predetermined tasks by detecting and tracking the targets regarding the spatial position on the basis of the images obtained by plural observing camera devices, each of which the observing camera devices has a lenses of non-central projection, wherein the system comprises a rotational drive unit to change the orientation of the observing camera devices, a target image extracting unit that extracts the image of the targets from the images taken by the observing camera devices, a position determining unit that determines the target position which is specified in the images by the target image extracting unit and a rotation controller that controls the rotational drive unit so that the targets are monitored on the central area of the images taken by the observing camera devices when the target of which position is specified by the target image extracting unit locates in the peripheral area of the images wherein the images taken by the observing systems are divided into such central area and peripheral area.","The function of the automatic work apparatus according to the present invention is carried out as follows. The image of the target is taken by the plural observing camera devices. The observing camera devices use lens systems that are non-central projection lenses such as normal projection fisheye lenses where the peripheral area has less precision in the spatial determination than the central area does. The observing camera devices of the present invention have less precision in the determination of the position. However the automatic work apparatus according to the present invention has reliable azimuthal information even the view is deformed in the fisheye image. Therefore when the position of the target is not precisely reproduced in the peripheral area of the image, the rotational drive controller quickly controls to drive and direct the observing camera device to the target even when the precise spatial position is not unknown, it is possible to quickly grasp the target in the central area of the image in the observing camera.","The automatic work apparatus has a carrier system to change the mutual distance between the target and the automatic work apparatus itself. In executing the operation, it is desired that the automatic work apparatus moves to adjust the relative position against the target and execute the predetermined operation on the basis of the spatial position of the target.","In this system construction, it is possible that the automatic work apparatus detects the target in spatial position in high precision and adjusts the relative position by the carrier system so that flexible and reliable tasks are done.","It is possible to design the target image extracting unit to have a capability to discriminate the color of the target in such a way that the system memorizes the possible reference color and detects only the image that corresponds to the reference color. In order to grasp the target, the image taken by the observing camera device is segregated into plural picture elements (pixels) and the connectivity over a certain amount of these picture elements in the image can be exploited where the picture elements which attributes to the connectivity are labeled by a single same ID. The group composed with plural picture elements that have the same ID is treated as a consistently single target.","In case when the target is globe shape, it is desired to execute the judgment whether the target is identically same as the target that has been previously grasped as explained in the following method. The target image extracting unit provides the information of the group of the picture elements which have the same ID. The numbers of the picture elements along the vertical direction and horizontal direction on the image taken by the observing camera device are counted, respectively. A computation is done in such a way that the counts of the picture elements are converted into the viewing angle using the reverse calculation for sagittal deformations of the fisheye lens. Then it is desirable that the judgment whether the group of the picture elements represent the target which is once grasped as a globe is done in accordance with the rate of the vertical viewing angle to the horizontal viewing angle.","In the case that the target has a globe shapes the rate of the vertical viewing angle to the horizontal viewing angle in a viewing angle mapping is close to unity. Therefore, it can be confirmed whether the target detected in this viewing angle mapping is identically same as that previously grasped. Since the viewing angle mapping is used instead of the picture elements on the picture taken by the observing camera device, it is possible to identify whether it is the original target when the image of the target is taken in the peripheral area of the observing camera device wherein the circle image projected by the globe is quite deformed. Moreover the filling rate, that is, the occupation rate of the group of the picture elements against the rectangular given by the vertical viewing angle and the horizontal viewing angle specified in the viewing angle mapping, can be evaluated and the result allows to discriminate the circle which has the rate in unity from the rectangular or the ring shape and correctly detect and the identify the target.","In defining the reference color, the color of the target in the image taken by the observing camera device is sampled and the sample data is allocated onto the color-difference gradation chart as Cr-Cb space, therefore it can be said the sampled color is plotted onto Cr-Cb space. The area expanding to the origin of the chart which indicates that the color is achromatic color is eliminated in the determination of such plot. By this definition, the intrinsic color of the target can be defined and used for the reference color for the identification in the detection since the luminance can be removed by using Cr-Cb chart and the data plotted on the area expanding to the origin of Cr-Cb chart is eliminated, where the achromatic color generated in the surface reflection of the target in the surrounding lights can be removed.","More preferably the automatic work apparatus is constructed as follows. Two observing camera devices are horizontally installed in the apparatus. The position determining unit comprises a distance computing module that determines the distance from the apparatus to the target using the position information of the target image on the images taken by these two observing camera devices, a horizontal position computing module that computes the horizontal position of the target in reference to the apparatus using the position information of the target image on the images taken by these two observing camera devices and a vertical position computing module that computes the vertical position of the target in reference to the apparatus using the position information of the target image on the images taken by these two observing camera devices. The control of the units and data process for this apparatus is done as follows. The every image taken by the two observing camera devices for each moment of sampling to track the target is first evaluated whether it locates in the three categories of areas as a left and right peripheral area, an upper and lower peripheral area and a central area. Once target position evaluating module judges the target locates in the left or right peripheral area, then the position evaluating module accesses the rotation controller that controls the rotational drive unit to rotate the observing camera devices in the horizontal direction. Once target position evaluating module judges the target locates in the upper or lower peripheral area, then the position evaluating module accesses the rotation controller that controls the rotational drive unit to rotate the observing camera devices in the vertical direction and a position determining operation starts as follows. The horizontal position computing module computes the horizontal position of the target in reference to the apparatus and the distance computing module computes the distance from the apparatus to the target and then the horizontal position of the target is specified in the horizontal plane. The finish process is done with the information of the target in the central area of the image taken by the observing camera devices in a manner that the distance to the target obtained by the distance computation module, the horizontal position of the target obtained by the horizontal position computing module and the vertical position obtained by the vertical position computing module are used to specify the position of the target on the horizontal plane and in the space. Then a predetermined operation starts to be carried out after adjusting the relative position between the target and the automatic work apparatus.","In these sequences of controlling the direction of the observing camera device as explained above, it is possible to specify the spatial position of the target in every instance of image sampling. The horizontal setting such that two observing camera devices aligned in the horizontal plane has a problem, that is, the sight difference to specify the vertical position is not sufficient when the target is in the upper or the lower peripheral area. However the control such that horizontal rotation of the observing camera devices takes the first action solves the vertical position determination. It is explained in details as follows.","Therefore the vertical position (in Z axis position) of the target is less certain for the configuration of observing camera device that has two camera sets in the left and the right hand sides. However, the horizontal position (in Y axis) and the distance to the target are certain. Therefore it is possible to specify the position of the target in the horizontal plane (X-Y plane) even the image of the target locates in the upper or lower peripheral area. When the target is in the central area, it is possible to obtain sufficient precision in the determination of the target position in high precision in X, Y and Z. The position information of X, Y and Z axis can be used for the purpose of the system. The predetermined job is carried out by adjusting the mutual distance between the target and the automatic work apparatus with the carrier on the basis of the location in the horizontal plane and the position in the space.","The rotation of the observing camera device may be performed when the target locates in the left and right peripheral area of the images as well as in the upper and below peripheral area.","The automatic work control program according to the present invention features that functions, in order to control an automatic work apparatus that comprises plural observing camera devices that have lenses of non-central projection such as fisheye lenses and to change the direction of the observing camera device and that carries out the jobs onto the target of which image is detected by these plural observing cameras, a computer in a manner such that the computer discriminates the certainty of the positional information regarding the target in response to the position of the target specified in the images by the target image extracting unit and controls the rotation of the rotational drive unit that controls the rotational drive unit in accordance with the certainty obtained by the evaluation of the target position information in response to the target position that is specified in the images by the target image extracting unit.","The automatic work control program according to the present invention features that functions, in order to control an automatic work apparatus that comprises plural observing camera devices that have lenses of non-central projection such as fisheye lenses and to change the direction of the observing camera device and that carries out the tasks onto the target of which image is detected by these plural observing camera, a computer in a manner such that the computer works for a target image extracting unit that extracts the image of the targets from the images taken by the observing camera device, a position evaluation means to obtain the target spatial position information in response to the target position that is specified in the images by the target image extracting unit and a rotation controller means that changes the observing camera device by the rotational drive unit so that the target of which position is specified in the images by the target image extracting unit is in the peripheral portion of the image obtained by the image taken by the observing camera device is viewed in the center of the image, wherein the image is separated into peripheral portion and the central portion of the images taken by the observing camera device.","The apparatus and the computer program that control thereof are applied to ball playing, handling materials in the assembly line, steering, slowing down accelerating operation of the vehicles. Since it is necessary to detect the target and take the action for the target such as the moving ball, the material in the assembly line and the vehicles running in parallel or coming from the foreside in these applications, the present invention can be preferably applied.","We will discuss the embodiments of the present invention using the drawings as follows.","First of all, we will explain an example of the operation of the automatic work apparatus that is a human shaped robot, wherein a balloon playing is carried out.","The  shows an outlook of a human shape robot. As seen in , the robot R has two leg portions R, an upper body R, arm portions R, a head portion R and stands and automatically walks. The robot R carries a controller housing portion R that controls the leg portions R, the upper body R, arm portions R and the head portion R. The head portion R has CCD cameras (see  and ).",{"@attributes":{"id":"p-0046","num":"0046"},"figref":["FIG. 2","FIG. 2"]},"As shown in , the robot R has left and right legs R and has six joints R(L) to R(L). The twelve joints consist of a pair of hip joints R and L that (R denotes the right hand side and L does the left hand side) rotate the leg portions, a pair of hip pitch axes (Y axis) joints R and L, a pair of hip roll axes (X axis) joints R and L, a pair of knee pitch axes (Y axis) joints R and L, a pair of ankle axes (Y axis) joints R and L and a pair of ankle roll axes (X axis) joints R and L. Two foot portions R and L are attached to the leg portions R.","The leg portions R have hip joints R(L), R(L) and R(L), knee joints R(L), ankle joints R(L) and R(L). The hip joints R(L)-R(L) and knee joints R(L) are linked with R and L and the hip joints R(L) and the foot joints R(L) and R(L) are linked with crus links R and L.","The leg portions R are linked with the upper body R by hip joints R(L) to  R(L).  shows the linkage of the leg portions R and the upper boy R with an upper body link  in a simple presentation. The arm portion R and the head portion R are linked to the upper body R and the joint  is attached to rotate the upper body R. The leg portions R and the control unit that controls thereof function as a transfer equipment by which the relative position between the target and the robot can be adjusted.","The arms R consist of a pair of shoulder pitch axes (Y axis) joints R and L, a pair of shoulder roll axes joints (X axis) R and L, shoulder joints R and L (around the gravity axis) to rotate the arm R, elbow joints R and  L around the elbow pitch axis (Y axis), arm joints R and L around gravity axis (Z axis) to rotate the wrist, wrist joints R and L around the wrist pitch axis (Y axis) and the joints R and L around the wrist roll axis (X axis). Hands R and L are attached to the end to the wrists.","In this configuration, the arm portions R have shoulder joints R(L), R(L) and R(L), an elbow joint R(L), an arm joint R(L) and a wrist joints R(L). The shoulder joints  to R(L) and the elbow joint R(L) are linked by an over arm R(L) and the elbow joint R(L) and the wrist joint R(L) are linked by the underarm (L).","For the clarification of the drawing, the right arm portion R is rotated in 90 degrees at the knee joint R.","The head potion R has a neck joint  that changes the tilt angle of the head R and another neck joint  to change the pan. The head portion has fisheye lenses and CCD cameras  that have the fisheye lenses placed in the left hand side and the right hand side. The CCD camera  can observe 180 degree views in front of the head R in the horizontal plane. It is possible to rotate the CCD cameras  to change the direction the viewing angle by the neck joints  and . In other words, CCD cameras  works as the observing cameras by which the target images are taken and the neck joints  and  correspond to the observing camera rotating device.","In this configuration, the leg portion R has 12 degrees of freedom and allows the arbitral walking action in three dimensional space in a consolidated walking motion by moving 12 joints (6 axes\u00d72, where \u201c\u00d7\u201d denotes a multiplication). The arm portions R have 7 degrees of freedom for each of the left and the right arms. By driving these joints in appropriate angles, it is possible to carry out the predetermined jobs.","As shown in , the foot portion R(L) under the ankle has 6-axisforce sensors  and the repulsion for three directions Fx, Fy and Fz and the moments Mx, My and Mz are detected thereby.","The similar 6-axisforce sensor  between the wrist joints and hands R and L are attached, the forces besides those applied against robot body especially the repulsion forces received by the operation target are detected as Fx, Fy and Fz and the moments Mx, My and Mz.","A tilt sensor  is built in the upper body R, the tilt angle against the gravity force direction and the moment velocity are detected. The electric motor of the every joint has a gear set (not shown in the figure) to slow down the speed or enhance the driving force by which the femur link R(L) and crus link R (L) are mutually driven. The rotation is detected and measured by a rotary encoder (not shown in the figure).","The controller housing portion R stores a controller unit  to which the image data of the images taken by the CCD cameras  and the output data of the sensors (the data flows in the right side of the robot R is only shown for clarification) are sent. Each electric motor is driven by the driving control signal sent by the control unit .","The construction of the robot R will be explained in reference to  which is a block diagram of the robot R. As shown in , the robot R has a central controlling capability realized by the control unit  which is the controller housing portion R. The sensors attached to various portions of the robot R send the sensor signals to the control unit . The control unit  determines the action of the robot on the basis of the detected signal values and computes the driving control value for each joint to be driven.","The control unit  is a computer system that has a central process unit (CPU), memory devices  and input and output interfaces (I\/F) . The computer system processes the input information under the program stored in the memory device  and executes the function as described as follows.","The leg portions R have the joints R(L) to R(L) and 6-axisforce sensors . The detected signals by the 6-axis force sensors are input to the control unit  and the joints R(L) to R(L) are driven by the control unit .","The upper body R has the joint  as described above, the tilt sensor  and the battery . The electric power of the battery  is supplied to each joint through the control unit . The detected signal of the tilt sensor  is input to the control unit  and the joint  is driven by the control unit .","The arm portions R have the joints R(L) to R(L) as described above, the hand R(L), 6-axis force sensors . The detected signals of the 6-axis force sensors  are input to the control unit  and the joints R(L) to R(L) and the hand R(L) are driven by the control unit .","The head portion R has CCD cameras  as sensors and a gyro sensor  in addition to the neck joints  and  as described above.","According to the information of these sensors, the robot R can grasp the position in the three dimensional space. Therefore, in robot R, coordinates of the image are linked to three-dimensional coordinates that the robot R has. Therefore, the position in the image of the image taken by the CCD cameras and the 3D position of the robot R is linked together. The walking action control of the robot is realized by the publicized technology that the present application filed in JP, 10-217161, A (1998).",{"@attributes":{"id":"p-0066","num":"0066"},"figref":"FIG. 4","b":["100","100","100"],"i":["a ","b"]},"The image processing computer has a frame grabber  to acquire the images of the motion image and the graphic CPU and a communication board and all of these are connected to a bus line BL.","The action control computer has a communication board and the control CPU and these are connected to a bus line BL.","The CCD cameras  are the right CCD camera R and the left CCD camera L and these connected to the frame grabber . The frame grabber  acquires the images taken by the right CCD camera R and the left CCD camera L and hands the image data over to the graphic CPU . The image data processed by the graphic CPU are sent to the action control computer through communication board  and the optical cable .","The image data processed by the graphic CPU is input to the action control computer through the communication board . The control CPU determines the action such as moving and hitting a balloon BL based on the image data processed by the graphic CPU and drives the electric motors of the joints , , etc. through the servo amplifiers  etc.",{"@attributes":{"id":"p-0071","num":"0071"},"figref":"FIG. 5"},"As shown in , the control unit  of the robot R has an image processing engine  that discriminates the position of the target of which image is taken by the CCD cameras R and L, a main control engine  that determines the action plan on the basis of the position of the target determined by the image processing engine , a carrier controller  that actually controls the leg portions R and an action controller  that controls the movement of the upper body R and arm portions R and a head controller  that controls the movement of the head portion R.","The image processing engine  has an image input unit , a target image extracting unit , a distance computing module , a horizontal position computing module , a vertical position computing module  and a target area discriminating module . The position determining unit consists of a distance computing module , a horizontal position computing module  and a vertical position computing module .","The image processing in this embodiment will be explained as follows.  is a flow chart that shows the image processing carried out in the image processing engine . On the left hand side and the right hand side of the flow chart, the left side image and the right side image which are to be processed and in processing are shown, respectively.","As shown in , the left side image and the right side image S are taken by the right CCD camera R and the left CCD camera L, respectively. The left image L and the right image R have an image of balloon BL in the central area and the background view is taken around the balloon BL. The background view is the inside of the room, there are three rows of (fluorescent) lights LT on the ceiling and there is a prism column PL in the left forward. Since the left image L and the right image R have a parallax, it is judged that the position of the balloon BL is slightly in the right area in comparison to the positions of the balloon BL seen in the left and the right images.","By extracting the picture elements included in the reference color in the color-difference gradation chart as Cr-Cb space, the target area is discriminated (S). The picture elements which are in a single connectivity are detected and the labeling (called labeling process) S is done for each block of the connectivity. Next a shape determination is carried out against the picture elements which are labeled by the same label to determine whether it is the shape of balloon BL and the balloon BL which is the target of the work is specified (S). In the final step, the three dimensional position of the balloon BL is computed by the positions in the right image and the left image (S).","The image input unit  in  corresponds to the frame grabber  which acquires the moving images taken by the right CCD camera R and the left CCD camera L in a unit of frame image. The image input unit  sends the frame image to the target image extracting unit .","The target image extracting unit  extracts the image of the balloon BL which is the target of the work from the output images from the image input unit . In this embodiment, in order to specify the balloon BL on the basis of the color of the balloon BL, the color is memorized before the target area discrimination.","(Memory of Color)","The following is to describe the method to memorize the color of the balloon BL which is the target.","To begin with, the CCD cameras  are rotated to take the view of the balloon BL at the central area of the viewing image as shown in . The image of the balloon BL is sampled by a rectangle S so as to include only the image of the balloon area in the sample and to completely exclude the areas other than balloon area. The system of the controller unit  fundamentally manages the area and the shape of the rectangles and the position of the rectangles in the viewing image so that the robot R detects the balloon BL in high-speed and specifies it in details.  shows the sampled color regions Cof the balloon BL is given by the color information that is plotted in the Cr-Cb space by sampling each picture element obtained in YCrCb space.  shows an example when the color of the balloon BL is blue. According to the characteristics of Cr-Cb space, the region close to the origin is achromatic region or less chromatic one. The image taken by the CCD cameras  becomes less chromatic when the picture elements are brighter and therefore the portion of the balloon surface on which the lights LT reflects becomes less chromatic and the color of such image of the balloon BL is plotted in the region close to the origin (Cas shown in ). Therefore the region Cthat extends to the origin corresponds to the picture elements that show the portion of balloon surface on which the light reflects and the region Cshould not be adopted as the reference color of the balloon BL which is the operation target. If the reference color region is set with including Cregion, a huge amount of noises which, being close to the region Cin the image frame, have the colors irrelevant to the balloon BL is detected in the automatic work. The color of the balloon BL changes in accordance with the location in relation to the light LT. Moreover, the balloon BL is translucent and the detected color includes the targets beyond the balloon BL and therefore the reference color should be wider in some extent to the region not in the achromatic region. Therefore, as shown in , the reference color region of the balloon (C) is defined in such a way that the achromatic region is excluded and the wider region in the directions other than the direction to the Cregion and memorized the color distribution in such a region as the color of the balloon BL.","In addition, the reference color region Cof the balloon BL is optimally set and memorized in the system of the controller unit  so that the robot R can detect the balloon BL in high-speed and specifies the balloon BL in details in response to the change of the sampled color region of the balloon (C) and the change of light conditions of the operation space. The color of the target which is memorized beforehand is not only a single color but various colors so that the robot R can automatically play with plural balloons.","(Target Area Discrimination)","As shown in the step S in , when the target area discrimination is carried out, the picture elements which have the same color as that in the reference color region of the balloon C(which is called \u201cthe reference balloon color\u201d or \u201creference color\u201d which is used for more general expression) are only discriminated.  shows an example where the picture elements of the reference balloon color are extracted. As shown in , a substantial circle shape of the balloon BL is discriminated but the image of the balloon surface on which the light LT is reflected (corresponding to Cin the Cr-Cb space) is lacking in that circle shape. The targets (the picture elements corresponding to the reference balloon color are seen on in the image) that have the same color as the reference color region of the balloon Ceven they are different from the balloon BL. Those picture elements are treated as noises.","(Labeling Process)","In the next process, the picture elements discriminated in accordance with the reference balloon color (in other words, the color of the target) which are mutually linked with to satisfy the connectivity are labeled with an identical label ID. An example of this process is that if a certain picture element has the color but the neighboring picture elements (in upper left, upper, upper right, left, right, left below, below and right below picture elements) do not have the color, then a new label ID is put to the picture element. If the certain picture element has the color and the neighboring eight picture elements have the color, then the same label ID assigned to the eight neighboring picture elements is put to the certain picture element as the label ID. If the certain picture element has the color and more than two of the neighboring eight picture elements have the color and if the labels ID put to the neighboring picture elements are mutually different, then an identical label ID is put onto both the certain picture element and all the neighboring picture elements.","This labeling process is concretely explained in reference to . The squares shown in  to  are the picture elements and the colored elements are indicated by shaded squares. The picture elements are aligned in a matrix form. The labeling is being done from the upper left. As shown in , a notable picture element (0, 0) only has the color and the neighboring picture elements (the upper and the left picture elements) do not have the color. Then the picture element is newly labeled.","As shown in , a notable picture element (0, 0) has the color and one of the picture elements as (\u22121, \u22121), (0, \u22121), (1, \u22121) locating upper adjacent to the notable picture element has the color and the left neighboring picture element does not have the color, then the ID label used for the picture element which has the color is attached to the notable picture element.","As shown in , anyone of the three upper picture elements as (\u22121, \u22121), (0, \u22121) and (1, \u22121) to the notable picture element (0, 0) does not have the color and the left neighbor (\u22121, 0) has the color and then the ID label used for the left neighboring picture element is labeled to the notable picture element.","As shown in , any one of the upper picture elements (\u22121, \u22121), (0, \u22121) and (1, \u22121) to the notable picture element and the left neighbor (\u22121, 0) have the color and the same label. Then the label ID is labeled to the notable picture element. As shown in , the notable picture element, the upper picture element (1, \u22121) and the left picture element (\u22121, 0) have the color and the label ID of the upper element and the label ID of the left element are different each other. The same label ID of the left picture element is always relabeled to the notable picture element and the upper picture element. The picture element which have the same label ID as the picture element (1, \u22121) has are all labeled with the same labels as the left neighboring label ID. In the process shown in this , the area of U-letter shape has the same label ID for each of the upper two branches. The picture elements which do not attribute any of the areas are labeled with the label value \u201c0\u201d","This process has been done over all picture elements, therefore the picture elements which are linked each other are labeled with an identical label as a single area.","(Shape Determination)","In the next step, the rough shape of the area which has an identical label is judged. By this process, the inappropriate area as a balloon BL is eliminated. Since the balloon BL has generally circular shape, the aspect rate as vertical viewing angle against the horizontal one and the occupation rate of the picture elements, having the color, in the minimum rectangular in which the area of the balloon BL is included are used for the determination.","Namely, the rate of the vertical viewing angle of the area which is labeled with the same label against the horizontal viewing angle is calculated. If the rate is the predetermined range close to 1 as for example 0.8 to 1.2, then it determined that the area is possibly the balloon BL. If the rate is not within the predetermined range, it is determined the area has no possibility to be the balloon BL and the label ID is eliminated. For example, if the area is vertically long ellipsoid as shown in , the rate of viewing angle is much larger than 1 and it is determined that the area is not balloon BL and the label ID is eliminated. It should be notified that the rate is given in the viewing angle and not the quantity of picture elements. When the photo of the balloon BL is taken into an image in the corner of the image frame, then it has a shape of an ellipsoid. However the aspect rate of the vertical\/horizontal viewing angle is determined to be close to unity.","The occupation rate of the quantity of the picture elements which have an identically same label ID against the rectangular in which the area is included is obtained. If this occupation rate is in a predetermined range as, for example, 0.68 to 0.88, then the area is determined as a balloon BL and is not in the predetermined range, then the area is not determined as the balloon BL. By using this process, the ellipsoid that has long axis declines 45 degrees as shown in  or the ring shape as shown in  with an aspect rate that is unity is eliminated as it is not the balloon BL the area and only the real balloon area is extracted.","The thresholds of the aspect ratio and the occupation ratio are appropriately set in response to the shape of target and the work space.","A distance computing module , a horizontal position computing module  and vertical position computing module  as shown in  are the modules to obtain the distance between the target and the CCD camera  (or Robot ), the horizontal position of the target seen by the CCD camera  and the vertical position. These modules works as the position determining unit.","(Computation of Target Position)","To begin with, the center position of the area of the balloon BL of which image is extracted is obtained. The center position is defined by the middle point of the upper edge the lower edge of the balloon area and the middle point of the left edge and the right edge. Next, the direction (called a central direction) to the balloon BL from the CCD camera  is determined by the central position of the balloon BL specified by these middle points. As shown in , the central direction is defined by the horizontal angle \u03b1 horizontally deviated from the optical axis MR for the right CCD camera R and the vertical deviation angle \u03b3 from the optical axis MR as the vector D. For the left CCD camera L, it is defined by the horizontally deviated angle \u03b1 from the optical axis ML and the vertical deviation angle \u03b3 as the vector D. The correspondence between the position of the picture elements on the image frame and the viewing angle from the optical axis of the CCD camera  are pre-stored in a table (called \u201ca calibration data\u201d).","In the automatic operation, the center position of the target area of which image is taken by the right CCD camera R and the left CCD cameral L and the position of the picture element is specified by the vector D and D in reference to the calibration data.","The center direction of the target is, as shown in , given by the vector D and D.","The position (P, P, P) of the target which is a balloon is obtained by the following equations;\n\n=(1 tan \u03b11\u22121\u22122 tan \u03b12+2)\/(tan \u03b11\u2212tan \u03b12)\u2003\u2003(1)\n\n=(1) tan \u03b11+1\u2003\u2003(2)\n\n=(1) tan 1\u2003\u2003(3)\n\nwhere, the definitions of the parameters are,\n\n","There are plural possible candidates (not be confined to be a single one) for the area of the balloon BL. When plural candidates of the areas for the balloon BL are extracted for the same color, the vectors for the central directions are computed for all of the areas for the viewing images in pairs for the left CCD camera and for the right CCD camera and the direct distances among the center positions of candidate areas are obtained. Then the combinations of the areas, wherein the direct distance is within a predetermined allowable range, are selected. For example, there are two candidates as RA and RB for the right viewing image and LA and LB for the left viewing image and the combinations as RA-LA, RA-LB, RB-LA and RB-LB are made. Then the direct distances from the left and right CCD cameras  to the candidate areas of the combinations are obtained. If the direct distances obtained above are resulted as 0.5 m, 0.01 m, 0.01 m and 0.5 m, respectively, then RA-LB and RB-LA are selected.","If the balloon BL is not specified to be a single one even by this process, it can be possible to restrict the aspect rate for shape determination which is close to a circular shape in order to determine a single balloon BL.","In this embodiment, the distance computing module , horizontal position computing module  and the vertical position computing module  realizes the above computation. However these modules can function to realize the other computation for the target position. For example, the extracted image of the balloon BL is corrected for deformation recovery. Then the arithmetic means are computed over the coordinates of all picture elements to obtain the center of gravity of the balloon BL. The center of gravity may be used as the center position of the balloon BL.","The distance from the balloon BL (in the X coordinate) can be obtained by the parallax of balloon images specified by the right image and the left image.","The target area discriminating module  as shown in  specifies the position of the balloon BL which is the target, wherein the position is defined in the regions as the left and right side regions (called a left and right region), the upper and lower side regions (called a upper and lower region) and the central region excluding these side regions. In other words, the target area discriminating module  specifies which region the balloon BL locates.","The reason why the position of the target is specified is that the fisheye lens has less certainty of the position when the target is in the peripheral side of the image frame.  explains this phenomenon. The horizontal axis shows the deviation angle from the optical axis of the CCD camera. The vertical axis shows the difference between two computed ranging distances (called \u201ccomputed distance error\u201d, hereinafter) by using two cameras; one computed with the images and the other with the discretized picture elements. As shown in , the central projection wide angle lens has a constant computed distance error even for the angle deviated from the optical axis becomes large, but the orthogonal projection fisheye lens as used in the present embodiment has a steep increase of the computed distance error when the deviation angle is more than 40 degrees. Therefore, the target position is reliable in terms of being in the upper or the lower position from the optical axis of the camera but the position in 3D space as (X, Y, Z) is rather less reliable. Due to this feature, the present invention uses the position information in response to the regions of the target in the image frame. If the position of the target is in the central area of the image frame, the present invention computes the 3D position of the target and uses it for the automatic operation. If the position of the target is in the peripheral area, the present invention uses it only for the direction information.","Specifically, the region is set in response to the reliability of the target position as follows. As shown in , the original frame of the image taken by the fisheye lens (CCD camera ) has a circle shape but the upper and lower portion of the image is lacking. In the left and right peripheral regions, the direction of the target is only reliable and the distance to the target obtained by the image is not reliable,","In the upper and the lower region Av, the horizontal direction and the distance to the target are reliable but the vertical position (Z location) is not reliable. The reason to rely the distance to the target is from the facts that two CCD cameras  are aligned in the left and the right hand sides, the distance is obtained by the horizontal angle and the horizontal position of the target which is the basic data to obtain the horizontal angle is reliable.","In the central region A, the spatial position as (X, Y, Z) of the target is reliable. In addition to these three regions, there is an outmost peripheral region Awhich cannot be used to specify the target position.","The boarders of the upper region Aor the left and right region Aagainst the central region Aare preferably set in the range of 25 to 35 degrees from the optical axis of the CCD camera . Because the necessary distance precision for the operation carried out in this embodiment is 1 cm when the sub pixel process is done and the one picture element corresponds about 5 cm (which is at around 30 degrees angle in ). The region (called as image circle) shown in  can be redefined in the size and the position with regard to the fisheye lenses used in this embodiment.","If we take Aregion large in the image and then the region Ais too outer to detect the balloon BL especially in the upper and lower direction in the peripheral of the fisheye lens. On the other hand, if the regions A, A, Aand Aare confined to the smaller areas and the whole image taken by the fisheye lens can be shrunk down in to the rectangular image frame, then the viewing angle in the upper and lower vertical plane becomes large, however the region Awhich has a high accuracy of position determination becomes small. Therefore the regions A, A, Aand Aare appropriately set in accordance with the characteristics of the fisheye lens, the required precision of the operation and the dynamic characteristics of the operation and so like.","In this embodiment the lower region is set wider than the upper region as shown in . The reasons are from the purposes to eliminate the undesirable effects of the lights LT, prevent the unnecessary search of dropping balloon and realize an appropriate ball play even the balloon is too close to the robot R.","(Target Area Discriminating Method)","We will discuss the method to discriminate the region where the target balloon is set.","The picture elements that compose the area extracted as a balloon are counted for every area. Let us assume the counts are;\n\n","The value, that is, the quantity of the picture elements of the temporarily assumed area divided by the total picture elements that correspond to the balloon is calculated. For this case,\n\n20\/(2+10+20+100)=0.15\n\nis obtained.\n","Moreover, if this value is less than a predetermined value, the central region Ais defined as the balloon existing region. If the value is more than the predetermined value, the temporal existing area of the balloon is defined as the true existing region of the balloon. For the examples of the predetermined values, 0.1 for the case 1), 0.2 for the case 2) and 0.4 for the case 3), that are threshold values to determine the true existing region of the balloon can be used. In the present embodiment, the calculated result is 0.15 for the case 3). Since 0.15<0.4 (=the threshold value for 3)) is obtained, it can be specified that the balloon BL locates in the central region A. The predetermined values are modified for the required precision of the detected position and the required limit of detected distance.","The area specifying signal for the areas as specified by the target area discriminating module  (see ) is sent to the main control engine .","Otherwise, the above target area discriminating method can be executed by discriminating the weight center of the image.","The main control engine  shown in  has the signal selection module  and the action-determination module .","On the basis of the region specification signal As obtained by the target area discriminating module , the signal selection module  selects the only signal used to specify the position among X-position, Y-position and Z-position given by distance computing module , horizontal position computing module  and vertical position computing module , respectively.","If the region specification signal AS indicates the outmost peripheral region A, any of X-position, Y-position and Z-position is selected. If the region specification signal Aindicates the left and right side region A, the direction is output from X and Y position (that is the angle shown in ). If the region specification signal Aindicates the upper and lower side region A, then X-position and Y-position are selected (that is, low reliable position information is not used). If the region specification signal Aindicates the central region A, all of X-position, Y-position and Z-position are selected.","The action determination module  determines the next action of the robot R based on the region specification signal Aand the position data given by the signal selection module  and sends a command of the action to the carrier controller , action controller  and the head controller . The action determination module includes a rotation control function.","In order to surely operate the ball playing by the robot R, the action determination module  carries out the next 1) to 3) in the present embodiment.\n\n","The balloon BL has actually no constant velocity and linear movement due to the effect of gravity, wind or the deviation of the center of gravity from the dimensional center. However the assumption of the constant velocity and linear movement can provide sufficient prediction for the position of the balloon BL in the next moment in such ball playing because the cycle of process that is the time duration between the adjacent moments is short. In this invention, the assumption of the constant velocity realizes the continuously precise automatic operation with suppressing the increase of computation necessary for the complicate prediction computation of the balloon position.","The robot R memorizes the position of the balloon BL in time-series manner in the past time and computes the predicted position of the balloon BL for a certain foretime in a linear prediction algorithm called a balloon model. The action determination in the action determination module  is carried out by such a balloon model.","In accordance with the position of the balloon BL, the following 1) to 5) processes are determined.\n\n","Since the position of the balloon BL is predicted in this invention, it is possible to take early action against above each action. Obviously to say, the stepping of the robot R and the holding of the hand R(L) in a certain height are not necessary.","The carrier controller  controls the joints in the leg portion R and the robot keeps stepping and takes moving action in accordance with the commands of the action determination module .","The action controller  controls the joints in the upper body R and the arm R and the robot moves the hand R(L) to upper direction and hits the balloon BL in accordance with the commands of the action determination module .","The head controller  controls the joints  and  to move the head portion R and the robot rotates the CCD cameras .","The process in the image processing engine  is actually executed by the graphic CPU shown in  and the processes of main control engine , the carrier controller , the action controller and the head controller  are executed by the control CPU in .","The action of the robot R constructed as described above is explained by referring to the flow chart shown in .","To begin with, the robot R takes the image of the balloon BL by the left and right CCD cameras L and R and the image is input to the graphic CPU by the frame grabber  (the image input unit ) at the step of image acquisition (S). At the step of the target image extracting unit , the reference balloon color corresponding to the specific region in the Cr-Cb space which has been memorized beforehand is extracted from each of the left and right images.","The judgment is carried out whether the extraction has been completed or not (S). If the extraction has not been completed (\u201cNo\u201d at the step S), it implies there is no balloon in the viewing space and the viewing direction is changed in order to search the balloon (S). If the reference balloon color is successfully extracted (\u201cYes\u201d at the step S), every region in a certain connectivity is labeled for the left and right images of which regions are extracted and specified (S). The shape determination process is carried out and the region which has a likelihood of a circular shape is selected (S). If no balloon is found in the shape determination process (\u201cNo\u201d in at the step S), the viewing direction is changed in order to search the balloon BL (S).","On the other hand, if a balloon BL is found (\u201cYes\u201d in the step S), the central position of the balloon BL and the vectors D and D are computed (S) by the distance computing module , the horizontal position computing module  and the vertical position computing module . At this step, the central position of the balloon BL is estimated and the angular information as (\u03b1, \u03b1, \u03b3) is specified. Then the position of the balloon BL is specified such as the left and right region A, the upper and below region Aor the central region A(S). After specifying the region, the viewing direction is changed (S) such that the balloon BL locates in the central region A(\u201cNo\u201d in the step S) on the acquired image since the reliability of the position of the balloon BL is low if the position of the balloon BL is not in the central region.","If the balloon BL is in the central region A(\u201cYes\u201d in the step S), the spatial position (X, Y, Z) of the balloon BL is computed by the vectors D and D (S) since the spatial position of the balloon BL can be precisely computed. The diameter of the balloon BL is computed at the same time.","The balloon model is updated (S) in accordance with the position of the balloon BL computed in the previous step. Namely, the position of the balloon BL from a certain time future is predicted by using the past track, speed of the balloon BL and the present position. If the present position of the balloon BL is not reliable, the balloon model is updated by using the past tracking of the balloon BL. The balloon model is recorded in the memory device  (S).","The control CPU used in the control unit  determines and directs the action of the robot in reference of the balloon position (S) defined in the balloon model recorded in the previous step. The control CPU in the control unit  controls the robot R in stepping or putting the leg portion R forward so that the robot R is to keep the distance against the balloon BL (S).","If it is not the time to hit the balloon BL (\u201cNo\u201d in the step S), the above steps S to S are repeated until the time at which the robot R can hit the balloon BL has come while the CCD camera  is always monitoring the balloon BL and the distance from the balloon BL is adjusted as well. In this embodiment, two CPUs as two graphic CPU repeat the steps S to S and the CPUrepeats the steps S to S.","When the time is to hit the balloon BL (\u201cYes\u201d in the step ), the action determination module  directs the operation to the action controller  (S). The hand R (L) is raised at the best timing to hit the bottom of the balloon BL since the central position and the diameter of the balloon BL are known. In this invention, the image processing and the control process are synchronously done.","As explained above, the robot R according to the present embodiment is keeping to trace the balloon BL which is moving in the space and to adjust the distance between the robot R and the balloon BL. When the condition to hit the balloon BL has become appropriate, the robot R raises the hand to hit the balloon BL. In the experimental test, the robot can repeat to hit the balloon BL for 10 to 15 times.",{"@attributes":{"id":"p-0139","num":"0156"},"figref":["FIG. 16","FIG. 16"],"b":["1","10","4","43","1","1","5","1","38","3","43"],"sub":"C "},"As explained above, the robot R in the present embodiment can obtain the wide viewing angle by using fisheyes lens and it is possible to discriminate the presence of a target regardless to the closeness of the target. Once the target is grasped in the peripheral region of the image (the view), then it is possible to keep grasping the target by rotating the CCD camera  since the direction of the balloon is reliable. The operation to keep grasping the target may be carried out within the necessity of the work. For example, the CCD camera  is not necessary to direct to the further low direction even when the balloon BL is positioning in the peripheral region of the acquired image if it can be expected that the future position of the balloon BL is predicted in a certain precision.","Even if the balloon BL locates in the upper and below region Ain the acquired image, the distance (in X axis) is reliable due to the use of two cameras set in the horizontal plane and it is possible to keep the precision of the balloon model in high level. This serves for the precise operation of the robot R.","In the present embodiment, the CCD cameras  are horizontally placed in left and right hand sides, but the cameras may be vertically placed or the cameras more than 3 units may be used. The image of the balloon BL is processed for four regions which have different process flows. However the classification of the region may be two groups as the central region and the peripheral region and the other classifications may be adopted. According to the present invention, it is possible to obtain the acquired images of plural targets and provide an automatic work apparatus that carries out automatic operation even the shapes and colors of the targets are different.","The embodiment of the present invention has been explained. This invention is not limited in the present embodiment but widely applied to other field of technologies.","For example, the human robots that use the fisheyes lenses can do the following operations;\n\n","The other applications of the robot which has a different figure from human figures are as;\n\n","As explained above, the present invention is preferred to be applied for the case when the normal project fisheye lenses which features that the angular resolution is poor in the peripheral region in comparison to the central region but the viewing angle is very wide.","As described above, the present invention can discriminate the position of the target in the acquired image of the image taken by the cameras and it is possible that the target is viewed at the central viewing region to facilitate the precise positioning and operation by rotating the viewing cameras to take image of the target at the central region if the targets locates in the peripheral region of the acquired image. The mutual distance between the robot and the target is adjusted while the operation is carried out and therefore it is possible to execute high level and precise operation. The present invention does not completely ignore all of the position information of the target but appropriately use it if any of the information is usable for the position information. Then, it is possible to quickly and effectively achieve the specific tasks. For example, by designing the specific action plan depending on the position of the target on the acquired image frame, it is possible to change the stance of the robot and soon approach to the balloon BL before the spatial position of the balloon BL is precisely computed. Therefore the robot can have enough time to discriminate the position of the balloon BL in high precision at the position where the robot can surely hit the balloon BL."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0027","num":"0027"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0028","num":"0028"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0029","num":"0029"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0030","num":"0030"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0031","num":"0031"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0032","num":"0032"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0033","num":"0033"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0034","num":"0034"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0035","num":"0035"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0036","num":"0036"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0037","num":"0037"},"figref":"FIGS. 11A","b":["11","11"]},{"@attributes":{"id":"p-0038","num":"0038"},"figref":"FIG. 12"},{"@attributes":{"id":"p-0039","num":"0039"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0040","num":"0040"},"figref":"FIG. 14"},{"@attributes":{"id":"p-0041","num":"0041"},"figref":"FIG. 15"},{"@attributes":{"id":"p-0042","num":"0042"},"figref":"FIG. 16"}]},"DETDESC":[{},{}]}
