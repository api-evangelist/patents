---
title: Expedited media interconnection in third party call control
abstract: Third party call control in a service management platform (SMP) of an enterprise system comprising a private branch exchange (PBX) in communication with the SMP over a trunk and line. Receiving a request over the line for communication involving a device. Invoking reliable transmission of provisional responses in the trunk. Receiving a receive only session description over the trunk. Invoking specific event notification between the SMP and PBX for calls answered between the device and PBX. Receiving notification of a call answered between the device and PBX. Responding to the request with the first session description as a send/receive offer. Receiving acknowledgement including a second send/receive answer session description over the line. Updating the trunk the second description as a send/receive update. Receiving a third session description with a successful response message from the PBX; the third session description being a send and receive copy of the first session description.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08976950&OS=08976950&RS=08976950
owner: Blackberry Limited
number: 08976950
owner_city: Waterloo
owner_country: CA
publication_date: 20100125
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF THE TECHNOLOGY","DETAILED DESCRIPTION"],"p":["The technology disclosed herein (the \u201ctechnology\u201d) relates interconnecting media between a caller and a callee. In some embodiments the technology relates to signaling under third party call control.","Collectively,  and  is a signaling diagram generally indicating how media interconnection can be established.","Reference will now be made in detail to embodiments of the technology. Each example is provided by way of explanation of the technology only, not as a limitation of the technology. It will be apparent to those skilled in the art that various modifications and variations can be made in the present technology without departing from the scope or spirit of the technology. For instance, features described as part of one embodiment can be used on another embodiment to yield a still further embodiment. Thus, it is intended that the present technology cover such modifications and variations that come within the scope of the technology. Other aspects of the present technology will be apparent to those of ordinary skill in the art from a review of the following detailed description in conjunction with the drawings. Embodiments of the present technology are not limited to any particular operating system, mobile device architecture, server architecture, or computer programming language.","The present technology relates to the control and management of communications. Although reference may be made to \u201ccalls\u201d in the description of example embodiments below, it will be appreciated that the described systems and methods are applicable to session-based communications in general and not limited to voice calls. It will also be appreciated that the systems and methods may not be limited to sessions and may be applicable to messaging-based communications in some embodiments.","Reference is now made to , which shows, in block diagram form, an example system, generally designated , for the control and management of communications. The system  includes an enterprise or business system , which in many embodiments includes a local area network (LAN). In the description below, the enterprise or business system  may be referred to as an enterprise network . It will be appreciated that the enterprise network  may include more than one network and may be located in multiple geographic areas in some embodiments.","The enterprise network  may be connected, often through a firewall , to a wide area network (WAN) , such as the Internet. The enterprise network  may also be connected to a public switched telephone network (PSTN)  via direct inward dialing (DID) trunks or primary rate interface (PRI) trunks.","The enterprise network  may also communicate with a public land mobile network (PLMN) , which may also be referred to as a wireless wide area network (WWAN) or, in some cases, a cellular network. The connection with the PLMN  may be made via a relay , as known in the art.","The enterprise network  may also provide a wireless local area network (WLAN) featuring wireless access points. Other WLANs  may exist outside the enterprise network . For example, WLAN may be connected to WAN .","The system  may include a number of enterprise-associated mobile devices  (only one shown). The mobile devices  may include devices equipped for cellular communication through the PLMN , mobile devices equipped for Wi-Fi communications over one of the WLANs , or dual-mode devices capable of both cellular and WLAN communications. WLANs  may be configured in accordance with one of the IEEE 802.11 specifications.","It will be understood that the mobile devices  include one or more radio transceivers and associated processing hardware and software to enable wireless communications with the PLMN  and\/or one of the WLANs . In various embodiments, the PLMN  and mobile devices  may be configured to operate in compliance with any one or more of a number of wireless protocols, including GSM, GPRS, CDMA, EDGE, UMTS, EvDO, HSPA, 3GPP, or a variety of others. It will be appreciated that the mobile device  may roam within the PLMN  and across PLMNs, in known manner, as the device moves. In some instances, the dual-mode mobile devices  and\/or the enterprise network  are configured to facilitate roaming between the PLMN  and a WLAN , and are thus capable of seamlessly transferring sessions (such as voice calls) from a connection with the cellular interface of the dual-mode device  to the WLAN  interface of the dual-mode device , and vice versa.","The enterprise network  typically includes a number of networked servers, computers, and other devices. For example, the enterprise network  may connect one or more desktop or laptop computers  (one shown). The connection may be wired or wireless in some embodiments. The enterprise network  may also connect to one or more digital telephone sets  (one shown).","The enterprise network  may include one or more mail servers, such as mail server , for coordinating the transmission, storage, and receipt of electronic messages for client devices operating within the enterprise network . Typical mail servers include the Microsoft Exchange Server\u2122 and the IBM Lotus Domino\u2122 server. Each user within the enterprise typically has at least one user account within the enterprise network . Associated with each user account is message address information, such as an e-mail address. Messages addressed to a user message address are stored on the enterprise network  in the mail server . The messages may be retrieved by the user using a messaging application, such as an e-mail client application. The messaging application may be operating on a user's computer  connected to the enterprise network  within the enterprise. In some embodiments, the user may be permitted to access stored messages using a remote computer, for example at another location via the WAN  using a VPN connection. Using the messaging application, the user may also compose and send messages addressed to others, within or outside the enterprise network . The messaging application causes the mail server  to send a composed message to the addressee, often via the WAN .","The relay  serves to route messages received over the PLMN  from the mobile device  to the corresponding enterprise network . The relay  also pushes messages from the enterprise network  to the mobile device  via the PLMN .","The enterprise network  also includes an enterprise server . Together with the relay , the enterprise server  functions to redirect or relay incoming e-mail messages addressed to a user's e-mail address within the enterprise network  to the user's mobile device  and to relay incoming e-mail messages composed and sent via the mobile device  out to the intended recipients within the WAN  or elsewhere. The enterprise server  and relay  together facilitate \u201cpush\u201d e-mail service for the mobile device  enabling the user to send and receive e-mail messages using the mobile device  as though the user were connected to an e-mail client within the enterprise network  using the user's enterprise-related e-mail address, for example on computer .","As is typical in many enterprises, the enterprise network  includes a Private Branch eXchange (although in various embodiments the PBX may be a standard PBX or an Internet Protocol (IP)-PBX, for simplicity the description herein uses the term PBX to refer to both)  having a connection with the PSTN  for routing incoming and outgoing voice calls for the enterprise. The PBX  is connected to the PSTN  via DID trunks or PRI trunks, for example. The PBX  may use Integrated Services Digital Network (ISDN) signaling protocols for setting up and tearing down circuit-switched connections through the PSTN  and related signaling and communications. In some embodiments, the PBX  may be connected to one or more conventional analog telephones . The PBX  is also connected to the enterprise network  and, through it, to telephone terminal devices, such as digital telephone sets , softphones operating on computers , etc. Within the enterprise, each individual may have an associated extension number, sometimes referred to as a PNP (private numbering plan), or direct dial phone number. Calls outgoing from the PBX  to the PSTN  or incoming from the PSTN  to the PBX  are typically circuit-switched calls. Within the enterprise, e.g. between the PBX  and terminal devices, voice calls are often packet-switched calls, for example Voice-over-IP (VoIP) calls.","The enterprise network  may further include a Service Management Platform (SMP)  for performing some aspects of messaging or session control, like call control and advanced call processing features. The SMP  may, in some cases, also perform some media handling. Collectively the SMP  and PBX  may be referred to as the enterprise communications platform, generally designated . It will be appreciated that the enterprise communications platform  and, in particular, the SMP , is implemented on one or more servers having suitable communications interfaces for connecting to and communicating with the PBX  and\/or DID\/PRI trunks. Although the SMP  may be implemented on a stand-alone server, it will be appreciated that it may be implemented into an existing control agent\/server as a logical software component. As will be described below, the SMP  may be implemented as a multi-layer platform.","The enterprise communications platform  implements the switching to connect session legs and may provide the conversion between, for example, a circuit-switched call and a VoIP call, or to connect legs of other media sessions. In some embodiments, in the context of voice calls the enterprise communications platform  provides a number of additional functions including automated attendant, interactive voice response, call forwarding, voice mail, etc. It may also implement certain usage restrictions on enterprise users, such as blocking international calls or 1-900 calls. In many embodiments, Session Initiation Protocol (SIP) may be used to set-up, manage, and terminate media sessions for voice calls. Other protocols may also be employed by the enterprise communications platform , for example, Web Services, Computer Telephony Integration (CTI) protocol, Session Initiation Protocol for Instant Messaging and Presence Leveraging Extensions (SIMPLE), and various custom Application Programming Interfaces (APIs), as are known to those of skill in the art and may be described in greater detail below.","One of the functions of the enterprise communications platform  is to extend the features of enterprise telephony to the mobile devices . For example, the enterprise communications platform  may allow the mobile device  to perform functions akin to those normally available on a standard office telephone, such as the digital telephone set  or analog telephone set . Example features may include direct extension dialing, enterprise voice mail, conferencing, call transfer, call park, etc.","Reference is now made to , which show example embodiments of the enterprise communications system . Again, although references are made below to \u201ccalls\u201d or call-centric features it will be appreciated that the architectures and systems depicted and described are applicable to session-based communications in general and, in some instances, to messaging-based communications.",{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 2","b":["16","18","60","60","16","18"]},"In this embodiment, the SMP  assumes control over both call processing and the media itself. This architecture may be referred to as \u201cFirst Party Call Control.\u201d Many of the media handling functions normally implemented by the PBX  can be handled by the SMP  in this architecture. Incoming calls addressed to any extension or direct dial number within the enterprise, for example, can be first routed to the SMP . Thereafter, a call leg is established from the SMP  to the called party within the enterprise, and the two legs are bridged. Accordingly, the SMP  includes a digital trunk interface  and a digital signal processing (DSP) conferencing bridge . The DSP conferencing bridge  performs the bridging of calls for implementation of various call features, such as conferencing, call transfer, etc. The digital trunk interface  may be implemented as a plurality of telephonic cards, e.g. Intel Dialogic cards, interconnected by a bus and operating under the control of a processor. The digital trunk interface  may also be partly implemented using a processor module such as, for example, a Host Media Processing (HMP) processor.","The SMP  may include various scripts  for managing call processing. The scripts  may be implemented as software modules, routines, functions, etc., stored in non-volatile memory and executed by the processor of the SMP . The scripts  may implement call flow logic, business logic, user preferences, call service processes, and various feature applications.",{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 3","b":["16","18","18","18"]},"The call control server  is coupled to the PBX , for example through the LAN, enabling packet-based communications and, more specifically, IP-based communications. In one embodiment, communications between the PBX  and the call control server  are carried out in accordance with SIP. In other words, the call control server  uses SIP-based communications to manage the set up, tear down, and control of media handled by the PBX . In one example embodiment, the call control server  may employ a communications protocol conforming to the ECMA-269 or ECMA-323 standards for Computer Supported Telecommunications Applications (CSTA).",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 4","b":["14","18","74","74","66","18","72","76","72","76","72","74"]},"The SIP server  interacts with the media server  using SIP-based media handling commands. For example, the SIP server  and media server  may communicate using Media Server Markup Language (MSML) as defined in IETF document Saleem A., \u201cMedia Server Markup Language\u201d, Internet Draft, draft-saleem-msm1-07, Aug. 7, 2008. The media server  may be configured to perform Host Media Processing (HMP). Other architectures or configurations for the enterprise communications system  will be appreciated by those of ordinarily skilled in the art.","Reference is now made to , which shows an embodiment of the enterprise communications system  with a Third Party Call Control architecture. In this embodiment, the SMP  is a multi-layer platform that includes a protocol layer , a services layer  and an application layer . The protocol layer  includes a plurality of interfaces operating in accordance with various protocol, each interface configured for enabling operation of corresponding applications in the application layer . The services layer  includes a plurality of services that can be leveraged by the interface protocols to create richer applications. Finally, the application layer  includes a plurality of applications that are exposed out to the communication devices and that leverage corresponding ones of the services and interface protocols for enabling the applications.","Specifically, the protocol layer  preferably includes protocols which allow media to be controlled separate from data. For example, the protocol layer  can include, among other things, a Session Initiation Protocol or SIP , a Web Services protocol , an Application Programming Interface or API , a Computer Telephony Integration protocol or CTI , and a Session Initiation Protocol for Instant Messaging and Presence Leveraging Extensions or SIMPLE protocol . It is contemplated that the interface protocols - are plug-ins that can interface directly with corresponding servers in the enterprise network , which are further described below.","For the purposes of this disclosure, SIP  will be utilized, although it is appreciated that the system  can operate using the above disclosed or additional protocols. As known by those of ordinary skill in the art, SIP is the IETF (Internet Engineering Task Force) standard for multimedia session management, and more specifically is an application-layer control protocol for establishing, maintaining, modifying and terminating multimedia sessions between two or more endpoints. As further known by those of ordinary skill in the art, the SIP protocol  provides for two interfaces for signaling: SIP-Trunk (hereinafter referred to as \u201cSIP-T\u201d) and SIP-Line (hereinafter referred to as \u201cSIP-L\u201d). The SIP-T interface is utilized when the endpoint is a non-specific entity or not registered (i.e., when communicating between two network entities). In contrast, the SIP-L interface is utilized when the endpoint is registered (i.e., when dialing to a specific extension). The specific operation of the system  utilizing SIP  will be described in further detail below.","The SMP  also includes a plurality of enablers, among other things, a VoIP enabler , a Fixed Mobile Convergence or FMC enabler , a conference services enabler , a presence enabler  and an Instant Messaging or IM enabler . Each of the enablers - are used by corresponding services in the services layer  that combine one or more of the enablers. Each of the applications in the application layer  is then combined with one or more of the services to perform the desired application. For example, a phone call service may use the VoIP or PBX enabler, and an emergency response application may use the phone call service, an Instant Messenger service, a video call service, and email service and\/or a conference service.","The application layer  may include a conference services application  that, together with the conference services enabler , enables multiple communication devices (including desk telephones and personal computers) to participate in a conference call through use of a centralized conference server . As seen in , the conference server  is provided in the enterprise network  and is in communication with the conference services enabler  preferably through the SIP protocol , although it is recognized that additional protocols that control media separate from data may be appropriate, such as the Web Services protocol  or the CTI protocol . The conference call server  can be configured for directing media and data streams to and from one or more communication devices (i.e., mobile devices , telephones , and computers ).","Turning now to , the general operation of the system  using SIP  as the signaling protocol will be discussed, although it is recognized that the present system is not limited to the processes discussed herein. The signaling descriptions that follow are based on Third Party Call Control architecture, such as that illustrated in  or . It will be appreciated that similar but slightly modified signaling may be used in a First Party Call Control architecture, wherein the PBX  will pass media through to the SMP  for direct media handling by the SMP . Variations in the signaling to adapt to various architectures will be appreciated by those ordinarily skilled in the art.",{"@attributes":{"id":"p-0043","num":"0042"},"figref":"FIG. 6A","b":["11","101","16","20","11","101","18","100","12","16","18","11","102","11","16","104","16","18","16","18","106","18","200","16","108"]},"The SMP  then sets up the outgoing call leg to the destination. It does this by sending an invite over SIP-L to the PBX  with the destination number of the target phone (block ). SIP-L is used so that the call can be correctly attributed to the individual within the organization within any call records that are being maintained by the PBX . When the invite is received, the PBX  dials the destination number to the target phone  (block ), and the target phone  answers the call (block ). When the target phone  answers, the PBX  sends a  OK signal to the SMP  indicating that the target phone  is ready to receive data (block ). The SMP  then sends an invite over SIP-T to the PBX  and shuffles the SDP (Session Description Protocol, as known to those of ordinary skill in the art) to connect the call legs (block ). When the call legs are connected, the PBX  sends a second  OK signal to the SMP  (block ), and the users of the device  and target phone  can communicate with each other.","Note that between the cellular call leg being established and the outgoing call leg being answered, the device can play ringing tones. These ringing tones may be provided by the PBX  using the presentation of early media from the outgoing call leg, or they may be generated locally on the device  if early media is not available. In the latter case, it will be necessary to localize the ringing tone to match the tone normally heard with a call through the PBX .","The above description is known as a \u201cmobile initiated\u201d call, because the SMP  provides the mobile device  with the DNIS number into which the mobile device  has called and the mobile device  initiates the call to the PBX . Alternatively, the mobile originated call could be \u201cPBX initiated\u201d, as shown in . Specifically, in a PBX-initiated call, upon receipt of the mobile originated call request (block ), the SMP  confirms receipt of the call to the mobile device  with an Automatic Number Identification (ANI) number (block ), which the mobile device will use to identify the incoming call from the PBX . The SMP  then sends an invite over SIP-T to the PBX  with the cellular number of the device and the ANI number that is attached to the outgoing call (block ). Upon receipt of the invite, the PBX  makes a cellular call to the device  (block ), which is answered by the device (block ). The device  checks the ANI number in the incoming call to confirm if the number is actually from the PBX , i.e., that the ANI matches the ANI in the CONFIRM sent by the SMP in block . If the ANI number is stripped for any particular reason, then the device  may be configured to answer the call as a regular cellular call, or it may reject the call as unknown. When the device  answers the PBX-initiated call, the PBX  sends a  OK signal to the SMP , indicating that the call leg to the device is established (block ).","In response, the SMP  sends an invite over SIP-L with the destination number of the target phone  to the PBX  (block ). When the invite is received at the PBX , the PBX dials the destination number to the target phone  (block ), the target phone  picks up the call (block ), and a  OK signal is sent from the PBX  to the SMP  (block ), indicating that the target phone  is also ready to receive data. In response to the  OK, the SMP  sends an invite to the PBX , shuffling the SDP to connect the call legs (block ). Finally, when the call legs are connected, the PBX  sends a second  OK signal to the SMP , and the users of the device  and target phone  are able to communicate with each other.","In both instances, the SMP  is performing third party call control of the two call legs, the PBX  remaining in control of the call. The decision of whether to proceed with a mobile-initiated call or a PBX-initiated call can be set by policy. Specifically, the option to select either mobile-initiated or PBX-initiated calls is a feature provided in the SMP , and an administrator for the enterprise network  can determine which setting to use. For example, in some cases it may be more cost effective for the corporation to utilize PBX-initiated calls rather than mobile-initiated calls, and vice versa. However, it is appreciated that the system  is not limited to the above processes.",{"@attributes":{"id":"p-0049","num":"0048"},"figref":["FIGS. 7A and 7B","FIG. 7A"],"b":["80","101","101","16","150","16","16","18","152"]},"In response to the invite, the SMP  sends a call request with the DNIS number and source details to the device  (block ), which is confirmed to the SMP (block ). In addition to confirming the call, the mobile device  sends a cellular call to the DNIS number at the PBX  (block ). Again, as the DNIS number is routed in the dialing plans to the SMP , upon receipt of the cellular call, the PBX  sends an invite over SIP-T to the SMP  with the DNIS number (block ). In response to the invite, a \u201c OK\u201d signal is sent over SIP-T from the SMP  to the PBX , acknowledging that the call leg to the mobile device  is established (block ). Finally, the initial invite (block ) is acknowledged with the \u201c OK\u201d signal with the cellular SDP, at which point the call legs are joined and the target phone  and device  can communicate with each other on the call.","The diagram shown in  illustrates a \u201cmobile-initiated\u201d call, because, as discussed above with respect to , the SMP  presents the mobile device  with the DNIS number at the PBX  into which to call. However, it is also possible to employ a \u201cPBX-initiated\u201d mobile terminated call, as shown in , where the PBX  sends an incoming call to the device , using the SMP , with the ANI number of the target phone .","Specifically, similar to the mobile initiated call described above and shown in , the target phone  sends an incoming call to the destination number of the device, which is received at the PBX  (block ). Upon receipt of the call, the PBX  sends an invite over SIP-L to the SMP  (block ) with the source number of the target phone . In response to the invite, the SMP  sends a call request with the source number to the device  (block ), with the ANI number the device should expect in the incoming call, the call request being confirmed by the device (block ). At this point in the PBX-initiated call, the SMP  sends an invite over SIP-T to the PBX  with the cellular number and ANI number to use (block ), prompting the PBX  to make a cellular call to the device  with the ANI number (block ), prompting the device to ring. The device  answers the call (block ), and a \u201c OK\u201d signal is sent from the PBX  to the SMP , acknowledging that the cellular call leg to the device  is established (block ). In response, a \u201c OK\u201d signal is also sent from the SMP  to the PBX , acknowledging that the call leg to the target phone  is also established (block ). The SMP  shuffles the SDP to connect the call legs, the call legs are joined, and the target phone  and device  can communicate with each other on the call.","As discussed above with respect to , the SMP  remains in control of the signaling between the target phone  and the mobile device  in both the mobile-initiated and PBX-initiated calls. Again, the decision to proceed with a mobile-initiated call or a PBX-initiated call is based on policy and may be set by a system administrator. In some cases, it may be more efficient or cost effective for the administrator to decide that PBX-initiated calls should be used, and in other cases, it may be more efficient or cost effective for mobile-initiated calls to be utilized. As these policy decisions may vary by organization and are not imperative to the scope of the present technology, they will not be discussed in further detail.","In each of the examples above, the SMP (while not in the media path between the caller, callee, and PBX) remains in the signaling path among the participants. The SMP manipulates call flows through SIP messages and SDPs. Generally, an incoming enterprise call to an enterprise-associated mobile device  is setup by first receiving the incoming call at a PBX line with late offer (no audio information in the SIP message invite), and by setting up the mobile device  leg of the circuit, in part by using the SIP connection between the SMP and the PBX. Once the mobile device  leg of the circuit is connected to the PBX, the SMP shuffles the audio with SIP messages between parties of the call to perform voice connection.","In the case where the mobile device  is roaming, the PBX delivers the invite for an incoming call as a late offer. Therefore, the SMP does not have the port to which media, e.g., Real-time Transport Protocol (RTP) messages, from the mobile device  leg should be sent until the final acknowledgement, thus losing media that arrives from the caller before the SMP can act on the acknowledgement.","Consider the following scenario. Device A calls Device B; Device B is roaming. Device A communicates with the SMP and a cellular call leg is established between Device A and the PBX. Once the Device A call leg is acknowledged, the SMP begins to establish a PBX line call to Device B. However, the PBX will not allocate media resources to the Device B call leg just yet, so the SMP does not have media resource information (e.g., an SDP) to provide to Device B.","Device B is now answered and a may begin receiving audio input. However, until the acknowledgement from Device B reaches the SMP, and the SMP communicates with the PBX, there is no PBX media resource allocated to the Device B call leg between Device B and the PBX. The amount of time that it takes to allocate a media resource to this leg can be significant, e.g., shown to be up to two (2) seconds\u2014especially where Device B is roaming. In some cases, one or both of the caller and the callee devices may be roaming.","Under these circumstances, early media offer is not supported for SIP PBX LINE calls, so it cannot be used to obtain an early offer and be put into cellular TRUNK call. The SMP may obtain SIP LINE audio information (codecs, IP address, RTP port) after answering SIP LINE call. However, in most billing schemes, the caller party will be billed for a failed call, not only for a successful call. Also, answering a SIP LINE call prior to establishing cellular callback to the device may break access to PBX features, such as shared line and enterprise voice mail.","The present technology accelerates the media connection between the participants utilizing SIP PRACK per IETF Request For Comments (RFC) 3262 Reliability of Provisional Responses in the Session Initiation Protocol.","Referring to , a signaling diagram generally indicating how a mobile-terminated PBX-initiated call can be processed under the present technology to accelerate a media connection between the participants is presented. In accordance with the present technology, a call to the mobile device  registered with the SMP is received at the PBX  (block ). The PBX  sends a SIP invite message to the SMP  over the SIP-L interface (block ) since the mobile device  is associated with the SMP . However, the PBX  does not offer media resources, e.g., no valid session description in SDP format in the body of the invite message. The SMP  responds with SIP messages  trying (block ) and  ringing (block ).","The SMP  notifies the device  using a call request with the ANI number of the call that the mobile device  can expect from the PBX  (block ), and the device  acknowledges the call request (block ). The request and confirm can be in SIP, or a similar protocol. In some embodiments, this communication between the SMP  and the device  can be via the enterprise server .","The SMP  initiates a cellular callback (e.g., from the PBX  to the device ) over PBX SIP-T using RFC 3262\u201c100Rel Required,\u201d sendonly connection mode, and a placeholder SDP (block ). Table 1 illustrates such a placeholder SDP.",{"@attributes":{"id":"p-0063","num":"0062"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"147pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 1"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\u2003","SDP Placeholder: (814)"]},{"entry":[{},{},"-------------------"]},{"entry":[{},{},"Content-Type: application\/sdp"]},{"entry":[{},{},"Content-Length: 235"]},{"entry":[{},{},"v=0"]},{"entry":[{},{},"o=user 2000 0 IN IP4 X.X.X.X"]},{"entry":[{},{},"s=SMP 2.0 Session"]},{"entry":[{},{},"c=IN IP4 X.X.X.X"]},{"entry":[{},{},"t=0 0"]},{"entry":[{},{},"m=audio 20000 RTP\/AVP 0 8 18 9"]},{"entry":[{},{},"a=rtpmap:0 PCMU\/8000"]},{"entry":[{},{},"a=rtpmap:8 PCMA\/8000"]},{"entry":[{},{},"a=rtpmap:18 G729\/8000"]},{"entry":[{},{},"a=rtpmap:9 G722\/8000"]},{"entry":[{},{},"a=sendonly"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]}}}}},"The PBX  responds to the SMP with SIP message  trying (block ). The PBX  will place a cellular call to the device  in response to this invite (block ). The PBX  also replies (block ) to the SMP over SIP-T with an 18\u00d7reliable response including a valid SDP (SDP) because the SMP  indicated \u201c100RelReq\u201d in block . Table 2 illustrates an SDP.",{"@attributes":{"id":"p-0065","num":"0064"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 2"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\u2003","SDP1 (from TRUNK) (818)"]},{"entry":[{},{},"-------------------------"]},{"entry":[{},{},"Content-Type: application\/sdp"]},{"entry":[{},{},"Content-Length: 214"]},{"entry":[{},{},"v=0"]},{"entry":[{},{},"o=CiscoSystemsCCM-SIP 2000 1 IN IP4"]},{"entry":[{},{},"Y.Y.Y.Y"]},{"entry":[{},{},"s=SIP Call"]},{"entry":[{},{},"c=IN IP4 Z.Z.Z.Z"]},{"entry":[{},{},"t=0 0"]},{"entry":[{},{},"m=audio 26268 RTP\/AVP 0 101"]},{"entry":[{},{},"a=rtpmap:0 PCMU\/8000"]},{"entry":[{},{},"a=ptime:20"]},{"entry":[{},{},"a=rtpmap:101 telephone-event\/8000"]},{"entry":[{},{},"a=fmtp:101 0-15"]},{"entry":[{},{},"a=recvonly"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]}}}}},"This reply is acknowledged to the PBX  by an RFC 3262 PRACK message (block ) from the SMP . The PBX sends the  OK message called for by a PRACK acknowledgement (block ). A two-way subscription under Key Pad Stimulus Protocol (KPML) is established between the SMP  and the device  (via the PBX) for SMP call control and monitoring by using the SIP SUBSCRIBE\/NOTIFY message (block ).","Referring to , the SMP  then waits for notification message (block ) from the PBX , indicating that the device  has been answered by a user (block ). For calls to a roaming device , this notification message will arrive prior to the call being connected from a signaling point of view, in part because the notify message is based on key pad stimulus, e.g., tones received by the PBX  from the device  (e.g., block ).","After receiving notice that the cellular leg is answered, the SMP  answers the incoming call leg (originally offered at block ) using a SIP  OK message with the SDP provided by the PBX  in block  (block ), but as send\/receive. Table 3 illustrates this SDP. This is a swap or shuffle of SDP from the SIP-T to SIP-L. Further, this is a send\/receive offer and is typically the point at which call billing starts.",{"@attributes":{"id":"p-0069","num":"0068"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 3"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\u2003","SDP1 senrecv to LINE: (828)"]},{"entry":[{},{},"-------------------------"]},{"entry":[{},{},"Content-Type: application\/sdp"]},{"entry":[{},{},"Content-Length: 214"]},{"entry":[{},{},"v=0"]},{"entry":[{},{},"o=CiscoSystemsCCM-SIP 2000 1 IN IP4"]},{"entry":[{},{},"Y.Y.Y.Y"]},{"entry":[{},{},"s=SIP Call"]},{"entry":[{},{},"c=IN IP4 Z.Z.Z.Z"]},{"entry":[{},{},"t=0 0"]},{"entry":[{},{},"m=audio 26268 RTP\/AVP 0 101"]},{"entry":[{},{},"a=rtpmap:0 PCMU\/8000"]},{"entry":[{},{},"a=ptime:20"]},{"entry":[{},{},"a=rtpmap:101 telephone-event\/8000"]},{"entry":[{},{},"a=fmtp:101 0-15"]},{"entry":[{},{},"a=SENDRECV"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]}}}}},"In response, the PBX allocates media resources for the incoming call leg using a SIP ACK message containing SDP as an answer to the offer of block  (block ). Table 4 illustrates an SDP2 of this message in embodiments in accordance with the present example.",{"@attributes":{"id":"p-0071","num":"0070"},"tables":{"@attributes":{"id":"TABLE-US-00004","num":"00004"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"168pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 4"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\u2003","SDP2 (PORT IS DIFFERENT) LINE, (830)"]},{"entry":[{},{},"-------------"]},{"entry":[{},{},"Content-Type: application\/sdp"]},{"entry":[{},{},"Content-Length: 214"]},{"entry":[{},{},"v=0"]},{"entry":[{},{},"o=CiscoSystemsCCM-SIP 2000 0 IN IP4"]},{"entry":[{},{},"Y.Y.Y.Y"]},{"entry":[{},{},"s=SIP Call"]},{"entry":[{},{},"c=IN IP4 Z.Z.Z.Z"]},{"entry":[{},{},"t=0 0"]},{"entry":[{},{},"m=audio 26323 RTP\/AVP 0 101"]},{"entry":[{},{},"a=rtpmap:0 PCMU\/8000"]},{"entry":[{},{},"a=ptime:20"]},{"entry":[{},{},"a=rtpmap:101 telephone-event\/8000"]},{"entry":[{},{},"a=fmtp:101 0-15"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]}}}}},"Using the SIP Update method of RFC 3311, the SMP  sends SDP back to the PBX  (block ). Table 5 illustrates an SDP of this message in embodiments in accordance with the present example.",{"@attributes":{"id":"p-0073","num":"0072"},"tables":{"@attributes":{"id":"TABLE-US-00005","num":"00005"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 5"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\u2003","SDP2 832"]},{"entry":[{},{},"--------------"]},{"entry":[{},{},"Content-Type: application\/sdp"]},{"entry":[{},{},"Content-Length: 214"]},{"entry":[{},{},"v=0"]},{"entry":[{},{},"o=CiscoSystemsCCM-SIP 2000 0 IN IP4"]},{"entry":[{},{},"Y.Y.Y.Y"]},{"entry":[{},{},"s=SIP Call"]},{"entry":[{},{},"c=IN IP4 Z.Z.Z.Z"]},{"entry":[{},{},"t=0 0"]},{"entry":[{},{},"m=audio 26323 RTP\/AVP 0 101"]},{"entry":[{},{},"a=rtpmap:0 PCMU\/8000"]},{"entry":[{},{},"a=ptime:20"]},{"entry":[{},{},"a=rtpmap:101 telephone-event\/8000"]},{"entry":[{},{},"a=fmtp:101 0-15"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]}}}}},"Once the PBX acknowledges the update (block ) the audio path between the caller  and the device  is connected. Table 6 illustrates an SDP of this message in embodiments in accordance with the present example. This SDP is the same as SDP in block , except that it is send\/receive. The audio connection happens earlier that the primary rate interface (PRI) CONNECT is received when one or both of the calls are roaming.",{"@attributes":{"id":"p-0075","num":"0074"},"tables":{"@attributes":{"id":"TABLE-US-00006","num":"00006"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"161pt","align":"left"}}],"thead":{"row":[{"entry":[{},"TABLE 6"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\u2003","834"]},{"entry":[{},{},"---------------------"]},{"entry":[{},{},"Content-Type: application\/sdp"]},{"entry":[{},{},"Content-Length: 214"]},{"entry":[{},{},"v=0"]},{"entry":[{},{},"o=CiscoSystemsCCM-SIP 2000 1 IN IP4"]},{"entry":[{},{},"Y.Y.Y.Y"]},{"entry":[{},{},"s=SIP Call"]},{"entry":[{},{},"c=IN IP4 Z.Z.Z.Z"]},{"entry":[{},{},"t=0 0"]},{"entry":[{},{},"m=audio 26268 RTP\/AVP 0 101"]},{"entry":[{},{},"a=rtpmap:0 PCMU\/8000"]},{"entry":[{},{},"a=ptime:20"]},{"entry":[{},{},"a=rtpmap:101 telephone-event\/8000"]},{"entry":[{},{},"a=fmtp:101 0-15"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]}}}}},"Note that the acknowledgement (block ) to the update of block  comes after the  OK response (block ) confirming the connection.","At least in part by swapping SDPs in this fashion, the technology has been shown to connect the target phone  and the device  up to two (2) seconds earlier than media channels for each call leg would otherwise be connected. While the exemplary embodiment described herein is in the context of a mobile-terminated\/PBX-initiated scenario, one of ordinary skill in the art would readily understand how to apply the principles of the technology to other scenarios such as mobile-terminated\/mobile-initiated, mobile-originated\/mobile-initiated, and mobile-originated\/PBX-initiated.","The present technology can take the form of hardware, software or both hardware and software elements. In some embodiments, the technology is implemented in software, which includes but is not limited to firmware, resident software, microcode, a Field Programmable Gate Array (FPGA) or an Application-Specific Integrated Circuit (ASIC), etc. In particular, for real-time or near real-time use, an FPGA or ASIC implementation is desirable.","Furthermore, the present technology can take the form of a computer program product comprising program modules accessible from computer-usable or computer-readable medium storing program code for use by or in connection with one or more computers, processors, or instruction execution system. For the purposes of this description, a computer-usable or computer readable medium can be any apparatus that can contain, store, communicate, propagate, or transport the program for use by or in connection with the instruction execution system, apparatus, or device. The medium can be an electronic, magnetic, optical, electromagnetic, infrared, or semiconductor system (or apparatus or device) or a propagation medium (though propagation mediums in and of themselves as signal carriers are not included in the definition of physical computer-readable medium). Examples of a physical computer-readable medium include a semiconductor or solid state memory, magnetic tape, a removable computer diskette, a random access memory (RAM), a read-only memory (ROM), a rigid magnetic disk and an optical disk. Current examples of optical disks include compact disk\u2014read only memory (CD-ROM), compact disk\u2014read\/write (CD-R\/W) and DVD. Both processors and program code for implementing each as aspect of the technology can be centralized or distributed (or a combination thereof) as known to those skilled in the art.","A data processing system suitable for storing a computer program product of the present technology and for executing the program code of the computer program product will include at least one processor coupled directly or indirectly to memory elements through a system bus. The memory elements can include local memory employed during actual execution of the program code, bulk storage, and cache memories that provide temporary storage of at least some program code in order to reduce the number of times code must be retrieved from bulk storage during execution. Input\/output or I\/O devices (including but not limited to keyboards, displays, pointing devices, etc.) can be coupled to the system either directly or through intervening I\/O controllers. Network adapters can also be coupled to the system to enable the data processing system to become coupled to other data processing systems or remote printers or storage devices through intervening private or public networks. Modems, cable modem and Ethernet cards are just a few of the currently available types of network adapters. Such systems can be centralized or distributed, e.g., in peer-to-peer and client\/server configurations. In some embodiments, the data processing system is implemented using one or both of FPGAs and ASICs."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0003","num":"0002"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0004","num":"0003"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0005","num":"0004"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":["FIG. 5","FIG. 3"]},{"@attributes":{"id":"p-0008","num":"0007"},"figref":["FIG. 6A","FIG. 5"]},{"@attributes":{"id":"p-0009","num":"0008"},"figref":["FIG. 6B","FIG. 5"]},{"@attributes":{"id":"p-0010","num":"0009"},"figref":["FIG. 7A","FIG. 5"]},{"@attributes":{"id":"p-0011","num":"0010"},"figref":["FIG. 7B","FIG. 5"]}]},"DETDESC":[{},{}]}
