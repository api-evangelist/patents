---
title: Method and apparatus for automatically archiving a file system
abstract: In a digital data processing system having an on-line file system component, a method and apparatus for archiving the contents of a selected client volume stored on the file system. The archiving is performed automatically, beginning with an initial duplication of the existing contents of the client volume into an archive volume, then continuing as changes, including additions, deletions and modifications, are made to the files comprising the client volume. Older, previously-archived versions of modified files are gracefully discarded so as to moderate the rate of growth of the archive volume. The archive volume may be used to restore the client volume, either selectively or in whole, in the event of inadvertent damage to, or loss of, files in the client volume.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07155465&OS=07155465&RS=07155465
owner: 
number: 07155465
owner_city: 
owner_country: 
publication_date: 20030418
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE INVENTION","The Stand-Alone Archival System","EXAMPLE 1","Linear Filter","EXAMPLE 2","Linear Filter with Infrequent Changes","EXAMPLE 3","Linear Filter with Frequent Changes","EXAMPLE 4","Crafted Filter","EXAMPLE 5","Lazy Filtering","EXAMPLE 6","A Fibonacci filter","EXAMPLE 7","A Base  filter","EXAMPLE 8","Initial File Added and Never Changed","EXAMPLE","Delete Handling","The Integrated Archival System"],"p":["1. Technical Field","The present invention relates generally to digital data processing systems, and, in particular, to methods and apparatus in digital data processing systems having on-line file systems for archiving the contents of one or more user volumes stored in those file systems.","2. Background Art","In general, in the descriptions that follow, we will italicize the first occurrence of each special term of art which should be familiar to those skilled in the art of digital data processing systems. In addition, when we first introduce a term that we believe to be new or that we will use in a context that we believe to be new, we will bold the term and provide the definition that we intend to apply to that term. Since our invention is specifically intended for use in digital data processing systems, we will often use terms that are well known to those skilled in this particular art. For example, with respect to an individual element of information stored at a particular address in a memory component of such a system, we will typically use the term pointer to refer, not to the element per se, but to a separate and distinct element that contains the address of the referenced element. Other common terms of art that we may use include: b for bit and B for byte, msb for most significant bit and lsb for least significant bit; and MB for megabyte. From time to time, we may refer to various commercial software products whose names may be either common law or registered trademarks of the respective owners thereof.","There are a number of products in the market which provide some form of file system protection for different kinds of failures. In general, failures can be categorized as either unrecoverable or recoverable. For example, a catastrophic failure is a failure in which the contents of one or more of the files comprising a volume or partition stored in the file system are corrupted either irretrievably or beyond the point at which it's cost effective to try to recover the contents of the disk media. In a catastrophic failure the system (or disk) is no longer operable. Such a failure can be due to hardware causes, such as a crashed disk head, or due to software causes, such as a bad OS build or virus run rampant. In contrast, a recoverable failure is a failure in which the contents of the file system are corrupted or modified incorrectly in a manner that the system (or disk) is still functional and critical portions of the file system are still intact. The most common example of a recoverable failure is when a user inadvertently deletes a file still of value.","Protection approaches protect either the current state of the file system or protect a history of the file system over time through a series of archival snapshots taken under the control of the system operators.","Approaches that protect the current state of the file system effectively provide protection against hardware failures, but nothing more. They include:\n\n","Protection schemes that provide archival of snapshots operate by allowing the operator to make an image of the entire file system either upon demand or at intervals scheduled manually or automatically.","Typical schemes allow for either manual initiation of a backup or automatic initiation at a regular interval, such as once per day. In the case of a tape archive, backups are available until old tapes are recycled for use making new backups. In the case of disk, snapshots are available until they are deleted to make space for new snapshots.","To create a snapshot, the backup system copies the contents of the protected file system to archival media, either tape or another disk. At the time of each backup, the backup system can either copy the entire file system (a full save), or just those files which have changed since the last backup (incremental save), allowing a snapshot to maintain an accurate representation of the protected file system at some point in time. Some backup systems provide an explicit mechanism for keeping multiple snapshots available on a single disk media to allow easy recovery of more than a single version of a file.","Most backup systems operate by allowing the backup to take place while the system is in operation. While such a capability is favorable, it results in an imprecise image of the file system since the file system may be changing even as the backup takes place, leading not to a precise snapshot, but to an approximate snapshot taken over a potentially large interval of time, perhaps as much as several hours. This is potentially problematic, given the rapid pace at which file system contents can change. Because of this it is not always possible to restore the file system to a consistent state, even from a good snapshot, since the snapshot is a fuzzy representation of the file system captured over a relatively long period of time.","One approach to producing an exact and guaranteed usable image of a file system is to take the file system (or entire computer) offline, rendering the contents of the file system inert. Once this is a done a snapshot can be taken safe in the knowledge that the file system will remain unchanged during the entire interval required for the snapshot. We call this an offline snapshot. A significant downside to this approach is its intrusive nature, since the file system, perhaps the entire computer, is not available for use during a potentially large period of time.","With mirroring, one can take one of the two or more mirrored volumes offline and get the best of both worlds, but this is not practical for small system users.","Another approach is to use a copy-on-write method to allow taking what is effectively an offline snapshot while allowing the file system to remain accessible for use. If any files are changed while the file system snapshot is being recorded, two copies of the changed files are kept, the original or archival copy being used by the snapshot process, and the modified or live copy, used by everything else. When the snapshot concludes, the archival copy of all files modified during the snapshot are removed, leaving only the live copies.","Yet another approach is to automatically create a new snapshot or update an existing one on a very frequent basis, such as every hour or perhaps each and every time a file system object is written. We refer to this approach as continuous. A continuous approach comes closer to achieving the precision of an offline snapshot while leaving the file system available for use. Unlike the copy-on-write approach, the continuous approach allows copying data from the file system to another storage medium as it changes, reducing the window of vulnerability should something happen to the file system in between potentially infrequent snapshots. A significant problem with the continuous approach is the large storage required. As with the other approaches the storage space required grows linearly over time, since in the typical case about the same number of changes are made to the file system over any reasonable period of time. Unlike the other approaches, the amount of storage required could be dramatically greater, since we are snapshoting the file system not once per day or once per week, but potentially at each and every file system object update.","Examples of prior art in the general field of file system archiving include: Unix, Microsoft Windows backup, TLM 6.1, LiveBackup, CMS, Echo, Disklmage, NortonGhost, Dantz Retrospect, and CVS.","We submit that what is needed is a more efficient method and apparatus for efficiently archiving the contents of an on-line file system, and, in particular, wherein modified versions of existing files are archived essentially in real-time, but older, previously-archived versions of such modified files are selectively discarded.","In accordance with a preferred embodiment of our invention, we provide, in a digital data processing system having a first file storage system adapted to store a first file, a method for archiving said stored file in a second file storage system adapted to store files. In accordance with our preferred method, we first store in said second file storage system a first copy of said first file. We then store in a first record a state of a selected condition existent as of the time said first copy is stored in said second file storage system. Thereafter, we selectively apply a predetermined filter criteria to said first record, and, if said stored state of said selected condition satisfies said criteria, we delete said first copy from said second file storage system.","In accordance with another embodiment of our invention, we provide a digital data processing system having a first file storage system adapted to store a first file, and a second file storage system that is also adapted to store files. In accordance with this embodiment, we provide a storage agent that is adapted to first store in said second file storage system a first copy of said first file. The storage agent then stores in a first record a state of a selected condition existent as of the time said first copy is stored in said second file storage system. Thereafter, the storage agent selectively applies a predetermined filter criteria to said first record, and, if said stored state of said selected condition satisfies said criteria, it deletes said first copy from said second file storage system.","In accordance with yet another embodiment of our invention, we provide a storage agent for use in a digital data processing system having a first file storage system adapted to store a first file, and a second file storage system that is also adapted to store files. In accordance with this embodiment, the storage agent is adapted to first store in said second file storage system a first copy of said first file. The storage agent then stores in a first record a state of a selected condition existent as of the time said first copy is stored in said second file storage system. Thereafter, the storage agent selectively applies a predetermined filter criteria to said first record, and, if said stored state of said selected condition satisfies said criteria, it deletes said first copy from said second file storage system.","We submit that each of these embodiments of our invention more efficiently archives the contents of an on-line file system, and, in particular, that each archives modified versions of existing files essentially in real-time, while selectively discarding older, previously-archived versions of such modified files.","In the drawings, similar elements will be similarly numbered whenever possible. However, this practice is simply for convenience of reference and to avoid unnecessary proliferation of numbers, and is not intended to imply or suggest that our invention requires identity in either function or structure in the several embodiments.","In accordance with our invention, one or more volumes comprising an on-line file system of a data processing system, such as a personal computer (\u201cPC\u201d), can be selected for automatic archival backup protection. For convenience we shall refer to the selected volume(s) as the protected volume(s). In general, the basic archival functionality of our invention is implemented in software. Although it in certainly possible, in a PC that has a single, large capacity disk drive, to partition that drive into a protected volume and an archive volume, such a configuration is subject to total failure in the event that drive experiences a catastrophic failure. Accordingly, we highly recommend that the user dedicate a separate archive drive for the archive volume. For convenience of use with an existing PC, we prefer to provide the archive drive in a separate physical enclosure from the enclosure containing the PC, and to partition the archival software such that a first portion executes within the PC enclosure and a second portion executes within the archive enclosure. One distinct advantage of such an arrangement is that a catastrophic failure of a component within the PC enclosure (e.g., a power supply failure) will not usually affect the components within the archive enclosure (and vice versa), thereby tending to facilitate rapid system recovery. On the other hand, certain efficiencies can be realized by integrating the archive drive into the PC enclosure (or, if available, dedicating an existing \u201cspare\u201d drive to the archive function).","Shown in  and  is a stand-alone system  comprising a conventional personal computer that we shall refer to as our Client , and a storage agent that we shall refer to simply as the SA , constructed in accordance with a stand-alone embodiment of our invention. By stand-alone we mean that at least the protected volume is contained within one enclosure , while at least the archive volume is contained within another enclosure  which is independent of, and separated from, enclosure .","As shown in greater detail in , Client  is comprised of a central processing unit, CPU , which is coupled directly to main memory , and a system controller  which is coupled to a hard disk, Client Disk  (containing the protected volume), an input device , such as a keyboard, an output device , such as a monitor, and a high-speed interface  which may implement any of the know high-speed communication protocols such as the Universal Serial Bus (\u201cUSB\u201d), the IEEE 1394 (\u201cFirewire\u201d) or one of the Ethernet options, including 10BaseT, 100BaseT or 1000BaseT. Preferably, as shown generally in , at least the CPU , the memory , the system controller , the Client Disk , and the interface  are contained with enclosure , and supplied with operating power by a power supply .","As also shown in detail in , SA  is comprised of a central processing unit, CPU , which is coupled directly to main memory , and a system controller  which is coupled to a hard disk, Archive Disk  (containing the archive volume), a simple output device , such as one or more light emitting diodes (\u201cLEDs\u201d)or a small liquid crystal display (\u201cLCD\u201d), and a high-speed interface  which may implement any of the know high-speed communication protocols such as USB, Firewire or Ethernet. Preferably, all of the hardware components comprising the SA  are contained within enclosure , and supplied with operating power by a power supply . A suitable cable  (not shown in ) connects the interface  of the SA  to the interface  of the Client  to enable high-speed communication between the SA  and the Client  during normal operation of the stand-alone system .","Shown generally in  are the main software components of the stand-alone system . As is conventional in Client , an application , such as a word processing or spreadsheet program, executes under control of an operating system, OS , to create, modify or delete data files stored on a client volume . Within the context of the specific hardware configuration shown in , both the application  and the OS  will, during the execution thereof by the CPU , reside, at least in part, in the memory , and will make use of the system controller  on an as-required basis to interact with the user via the input device  and the output device , in order to implement requested actions relative to the client volume  resident on the Client Disk .","In accordance with a preferred embodiment of our invention, the main software components of our SA  consist of a Client Agent , adapted to reside within the Client  and to interact with the OS , a Server Agent , adapted to reside within the SA  and to interact with the Client Agent  to automatically maintain an archive of the contents of the client volume  in an archive volume , resident on the Archive Disk . In general, the archive will:\n\n","In our preferred embodiment, the Client Agent  and the Server Agent  communicate using a Client Server Protocol (\u201cCSP\u201d) which is designed to abstract out the details of the specific communication protocol implemented by the interface  and the interface . Preferably, CSP will utilize existing drivers, such as, for example, USB, 1394, and Ethernet. In addition, CSP implements checksums and encryption on each transfer to ensure the fidelity and privacy of the transaction.","The Client Agent","In our preferred embodiment, the Client Agent  includes: a Client Communication Interface, CCI ; a Volume Monitor ; a Browser ; a Configurator ; and a Restorer . The Client Agent  relies upon the basic hardware and software services provided by the OS . Individual components of the Client Agent  are multithreaded as appropriate, allowing for maximum flexibility and performance. In our preferred embodiment, the Client Agent  will be distributed on compact disk (\u201cCD\u201d) and be automatically installed in the Client  using a secure installation program, such as Install Shield. The user should be able to accept all the defaults and get a reasonable, and for 95% of the population, perfect configuration of the SA .","The CCI  is the conduit through which the Client Agent  communicates with the Server Agent  via the CSP.","The Volume Monitor  monitors volume changes, packaging and queuing the changes, and communicating those changes to the Server Agent . In particular, the Volume Monitor  keeps track of all volume activity of the Client  and distills this into a list of change orders. The Volume Monitor  communicates these change orders and associated data to the Server Agent  via the CSP. Specific activities of the Volume Monitor  include:\n\n","The Browser  is a graphical user interface or GUI application for browsing the archive. Preferably, the functionality of an existing browser, such as Microsoft's Windows Explorer is enhanced so that a new item called \u201cArchived Versions\u201d appears on the Right Click menu for any file or directory; selecting this item will thereby provide a list of available versions\u2014select one and you get a choice of Open (copied from the archive to the temporary directory and then opened), Restore (popup to choose original or alternate location), Properties, and Cancel. Alternatively, a GUI application that we call the Archive Browser is provided which is similar to the Windows Explorer, but with an additional box that lets you set a date and time; in response to clicking in this new box, the archive's representation of the archive volume  at that time will be shown.","The Configurator  is another GUI application for configuring the Client Agent  and the Server Agent . Preferably, it can be accessed via an Icon on the Control Panel, a link on the Start Menu tree, and via the Notification Icon. When you start it you get the traditional box with several tabs. The tab you start on is called \u201cWizard\u201d and is essentially a Wizard that will walk you through the steps. Behind the Wizard are another set of tabs that allow direct settings. Using either approach, the following functionality is desirable:\n\n","The Restorer  is a GUI application for restoring data from the archive, preferably integrated with Browser . Alternatively, it can be a Wizard that provides a more traditional interface.","The Server Agent","In our preferred embodiment, the Server Agent  includes: a Server Communication Interface, SCI , to the Client Agent ; an Update Monitor , for receiving volume changes from the Client Agent  and queuing them for archival; a Query Manager , for managing request from the Client Agent  for information retrieval from the archive; a Configuration Manager , for fielding requests from the Client Agent  for bookkeeping operations including downloading software updates and configuring the SA ; and an Archive Manager , responsible for archive integrity, compression, decompression, and revision control, including insertion, deletion, retrieval, and query operations. The Server Agent  relies upon the basic hardware and software services provided by the server operating system. Individual components of the Server Agent  are multithreaded as appropriate, allowing for maximum flexibility and performance. In our preferred embodiment, the initial version of the Server Agent  will be installed in the SA  at the time of manufacturing. In our preferred embodiment, however, newer versions of the Server Agent  will be distributed either electronically, via the Internet, or on CD, together with a secure installation program, such as Install Shield.","The SCI  is the conduit through which the Server Agent  communicates with the Client Agent  via the CSP.","The Update Monitor  is the counterpart in the Server Agent  to the Volume Monitor  in the Client Agent . The Update Monitor  listens via CSP for changes from the Volume Monitor . The Update Monitor  accepts these changes, and queues or stages them on the Archive Disk . After the changes are staged, the Update Monitor  notifies the Archive Manager  of their arrival. Later, after they have been processed, the Archive Manager  deletes them. Preferably, the Update Monitor  cooperates with other components, to provide a reliable resynchronization for the archive across system crashes and other unanticipated events.","The Query Manager  fields requests from the Client Agent  for information retrieval from the archive. In essence, it provides an interface that allows the Client Agent  to perceive the archive as a normal volume for purposes of exploration and restoration. Preferably, the Query Manager  presents an application programming interface (\u201cAPI\u201d) to the Client Agent  that mimics, for example, a subset of the standard Windows Volume, Directory, and File Management functions with certain added capabilities to reflect the temporal capabilities of the archive and more efficient transfer capabilities for volume restoration.","The Configuration Manager  fields requests from the Client Agent  related to bookkeeping tasks such as accepting configuration commands, archive integrity checks, and new downloads of Server Agent and Server Platform Software.","The Archive Manager  is responsible for all aspects of archival including archive integrity, formatting, compression, decompression, and revision control. The Archive Manager  has an interface allowing for all insertion, deletion, retrieval, query operations, and bookkeeping operations. Preferably, the Archive Manager  implements the following functions:\n\n","In our preferred embodiment, the Client Agent  cooperates with the Server Agent  to accomplish the following essential purposes:","Initial file system synchronization. Initially we have an empty archive. To create the initial archive, we perform a brute force enumeration of the client volume  and create an exact replica in the archive volume . Note that this can be performed while the system is in normal operation. While this process is taking place, our normal file system synchronization is also active, but the Archive Manager  will ignore changes logged by the Volume Monitor  that are within subtrees of the client volume  which the initial synchronization has not yet captured. After this one-time process is complete, the archive in the archive volume  will be a faithful reproduction of the client volume .","One primary goal of our invention is to properly archive each file system object with 100% accuracy. Accordingly, we need to preserve the data, attributes, ownership, and security information associated with each file system object. In general, at an application level, there appear to be two strategies, in a Windows environment, for copying an entire NTFS file object with high fidelity. One uses the Backup{Read,Write,Seek} functionality to identify and read each constituent of an object. The other uses Backup{Read,Seek} just to identify the constituents, and then uses other functions such as CreateFile (on streams), {Get,Set}[Named]SecurityInfo, and {Get,Set}FileSecurity to copy and preserve all constituent data. Additionally, we will copy all security descriptor information both in binary form (for easy restore) as well as in textual form. This latter form is to facilitate creating a meaningful mapping from archived descriptors to the descriptors on a new\/reinstalled computer during a restore. For example, ConvertSecurityDescriptorToStringSecurityDescriptor, ConvertSidToStringSid, and related functions provide the needed functionality.","The initial synchronization of the archive volume  with the client volume  is rather a complex task. We need to catalog all objects on the volume. For a static volume this is trivial. However, we have to assume that the volume will be changing even as we make our archive. The basic idea is to capture the current Change Journal pointer, catalog the volume, and then incorporate all changes that occurred during that cataloging process. Once we've got the catalog, we just monitor the Change Journal to keep up to date. Initial synchronization performs the following sequence of tasks:\n\n","By way of example, these functions can be realized using code similar in operation to the following pseudo-code fragments:",{"@attributes":{"id":"p-0057","num":"0109"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"void VolumeSetState( Volume v, VolumeState vs )"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Tell the USA to mark the state for the given volume and take"]},{"entry":[{},"\/\/ necessary bookkeeping actions."]},{"entry":[{},"\u201c system specific implementation code here\u201d"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":"void DatabaseInitialize ( )"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Initialize the database structure to an empty form."]},{"entry":[{},"\u201c system specific implementation code here\u201d"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":"BOOLEAN DatabaseHasEntry( FRN self )"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Is there any entry for this FRN?"]},{"entry":[{},"\u201c system specific implementation code here\u201d"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":"void DatabaseAdd("}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"FRN self,"]},{"entry":[{},"FRN parent,"]},{"entry":[{},"LPWSTR *name,"]},{"entry":[{},"USN *usn,"]},{"entry":[{},"int state"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":")"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Add an filesystem object to the database."]},{"entry":[{},"ASSERT( FALSE = = DatabaseHasEntry( self ));"]},{"entry":[{},"\u201c system specific implementation code here\u201d"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":"void DatabaseReplace("}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"FRN self,"]},{"entry":[{},"FRN parent,"]},{"entry":[{},"LPWSTR *name,"]},{"entry":[{},"USN *usn,"]},{"entry":[{},"int state"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":")"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Replace an filesystem object in the database."]},{"entry":[{},"ASSERT( TRUE = = DatabaseHasEntry( self ));"]},{"entry":[{},"\u201c system specific implementation code here\u201d"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":"void DatabaseRemove("}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"FRN self,"]},{"entry":[{},"FRN parent,"]},{"entry":[{},"LPWSTR *name,"]},{"entry":[{},"USN *usn,"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"int state"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":")"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Remove a filesystem object in the database."]},{"entry":[{},"ASSERT( TRUE = = DatabaseHasEntry( self ));"]},{"entry":[{},"\u201c system specific implementation code here\u201d"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":"void DatabaseQueueArchive( DATABASE_ENTRY *entry, int archive"},{"entry":"request )"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Queue a request to archive this object."]},{"entry":[{},"\u201c system specific implementation code here\u201d"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":"USN ChangeJournalGetNextUSN( )"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Return the next USN that will be written in the change"]},{"entry":[{},"\/\/ journal."]},{"entry":[{},"\u201c system specific implementation code here\u201d"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":"USN USA_next_usn = 0;"},{"entry":"void VolumeSetNextUSNToCheck( USN usn )"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Remember this as the next usn record we will care about."]},{"entry":[{},"USA_next_usn = usn;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":"USN VolumeGetNextUSNToCheck( )"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Return the next usn record we will care about."]},{"entry":[{},"return USA_next_usn;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":"void VolumeInitialSync( Volume v )"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"VolumeSetState( v, VOLUME_STATE_INITIALIZING );"]},{"entry":[{},"\/\/ Create an initial index of the volume, don't worry about"]},{"entry":[{},"\/\/ specifics, just the contents and structure as represented by"]},{"entry":[{},"\/\/ the node names, FRNs, and parent FRNs."]},{"entry":[{},"for (;;) {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Erase the database."]},{"entry":[{},"DatabaseInitialize( );"]},{"entry":[{},"\/\/ Bookmark the change journal before we start."]},{"entry":[{},"USN start_usn = ChangeJournalGetNextUSN( );"]},{"entry":[{},"\/\/ Add each member of the MFT to the database."]},{"entry":[{},"FOREACH_ENTRY_IN_MFT( entry, MFT( v )) {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"DatabaseAdd("]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"entry.frn,"]},{"entry":[{},"entry.parent_frn,"]},{"entry":[{},"entry.name,"]},{"entry":[{},"entry,"]},{"entry":[{},"NOT_ARCHIVED"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},");"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"USN finish_usn = ChangeJournalGetNextUSN( );"]},{"entry":[{},"FOREACH_USN_IN_RANGE( usn, start_usn, finish_usn ) {"]},{"entry":[{},"\/\/ Arguably we can handle any changes that occurred"]},{"entry":[{},"\/\/ while reading the MFT, but for now just punt."]},{"entry":[{},"goto repeat_the_loop;"]},{"entry":[{},"\/\/ If we see a create action, just add the entry,"]},{"entry":[{},"\/\/ overwriting any predecessor."]},{"entry":[{},"if (usn.type = = CREATE) {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"if (DatabaseHasEntry( usn.frn ))"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"DatabaseReplace("]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"usn.frn,"]},{"entry":[{},"usn.parent_frn,"]},{"entry":[{},"usn.name,"]},{"entry":[{},"usn,"]},{"entry":[{},"NOT_ARCHIVED"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},");"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"else"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"DatabaseAdd("]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"usn.frn,"]},{"entry":[{},"usn.parent_frn,"]},{"entry":[{},"usn.name,"]},{"entry":[{},"usn,"]},{"entry":[{},"NOT_ARCHIVED"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},");"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"\/\/ If we see a delete action, just delete the entry"]},{"entry":[{},"\/\/ if it's there."]},{"entry":[{},"else if (usn.type = = DELETE) {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"if (DatabaseHasEntry( usn.frn ))"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"DatabaseRemove( usn.frn );"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"\/\/ If we see a rename, replace whatever is there or"]},{"entry":[{},"\/\/ else create a new entry."]},{"entry":[{},"else if (usn.type = = RENAME) {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"if (DatabaseHasEntry( usn.frn ))"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"DatabaseReplace("]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"usn.frn,"]},{"entry":[{},"usn.parent_frn,"]},{"entry":[{},"usn.name,"]},{"entry":[{},"usn,"]},{"entry":[{},"NOT_ARCHIVED"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},");"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"else"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"DatabaseAdd("]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"usn.frn,"]},{"entry":[{},"usn.parent_frn,"]},{"entry":[{},"usn.name,"]},{"entry":[{},"usn,"]},{"entry":[{},"NOT_ARCHIVED"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},");"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"\/\/ Nothing else matters at this point in time."]},{"entry":[{},"else"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"\/\/ Ignore change."]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"VolumeSetNextUSNToCheck( finish_usn );"]},{"entry":[{},"VolumeSetState( v, VOLUME_STATE_INITIALIZED );"]},{"entry":[{},"break;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"repeat_the_loop:"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},";"]},{"entry":[{},"}"]},{"entry":[{},"\/\/ Now we know everything that's on the volume and we can use the"]},{"entry":[{},"\/\/ change journal to track all future changes."]},{"entry":[{},"\/\/ Queue a request to archive each and every object on the"]},{"entry":[{},"\/\/ volume."]},{"entry":[{},"FOREACH_ENTRY_IN_DATABASE( entry ) {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"DatabaseQueueArchive( entry, INITIAL_WRITE );"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"\/\/ Now we start the normal monitoring process."]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]}}]}}},"Normal file system synchronization. This is the essential everyday task performed by the stand-alone system . As the user works on the Client , the SA  watches, updating the archive with changes made to the protected volumes. In general, there are a number of mechanisms for detecting volume changes. For example, if the OS  is either Windows 2000 or Windows XP, the following methods are possible:\n\n","Normal file system resynchronization. Whenever the Client  boots, the Archive Manager  must resynchronize the archive volume  to the client volume . By way of example, the essential resynchronization functions can be realized using code similar in operation to the following pseudo-code fragments:",{"@attributes":{"id":"p-0060","num":"0127"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"void VolumeResync( Volume v )"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ This shouldn't happen unless the USA is busted or was moved from"]},{"entry":[{},"\/\/ one computer to another."]},{"entry":[{},"if (\u201cServerAgent does not have valid Change Journal\u201d) {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"VolumeInitialSync( v ); \/\/ Force complete copy of volume."]},{"entry":[{},"return;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"\/\/ Delete any partially archived file"]},{"entry":[{},"if (last entry in Change Journal is \u201cOpen\u201d) {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\u201cpurge any record written in Archive Manager queue\u201d"]},{"entry":[{},"\u201cwrite matching Cancel entry in Change Journal\u201d"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"\/\/ USN on the Client has lost entries we need"]},{"entry":[{},"if (\u201cUSN of last Server Change Journal entry is not available on"]},{"entry":[{},"Client\u201d) {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"VolumeInitialSync( v ); \/\/ Force complete copy of volume."]},{"entry":[{},"Return;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"\u201cSet next USN for Volume Monitor to be that following the USN in"]},{"entry":[{},"last Server Change Journal entry\u201d"]},{"entry":[{},"\/\/ Now we can proceed with normal file synchronization."]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]}}]}}},"Extraordinary file system resynchronization. From time to time something unfortunate happens. Generally, this is a system crash although other, even less benign events can also take place. In general, there are two potential failure modes:\n\n","In accordance with the preferred embodiment of our invention, we provide a method and apparatus for automatically archiving, in essentially real-time, the contents of the on-line file systems of a digital data processor while, at the same time, controlling the size of the archive by selectively discarding older versions of current files. We call our method graceful degradation or simply \u201cGD\u201d. GD is a new approach to archival storage. In general, GD provides the accuracy of continuous storage with far greater storage efficiency. As with continuous storage, the file system remains available 100% of the time during the archival process. GD's storage efficiency is the result of an innovative approach to archival management.","In a typical backup system, all backups are kept until they reach a designated age at which point they are discarded. The real world equivalent is the requirement to keep your financial records intact until some point in time, after which they can be (perhaps!) safely discarded. If you keep your records twice as long, you're probably going to need about twice as much space to store them. In this approach, space grows linearly with the length of time covered by the archive. The objective of GD is to allow you to keep your records with only logarithmic growth in required space as the length of time covered by the archive increases.","GD works by initially recording file system changes in the same manner as continuous archival. It differs in its treatment of the management of archival objects as they age. Assume we wish to keep all files for four weeks. In a typical archival system all changes would be kept for four weeks after they are recorded and then be discarded. GD works by filtering the archive. Recently recorded changes are all left intact. We might choose to keep just half of the changes that are in the archive more than a few hours. Those that were recorded more than a week ago we might choose to keep even fewer. In this manner we can drastically reduce the amount of storage used in the archive, while at the same time keeping a very precise record of recent changes, which a user is most likely to need.","Another possible implementation of GD is to establish age intervals and allow just a limited number of copies of an object within each interval. For example, imagine we wish to make available to the user every copy (revision) of a frequently edited file within the past 15 minutes, and one copy during the next 15 minutes, then once per hour out to 24 hours, then once per day out to 7 days, then once per week out to four weeks. GD allows us to do this, providing the full benefit of continuous backup when it is really useful\u2014when working with the most recently accessed file system objects\u2014while also providing efficient use of storage by retaining fewer and fewer revisions of file system objects as they age.","In effect GD is a filter applied to the set of revisions of each file system object stored on the archive media. A GD filter can be applied each time a new object revision is added to the archive, or it can be applied lazily, either when the backup system is idle or when available storage drops below a safe level and we need to throw out some old revisions we no longer need.","Sample GD Algorithm","We describe a sample GD algorithm which divides time into a sequence of age intervals. When the GD algorithm is applied, we keep just the oldest revision of each object present in each age interval. Special consideration is given to ensure we also keep the most recent revision. Special consideration is also given to ensure we keep at least one revision of the object, regardless of how old it becomes; we need to do this since some objects never change, so our initial snapshot of an object may be the only one we ever make and we'll need it to properly restore this object should the need arise.","A sequence of n age intervals is represented by an array A, with n+1 elements indexed from Ato A. Each element in A specifies a time delta relative to the time at which the filter is applied, typically the current time. By definition Acontains any value less than zero and Acontains the value 0. By definition A<Afor all i from 0 to n\u22121. We refer to the array A as a GD filter. For example, consider the filter:\n\n","In this discussion t is our unit of time, which could be any relevant measure. (E.g., minutes.)","We determine in which age interval each object revision belongs as follows. Given a current time now(t), age interval i includes all those object revisions with timestamps TS such that:\n\n","Assume now(t)=37t. Given the above filter we have six age intervals which cover the following time intervals:",{"@attributes":{"id":"p-0072","num":"0144"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"center"}},"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"Age Interval"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":{}}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"105pt","align":"right"}},{"@attributes":{"colname":"2","colwidth":"112pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["(37-(\u22121))t >","TS >= (37-0)t"]},{"entry":["(37-0)t >","TS >= (37-1)t"]},{"entry":["(37-1)t >","TS >= (37-2)t"]},{"entry":["(37-2)t >","TS >= (37-4)t"]},{"entry":["(37-4)t >","TS >= (37-6)t"]},{"entry":["(37-6)t >","TS >= (37-10)t"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}}},"Graceful degradation works by applying the time filter to the revision set of an object. The revision set of the object tags each revision with a timestamp which we use for the GD filter.","Consider an object with revisions with the timestamps as shown:\n\n","Assume the current time is 37t and as shown we just wrote a new revision of our file system object at 37t. At time 37t our intervals using the above filter and the timestamps of the revisions that map to them would be:",{"@attributes":{"id":"p-0076","num":"0149"},"tables":{"@attributes":{"id":"TABLE-US-00004","num":"00004"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"91pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"91pt","align":"center"}}],"thead":{"row":[{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]},{"entry":[{},"Age Interval","Revisions"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":{}}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"4"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"42pt","align":"right"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"91pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"(37-(\u22121))t >","TS >= (37-0)t","37t"]},{"entry":[{},"(37-0)t >","TS >= (37-1)t"]},{"entry":[{},"(37-1)t >","TS >= (37-2)t"]},{"entry":[{},"(37-2)t >","TS >= (37-4)t","34t, 33t"]},{"entry":[{},"(37-4)t >","TS >= (37-6)t","31t"]},{"entry":[{},"(37-6)t >","TS >= (37-10)t","30t, 29t"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"3","align":"center","rowsep":"1"}}]}]}}]}}},"Note that the revisions with timestamps 25t, 22t, 15t, and 7t have aged beyond our level of interest and do not map to any age interval.","The result of running the filter GD(now(t), A, n, R, m) is:\n\n","Earlier, we mentioned that we pay special attention to ensure we always keep the most recent revision of an object. We also said we need to ensure that at least a single revision of each object is present at all time. We accomplish both tasks by modifying our GD filter with the additional step:\n\n","The GD filter can be precisely described as such:",{"@attributes":{"id":"p-0081","num":"0156"},"tables":{"@attributes":{"id":"TABLE-US-00005","num":"00005"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Set GD("}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Timestamp now,","\/\/ the time relative to which the filter is to be"]},{"entry":[{},{},"applied"]},{"entry":[{},"Array A[0 . . . n],","\/\/ array containing coefficients for n age intervals"]},{"entry":[{},"Integer n,","\/\/ count of age intervals"]},{"entry":[{},"Set R{ },","\/\/ set of timestamps for revisions to be filtered"]},{"entry":[{},"Integer m","\/\/ number of timestamps in R"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":")"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Set NEWR := { };"]},{"entry":[{},"FOR EACH INTEGER i FROM 0 TO n-1 INCLUSIVE {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Set TMP := { };"]},{"entry":[{},"FOR EACH MEMBER e in SET R {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"If (e >= (now \u2212 A[i+1]) AND e < (now \u2212 A[i]))"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"TMP := union( TMP, e );"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"If (TMP != { })"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"NEWR := union( NEWR, min( TMP ));"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"NEWR := union( NEWR, max( R ));"]},{"entry":[{},"Return NEWR;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]}}]}}},"This is but one possible algorithm. Note that the choice of which revision to keep in each interval is critical. A selection method that is guaranteed to fail in certain pathological cases is to always keep the youngest element in each interval. It is easy to construct cases whereby objects don't age at all whenever more than a single revision can map to a single interval. Consider the filter [\u22121t, 0t, 1t, 3t, 5t, 7t] with an input of new revisions generated once per t unit of time. Each time the GD filter is applied to the interval 1t>R>=3t the oldest element is pruned, preventing any revision from advancing to the next interval.","One simple enhancement is to allow keeping more than a single revision in each age interval by associating an interval capacity with each interval. There are a variety of approaches to selecting which elements to keep. One good algorithm is to allow just a single element in each age interval except for the first few intervals which can each contain an unlimited number of revisions. This allows archival of unlimited edits until they age to a certain point, after which the age interval system precisely controls the amount of storage required.","Age intervals in filters can be any size, with the size defined by our goals. In the framework given above, we can model a typical backup sequence that keeps a new snapshot once per day and then recycles the snapshot media after two weeks as [\u22121t, 0t, 1t, 2t, . . . , 14t] where the value of t in this case is one day. To model a backup where we keep a single snapshot per hour out to 24 hours and then one per day out to 1 week, we would use [\u22121t, 0t, 1t, 2t, . . . , 24t, 48t, 72t, . . . 168t] where in this case t represents a single hour.","While intervals can be any size, in order to meet our objective, the sizes of the intervals should grow as we move to higher array indices (i.e., further in the past).","Here is an example of a linear filter, similar to typical backups showing the status of the archive over time. We assume a filter:\n\n",{"@attributes":{"id":"p-0087","num":"0163"},"tables":{"@attributes":{"id":"TABLE-US-00006","num":"00006"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"308pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Filter is \u22121 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"17"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"4","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"5","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"6","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"7","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"8","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"9","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"10","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"11","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"12","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"13","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"14","colwidth":"14pt","align":"center"}},{"@attributes":{"colname":"15","colwidth":"14pt","align":"center"}},{"@attributes":{"colname":"16","colwidth":"14pt","align":"center"}},{"@attributes":{"colname":"17","colwidth":"14pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Adding","\u20020, archive becomes:","0",{},{},{},{},{},{},{},{},{},{},{},{},{},{}]},{"entry":["Adding","\u20021, archive becomes:","1","0"]},{"entry":["Adding","\u20022, archive becomes:","2","1","0"]},{"entry":["Adding","\u20023, archive becomes:","3","2","1","0"]},{"entry":["Adding","\u20024, archive becomes:","4","3","2","1","0"]},{"entry":["Adding","\u20025, archive becomes:","5","4","3","2","1","0"]},{"entry":["Adding","\u20026, archive becomes:","6","5","4","3","2","1","0"]},{"entry":["Adding","\u20027, archive becomes:","7","6","5","4","3","2","1","0"]},{"entry":["Adding","\u20028, archive becomes:","8","7","6","5","4","3","2","1","0"]},{"entry":["Adding","\u20029, archive becomes:","9","8","7","6","5","4","3","2","1","0"]},{"entry":["Adding","10, archive becomes:","10","9","8","7","6","5","4","3","2","1","0"]},{"entry":["Adding","11, archive becomes:","11","10","9","8","7","6","5","4","3","2","1","0"]},{"entry":["Adding","12, archive becomes:","12","11","10","9","8","7","6","5","4","3","2","1","0"]},{"entry":["Adding","13, archive becomes:","13","12","11","10","9","8","7","6","5","4","3","2","1","0"]},{"entry":["Adding","14, archive becomes:","14","13","12","11","10","9","8","7","6","5","4","3","2","1","0"]},{"entry":["Adding","15, archive becomes:","15","14","13","12","11","10","9","8","7","6","5","4","3","2","1"]},{"entry":["Adding","16, archive becomes:","16","15","14","13","12","11","10","9","8","7","6","5","4","3","2"]},{"entry":["Adding","17, archive becomes:","17","16","15","14","13","12","11","10","9","8","7","6","5","4","3"]},{"entry":["Adding","18, archive becomes:","18","17","16","15","14","13","12","11","10","9","8","7","6","5","4"]},{"entry":["Adding","19, archive becomes:","19","18","17","16","15","14","13","12","11","10","9","8","7","6","5"]},{"entry":["Adding","20, archive becomes:","20","19","18","17","16","15","14","13","12","11","10","9","8","7","6"]},{"entry":{"@attributes":{"namest":"1","nameend":"17","align":"center","rowsep":"1"}}}]}}]}}},"Note that the size of the archive grows linearly with time. Captured revisions are available at equally spaced intervals.","Now, here's the same filter applied to object changes at times t, t, t, . . . t, t:",{"@attributes":{"id":"p-0090","num":"0166"},"tables":{"@attributes":{"id":"TABLE-US-00007","num":"00007"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Filter is \u22121 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"9"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"4","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"5","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"6","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"7","colwidth":"14pt","align":"center"}},{"@attributes":{"colname":"8","colwidth":"21pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Adding","\u20020, archive becomes:","0",{},{},{},{},{}]},{"entry":[{},"Adding","\u20023, archive becomes:","3","0"]},{"entry":[{},"Adding","\u20026, archive becomes:","6","3","0"]},{"entry":[{},"Adding","\u20029, archive becomes:","9","6","3","0"]},{"entry":[{},"Adding","12, archive becomes:","12","9","6","3","0"]},{"entry":[{},"Adding","15, archive becomes:","15","12","9","6","3"]},{"entry":[{},"Adding","18, archive becomes:","18","15","12","9","6"]},{"entry":[{},"Adding","21, archive becomes:","21","18","15","12","9"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"8","align":"center","rowsep":"1"}}]}]}}]}}},"Again, notice that we capture revisions at equally spaced points in time.","Now let's try a linear filter where the changes come at intervals smaller than our age intervals. Let's use the filter:\n\n",{"@attributes":{"id":"p-0093","num":"0170"},"tables":{"@attributes":{"id":"TABLE-US-00008","num":"00008"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"259pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Filter is \u22121 0 2 4 6 8 10 12 14 16 18 20 22 24 26 28"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"13"},"colspec":[{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"4","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"5","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"6","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"7","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"8","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"9","colwidth":"14pt","align":"center"}},{"@attributes":{"colname":"10","colwidth":"14pt","align":"center"}},{"@attributes":{"colname":"11","colwidth":"14pt","align":"center"}},{"@attributes":{"colname":"12","colwidth":"14pt","align":"center"}},{"@attributes":{"colname":"13","colwidth":"14pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Adding","\u20020, archive becomes:","0",{},{},{},{},{},{},{},{},{},{}]},{"entry":["Adding","\u20021, archive becomes:","1","0"]},{"entry":["Adding","\u20022, archive becomes:","2","0"]},{"entry":["Adding","\u20023, archive becomes:","3","2","0"]},{"entry":["Adding","\u20024, archive becomes:","4","2","0"]},{"entry":["Adding","\u20025, archive becomes:","5","4","2","0"]},{"entry":["Adding","\u20026, archive becomes:","6","4","2","0"]},{"entry":["Adding","\u20027, archive becomes:","7","6","4","2","0"]},{"entry":["Adding","\u20028, archive becomes:","8","6","4","2","0"]},{"entry":["Adding","\u20029, archive becomes:","9","8","6","4","2","0"]},{"entry":["Adding","10, archive becomes:","10","8","6","4","2","0"]},{"entry":["Adding","11, archive becomes:","11","10","8","6","4","2","0"]},{"entry":["Adding","12, archive becomes:","12","10","8","6","4","2","0"]},{"entry":["Adding","13, archive becomes:","13","12","10","8","6","4","2","0"]},{"entry":["Adding","14, archive becomes:","14","12","10","8","6","4","2","0"]},{"entry":["Adding","15, archive becomes:","15","14","12","10","8","6","4","2","0"]},{"entry":["Adding","16, archive becomes:","16","14","12","10","8","6","4","2","0"]},{"entry":["Adding","17, archive becomes:","17","16","14","12","10","8","6","4","2","0"]},{"entry":["Adding","18, archive becomes:","18","16","14","12","10","8","6","4","2","0"]},{"entry":["Adding","19, archive becomes:","19","18","16","14","12","10","8","6","4","2","0"]},{"entry":["Adding","20, archive becomes:","20","18","16","14","12","10","8","6","4","2","0"]},{"entry":{"@attributes":{"namest":"1","nameend":"13","align":"center","rowsep":"1"}}}]}}]}},"br":{}},"While it's nice to know that we can emulate the normal behavior of traditional linear backups, our interest is in saving space. Consider a filter that keeps one backup per hour out to 4 hours, then one every four hours out to 16 hours, and then one daily out to 7 days. Where t is one hour, we can represent this as follows:\n\n",{"@attributes":{"id":"p-0095","num":"0173"},"tables":{"@attributes":{"id":"TABLE-US-00009","num":"00009"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"385pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Filter is \u22121 0 1 2 3 4 8 12 16 24 48 72 96 120 144 168"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"17"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"4","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"5","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"6","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"7","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"8","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"9","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"10","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"11","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"12","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"13","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"14","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"15","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"16","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"17","colwidth":"14pt","align":"char","char":"."}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Adding","\u20030, archive becomes:","0",{},{},{},{},{},{},{},{},{},{},{},{},{},{}]},{"entry":["Adding","\u20031, archive becomes:","1","0"]},{"entry":["Adding","\u20032, archive becomes:","2","1","0"]},{"entry":["Adding","\u20033, archive becomes:","3","2","1","0"]},{"entry":["Adding","\u20034, archive becomes:","4","3","2","1","0"]},{"entry":["Adding","\u20035, archive becomes:","5","4","3","2","1","0"]},{"entry":["Adding","\u20036, archive becomes:","6","5","4","3","2","0"]},{"entry":["Adding","\u20037, archive becomes:","7","6","5","4","3","0"]},{"entry":["Adding","\u20038, archive becomes:","8","7","6","5","4","0"]},{"entry":["Adding","\u20039, archive becomes:","9","8","7","6","5","4","0"]},{"entry":["Adding","\u200210, archive becomes:","10","9","8","7","6","4","0"]},{"entry":["Adding","\u200211, archive becomes:","11","10","9","8","7","4","0"]},{"entry":["Adding","\u200212, archive becomes:","12","11","10","9","8","4","0"]},{"entry":["Adding","\u200213, archive becomes:","13","12","11","10","9","8","4","0"]},{"entry":["Adding","\u200214, archive becomes:","14","13","12","11","10","8","4","0"]},{"entry":["Adding","\u200215, archive becomes:","15","14","13","12","11","8","4","0"]},{"entry":["Adding","\u200216, archive becomes:","16","15","14","13","12","8","4","0"]},{"entry":["Adding","\u200217, archive becomes:","17","16","15","14","13","12","8","4","0"]},{"entry":["Adding","\u200218, archive becomes:","18","17","16","15","14","12","8","4","0"]},{"entry":". . ."},{"entry":["Adding","\u200224, archive becomes:","24","23","22","21","20","16","12","8","0"]},{"entry":["Adding","\u200225, archive becomes:","25","24","23","22","21","20","16","12","8","0"]},{"entry":["Adding","\u200226, archive becomes:","26","25","24","23","22","20","16","12","8","0"]},{"entry":". . ."},{"entry":["Adding","\u200232, archive becomes:","32","31","30","29","28","24","20","16","8","0"]},{"entry":["Adding","\u200233, archive becomes:","33","32","31","30","29","28","24","20","16","0"]},{"entry":["Adding","\u200234, archive becomes:","34","33","32","31","30","28","24","20","16","0"]},{"entry":". . ."},{"entry":["Adding","\u200240, archive becomes:","40","39","38","37","36","32","28","24","16","0"]},{"entry":["Adding","\u200241, archive becomes:","41","40","39","38","37","36","32","28","24","0"]},{"entry":["Adding","\u200242, archive becomes:","42","41","40","39","38","36","32","28","24","0"]},{"entry":". . ."},{"entry":["Adding","\u200248, archive becomes:","48","47","46","45","44","40","36","32","24","0"]},{"entry":["Adding","\u200249, archive becomes:","49","48","47","46","45","44","40","36","32","24","0"]},{"entry":["Adding","\u200250, archive becomes:","50","49","48","47","46","44","40","36","32","24","0"]},{"entry":". . ."},{"entry":["Adding","\u200272, archive becomes:","72","71","70","69","68","64","60","56","48","24","0"]},{"entry":["Adding","\u200273, archive becomes:","73","72","71","70","69","68","64","60","56","48","24","0"]},{"entry":["Adding","\u200274, archive becomes:","74","73","72","71","70","68","64","60","56","48","24","0"]},{"entry":". . ."},{"entry":["Adding","\u200296, archive becomes:","96","95","94","93","92","88","84","80","72","48","24","0"]},{"entry":["Adding","\u200297, archive becomes:","97","96","95","94","93","92","88","84","80","72","48","24","0"]},{"entry":["Adding","\u200298, archive becomes:","98","97","96","95","94","92","88","84","80","72","48","24","0"]},{"entry":". . ."},{"entry":["Adding","168, archive becomes:","168","167","166","165","164","160","156","152","144","120","96","72","48","24","0"]},{"entry":["Adding","169, archive becomes:","169","168","167","166","165","164","160","156","152","144","120","96","72","48","24"]},{"entry":["Adding","170, archive becomes:","170","169","168","167","166","164","160","156","152","144","120","96","72","48","24"]},{"entry":{"@attributes":{"namest":"1","nameend":"17","align":"center","rowsep":"1"}}}]}}]}},"br":{}},"As with linear filters, GD exhibits good behavior with hand crafted filters regardless of the frequency of occurrence or timing of updates.","To this point, we've applied the filter after the insertion of each new revision. Because applying a filter is computationally expensive, it may be advantageous to filter a revision set only occasionally, either when storage space is low, or when the system is otherwise idle. Here is the prior example, but with the GD filter applied only after every 10 revisions are added, rather than at each insertion. The results:",{"@attributes":{"id":"p-0098","num":"0176"},"tables":{"@attributes":{"id":"TABLE-US-00010","num":"00010"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"441pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Filter is \u22121 0 1 2 3 4 8 12 16 24 48 72 96 120 144 168"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"21"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"4","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"5","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"6","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"7","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"8","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"9","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"10","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"11","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"12","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"13","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"14","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"15","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"16","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"17","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"18","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"19","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"20","colwidth":"14pt","align":"char","char":"."}},{"@attributes":{"colname":"21","colwidth":"14pt","align":"char","char":"."}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Adding","\u20030, archive becomes:","0",{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{}]},{"entry":["Adding","\u20031, archive becomes:","1","0"]},{"entry":["Adding","\u20032, archive becomes:","2","1","0"]},{"entry":["Adding","\u20033, archive becomes:","3","2","1","0"]},{"entry":["Adding","\u20034, archive becomes:","4","3","2","1","0"]},{"entry":["Adding","\u20035, archive becomes:","5","4","3","2","1","0"]},{"entry":["Adding","\u20036, archive becomes:","6","5","4","3","2","1","0"]},{"entry":["Adding","\u20037, archive becomes:","7","6","5","4","3","2","1","0"]},{"entry":["Adding","\u20038, archive becomes:","8","7","6","5","4","3","2","1","0"]},{"entry":["Adding","\u20039, archive becomes:","9","8","7","6","5","4","3","2","1","0"]},{"entry":["Adding","\u200210, archive becomes:","10","9","8","7","6","2","0"]},{"entry":["Adding","\u200211, archive becomes:","11","10","9","8","7","6","2","0"]},{"entry":["Adding","\u200212, archive becomes:","12","11","10","9","8","7","6","2","0"]},{"entry":["Adding","\u200213, archive becomes:","13","12","11","10","9","8","7","6","2","0"]},{"entry":["Adding","\u200214, archive becomes:","14","13","12","11","10","9","8","7","6","2","0"]},{"entry":["Adding","\u200215, archive becomes:","15","14","13","12","11","10","9","8","7","6","2","0"]},{"entry":["Adding","\u200216, archive becomes:","16","15","14","13","12","11","10","9","8","7","6","2","0"]},{"entry":["Adding","\u200217, archive becomes:","17","16","15","14","13","12","11","10","9","8","7","6","2","0"]},{"entry":["Adding","\u200218, archive becomes:","18","17","16","15","14","13","12","11","10","9","8","7","6","2","0"]},{"entry":". . ."},{"entry":["Adding","\u200224, archive becomes:","24","23","22","21","20","19","18","17","16","12","8","6","0"]},{"entry":["Adding","\u200225, archive becomes:","25","24","23","22","21","20","19","18","17","16","12","8","6","0"]},{"entry":["Adding","\u200226, archive becomes:","26","25","24","23","22","21","20","19","18","17","16","12","8","6","0"]},{"entry":". . ."},{"entry":["Adding","\u200232, archive becomes:","32","31","30","29","28","27","26","22","18","16","6","0"]},{"entry":["Adding","\u200233, archive becomes:","33","32","31","30","29","28","27","26","22","18","16","6","0"]},{"entry":["Adding","\u200234, archive becomes:","34","33","32","31","30","29","28","27","26","22","18","16","6","0"]},{"entry":". . ."},{"entry":["Adding","\u200240, archive becomes:","40","39","38","37","36","32","28","26","16","0"]},{"entry":["Adding","\u200241, archive becomes:","41","40","39","38","37","36","32","28","26","16","0"]},{"entry":["Adding","\u200242, archive becomes:","42","41","40","39","38","37","36","32","28","26","16","0"]},{"entry":". . ."},{"entry":["Adding","\u200248, archive becomes:","48","47","46","45","44","43","42","41","40","39","38","37","36","32","28","26","16","0"]},{"entry":["Adding","\u200249, archive becomes:","49","48","47","46","45","44","43","42","41","40","39","38","37","36","32","28","26","16","0"]},{"entry":["Adding","\u200250, archive becomes:","50","49","48","47","46","42","38","36","26","16","0"]},{"entry":". . ."},{"entry":["Adding","\u200272, archive becomes:","72","71","70","69","68","67","66","62","58","56","46","36","0"]},{"entry":["Adding","\u200273, archive becomes:","73","72","71","70","69","68","67","66","62","58","56","46","36","0"]},{"entry":["Adding","\u200274, archive becomes:","74","73","72","71","70","69","68","67","66","62","58","56","46","36","0"]},{"entry":". . ."},{"entry":["Adding","\u200296, archive becomes:","96","95","94","93","92","91","90","89","88","87","86","82","78","76","66","56","36","0"]},{"entry":["Adding","\u200297, archive becomes:","97","96","95","94","93","92","91","90","89","88","87","86","82","78","76","66","56","36","0"]},{"entry":["Adding","\u200298, archive becomes:","98","97","96","95","94","93","92","91","90","89","88","87","86","82","78","76","66","56","36"]},{"entry":[{},{},"0"]},{"entry":". . ."},{"entry":["Adding","168, archive becomes:","168","167","166","165","164","163","162","161","160","159","158"]},{"entry":[{},{},"157","156","152","148","146","136","116","96","76","36","0"]},{"entry":["Adding","169, archive becomes:","169","168","167","166","165","164","163","162","161","160","159"]},{"entry":[{},{},"158","157","156","152","148","146","136","116","96","76","36","0"]},{"entry":["Adding","170, archive becomes:","170","169","168","167","166","162","158","156","146","136","116","76","36"]},{"entry":{"@attributes":{"namest":"1","nameend":"21","align":"center","rowsep":"1"}}}]}}]}}},"Note that while the results are not identical, they exhibit the same characteristics as the prior example.","GD filters are not restricted to any particular patterns. They can be designed to be linear, hand crafted as in the above example, or they can be modeled after naturally occurring sequences such as logarithmic and Fibonacci progressions, or modeled after mathematically interesting progressions such as powers of two.",{"@attributes":{"id":"p-0101","num":"0000"},"ul":{"@attributes":{"id":"ul0043","list-style":"none"},"li":{"@attributes":{"id":"ul0043-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0044","list-style":"none"},"li":"A=[\u22121t, 0t, 2t, 3t, 5t, 8t, 13t, 21t, 34t, 55t, 89t, 144t, 233t, 377t, 610t, 987t]\n\napplied to the sequence t, t, t, t, . . . t yields:\n"}}}},{"@attributes":{"id":"p-0102","num":"0180"},"tables":{"@attributes":{"id":"TABLE-US-00011","num":"00011"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"343pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Filter is \u22121 0 2 3 5 8 13 21 34 55 89 144 233 377 610 987"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"14"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"4","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"5","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"6","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"7","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"8","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"9","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"10","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"11","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"12","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"13","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"14","colwidth":"14pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Adding","\u20030, archive becomes:","0",{},{},{},{},{},{},{},{},{},{},{}]},{"entry":["Adding","\u20033, archive becomes:","3","0"]},{"entry":["Adding","\u20036, archive becomes:","6","3","0"]},{"entry":["Adding","\u20039, archive becomes:","9","6","3","0"]},{"entry":["Adding","\u200212, archive becomes:","12","9","6","0"]},{"entry":["Adding","\u200215, archive becomes:","15","12","9","6","0"]},{"entry":["Adding","\u200218, archive becomes:","18","15","12","6","0"]},{"entry":["Adding","\u200221, archive becomes:","21","18","15","12","0"]},{"entry":["Adding","\u200224, archive becomes:","24","21","18","12","0"]},{"entry":["Adding","\u200227, archive becomes:","27","24","21","18","12","0"]},{"entry":["Adding","\u200230, archive becomes:","30","27","24","18","12","0"]},{"entry":["Adding","\u200233, archive becomes:","33","30","27","24","12","0"]},{"entry":["Adding","\u200236, archive becomes:","36","33","30","24","12","0"]},{"entry":". . ."},{"entry":["Adding","984, archive becomes:","984","981","978","972","960","936","912","864","768","384","0"]},{"entry":["Adding","987, archive becomes:","987","984","981","978","972","960","936","912","864","768","384","0"]},{"entry":["Adding","990, archive becomes:","990","987","984","978","972","960","936","912","864","768","384"]},{"entry":["Adding","993, archive becomes:","993","990","987","984","972","960","912","864","768","384"]},{"entry":["Adding","996, archive becomes:","996","993","990","984","972","960","912","864","768","384"]},{"entry":["Adding","999, archive becomes:","999","996","993","990","984","972","960","912","864","768","384"]},{"entry":{"@attributes":{"namest":"1","nameend":"14","align":"center","rowsep":"1"}}}]}}]}}},{"@attributes":{"id":"p-0103","num":"0000"},"ul":{"@attributes":{"id":"ul0045","list-style":"none"},"li":{"@attributes":{"id":"ul0045-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0046","list-style":"none"},"li":"A=[\u22121t, 0t, 1t, 2t, 4t, 8t, 16t, 32t, 64t, 128t, 256t, 512t, 1024t, 2048t, 4096t, 8192t]"}}}},"Applied to the sequence t, t, t, . . . t yields:",{"@attributes":{"id":"p-0105","num":"0183"},"tables":{"@attributes":{"id":"TABLE-US-00012","num":"00012"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"350pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Filter is \u22121 0 1 2 4 8 16 32 64 128 256 512 1024 2048 4096 8192"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"14"},"colspec":[{"@attributes":{"colname":"1","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"77pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"4","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"5","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"6","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"7","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"8","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"9","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"10","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"11","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"12","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"13","colwidth":"21pt","align":"char","char":"."}},{"@attributes":{"colname":"14","colwidth":"14pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Adding","\u2003\u20020, archive becomes:","0",{},{},{},{},{},{},{},{},{},{},{}]},{"entry":["Adding","\u2003\u20021, archive becomes:","1","0"]},{"entry":["Adding","\u2003\u20022, archive becomes:","2","1","0"]},{"entry":["Adding","\u2003\u20023, archive becomes:","3","2","1","0"]},{"entry":["Adding","\u2003\u20024, archive becomes:","4","3","2","0"]},{"entry":["Adding","\u2003\u20025, archive becomes:","5","4","3","2","0"]},{"entry":["Adding","\u2003\u20026, archive becomes:","6","5","4","2","0"]},{"entry":["Adding","\u2003\u20027, archive becomes:","7","6","5","4","0"]},{"entry":["Adding","\u2003\u20028, archive becomes:","8","7","6","4","0"]},{"entry":["Adding","\u2003\u20029, archive becomes:","9","8","7","6","4","0"]},{"entry":["Adding","\u200310, archive becomes:","10","9","8","6","4","0"]},{"entry":". . ."},{"entry":["Adding","\u2002990, archive becomes:","990","989","988","986","984","976","960","928","896","768","512","0"]},{"entry":["Adding","\u2002991, archive becomes:","991","990","989","988","984","976","960","928","896","768","512","0"]},{"entry":["Adding","\u2002992, archive becomes:","992","991","990","988","984","976","960","928","896","768","512","0"]},{"entry":["Adding","\u2002993, archive becomes:","993","992","991","990","988","984","976","960","896","768","512","0"]},{"entry":["Adding","\u2002994, archive becomes:","994","993","992","990","988","984","976","960","896","768","512","0"]},{"entry":["Adding","\u2002995, archive becomes:","995","994","993","992","988","984","976","960","896","768","512","0"]},{"entry":["Adding","\u2002996, archive becomes:","996","995","994","992","988","984","976","960","896","768","512","0"]},{"entry":["Adding","\u2002997, archive becomes:","997","996","995","994","992","984","976","960","896","768","512","0"]},{"entry":["Adding","\u2002998, archive becomes:","998","997","996","994","992","984","976","960","896","768","512","0"]},{"entry":["Adding","\u2002999, archive becomes:","999","998","997","996","992","984","976","960","896","768","512","0"]},{"entry":["Adding","1000, archive becomes:","1000","999","998","996","992","984","976","960","896","768","512","0"]},{"entry":{"@attributes":{"namest":"1","nameend":"14","align":"center","rowsep":"1"}}}]}}]}}},"The class of GD filters described above guarantee that a revision set with at least a single revision, will always contain at least a single revision. This is because in addition to keeping at least one revision found within each age interval, we always keep the most recent revision, regardless of whether it maps to an age interval of the GD filter. This is important, since many files are created once and then never changed. Examples include operating system and application files which are created at installation but otherwise unchanged by the user.","Assume the following linear filter:\n\n","Here is the content of the revision set over time with the sole object revision added at time t and the filter applied once per time period:",{"@attributes":{"id":"p-0109","num":"0188"},"tables":{"@attributes":{"id":"TABLE-US-00013","num":"00013"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Filter is \u22121 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"77pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"49pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Adding","\u2003\u20020, archive becomes:","0",{}]},{"entry":[{},"Pruning at","\u2003\u20020, archive becomes:","0"]},{"entry":[{},"Pruning at","\u2003\u20021, archive becomes:","0"]},{"entry":[{},"Pruning at","\u2003\u20022, archive becomes:","0"]},{"entry":[{},"Pruning at","\u2003\u20023, archive becomes:","0"]},{"entry":[{},"Pruning at","\u2003\u20024, archive becomes:","0"]},{"entry":[{},"Pruning at","\u2003\u20025, archive becomes:","0"]},{"entry":[{},". . ."]},{"entry":[{},"Pruning at","\u2002994, archive becomes:","0"]},{"entry":[{},"Pruning at","\u2002995, archive becomes:","0"]},{"entry":[{},"Pruning at","\u2002996, archive becomes:","0"]},{"entry":[{},"Pruning at","\u2002997, archive becomes:","0"]},{"entry":[{},"Pruning at","\u2002998, archive becomes:","0"]},{"entry":[{},"Pruning at","\u2002999, archive becomes:","0"]},{"entry":[{},"Pruning at","1000, archive becomes:","0"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"4","align":"center","rowsep":"1"}}]}]}}]}},"br":{}},"There are some special cases that occur in common usage of a file system that we must properly handle. Specifically, files and directories can be renamed, and files and directories can be deleted and then new files reusing the same name created. In addition, there may be cases where we choose to tag specific revisions for preservation even where the GD filter would remove them. For example, when the SA  first copies an entire protected file system to the archive volume , we might wish to keep that very first copy, regardless of any changes that occur later in time.","To facilitate our enhanced GD algorithm, we define the following key data structures used by the Archive Manager  to represent stored data:","FileData Datatype","This data structure is an implementation-dependent representation of a file, including its contents such as the text of a document or executable code of a program, as well as information which represents file system security control such as who can read or execute the file as well as other attributes such as whether this is a file or directory, hidden or system file, file create time, last file modified time, etc.","Note that as used by the Archive Manager , all elements of the file data structure correspond to a specific revision of a file, not to the current instance of the file in the protected file system.",{"@attributes":{"id":"p-0115","num":"0194"},"tables":{"@attributes":{"id":"TABLE-US-00014","num":"00014"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"154pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Typedef FileData {"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"77pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"140pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"\u201cImplementation-specific\u201d"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"154pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"};"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}}},"TimeStamp Datatype","This data structure is a representation of date and time, represented as an integer, with a resolution at least as fine-grained as that in use by the protected file system. For example, if the protected file system time granularity is 1 microsecond, the granularity of the TimeStamp must be <=1 microsecond.\n\n","RevIdent Datatype","This data structure is a unique identifier for this specific revision, represented as an integer.\n\n","Tag Datatype","This data structure is a label or tag, which can be applied to a particular revision. It is represented as a sequence of Unicode characters.\n\n","Revision Datatype","The Revision datatype contains all information relevant to representing and recording a single revision of a single file system object. It contains a FileData object with the actual representation of the specific revision of the file system object, a TimeStamp identifying the data and time of last modification corresponding to this revision, a RevIdent uniquely identifying this revision among the set of revisions for a file system object, a set of all tags associated with this revision of the file system object, and finally a Bool indicating whether this Revision records a delete event rather than recording new contents for the protected file system object.",{"@attributes":{"id":"p-0124","num":"0206"},"tables":{"@attributes":{"id":"TABLE-US-00015","num":"00015"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Typedef Revision {"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"147pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"FileData data;","\/\/ A revision of the file, including normal file"]},{"entry":[{},{},"\/\/ contents, and file system specific information"]},{"entry":[{},{},"\/\/ such as security, type, attribute, and date"]},{"entry":[{},{},"\/\/ information."]},{"entry":[{},"TimeStamp ts;","\/\/ The specific timestamp associated with this"]},{"entry":[{},{},"\/\/ particular revision; derived from the \u201cdata\u201d"]},{"entry":[{},{},"\/\/ element but kept separate and in a form suitable"]},{"entry":[{},{},"\/\/ for fast access."]},{"entry":[{},"RevIdent id;","\/\/ A unique revision number associated with this"]},{"entry":[{},{},"\/\/ revision of the file system object."]},{"entry":[{},"Set of Tags tags;","\/\/ A set of tags which match this revision of the"]},{"entry":[{},{},"\/\/ object."]},{"entry":[{},"Bool is_delete;","\/\/ If FALSE, this is a normal record. If TRUE,"]},{"entry":[{},{},"\/\/ then this Revision notes a delete event and the"]},{"entry":[{},{},"\/\/ data and tags elements are invalid."]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"};"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]}}]}}},"FileIdent Datatype","The FileIdent datatype represents a key that uniquely identifies an object within a protected file system. The form of FileIdent is implementation-dependent.","If the file system is catalogued by human-readable file pathnames, then FileIdent is represented as a string of ANSI or Unicode characters. For example, \u201cc: \\Documents and Settings\\Administrator\u201d:\n\n","Alternatively, it is also possible to index by the file system's internal indexing method such as FRN (file reference number) in Windows or inodes in Unix:\n\n","FileObject Datatype","The FileObject datatype is the representation in the Archive Manager 's database of a file system object, including all revisions archived. It has two elements. The first is a name for the object. This name uniquely identifies the file system object within the protected file system and also indexes into the Archive Manager  to find all associated archived revisions of the protected file system object. The second is a set of all Revision data structures associated with this name, which is quite simply the set of all revisions of the protected file system object represented in the Archive Manager .",{"@attributes":{"id":"p-0131","num":"0215"},"tables":{"@attributes":{"id":"TABLE-US-00016","num":"00016"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Typedef Object {"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"133pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"FileIdent name;","\/\/ Identification of the specific file, such as"]},{"entry":[{},{},"\/\/ full pathname of the file within the protect-"]},{"entry":[{},{},"\/\/ ed file system."]},{"entry":[{},"Set of Revision revs;","\/\/ A set of all revisions present in the"]},{"entry":[{},{},"\/\/ archive."]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"};"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]}}]}}},"Enhanced GD Algorithm","Here's an enhanced algorithm which, together with the above described data structures, supports file system object renaming and deletion, and tags, as described below. As before, this routine takes a filter to apply, the time relative to which the filter should be applied, and the revision set to which the filter will be applied. It returns the updated revision set.",{"@attributes":{"id":"p-0134","num":"0218"},"tables":{"@attributes":{"id":"TABLE-US-00017","num":"00017"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Set of Revision GD("}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"91pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"112pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Timestamp now;","\/\/ Time relative to which the filter"]},{"entry":[{},{},"\/\/ will be applied."]},{"entry":[{},"Array of Integer A[0 . . . n],","\/\/ Array containing coefficients for"]},{"entry":[{},{},"\/\/ n age intervals."]},{"entry":[{},"Integer n,","\/\/ count of age intervals"]},{"entry":[{},"Set of Revision R{ },","\/\/ set of revisions to be filtered"]},{"entry":[{},"Integer m","\/\/ number of revisions in R"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":")"},{"entry":"{"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"\/\/ Temporary Sets of Revisions used by the algorithm."]},{"entry":[{},"Set of Revision R_normal := { };"]},{"entry":[{},"Set of Revision R_delete := { };"]},{"entry":[{},"Set of Revision R_tagged := { };"]},{"entry":[{},"Set of Revisions NEWR := { };"]},{"entry":[{},"Set of Revisions RESULT := { };"]},{"entry":[{},"\/\/ Identify normal and delete revisions."]},{"entry":[{},"FOR EACH REVISION e in SET R {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"If (e.is_delete = = FALSE)"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"R_normal := union( R_normal, e );"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Else"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"R_delete := union( R_delete, e );"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"\/\/ Keep track of all tagged revisions."]},{"entry":[{},"FOR EACH REVISION e in SET R_normal {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"If (e.tags != { })"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"R_tagged := union( R_tagged, e );"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"\/\/ Apply the standard GD filter to all normal revisions."]},{"entry":[{},"FOR EACH INTEGER i FROM 0 TO n-1 INCLUSIVE {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"Set TMP := { };"]},{"entry":[{},"FOR EACH REVISION e in SET R normal {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"If (e.ts >= (now \u2212 A[i+1]) AND e.ts < (now \u2212 A[i]))"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"TMP := union( TMP, e );"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"If (TMP != { })"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"NEWR := union( NEWR, min( TMP ));"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"NEWR := union( NEWR, max( R_normal ));"]},{"entry":[{},"\/\/ Make sure the revision set contains all tagged and deleted revisions."]},{"entry":[{},"NEWR := union( NEWR, R_tagged );"]},{"entry":[{},"NEWR := union( NEWR, R_deleted );"]},{"entry":[{},"\/\/ Now scan the revision set, deleting redundant delete revisions,"]},{"entry":[{},"\/\/ keeping just the oldest of each adjacent group."]},{"entry":[{},"Bool LAST_WAS_DEL := TRUE;"]},{"entry":[{},"Bool FIRST_REVISION := TRUE;"]},{"entry":[{},"FOR EACH REVISION e FROM OLDEST TO NEWEST in SET"]},{"entry":[{},"NEWR {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"IF (e.is_deleted) {"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"If (FIRST_REVISION)"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"; \/\/ forget this revision;"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Else If (LAST_WAS_DEL)"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"; \/\/ forget this revision"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"Else {"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"161pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"RESULT := union( RESULT, e ); \/\/ keep this delete"]},{"entry":[{},"LAST_WAS_DEL := TRUE; \/\/ remember we saw a"]},{"entry":[{},"delete"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"}"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"else {"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"175pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"RESULT := union( RESULT, e ); \/\/ keep this revision"]},{"entry":[{},"LAST_WAS_DEL := FALSE; \/\/ remember it was normal"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"28pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"189pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"FIRST_REVISION := FALSE;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"203pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"}"]},{"entry":[{},"\/\/ RESULT now contains our new Set of Revisions."]},{"entry":[{},"Return RESULT;"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"217pt","align":"left"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":"}"},{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}]}}]}}},"Deleted Files","If we are only concerned with being able to restore each saved revision of a file system object, then we can ignore file deletes. However, if we're interested in restoring larger units such as directory trees or even file system volumes at particular points in time, then we need to track file deletions in addition to file creation and file modification events. Consider the following sequence of events:",{"@attributes":{"id":"p-0137","num":"0221"},"tables":{"@attributes":{"id":"TABLE-US-00018","num":"00018"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"70pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"112pt","align":"left"}}],"thead":{"row":[{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]},{"entry":[{},"TimeIndex","File System Action"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"0","Create Directory D (rev1)"]},{"entry":[{},"1","Create File D\/A (rev1)"]},{"entry":[{},"2","Modify D\/A (rev2)"]},{"entry":[{},"3","Delete D\/A"]},{"entry":[{},"4","Create File D\/B (rev1)"]},{"entry":[{},"5","Modify File D\/B (rev2)"]},{"entry":[{},"6","Delete File D\/B"]},{"entry":[{},"7","Create File D\/A (rev3)"]},{"entry":[{},"8 . . .","\u201cno further changes\u201d"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]}}}}},"The following table shows what will be restored for each time index both in a system which tracks file creation and modification but not deletion (left), and in a system that tracks deletion in addition to creation and modification (right):",{"@attributes":{"id":"p-0139","num":"0223"},"tables":{"@attributes":{"id":"TABLE-US-00019","num":"00019"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"91pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"84pt","align":"left"}}],"thead":{"row":[{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}},{"entry":[{},"Archive Action (no delete","Archive Action (with delete"]},{"entry":["TimeIndex","handling)","handling)"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["0","\u201cempty\u201d","\u201cempty\u201d"]},{"entry":["1","D\/A (rev1)","D\/A (rev1)"]},{"entry":["2","D\/A (rev2)","D\/A (rev2)"]},{"entry":["3","D\/A (rev2)"]},{"entry":["4","D\/A (rev2), D\/B (rev1)","D\/B (rev1)"]},{"entry":["5","D\/A (rev2), D\/B (rev2)","D\/B (rev2)"]},{"entry":["6","D\/A (rev2), D\/B (rev2)"]},{"entry":["7","D\/A (rev3), D\/B (rev2)","D\/A (rev3)"]},{"entry":["8 . . . ","D\/A (rev3), D\/B (rev2)","D\/A (rev3)"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}}}},"It's clear that both approaches retain the same archived data, but the example \u201cwith delete handling\u201d exhibits much more desirable characteristics for restoring large units of data such as directory trees.","It is worth noting that traditional backup software exhibits behavior similar to the \u201cno delete handling\u201d case.","Algorithmic Handling of Deletes","Our preferred approach to handling delete events is to record them all. Then, when the GD filter is applied, they are handled specially. Specifically, the standard GD filtering process is applied to the non-delete revisions. Then, the union of the resulting revision set and all delete revisions input to the GD filter are ordered by date from oldest to most recent. Whenever, two or more delete revisions are adjacent, all but the oldest are removed. Additionally, if the oldest revision is a delete revision, it is discarded.","As a result, all delete\/create boundaries will be properly represented. We keep the oldest of any adjacent group of delete events since it will provide the most accurate representation of the file system over time. Because delete revisions have no associated file data, they are very small and the cost of representing them is very low. Additionally, after filtering, it is easy to show that for a file system object with n non-delete revisions in the archive, there will never be more than n delete revisions present, so the overhead in complexity is quite small.","Here is an example of a base- filter:\n\n","In this example, a particular file name is used to create, modify (0 or more times), and then delete the file. This process is done repeatedly. The contents of the archive over time showing object changes (including deletions) is shown with the filter applied at each time period t, t, . . . t with the resulting revision set at each time period:",{"@attributes":{"id":"p-0147","num":"0232"},"tables":{"@attributes":{"id":"TABLE-US-00020","num":"00020"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"308pt","align":"left"}},"thead":{"row":{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":"Filter is \u22121 0 1 2 4 8 16 32 64 128 256 512 1024 2048 4096 8192"}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"11"},"colspec":[{"@attributes":{"colname":"1","colwidth":"14pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"77pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"6","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"7","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"8","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"9","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"10","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"11","colwidth":"21pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["At","\u2003\u20020 adding","\u20020(c), archive becomes:","\u20020(c)",{},{},{},{},{},{},{}]},{"entry":["At","\u2003\u20021 adding","\u20021(d), archive becomes:","\u20021(d)","\u20020(c)"]},{"entry":["At","\u2003\u20022 adding","\u20022(c), archive becomes:","\u20022(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u2003\u20023 adding","\u20023(c), archive becomes:","\u20023(c)","\u20022(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u2003\u20024 adding","\u20024(d), archive becomes:","\u20024(d)","\u20023(c)","\u20022(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u2003\u20025 adding","\u20025(c), archive becomes:","\u20025(c)","\u20024(d)","\u20023(c)","\u20022(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u2003\u20026 adding","\u20026(c), archive becomes:","\u20026(c)","\u20025(c)","\u20024(d)","\u20022(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u2003\u20027 adding","\u20027(c), archive becomes:","\u20027(c)","\u20026(c)","\u20025(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u2003\u20028 adding","\u20028(d), archive becomes:","\u20028(d)","\u20027(c)","\u20026(c)","\u20025(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u2003\u20029 adding","\u20029(c), archive becomes:","\u20029(c)","\u20028(d)","\u20027(c)","\u20025(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u200310 adding","10(c), archive becomes:","10(c)","\u20029(c)","\u20028(d)","\u20027(c)","\u20025(c)","\u20021(d)","0(c)"]},{"entry":["At","\u200311 adding","11(c), archive becomes:","11(c)","10(c)","\u20029(c)","\u20028(d)","\u20027(c)","\u20025(c)","1(d)"]},{"entry":[{},{},{},"\u20020(c)"]},{"entry":["At","\u200312 adding","12(c), archive becomes:","12(c)","11(c)","10(c)","\u20029(c)","\u20028(d)","\u20025(c)","1(d)"]},{"entry":[{},{},{},"\u20020(c)"]},{"entry":["At","\u200313 adding","13(d), archive becomes:","13(d)","12(c)","11(c)","\u20029(c)","\u20028(d)","\u20025(c)","1(d)"]},{"entry":[{},{},{},"\u20020(c)"]},{"entry":["At","\u200314 adding","14(c), archive becomes:","14(c)","13(d)","12(c)","11(c)","\u20029(c)","\u20021(d)","0(c)"]},{"entry":["At","\u200315 adding","15(c), archive becomes:","15(c)","14(c)","13(d)","11(c)","\u20029(c)","\u20021(d)","0(c)"]},{"entry":["At","\u200316 adding","16(c), archive becomes:","16(c)","15(c)","14(c)","13(d)","\u20029(c)","\u20021(d)","0(c)"]},{"entry":["At","\u200317 adding","17(c), archive becomes:","17(c)","16(c)","15(c)","14(c)","13(d)","\u20029(c)","1(d)"]},{"entry":[{},{},{},"\u20020(c)"]},{"entry":["At","\u200318 adding","18(c), archive becomes:","18(c)","17(c)","16(c)","14(c)","13(d)","\u20029(c)","1(d)"]},{"entry":[{},{},{},"\u20020(c)"]},{"entry":["At","\u200319 adding","19(d), archive becomes:","19(d)","18(c)","17(c)","16(c)","14(c)","13(d)","9(c)"]},{"entry":[{},{},{},"\u20021(d)","\u20020(c)"]},{"entry":["At","\u200320 pruning,","archive becomes:","19(d)","18(c)","16(c)","14(c)","13(d)","\u20029(c)","1(d)","0(c)"]},{"entry":["At","\u200321 pruning,","archive becomes:","19(d)","18(c)","14(c)","13(d)","\u20029(c)","\u20021(d)","0(c)"]},{"entry":["At","\u200322 pruning,","archive becomes:","19(d)","18(c)","14(c)","13(d)","\u20029(c)","\u20021(d)","0(c)"]},{"entry":["At","\u200323 pruning,","archive becomes:","19(d)","18(c)","13(d)","\u20029(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u200324 pruning,","archive becomes:","19(d)","18(c)","13(d)","\u20029(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u200325 pruning,","archive becomes:","19(d)","18(c)","13(d)","\u20029(c)","\u20021(d)","\u20020(c)"]},{"entry":["At","\u200326 pruning,","archive becomes:","19(d)","18(c)","\u20021(d)","\u20020(c)"]},{"entry":". . ."},{"entry":["At","1000 pruning,","archive becomes:","19(d)","18(c)","\u20021(d)","\u20020(c)"]},{"entry":{"@attributes":{"namest":"1","nameend":"11","align":"center","rowsep":"1"}}}]}}]}}},"Note that all delete\/create boundaries are preserved.","Renamed Files","Renamed files are another special case. However, renamed files can be easily handled outside of the GD algorithm by reducing rename operations to a sequence of file creates and deletes. Specifically, there are two cases to consider.","First, A is renamed to B where B does not exist. This is equivalent (from the perspective of the Archive Manager ) to the following sequence:\n\n","Second, A is renamed to B where B does exist. This is equivalent (from the perspective of the Archive Manager ) to the following sequence:\n\n","In the immediately preceding sequence, the \u201cDelete B\u201d revision is necessary to explicitly indicate that the result of the rename operation is replacing B with a new file, not a new revision of the old file.","Obviously, the proper data must be included with each revision presented to the Archive Manager . The key point is that rename operations are easily managed without special processing by the GD algorithm.","Tagged Revisions","It may be desirable to label and retain some revisions forever. The Archive Manager  provides a means to label or tag, particular revisions with a symbol name. Our enhanced GD algorithm retains all tagged revisions indefinitely. Through other database operations provided by the Archive Manager , tags can also be removed when they are no longer needed, allowing the GD algorithm to prune such data when its retention is no longer critical.","Using symbolic tags provides a powerful means for a user to easily recover information using terminology familiar to the user.","A couple examples follow.","Initial File System Image","It may be desirable to retain the very first copy of the protected file system placed into the Archive Manager 's archive. After the copy is complete, a tag such as \u201cInitial File System Image\u201d could be applied to that initial revision of each and every file system object represented in the archive. It would then be possible to retrieve a copy of that initial image at any point in the future by searching for tag \u201cInitial File System Image\u201d for all objects in the archive and restoring the appropriate revision for all matching objects.","Important User Files","After making some critical changes, a user could tag the specific files that should be kept forever. For example, after completing the quarterly inventory process, the user could tag the current revision of each inventory database file with an appropriate label such as \u201c2Q2002 Inventory Final\u201d. This revision, once archived as a permanent file, will never be deleted except, of course, upon the express instruction of the user.","Shown in  is an integrated system  comprising a personal computer that we shall refer to as our Client , but into which we have tightly integrated a Server  (see, ) constructed in accordance with an integrated embodiment of our invention. By integrated we mean that both the protected volume and the archive are contained within, and integrated into, a single enclosure .","As shown in greater detail in , Client  is comprised of a central processing unit, CPU , which is coupled directly to main memory , and a system controller  which is coupled to a hard disk, Client Disk , an input device , such as a keyboard, an output device , such as a monitor, and a high-speed interface  which may implement any of the known high-speed communication protocols. In contrast to the Client  shown in , however, the Client  also includes a second hard disk, Archive Disk  that is reserved exclusively for archival purposes. A power supply  provides operating power to all of the components comprising the Client .","Shown generally in  are the main software components of the integrated system . As is conventional in Client , an application , such as a word processing or spreadsheet program, executes under control of an operating system, OS , to create, modify or delete data files stored in a client volume . Within the context of the specific hardware configuration shown in , both the application  and the OS  will, during the execution thereof by the CPU , reside, at least in part, in the main memory , and will make use of the system controller  on an as-required basis to interact with the user via the input device  and the output device , in order to implement requested actions relative to the client volume  resident on the Client Disk .","In contrast to the software configuration shown in , the main software components of our archival system consist of an Archive Agent , adapted to reside within the Client  and to interact directly with the OS  to automatically maintain an archive of the contents of the client volume  in an archive volume , resident on the Archive Disk . As shown in , the Archive Agent  includes all of the components of both the Client Agent  and the Server Agent  of our stand-alone system , except for the CCI  and the SCI  which are not required in our integrated system . In the latter system, communication between, on the one hand, the Volume Monitor , Browser , Configurator , or the Restorer , and, on the other hand, the Update Monitor , Query Manager  or Configuration Manager , can be accomplished using any of the known inter-process communication techniques, such as OS function calls or OS-facilitated message passing using either disk- or memory-mapped data structures.","Just as in our stand-alone system , our integrated system  reserves a separate disk exclusively for the archive. The distinction is important: in either of our archival systems, there are disk(s) available for normal file operations and there are disk(s) for the exclusive use of the archival server. In an example implementation, the archive disk will be a normal industry standard disk drive connected using normal, industry standard interconnects (e.g., IDE, SCSI, USB). Through coordination with standard system software including the OS, the archival software has exclusive access to the disk allocated exclusively for archival use.","In the case of our stand-alone system  in which the SA  in implemented as a separate hardware unit, access to the Archive Disk  is strictly controlled by the Server Agent . However, enforcing exclusive access to the Archive Disk  in the integrated system  is a bit more complicated. We are concerned both with unauthorized access to stored data as well as inadvertent damage or deletion of the data. This latter issue is critically important since in the event of a system failure, the administrator may reinstall the operating system and we definitely want the data stored on the archive volume  available for system restoration!","In general, our primary concerns in this regard are:\n\n","In general, there are several possible approaches to securing the Archive Disk  all of which presume adequate physical security of the computer containing that disk. The methods described here are not designed to protect the Archive Disk  from hostile intent in a physically insecure environment. In this regard, our primary goal is to protect the Archive Disk  from unlawful programmatic attack by an unauthorized user or program, and protection against accidental damage from an authorized user.","Archive Disk  uses Native Format","Protection against Case A can be provided using a normal file system format. For example, if the OS  is Windows XP Professional, the archive volume  can be formatted as an NTFS 5.0 partition. Protection against Case A is trivial in this case. The system administrator must set the protections of all top-level file and directory structures on the Archive Disk  to preclude access by all but privileged users. Using the standard Browser  and Restorer , non-privileged users can still access all backed up data to which they are properly entitled access.","Note that this solution offers no protection against Case D because viruses and related programs may run with all necessary privileges to access the disk. This approach requires no special hardware or software. It requires the administrator of the system to properly set the security of the Archive Disk .","Archive Disk  uses Non-Native Format","Simple protection against Cases A, B, C, and D can be provided by formatting the Archive Disk  in a way that the OS recognizes as valid data, but data it doesn't know how to access. For example, if the OS  is Windows XP Professional, the Archive Disk  can be formatted as a Linux partition, which Windows will recognize as a Healthy, but Unknown partition type. In such a configuration, the Archive Agent  will access the Archive Disk  via a special disk driver which understands the format of the Archive Disk . Because the disk is in a non-standard format and accessible only via the special driver, we have addressed Case A.","Cases B and C are addressed because most installers and utilities will note the unusual format and either leave it alone or warn the administrator doing the reinstall or disk maintenance work. Additionally, the Archive Disk  can be labeled with an obvious name like \u201cArchive\u201d to warn the administrator that the archive volume  should not be thoughtlessly erased or modified.","Case D is addressed because most viruses and related programs issue attacks against files and not against disks or partitions, although certain viruses have been known to reformat the C: drive. In our case, we are non-native so no files or directories are visible and additionally, the Archive Disk  is not mounted (from the perspective of normal code) and has no associated mount point or drive letter, so it will be difficult for the virus to find.","Archive Disk  includes Hardware Interlock","An approach that provides strong protection requires special hardware. Effectively, the Archive Disk  requires a special enabling command before general access is permitted. In this mode, the Archive Disk  is present in the system and either properly enumerated at boot time (e.g., IDE, SCSI) or when power is applied (e.g., USB). In the former case, a special command must be issued to the Archive Disk  before it can be accessed for use. Such an enabling command could, for example, be a request to a particular sequence of disk sectors which are beyond the addressable range of the drive. In the latter case, there could simply be a special hardware register which must be written to enable power to a USB Archive Disk . The value of this latter approach is that the Archive Disk  is truly inaccessible unless and until an archive-aware OS is running on the hardware, effectively providing strong protection against each of Cases A, B, C, and D.","Thus it is apparent that we have provided a method and apparatus for efficiently archiving the contents of an on-line file system. In particular, we have disclosed both a stand-alone and an integrated archival system that, with minimal user interaction, efficiently and automatically archives the contents of one or more selected client volumes stored on an on-line file system. In addition, the systems that we have disclosed are specially adapted to gracefully discard older versions of current files in the client volume so as to reduce the storage requirements of the archive volume, thereby extending the effective operating period of the system until user action is required. Those skilled in the art will recognize that modifications and variations can be made without departing from the spirit of our invention. Therefore, we intend that our invention encompass all such variations and modifications as fall within the scope of the appended claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE SEVERAL VIEWS OF THE DRAWINGS","p":["Our invention may be more fully understood by a description of certain preferred embodiments in conjunction with the attached drawings in which:",{"@attributes":{"id":"p-0024","num":"0028"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0025","num":"0029"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0026","num":"0030"},"figref":["FIG. 3","FIG. 1"]},{"@attributes":{"id":"p-0027","num":"0031"},"figref":["FIG. 4","FIG. 3"]},{"@attributes":{"id":"p-0028","num":"0032"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0029","num":"0033"},"figref":["FIG. 6","FIG. 5"]},{"@attributes":{"id":"p-0030","num":"0034"},"figref":["FIG. 7","FIG. 5"]},{"@attributes":{"id":"p-0031","num":"0035"},"figref":["FIG. 8","FIG. 7"]}]},"DETDESC":[{},{}]}
