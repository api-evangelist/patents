---
title: Messaging methods and apparatus for use with an exchange system and/or client devices
abstract: Methods and apparatus for numbering messages between a client, e.g., trader system, and exchange system are described. Client device (e.g., trader system) to exchange message numbering and exchange system to client device message numbering is supported and used. As part of each successful login, a client device is provided with a client to exchange system number to be used for first transaction message sent to the system after login. The first message from the client device is checked to make sure the number sent to the client device was used in the message. This approach places the burden on the client device, e.g., trader's system, not to send old messages with the new number. Messages from the exchange to the trader system are also numbered. Messages may include a field used to communicate information provided by a trader which is not interpreted by or used by the exchange system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08832211&OS=08832211&RS=08832211
owner: NYSE ARCA LLC
number: 08832211
owner_city: Chicago
owner_country: US
publication_date: 20111104
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["RELATED APPLICATIONS","FIELD","BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"p":["The present application claims the benefit of the filing date of U.S. Provisional Patent Application Ser. No. 61\/552,414, filed on Oct. 27, 2011 and titled \u201cMETHODS AND APPARATUS FOR USING MULTICAST MESSAGING IN A SYSTEM FOR IMPLEMENTING TRANSACTIONS\u201d; claims the benefit of the filing date of U.S. Provisional Patent Application Ser. No. 61\/548,691, filed on Oct. 18, 2011 and titled \u201cMESSAGING METHODS AND APPARATUS FOR USE IN AN EXCHANGE SYSTEM\u201d; claims the benefit of the filing date of U.S. Provisional Patent Application Ser. No. 61\/543,798, filed on Oct. 5, 2011 and titled \u201cMESSAGING METHODS AND APPARATUS FOR USE IN AN EXCHANGE SYSTEM\u201d; claims the benefit of the filing date of U.S. Provisional Patent Application Ser. No. 61\/543,804, filed on Oct. 5, 2011 and titled \u201cMETHODS AND APPARATUS FOR USING MULTICAST MESSAGING IN A SYSTEM FOR IMPLEMENTING TRANSACTIONS\u201d; claims the benefit of the filing date of U.S. Provisional Patent Application Ser. No. 61\/543,309, filed on Oct. 4, 2011 and titled \u201cMETHODS AND APPARATUS FOR USING MULTICAST MESSAGING IN A SYSTEM FOR IMPLEMENTING TRANSACTIONS\u201d; claims the benefit of the filing date of U.S. Provisional Patent Application Ser. No. 61\/543,290, filed on Oct. 4, 2011 and titled \u201cMETHODS AND APPARATUS FOR PERFORMING RISK CHECKING\u201d; claims the benefit of the filing date of U.S. Provisional Patent Application Ser. No. 61\/543,304, filed on Oct. 4, 2011 and titled \u201cMESSAGING METHODS AND APPARATUS FOR USE IN AN EXCHANGE SYSTEM\u201d; claims the benefit of the filing date of U.S. Provisional Patent Application Ser. No. 61\/417,197, filed on Nov. 24, 2010 and titled \u201cMETHODS AND APPARATUS FOR PERFORMING RISK CHECKING UNDER BROKER CONTROL\u201d; claims the benefit of the filing date of U.S. Provisional Patent Application Ser. No. 61\/426,490, filed on Dec. 22, 2010 and titled \u201cMESSAGING METHODS AND APPARATUS FOR RESTORING MESSAGE SYNCHRONIZATION BETWEEN A TRADER'S SYSTEM AND AN ELECTRONIC COMMUNICATIONS NETWORK\u201d; all of which are hereby expressly incorporated by reference in their entirety.","The present application relates to messaging methods and apparatus for use with an exchange system and\/or client devices and, more particularly, to message synchronization methods and apparatus that are well suited for use in a trading system such as an electronic communications network (ECN) used for trading securities and\/or other items of value.","Electronic exchanges, implemented as Electronic Communication Networks (ECNs), are often used to electronically trade a wide range of commodities, stocks and\/or other items having real world significance. An ECN normally receives messages, e.g., an order from a trader, performs a matching operation, and if a matching order exists, performs a trade. The resulting trade is reported to the traders which placed the matching orders and also to a public system, e.g., for updating published information about the current price of a stock, commodity or other item being traded on the exchange.","Electronic trading on an electronic exchange allows for large numbers of orders to be stored, processed, and executed at relatively low cost. The speed at which a trade can be executed is important since a delay in processing of a message including an order to buy or sell may affect the dollar amount at which the trade is made.","In the event that a trader's system, referred to herein as a trader system, or the ECN detect a miss-match in sequence numbers, indicating that either the trader system or the ECN has lost one or more messages, action to resolve the sequence number miss-match is often required. This often involves the system with the higher message sequence number communicating the messages which are missing from the other device's records.","The playback of lost or missing messages may involve a fair amount of communication given that trading sessions may go on for a long period of time, e.g., several days, and a large number of messages may be missing, e.g., as indicated by a large gap between the message sequence number used by one device and the higher message sequence number known to the other device based on previously received or transmitted messages.","The communications path between the gateway device and a trader's system is intended to be a relatively high speed communications path. A portion of the high speed communications path with the gateway may be shared by multiple traders. The messages transmitted on the high speed communications path to the client gateway are usually relatively small in terms of the amount of data they communicate. While individual messages may be short in duration, the playback of a large number of messages in order to provide a device with missing messages may place a strain on the bandwidth of the high speed communications path with the client gateway which may interfere or delay the transmission of new trading messages, e.g., orders to buy or sell a stock.","In view of the above, it should be appreciated that there is a need for improved methods of sequencing messages between an exchange system and client devices and\/or for improved message formats and\/or messages which facilitate the communication in exchange systems. While there is much room for improvement it should be appreciated that systems and apparatus which address one or more of the above issues are useful and desirable and that all embodiments need not address all of the above discussed problems.","Methods and apparatus for numbering messages between a client, e.g., trader system, and exchange system are described. Both client device (e.g., trader system) to exchange message numbering and exchange system to client device message numbering is supported and used.","In some but not necessarily all embodiments, a client device, e.g., trader device, to exchange message includes a field for communicating information which is useful to the trader and\/or broker associated with the trader. The field is referred to, in some embodiments, as an uninterpreted field since it is not interpreted or used by the exchange system to control message processing and\/or other exchange system functions. The content of the uninterpreted field is passed through various devices in the exchange system and echoed back to the client\/trader device in one or more response messages sent by the exchange in response to a transaction message. It should be appreciated that the client, e.g., trader device, can be used to place orders corresponding to multiple different individuals. The uninterpreted message field allows the trader device to include in transaction messages information identifying the individual customer to which the transaction message generated by the trader system corresponds and\/or other information such as a client order number. Since this information is returned to the trader system, the trader device can, and in some embodiments does, use the returned information from the uninterpreted field to easily match and\/or route content of transaction response messages from the exchange to an individual customer. While from the exchange perspective, the trader device is treated as a single entity for transaction purposes, the trader device and\/or system is able to easily and transparently separate and route or forward information from transaction response messages to individual customers of the trader system to which the messages relate. The information included in the uninterpreted field transaction messages sent to an exchange and transaction response messages received from an exchange may, and in some embodiments is, encrypted or otherwise scrambled to render it meaningless to the exchange system. However, encryption and\/or scrambling of the content of the uninterpreted field is optional. The uninterpreted field allows a trader system and\/or device, to maintain and use a message numbering system with their individual clients which is independent of the message numbering system used for client device to exchange system messages and exchange responses to such messages. In fact, in most if not all embodiments, an individual customer who is being serviced by a trader using a client device such as a trader system may be shielded from, and not provided with, information on the numbering of messages used between the exchange and client device with message numbering information from the uninterpreted field being used for purposes of communicating with an individual client instead. The uninterpreted field may be relatively large in size, e.g., hundreds or even thousands of bits long, allowing the trader device to communicate and echo back several bytes of information. The size of the field may vary depending on the amount of information communicated. A size indicator indicating the size of the uninterpreted field is included in some embodiments in messages from a client device to the exchange system thereby allowing the exchange to easily determine the size of the field in such embodiments. In some other embodiments the size of the uninterpreted field is fixed and known to both client device and exchange system.","As part of each successful login, in some embodiments, a client device is provided with a client to exchange system number to be used for first transaction message sent to the system after login. The first message from the client device is checked to make sure the number sent to the client device was used in the message. This approach places the burden on the client device, e.g., trader's system, not to send old messages with the new number avoiding the burden of which might otherwise be placed on the exchange to distinguish between a repeated message sent from the trader system to the exchange. Messages from the exchange to the trader system are also numbered. The numbering of messages from the exchange to the trader system may be controlled by matching engines in the exchange. Message streams, e.g., exchange to trader response message stream, for transaction response messages may be generated on a peer stream basis, with different message streams and thus different message sequence numbers being used for messages originating from different groups of matching engines, e.g., matching engine groups responsible for maintaining order books corresponding to different securities.","An exemplary method, in accordance with some embodiments, comprises: receiving a first client to exchange system message from a client device; checking the received first client to exchange system message to determine if it includes an expected client device to exchange system message sequence number; and rejecting said first client to exchange system message if it is determined that it does not include said expected client device to exchange system message sequence number.","An exemplary gateway device, in accordance with some embodiments, comprises, at least one processor configured to: receive a first client to exchange system message from a client device; check the received first client to exchange system message to determine if it includes an expected client device to exchange system message sequence number; and reject said first client to exchange system message if it is determined that it does not include said expected client device to exchange system message sequence number. The exemplary gateway device further comprises memory coupled to said at least one processor.","Various features are directed to detecting a loss of message synchronization and\/or messages either between the trader system and an exchange system or loss of message synchronization from the exchange to the trader system. Synchronization loss may be due to a connection being terminated for a period of time, a lost connection, etc. while a trading session is being maintained with the exchange system. The loss of message synchronization is based on messages or other communication over a shared high speed low latency path within the exchange that is used for communicating transaction messages, e.g., order messages to be processed. To avoid introducing delays into communication with other traders who's transaction messages share the same high speed communications path within the exchange as the trader system with which message synchronization is lost, message gap fill to restore message synchronization with a trader system that lost synchronization is performed via a different communications path than the shared communications path used for communicating new transaction messages. The communications path used with the exchange to support gap fill operations may be a high bandwidth path that avoids the shared low latency communications path used for communicating new transaction messages. While different communications paths may be used in the exchange for new transaction messages, e.g., orders, than is used to supply or receive gap fill messages, e.g., previous messages, both the communications path used for new transaction messages and the communications path used for gap fill messages may both use the same external connection to the trader. That is, the path between the trader and a security switch in the exchange which is not shared with other clients and\/or traders is normally the same for both new transaction messages and gap fill messages while the exchange is implemented in such a way that the shared high speed communications path used for new transaction messages is avoided for gap fill operations.","An exemplary method of operating an exchange system, in accordance with some embodiments, comprises: receiving at a first device in an exchange system, a message from a trader system communicated via a first communications path, said first communications path including a shared low latency link in said exchange system; and determining that said trader system requires a message gap fill. The exemplary method further comprises: sending, in response to determining that said trader system requires a message gap fill, a signal to a second device to trigger said second device to supply one or more previously transmitted messages to the trader system via a second communications path. In some embodiments, the first device is a gateway device. In various embodiments, the shared low latency link is a link between a security switch and a gateway device which is shared by multiple traders. In some embodiments, the second device is a message logging device in the exchange.","An exemplary exchange system, in accordance with some embodiments, comprises: a first processor configured to: receive at a first device in an exchange system, a message from a trader system communicated via a first communications path, said first communications path including a shared low latency link in said exchange system; determine that said trader system requires a message gap fill; and send, in response to determining that said trader system requires a message gap fill, a signal to a second device to trigger said second device to supply one or more previously transmitted messages to the trader system via a second communications path. The exemplary exchange system further comprises a first memory coupled to said first processor.","While various embodiments have been discussed in the summary above, it should be appreciated that not necessarily all embodiments include the same features and some of the features described above are not necessary but can be desirable in some embodiments. Numerous additional features, embodiments and benefits of various embodiments are discussed in the detailed description which follows.",{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 1","b":["100","100","1","102","104","1","106","108","110","1","102","112","114","104","116","118","110","120","1","122","124","126","1","128","130","131","132","134","136","1","122","138","140","124","142","144","1","128","146","148","130","150","152","112","114","116","118","106","108","138","140","142","144","138","140","142","144","146","148","150","152","132","134","136","126","160","126","120"],"sub":["1,1 ","1,1","1,X ","1,X","M,1 ","M,1","M,X ","M,X","1,1 ","1,R ","L,1 ","L,R ","1,1 ","1,G ","L,1 ","L,G "]},"Drawing  of  is a simplified drawing illustrating some of the elements of exemplary system  of . Client device , e.g., a trader system, logs into the exchange system  via gateway  and starts an ongoing session. In response to the session login, the gateway device  provides the client device  with (i) an exchange system to client device message sequence number and (ii) a client device to exchange system message sequence number corresponding to each of one or more message streams. In some embodiments, each message stream corresponds to a matching engine. The client device should include the provided client device to exchange system message sequence number in the first client device to exchange system message that it sends to the exchange system. The gateway  checks the first client device to exchange system message that it receives from the client device  to determine if the provided client device to exchange system message sequence number was included.","In some embodiments, a path, a shared low latency path, including connection  is used for communicating new transaction messages from gateway  to client device . In some embodiments, a path, e.g., a high bandwidth path, including connection  is used during message gap fill operations, e.g., when communicating stored messages from message logging system  to a client device, e.g., client device .",{"@attributes":{"id":"p-0040","num":"0039"},"figref":["FIG. 3","FIG. 3A","FIG. 3B"],"b":["300","300"]},"Operation of the exemplary method starts in step , where the gateway device is powered on and initialized. Operation proceeds from step  to step . In step  the gateway device receives a session login. Then, in step  the gateway device provides a client device to exchange system message sequence number to a client device. In various embodiments, the client device to exchange system message sequence number, e.g., of step , is provided in response to a session login, e.g., of step , and the provided client device to exchange system message sequence is provided for inclusion in the next client to exchange system message.","Operation proceeds from step  to step , and in some embodiments, to step . In step  the gateway device provides an exchange system to client device message sequence number to the client device. In some embodiments, the exchange system to client device message sequence number provided in step  corresponds to a first message stream. In step  the gateway device provides a second exchange system to client device message sequence number to said client device, said second exchange system to client device message sequence number corresponding to a second message stream. For example, the provided exchange system to client device message sequence number of step  may correspond to a first message stream corresponding to a first matching engine group and the client device, while the provided second exchange system to client device message sequence number of step  may correspond to the a second matching engine group and the client device. In various embodiments, a client device may have more than two exchange system to client device message streams and may be provided with an exchange system to client device message sequence number corresponding to each stream, e.g., message streams corresponding to more than two matching engine groups. Operation proceeds from step  and step  to step .","In step  the gateway device receives a first client to exchange system message from the client device. In some embodiments, the received first client to exchange system message includes an uninterpreted field, said uninterpreted field including client device supplied information which is to be returned without alternation to said client device in any response message corresponding to said received first client to exchange system message. In some such embodiments, the uninterpreted field includes information used by the client device or a broker to identify or track client to exchange messages and\/or identify individuals upon who's behalf a trader is implementing an order or other transaction.","In some but not necessarily all embodiments, a client device, e.g., trader device, to exchange message includes a field for communicating information which is useful to the trader and\/or broker associated with the trader. The field is referred to, in some embodiments, as an uninterpreted field since it is not interpreted or used by the exchange system to control message processing and\/or other exchange system functions. The content of the uninterpreted field is passed through various devices in the exchange system and echoed back to the client\/trader device in one or more response messages sent by the exchange in response to a transaction message. It should be appreciated that the client, e.g., trader device, can be used to place orders corresponding to multiple different individuals. The uninterpreted message field allows the trader device to include in transaction messages information identifying the individual customer to which the transaction message generated by the trader system corresponds and\/or other information such as a client order number. Since this information is returned to the trader system, the trader device can, and in some embodiments does, use the returned information from the uninterpreted field to easily match and\/or route content of transaction response messages from the exchange to an individual customer. While from the exchange perspective, the trader device is treated as a single entity for transaction purposes, the trader device and\/or system is able to easily and transparently separate and route or forward information from transaction response messages to individual customers of the trader system to which the messages relate. The information included in the uninterpreted field transaction messages sent to an exchange and transaction response messages received from an exchange may, and in some embodiments is, encrypted or otherwise scrambled to render it meaningless to the exchange system. However, encryption and\/or scrambling of the content of the uninterpreted field is optional. The uninterpreted field allows a trader system and\/or device, to maintain and use a message numbering system with their individual clients which is independent of the message numbering system used for client device to exchange system messages and exchange responses to such messages. In fact, in most if not all embodiments, an individual customer who is being serviced by a trader using a client device such as a trader system may be shielded from, and not provided with, information on the numbering of messages used between the exchange and client device with message numbering information from the uninterpreted field being used for purposes of communicating with an individual client instead. The uninterpreted field may be relatively large in size, e.g., hundreds or even thousands of bits long, allowing the trader device to communicate and echo back several bytes of information. The size of the field may vary depending on the amount of information communicated. A size indicator indicating the size of the uninterpreted field is included in some embodiments in messages from a client device to the exchange system thereby allowing the exchange to easily determine the size of the field in such embodiments. In some other embodiments the size of the uninterpreted field is fixed and known to both client device and exchange system.","Operation proceeds from step  to step . In step  the gateway device checks the received first client to exchange system to determine if it includes an expected client device to exchange system message sequence number. In various embodiments, the expected client device to exchange system sequence number is the provided client device to exchange system message sequence number of step . Operation proceeds from step  to step . In step , if the determination of step  was that the expected client device to exchange system message sequence number as included in the received first client to exchange system message, then operation proceeds from step  to step ; otherwise, operation proceeds from step  to step .","In step  the gateway device rejects said first client to exchange system message. Then, in step  the gateway device receives a second client to exchange system message from the client device. Operation proceeds from step  to step , via connecting node A . In step  the gateway device checks the received second client device to exchange system message to determine if it includes said expected client device to exchange system message sequence number. Operation proceeds from step  to step . In step , if the determination of step  was that the expected client device to exchange system message sequence number as included in the received second client to exchange system message, then operation proceeds from step  to step ; otherwise; operation, proceeds from step  to step . In step  the gateway device rejects said second client to exchange system message. Then, in step  the gateway device notifies the client device of the rejected message.","Returning to step , in step  the gateway device accepts the first client to exchange system message. Operation proceeds from step  to step  in which the gateway device increments the expected client device to exchange system message sequence number. Operation proceeds from step , via connecting node B , to step .","Returning to step , in step , the gateway device accepts said second client to exchange system message. Then, in step  the gateway device increments said expected client device to exchange system message sequence number. Operation proceeds from step  to step .","In step , the gateway sends at least a portion of the accepted client of exchange system message, e.g., first client to exchange system message of step  or second client to exchange system message of step , to a matching engine. Operation proceeds from step  to step  in which the gateway device receives a response from the matching engine. Operation proceeds from step  to step . In step  the gateway device transmits a first exchange system to client device message, e.g., a transaction response message, including said exchange system to client device message sequence number, e.g., the exchange system to client device message sequence number provided in step , to said client device. In some embodiments, the transaction response message is sent to the client device in step  is in response to the first client to exchange system message, and the transaction response message includes the content of said uninterpreted field, which was received from the client device, in addition to at least one of an order acknowledgement and order completion information. Operation proceeds from step  to step  in which the gateway device increments the exchange system to client device message sequence number to generate an updated exchange system to client device message sequence number. Then, in step  the gateway device sends a second exchange system to client device message to said client device, said exchange system to client device message including said updated exchange system to client device message sequence number. In various embodiments, the first and second exchange system to client device messages correspond to the same message stream. In various embodiments, the second exchange system to client device message is the next exchange system to client device message sent after the first exchange system to client device message.","Operation proceeds from step  to step . In step  the gateway device transmits a third exchange system to client device message to said client device, the third exchange system to client device message corresponding to the second message stream and including the second exchange system to client device message sequence number. Operation proceeds from step  to step . In step  the gateway device increments said second exchange system to client device message sequence number to generate an updated second exchange system to client device message sequence number. Then in step  the gateway device transmits a fourth exchange system to client device message to said client device, the fourth exchange system to client device message corresponding to the second message stream and including said updated second exchange system to client device message sequence number.",{"@attributes":{"id":"p-0051","num":"0050"},"figref":["FIG. 4","FIG. 1","FIG. 3"],"b":["400","400","138","140","142","144","110","100","400","406","408","410","411","412","409","406","402","404","412","414","416","408","414","416","412","300","416","1","418","420","1","418","1","422","1","1","1","424","1","425","1","426","1","1","1","428","1","429","420","430","1","432","433","434","1","436","437","1","112","114","116","118","400"]},{"@attributes":{"id":"p-0052","num":"0051"},"figref":["FIG. 5","FIG. 4"],"b":["500","500","414","412","400","500","504","506","508","510","512"]},"In some embodiments, a received first client to exchange system message includes an uninterpreted field, said uninterpreted field including client device supplied information which is to be returned without alternation to said client device in any response message corresponding to said received client to exchange system message. In some such embodiments, the uninterpreted field includes information used by the client device or a broker to identify or track client to exchange messages and\/or to identify the individual upon who's behalf an order is being placed by a trader.","Assembly of modules  further includes a module for controlling operation as a function of the determination of the checking of the received client to exchange system message as to whether it includes the expected client device to exchange system message sequence number , a module for rejecting a received client to exchange system message in response to a determination that it does not include the expected client device to exchange system message sequence number , a module for notifying a client device of the rejected client to exchange system message , a module for accepting a received client to exchange system message in response to a determination that it does include the expected client to exchange system message sequence number , and a module for incrementing the expected client device to exchange system message sequence number following acceptance of a client to exchange system message . Assembly of modules  further includes a module for sending at least a portion of an accepted client to exchange system message to a matching engine , a module for receiving a response to a message from a matching engine , a module for transmitting a first exchange system to client device message, e.g., a transaction response message, including said exchange system to client device message sequence number to said client device , a module for incrementing said exchange system to client device message sequence number to generate an updated exchange system to client device message sequence number , and a module for sending an additional exchange system to client device message to said client device, said additional exchange system to client device message including said updated exchange system to client device message sequence number . In some embodiments, said transaction response message includes the content of said uninterpreted field, which was received from the client device, in addition to at least one of an order acknowledgment and order completion information.","Assembly of modules  further includes a module for maintaining a current client device to exchange system message sequence number for each of a plurality of client devices  and a module for maintaining a current exchange system to client device message sequence number for each of a plurality of client devices .","Assembly of modules  further includes a module for sending a transaction response message to said client device in response to a client to exchange system message, e.g., a first client to exchange system message, said transaction response message including the content of said uninterpreted field, which was received from the client device, in addition to at least one of an order acknowledgment and order completion information .",{"@attributes":{"id":"p-0057","num":"0056"},"figref":"FIGS. 6 and 7"},"Drawing  of  illustrates various elements of exemplary system  of  including client  trader system   and exchange system  including security switch , second device , e.g., a message logging system , first device , e.g., a client gateway, and matching engine . There is a client  dedicated link  between trader system   and security switch . There is a shared low latency path  which includes a path from the security switch  through the client gateway  and to the matching engine . There is a high bandwidth path  between the message logging system  and the security switch. Ongoing transaction messages between trading system  and matching engine , traverse client gateway , and are communicated using the shared low latency path  and via the client  dedicated link . Gap fill messages are communicated from the message logging system  to trader system  using the high bandwidth path  and via client  dedicated link .","Drawing  of  illustrates various elements of exemplary system  of  including client  trader system  , client M trader system  , and exchange system  including security switch , second device , e.g., a message logging system , first device , e.g., a client gateway, component interconnect switch , and matching engine . Shared low latency path  provides a path from security switch  to matching engine  via gateway  and component interconnect switch . Both trader system  and trader system  use the low latency path  to ongoing transaction messages with matching engine .","High bandwidth path  provides a path from second device, e.g., message logging system , to security switch , via component switch , to be used for communication of gap fill messages to trader system . In some embodiments, the high bandwidth path  does not traverse the component interconnect switch , e.g., the second device  connects directly to the security switch. Various control signals (, ) communicated between the gateway  and the second device  are used for gap fill related control operations, e.g., to trigger a gap fill, to specify which message or messages are to be sent, to indicate that the missing message or messages have been sent, and\/or to indicate that synchronization has been restored between the client device and the exchange system.","Multiple traders, corresponding to different clients, may communicate with a gateway through which messages are passed for processing. In order to make sure that both a trader and the ECN implementing trades have not lost or dropped messages, message sequence numbers are often used.","Trading sessions may involve thousands of messages, and depending on the size of the discrepancy in the number of messages which the trader system and the gateway are aware of, the number of messages which may need to be communicated, as part of a gap fill before a trading session can proceed, can be significant.","While communication between the trading system and exchange is normally reliable due to the use of TCP\/IP for the portion of the connection between the trader system , and exchange , a communications link may be lost for some reason and\/or the trader system may be shut down or lose power. This may result in the trader system not being fully aware of them messages which were sent by the exchange system or the trader system losing, e.g., not storing, some messages which were sent by the exchange to the trading system  or from the trading system . Thus when the trader system logs in to continue an existing session, the message state in the trader system  may not be fully synchronized with the message state in the exchange system .","In accordance with the present invention, as will be discussed further below, communication of missing messages between a trader system and a gateway is performed over different communications path than is used for the communication of new messages. The secondary communications path used for message gap fills may, and in various embodiments does, have a higher latency then the communications path used for new messages. The secondary communications path, in some embodiments supports a higher communications data rate with the trader system than the communications path used for new messages. Thus, while the latency, e.g., and thus transmission time of an individual message may take longer over the secondary path, the overall data throughput with the trader system may also be higher on the secondary path. Thus a large number of messages may be able to be communicated over the second communications path in less time than would be required to transmit the same large number of messages over the primary communications path used for new messages.","Once message synchronization has been restored, communication of new messages proceeds over the high speed, e.g., primary, message communications path between the trader system and the gateway of the ECN.","The methods and apparatus of the present invention may be used with communications using FIX or a binary order entry protocol such as, e.g., OUCH or a similar protocol. Thus, the methods and apparatus of the present invention are well suited for many of the trading systems and protocols currently in use.","Having generally discussed the exemplary system implementations shown in , an exemplary method will now be discussed in detail with regard to the example shown in . Elements of the system  shown in  which participate in the method being explained in the  example are shown at the top of  and bear the same reference numbers as used in . Messages, information, content and\/or signals communicated between devices are represented in  using arrows. The exemplary process shown in  will now be described in detail.","At the top of , various elements  of the system  which may participate in an exemplary method for restoring message synchronization between a trader system and the client gateway in a trading system during a session, e.g., a trading session, are shown. The illustrated components  include a client device , e.g., a trader system, a second device , e.g., a message logging system, and a first device , e.g., a client gateway.",{"@attributes":{"id":"p-0069","num":"0068"},"figref":"FIG. 8","b":["112","112","134","112","138","112"]},"The process starts in step  where the trader system  sends a connection establishment message  to the exchange system . The connection establishment message  is received by the client gateway  located at the exchange system  in step  and processed. In various embodiments the connection establishment message  is sent to establish a communications session, e.g., prior to performing a trade, between the trader system  and the exchange system .","Following the receipt and processing of the connection establishment message  at the client gateway , in step  the client gateway  sends a gateway ID message  to the trader system  in response to the connection establishment message . The gateway ID message  is received and processed by the trader system  in step . Next in step  the trader system  sends a login message  to the client gateway . In some embodiments the login message  is sent from the trader system  to the client gateway  over a first communications path, e.g., a low latency communications path including path , shown in . In accordance with one aspect of some embodiments, both the trader system  and the client gateway , includes an incoming message counter and an outgoing message counter to keep a track of the number of messages exchanged during a trading session. In some embodiments, there is a client device to exchange system message sequence number for messages from trader system  to the client gateway  and an exchange system to client device message sequence number for a message stream from the client gateway  to trader system  corresponding to a matching engine.","The login message  is received by the client gateway  in step  and is processed. In step  the client gateway  transmits a login response message  to the trader system . In some embodiments, the login response message  communicates a next exchange system to client device message sequence number. In step  trader system  receives message  and recovers the information communicated in login response message .","In step  the trader system generates and transmits a transaction message , e.g., a trade or order message. In step  the client gateway  receives the transaction message  and proceeds to process the trade or order. In step  the client gateway  transmits an acknowledgment message  in response to the transaction message . Consider that the acknowledgment message is successfully received by the trader system  in step . Next, in step  the client gateway  transmits a first partial order complete message  to the trader system . Consider that this message is lost in step  from the perspective of the trader system , which does not successfully receive the first partial order complete message .","Next, in step  the client gateway  transmits a second partial order complete message  to the trader system . Consider that this message  is successfully recovered in step  by the trader system . However, the trader system  determines, e.g., based on an exchange system to client device sequence number included in message  and an exchange system to client device sequence number included in message , that it has lost a message, e.g., the sequence number in message  is higher than expected indicating that a message has been lost or missed. Therefore the trader system , in step  generates and sends a gap fill request message  to client gateway . In step , the client gateway  receives the gap fill request message  from the trader system  requesting a previous message that was sent to the trader system . The client gateway  determines from the gap fill request message that the trader system  requires one previous message to be provided as part of a gap fill operation. In this example of , trader system  lost one message. However, the gap fill may, and sometimes does, apply to multiple messages.","If it is detected that the trader system  is missing one or more messages corresponding to a trading session, then in accordance with the invention, the message synchronization is restored via use of secondary, high bandwidth communications path which is different from a low latency communications path over which the connection establishment message was received and\/or new trade messages are received and processed, e.g., a high bandwidth path including path  in .","Note that in step  the gateway  determines that a message gap fill needs to be performed. In step  a control signal  is then sent to the second device , e.g. a message logging system, from the client gateway  to instruct it to proceed with the necessary message gap fill required to restore message synchronization. The message  may be sent over a secure communications channel. In step  the second device  receives control signal  which triggers a message gap fill. The one or more missing messages  are then communicated from the second device , e.g. the message logging system, via the secondary high bandwidth communications path. In step  the missing message or messages , e.g., information including a copy of missing first partial order message , is received and recovered by the trader system .","Once the missing message or messages are communicated to the trader system  from the second device , a control signal  is sent in step  from the second device  to the client gateway  informing the client gateway  that session synchronization has been restored. The client gateway  in step  receives signal  and recognizes that synchronization has been restored. The gateway device  and the trader system  then proceed with the trading session via the high speed low latency communications path with new trades and replies occurring over the low latency communications path.","Elements of the system  shown in  which participate in the method being explained in the  example are shown at the top of  and bear the same reference numbers as used in . Messages, information, content and\/or signals communicated between devices are represented in  using arrows. The exemplary process shown in  will now be described in detail.","At the top of , various elements  of the system  which may participate in an exemplary method for restoring message synchronization between a trader system and the client gateway in a trading system during a session, e.g., a trading session, are shown. The illustrated components  include a client device , e.g., a trader system, a second device , e.g., a message logging system, and a first device , e.g., a client gateway.",{"@attributes":{"id":"p-0080","num":"0079"},"figref":"FIG. 9","b":["112","112","134","112","138","112"]},"The process starts in step  where the trader system  sends a connection establishment message  to the exchange system . The connection establishment message  is received by the client gateway  located at the exchange system  in step  and processed. In various embodiments the connection establishment message  is sent to establish a communications session, e.g., prior to performing a trade, between the trader system  and the exchange system .","Following the receipt and processing of the connection establishment message  at the client gateway , in step  the client gateway  sends a gateway ID message  to the trader system  in response to the connection establishment message . The gateway ID message  is received and processed by the trader system  in step . Next in step  the trader system  sends a login message  to the client gateway . In some embodiments the login message  is sent from the trader system  to the client gateway  over a first communications path, e.g., a low latency communications path including path , shown in . In accordance with one aspect of some embodiments, both the trader system  and the client gateway , includes an incoming message counter and an outgoing message counter to keep a track of the number of messages exchanged during a trading session. In some embodiments, there is a client device to exchange system message sequence number for messages from trader system  to the client gateway  and an exchange system to client device message sequence number for a message stream from the client gateway  to the trader system  corresponding to a matching engine.","In step , the trader system  sends a login message including an indication of the number of messages received by the trader system. In step , the client gateway receives login message , and determines if a number of received messages indicated in said received login message is less than the number of messages sent to the trader system . In this example, the client gateway  determines that the number of messages received by the trader system  is less than the number or messages sent to the trader system . Therefore, the client gateway determines that the trader system  requires a message gap fill.","In step  the client gateway  generates and sends a control signal  to the second device , e.g., a message logging system, to trigger the second device to supply one or more previously transmitted messages to the trader system  via a second communications path in response to the determination that the trader system requires a message gap fill. The second communications path is a high bandwidth path, e.g., a path including path  in . The message  may be sent over a secure communications channel. Control signal  is received by second device  in step .","In step , in response to signal , second device  sends the one or more missing messages  via the secondary high bandwidth communications path. In step  the missing message or messages  are received and recovered by the trader system .","Once the missing message or messages are communicated to the trader system  from the second device , a control signal  is sent in step  from the second device  to the client gateway  informing the client gateway  that session synchronization has been restored. The client gateway  in step  receives signal  and recognizes that synchronization has been restored. The gateway device  and the trader system  then proceed with the trading session via the high speed low latency communications path with new trades and replies occurring over the low latency communications path.",{"@attributes":{"id":"p-0087","num":"0086"},"figref":"FIG. 10","b":["1000","1002","1002","1004","1004","1004","1006"]},"In step  the exchange system determines that the trader system requires a message gap fill. In some embodiments, step  includes step  and step . In some other embodiments, step  includes step  and . In still other embodiments, step  includes steps , ,  and .","In step  the exchange system receives a gap fill request message from said trader system requesting one or more previous messages that were previously sent to the trader system. In some embodiments, the gap fill request message includes one or more stream identifiers, each stream identifier identifying an exchange to trader message stream for which at least one message is being requested. In some such embodiments, the gap fill request message includes multiple stream identifiers, and each of the multiple stream identifiers corresponds to a different matching engine group from which a message was sent to the trader system. Operation proceeds from step  to step . In step  the trader system determines from the gap fill request message that the trader system requires one or more previous messages to be provided as part of a gap fill operation.","In step  the exchange system determines if a number of received messages indicated in said received message, e.g., a received login message received in step , is less than the number of messages sent to the trader system. Operation proceeds from step  to step . In step  the exchange system determines that said trader system requires a message gap fill when it is determined that the number of messages received by the trader system is less than the number of messages sent to the trader system.","Operation proceeds from step  to step . In step  the exchange system sends a signal to a second device, e.g., a message logging system in the exchange system, to trigger said second device to supply one or more previously transmitted messages to the trader system via a second communications path in response to a determination that the trader system requires a message gap fill. In some embodiments, the second device is a message logging device including stored messages corresponding to the trading session. Operation proceeds from step  to step . In step  the second device is operated to supply one or more previously transmitted messages to the trader system via the second communications path. Operation proceeds from step  to step . In step  the second device is operated to send a signal to the first device indicating that that the trader system and the exchange system have restored message synchronization once the one or more messages have been sent.","In various embodiments, the first communications path has a lower latency than the second communications path. In some embodiments, the first communications path is a communications path used for placing orders and communicating order acknowledgements. In various embodiments, the second communications path supports a higher bandwidth with said exchange system for communications with said trader system than the first communications path which includes said shared low latency link.","In various embodiments, a portion of said first and second communications paths between the trader system and the exchange system are the same, said portion not being shared with other traders. In some embodiments, the second communications path is used for message gap fills and has a higher end to end latency between the trader system and the second device than the first communications path has between the trader system and a matching engine.","In some embodiments, the first device is a client gateway device and the exchange system is an electronic communications network which implements electronic trades.","In some embodiments, the first communications path includes a first link and second communications path includes a second link, and said first and second links are physically different links. In various embodiments, said lower latency over the first communications path is achieved by limiting the amount of data corresponding to an individual client device that can be sent over the link in a continuous burst to an amount which is less than the amount of data corresponding to an individual client device that can be send in a single burst over said second communications link. In some embodiments, said first and second links are the same type of physical links, e.g., both links are wired links.",{"@attributes":{"id":"p-0096","num":"0095"},"figref":["FIG. 11","FIG. 1","FIG. 10"],"b":["1100","1100","138","140","142","144","110","100","1100","1106","1108","1110","1111","1112","1109","1106","1102","1104","1112","1114","1116","1108","1114","1116","1112","1000","1116","1118","1120","1122","1124","1126","1128"]},{"@attributes":{"id":"p-0097","num":"0096"},"figref":["FIG. 12","FIG. 11"],"b":["1200","1200","1114","1112","1110","1200","1204","1206","1216","1218","1220"]},"In some embodiments, module  includes a module configured to receive a gap fill request message from said trader system requesting one or more previous messages that were previously sent to the trader system  and a module configured to determine from the gap fill request message that the trader system requires said one or more previous messages to be provided as part of a gap fill operation . In other embodiments, module  includes a module configured to determine a number of received messages indicated in said received message is less than the number of messages sent to the trader system  and a module configured to determine that said trader system requires a message gap fill when it is determined that the number of messages received by the trader system is less than the number of messages sent to the trader system . In still other embodiments, module  includes module , ,  and .","In some embodiments, the first communications path includes a first link and second communications path includes a second link, and said first and second links are physically different links. In various embodiments, said lower latency over the first communications path is achieved by limiting the amount of data corresponding to an individual client device that can be sent over the link in a continuous burst to an amount which is less than the amount of data corresponding to an individual client device that can be send in a single burst over said second communications link. In some embodiments, said first and second links are the same type of physical links, e.g., both links are wired links.",{"@attributes":{"id":"p-0100","num":"0099"},"figref":["FIG. 13","FIG. 1"],"b":["1300","1300","134","110","100","1300","1306","1308","1310","1","1312","2","1314","3","1316","1318","1309","1306","1302","1304","1318","1320","1322","1312","1310","1314","1316"]},"The processor , e.g., a CPU, may execute the routines  and use the data\/information  in memory  to implement a method, e.g., steps of the method performed by a second device in accordance with flowchart  of . Data\/information  includes stored transaction messages , a received message to trigger gap fill operations , an identified message or messages to be communicated via gap fill , generated gap fill messages , and a generated signal to indicate that gap fill is completed and message synchronization has been restored .",{"@attributes":{"id":"p-0102","num":"0101"},"figref":["FIG. 14","FIG. 13"],"b":["1400","1400","1320","1318","1300","1400","1418","1420","1420","1324","1418","1420","1324","1","1326","1328"]},"Assembly of modules  further includes a module configured to operate the second device to supply one or more previously transmitted messages to a trader system via the second communications path , a module configured to operate the second device to send a signal to the first device indicating that the trader system and the exchange system have been restored to message synchronization once said one or more missing messages have been sent . Assembly of modules  further includes an interface control module  configured to control operations of the various interfaces (, , , ), a missing message identification module  configured to identify which stored messages should be supplied as part of a requested gap fill operation, a gap fill message generation module  configured to generate gap fill messages including the identified missing messages, and a gap fill completed message generation module  configured to generate a message indicating that the requested gap fill operation has been completed and that synchronization has been restored.","An exemplary unicast transaction message  from a trader system, e.g., trader system  is shown is . As shown the unicast transaction message  may include various information such as a gateway identifier , e.g., a gateway unicast address which identifies the particular gateway, e.g., gateway , which is the intended destination of message . Unicast transaction message  also includes a trader system address  which is the source address of message , e.g., an address of trader system .","In addition to the source and destination information, the unicast transaction message  also includes a message identifier . The message identifier  can be used to identify the message and distinguish it from other unicast transaction messages in the system. In some but not necessarily all embodiments, the unicast message identifier  includes a stream identifier portion  and a message counter value . The message identifier  may also include, optionally, an offset value  indicating the offset added to the counter value of the last transaction message sent in the identified stream. The offset value allows incrementing of the counter value by more than one or some non-uniform amount while still allowing a receiving device to accurately generate an expected message counter value from the last message in the identified stream by adding the offset value to the counter value included in the last received transaction message obtained from the identified stream. This allows a receiving device to determine if it is missing any messages whether the message counter value is incremented by the same or different amounts from one message to the next.","In combination the elements of the message identifier field  can identify the unicast message to the trader system, gateway, as well as other devices in the system such a message logging system . The stream identifier  may identify the stream within the system to which the message identifier corresponds. Streams corresponding to different source and destination devices may be treated as different streams. In some embodiments, streams are defined to the level of an individual stream, with an individual stream being between a particular trader system and the particular ME to which an order may be forwarded. Thus, transaction messages from a trader corresponding to different stocks which are handled by different MEs may be treated as different streams. Transaction response message streams may also be defined to a similar level with response messages from different MEs to a trader being treated, at least in some embodiments, as different ME to trader streams. For each stream a different message counter may be maintained. During a session messages corresponding to a stream will normally have their message counter values updated with the sending of each new message. In some embodiments, the message counter value is initially provided by the exchange system, e.g., an ECN, and updated for subsequent messages. Thus, the message identifier  can be used to reliably identify a particular message in the exchange system. A device seeking a message gap fill may indicate the messages it wants provided by providing a range of message identifiers. In some embodiments, the gap fill request message includes a stream identifier and a range of corresponding message counter values which in combination identify a set of messages to be provided in response to the gap fill message.","Referring once again to message , the unicast transaction message  may also include a client-broker identifier  and\/or a trader identifier . The client-broker identifier  identifies the client and\/or broker to which the transaction message  corresponds. Separate values may be used as a client identifier and a broker identify or a single value with a known mapping to a client and broker may be included in the client-broker identifier field. Message  may include various types of transaction information . The transaction information  may include, e.g., order type information  indicating the type of order the transaction message is communicating, a security identifier  identifying a security to which the order relates, a number  of shares to be traded, price information  indicating the price, e.g., on a per share basis, at which the order is to be implemented, un-interpreted field information , e.g., client information echo field information , and\/or additional transaction information  such as a client order identifier sometimes referred to as an order token which may be used to identify the order and may be included in response messages corresponding to the order.","An exemplary multicast transaction message  which may be generated from a received transaction message, e.g., a unicast transaction message, e.g., message , from a trader system , is shown in . As shown the multicast transaction message  may include various information such as a multicast address  which is used as a message destination address. The multicast destination address corresponds to a group of matching engines where one of matching engines in the group is known to be responsible for handling the order book for a security, identified in the received transaction message. The multicast transaction message  also includes a matching engine identifier  identifying the specific matching engine responsible handling the transaction requested in the transaction message, e.g., a matching engine which handles the order book for the identified security to be traded. Thus, while a multicast address is used as the destination address of the message  the message includes information identifying a specific matching engine entity to which the message is intended to be delivered to. Based on the ME identifier , a receiving matching engine is able to determine whether or not it is to process and\/or respond to the message addressed to the matching engine group identified by the address in field .","The multicast transaction message  also includes a gateway multicast group identifier  corresponding to a multicast group to which the sending gateway belongs. The multicast group identifier  may be, e.g., a multicast group address corresponding to a gateway group. In addition to the gateway multicast group identifier , the message  includes a gateway identifier  identifying the particular gateway, e.g., gateway , sending the specific multicast transaction message. Thus, while the message  includes multicast group addresses corresponding to gateway and matching engine groups, it also includes information identifying the specific sending gateway entity and specific destination matching engine. Thus, while multicast addressing is used, the message includes sufficient information to identify a specific sending gateway, e.g., gateway  and a specific destination matching engine, e.g., ME .","In addition to the source and destination information, the multicast transaction message  also includes a multicast message identifier . The multicast message identifier  can be used to identify the message and distinguish it from other multicast transaction messages in the system. In one but not necessarily all embodiments, the multicast message identifier  includes a stream identifier portion  and a message counter value . In combination these elements can identify the multicast message to the gateway, ME as well as other devices in the system such a message logging system . The message identifier  may also include, optionally, an offset value indicating the offset  indicating the offset added to the counter value of the last multicast transaction message sent in the identified stream. The offset value allows incrementing of the counter value by more than one or some non-uniform amount while still allowing a receiving device to accurately generate an expected message counter value from the last message in the identified stream by adding the offset value to the counter value included in the last received transaction message obtained from the identified stream. This allows a receiving device to determine if it is missing one or more previous messages corresponding to the identified stream whether the message counter value is incremented by the same or different amounts from one message to the next. The multicast message counter value  may be the same as the unicast message counter value of the message to which it corresponds. However, in cases where multicast messages are incremented differently from unicast messages they may be different. Also, in some embodiments, NULL multicast transaction messages may be transmitted e.g., by the gateway devices in the exchange on a periodic or other basis to facilitate the rapid detection of the failure of a device to receive a communicated multicast message. In the case of a NULL multicast transaction message generated by a exchange system component, e.g., in response to a recurring timer expiring, the message counter value  will not correspond to a unicast transaction message but will still be higher than the last generated unicast transaction message for the stream identified in the message .","Where unicast transaction messages are incremented by an amount greater than 1, e.g., 2, NULL multicast transaction messages may, and in some embodiments are, generated by incrementing the last received unicast transaction message value by a value less than that used to increment the unicast transaction messages. The NULL transaction messages which do not include any transaction information facilitate the detection, at a receiving device, of a failure to receive a previously transmitted message and are useful as a fault detection mechanism in the exchange system. NULL transaction messages, and corresponding NULL response messages, are not transmitted outside the exchange system, e.g., to a trader system in various embodiments in which they are used.","The stream identifier  may identify the stream within the system to which the multicast message identifier corresponds. Streams corresponding to different source and destination devices may be treated as different streams. In some embodiments, streams are defined to the level of an individual stream, with an individual stream being between a particular trader system and the particular ME to which an order may be forwarded. Thus, transaction messages form a trader corresponding to different stocks which are handled by different MEs may be treated as different streams. Transaction response message streams may also be defined to a similar level with response messages from different MEs to a trader being treated, at least in some embodiments, as different ME to trader streams. For each stream a different message counter may be maintained. During a session messages corresponding to a stream will normally have their message counter values updated with the sending of each new message. Thus, the multicast message identifier  can be used to reliably identify a particular message in the exchange system. A device seeking a message gap fill may indicate the messages it wants by providing a range of multicast message identifiers. In some embodiments, the gap fill request message includes a stream identifier and a range of corresponding message counter values which in combination identify a set of messages to be provided in response to the gap fill message.","Referring once again to message , the multicast transaction message  may also include a client-broker identifier  and\/or a trader identifier . The client-broker identifier  identifies the client and\/or broker to which the transaction message  corresponds. This information may be obtained from a received unicast transaction message, e.g., message , from which the multicast transaction message  is generated. Similarly the message  may include various types of transaction information . The transaction information  may include, e.g., order type information  indicating the type of order the transaction message is communicating, a security identifier  identifying a security to which the order relates, a number  of shares to be traded, price information  indicating the price, e.g., on a per share basis, at which the order is to be implemented, un-interpreted field information , e.g., client information echo field information , and\/or additional transaction information  such as a client order identifier sometimes referred to as an order token which may be used to identify the order and may be included in response messages corresponding to the order.",{"@attributes":{"id":"p-0114","num":"0113"},"figref":"FIG. 17","b":["1700","1700","1600","1700","1600","1700","1600"]},"The multicast transaction response message  includes a multicast address  as a message destination address. The multicast destination address  will normally be the multicast address of the gateway group to which the gateway which sent the transaction message being responded to corresponds. The message also includes gateway identifier  which identifies the specific gateway which sent the transaction message to which response message  corresponds. The information in fields  and  can, and in some embodiments are, obtained by the matching engine that generates message  from multicast transaction message fields , .","Message  also includes ME multicast group identifier  which identifies a multicast group to which the sending matching engine is a member. The sending matching engine is specifically identified by matching engine identifier  that is also included in message . The message  also includes a multicast message identifier  which is generated by the matching engine sending the message. In some embodiments the multicast message identifier  includes a stream identifier  and a message counter value . The multicast message identifier may also include an offset value indicating the increment added to the message counter value of the last multicast message corresponding to the identified stream to generate the current message counter value  included in the message. Thus, the ME can increment the multicast messages corresponding to a stream by increments which may vary and\/or be greater than a fixed number such as one. The inclusion of the offset value is optional and not used in all embodiments.","The stream identifier  identifies a specific stream, e.g., a matching engine to trader stream. The message counter value  is normally updated, e.g., changed, each time a message corresponding to the identified stream is sent by the matching engine.","In some embodiments the matching engine generates and sends null transaction response messages corresponding to streams that it is using to send messages on a periodic basis to facilitate detection of the failure to receive a multicast message at a gateway. The null transaction message will normally include a multicast message identifier which was updated relative to the last transaction response message of a stream to which the message corresponds allowing a receiving device to easily determine if any message were not received.","In addition to the multicast message identifier , the multicast transaction response message  includes a client-broker identifier , trader identifier  and\/or transaction information . Transaction information , includes in some embodiments, order status and\/or completion information , a security identifier , e.g., stock identifier, information on the number of shares traded , information  on the price at which the trades were completed, un-interpreted field information, e.g., client information echo field information , and\/or additional transaction information  such as a client order ID which may be the same as the client order ID of the original trader transaction message  and multicast transaction message  generated by the gateway there from, to which the multicast transaction reply message  corresponds.",{"@attributes":{"id":"p-0120","num":"0119"},"figref":"FIG. 18","b":["1800","1800","1500","1800","1700"]},"The unicast transaction response message  includes a trader system  as a message destination address. The destination address  will normally be the address of the trader system, e.g., trader system , to which sent the transaction message, e.g., unicast transaction message , being responded to corresponds. The message  also includes gateway identifier , e.g., a unicast address of the specific gateway, e.g., gateway , sending the transaction response message .","The message  also includes a message identifier . In some embodiments the message identifier  includes a stream identifier  and a message counter value . The message identifier  may, and in some embodiments does, also include an offset value  indicating the increment added to the message counter value of the last response message corresponding to the identified stream to generate the current message counter value  included in the message . The message counter value  will normally be the same as the message counter value  of the multicast transaction response message from which the unicast transaction response message is generated.","The stream identifier  identifies a specific stream, e.g., a matching engine to trader stream. The message counter value , e.g., obtained from the multicast transaction response message, is normally updated, e.g., changed, each time a message corresponding to the identified stream is sent by the matching engine.","In addition to the message identifier , the unicast transaction response message  includes a client-broker identifier , trader identifier  and\/or transaction information . Transaction information , includes in some embodiments, order status and\/or completion information , a security identifier , e.g., stock identifier, information on the number of shares traded , information  on the price at which the trades were completed, un-interpreted field information , e.g., client information echo field information, and\/or additional transaction information  such as a client order ID which may be the same as the client order ID of the original trader transaction message  to which the unicast transaction reply message  corresponds.","In various embodiments the information supplied by the client device, e.g., trader system , in uninterpreted field  of unicast transaction message  is returned, e.g., echoed back without alteration, in a unicast transaction response message , which is in response to unicast transaction message . In some such embodiments, the information in uninterpreted fields (, , , ) of messages (, , , ) is identical corresponding to the same transaction.","In one example, transaction message  of  is a unicast transaction message in accordance with the format of message  of , and transaction response messages (, , ) are unicast transaction response messages in accordance with the format of message  of . In some embodiments, first device , e.g., a client gateway, generates a multicast transaction message in accordance with the format of message  of  in response to received unicast transaction message  and based on information provided in unicast transaction message . In some embodiments, first device , e.g., a client gateway, generates unicast transaction response messages (, , ) in response to three received multicast transaction messages which were in accordance with the format of multicast transaction response message  and based on information provided in three multicast transaction response message, respectively.","Methods and apparatus are described for facilitating communication of previously transmitted messages which were lost by either a trading system or ECN during a communications session.","In accordance with various exemplary embodiment, trading related messages, e.g., order messages and replies, are transmitted over a high speed communications path within an exchange system, e.g., an ECN. Multiple trading systems may share the same high speed communications path. The high speed communications path is a low latency communication path in several embodiments allowing transactions to be communicated and implemented quickly in a reliable manner.","When the loss of one or more messages is detected by the trader system or the ECN, e.g., based on a sequence of message number differing from what was expected, the trader system or ECN missing one or more messages corresponding to a communications session is provided the messages via a communication path which is different from the communications path used to submit new orders. An expected message number may be generated by adding a predetermined offset value or an offset value indicated in a received message to the message number of the last message that was received corresponding to the stream to which the message being processed was received. The supply of the missing messages may occur over a secondary communications path which is different from the high sped communications path used to communicate new orders. The secondary communications path may support a higher data rate with the trader system than the high speed data path. In some embodiments, while the secondary path supports a higher data rate with the trader system, allowing for the reply of a large number of messages, the latency on the secondary data path may be higher than that of the high speed communications path.","In addition to using the secondary, high bandwidth communications path for message replay operations to restore synchronization, in some embodiments different physical hardware, e.g., a message storage and reply device, which is different from the hardware used to service, e.g., perform order matching, for new orders, is used to communicate the supply the missing messages as part of a reply operation.","Thus, by using different communications paths and different physical hardware to support message replay operations than service new orders, processing and communication of new order messages and corresponding replies is not delayed by message re-synchronization operations such as message replay operations.","Once message synchronization is restored via use of the secondary communications path, message communication, e.g., the communication of new orders and reply messages, proceeds using the high speed communications path within the ECN.","Thus, various methods and apparatus described herein can be used to reduce or limit the affect of the need to replay messages and\/or otherwise restore message synchronization with a trader system on other traders who may share a high speed communications path used to place orders with an ECN.","In some embodiments the uninterpreted field is used to communicate a value or information which is meaningful or used by the client or broker corresponding to the message. In some but not necessarily all embodiments the uninterpreted field provides no information to the exchange system and the content of the uninterpreted field is not used to control message processing in the exchange or provide information to the exchange.","In some but not necessarily all embodiments, the client device, e.g., trader device, includes in the uninterpreted field information which has no meaning and or informational value to the exchange system or devices included therein but which provides information which is meaningful to the client and\/or broker. Thus, while the exchange may control the numbering used in the messages sent by the client, the client is able to include an identifier and\/or other information which can be interpreted by the client and\/or broker. The information can be used to allow a broker to correlate orders and\/or other transactions to a particular client and\/or trade and may include identification information which is meaningful within the broker's system. While the devices in the exchange system pass the content of the uninterpreted message field they do not interpret the content of this field or use the content in making exchange processing decisions. In essence, the exchange system merely passes the content of the uninterpreted message field back to a device when it sends a response message in response to a transaction message which included the particular field. Thus, while the exchange can control message number the client device is allowed to include additional numbers and\/or other information which it uses to track and\/or identify orders and which may also be used by the broker associated with the client and\/or trader which sends the message.","A broker and\/or trader system can request messages corresponding to an individual on whose behalf transaction messages have been sent by requesting messages from the exchange system's message logging system using the broker's and\/or traders knowledge of the relationship between client order numbers corresponding to the individual for whom messages are being requested and the message numbering used by the exchange system.","While client order numbers are shown in some messages as being part of the additional transaction information, in many embodiments the client order number information is included within the uninterpreted field of transaction messages sent to the exchange system in which case the client order numbers are not interpreted or used by the exchange system but are echoed back in any transaction response messages generated by the exchange system in response to the transaction message which supplied the client order number in the uninterpreted field of the transaction message.","From the above discussion it should be appreciated that numerous variations and embodiments are possible.","The techniques of various embodiments may be implemented using software, hardware and\/or a combination of software and hardware. Various embodiments are directed to apparatus, e.g., gateways, severs, nodes, terminals, etc. Various embodiments are also directed to methods, e.g., methods of performing risk checking. Various embodiments are also directed to non-transitory machine, e.g., computer, readable medium, e.g., ROM, RAM, CDs, hard discs, etc., which include machine readable instructions for controlling a machine to implement one or more steps of a method.","It is understood that the specific order or hierarchy of steps in the processes disclosed is an example of exemplary approaches. Based upon design preferences, it is understood that the specific order or hierarchy of steps in the processes may be rearranged while remaining within the scope of the present disclosure. The accompanying method claims present elements of the various steps in a sample order, and are not meant to be limited to the specific order or hierarchy presented.","In various embodiments nodes described herein are implemented using one or more modules to perform the steps corresponding to one or more methods, for example, signal receiving, processing, generation and\/or transmission steps. Thus, in some embodiments various features are implemented using modules. Such modules may be implemented using software, hardware or a combination of software and hardware. Thus, in at least some embodiments the modules are hardware modules. Many of the above described methods or method steps can be implemented using machine, e.g., computer, executable instructions, such as software, included in a machine readable medium such as a memory device, e.g., RAM, floppy disk, etc. to control a machine, e.g., general purpose computer with or without additional hardware, to implement all or portions of the above described methods, e.g., in one or more nodes. Accordingly, among other things, various embodiments are directed to a machine-readable medium including machine executable instructions for causing a machine, e.g., processor and associated hardware, to perform one or more of the steps of the above-described method(s). Some embodiments are directed to a device, e.g., control node, including a processor configured to implement one, multiple or all of the steps of one or more methods of the invention.","In some embodiments, the processor or processors, e.g., CPUs, of one or more devices, e.g., gateway or other node, are configured to perform one or more of the steps of the methods described herein. The configuration of the processor may be achieved by using one or more modules, e.g., software modules, to control processor configuration and\/or by including hardware in the processor, e.g., hardware modules, to perform the recited steps and\/or control processor configuration. Accordingly, some but not all embodiments are directed to a device, e.g., node, with a processor which includes a module corresponding to each of the steps of the various described methods performed by the device in which the processor is included. In some but not all embodiments a device, e.g., node, includes a module corresponding to each of the steps of the various described methods performed by the device in which the processor is included. The modules may be implemented using software and\/or hardware.","Some embodiments are directed to a computer program product comprising a non-transitory computer-readable medium comprising code for causing a computer, or multiple computers, to implement various functions, steps, acts and\/or operations, e.g. one or more steps described above. Depending on the embodiment, the computer program product can, and sometimes does, include different code for each step to be performed. Thus, the computer program product may, and sometimes does, include code for each individual step of a method, e.g., a method of controlling a node. The code may be in the form of machine, e.g., computer, executable instructions stored on a non-transitory computer-readable medium such as a RAM (Random Access Memory), ROM (Read Only Memory) or other type of storage device. In addition to being directed to a computer program product, some embodiments are directed to a processor configured to implement one or more of the various functions, steps, acts and\/or operations of one or more methods described above. Accordingly, some embodiments are directed to a processor, e.g., CPU, configured to implement some or all of the steps of the methods described herein. The processor may be for use in, e.g., a communications device, control device or other device described in the present application.","To the extent that any incorporated applications included language or descriptions of system elements which are contrary to the language or description of embodiments or elements described herein, the language and descriptions included in the text of the present application is to be deemed controlling.","While described in the context of a trading system, at least some of the methods and apparatus of various embodiments are applicable to a wide range of systems."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE FIGURES","p":[{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0021","num":"0020"},"figref":["FIG. 3","FIG. 3A","FIG. 3B"]},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":["FIG. 5","FIG. 4"]},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0030","num":"0029"},"figref":["FIG. 12","FIG. 11"]},{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0032","num":"0031"},"figref":["FIG. 14","FIG. 13"]},{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 15"},{"@attributes":{"id":"p-0034","num":"0033"},"figref":"FIG. 16"},{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 17"},{"@attributes":{"id":"p-0036","num":"0035"},"figref":"FIG. 18"}]},"DETDESC":[{},{}]}
