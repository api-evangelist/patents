---
title: Distributed method of indexing time and file size alignment
abstract: Logical content is defined by start/end times into a VoD media offering. The calculation of byte-range markers corresponding to the start/end times is distributed among the STBs to first request the particular logical content. Upon receiving an initial request for a logical content offering, an IPTV AS returns a VoD media file URL, start/end times, and null values of byte-range markers corresponding to the start/end times. In response to the null values, the initially-requesting STB downloads the entire VoD media file from a Download Media Server, and calculates the byte-range markers by comparing the start/end times to timestamps in non-encrypted headers in the VoD media file. The non-null byte-range markers are transmitted back to the IPTV AS, which provides them to STBs subsequently requesting the same logical content. The subsequently-requesting STBs may download only the logical content by providing the non-null byte-range markers to the Download Media Server.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08627387&OS=08627387&RS=08627387
owner: Telefonaktiebolaget L M Ericsson (publ)
number: 08627387
owner_city: Stockholm
owner_country: SE
publication_date: 20111222
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF THE INVENTION","BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"p":["The present invention relates generally to Video on Demand subscriber networks, and in particular to a system and method of distributed calculation of byte addresses for logical content delivery.","Internet Protocol TeleVision (IPTV) is a system through which television-type content and services are delivered using the Internet Protocol (IP) over packet-switched networks, such as the Internet and most modern wireless telecommunication networks. IPTV is distinguished from various applications that transfer video files across networks, by an ongoing standardization process and deployment in subscriber-based telecommunication networks featuring tightly managed network security and performance, allowing a high Quality of Service (QoS) and enhanced user experience. IPTV subscriptions typically require at least one cooperative network node, referred to herein as a Set-Top Box (STB), installed at the subscriber premises. IPTV services may be classified into three main types: live (i.e., real-time) broadcast television, time-shifted television (e.g., replays of previously broadcast television content), and Video on Demand (VoD). VoD offerings typically comprise movies, as opposed to television content.","VoD is generally offered as a streaming service, such as Real Time Streaming Protocol (RTSP), or as a download service, such as HTTP download. VoD streaming service is used in IPTV deployments where the available bandwidth over the last mile (i.e., in the access network) is greater than the bandwidth required by the stream. VoD download service has no specific bandwidth requirements; the media content downloads in the background and when completed, the user is notified that he or she may begin to play it.","Rental movies are the content typically offered through the VoD service, including VoD download service. In this case, the movie asset within the offering package references the entire VoD media file. A Download Manager application within the STB must either download the media file fully before starting to play it, or utilize a Progressive Download delivery method, whereby the play can start before the file is been fully downloaded.","Another type of content offered through the VoD service, including VoD download service, is called logical content. A logical content offering is one or more clips, or portions, of a movie or other VoD media file. As a practical implementation matter, it is not feasible to download an entire VoD media file to the STB and play only a portion of it, considering the impact on the bandwidth consumed and the download time. The bandwidth available for the VoD download service is generally limited; hence, such an implementation is not user friendly or cost effective.","There are three known solutions addressing the logical content download optimization problem: Content\/Asset Management System (CMS\/AMS); server-based logical content clipping; and client-based logical content clipping.","The CMS\/AMS solution generates, at logical package creation time, a new VoD package for download, which contains the clipped media file. In this solution, each time a new logical content is defined, the base movie asset (i.e., a VoD media file) must be decrypted and clipped, and the logical content re-encrypted. The decryption\/re-encryption process is resource intensive, and is therefore disfavored by operators.","In server-based logical content clipping, a logical content package, which contains start and end time markers for the base asset, is created. For example, the start\/end time markers may comprise startNPT\/endNPT (Normal Playback Time) markers, that measure elapsed time from a specific temporal point within the VoD media file (e.g., NPT=0 or the Beginning Of Stream, or BOS, marker). At package ingestion, the Download Media Server downloads the entire media file from a CMS\/AMS. The STB retrieves the startNPT\/endNPT markers from an IPTV Application Server (AS) at the time of purchasing the logical content offering. The STB then requests a time-range download from the download media server. However, most media servers support byte-range partial file download, as this is standard in the HTTP protocol (range header), but do not in fact support time-range downloads. The time-range download is not supported in standards published by standards bodies such as the Internet Engineering Task Force (IETF). Therefore, media server manufacturers do not have any incentive to implement this method.","In client-based logical content clipping, the STB obtains the temporal start\/end markers from the IPTV AS upon purchasing the VoD offering. The STB then downloads the entire VoD media file from the download media server, but only plays (as specified in the purchased VoD offering) the time range delimited by the temporal markers. The obvious drawback of this solution is that the entire VoD media file must to be downloaded to the STB, but only a small portion is rendered to a user. This wastes bandwidth in any scenario, but in the particular case of low bandwidth in the last mile access network, would result in long download time. This is especially critical when the logical content is only a small segment of a long movie, as in the case of movie advertisement.","There exists a need in the art for an efficient system and method of delivering VoD logical content to a plurality of STBs, without wasting bandwidth and by utilizing industry-standard file fragmentation protocols.","According to one or more embodiments disclosed and claimed herein, the calculation of byte-range markers corresponding to the temporal start and end markers into a VoD media file that define a logical content offering, is distributed among the STBs to first request the particular logical content. Upon receiving an initial request for a logical content offering, an IPTV AS returns a VoD media file URL, start and end times into the VoD media file defining the logical content offering, and null values of byte-range markers corresponding to the start and end times. In response to the null values, the initially-requesting STB downloads the entire VoD media file from a Download Media Server (using the URL). The initially-requesting STB then calculates the byte-range markers corresponding to the start and end times by inspecting timestamps in headers in the VoD media file. The headers are not encrypted, and the full VoD media file need not be decrypted for this calculation. The valid (non-null) byte-range markers are transmitted back to the IPTV AS, which provides them to STBs that subsequently request the same logical content. The subsequently-requesting STBs may download only the logical content by providing the valid byte-range markers (with the VoD media file URL) to the Download Media Server. The Download Media Server, which implements the HTTP Range header functionality, may extract, without decryption, the logical content, and transmit only that portion of the VoD media file to all subsequently-requesting STBs.","One embodiment relates to a method of distributing logical content in a VoD network. A first request for logical content comprising a subset of a VoD media file, and defined by predetermined start and end times measured from a temporal start point within the VoD media file, is received from a network node. A URL associated with the VoD media file, the start and end times defining the logical content, and byte-range markers defining offsets into the VoD media file corresponding to the start and end times, wherein the byte-range markers have a null value, are transmitted to the first requesting node. Non-null values for the byte-range markers are received from the first requesting node and stored. One or more subsequent requests for the same logical content are received from one or more network nodes. A URL associated with the VoD media file, the start and end times defining the logical content, and the non-null byte-range markers corresponding to the start and end times are transmitted to each subsequent requesting node.","Another embodiment relates to a method of receiving logical content by a STB in a VoD network. A request for logical content comprising a subset of a VoD media file, the subset defined by predetermined start and end times measured from a temporal start point within the VoD media file, is transmitted to an IPTV AS. A URL associated with the VoD media file, the start and end times defining the logical content, and byte-range markers defining offsets into the VoD media file corresponding to the start and end times, wherein the byte-range markers have a null value, are received from the IPTV AS. In response to the null byte-range markers, a request for the full VoD media file, and the URL associated with the VoD media file, are transmitted to a Download Media Server. The full VoD media file is received from the Download Media Server. Non-null values of the byte-range markers corresponding to the start and end times are ascertained, and the non-null byte-range markers are transmitted to the IPTV AS.","Yet another embodiment relates to an IPTV AS operative to deliver logical content in a VoD network. The IPTV AS includes a transceiver operative to transmit and receive data to and from a plurality of network nodes, and memory. The IPTV AS also includes a controller operative to control the transceiver to receive, from a network node, a first request for logical content comprising a subset of a VoD media file, the subset defined by predetermined start and end times measured from a temporal start point within the VoD media file. The controller is further operative to control the transceiver to transmit, to the first requesting node, a URL associated with the VoD media file, the start and end times defining the logical content, and byte-range markers defining offsets into the VoD media file corresponding to the start and end times, wherein the byte-range markers have a null value. The controller is further operative to control the transceiver to receive, from the first requesting node, non-null values for the byte-range markers. The controller is further operative to control the memory to store the non-null byte-range markers. The controller is further operative to control the transceiver to receive, from one or more network nodes, one or more subsequent requests for the same logical content; and to transmit, to each subsequent requesting node, a URL associated with the VoD media file, the start and end times defining the logical content, and the non-null byte-range markers corresponding to the start and end times.","Still another embodiment relates to a network node operative to receive logical content in a VoD network. The node includes a transceiver operative to transmit and receive data to and from at least one network node. The node also includes a controller operative to control the transceiver to transmit, to an IPTV AS, a request for logical content comprising a subset of a VoD media file, the subset defined by predetermined start and end times measured from a temporal start point within the VoD media file. The controller is further operative to control the transceiver to receive, from the IPTV AS, a URL associated with the VoD media file, the start and end times defining the logical content, and byte-range markers defining offsets into the VoD media file corresponding to the start and end times, wherein the byte-range markers have a null value. In response to the null byte-range markers, the controller is further operative to control the transceiver to transmit a request for the full VoD media file, and the URL associated with the VoD media file, to a Download Media Server, and to receive the VoD media file from the Download Media Server. The controller is further operative to ascertain non-null values of the byte-range markers corresponding to the start and end times, and to control the transceiver to transmit the non-null byte-range markers to the IPTV AS.",{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 1","b":["10","10","12","14","18","18","19","12","14","16","18"]},"The IPTV AS  manages the VoD system, including running the vending (or subscription) process, maintaining and providing catalogs of VoD content, accepting and approving requests for VoD media delivery to the STB , and delivering VoD download information to the STB . The Download Media Server  stores the VoD download media file and delivers full and partial VoD media files to STBs . The Download Media Server  is able to deliver portions of VoD media files to STBs  using byte-range markers, based on the HTTP Range header. The Download Media Server  downloads the VoD media files from the CMS\/AMS , e.g., using File Transfer Protocol (FTP). The ingestion may be controlled by an application such as OpenStream, which forwards to the Download Media Server  the media file URL (pointing to AMS\/CMS ).","The STB , which may comprise a network node provided by the IPTV vender, a gaming console with STB functionality in software, or the like, is the user interface to the VoD subscription network . Users view content offerings, make selections, order VoD media, and view the delivered VoD media content, via the STB . To implement this functionality, the STB  includes STB Local Media Storage , such as a disc drive, and several applications or functional modules, including a VoD App Client , a Download Manager , and a Logical Content Mapper . The VoD App Client , which interfaces to other applications on the STB  via an STB Framework Application Programming Interface (API) , interfaces with the IPTV AS . The VoD App Client , under user control, displays catalogs of VoD content, and accepts user requests for VoD content and submits them to the IPTV AS . The IPTV AS  returns to the VoD App Client  a URL specifying the location of the VoD media file to be delivered. The VoD App Client  communicates this information to the Download Manager , which retrieves the VoD media file from the Download Media Server , using the URL received from the IPTV AS . The VoD media file, or portions thereof, is stored in the STB Local Media Storage , from which it is retrieved and rendered to the user, such as to a television screen and speakers (not shown), or other media player.","As discussed above, logical content is defined in offerings on the IPTV AS  by predetermined start and end times measured from a temporal start point within a VoD media file. However, most implementations of the Download Media Server  cannot extract logical content from VoD media files based on temporal start\/end markers, and other methods of logical content extraction and delivery to the STB  are inefficient or impractical, due in part to the need to decrypt the VoD media file and re-encrypt the logical content.","According to embodiments of the present invention, a distributed logical content extraction and delivery system amortizes the wasteful bandwidth \u201chit\u201d of a full VoD media file download to the first STB  that orders a particular logical content offering, over all subsequent deliveries of the same logical content. The first STB  downloads the full VoD media file, and calculates the byte-range markers into the file that corresponding to the temporal start\/end markers that define the logical content offering (received from the IPTV AS  when ordering). The first STB  can do this without decrypting the entire VoD media file, as it compares the start\/end markers to timestamps in unencrypted packet headers in the VoD media file. This first STB  then transmits the byte-range markers to the IPTV AS , which stores them and associates them with the logical content offering.","Subsequent STBs  that order the logical content receive from the IPTV AS , in addition to other information (the VoD media file URL, the temporal start\/end markers defining the logical content, and the like), the byte-range markers into the VoD media file that define the logical content offering. These STBs  then request only the logical content from the Download Media Server . Since the Download Media Server  supports HTTP Range headers, it is able to easily extract the logical content from a VoD media file, and deliver only the logical content to the second and subsequent requesting STBs . Since it uses byte-range markers to extract part of the VoD media file, the Download Media Server  does not need to decrypt the VoD media file, or re-encrypt the extracted logical content. Hence, all orders for a given logical content offering, other than the first order, are delivered quickly and efficiently.","This process is described more fully with reference to the signal flow diagram of . Initially, a user purchases a VoD offering which contains logical content. The logical content (portion of a base VoD media file) is specified in the offering using a time-range expressed in the form startNPT\/endNPT (Normal Playback Time). The STB  orders VoD content from an IPTV AS , and the media files are served to the STB  from a Download Media Server  (which retrieves them from a CMS\/AMS ).","In particular, the VoD App Client  retrieves from IPTV AS  the DownloadInfo by providing the userId, equipmentId and the offeringId of the offering purchased by the user (step ). The IPTV AS  gets the corresponding VoD media file URL from the VoD server  (steps -). The IPTV AS  returns to the STB  VoDDownloadInfo including the URL, start\/end times defining the logical content, and byte-range markers into the VoD media file corresponding to the start\/end times (step ). If the logical offering exists in a sharing repository (i.e., if this is a subsequent request for the logical content offering), the byteStart\/byteEnd markers are valid. Otherwise (i.e., if this is the first request for the logical content offering), these markers are null.","As used herein, a \u201cnull\u201d value for a byte-range marker means either an attribute-value pair for which the value is a predetermined value indicating a null condition (e.g., zero, 'hFFFF, or some other predetermined value), or the lack of any attribute-value pair for the byte-range marker. In either case, the STB  may determine that valid byte-range marker values have not yet been determined for the requested logical content offering. Conversely, as used herein, a \u201cvalid\u201d or \u201cnon-null\u201d value for a byte-range marker means a byte count that defines an offset into a VoD media file. Thus, valid or non-null byte-range marker values are constrained to the range from zero to the VoD media file size.","The VoD App Client  checks the byteStart\/byteEnd markers (step ). If they are valid\u2014that is, if they exist, and define byte count offsets into a VoD media file\u2014it instructs the Download Manager  to retrieve the logical content offering from the Download Media Server  using the byte-range markers (not shown).","If the byteStart\/byteEnd markers have a null value, the VoD App client  requests the Download Manager  to start downloading the VoD media file stored at the address provided in the downloadURL parameter (step ). The Download Manager  retrieves the VoD media file from the Download Media Server  (steps -), stores it in the STB Local Media Storage , and notifies the VoD App Client  by returning the URL of the local VoD media file (step ).","The VoD App Client then calls the Logical Content Mapper  to calculate the byte-range markers (byteStart\/byteEnd) (step ). The request contains the ID of the VoD media file to be analyzed, the URL retrieved in step , and the time-range markers (startNPT\/endNPT). The Logical Content Mapper  executes a byte-range search algorithm, described further herein, in which it matches the time-range start\/end markers to header timestamps, and calculates byteStart\/byteEnd markers corresponding to the startNPT\/endNPT markers for the particular VoD media file. The Logical Content Mapper  returns the byteStart\/byteEnd markers to the VoD App Client  (step ).","The VoD App Client saves the byte-range markers specifying the logical content in the VoD media file to IPTV AS sharing repository (steps -), for use by all subsequent STBs  that order the same logical content offering. The STB  then renders the logical content to the user, such as by outputting it to a television or other media player.",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 3","b":["100","14","14","12","102","14","104","14","12","112"]},"However, if the byte-range markers have a null value (block ), then this is the first request for the logical content, and valid byte-range markers have yet to be calculated. In this case, the IPTV AS  transmits the VoD media file URL, the start\/end times, and the null byte-range markers to the STB  (block ). After the STB  retrieves the full VoD media file and calculates valid byte-range marker values corresponding to the start\/end markers, the IPTV AS  receives the valid byte-range markers from the STB  (block ), and stores them in a shared repository (block ).",{"@attributes":{"id":"p-0037","num":"0036"},"figref":"FIG. 4","b":["200","12","12","14","202","12","14","204"]},"If the byte-range markers have a null value (block ), then the STB  transmits the URL and a request for the full VoD media file to a Download Media Server  (block ). The STB  receives (and stores) the full VoD media file (block ). The STB analyzes the VoD media file, and ascertains valid, non-null values for the byte-range markers, which correspond to the start\/end markers defining the logical content offering (block ). The STB  transmits the non-null byte-range markers to the IPTV AS , for use by subsequent STBs  requesting the same logical content offering (block ).","If the byte-range markers received from the IPTV AS  have a valid, non-null value (block ), then the STB  transmits a request for the logical content, the VoD media file URL, and the valid byte-range markers to a Download Media Server  (block ), and receives the logical content in response (block ).","Once the STB  has the logical content extracted\u2014whether extracted from the full VoD media file using the byte-range markers the STB  ascertained (block ), or received from the Download Media Server  (block ) in response to valid byte-range markers it received from the IPTV AS  (block )\u2014the STB  renders the logical content to a user (block ), such as by outputting it to a television or other media player.",{"@attributes":{"id":"p-0041","num":"0040"},"figref":"FIG. 5","b":["300","28","12"]},"Initially read, in direct file access mode, a segment of the full VoD media file (stored in the STB Local Media Storage ) addressed by the localFileURL obtained from the VoD App Client  (blocks ). Set the segment size to be a multiple of the maximum size of the Packetized Elementary Stream (PES) for MPEG-2 packet, or Synchronization Layer (SL) for MPEG-4 packet.","Search the headers of the PES\/SL packets for timestamps equal to the startNPT\/endNPT markers (blocks ). The Presentation Time Stamp (PTS) is used if it is provided in the header; otherwise, either the Decoding Time Stamp (DTS) or Composition Time Stamp (CTS) is used.","If startNPT is not found the current segment (blocks , ), calculate the next segment startAddress using the packet size retrieved from the PES\/SL packet header (block ), retrieve a new segment (block ), and repeat the method.","If startNPT has been found (blocks , ), save the startAddress and the PES\/SL relative address within the buffer, and calculates the next segment startAddress using the packet size retrieved from the PES\/SL packet header (block ), and repeat the method.","Once the endNPT marker is found (block ), calculate the byte-range of the logical content, i.e., the byteStart\/byteEnd, using the segmentAddress of the segments where the time-range markers have been found, and the PES\/SL relative address within that specific segment (block ). Then return the byteStart\/byteEnd marker values to the VoD App Client  (block ).","For simplicity and clarity of explication, the present invention has been described herein with respect to a logical content offering comprising a single, contiguous segment of a VoD media file. In reality, logical content (e.g., movie \u201ctrailers\u201d or advertisements) often comprise a plurality of disjoint or non-contiguous segments extracted from a VoD media file. In this case, the IPTV AS  will provide a corresponding number of start\/end marker pairs to the VoD App Client , and the Logical Content Mapper  must run the method  of  multiple times (with appropriate modifications to account for multiple sets of segment addresses and offsets, as will be readily apparent to those of skill in the art). In this case, the Logical Content Mapper  will return multiple pairs of non-null byte marker values to the VoD App Client , which will in turn transmit multiple non-null byte marker values to the IPTV AS  for storage in the shared repository. All segments comprising the logical content must be concatenated into one single file in the STB Local Media Storage  before passing control to a media player. Of course, in the corresponding case of receiving multiple valid (non-null) byte-range markers from the IPTV AS , the Download Manager  must download all segments for the logical content from the Download Media Server , and concatenate them in the STB Local Media Storage , prior to passing control to a media player.","The method depicted in  refers to calculation of the byte-range markers corresponding to a logical content which consists of one single stream (e.g., video stream), and which includes no control information. The method does not specify any particular procedure regarding how to handle the transmission headers in the media file, or the packets containing control information. This information must be included into the logical content media file as it is required by the client to interpret the content of PES\/SL packets. The Logical Content Mapper  must therefore return a set of byteStart\/byteEnd markers delimiting the following:","Transmission headers in the media file;","PES\/SLs corresponding to logical content within the elementary video streams (if there are multiple streams);","PES\/SLs corresponding to logical content within the elementary audio streams (if there are multiple streams). Depending on the multiplexing method, the elementary audio packets may be tightly coupled to their time-corresponding elementary video packet, and hence should be included in one single byte-range set; and","Control information (e.g., the Conditional Access Table).","Those of skill in the art may readily determine appropriate methods to account for this information in particular applications, without undue experimentation, given the teachings of the present disclosure.","Embodiments of the present invention provide a scalable, client-based architecture for the generation of byte-range markers corresponding to the start\/end markers defining logical content offerings, with no performance impact on the network nodes. The solution does not require the decryption of the media file or decoding of MPEG PES\/SL packets. Only the packet headers are analyzed.","VoD download service has a significant business potential in countries which do not have a mature broadband infrastructure, and hence a VoD service based on streaming transport (e.g., RTSP) is not feasible. This opportunity becomes even more acute with the introduction of HD television. Use of HTTP download as transport protocol makes it possible for operators in these markets to capitalize on premium content without waiting for investments in the broadband infrastructure aiming to increase the last mile bandwidth. In these markets, the bandwidth lost by downloading an entire VoD media file, instead of just a portion of it, would be in contrast with the limited speed\/bandwidth available; therefore logical content would be avoided for purchase. That is, without implementation of a mechanism allowing the download of only the segment of the media file corresponding to the logical content purchased, only full movies would be purchased by user in these markets. It should be noted that logical content is an essential element in the construction of media playlists, which typically contain, besides the purchased content, advertisements of feature presentations (i.e., clips of a full length movie).","Implementation of VoD media file clipping to support logical content in the Download Media Server  is not cost effective, as the Download Media Server  would need to be over-dimensioned to allow searches through VoD media files. Embodiments of the present invention provide a cost-effective solution based on client-based distributed search, and sharing of the search results among the STBs  in the network .","Those of skill in the art will recognize that the VoD App Client , Download Manager , and Logical Content Mapper  may be implemented in hardware, as programmable logic with appropriate firmware, as software modules executed on a processor or Digital Signal Processor (DSP), or any combination thereof. Furthermore, the division of tasks between the modules , , and  is representative only, and is not limiting. For example, although the actual VoD media file header search and byte-range marker determination is described herein and being performed by an inventive module referred to as the Logical Content Mapper , those of skill in the art will appreciate that the functionality is not confined to such an implementation, and may be performed in the Download Manager , VoD App Client , or other functional module or unit.","The present invention may, of course, be carried out in other ways than those specifically set forth herein without departing from essential characteristics of the invention. The present embodiments are to be considered in all respects as illustrative and not restrictive, and all changes coming within the meaning and equivalency range of the appended claims are intended to be embraced therein."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 5"}]},"DETDESC":[{},{}]}
