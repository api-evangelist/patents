---
title: Generic external proxy
abstract: A first machine communicates with a second machine, using a protocol that sends the first machine's network configuration data in application data sent to the second machine, through a translating access point which translates network traffic from the first machine so as to originate from the access point. A network configuration server provides to the first machine network configuration data not subject to translation by the access point, which is sent to the second machine in the application data. The second machine communicates with the provided network configuration, and this communication is in turn made available to the first machine.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07293108&OS=07293108&RS=07293108
owner: Intel Corporation
number: 07293108
owner_city: Santa Clara
owner_country: US
publication_date: 20010315
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD OF THE INVENTION","BACKGROUND","DETAILED DESCRIPTION"],"p":["The invention generally relates to networking, and, more particularly, to supporting usage of communication protocols that embed non-accessible network configuration data within network traffic.","Recent years has given significant advances in networking technology and reduced pricing, resulting in a significant buildup of networking infrastructure. Most businesses and households are interconnected through private and public networks, the most well known network being the Internet. Most networks now utilize the Transmission Control Protocol\/Internet Protocol (TCP\/IP) communication protocol, in which network locations are assigned a globally unique 32-bit numeric address typically presented in dot quad notation (four numbers each having values of zero to 255). TCP\/IP network traffic is routed based on a destination IP address for the traffic.","Unfortunately, the explosive growth of the Internet has resulted in a shortage of available network addresses. To compensate, attempts have been made to share a single network address among multiple computers. One well-known example is Network Address Translation (NAT), which hides an internal network behind an access point in communication with an external network by routing network traffic through the access point. Since the internal network uses private network addresses the packets from this network are not routable in the Internet without translation. During operation, NAT modifies source IP address and ports of outgoing network traffic to map the traffic to an external or public address and a unique NAT port. NAT also modifies destination IP address and port of incoming network traffic using the mapping of external address and unique NAT port back to the original internal address and port. NAT ignores network traffic not received in response to original outgoing network traffic, and incoming traffic to unmapped ports.","Network traffic translation performed by a translating access point such as a NAT gateway\/router , firewall , or the like, is transparent to many applications. However, translations break protocols under certain circumstances, such as with audiovisual conferencing (e.g., International Telecommunication Union (ITU) standard H.323), IP Security (IPSec), end-to-end security models that cannot allow packet header alterations, and protocols that embed a machine's network address and\/or communication port values as application data within network traffic, such as the File Transfer Protocol (FTP), multi-player network game protocols, etc.","For example, in , an H.323 client  inspects its network configuration and sends it to an H.323 gateway  as application data. Because H.323 client  is in a private network, the configuration indicated in the application data cannot be used by H.323 gateway  to access it from the Internet. That is, a translating access point modifies packet header data not application data. Therefore, the protocol fails because the protocol effectively reports the wrong information within the application data.","One proposed solution to this problem is the REALM specific IP (RSIP) protocol, an Internet Engineering Task Force (IETF) suggested revision to NAT. Assuming the International Organization for Standardization Open Systems Interconnection (ISO\/OSI) model, networking protocol layers 3 and 4 are altered to support RSIP in every translating access point. An RSIP access point grants a client, e.g., a machine in network , resources (e.g., address, ports) in an external realm, e.g., network .","Unfortunately, RSIP (and related solutions) are expensive and impractical. To work properly, all translating access points have to be revised to support RSIP; this solution fails if an upstream non-supporting translating access point is reached.",{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 2"},"As illustrated, a networking application program  is in communication with network services  provided by an operating system, e.g., a software and\/or hardware based operating system providing services to the application program . During operation, a typical network application program requests the operating system to provide network configuration data the application program may use. In a TCP\/IP environment, such a request typically comprises asking the operating system to identify the network address for the network interface (e.g.,  item ) address of a host system executing the application program, and an available communication port. If the host system is in a private network, this will be a non-routable network address that cannot be used in the Internet.","All network traffic from the application program  is assumed to pass through a translating access point  (translator), such as a NAT device or equivalent, before reaching network . Since translators do not alter application data, protocols that send network configuration data within application data fail to work from a private network. Consequently, to resolve the application program request for configuration data, a configuration determinator  component of the network services  contacts an external network configuration server . The server provides the determinator with network configuration data that can be used in a public network such as the Internet or equivalent network. For example, it may provide a network address and communication port of the server.","When the determinator  receives this configuration data from the server , the network services  reports this data back to the requesting application program. When the application program embeds the configuration data within application data, a responsive network device (e.g.,  H.323 client ) issues responses that are sent in accord with the data provided by server . For example, assuming the server provided a network address and communication port of the server, the responsive network device sends responses to the server; the server then forwards the response for receipt and usage by the application program .",{"@attributes":{"id":"p-0020","num":"0019"},"figref":["FIG. 3","FIG. 2"]},"An application program utilizes a protocol to communicate with the endpoint. It is assumed the protocol is one that breaks because a private network address is included in application data, however the protocol may be a simple network connection. The application program requests  operating system network services to identify the network address of the application program's host, and to obtain an available (or specific) communication port. Typically, this request asks the operating system to identify the host's IP address and an available UDP or TCP port.","The operating system in turn calls  appropriate installed network services (provided in software and\/or hardware) to resolve this request . Assuming the application program is not aware of network traffic translation by an access point, in one embodiment, network services are configured to forward the call  to a proxy client. One exemplary implementation for forwarding to the proxy client, discussed below with respect to , is a Layered Service Provider (LSP) within Microsoft Windows network services. (Please note that all marks used herein are the property of their respective owners.) However, it will be appreciated by one skilled in the art that other forwarding mechanisms may be used.","The proxy client in turn requests a network address and communication port from an external proxy server. As used in the specification and claims that follow, an external proxy server comprises a server with a network connection, e.g., an Internet connection, not subject to translation by an access point. For example, device  of  has a direct non-translated connection to the Internet. This request passes through  a translating access point. The external proxy server replies  to the proxy client with an available address and communication port. This reply also passes through the translating access point. However, since the external proxy server has a non-translated network connection, the proxy client reports to the requesting  application program an address and port that is external to and not affected by translation by an access point.","In one embodiment, the proxy client establishes a tunnel with the external proxy server. The external proxy server connects  to the endpoint and establishes a communication session with the endpoint in accordance with the protocol utilized by the application program. The tunnel can be used to pass  network traffic received at the address and port given  to the proxy client, and to carry network traffic from the application program to the endpoint.","The tunneling is transparent to both the application program and the endpoint because the application program believes the networking configuration values from the external server corresponds to values for the application program's host, and because the endpoint can directly communicate with the proxy server using the networking configuration values. Thus, based on such tunneling, a virtual direct link  unaffected by translating access points is created between the application program and endpoint.",{"@attributes":{"id":"p-0026","num":"0025"},"figref":["FIG. 4","FIG. 3"],"b":"304"},"As illustrated, a Layered Service Provider (LSP)  is implemented in conjunction with the Microsoft Winsock Application Programming Interface (API) . In the illustrated embodiment, a Microsoft Winsock API is extended with the LSP, which configures Winsock to pass on network calls on to the LSP  for primary processing. For more information on LSPs, please see \u201cUnraveling the Mysteries of Writing a Winsock 2 Layered Service Provider\u201d by Hua et al., Microsoft Systems Journal (May 1999); Internet URL: msdn-microsoft-com\/library\/periodic\/period99\/layeredService-htm. (To prevent inadvertent hyperlinks, URL periods have been replaced with dashes).","In the illustrated embodiment, an application program  on a computing device (such as  item ) is executed, where the application program utilizes a certain protocol to communicate with a peer (such as  item ) that normally breaks when the protocol is used from behind a translating access point. For example, assume the application program identifies its host's network configuration, and sends the configuration through a translating access point  as application data sent to another computing device . The application program embeds configuration values that are not accessible over the network  by the peer device . Consequently, network traffic from the peer  directed to the embedded configuration data cannot be received by the application program .","In the illustrated embodiment, when the application program  calls on operating system network services to identify its host's network configuration, the operating system calls Winsock  services, which in turn calls the LSP . When control is passed to the LSP, the LSP obtains a network configuration not subject to translation, from an external proxy server . The LSP provides the configuration to Winsock, which in turn provides it to the application program. The application program may safely embed the LSP provided configuration in application data.","In one embodiment, when control is initially passed to the LSP, the LSP initially determines whether to accept the call, or to simply pass it back to the Winsock API to let it handle the call. This allows application programs that are \u201caware\u201d of the translating access point  to operate without intervention. For such applications, the call to the LSP is passed back to Winsock for regular Winsock processing. However, if the application program is unaware of translation, the LSP calls an external proxy server  which returns to the LSP a network address and communication port not subject to translation. A tunnel is established between the LSP and the proxy server so that communication by other computing devices to the provided address\/port can be transparently tunneled to the application program.","It will be appreciated by one skilled in the art that the invention is not operating system dependent; use of the Microsoft networking environment, and LSPs is for exemplary purposes due to broad familiarity with these environments. Other operating systems and network services may also be utilized. Also, some environments may utilize closed network services, e.g., an LSP type of construction is not available. In such environments, in one embodiment, calls to network services are intercepted and processed by a proxy client executing on the application program host. In an alternate embodiment, a virtual network interface and software router are used to receive network traffic which is routed through a physical network interface.",{"@attributes":{"id":"p-0032","num":"0031"},"figref":["FIG. 5","FIG. 4"]},"As illustrated, an exemplary computing device  comprises an H.323 application program , LSP network layer  (see also  item ), Winsock (or equivalent) network layer , TCP\/IP network layer , and network interface , communicates with an external network , such as the Internet, by way of a NAT translator . The computing device communicates with an external proxy server  embodied within an exemplary computing device  comprising the external proxy server, a sockets network layer  (e.g., Microsoft Winsock or the like) for interfacing with a TCP\/IP network layer , and multiple network interfaces ,  to handle the incoming and outgoing network traffic. In one embodiment, the computing device  further comprises an optional server driver (discussed below).","The computing device  utilizes an H.323 application program  to establish a telecommunication session with an H.323 endpoint . Rather than allowing the application program  to directly communicate with an external (with respect to the NAT translator ) computing device, the application program is tricked instead into establishing a circular networking connection  through the LSP  and Winsock  network layers, rather than with the endpoint.","That is, when the application program starts , it queries its operating system for the network address of host computing device , and an available communication port. As discussed above in , the Winsock  passes this query to the LSP , which replies with address and port information retrieved from an external proxy server . As the application program communicates with the endpoint , the LSP receives the communication, forwards it to the proxy server, which in turn sends it to the endpoint. Responses from the endpoint are received by computing device , tunneled back to the LSP, which in turn provides it to the application program through the Winsock. In such fashion, the application program and endpoint believe they are directly communicating.","When the application program  sends call setup data for the endpoint, according to the H.323 protocol, the application program provides its host's network address and communication port to the endpoint  as application data sent to the endpoint. Since the LSP is providing the application program with configuration data from the proxy server , call setup is not affected by the translating access point . The application program waits for notification of a successful call setup.","In one embodiment, when the LSP forwards the call setup request to the external proxy server , the proxy server attempts to set up the call with the endpoint  using the network configuration given to the proxy client for the application program. If call setup is successful, the LSP  is notified of the success, and the LSP in turn notifies the application program. A tunnel is established by the proxy client to the external proxy server that is used for forwarding the telecommunication session between the computing device  and the endpoint . The proxy server may perform optimizations, such as compression, multiplexing, encryption, etc. to data transferred between the endpoint and the application program.","As noted above, computing device  may further comprise a proxy server driver . This driver may be used to offload processing by the proxy server so that the proxy server is only responsible for establishing a protocol with an endpoint, and after successful establishment, the driver  then maintains the communication tunnel between the application program and the endpoint. For example, in the illustrated example, once a telecommunications session has been established, the UDP network traffic for the H.323 audio communication can be tunneled by the proxy server driver to the proxy client within the computing device .",{"@attributes":{"id":"p-0039","num":"0038"},"figref":["FIG. 6","FIG. 2"],"b":["600","602"]},"Typically, attached to the bus are non-programmable and programmable processors , a memory  (e.g., RAM, ROM), storage devices , a video interface , and input\/output interface ports . The machine may also include embedded controllers, Programmable Logic Devices (PLD), Programmable Logic Arrays (PLA), Programmable Array Logic (PAL), Generic Array Logic (GAL), Field-Programmable Gate Arrays (FPGA), Application Specific Integrated Circuits (ASIC), computers, smart cards, or another machine, system, etc.","The machine is expected to operate in a networked environment using logical connections to one or more remote machines ,  through a network interface , modem , or other communication pathway. Machines may be interconnected by way of a wired or wireless network  including an intranet, the Internet, local area networks, wide area networks, cellular, cable, laser, satellite, microwave, Blue Tooth, optical, infrared, or other carrier technology.","The invention may be described by reference to different high-level program modules and\/or low-level hardware contexts that may be stored in memory  and\/or storage devices . Program modules include procedures, functions, programs, components, data structures, and the like, for performing particular tasks or implementing particular abstract data types. One skilled in the art will realize that program modules and low-level hardware contexts can be interchanged with low-level hardware instructions, and are collectively referenced hereafter as \u201cdirectives.\u201d One will further appreciate that directives may be recorded or carried in a compressed, encrypted, or otherwise encoded format without departing from the scope of this patent, even if the instructions must be decrypted, decompressed, compiled, interpreted, or otherwise manipulated prior to their execution or other utilization by the machine.","Memory , storage devices , and associated media, can store data and directives for the machine . Program modules may be implemented within a single machine, or processed in a distributed network environment, and stored in both local and remote memory. Memory and storage devices include hard-drives, floppy-disks, optical storage, magnetic cassettes, tapes, flash memory cards, memory sticks, digital video disks, biological storage, and the like, as well as wired and wireless transmission environments, such as network , over which directives may be delivered in the form of packets, serial data, parallel data, or other suitable transmission format.","Thus, for example, with respect to the illustrated embodiments, assuming machine  operates an H.323 telecommunication application program and the proxy client, then remote devices ,  may respectively be a machine embodying the proxy server, and an H.323 communication endpoint. It will be appreciated that remote machines ,  may be configured like machine , and therefore include many or all of the elements discussed for machine. It should also be appreciated that machines , ,  may be embodied within a single device, or separate communicatively-coupled components, and may include or be embodied within routers, bridges, peer devices, web servers, etc.","Illustrated methods, and corresponding written descriptions thereof, are intended to illustrate machine-accessible media storing directives, or the like, which may be incorporated into single and multi-processor machines, portable computers, such as handheld devices including Personal Digital Assistants (PDAs), cellular telephones, and the like. Directives, when accessed, read, executed, loaded into, or otherwise utilized by a machine, causes the machine to perform the illustrated methods. The figures, written description, and claims may variously be understood as representing instructions taken alone, instructions as organized in a particular form, e.g., packet, serial, parallel, etc., and\/or instructions together with their storage or carrier media.","Having described and illustrated the principles of the invention with reference to illustrated embodiments, it will be recognized that the illustrated embodiments can be modified in arrangement and detail without departing from such principles.","And, even though the foregoing discussion has focused on particular embodiments, it is understood that other configurations are contemplated. In particular, even though expressions such as \u201cin one embodiment,\u201d \u201cin another embodiment,\u201d or the like are used herein, these phrases are meant to generally reference embodiment possibilities, and are not intended to limit the invention to particular embodiment configurations. As used herein, these terms may reference the same or different embodiments, and unless implicitly or expressly indicated otherwise, embodiments are combinable into other embodiments. Consequently, in view of the wide variety of permutations to the above-described embodiments, the detailed description is intended to be illustrative only, and should not be taken as limiting the scope of the invention.","What is claimed as the invention, therefore, is all such modifications as may come within the scope and spirit of the following claims and equivalents thereto."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The features and advantages of the present invention will become apparent from the following detailed description of the present invention in which:",{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":["FIG. 3","FIG. 2"]},{"@attributes":{"id":"p-0013","num":"0012"},"figref":["FIG. 4","FIG. 3"]},{"@attributes":{"id":"p-0014","num":"0013"},"figref":["FIG. 5","FIG. 4"]},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
