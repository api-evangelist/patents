---
title: Techniques for moving data between memory types
abstract: A two-level paging mechanism. The first level gathers data from reclaimable memory locations for a process and compacts the data into a single container. The second level sends the compact container's contents to a swap file and may use optimal I/O operations to the target memory device. On-demand paging is made possible by having a first pager locate the requested data in the compact container and then having a second pager retrieve the corresponding data from the swap file.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09195581&OS=09195581&RS=09195581
owner: Apple Inc.
number: 09195581
owner_city: Cupertino
owner_country: US
publication_date: 20110701
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND","DETAILED DESCRIPTION"],"p":["Embodiments of the invention relate to transfer of data between memory types. More particularly, embodiments of the invention relate to techniques for moving data from a volatile memory to a non-volatile memory.","Electronic devices include a finite amount of memory. Volatile memory types are typically faster than non-volatile memory. Thus, volatile memory is typically used for applications that require minimal memory latency. However, because the volatile memory is finite, there may be conditions that require removing data from the volatile memory to allow other applications or processes to utilize additional memory locations.","In the following description, numerous specific details are set forth. However, embodiments of the invention may be practiced without these specific details. In other instances, well-known circuits, structures and techniques have not been shown in detail in order not to obscure the understanding of this description.","On a device with a limited amount of volatile memory (e.g., random access memory, RAM), it may be desirable or even necessary to allocate memory locations used for one process or application to another process or application. For example, a more important application may require more memory locations at the expense of a less important application.","In one embodiment, when the non-volatile memory is a solid-state memory device, it may be desirable to minimize the wear on the device and avoid read\/modify\/write situations. In one embodiment, the process or application is allowed access to the data after it has been evicted from the volatile memory and has been moved to the non-volatile memory.","In one embodiment, a two-level paging mechanism is used. The first level gathers pages from reclaimable memory locations for a process and compacts the pages into a single container. The second level sends the compact container's contents to a swap file and may use optimal I\/O operations to the target memory device. On-demand paging is made possible by having a first pager locate the requested pages in the compact container and then having a second pager retrieve the corresponding pages from the swap file.","This two-level paging mechanism may be useful, for example, in mobile devices that typically have less RAM than physically larger devices, such as desktop computers or even laptop computers. For example, a tablet device, or a notebook computer, or a smartphone may contain a limited amount of RAM and a solid state memory device (e.g., flash memory).",{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 1"},"Address space  represents the memory that can be used by a given process or application. Address space  can contain several memory regions. A memory region can contain several virtual pages. A virtual page can be in one of three states at any time: Unallocated, Resident, or Paged Out.","The primary (RAM, volatile) and secondary (SSD, non-volatile) memories are used by multiple applications during execution of the applications by a host system. Typically, primary memory is a random access memory that is accessible by a processor(s) executing the applications. Address space  may use all of, or part of, a random access memory within the host system. Other address spaces are used to support the other processes in the system and they all compete for the limited resources of the primary memory (RAM).","The random access memory is used to support multiple processes and each process may have its own address space to utilize. Address space  has one or more memory regions (e.g., , , ) that are used by the process to store one or more pages of data.","In the example of , memory regions ,  and  may be assigned to a process. In one embodiment, each process has an associated priority that may be used, for example, to resolve resource conflicts. For example, when a process needs additional memory locations and insufficient memory is available, a process with a lower priority may have some or all of its pages evicted so that the memory regions may be reallocated to the higher priority process.","Thus, during operation, memory regions ,  and  may be designated for eviction. The eviction process moves the pages from memory regions ,  and  to non-volatile memory . In one embodiment, this process includes utilization of compact container . Compact container  may be a region or structure in system RAM outside of address space , or compact container  may be in a different memory device coupled with system RAM. In one embodiment, compact container  is within an operating system kernel address space.","In one embodiment, the pages from memory regions ,  and  are stored in a more compact manner (e.g., contiguously, in a minimal number of pages, etc.) within compact container . In another embodiment, pointers to the pages may be stored in compact container . In one embodiment, the contents of memory regions ,  and  are copied to non-volatile memory . In one embodiment, the pages are copied to non-volatile memory  in a single write operation, or in a single write operation per page.","When pages that have been moved to non-volatile memory  are required, the location of the data in non-volatile memory  may be determined through compact container . The pages may then be transferred back from non-volatile memory  to address space . The same memory regions may be used, or different memory regions may be used.",{"@attributes":{"id":"p-0023","num":"0022"},"figref":["FIG. 2","FIG. 2","FIG. 1"]},"When pages for a process are designated for eviction, the address space corresponding to the process is frozen (e.g., , ,  of ), at step . When the address space is frozen the process is prevented from writing to the memory locations and changing the contents of the memory locations. Thus, the contents of the memory to be transferred will be coherent with the process.","The address space for the process is walked, at step . When walking the address space for the process, information is collected about the pages of memory that are frozen and to be transferred out of RAM. In one embodiment, for pages that are to be transferred out of RAM, pointers for the resident pages are moved to the compact container, at step . In another embodiment, the contents of the memory locations may be copied to the compact container to be transferred out of RAM. In one embodiment, pages that share data between multiple processes are not candidates for eviction.","The pages are then copied from RAM to the non-volatile memory (e.g., flash memory), at step . In one embodiment, the pages are written to the non-volatile memory in a single I\/O operation, which may help reduce wear on the non-volatile memory. In alternate embodiments, multiple write operations may be performed.","The address space locations for which the pages have been moved are reclaimed, at step . The reclaimed memory locations can then be used by other processes. The process of  can be repeated for other processes as well.",{"@attributes":{"id":"p-0028","num":"0027"},"figref":["FIG. 3","FIG. 3","FIG. 2"]},"A request is received for the evicted pages, at step . The request may be the result of a reactivation, or thawing, of a previously frozen process. The request may be for a portion of the previously evicted pages for the process, or the request may be for all of the previously evicted pages for the process.","The link for the memory locations in the address space (e.g., in RAM) to the compact container are followed, at step . The link and\/or other information may be utilized to determine the location and\/or status of the data in the compact container. The page location is determined, at step .","The pages are then copied from the non-volatile memory to RAM, at step . In one embodiment, the pages are retrieved by a single read to the non-volatile memory. The non-volatile memory locations can then be used for other data, at step .",{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 4","b":["400","410","400","400","400","412","410"]},"Data transfer agent  includes memory , which represents a memory device and\/or access to a memory resource for storing data and\/or instructions. Memory  may include memory local to data transfer agent , as well as, or alternatively, including memory of the host system on which data transfer agent  resides. Data transfer agent  also includes one or more interfaces , which represent access interfaces to\/from (e.g., an input\/output interface, application programming interface) data transfer agent  with regard to entities (electronic or human) external to data transfer agent .","Data transfer agent  also includes data transfer engine , which represents one or more functions that enable data transfer agent  to provide the zooming in and\/or out on pages as described herein. Example modules that may be included in data transfer engine  include process memory module , compact container manager , link manager  and memory transfer module . As used herein, a module refers to routine, a subsystem, etc., whether implemented in hardware, software, firmware or some combination thereof.","Process memory module  operates to determine the status for each process and may also manage other parameters, for example, priorities associated with the processes or allowable memory consumption, etc. Process memory module  may control the status of the processes as well. Process memory module  may operate to freeze the processes when a higher priority process requires additional memory.","Compact container manager  operates to control the operation and functionality of the compact container as described herein. Compact container manager  may manage data structures within the compact container as well as links the operation and organization of the compact container to provide the functionality described herein.","Link manager  operates to follow and maintain links between data structures and memory locations, for example, between the compact container and the non-volatile memory. Link manager  may operate to locate data in non-volatile memory in response to a request for the data to be transferred back to RAM.","Memory transfer module  operates to control reads and writes to and from the non-volatile memory. In one embodiment, memory transfer module  causes data to be written to the non-volatile memory in a minimum number of write operations. Similarly, memory transfer module  causes data to be read from the non-volatile memory in a minimum number of reads. This may reduce wear on the non-volatile memory.",{"@attributes":{"id":"p-0039","num":"0038"},"figref":"FIG. 5","b":["500","502","504","506","502","504","506"]},"Sensors, devices, and subsystems can be coupled to peripherals interface  to facilitate multiple functionalities. For example, motion sensor , light sensor , and proximity sensor  can be coupled to peripherals interface  to facilitate the orientation, lighting, and proximity functions. Other sensors  can also be connected to peripherals interface , such as a positioning system (e.g., GPS receiver), a temperature sensor, a biometric sensor, or other sensing device, to facilitate related functionalities.","Camera subsystem  and optical sensor  (e.g., a charged coupled device (CCD) or a complementary metal-oxide semiconductor (CMOS) optical sensor) can be utilized to facilitate camera functions, such as recording photographs and video clips.","Communication functions can be facilitated through one or more wireless communication subsystems , which can include radio frequency receivers and transmitters and\/or optical (e.g., infrared) receivers and transmitters. The specific design and implementation of communication subsystem  can depend on the communication network(s) over which the mobile device is intended to operate. For example, a mobile device can include communication subsystems  designed to operate over a GSM network, a GPRS network, an EDGE network, a Wi-Fi or WiMax network, and a Bluetooth\u2122 network. In particular, wireless communication subsystems  may include hosting protocols such that the mobile device may be configured as a base station for other wireless devices.","Audio subsystem  can be coupled to speaker  and microphone  to facilitate voice-enabled functions, such as voice recognition, voice replication, digital recording, and telephony functions.","I\/O subsystem  can include touch screen controller  and\/or other input controller(s) . Touch-screen controller  can be coupled to touch screen . Touch screen  and touch screen controller  can, for example, detect contact and movement or break thereof using any of a plurality of touch sensitivity technologies, including but not limited to capacitive, resistive, infrared, and surface acoustic wave technologies, as well as other proximity sensor arrays or other elements for determining one or more points of contact with touch screen .","Other input controller(s)  can be coupled to other input\/control devices , such as one or more buttons, rocker switches, thumb-wheel, infrared port, USB port, and\/or a pointer device such as a stylus. The one or more buttons (not shown) can include an up\/down button for volume control of speaker  and\/or microphone .","In one implementation, a pressing of the button for a first duration may disengage a lock of touch screen , and a pressing of the button for a second duration that is longer than the first duration may turn power to the mobile device on or off. The user may be able to customize a functionality of one or more of the buttons. Touch screen  can, for example, also be used to implement virtual or soft buttons and\/or a keyboard.","In some implementations, the mobile device can present recorded audio and\/or video files, such as MP3, AAC, and MPEG files. In some implementations, the mobile device can include the functionality of an MP3 player, such as an iPod\u2122. The mobile device may, therefore, include a 32-pin connector that is compatible with the iPod\u2122. Other input\/output and control devices can also be used.","Memory interface  can be coupled to memory . Memory  can include high-speed random access memory and\/or non-volatile memory, such as one or more magnetic disk storage devices, one or more optical storage devices, and\/or flash memory (e.g., NAND, NOR). Memory  can store operating system , such as Darwin, RTXC, LINUX, UNIX, OSX, WINDOWS, or an embedded operating system such as VxWorks. Operating system  may include instructions for handling basic system services and for performing hardware dependent tasks. In some implementations, operating system  can be a kernel (e.g., UNIX kernel). Memory interface  may also be coupled with non-volatile memory , which may be, for example, flash memory.","Memory  may also store communication instructions  to facilitate communicating with one or more additional devices, one or more computers and\/or one or more servers. Memory  may include graphical user interface instructions  to facilitate graphic user interface processing; sensor processing instructions  to facilitate sensor-related processing and functions; phone instructions  to facilitate phone-related processes and functions; electronic messaging instructions  to facilitate electronic-messaging related processes and functions; web browsing instructions  to facilitate web browsing-related processes and functions; media processing instructions  to facilitate media processing-related processes and functions; GPS\/Navigation instructions  to facilitate GPS and navigation-related processes and instructions; camera instructions  to facilitate camera-related processes and functions; and\/or other software instructions  to facilitate other processes and functions (e.g., access control management functions).","Memory  may also store other software instructions (not shown), such as web video instructions to facilitate web video-related processes and functions and\/or web shopping instructions to facilitate web shopping-related processes and functions. In some implementations, media processing instructions  may be divided into audio processing instructions and video processing instructions, for example to facilitate audio processing-related processes and functions and video processing-related processes and functions, respectively. Activation record and International Mobile Equipment Identity (IMEI)  or similar hardware identifier can also be stored in memory .","Reference in the specification to \u201cone embodiment\u201d or \u201can embodiment\u201d means that a particular feature, structure, or characteristic described in connection with the embodiment is included in at least one embodiment of the invention. The appearances of the phrase \u201cin one embodiment\u201d in various places in the specification are not necessarily all referring to the same embodiment.","In the foregoing specification, the invention has been described with reference to specific embodiments thereof. It will, however, be evident that various modifications and changes can be made thereto without departing from the broader spirit and scope of the invention. The specification and drawings are, accordingly, to be regarded in an illustrative rather than a restrictive sense."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The invention is illustrated by way of example, and not by way of limitation, in the figures of the accompanying drawings in which like reference numerals refer to similar elements.",{"@attributes":{"id":"p-0005","num":"0004"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 5"}]},"DETDESC":[{},{}]}
