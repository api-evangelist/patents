---
title: Amplifier predistortion and autocalibration method and apparatus
abstract: Methods and apparatus for amplifier AM and PM predistortion and autocalibration. AM and PM amplifier distortion can be corrected using predistortion. The AM and PM distortion characteristics of the amplifier are determined using an autocalibration technique. The amplifier characteristics can be stored in distinct look up tables. Alternatively, the inverse of the amplifier characteristics can be stored in distinct look up tables. Signals that are to be amplified are characterized in polar format having a phase component with a normalized magnitude and a magnitude component. The phase component can be predistorted by applying the inverse of the PM distortion characteristics to the signal. Similarly, the magnitude component can be predistorted by applying the inverse of the AM distortion characteristics to the signal. The predistorted phase component can be amplified using the previously characterized amplifier. The predistorted magnitude component can be used to set the gain of the previously characterized amplifier.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07915954&OS=07915954&RS=07915954
owner: QUALCOMM, Incorporated
number: 07915954
owner_city: San Diego
owner_country: US
publication_date: 20041112
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["CROSS-REFERENCES TO RELATED APPLICATIONS","BACKGROUND OF THE DISCLOSURE","BRIEF SUMMARY OF THE DISCLOSURE","DETAILED DESCRIPTION OF THE DISCLOSURE"],"p":["This application claims the benefit of U.S. Provisional Application No. 60\/537,145, filed Jan. 16, 2004, entitled ENVELOPE ELIMINATION AND RESTORATION (EER) WITH PRE-DISTORTION & AUTO-CALIBRATION FOR EDGE TRANSMITTER; which is hereby incorporated herein by reference in its entirety.","Variable gain amplifiers are commonly used in communication devices. Such amplifiers can be used, for example, in the receive path of a wireless communication device as part of an Automatic Gain Control (AGC) circuit. The variable gain amplifier can be used to maintain a range of intermediate frequency amplitudes for subsequent processing. Variable gain amplifiers may also be used in the transmit path of a wireless communication device. A variable gain amplifier may be used, for example, to set the output power of a transmitted signal.","Of course, a real amplifier does not have the characteristics of an ideal amplifier. An ideal amplifier can provide unlimited amounts of output power and can be perfectly linear. However, an amplifier typically contributes some nonlinear distortion. The amplifier may, for example, produce harmonics and higher order distortion products. Additionally, a variable gain amplifier may produce varying phase delays based on the gain value. Manufacturing differences between amplifiers and amplifiers lots may produce variations in a gain transfer function. Additionally, the amplifier gain, in dB, may not be a linear function of a control input.","For many applications, the distortion contributed by an amplifier may be negligible and may be ignored. However, for other applications, the amount of signal distortion contributed by the amplifier may adversely affect the signal quality to an extent that a communication link is substantially degraded.","For example, a transmitter in a wireless telephone system operating in accordance with the Global System for Mobile communications (GSM) standards, such as those defined in ETSI 3GPP specifications, typically operates with Gaussian Minimum Shift Keying (GMSK). GMSK is characterized as having a constant envelope. The GSM specifications have evolved to include a data mode referred to as Enhanced Datarate for GSM Evolution (EDGE). A transmitter operating in a GSM EDGE Radio Access Network (GERAN) can operate with GMSK modulation or can operate with 3\u03c0\/8 Phase Shift Keying (PSK) modulation. The 3\u03c0\/8 PSK modulation does not have a constant envelope, but instead, has an envelope that varies by approximately 17 dB. The variation in the amplitude envelope poses additional constraints on amplifier performance. Wireless transmitters having amplifiers that were originally configured to operate using constant envelope GMSK modulation may not perform satisfactorily with 3\u03c0\/8 PSK modulation.","It is desirable to increase the performance of an amplifier by decreasing the amount of distortion that the amplifier contributes to the signal being amplified. Minimizing the effects of amplifier distortion allows for more efficient and better performing communication device implementations.","Methods and apparatus for amplifier AM and PM predistortion and autocalibration are disclosed. AM and PM amplifier distortion can be corrected using predistortion. The AM and PM distortion characteristics of the amplifier are determined using an autocalibration technique. The amplifier characteristics can be stored in distinct look up tables. Alternatively, the inverse of the amplifier characteristics can be stored in distinct look up tables. Signals that are to be amplified are characterized in polar format having a phase component with a normalized magnitude and a magnitude component. The phase component can be predistorted by applying the inverse of the PM distortion characteristics to the signal. Similarly, the magnitude component can be predistorted by applying the inverse of the AM distortion characteristics to the signal. The predistorted phase component can be amplified using the previously characterized amplifier. The predistorted magnitude component can be used to set the gain of the previously characterized amplifier.","The disclosure includes a method of generating a distortion compensated signal, including generating a polar representation of a signal having an envelope signal component and a phase signal component, predistorting the envelope signal component to generate a predistorted envelope signal component, predistorting the phase signal component to generate a predistorted phase signal component, and amplitude modulating the predistorted phase signal component with the predistorted envelope signal component to generate the distortion compensated signal.","The disclosure also includes a method of generating a distortion compensated signal, including receiving a power control setpoint value, determining an operating range from a plurality of ranges based on the power control setpoint value, determining a signal envelope value, determining a distortion compensation value based on the operating range and the signal envelope value, and applying the distortion compensation value to a signal to generate the distortion compensated signal.","The disclosure includes a method of calibrating a predistortion module, including generating a calibration signal, amplifying the calibration signal based in part on a value of a power control setpoint to generate an amplified calibration signal, receiving a signal sample based on the amplified calibration signal, comparing a characteristic of the signal sample to a similar characteristic of the calibration signal, determining a distortion characteristic based on the comparison, and storing the distortion characteristic in a look up table of the predistortion module to calibrate the predistortion module.","The disclosure also includes an apparatus for generating a distortion compensated signal, including a range select module configured to receive a power control setpoint value and determine an operating range based in part on the power control setpoint value, a look up table configured to store a plurality of distortion compensation values in each of a plurality of operating ranges, and a interpolator configured to access a portion of the look up table based in part on the operating range, determine a distortion compensation, and apply the distortion compensation to a signal to generate the distortion compensated signal.","The disclosure also includes an apparatus for generating a distortion compensated signal, including a rectangular to polar converter configured to convert a rectangular representation of a signal to a polar representation having an envelope signal component and a phase signal component, a first predistortion module coupled to the rectangular to polar converter and configured to predistort the envelope signal component to generate a predistorted envelope signal, a second predistortion module coupled to the rectangular to polar converter and configured to predistort the phase signal component to generate a predistorted phase signal, and a power amplifier coupled to the first and second predistortion modules and configured to amplitude modulate the predistorted phase signal based in part on the predistorted envelope signal.","The effects of amplifier distortion can be reduced to acceptable levels by predistorting the signals to the amplifier. Signal distortion contributed by a variable gain power amplifier in a wireless communication device can be minimized by predistorting a gain control signal, a phase of the input signal, or a combination of the two.","In order to compensate for amplifier distortion effects, the amplifier can be characterized by measuring the performance of the amplifier. Alternatively, amplifier characteristics may be supplied by a manufacturer or can be generalized across multiple amplifiers using statistical sampling, statistical characterization, or simulations. The amplifier gain characteristics or gain transfer function can be determined. Additionally, the amplifier phase characteristics can be determined over a gain range of the amplifier.","The amplifier characteristics may be determined at a single frequency or at multiple frequencies. Additionally, the amplifier characteristics may be determined at a single temperature or may be characterized at multiple temperatures. The number of frequency or temperature characteristics that are determined can depend on the variations exhibited by the amplifier or amplifier module being characterized.","The amplifier characteristics can be stored in a look up table. A predistortion module can determine an inverse of the amplifier characteristics. The inverse characteristics are the predistortion characteristics that can be used to invert, or negate, the effects of the amplifier characteristics. The predistortion module can also include an interpolator module that is configured to interpolate between two or more points on the amplifier characteristic. The interpolator can interpolate between the points using, for example, a linear interpolation or a higher order interpolation.","A signal having a varying envelope can be characterized in polar coordinates as a unity magnitude phasor and an magnitude component. One or both of the phasor and magnitude component can be predistorted to compensate for the distortion effects of subsequent amplifier stages.","Thus, the magnitude or envelope amplifier nonlinearities can be corrected independently of the phase nonlinearities. To correct for the magnitude distortions of the amplifier, the magnitude component of the signal is predistorted with the inverse of the amplifier magnitude distortion characteristics previously stored in a look up table. Similarly, to correct for phase distortions of the amplifier, the phase component of the signal is predistorted with the inverse of the amplifier phase distortion characteristics previously stored in a look up table.","In the above discussion and generally throughout the disclosure, the term amplifier or amplifier module can be used to refer to a single amplifier, an amplifier module having one or more amplifiers, or multiple amplifiers, which may be directly coupled to one another or which may have intervening elements placed between amplifier stages. Additionally, while the above discussion and the disclosure in general refers to predistortion, the signals can be distorted to compensate for the distortion effects of prior amplifiers.",{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 1","b":["100","100","110","110","112","114"]},"The I and Q outputs from the DACs  and  are then upconverted to a desired RF using an upconverter  The upconverter  can be configured to implement any suitable upconversion including, but not limited to, direct upconversion, dual conversion, Offset Phase Lock Loop (OPLL) upconversion, and the like, or some other upconversion.","In one embodiment, the converted in-phase signal is upconverted to, for example, an RF signal using a first mixer driven by a Local Oscillator (LO). Similarly, the converted quadrature signal is upconverted using a second mixer. The second mixer is driven by an output of the LO that has been shifted by 90 degrees using a phase shifter.","The outputs of the first and second mixers can be coupled to inputs of a signal combiner that sums the two signals together. The output of the signal combiner can be coupled to an amplifier module .","The amplifier module  can include a variable gain amplifier . The gain of the variable gain amplifier  can be controlled by setting a control voltage value. The control voltage can be coupled to an input, such as a non-inverting input of a differential amplifier . The output of the differential amplifier  is coupled to a gate of a FET  that can be configured, for example, to vary the supply voltage to the variable gain amplifier  in order to vary its gain. A feedback module  feeds back the supply voltage of the variable gain amplifier  to another input, for example the inverting input, of the differential amplifier . The transfer function of the feedback module  can be configured to provide a relationship between the control voltage value and the supply voltage of the variable gain amplifier .","Thus, the output power from the transmitter  can be controlled by determining an output power at the output of the baseband processor , adding or subtracting the gains of the various fixed gain modules, and setting the control voltage at the amplifier module  to set the gain of the variable gain amplifier  to the desired gain needed to achieve the desired output power.","The uncompensated transmitter  configuration provides essentially no compensation for amplitude or phase distortions. The output signal from the baseband processor  is subjected to the cumulative distortions from each of the subsequent stages.","The majority of the signal processing modules have fixed gain. Each of the fixed gain modules may not vary significantly over the range of an amplitude varying signal, such as a GSM EDGE signal that has approximately 17 dB of variation. However, the cumulative amplitude distortion may significantly degrade the signal. Additionally, the amplifier module , and particularly the variable gain amplifier , may contribute significant amplitude distortions at a portion of the gain range. Similarly, each of the signal processing stages may contribute phase distortion to the signal.","The amplitude distortion, which may be characterized as an Amplitude Modulation (AM) distortion, and the phase distortion, which may be characterized as a Phase Modulation (PM) distortion, have an impact on the ability of a transmitter, such as the transmitter  of , to meet system specifications.",{"@attributes":{"id":"p-0040","num":"0039"},"figref":"FIG. 2A","b":["200","200","200"]},"In addition to conforming to a time envelope mask , a transmitter needs to satisfy a spectral mask .  is a plot of a transmitter spectral mask  for a GSM EDGE transmitter. The transmitter spectral mask  specifies the spectral distribution of a signal. A transmitter is constrained to the specified spectral mask  in order to minimize the interference the transmitter generates in adjacent channels. Higher order AM distortions can contribute to out of band spectral products. In addition, PM distortions and phase errors can contribute to the level of sidebands of the signal. PM distortion results in increased sideband levels and decreases the ability of the transmitter to conform to the spectral mask .","The AM and PM distortion contributed by elements in the transmit chain, particularly the amplifier module, can be corrected by characterizing the distortion and predistorting the signals.  is a plot of an embodiment of a gain characterization curve  that can be incorporated in a portion of a predistortion module.","In one embodiment, the characterization curve  can be stored in a look up table as will be discussed below. The characterization curve  can provide an indication of the level of AM distortion that the amplifier module will contribute if an AM signal is provided to the control voltage input. Because the characterization curve  provides an indication of AM distortion for an AM signal input, the characterization curve  reflects AM-AM distortion contributed by the amplifier module. In another embodiment, a subset of the points used to generate the characterization curve  can be stored in a look up table. In still another embodiment, a polynomial can be fit to the points on the characterization curve , for example, by determining a polynomial of a predetermined order that provides a least mean square error. In another embodiment, the characterization curve  can be stored as a plurality of piecewise continuous polynomials, each polynomial fit to a portion of the characterization curve . For example, the characterization curve  may be divided into a plurality of sections, and a polynomial, such as a cubic spline, can be fit to the points of each section. Other embodiments may use a combination of techniques or some other techniques.","In the characterization curve  of , the output power of an amplifier module, such as the amplifier module  of , can be measured for uniformly spaced control voltage values and a predetermined input power. Alternatively, the gain of the amplifier module may be measured with varying control voltage values. In other embodiments, the control voltage values need not be spaced uniformly, and may be spaced relative to a change in output power, relative to a deviation from a linear response, or relative to some other factor.",{"@attributes":{"id":"p-0045","num":"0044"},"figref":"FIG. 4","b":["400","400","400","400","400","400","400"]},{"@attributes":{"id":"p-0046","num":"0045"},"figref":"FIG. 5A","b":["500","500","500","500"]},"When the predistortion module  is configured for AM-AM predistortion, the input signal includes the amplitude envelope which may incorporate a gain control or power control setpoint, such as shown in . In another embodiment, the input to an AM-AM predistortion module  can include the amplitude envelope and a separate gain control signal, such as shown in . The output signal from the AM-AM predistortion module  represents the predistorted envelope signal.","When the predistortion module  is configured for AM-PM predistortion, the input signal can be the same as for the AM-AM predistortion module, as in , or can be the predistorted envelope signal, as in . The signal output from the AM-PM predistortion module  can represent a phase error or phase offset that can be used by a phase rotator to compensate a phasor.","In one embodiment, the predistortion module  can include a range select module  coupled to a master predistortion table . The master predistortion table  can be configured to store the entire characterization curve. As discussed previously, the characterization curve can be stored in any one of various embodiments, including, but not limited to, a predetermined number of points, a polynomial curve, a plurality of piecewise linear portions, a plurality of piecewise linear polynomials, and the like.","In one embodiment, the range select module  receives the power control setpoint value, which can be a gain control value, and determines a portion of the characterization curve stored in the master predistortion table  corresponding to that power control setpoint value. The range select module  can then retrieve at least a portion of the characterization curve from the master predistortion table  and write the portion into a look up table  in an interpolator .","The interpolator  can be configured to interpolate between two or more points stored in a look up table . The interpolator  can include a processor  coupled to memory  configured to perform the interpolation. The output of the interpolator  can represent the predistorted signal, when the predistortion module  is configured for AM-AM predistortion, and can represent the phase offset or phase correction when the predistortion module  is configure for AM-PM predistortion. A more detailed description of predistortion module  embodiments is provided below.","The predistortion module  can be configured to receive a power control setpoint and the envelope signal for the amplifier module as the input signals. The power control setpoint can correspond to a nominal output power desired from a transmitter. The power control setpoint can be coupled to an input of the range select module . The envelope signal can represent the AM about the power control setpoint, and is coupled as an input signal to the interpolator .","The range select module  can be configured to determine, based in part on the value of the power control setpoint, one of a plurality of predetermined ranges stored in the master predistortion table . In one embodiment, the predistortion module  can be configured to store a plurality of characterization curves in the master predistortion table  corresponding to a plurality of overlapping ranges.","Each of the stored characterization curves can be optimized for a particular range of power control setpoint values. For example, in a first range the gain of an amplifier module may be relatively linear and the characterization curve corresponding to the range may have a minimal number of points. However, in a second range the gain of the amplifier module may vary nonlinearly and the corresponding characterization curve for the range may have a relatively large number of points. Therefore, to minimize the storage requirements for the look up table, a plurality of overlapping characterization curves may be stored, with each curve optimized for a particular range. In other embodiments a single characterization curve may be used and the range select module  can be omitted. In still other embodiments, the envelope signal may incorporate the power control setpoint and the interpolator  may be configured to perform the range selection. Therefore, the range select module  may be omitted in the configuration.","The range select module  may determine the appropriate section or portion of the characterization curve stored in the master predistortion table  and may also provide a signal to the interpolator  to indicate the active characterization curve. The range select module  can write the portion of the characterization curve into the look up table . Alternatively, the interpolator  can receive a signal from the range select module  and write the portion of the characterization curve into the look up table . The interpolator  receives the envelope signal and looks up the nearest value in the look up table  corresponding to the envelope signal value.","If the control voltage value is not stored in the look up table , the interpolator  can be configured to interpolate between two bounding values stored in the look up table . In one embodiment, the interpolator  can be configured to perform a linear interpolation between the nearest stored values that are above and below the desired control voltage value. In other embodiments, the interpolator  can be configured to perform a curve fit using two or more stored values. In still other embodiments, the interpolator  can implement some other type of interpolation technique.","The output of the interpolator  represents the predistorted envelope signal value when the predistortion module  is configured for AM-AM predistortion, and represents the phase offset when the predistortion module  is configured for AM-PM predistortion.",{"@attributes":{"id":"p-0058","num":"0057"},"figref":["FIG. 5B","FIG. 5B"],"b":["520","520","526","522","524","528","526","522","524","528","540","520"]},"The additional frequency compensation table , temperature compensation table , and battery voltage compensation table  can be used to further increase the accuracy of the master predistortion table . The values stored in, for example, the AM-AM look up table can represent the gain characterization curve for an amplifier module at a particular frequency and at a particular temperature. For example, the nominal measured response table  may store the measured response curve for a frequency that is approximately the center of an operating frequency band. Additionally, the characterization curve stored in the nominal measured response table  may have been determined at a typical operating temperature, such as 25\u00b0 C.","However, the characterization curve may be slightly different for different frequencies, different temperatures, or different battery voltages. For example, the gain of an amplifier module may become nonlinear at lower power levels for higher temperatures. Therefore, the temperature compensation table  may be configured to store offsets or corrections to the characterization curve stored in the nominal measured response table  for one or more temperatures. The temperatures may be determined directly using a temperature sensor (not shown) or by some indirect technique. Similarly, the frequency compensation table  can be configured to store corrections or offsets to the characterization curve for one or more frequencies. For example, the frequency compensation table  may store correction data for a frequency near the lower end of the operating band and correction data for a frequency near the upper end of the operating band. Similarly, the battery voltage compensation table  can be used to store correction data corresponding to different battery voltages.","It may be convenient for the frequency compensation table , the temperature compensation table , and battery voltage compensation table  to store offsets or corrections rather than storing numerous individual characterization curves for different temperatures, frequencies, and voltages. The use of offset or compensation values allows the compensation values to be summed with the nominal value stored in the nominal measured response table .",{"@attributes":{"id":"p-0062","num":"0061"},"figref":"FIG. 6A","b":["600","600","600"]},"The digital portion can include a digital baseband portion that performs the majority of the signal processing and predistortion. The digital baseband portion of the transmitter  can be implemented within an integrated circuit such as an Application Specific Integrated Circuit (ASIC). The analog portion can include baseband or Intermediate Frequency (IF) portions and can include RF portions. For example, in one embodiment the analog portion performing the frequency conversion from baseband to an RF output frequency can be performed in an RF IC. The frequency conversion can be performed according to one of any frequency conversion techniques, including OPLL, dual conversion, direct conversion, or some other technique. A power amplifier module having variable gain can be coupled to the output of the RFIC and can be configured to drive the output signal to the desired power level.","The transmitter  is configured to predistort amplitude and phase components of a polar representation of a baseband signal. The transmitter  is configured to compensate the amplitude envelope using AM-AM predistortion and is configured to compensate the phase component using AM-PM predistortion.","The digital baseband portion can include a rectangular to polar converter  that is configured to convert a rectangular input signal to a polar coordinates having a magnitude component and a phasor with a normalized magnitude. For example, a digital baseband signal can be configured as a quadrature signal having I and Q components. The quadrature signal is converted to polar coordinates in the rectangular to polar converter .","The magnitude component output from the rectangular to polar converter  represents the amplitude envelope of the baseband signal. The magnitude component of the polar signal is coupled to an input of a multiplier . A power ramp module  is coupled to a second input of the multiplier . The power ramp module  is configured to scale the envelope signal to conform to a predetermined power time envelope mask. The power ramp module  can be configured, for example, to provide a GSM or EDGE power ramp for the signal in order to conform to requirements such as those shown in . The power ramp module  is configured to scale the envelope signal. The output of the multiplier  is coupled to an input of a first predistortion module configured to provide AM-AM predistortion.","The output of a gain control module  is also coupled to an input of the first predistortion module configured to provide AM-AM predistortion. The first predistortion module can be configured, for example, as the predistortion module of . The first predistortion module can determine a range of a characteristic curve based on the value of the input signal provided by the gain control module . The first predistortion module can store in a look up table a portion of a characterization curve for an amplifier module  retrieved from a master predistortion table (not shown). The first predistortion module can also include an interpolator that is configured to receive the power ramped envelope signal from the multiplier , determine from the look up table an amount of compensation or an amount of distortion, and apply predistortion to the power ramped envelope signal.","The predistorted output from the first predistortion module is then coupled to an input of a multiplexer  and an input of a second predistortion module . The multiplexer  can be configured to select one of a plurality of envelope signals to be applied to the amplifier module . For example, the multiplexer  can be controlled to select one of a plurality of input signals based on a transmitter  mode of operation.","In the embodiment shown in , the output of the first predistortion module is coupled to an input of the multiplexer . A GSM power ramp module  can also be coupled to an input of the multiplexer . The GSM power ramp module  can be configured to provide a power time envelope mask for a GSM mode of operation. Additional modules or control signals may be coupled to additional inputs of the multiplexer  and may be selected for appropriate operating modes.","The output of the multiplexer  can be coupled to an upsampler  that is configured to upsample the envelope signal provided by the multiplexer . The upsampler  can be used to improve the SNR at the power amplifier input and eases analog filtering requirements following the digital to analog conversion. The upsampler  can also be used to provide finer resolution for delay matching modules. An integer delay module  can be coupled to the output of the upsampler  and can be configured to delay the predistorted amplitude envelope by an integer number of clock cycles. The output of the integer delay module  is coupled to a fractional delay module  that can be configured to delay the predistorted amplitude envelope by a fraction of a clock cycle. The integer and fractional delay modules  and  can be configure to introduce a delay that allows the predetermined envelope signal to be synchronized with a phase signal. The output of the fractional delay module  can be coupled to a power control Digital to Analog Converter (DAC)  that is configured to convert the digital signal to an analog representation.","The analog output of the power control DAC  is coupled to a signal amplifier . The output of the power control DAC  can represent one output from a digital baseband processor. The output of the power control DAC  may be, for example, a differential signal. The power control DAC  may have a differential output in order to provide noise immunity. The signal amplifier  can have, for example, a differential input and a single ended output, and can be configured as a buffer with unity gain or an amplifier with gain. The output of the signal amplifier  is coupled to a power control input of the amplifier module .","The normalized phasor output from the rectangular to polar converter  can be predistorted in a manner similar to the manner in which the magnitude or envelope signal is predistorted. The phasor output from the rectangular to polar converter  is coupled to an input of a phase rotator module . The phase rotator module  may be, for example, a CORDIC with a phase correction input.","The phase rotator module  can include another input that receives the phase compensation from the second predistortion module . As discussed above, the second predistortion module can be coupled to the output of the first predistortion module . The second predistortion module can be configured to store a phase characterization curve such as the curve shown in . The characterization curve can be stored in an AM-PM look up table and used by an interpolator to determine an amount of phase compensation to be applied to the phasor.","The second predistortion module couples the output phase compensation value to the phase rotator module . The phase rotator module  can then predistort the phase signal by rotating the phasor by the amount of phase compensation.","The phase rotator module  can also be configured to convert the phase compensated phasor to rectangular coordinate system by generating corresponding I and Q signal values. The in phase signal output from the phase rotator module  can be coupled to an in phase multiplier  and the quadrature signal output from the phase rotator module  can be coupled to a quadrature multiplier . A digital baseband ramp module  can be configured to drive inputs on the in phase and quadrature multipliers  and  and can scale the phasor signals, for example, depending on system timing. The scaled I and Q signals output from the in phase and quadrature multipliers  and  are coupled to respective in phase and quadrature upsamplers  and . The outputs of the upsamplers  and  are coupled, respectively, to I and Q delay modules  and .","The in phase and quadrature delay modules  and  can be configured to the I and Q delay of the phase signal path to the delay experienced by the envelope signal. The output of the in phase and quadrature delay modules  and  are coupled to respective in phase and quadrature DACs  and . The in phase and quadrature DACs  and  are configured to convert the digital signals to analog representations. The DACs  and  may, for example, generate differential analog output signals in order to increase signal noise immunity.","The outputs from the DACs  and  are coupled to an upconverter module, which can perform upconversion in any of a variety of ways. In the embodiment of , the output of the DACs  and  are coupled to respective in phase and quadrature mixers  and . A local oscillator (LO)  configured to generate a LO is coupled to an LO input of the in phase mixer . The LO  is also coupled to a phase shifter  configured to generate a quadrature LO signal. The quadrature LO signal can be coupled to the LO input of the quadrature mixer . The output of the in phase mixer  and the output of the quadrature mixer  can be coupled to respective inputs of a signal summer  that is configured to sum the two signal components to generate a composite signal. The composite signal is provided to an input of an amplifier module .","The predistorted envelope signal controls the gain of the amplifier module . Thus, the amplifier module  amplifies the composite signal to a power level controlled by the power control setpoint. Additionally, because the gain of the amplifier module  is varied by the envelope signal, the output amplitude of the amplifier module  varies according to the signal envelope. Thus, the amplifier module  is AM modulated to restore the envelope to the signal.","Because the gain control voltage value of the amplifier module  is predistorted to compensate at least for the AM distortion contributed by the amplifier module, the output of the amplifier module  is corrected for AM distortion. Similarly, the phasor that generates the I and Q signal components of the composite signal input to the amplifier module  is compensated for PM distortion by the second predistortion module and phase rotator module . Thus, the phase output of the amplifier module  is compensated for at least the PM distortion contributed by the amplifier module .",{"@attributes":{"id":"p-0080","num":"0079"},"figref":["FIG. 6B","FIG. 6B","FIG. 6A"],"b":["600","500"],"i":"a. "},"The output of the gain control module  is coupled to an input of the power ramp module  rather than to an input of the first predistortion module . The power ramp module  can be configured to combine the gain control signal to the power ramp signal, for example, by summing the two signals to generate an output that is a composite gain control power ramp signal. The scaled envelope signal output from the multiplier  is coupled to an input of the first predistortion module ","The first predistortion module is configured to operate on the single input having the envelope signal scaled by the composite gain control power ramp signal. Because the first predistortion module operates on a single input, range selection from a master predistortion table can be omitted. Instead, the entire master predistortion table can be stored in the look up table and accessed by the interpolator . The remaining portions of the transmitter  are the same as in .",{"@attributes":{"id":"p-0083","num":"0082"},"figref":["FIG. 6C","FIG. 6C","FIG. 6A"],"b":["600","500","500","500","620","612"],"i":["b ","a","b "]},"Thus, the second predistortion module can be configured to determine a range of an AM-PM characterization curve stored in a master predistortion table (not shown) based on the gain control value and load the portion of the characterization curve into the look up table . The interpolator can interpolate a predistortion level based on the value of the envelope signal. The remainder of the transmitter  is the same as in .",{"@attributes":{"id":"p-0085","num":"0084"},"figref":["FIG. 6D","FIG. 6D","FIG. 6B","FIG. 6A"],"b":["600","500","500","500","600"],"i":["b ","a","b "]},{"@attributes":{"id":"p-0086","num":"0085"},"figref":["FIG. 6E","FIG. 6E","FIG. 6A","FIG. 6A","FIG. 6E"],"b":"600"},"The digital baseband portion can include a rectangular to polar converter  that is configured to convert a rectangular input signal to a polar coordinates having a magnitude component and a phasor with a normalized magnitude. The normalized amplitude envelope output from the rectangular to polar converter  is coupled to an input of the first predistortion module . Previously, in the embodiment shown in , the amplitude envelope was scaled by the power ramp module  in the multiplier  prior to being coupled to the first predistortion module ","The envelope output from the rectangular to polar converter  and the output of the gain control module  are also coupled to the input of the second predistortion module . The first predistortion module operates on the input signals to predistort the envelope signal. The predistorted output from the first predistortion module is coupled to an input of a multiplier .","The power ramp module  provides the power ramp signal to another input of the multiplier . The output of the multiplier  is the predistorted amplitude envelope signal scaled by the power ramp. The output of the multiplier  is coupled to an input of the multiplexer . The remainder of the amplitude signal processing can be identical to the amplitude signal processing performed by the embodiment of  and is omitted here for the sake of brevity.","The phase predistortion signal processing performed by the embodiment of  is largely identical to the phase predistortion signal processing performed by the embodiment of . The difference lies in the input signals provided to the second predistortion module ","As discussed previously, the amount of phase predistortion applied to compensate a phasor varies depending on the magnitude of the amplitude signal. Therefore, the second predistortion module can be configured to receive the same inputs as the first predistortion module as well as from the power ramp module . The second predistortion module can use the input signals to determine the amplitude of the composite amplitude envelope signal. In another embodiment, shown in , the second predistortion module can receive as an input the output of the multiplier , which is the composite amplitude envelope signal.","The second predistortion module provides a control signal to the phase rotator module . The remainder of the phase predistortion signal processing performed by the embodiments of  are the same as the phase predistortion signal processing performed by the embodiment of , and the description is omitted for purposes of brevity.",{"@attributes":{"id":"p-0093","num":"0092"},"figref":["FIG. 7","FIG. 7"],"b":["700","700"]},"The transceiver  can include a baseband processor  coupled to an RF portion . The RF portion  can also be coupled to a PA\/Frontend portion . The baseband processor  can be, for example, the baseband processor of . The baseband processor  can be, for example, implemented as a single baseband integrated circuit.","The baseband processor  can includes a waveform generator , a processor , one or more nominal AM-AM or AM-PM measurement tables , and an Rx IQ sample memory . The processor  can be coupled to the Rx IQ sample memory  and can operate on the sample memory contents to produce the nominal measurement table . The nominal measurement table  can include the AM-AM and AM-PM look up tables and shown in the baseband processors of  though F, and may include the master predistortion table shown in .","The baseband processor  can include a waveform generator  that can be configured to generate an envelope signal and normalized I and Q signals that are typically part of a transmitter path of the transceiver . The output of the waveform generator  can be selectively coupled to the I, Q, and envelope signal lines of the baseband processor . The envelope, I and Q signals can also be coupled to inputs of the Rx IQ sample memory . The Rx IQ sample memory  can also include inputs configured to couple with outputs of an ADC  coupled to received I and Q signals that are typically recovered in a receive path of the transceiver .","The RF portion  can include the frequency conversion and intermediate amplification stages for the transmit and receive signal paths. The RF portion  can be implemented, for example, in a single integrated circuit.","In the embodiment shown in , the RF portion  includes a first lowpass filter (LPF) that is configured to receive and filter the envelope signal from the baseband processor . The output of the first LPF is coupled to an envelope amplifier configured to provide intermediate amplification to the envelope signal.","The RF portion  also includes second and third LPFs and that are configured to receive and filter the I and Q signals, respectively, from the baseband processor . The outputs of the second and third LPFs and are coupled, respectively, to I and Q amplifiers and . The outputs of the I and Q amplifiers and are coupled, respectively, to I and Q mixers and that are configured to frequency convert the I and Q signals. The Local Oscillator (LO) inputs of the I and Q mixers and are driven by LO signals generated by an LO  driving a signal splitter  that can also be configured to introduce a ninety degree phase shift. Of course, some other upconversion technique can be used in the transceiver .","The frequency converted outputs from the I and Q mixers and are coupled to a signal summer  that sums the I and Q signal components. The output of the signal summer  is coupled to a bandpass filter  and an AGC amplifier .","The amplified envelope and quadrature signals output by the transmit path of the RF portion can be coupled to the power amplifier of the PA\/Frontend portion . The envelope signal from the envelope amplifier of the RF portion  can be used to control a bias section  of a power amplifier . The quadrature signal component can couple to an input of the power amplifier . The output of the power amplifier  can be coupled to a switch  that can be configured to selectively couple an antenna  to a transmit or receive path of the transceiver . The switch  can also be referred to as a switchplexer because it can be viewed as multiplexing the transmit and receive operations by switching the desired signal path to the antenna .","The receive path of the transceiver  includes a receive filter  that can be, for example, a GSM receive SAW filter. The receive filter  can also be configured to convert the received signal into a differential signal.","The RF portion  frequency converts the received differential signals for processing in the baseband processor. The received differential signals are coupled to a receive amplifier  which drives receive I and Q mixers and , respectively. The LO ports of the receive I and Q mixers and are driven by the same LO  and signal splitter  used for the transmit path. The receive I and Q mixers and output the received I and Q baseband signals.","The I and Q baseband signals are amplified in baseband amplifiers and , respectively, and then are filtered in I and Q baseband filters and , respectively. The filtered I and Q baseband signals are coupled to the baseband processor  where they are coupled to an ADC  and from the ADC  to inputs of the Rx IQ sample memory .","The transceiver AM-AM and AM-PM distortion can be calibrated by generating a calibration signal in the baseband processor  and sending it through the transmit path of the transceiver . The transmit calibration signal can then be monitored using the receive path of the transceiver .","The transceiver  includes a coupler  and attenuator  that are configured to directly couple the transmit signal at a predetermined coupling level. The coupler  can be, for example, a directional coupler. The output of the attenuator  can be coupled to a buffer amplifier  on the RF portion . Implementing the coupler  and attenuator  in the transceiver  allows the designer to better constrain the coupling of the transmit signal. Additionally, the transmit signal may be routed to omit the receive filter , which may be a narrow band SAW filter. The calibration process does not rely on the transmit leakage path, which may be so attenuated as to impair the ability to calibrate lower power levels. Although the coupler  is shown as coupling the output of the switch  at the input to the antenna , the coupler  may also be positioned at the input of the switch , near the output of the power amplifier .","Additionally, although the calibration process is described using an integrated receiver, the calibration process may operate using an external receiver that is configured to couple a signal from the output of the transmitter and provide a receive signal to the input of the RX sample memory , such as by coupling to the input of the ADC . The external receiver can be configured to use the same LO signal as the transmitter.","The transceiver  can also be configured to take advantage of any transmit leakage occurring in the PA\/Frontend portion  to couple the transmit calibration signal to the receive signal path. The transmit leakage may be, for example, on the order of 50 dB below the transmit power level.","In one embodiment, calibration of the AM-AM and AM-PM distortion of the transceiver  can be performed by initially generating a known calibration signal, which may use a predetermined signature code, using the baseband processor . The baseband processor  may set the envelope signal to a predetermined level corresponding to a predetermined transmit power level. The baseband processor  can couple the envelope signal and the I and Q signal components of the calibration signal to inputs of the Rx IQ sample memory .","The RF portion  can be configured to frequency convert the calibration signal to a known frequency, which can be, for example, a transmit frequency or a receive frequency of the transceiver . The RF portion  couples the frequency converted calibration signal to the PA\/Frontend portion  where the signal is amplified according to the envelope signal applied to the PA bias section .","By way of the coupler , attenuator , and buffer amplifier , or due to transmitter leakage, some of the transmit signal is coupled to the receive signal path of the transceiver . The output of the buffer amplifier  can be coupled to the inputs of the mixers and , while the transmitter leakage signal is coupled by the receive filter  to the receive signal path of the RF portion . The RF portion  frequency converts the signal back to baseband I and Q signals. The baseband I and Q signals are coupled to the baseband processor  where they are coupled to the ADC  and the receive I and Q inputs of the Rx IQ sample memory .","The Rx IQ sample memory  can build a measurement curve using the received I and Q signals as the outputs of a function having the I and Q signals of the waveform generator  as the input. The baseband processor  can store measured values in the Rx IQ sample memory , and can use the processor  to further process the values to generate the nominal measurement table  values.","The baseband processor  can also store a received signal power relative to a predetermined power. The predetermined power can be, for example, full PA power. In an embodiment, the full PA power can be measured using a power meter (not shown) coupled external to the transceiver .","The baseband processor  can repeat the calibration process for a predetermined number of envelope signals to fully characterize the transceiver . The baseband processor  can time vary the phase of the calibration signal to time align the I and Q signal paths.","Although the calibration process can be performed completely autonomously, it may be advantageous to separately calibrate the receive imbalance by receiving a tone of known phase and determining the phase imbalance of the receive path. The transceiver  can thus more accurately attribute imbalances to the imbalances in the transmit path.","Although the calibration process described herein can be adapted for use with any of the embodiments shown in , it may be advantageous to use a configuration in which the AM-PM predistortion module receives the predistorted envelope signal as the input. In such a configuration, the AM-PM predistortion is merely the negative of the measured phase.","Thus, as an example, a power meter can be coupled to the transmit output of the transceiver . The waveform generator  can be configured to generate a constant phasor signal for the I and Q inputs. The waveform generator  can also be controlled to increase the amplitude of the envelope signal until the power meter senses a maximum output power from the power amplifier . The output of the ADC  can be read to determine a corresponding reference point. The remainder of the power readings can then be determined relative to the maximum power reading.","The waveform generator  can be configured to maintain a constant phasor value at the I and Q lines. This corresponds to providing a DC value to each of the I and Q lines. The waveform generator  can then be configured to provide an envelope signal value that corresponds to an output power less than the maximum output power.","The receive path processes the signal and the ADC  converts the recovered Rx I and Rx Q signals. These signals are coupled to the Rx IQ sample memory  and represent the output characteristic for a given input. Thus, thus the receive signal path determines a phase and amplitude corresponding to a given phase and envelope signal provided by the waveform generator . A single Rx I and Rx Q measurement may be used or a number of measurements can be averaged to average thermal and phase noise contributions. The waveform generator  can then generate another envelope signal and the transceiver can repeat the process until sufficient characterization curves are determined.","As discussed above, more accurate calibration can be achieved if any receive phase imbalance is removed or compensated prior to performing calibration. Additionally, to further improve the accuracy of the calibration process, receive DC offset, and signal contributions attributable to leakage from the input of the power amplifier  to the receive signal path need to be accounted for.","The receive phase imbalance can be corrected, for example, using an external signal generator coupled to the receiver input and configured to provide a signal with a known phase. Alternatively, the waveform generator  can be configured to generate a predetermined waveform and the I and Q paths of the receiver can be adjusted to achieve a minimal residual sideband component.","The leakage from the input of the power amplifier  to the receive path contributes to inaccuracies in the calibration. The effect of the PA input leakage is to add a DC offset to the receive calibration signal. Thus, the DC offset attributable to PA input leakage and Rx DC offset can both be compensated using the same measurement. The power amplifier  can be disabled while the waveform generator  provides a strong signal to the input of the power amplifier . Any resultant signal at the output of the ADC  can be attributable to the DC offset and PA input leakage. The characterization curves can be compensated for this signal contribution.","The above calibration process assumes that the receive path gain remains constant. However, the dynamic range of the receiver, and particularly the ADC , may not be sufficient to allow a characterization curve to be measured with a single receive gain. Thus, the receive signal path gain may be adjusted one or more times during the course of calibration. Because the contribution to PA input leakage and DC offset can vary depending on the level of receive gain, the measurement and correction of these contributors should be repeated for each receive gain setting used during calibration.","The timing alignment of the envelope signal relative to the phasor is an important performance characteristic of the transmitter. The delays in the envelope signal and phase signal paths can be adjusted to time align the signal paths. These delay modules are shown in the embodiments of . The signal paths can be aligned using the RX calibration path or using external equipment.","The waveform generator  can be configured to generate a known waveform that changes phase and amplitude over time, such as a sine wave. If external equipment is used, the external equipment can be synchronized to the output of the waveform generator  and can be configured to monitor the transmitter output. The delay modules can then be varied to time align the signal paths.","If the Rx calibration path is used, the output of the waveform generator  at the Rx IQ sample memory  can be compared against the received signals from the output of the ADC . The delay modules can be adjusted to time align the transmit signal paths.","Although the results of the calibration process may be used directly as the characterization curves stored in master predistortion tables, it may be advantageous to further process the calibration data. Additional processing can be used to smooth the characterization curves to remove small errors that have disproportionate impact on the quality of the predistorted signals.","For example, when characterizing the AM-AM distortion, small amplitude measurement errors at high signal powers disproportionately can degrade the output RF spectrum of a signal that is predistorted using the characteristics. This may be attributable to the relatively shallow slope of the gain curve for a power amplifier at high power levels. Similarly, when measuring the AM-AM or AM-PM characteristic curves, the measurements are affected by noise, such as thermal noise or phase noise.","Therefore, to compensate for small measurement errors that can potentially contribute to degradations in the predistorted output RF spectrum, the measured characteristic curves can be processed to smooth out small measurement errors. One approach, previously discussed, is to utilize piecewise cubic (third order) curve fitting to the measured distortion characteristics.","Because continuity at each of the measurement points may be desirable, a spline curve fit may be advantageous. The characteristic curves can use measurement points that correspond roughly to 0.5 dB steps in output power. The AM-AM and AM-PM characteristic curves can be fit using the same basis splines if the slopes of the two curves are somewhat correlated.",{"@attributes":{"id":"p-0131","num":"0130"},"figref":["FIG. 8","FIG. 6A"],"b":["800","800","6","800","810","820","830","840"]},"Apparatus and methods are disclosed above for compensating signal distortion contributed during signal processing. The apparatus and methods can be configured to compensate for the signal distortion through envelope elimination and restoration combined with predistortion. The signal can be converted from rectangular coordinate system to a polar coordinate system having a magnitude and phase component.","The phase component can be predistorted to compensate for phase distortions contributed by the signal path. The compensated phase component has a normalized magnitude that does not vary. The compensated phase component can be coupled to the input of a gain stage having one or more amplifiers configured to amplify the signal for transmission.","The magnitude component can be predistorted to compensate for gain nonlinearities in the signal path. The magnitude component can then be used to control a gain of one or more amplifier stages to restore the envelope to the phase component.","A predistortion module can be implemented for each of the amplitude and phase predistortion. The predistortion module can include a range selection module that is configured to receive a nominal power control setpoint value, a look up table that is configured to store a characteristic that is to be predistorted, and an interpolator that is configured to receive the range selection, retrieve the corresponding characteristics from the look up table, and apply the predistortion to the signal.","The predistortion modules and the characteristics stored in the look up tables of the predistortion modules can be determined in a calibration routine that can be configured as an autocalibration routine. In one embodiment, a calibration signal is generated in a transmit path and coupled to a receive path. The received signal is compared against the calibration signal to determine the amount of distortion contributed to the signal. The signal comparison can be repeated for various power levels to determine distortion characteristics such as AM-AM distortion and AM-PM distortion.","The various illustrative logical blocks, modules, and circuits described in connection with the embodiments disclosed herein may be implemented or performed with a general purpose processor, a digital signal processor (DSP), a Reduced Instruction Set Computer (RISC) processor, an application specific integrated circuit (ASIC), a field programmable gate array (FPGA) or other programmable logic device, discrete gate or transistor logic, discrete hardware components, or any combination thereof designed to perform the functions described herein. A general purpose processor may be a microprocessor, but in the alternative, the processor may be any processor, controller, microcontroller, or state machine. A processor may also be implemented as a combination of computing devices, for example, a combination of a DSP and a microprocessor, a plurality of microprocessors, one or more microprocessors in conjunction with a DSP core, or any other such configuration.","A software module may reside in RAM memory, flash memory, non-volatile memory, ROM memory, EPROM memory, EEPROM memory, registers, hard disk, a removable disk, a CD-ROM, or any other form of storage medium known in the art. An exemplary storage medium is coupled to the processor such the processor can read information from, and write information to, the storage medium. In the alternative, the storage medium may be integral to the processor.","The steps of a method, process, or algorithm described in connection with the embodiments disclosed herein may be embodied directly in hardware, in a software module executed by a processor, or in a combination of the two. The various steps or acts in a method or process may be performed in the order shown, or may be performed in another order. Additionally, one or more process or method steps may be omitted or one or more process or method steps may be added to the methods and processes. An additional step, block, or action may be added in the beginning, end, or intervening existing elements of the methods and processes.","The above description of the disclosed embodiments is provided to enable any person of ordinary skill in the art to make or use the disclosure. Various modifications to these embodiments will be readily apparent to those of ordinary skill in the art, and the generic principles defined herein may be applied to other embodiments without departing from the spirit or scope of the disclosure. Thus, the disclosure is not intended to be limited to the embodiments shown herein but is to be accorded the widest scope consistent with the principles and novel features disclosed herein."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The features, objects, and advantages of embodiments of the disclosure will become more apparent from the detailed description set forth below when taken in conjunction with the drawings, in which like elements bear like reference numerals.",{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 2A"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 2B"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIGS. 5A-5B"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIGS. 6A-6F"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 8"}]},"DETDESC":[{},{}]}
