---
title: Service path routing between session border controllers
abstract: Systems and methods of establishing IP telephony sessions between enterprises are disclosed. A first enterprise requests an association with a second enterprise. Both enterprises and the second enterprise belong to the same federation. The association request is accepted, to establish an association between the first and second enterprises. In response to the acceptance, a direct routed path is established between the first enterprise and the second enterprise. One of the associated enterprises requests activation of an IP telephony service. If the request to activate references the association, an IP telephony session is established using the direct routed path.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08761160&OS=08761160&RS=08761160
owner: Acme Packet, Inc.
number: 08761160
owner_city: Bedford
owner_country: US
publication_date: 20110216
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS REFERENCE TO RELATED APPLICATIONS","TECHNICAL FIELD","BACKGROUND","DETAILED DESCRIPTION"],"p":["This application claims the benefit of U.S. Provisional Application No. 61\/358,810, filed Jun. 25, 2010, which is incorporated by reference herein.","The present disclosure relates to Internet voice and data services.","Many enterprises have moved from telephony services using the Public Switched Telephone Network (PSTN), provided by a traditional telephone company, to telephony services using the Internet Protocol (IP), provided by an IP Telephony service provider. Such services are commonly known as Voice over IP (VoIP) or IP Telephony. Now that an IP network, such as the public Internet or a private IP network, can be used as a backbone rather than the limited PSTN, IP Telephony has the capability of providing advanced features such as video conferencing, call recording, and call forwarding, to name a few. However, the primary use of IP Telephony service is still to connect IP Telephony callers to PSTN callers. For this reason, the signaling infrastructure (i.e. SIP proxies, application servers, etc.) utilized by the IP telephony service provider is designed to allow many different types of endpoints to access the less feature-rich services provided by PSTN gateways. The service provider often manipulates and\/or normalizes traffic (e.g., translation to a least common denominator codec, manipulating\/removing certain SIP headers, etc.). Such manipulations can prevent the advanced IP telephony services which act to differentiate IP telephony from PSTN telephony.",{"@attributes":{"id":"p-0020","num":"0019"},"figref":["FIG. 1","FIG. 1"],"b":["100","1","105","2","110","120","100","125","1","105","1","130","1","135","2","110","2","140","2","145","1","135","1","150","2","145","2","155"]},"The service provider  includes additional communications infrastructure which makes up a VoIP network . The VoIP network  may include a PSTN gateway  which allows customers of the service provider  (such as enterprises E  and E ) to make calls to\/from the PTSN . In addition to Internet telephony, enterprises E  and E  also have data connections to the Internet , for example through a router , . In the example of , the Internet  is shown separate from the VoIP network , but it should be appreciated that the same service provider  may provide both Internet data and Internet telephony services.","Each enterprise E , E  utilizes a communication channel known as a SIP trunk , . As used herein, a SIP trunk is a service offered by service provider  which directly connects a service provider's IP network to the SBC\/PBX deployed at the enterprise. More specifically a SIP trunk is defined as the combination of an IP address and port for the enterprise, the IP address and port of the service provider SBC , , and the service level agreement constraints (e.g., concurrent number of sessions and\/or bandwidth). In some embodiments, the IP address and port for the enterprise is the address and port of the enterprise SBC (E , E ). In other embodiments, the IP address and port for the enterprise is the address and port of the enterprise PBX (, ). The type of traffic exchanged over SIP trunk ,  may include VoIP, IP video, multimedia\/collaborative sessions, and\/or other services making use of IP signaling protocols.","The federated system  also includes a dynamic federation system . The dynamic federation system  is a distributed system whose components will be explained in further detail below. For purposes of this initial overview, dynamic federation system  can be considered to be a single component. Dynamic federation system  is in communication with each of the service provider SBCs (SBC-SP , SBC-SP ) over its respective SIP trunk , . Dynamic federation system  is also connected to Internet . As will be explained in more detail below, dynamic federation system  creates associations between enterprises by coordinating actions among the service provider SBCs (SBC-SP , SBC-SP ) and the enterprise SBCs (SBC-E , SBC-E ). Once an enterprise association is created, dynamic federation system  provides a direct routed path between the associated enterprises, and enables the associated enterprises to use IP telephony services which take advantage of this direct routed path.","Each of enterprises E  and E  also includes an administrative server ,  in communication with dynamic federation system  over Internet . Administrative server ,  handles various administrative functions such as enterprise requests to join federated system  and to associate with other enterprises. An enterprise user invokes these administrative functions through an administrative client , . In some embodiments, administrative server ,  takes the form of a web server and administrative ,  takes the form of a browser that accesses web pages provided by administrative server , .",{"@attributes":{"id":"p-0025","num":"0024"},"figref":["FIG. 2","FIG. 1"],"b":["100","185","1","105","100","2","110","185","1","150","2","155","1","135","2","145","210","210"]},"A user in enterprise E  uses a phone, computer, or communication device  to activate a telephony service (e.g., place a call, get directory assistance, set up a video conference, etc.). If the service is activated using a phone number linked to direct routed path , the originating enterprise SBC sets up the call using direct routed path . The call thus traverses the originating enterprise SBC (SBC-SP ), the SP SBC in communication with the originating enterprise SBC (SBC-E ), the peer SP SBC (SBC-SP ), and the terminating enterprise SBC (SBC-E ).","Thus, after enterprise E  has successfully associated with enterprise E , those IP telephony sessions made by enterprise E  that match enterprise E's directory information for the federated service (\u201cfederated sessions\u201d) are routed directly over direct routed path . This direct routed path  was established when the association was created, using the techniques described herein. As should be appreciated, such IP telephony sessions include media packets, which may take the form of voice packets, video packets, etc. In some embodiments, signaling packets associated with the IP telephone session also travel over the same direct routed path .","Importantly, direct routed path  bypasses other service provider signaling equipment within the VoIP network  that may prevent advanced IP communications to function. In particular, direct routed path  bypasses the PTSN  and uses packet switching rather than time division multiplexed (TDM). Because the service provider's VoIP network  is designed to connect many different types of endpoints to the PSTN gateway , the service provider often manipulates and\/or normalizes traffic (e.g. translation to a least common denominator codec, manipulating\/removing certain SIP headers, etc.) so as to conform to the lowest common denominator of basic PSTN service. This manipulation and resulting loss of capabilities can prevent advanced IP telephony services. The dynamic federation system  conveys the media packets over the directed routed path, avoiding the PSTN gateway  and corresponding manipulations of the packets carrying voice traffic. Some embodiments also convey signaling packets over the same direct routed path. By confining the path to specific SBCs operated by the enterprises, and avoiding signaling equipment within VoIP network  operated by the service provider, the direct routed path coordinated by the dynamic federation system  allows the enhanced features to be used, with full capabilities.",{"@attributes":{"id":"p-0029","num":"0028"},"figref":["FIGS. 3A-C","FIG. 3A"],"b":["193","193","100","310","320","310","320"]},{"@attributes":{"id":"p-0030","num":"0029"},"figref":["FIG. 3B","FIG. 3A","FIG. 3B"],"b":["330","340","350","360"]},"As mentioned above, once the user adds a service from another enterprise, federated system  sends an association request to the other enterprise for the selected service, as mentioned above. Once the other enterprise has accepted the association and a direct routed path  has been established between the two enterprises for the particular service, users of the \u201cfriending\u201d enterprise can use the service. This service is referred to herein as a \u201cfederated service\u201d. Sessions using a federated service (\u201cfederated sessions\u201d) travel over the direct routed path  as noted above.",{"@attributes":{"id":"p-0032","num":"0031"},"figref":["FIG. 3C","FIG. 3C"],"b":["370","380"]},"When that happens, the enterprise SBC for XYZ (SBC-E  in ) uses the techniques described herein to identify the session as a federated session. Once identified, the enterprise SBC for XYZ sends the packets which make up the session over the SIP trunk ( in ) into the service provider's core network. From there, the service provider SBC associated with XYZ (SBC-E  in ) identifies the federated session and directly routes it over direct routed path  towards the service provider SBC associated with Roadrunner (SBC-E  in ). Because the federated session travels over the direct routed path , thus avoiding PTSN  as well as most of the service provider's VoIP network , federated system  supports advanced services such as video, high quality audio, conference bridge, call recording, etc.",{"@attributes":{"id":"p-0034","num":"0033"},"figref":["FIGS. 4A-4C","FIG. 2","FIG. 1","FIG. 1"],"b":["210","100","185","185","410","420","410","420","185","430"]},"The process of creating a direct routed path  in the embodiment of  can be viewed as occurring in three parts. First, DFR-C  learns the location of each DFR-E instance, as will be explained in connection with . Next, route paths to reach an associated enterprise are dynamically learned, as will be explained in connection with . Finally, federated communications are associated with a direct routed path by detecting federated communications at an enterprise SBC and tagging a communication so that it traverses the appropriate service route path, as will be explained in connection with .",{"@attributes":{"id":"p-0036","num":"0035"},"figref":["FIG. 4A","FIG. 1"],"b":["410","430","180","175","1","150","1","135"]},"As shown in , each enterprise SBC that is participating in dynamic federation system  subscribes to centralized registry DFR-C , in order to be notified later of confirmed associations with other enterprises. An enterprise SBC (SBC-E ) does this using a SIP Subscribe message. As noted above, the subscribe message () from the enterprise SBC is terminated at the corresponding service provider SBC (SBC-SP ), which then forwards () a corresponding subscribe to DFR-C .","As a result of the subscription from the E-SBC, DFR-C  notifies the subscriber E-SBC of new associations. To do so, DFR-C  creates a watcher event, meaning that DFR-C  is now watching for changes to the configuration of enterprise SBCs, where these changes are learned by communications between centralized DFR-C  and individual enterprise DFR-Es .","As noted above in the discussion of the user interface in , association of one enterprise with another involves user interaction which results in a change to the DFR-E of the association-originating enterprise. Since DFR-C  created a watcher event, DFR-C  is notified of these changes. Thus, the act of enterprise E  associating with enterprise E  causes DFR-C  to send a watcher event () to the service provider SBC (SBC-SP ), intended for the recipient enterprise E . Watcher event  includes a list of associating enterprises. For each associating enterprise, a watcher event  includes the URI of the association-originating enterprise SBC (SBC-E ) and includes the URI of the enterprise SBC's \u201chome\u201d service provider SBC (SBC-SP ) for routing purposes. The association-originating (far end) E-SBC will be referred to as the \u201cwatcher\u201d for the remainder of the discussion of .","Receipt of watcher event  by the service provider SBC (SBC-SP ) triggers the first step in learning the direct routed path ( in ) between the associated enterprise SBCs (SBC-E  and SBC-E ). Specifically, the service provider SBC obtains the route traversed by watcher event  by parsing SIP headers in the watcher event. The service provider SBC is listed as the SIP contact header, and the SIP record-route header includes intermediaries that will remain in the path as packets travel from the service provider SBC to the centralized DFR-C . It is unnecessary for the service provider SBC to use the watcher event to obtain URIs of the association-originating (far end) service provider SBC and enterprise SBC, since the service provider SBC can obtain these URIs from the SIP trunk ( in ).","Having obtained the route traversed by watcher event , the service provider SBC (SBC-SP ) adds the route to its own route table, using the watcher's enterprise trunk identifier as a key. Although the trunk identifier may be encrypted, it is used as an index into the SP-SBC route table that provides the route set to the newly associated SP-SBC\/E-SBC. In other words, the encrypted trunk identifier can still be used as a cookie or handle. In some embodiments which hide network topology, the service provider SBC strips the SP-SBC route URI from the watcher event before delivery since that URI exposes topology that the receiving E-SBC should not be aware of.","The service provider SBC (SBC-SP ) then continues processing watcher event  by informing its enterprise SBC (SBC-E ) of the newly associated enterprise E  through a Notify message (). (As discussed above, enterprise E  subscribed to new associations at step message (.) Notify message  includes a list of one or more newly associated enterprises (here, this list includes enterprise E ). Specifically, Notify message  includes the URI of the association-originating E-DFR, the far-end SP-SBC through which to route SIP traffic to the newly associated enterprise, and the SIP trunk identifier of the newly associated enterprise.",{"@attributes":{"id":"p-0043","num":"0042"},"figref":["FIG. 4B","FIG. 2"],"b":"210"},"The enterprise SBC (SBC-E ) submits a SIP subscription request  to its home SP-SBC (SBC-SP ) using the RequestURI and trunk identifier to identify the newly associated destination E-SBC (SBC-E ). The enterprise SBC (SBC-E ) learned the RequestURI and the trunk identifier from previously received Notify  (). As noted earlier, the trunk identifier may be encrypted. On receipt of the subscription request, the home SP-SBC (SBC-SP ) uses the trunk identifier (after decrypting if necessary) to perform a route table look-up. The route retrieved from the route table identifies the destination (far) SP-SBC (SBC-SP ). The home SP-SBC (SBC-SP ) sends a new subscription request , a Presence subscription, to the SBC address retrieved from the look-up.","The presence subscription request  travels to the destination SP-SBC (SBC-SP ). Per the SIP protocol, the destination SP-SBC (SBC-SP ) returns a success response  (e.g., \u201c200 OK\u201d) back to the home SP-SBC (SBC-SP ). Since the home SP-SBC acts as a SIP back to back user agent (B2BUA), the route path is conveyed the home SP-SBC (SBC-SP ) in the record-route header of the success response . As a B2BUA, the home SP-SBC is listed in the contact header and the record route contains intermediaries if applicable. Thus, the route set described by the contact header and the record-route header forms the direct routed path ( in ) between the (far) association-originating EBC (SBC-E ) and the (near) association-accepting EBC (SBC-E ).","Each SP-SBC (SBC-SP , SBC-SP ) stores the route set learned from this exchange in its respective SIP routing table using the trunk identifier of the opposite enterprise SBC (SBC-E  or SBC-E ) as a table index. Having both SP-SBCs (SBC-SP , SBC-SP ) store the route set allows for handling of two opposing presence subscribe, which may occur if a particular enterprise prefers to be only a consumer of the service, or only a provider of the service. Finally, each DFR-E will receive a NOTIFY  with a data-block of the URIs for the given association, and updates the local registry accordingly.",{"@attributes":{"id":"p-0047","num":"0046"},"figref":["FIG. 4C","FIG. 2"],"b":["210","480","2","145","2","145","2","155","1","135","2","155"]},"At step , the home service provider SBC (SBC-SP ) receives the tagged VoIP communication and looking for the tag (cookie) that was inserted into the SIP Offer by the home enterprise SBC (SBC-E ). Presence of this tag indicates a federated communications. The home service provider SBC (SBC-SP ) does not apply normalization profiles to tagged communications, as it does to untagged communications. Thus, federated communications bypass the SP-SBC's typical normalization of codecs, etc.","The home service provider SBC (SBC-SP ) examines the SIP header of the federated communication and embeds a SIP Route header using information in the cookie which identifies the far end (target) service provider SBC and far end (target) enterprise SBC. An example Route header is: \u201c<SBC-E>; route=<SP-SBC-1>, <proxies>\u201d, where the strings within the brackets are filled in from the cookie. In some embodiments, any address information for the home enterprise SBC is hidden by the home service provider SBC (SBC-SP ) as part of the Network Address Translation topology hiding function that is performed by a conventional SBC.","At step , the far end service provider SBC (SBC-SP ) receives the SIP message containing the federated communication. The far end service provider SBC (SBC-SP ) recognizes the SIP message as a federated communication based on the cookie. The far end service provider SBC (SBC-SP ) uses the cookie to looks up the associated trunk identifier in its routing table. The far end service provider SBC (SBC-SP ) then routes the federated communication to the appropriate far end enterprise SBC (SBC-E ) with a specific tag from the routing table. Notably, the far end service provider SBC (SBC-SP ) does not apply any signaling normalizations.","At step , the far end enterprise SBC (SBC-E ) receives the federated communication. The far end enterprise SBC (SBC-E ) identifies the communication as a federated communication by the presence of the cookie. The far end enterprise SBC (SBC-E ) removes the cookie and applies a normalization profile specific to the direct routed path if applicable. Finally, the far end enterprise SBC (SBC-E ) delivers the session conveyed by the federated communication to the PBX or the SIP phone.",{"@attributes":{"id":"p-0052","num":"0051"},"figref":["FIG. 5","FIG. 2","FIG. 1","FIG. 5"],"b":["210","100"]},{"@attributes":{"id":"p-0053","num":"0052"},"figref":["FIG. 5","FIG. 5","FIG. 5","FIG. 5"],"b":["193","1","135","185","1","150","210","193","185","185","1","150"]},"As shown in , the process of creating a direct routed path  begins with the enterprise E  requesting () from service provider  an initial configuration for the SBC-E . In response, service provider  returns () an initial configuration. The enterprise E  applies this configuration to SBC-E  and creates () the enterprise end of a SIP trunk between SBC-E  and SBC-SP . Service provider  creates () the service-provider end of the same SIP trunk. As explained earlier, the SIP trunk ( and  in ) is used for some communications between SBC-E  and the SBC-SP . Thus, as illustrated here, SIP trunk can be understood as a logical construct managed by both ends (the service provider SBC and the enterprise SBC).","At some later point, which may occur in response to a request from an enterprise user, the enterprise E  joins () the federated system , providing an enterprise profile. Service provider  stores () the enterprise profile in order to make it available to other members of the federated system . The enterprise profile includes directory information for the enterprise (e.g., domains, phone numbers, URLs, etc.), trunk types, and a description of the enterprise's own communication services that will be usable by other associated enterprises (e.g., voice, video, applications, etc.) The profile may also control options such as visibility to other enterprises, auto-accept of incoming requests to associate, etc. Examples of visibility options include: make profile visible to any enterprise; make profile invisible to all enterprises; make profile visible to a specific set of enterprises. The enterprise E  also subscribes () to notifications of new confirmed associations (i.e., \u201cfriends\u201d). This subscription may take place before joining the enterprise.","Service provider  acts as an intermediary between enterprises that wish to associate with each other. Service provider  receives () a request for an association, where the request includes identifying information about the requesting enterprise. Service provider  uses information provided earlier, when the requesting enterprise joined the federated system , to perform authentication and\/or verification (). The service provider  passes () the request for association on to the target enterprise E  and the enterprise E  accepts () the request. No identifying information is needed in the acceptance, since the requesting enterprise already has information about the target enterprise before making the request for association. Next, the service provider  forwards () the acceptance to the initiating enterprise. Although a request and explicit acceptance were described, other embodiments use an auto-confirm where the service provider  accepts on behalf of the target enterprise E , without first contacting the target enterprise E .","After the association is accepted, service provider  notifies () the target enterprise E  of the new association. This notification includes additional information related to the initiating enterprise. In particular, the new association notification provides a new contact address. The enterprise E  uses this new contact address to request () information about a direct routed path  to the initiating enterprise. In response to the request, service provider  returns () direct routed path information including a target trunk identifier, a target trunk type, trunk capacity (e.g., bandwidth, number of sessions), a list of services (e.g., voice, video, etc.) and a list of addresses. Addresses are specified in terms of a domain (which may include a wildcard) and a name\/URI\/phone number.","The enterprise E  then routes calls to\/from the associated enterprise over this direct routed path  to the associated enterprise. An analogous process is followed by the initiating enterprise to obtain information about the same direct routed path , and the initiating enterprise also routes calls to\/from the associated enterprise over this direct routed path .","Having explained at a high level the operations which result in creation of a direct routed path  () between two enterprise SBCs, the operations of  will now be described in more details in .  is a block diagram illustrating the components and the channels of  in further detail, while  are sequence diagrams describing, in even more detail, how the components communicate over these channels to perform the operations of .","As shown in , each enterprise (E , E ) includes an administrative client  and an SBC (SBC-E , SBC-E ). The service provider  includes a peer service provider SBC (SBC-SP , SBC-SP ) for each enterprise SBC. Communication between administrative client  and dynamic federation system  takes place over the Internet  using a protocol other than SIP, i.e., the administrative channel is a non-SIP channel. In some embodiments, this administrative communication utilizes an HTTP channel . Communication between an enterprise SBC and its peer SBC at the service provider occurs over a SIP trunk (, ). The dynamic federation system  at service provider  includes a DFS configuration server  and a DFS registry server .",{"@attributes":{"id":"p-0061","num":"0060"},"figref":["FIG. 7","FIG. 7"],"b":["710","1","150","620","610","710"]},"At step , a SIP Notify message is sent from DFS configuration server  to the service provider SBC (SBC-SP ), indicating a change to the service provider SBC configuration. This \u201cchange\u201d actually represents the initial SBC configuration. The SIP Notify message in step  contains a SIP content-type of message\/http (i.e., message body contains HTTP headers only that returned from HTTP GET). The HTTP content-location header within the message body specifies the URL of the SBC configuration. The service provider SBC (SBC-SP ) performs an HTTP GET request to this URL, which retrieves the SBC configuration in the HTTP response body. The service provider SBC (SBC-SP ) then applies this retrieved configuration.","At step , an enterprise SBC (SBC-E ) sends a JoinEnterprise message to DFS configuration server  over the HTTP channel . Before the enterprise SBC can be configured, the service provider must be notified of the new enterprise SBC's configuration. Thus, at step  the DFS configuration server  sends another SIP Notify message to the service provider SBC. This second SIP Notify message includes information about the enterprise SBC configuration. At step , the enterprise SBC (SBC-E ) sends a SIP Subscribe message to subscribe to changes to its own configuration, and at step  the DFS configuration server  sends a SIP Notify back to the new enterprise SBC (SBC-E ), including the initial configuration for the enterprise SBC.","At step , another enterprise SBC (SBC-E ) joins federated system  by sending a JoinEnterprise message over HTTP channel . As before, the service provider is notified of the second enterprise SBC's configuration, through a SIP Notify message (step ) from the DFS configuration server  to the service provider SBC. At step , the second enterprise SBC sends a SIP Subscribe message to subscribe to changes to its own configuration. At step , the DFS configuration server  sends a SIP Notify including the initial configuration for the second enterprise SBC.",{"@attributes":{"id":"p-0065","num":"0064"},"figref":["FIG. 7","FIG. 8","FIG. 5"],"b":["610","175","175","810","193","1","135","2","193","830","193","620","610","820"]},"At step , the enterprise SBC (SBC-E ) applies the configuration retrieved in step  and creates a SIP trunk  having a specific bandwidth between the enterprise SBC (SBC-E ) and its corresponding service provider SBC (SBC-SP ). This SIP trunk  is used not only to communicate between pipe endpoints (SBC-E  and SBC-SP ), but also to communicate between the enterprise SBC (SBC-E ) and DFS configuration server , with the service provider SBC (SBC-SP ) acting as an intermediary. In particular, DFS configuration server  uses SIP trunk  to communicate an initial enterprise SBC configuration as well as changes to that configuration. A simplified version of the subscribe\/notify process was initially described in  without reference to the SIP trunk . The remainder of the process in  will now be described with reference to the SIP trunk .","At step , the enterprise SBC (SBC-E ) sends a SIP Subscribe message to DFS configuration server  over SIP trunk , subscribing to changes to its own configuration. The name and URI of the service provider SBC (SBC-SP ) was obtained from the retrieved configuration and from the GET response in step . The event package used in the SIP Subscribe message is an http-monitor event package, with a body parameter specifying that the HTTP body should be included in the subsequent notifications.","At step , a SIP Notify message is sent from DFS configuration server  to enterprise SBC (SBC-E ) over SIP trunk . The SIP Notify message contains a SIP content-type of message\/http (i.e. message body contains HTTP headers only that returned from HTTP GET), where the HTTP content-location header within the message-body-specified URL includes the initial configuration for the enterprise SBC.",{"@attributes":{"id":"p-0069","num":"0068"},"figref":["FIG. 9","FIG. 5","FIG. 9"],"b":["1","135","2","145","910","920","1","135","2","145","630","175"]},"The enterprise join and subscribe to new associations processes of  will now be described in more detail in connection with the sequence diagrams of , respectively. At step , an enterprise user operating administrative client  causes the enterprise to join the federation by publishing an enterprise profile. The join\/publish is accomplished by administrative client  accessing a web page stored on DFS registry server , where this access occurs over HTTP channel . In creating the profile, the user defines configuration options, such as whether requests to associate will be automatically accepted, whether or not the profile is visible to other enterprises, etc. The user also describes the enterprise, for example, reachable domain(s), reachable names\/numbers, trunk types, and services (voice, video, apps, etc).","At step , DFS registry server  responds to the web page edits by creating, or \u201cpublishing,\u201d a profile entry in the DFS registry. This publication makes the enterprise's trunk public, in accordance to defined visibility rules if applicable. The owner of the DFS registry (e.g. the service provider) may have policy controls over which enterprises are allowed to join the enterprise. The enterprise and\/or the registry owner may control visibility of the enterprise profile. The shared information in the profile is includes Trunk Identifiers (TID) as well as trunk Types\/Services\/domains\/addresses as provided by the enterprise user. The trunk bandwidth and\/or sessions entered by the user are limited to negotiated levels.",{"@attributes":{"id":"p-0072","num":"0071"},"figref":"FIG. 11","b":["1110","1","135","630","175","1120","630"]},"Once an enterprise has published its profile and enabled new associations, another enterprise can request an association (i.e., \u201cfriend\u201d the first enterprise).  is a sequence diagram describing an overview of the association process. At step , a user at enterprise E  (the \u201cinitiating enterprise\u201d) operates administrative client  to initiate request for association (i.e., a \u201cfriend\u201d request) to the DFS registry server  over HTTP channel . At step , DFS registry server  forwards the request for association to enterprise E  (the \u201ctarget\u201d enterprise) over HTTP channel . Instead of an HTTP transaction, DFS registry server  may use other mechanisms, such as email, SMS, etc. At step , a user at enterprise E  (via administrative client  and administrative server) interacts with the DFS registry server  to indicate that the request for association has been accepted. The DFS registry server  may keep track of \u201cfriend\u201d requests for some period of time.",{"@attributes":{"id":"p-0074","num":"0073"},"figref":["FIGS. 13A-C","FIG. 13A"],"b":["1310","1","105","630","610","630","1320","1","105","1330","630","2","110","610","1340","2","110","630","1330","1340"]},"At this point, an enterprise-to-enterprise association has been requested, accepted, and confirmed. Moving on to , at step  DFS registry server  updates the registry with the newly created association between initiating enterprise E  and target enterprise E . At step , DFS registry server  sends a SIP Notify message over SIP trunk  to initiating enterprise E , notifying the enterprise of the new association. At step , DFS registry server  also sends a SIP Notify message to target enterprise E  over a corresponding SIP pipe (not shown). Each SIP Notify includes an identifier for the associated (\u201cfriended\u201d) enterprise and trunk. However, the trunk identifier is only visible to the service provider SBC which the endpoint of the SIP pipe. The service provider SBC then strips the trunk identifier. The route set in the SIP Notify includes a contact address and\/or fully qualified domain name for DFS registry server , which the enterprise SBC will use to obtain information about a direct routed path to the associated enterprise SBC.","Moving on to , at step  the enterprise SBC (SBC-E ) sends another SIP Subscribe to the service provider SBC over its SIP trunk . In some embodiments, this second Subscribe has a limited lifespan and expires upon a corresponding SIP Notify. The Subscribe in step  includes the contact address of the DFS registry server , obtained from the route set of the previous SIP Notify (step  in ). Receipt of the SIP Subscribe with the contact address triggers the service provider SBC to send a SIP Notify to DFS registry server . At step  DFS registry server  sends a SIP Notify to service provider SBC, where this second notify includes a data block with information about a direct routed path to the associated enterprise SBC. The service provider SBC (SBC-SP ) examines the SIP Notify received from DFS registry server  and strips headers off as appropriate. At step  the service provider SBC (SBC-SP ) sends a SIP Notify including the same data block to the enterprise SBC over the SIP trunk . The SIP Notify sent at step  allows the enterprise SBC (SBC-E ) to determine a directed routed path ( in ) to the associated SBC located in another enterprise (SBC-E ).","In some embodiments, explained in more detail below, an enterprise SBC learns the direct routed path  to the associated SBC by examining the various SIP Notify messages that it receives in the process of  and obtaining the routes traversed by these messages. By examining the traversed routes, the enterprise SBC can learn the associated SBC's target trunk identifier, a target trunk type, trunk capacity (e.g., bandwidth, number of sessions), a list of services (e.g., voice, video, etc.) and a list of addresses. Addresses are specified in terms of a domain (which may include a wildcard) and a name\/URI\/phone number. In other embodiments, the data block itself describes direct routed path  to the associated SBC, by including a target trunk identifier, a target trunk type, trunk capacity (e.g., bandwidth, number of sessions), a list of services (e.g., voice, video, etc.) and a list of addresses.","At the completion of step , the target enterprise SBC (SBC-E ) now has information about the associated enterprise SBC (SBC-E ). Furthermore, since this process is symmetrical and repeated for both enterprise SBCs, the initiating enterprise SBC also learns about the target enterprise SBC. When a user of one enterprise makes a call to an associated enterprise, the originating enterprise SBC routes the call over the direct routed path to the associated enterprise as follows.","The enterprise SBC scans its route table for the longest match. If this scan identifies a matching number for a direct routed path, then that call is routed over that direct routed path. The specific Route-URI obtained is included in the SIP Offer and sent towards the service provider SBC. Some implementations may use a unique tag to help identify this as a direct routed path session. The service provider SBC receives the SIP Offer. If the tag is present, the service provider SBC may manipulate the Route-URI in order to hide topology information between the Enterprises for security reasons. The service provider SBC on the offering side of the call sends the SIP Offer directly to the service provider SBC that is associated with (connected to) the answerer associated enterprise. The service provider SBC for the answerer may strip specific information to hide topology. The service provider SBC for the answerer delivers the session to the enterprise SBC for the answer, over the specific Trunk-ID for that direct routed path. In this manner, specific SIP sessions\u2014which have been approved and opted-in types of communication established over the dynamic federation\u2014are identified, and these specific SIP sessions are routed in a direct manner so that the service provider's signaling infrastructure is avoided (offloaded). Avoiding the signaling infrastructure ensures that no signaling manipulation performed, where such manipulation may preventing the use of advanced IP telephony services.",{"@attributes":{"id":"p-0080","num":"0079"},"figref":["FIG. 14","FIG. 14"],"b":["100","1400","1410","1420","1430","1440","1450","1460"]},"The components of federated system  that are described herein can be implemented in software (i.e., instructions executing on a processor).  depicts a software implementation, with memory  storing dynamic federation system logic . One or more components of dynamic federation system  can also be implemented in specialized hardware logic. Hardware implementations include (but are not limited to) a programmable logic device (PLD), programmable gate array (PGA), field programmable gate array (FPGA), an application-specific integrated circuit (ASIC), a system on chip (SoC), and a system in package (SiP). Persons of ordinary skill should also appreciate that these components may be implemented using any combination of hardware and software.","In some embodiments of federated system , the software-implemented dynamic federation system logic  is stored on a computer-readable medium, which in the context of this disclosure refers to any structure which can contain, store, or embody instructions executable by a processor. The computer readable medium can be based on electronic, magnetic, optical, electromagnetic, infrared, or semiconductor technology. Specific examples of a computer-readable medium using electronic technology include (but are not limited to) the following: a random access memory (RAM); a read-only memory (ROM); and an erasable programmable read-only memory (EPROM or Flash memory). Specific examples using magnetic technology include (but is not limited to) a disk drive; and a portable computer diskette. Specific examples using optical technology include (but are not limited to) a compact disk read-only memory (CD-ROM) or a digital video disk read-only memory (DVD-ROM).","Any process descriptions or blocks in flowcharts would be understood as representing modules, segments, or portions of code which include one or more executable instructions for implementing specific functions or steps in the process. As would be understood by those of ordinary skill in the art of the software development, alternate implementations are also included within the scope of the disclosure. In these alternate implementations, functions may be executed out of order from that shown or discussed, including substantially concurrently or in reverse order, depending on the functionality involved.","The foregoing description has been presented for purposes of illustration and description. It is not intended to be exhaustive or to limit the disclosure to the precise forms disclosed. Obvious modifications or variations are possible in light of the above teachings. The implementations discussed, however, were chosen and described to illustrate the principles of the disclosure and its practical application to thereby enable one of ordinary skill in the art to utilize the disclosure in various implementations and with various modifications as are suited to the particular use contemplated. All such modifications and variation are within the scope of the disclosure as determined by the appended claims when interpreted in accordance with the breadth to which they are fairly and legally entitled."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Many aspects of the disclosure can be better understood with reference to the following drawings. The components in the drawings are not necessarily to scale, emphasis instead being placed upon clearly illustrating the principles of the present disclosure.",{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0008","num":"0007"},"figref":["FIGS. 3A-C","FIG. 1"]},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIGS. 4A-4C"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":["FIG. 6","FIG. 5"]},{"@attributes":{"id":"p-0012","num":"0011"},"figref":["FIG. 7","FIG. 5"]},{"@attributes":{"id":"p-0013","num":"0012"},"figref":["FIG. 8","FIG. 5"]},{"@attributes":{"id":"p-0014","num":"0013"},"figref":["FIG. 9","FIG. 5"]},{"@attributes":{"id":"p-0015","num":"0014"},"figref":["FIG. 10","FIG. 5"]},{"@attributes":{"id":"p-0016","num":"0015"},"figref":["FIG. 11","FIG. 5"]},{"@attributes":{"id":"p-0017","num":"0016"},"figref":["FIG. 12","FIG. 5"]},{"@attributes":{"id":"p-0018","num":"0017"},"figref":["FIGS. 13A-C","FIG. 12"]},{"@attributes":{"id":"p-0019","num":"0018"},"figref":["FIG. 14","FIG. 1"]}]},"DETDESC":[{},{}]}
