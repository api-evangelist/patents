---
title: Method for establishing a secure logical connection between an integrated circuit card and a memory card through a terminal equipment
abstract: A user system includes terminal equipment, a removable integrated circuit card and a removable memory card configured to cooperate with the terminal equipment, a card link application provided in the integrated circuit card to establish and manage a secure logical connection between the integrated circuit card and the memory card through the terminal equipment, and an application programming interface provided in the terminal equipment to receive and execute commands from the card link application and to cooperate with the card link application to establish the secure logical connection between the integrated circuit card and the memory card through the first terminal equipment.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09055605&OS=09055605&RS=09055605
owner: TELECOM ITALIA S.P.A.
number: 09055605
owner_city: Milan
owner_country: IT
publication_date: 20041029
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS REFERENCE TO RELATED APPLICATION","TECHNICAL FIELD OF THE INVENTION","BACKGROUND ART","OBJECT AND SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF PREFERRED EMBODIMENTS OF THE INVENTION"],"p":["This application is a national phase application based on PCT\/EP2004\/052728, filed Oct. 29, 2004, the content of which is incorporated herein by reference.","The present invention relates to a method for establishing a secure logical connection between an integrated circuit card and a memory card through a terminal equipment.","As is known, services supported by next generation user terminal equipments, such as personal digital assistants, mobile phone, smart phones or laptops connected to wireless local area networks (WLANs), allow users to access high value-added contents in the network and also to exchange sensitive information in commercial transactions and in many other applications now accessible to mobile users.","A terminal equipment is generally provided with a removable integrated circuit card which manages security, communication features and transactions, and, optionally, with a removable memory card with a large memory size, such as a multimedia card, a secure Digital\u2122 input\/output card, a memory Stick\u2122 card etc., which allows the user to store music, videos, games and personal data.","Presently, a terminal equipment controls the integrated circuit card and the memory card through separate physical and logical channels, and acts on these peripherals as a master in order to perform services which exploit their features separately, i.e. the terminal equipment keeps always the control of the communication and does not permit the direct communication between these peripherals.","An example of such a terminal equipment can be a mobile phone which uses a subscriber identity module (SIM) card in order to access the GSM mobile communication network, and a multimedia card to store music, videos, and games. The mobile phone exchanges data with the SIM card through a standard interface defined in the 3GPP TS 51.011 and can receive commands from the SIM card thanks to a proactive interface defined in the 3GPP TS 51.014. This standard describes the physical and the logical channels between the mobile phone and the SIM card, but does not provide any link with the multimedia card; the latter is in fact accessible only by the application which runs on the mobile phone and there isn't no way for the SIM card to reach it.","Some examples of a terminal equipment which uses a number of cards to exploit their features separately are disclosed in EP-A-1 278 154, U.S. Pat. No. 6,012,634, U.S. Pat. No. 6,216,015, US 2002\/016500, and WO 02\/067611.","In particular, EP-A-1 278 154 discloses a Multifunction integrated circuit card having the form factor of a multimedia card or a secure Digital\u2122 card and including a card substrate provided with terminals arranged in two rows in a zigzag fashion, and a memory card and a SIM card mounted on the card substrate and exclusively connected to predetermined terminals. The memory card and the SIM card are separately provided with areas for storing secrete codes for security, so that the multifunction integrated circuit card is capable of implementing multifunction facilities different in security level.","U.S. Pat. No. 6,012,634 discloses a smart card which can communicate with both a smart-card-compatible device and a memory-card-compatible device. The smart card includes a processor which performs smartcard functions and a memory for use with a memory card device connection which allows operation of the memory-card-compatible device. Cellular telephones facilitate the use of two types of cards therein.","U.S. Pat. No. 6,216,015 discloses a wireless subscriber unit which includes a memory manager capable of communicating with a plurality of smart cards. The memory manager is programmed to allocate a memory segment to each smart card when it is operatively connected to an interface of the wireless subscriber unit. The memory manager communicates with the smart card to update data stored in the memory segment.","US 2002\/0165008 discloses a mobile phone wherein private data stored in its internal memory are erased when the SIM card is pulled out. Before being erased, the private data are encrypted and transferred to and stored into an external memory. The encrypted private data stored into the external memory can be reused when the SIM card is used in another mobile telephone.","WO 02\/067611 discloses a method for administrating a SIM card inserted in a main smart card reader of a mobile phone of the type including a second smart card reader, using an additional administrator smart card temporarily inserted in this second smart card reader. The administrator smart card includes at least one specific loader applet and one or more files corresponding to the applets which can be loaded in the SIM card under the control of the loader. The administrator card complies with the SIM toolkit standard. The method can also be used to carry out the deletion, modification and various operations on data or applets present in the SIM card: display, determination of the memory space, etc.","The fact that terminal equipments control the integrated circuit card and the memory card through separate physical and logical channel is a great bar to the development of new services based on scenarios where the service provider is the owner of both the integrated circuit card and the memory card, and the commercial success of which services mainly depends on their independence from the processing capabilities of the terminal equipments.","The aim of the present invention is therefore to provide a method for establishing a secure logical connection between an integrated circuit card and a memory card through a terminal equipment.","This aim is achieved by the present invention in that it relates to a user system, as defined in claim , and to a method for establishing a secure logical connection between an integrated circuit card and a memory card through a terminal equipment, as defined in claim .","The present invention meets the aforementioned needs because the integrated circuit card acts as master in the communication with the memory card, and may open and close a logical channel with the memory card and perform commands on it. Therefore, an application which runs inside the integrated circuit card may set the communication with the memory card asking the terminal equipment for a physical connection with it, and an application programming interface on the terminal equipment interprets the integrated circuit card requests and performs the adaptation to the different physical layers. The application which runs on the integrated circuit card may also cipher or sign data in order to avoid any intrusion in or modification of the terminal equipment.","The following discussion is presented to enable a person skilled in the art to make and use the invention. Various modifications to the embodiments will be readily apparent to those skilled in the art, and the generic principles herein may be applied to other embodiments and applications without departing from the spirit and scope of the present invention. Thus, the present invention is not intended to be limited to the embodiments shown, but is to be accorded the widest scope consistent with the principles and features disclosed herein and defined in the attached claims.",{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 1"},"The integrated circuit card exploits a consolidate technology used in many integrated circuit technology (ICT) fields such as telecommunication, banking, identification, e-commerce, etc. They are well standardized in their intersector features (ISO\/IEC 7816 standards series) and in their sector based features (for example ETSI and 3GPP standards for telecommunication). Presently, an integrated circuit card is based on a 32-bit central processing unit and can exploit till 8 Kbytes of RAM, 300 Kbytes of ROM and 128 Kbytes of EEPROM. Some integrated circuit cards based on flash memory have also been proposed and can provide till 1 Mbyte of non volatile memory.","The memory card can be found in many formats and technologies. The most common are: compact Flash\u2122 card, smart Media\u2122 card, memory Stick\u2122 card, multimedia card, and secure Digital\u2122 card, the memory size of which can vary from 8 Kbytes to 1 GByte.","The integrated circuit card communicates with the terminal equipment through a standard integrated circuit card interface (ISO\/IEC 7816-3 electrical interface and transmission methods for asynchronous communication through T=0 and T=1 protocols; ISO\/IEC 7816-10 electrical interface and transmission methods for synchronous cards; ISO\/IEC 7816-12 electrical interface and transmission methods for universal serial bus (USB) cards), and uses an application protocol data unit (APDU) (ISO\/IEC 7816-4 interindustry commands; ISO\/IEC 7816-8 security operation commands; ISO\/IEC 7816-9 card management commands) in order to exchange commands with terminal equipment.","The memory card communicates with the terminal equipment through its proprietary protocol which depends on the memory card type (i.e. multimedia card, secure Digital\u2122 card, memory Stick\u2122), and may be of the type either with or without a microprocessor, both available on the market.","The user system further includes a card link application, hereinafter referred to as MC_Link, which is a software module stored in and running on the integrated circuit card and having the aim to set up and manage a secure logical connection between the integrated circuit card and the memory card, and an application programming interface (API), hereinafter referred to as MC_Link_API, which is a software stored in and running on the terminal equipment and having the aim to interpret the MC_Link requests and to adapt and\/or forward the data which comes from the integrated circuit card to the memory card interface and vice versa. In particular, in the former case (adaptation and forwarding), the MC_Link sends to the MC_Link_API the instruction for the memory card, and the MC_Link_API codes the instruction in the memory card protocol, whereas in the latter case (only forwarding) the MC_Link sends to the MC_Link_API the command for the memory card, and the MC_Link_API forwards the command without change its coding.","The MC_Link provides the other software applications running on the integrated circuit card with a protocol to interact with the memory card. In particular, the MC_Link provides the other applications with the following functions:\n\n","The algorithm used to cipher and decipher data depends on the implementation of the MC_Link, and for example my be a DES or 3DES algorithm or a proprietary algorithm.","In addition, the MC_Link exchange data and commands with the MC_Link_API in order to reach the memory card on the terminal equipment. In particular, the MC_Link performs the following functions:\n\n","In response to the command, the MC_Link_API checks the status of the memory card reader(s) and sends the information to the integrated circuit card.\n\n","In response to the command, the MC_Link_API checks the memory card capabilities in terms of memory size, file system, security and sends the information to the integrated circuit card;\n\n","Upon receiving a command, the MC_Link_API interprets and executes it, receives the memory card response relating to the execution of the command and sends it to the integrated circuit card. The MC_Link_API also manages errors reported by memory card and send them to the integrated circuit card.",{"@attributes":{"id":"p-0038","num":"0079"},"figref":"FIG. 2"},"In particular:\n\n","The cases related to the other memory card commands are similar to that previously described, the only difference lying in the memory card command sent by the MC_Link to the MC_Link_API within the \u201cPerform MC Command\u201d.",{"@attributes":{"id":"p-0041","num":"0086"},"figref":"FIG. 3"},"In this application, a SIM toolkit applet (STK) uses the functions provided by the MC_Link to write data in and read data from the multimedia card. The MC_Link may for example be developed in java card language and provides the SIM toolkit applet with the class and the methods for writing and reading the memory card. The SIM toolkit applet simply uses this methods without knowing which type of memory card is inserted in the mobile phone. The MC_Link running on the SIM card communicates with the MC_Link_API running on the mobile phone by means of a SIM application toolkit (SAT), which is a set of commands defining how a card interacts with an Handset and extends the communication protocol between the card and the handset. With the SIM application toolkit, the card has a proactive role in the Handset, which means that the SIM card initiates commands independently of the handset and the network. In 2G networks, the SIM application toolkit was defined in 3GPP 51.014 standard.","In particular, in order to write data in the memory card inserted in the mobile phone:\n\n","In a similar way, in order to read data from the memory card:\n\n",{"@attributes":{"id":"p-0045","num":"0096"},"figref":"FIG. 4"},"Initially, the mobile phone sends to the SIM card a command \u201cTerminal Profile\u201d (arrow ), which contains information for the SIM card about the SIM application toolkit capabilities of the mobile phone. The SIM card can answer with a status word \u201c9000\u201d, which means that the command has been executed, or \u201c91XX\u201d, which means that the command has been executed and that the SIM card has to send to the mobile phone a proactive command XX long (arrow ).","When the SIM card sends to the mobile phone a status word \u201c91XX\u201d, the mobile phone sends to the SIM card a command \u201cFetch\u201d to retrieve the proactive command from the SIM card (in the example shown a set up menu) (arrow ), and the SIM card sends to the mobile phone the set up menu and a status word \u201c9000\u201d (arrow ).","The mobile phone adds the menu contained in the set up menu to the mobile phone menu and then sends to the SIM card a command \u201cterminal response\u201d to acknowledge the proactive command (arrow ). The SIM card then responds with a status word \u201c9000\u201d (arrow ).","Then, the mobile phone sends a command \u201cEnvelope\u201d containing the user menu selection which triggers some actions inside the SIM card (arrow ), and the SIM card sends a status word \u201c91xx\u201d (arrow ).","The communication between the mobile phone and the SIM card then goes on with the sending of another command \u201cFetch\u201d from the mobile phone to retrieve another proactive command from the SIM card.","According to the invention, the SIM application toolkit also includes the previously described four new commands, i.e., \u201cOpen MC\u201d, \u201cClose MC\u201d, \u201cGet Terminal Capabilities\u201d, and \u201cGet MC Capabilities\u201d. To do so, the SIM card is designed to implement the four new commands, and the mobile phone is designed to interpret and execute the four new commands and to send the corresponding terminal responses and a command \u201cTerminal Profile\u201d including information relating to the management of the memory card (memory card reader number and memory card already inserted).","In particular:\n\n","The MC_Link_API interprets the command and performs the corresponding action on the memory card. The terminal response must eventually contain the data read by the SIM card. It's response may be:\n\n",{"@attributes":{"id":"p-0054","num":"0131"},"figref":"FIG. 5"},"Before the sequence shown in , when the user turns on the mobile phone, during the activation sequence the mobile phone sends to the SIM card the command \u201cTerminal Profile\u201d which contains all the information the MC_Link needs to manage the memory card, namely the number of memory card readers and the number of memory cards inserted.","When the SIM toolkit applet asks the MC_Link to perform an operation on the memory card (read, write or erase), it uses the appropriate function provided by the MC_Link.","Considering the case of writing cipher data on the memory card and of reading them afterwards, the SIM toolkit applet uses the function \u201cWrite Cipher Data\u201d to ask the MC_Link to cipher and write data on the memory card.","At this point, the MC_Link starts to set up the link with the memory card. In particular:\n\n","Then, the SIM toolkit applet uses the function \u201cRead Cipher Data\u201d to ask the MC_Link to read and decipher data from the memory card. In particular:\n\n","The present invention may also be applied to scenarios where it is needed to establish a secure logical connection between an integrated circuit card and a memory card removably inserted in different terminal equipments. Practical examples of these scenarios may be a mobile phone with a SIM card which wants to read data from and write data in a memory card in a personal digital assistant (PDA), or a mobile phone with a SIM card which wants to copy pictures from a memory card in a digital photo camera and to send them through multimedia messages (MMS).","In similar scenarios, schematically shown in , the two TEs, designate by TE and TE, are provided with respective MC_Link_API, designated by MC_Link_API_ and MC_Link_API_, which communicates through appropriate wireless or wired interfaces, designated by IF and IF, such as IrDA (Infrared Data Association), Bluetooth, USB, or others. In this case, when the MC_Link_API_ in the TE receives a command from the MC_Link in the integrated circuit card, it reads the memory card reader number in order to find out whether the command is for a memory card in the TE or in the TE. In the former case, the MC_Link_API1 operates as described above, i.e., interprets and executes the command on the memory card inserted therein, whereas in the latter case, the MC_Link_API_ sends the command to the MC_Link_API_ in the TE, which interprets and executes the command on the memory card inserted therein.","Similarly, the MC_Link_API_ in the TE checks the \u201cterminal response\u201d from the memory card in order to find out whether it is for a SIM card in the TE or in the TE. In the former case, the MC_Link_API_ in the TE operates as described above, i.e., sends the \u201cterminal response\u201d to the integrated circuit card inserted therein, whereas in the latter case the MC_Link_API_ sends the \u201cterminal response\u201d to the MC_Link_API_ in the TE, which sends it to the SIM card inserted therein.","The present invention may also be applied to scenarios where the memory card is the master and the integrated circuit card is the slave, i.e., where the MC_Link runs on the memory card. To do so, the memory card has necessarily to be of the type with a microprocessor. Practical examples of these scenarios may be an application running on the memory card which wants to update some data and needs to be connected with a remote server. In this scenario, the memory card asks the SIM card to set up a connection over the air (OTA) with the remote server in order to retrieve the data, and after the memory card reads the data on the SIM card.","Finally, it is clear that numerous modifications and variants can be made to the present invention, all falling within the scope of the invention, as defined in the appended claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["For a better understanding of the present invention, a preferred embodiment, which is intended purely as an example and is not to be construed as limiting, will now be described with reference to the attached drawings, wherein:",{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 6"}]},"DETDESC":[{},{}]}
