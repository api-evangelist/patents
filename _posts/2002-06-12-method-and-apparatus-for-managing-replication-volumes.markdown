---
title: Method and apparatus for managing replication volumes
abstract: Replication of volumes is facilitated by tools which provide and manage a pool of mirror volumes. Primary (or production) volumes containing user provided data are easily mirrored by volumes selected from the pool. User criteria can be provided to limit the selection of candidate volumes for mirroring.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=06925541&OS=06925541&RS=06925541
owner: Hitachi, Ltd.
number: 06925541
owner_city: 
owner_country: JP
publication_date: 20020612
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS-REFERENCES TO RELATED APPLICATIONS","STATEMENT AS TO RIGHTS TO INVENTIONS MADE UNDER FEDERALLY SPONSORED RESEARCH OR DEVELOPMENT","REFERENCE TO A \u201cSEQUENCE LISTING,\u201d A TABLE, OR A COMPUTER PROGRAM LISTING APPENDIX SUBMITTED ON A COMPACT DISK","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DESCRIPTION OF THE SPECIFIC EMBODIMENTS"],"p":["NOT APPLICABLE","NOT APPLICABLE","NOT APPLICABLE","The present invention relates to data storage systems and in particular to management of replication (\u201cmirror\u201d) volumes in a data storage system.","A data processing system in an enterprise typically requires a large amount of data storage. Customer data and data generated by users within the enterprise, occupy a great portion of this data storage. Any loss or compromise of such data can be catastrophic and severely impact the success of the business. Robust data processing systems provide back-up copies of the data to prevent such loss. To further protect the data, some data processing systems extend the practice of making back-up copies to provide disaster recovery. In disaster recovery systems, a back-up copy of the data is kept at a site remote from the primary storage location (sometimes referred to herein as a \u201cproduction\u201d storage location, or the like to reflect the nature of the data, i.e. production data, that is being stored). If a disaster strikes the primary storage location, the data can be recovered from the back-up copies located at the remote site.","A known method of providing disaster protection is to mirror, or shadow, the primary storage data at a remote storage site. Remote dual copy, or remote data duplexing, is one form of this data mirroring solution. In remote dual copy, remote storage devices are provided in the data processing system so that a copy of the primary data is written to an remote storage device. Storage devices are coupled together to form duplex pairs, each duplex pair consisting of a primary storage device and a secondary storage device. When data is written to the production volume (also referred to as \u201cprimary storage device\u201d), the data processing system automatically copies the data to the mirror volume (or, \u201csecondary storage device\u201d). The mirror volume contains an exact physical image, or mirror, of the production volume. Typically, the production volume and the mirror volume have the same physical geometry, being configured and formatted in the same way as the production volume.","It is worth noting that \u201clocal\u201d mirroring is also used for backup and recovery purposes, where the mirror volumes are located locally with the primary volume. Typically, local mirroring is used for backup and recovery, while remote mirroring is used for disaster recovery. Comparing to conventional tape backup, local mirroring is much faster but more expensive.","As the data storage capacity of an enterprise grows, storage administrative tasks become more complicated and more critical. Defining (or allocating) a new volume in a storage system is one of the most important tasks for storage administration in order to keep up with the data demands of the enterprise. As the data storage system increases so too does the complexity of a data storage manager subsystem for managing the primary (\u201cproduction\u201d) storage volumes and the backup mirror volumes. However in a large data storage facility, it can be rather difficult to select a volume to be mirrored, because:","The candidate mirror volume must not be in use.","The candidate mirror volume should be selected appropriately, for example,\n\n","After a user finds a volume for a mirror, the user has to perform an operation referred to as \u201ccreating a mirror;\u201d i.e. to initiate a mirroring operation between the primary volume and the mirror volume. This can be achieved in a command line interface, for example, by entering or otherwise specifying a command like:\n\n","Typing the command above would take time if the user has to create many mirrors. For example, in a real world setting, databases that consume more than several hundred gigabytes of storage are common; image and video databases can consume on the order of terabytes of storage. Typical implementations of such large storage facilities may require many tens to hundreds of production volumes. For example, a 50 volume configuration would require typing in the following 50 commands:",{"@attributes":{"id":"p-0014","num":"0018"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"154pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"createmirror vol1 vol2"]},{"entry":[{},"createmirror vol3 vol4"]},{"entry":[{},"createmirror vol5 vol6"]},{"entry":[{},". . ."]},{"entry":[{},"createmirror vo199 vol100"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}}}},"Applications which have large associated data objects (\u201capplication objects,\u201d \u201cdata sets,\u201d etc.) can benefit from mirroring techniques. One class of applications are database applications, where the associated data objects can span over multiple volumes in a large database. For example, a data object such as an instance of a database (an Oracle\u00ae database, for example) may comprise a multiplicity of data files that can be deployed across many primary volumes. In order to assure data recovery, the primary volumes which collectively store the data object should be mirrored. Since a database application can define many instances of a database, it might be desirable from a system management point of view to be able to mirror only those physical volumes which store a particular instance of a database.","Another class of applications sometimes referred to as a Logical Volume Manager (LVM), such as VxVM\u00ae produced and sold by Veritas Software Corporation, provide users with a logical view of the underlying and typically disparate collection of physical primary volumes. Again, error recovery can be provided by mirroring the primary volumes. Since, multiple logical volumes can be defined on the primary volumes, it might be desirable to be able to mirror only those primary volumes which constitute a particular logical volume. Thus for this type of software, the \u201cdata object\u201d would be the logical volume presented to the user.","U.S. Pat. Nos. 5,459,857 and 5,544,347 disclose remote mirroring technology. Two disk systems at separate locations are connected a by remote link. The local disk system copies data on a local disk when pair creation is indicated. When a host updates data on the disk, the local disk system transfers the data to the remote disk system through the remote link. Thus no host operation is required to maintain a mirror of two volumes.","U.S. Pat. No. 5,933,653 discloses types of data transferring methods between the local and remote disk systems. In a synchronous mode transfer, the local disk system transfers data to the remote disk system before completing a write request from a host. In a semi-sync mode, the local disk system completes a write request and then transfers the write data to the remote disk system. Succeeding write requests are not processed until finishing the previous data transfer. In an adaptive copy mode, pending data to the remote disk system is stored in a memory and transferred to the remote disk system when the local disk system and\/or remote links are available for the copy task.","Embodiments in accordance with the present invention include a method and apparatus for providing a volume pool. One or more mirror volumes are selected from the volume pool to perform mirroring of user-specified primary (production) volumes. The specific mirror volumes are not specified by the user, which can be a human user or a machine user. The user can specify primary volumes by referencing an application and an associated data object. The user can specify a volume pool from which mirror volumes are selected. The present invention is applicable to local mirroring configurations and to remote mirroring configurations.",{"@attributes":{"id":"p-0029","num":"0033"},"figref":["FIG. 1","FIG. 1"],"b":["10","100","101","102","103","121","120","123","130"]},"The VPM server  can be any appropriately configured server machine. Typically, the server is a computing device having conventional components such as a CPU (or a multiple CPU configuration), dynamic memory, mass storage capability, and other appropriate hardware components. Alternatively, the server machine can comprise a distributed computing architecture. Still other known architectures might be appropriate, depending on factors such as anticipated system load, performance criteria, and so on.","Software components executing on the VPM server  can include an appropriate operating system suitable for servers, such a UNIX OS, and the application software components which collectively provide various functions in accordance with the present invention. The software components can include software modules which comprise machine code, compiled from some high level programming language source code. Software modules can also be interpreted code, for example, Unix shell scripts and the like.","The client machine , likewise, can be any appropriate computing machine. The VPM user interface  provides a conduit for exchanging information relating to volume pool management between the external environment and the data storage system . The VPM user interface can be a single software module which provides the functionality of the present invention. Alternatively, the VPM user interface can be a collection of compiled code, shell scripts, and the like which cooperatively provide the functions according to the invention.","The VPM user interface  can manifest itself in any form that facilitates the exchange of management-related information between the external environment and the data storage system . For example, the VPM user interface can be a simple command line interface (CLI) presented on a video terminal device as the I\/O device . Similarly, the VPM user interface can be a graphical user interface (GUI) displayed on an appropriate display device, presenting various graphical elements to allow a user to interact with the data storage management system. In the cases of a CLI and a GUI, the information exchange is typically going to be with a human user as the external environment. However, it is well within the scope of the invention that the external environment can be a machine \u201cuser.\u201d An appropriate machine interface can be provided to operatively couple the VPM user interface to another machine, or software component. An appropriate application programming interface (API) can be defined to allow administration type software to interact with the VPM user interface, for example. As another example of a machine interface, the I\/O device  can be a communication channel for communicating with an external machine via an appropriate digital signaling protocol or analog signaling protocol.","The data storage system  further includes one or more application servers . These can be servers not unlike the VPM server , comprising a single computing device and appropriate supporting hardware, or a multi-computing architecture. Communication channels  between the VPM server and the application servers can be provided by any of a number of known conventional techniques. The communication channel can be an intranet connection (via ethernet, for example), a wide-area network connection, and so on.","An application server  is a conventional server which provides various services for users. For example, an application commonly found in a large enterprise is a database application. Another application can be a logical volume manager which provides a mapping between physical volumes and logical volumes, providing a user with a view of the storage system absent the details of the underlying physical storage structure. Depending on the business, other applications might also be provided.","One or more VPM agents  provide certain information about the applications running on one or more application servers , and communicate this information to the VPM server . In accordance with one embodiment of the invention, there is a VPM agent  associated with each application server, though the correspondence between VPM agent and application server can be other than a one-to-one relation.","The information of interest identifies the primary volumes on which instantiations of data sets of an application are stored. A data set (also referred to as application objects and data objects) is an abstract notion which refers to those files which are related to an \u201cobject\u201d defined by an application. For example, an instance of a database in a database application would be the \u201cdata object\u201d or \u201capplication object\u201d and typically might comprise a variety of files which can be stored across multiple primary volumes. As another example, a logical volume presented to a user by logical volume management software would be the \u201cdata object.\u201d A logical volume may comprise storage space provided by one or more primary volumes. Mapping information provided by a VPM agent  identifies or otherwise indicates those primary volumes on which the data object(s) of interest are stored.","Each application can provide the mapping information in its own way. For example, many typical applications have system utilities for accessing this and other administration-type information. An appropriately configured VPM agent  can interact with the application to access the mapping information. Other applications may store the mapping information in a configuration table that is stored in a file. In that case, an appropriately configured VPM agent can be created to obtain the information by simply parsing through the contents of the file.","As an example, the database application Oracle\u00ae can provide primary volume information for a database instance. Thus, the VPM Agent  can obtain tablespace information by issuing the following SQL statements:",{"@attributes":{"id":"p-0040","num":"0044"},"tables":{"@attributes":{"id":"TABLE-US-00002","num":"00002"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"21pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"196pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"SQL> SELECT t.name \u201cTablespace\u201d, f.name \u201cDatafile\u201d"]},{"entry":[{},"2> FROM v$tablespace t, v$datafile f"]},{"entry":[{},"3> WHERE t.ts# = f.ts#"]},{"entry":[{},"4> ORDER BY t.name;"]},{"entry":[{},"Tablespace Datafile"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}}},"br":{}},{"@attributes":{"id":"p-0041","num":"0045"},"tables":{"@attributes":{"id":"TABLE-US-00003","num":"00003"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"168pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"SYSTEM \/vobs\/oracle\/dbs\/tbs_01.f"]},{"entry":[{},"SYSTEM \/vobs\/oracle\/dbs\/tbs_02.f"]},{"entry":[{},"SYSTEM \/vobs\/oracle\/dbs\/tbs_03.f"]},{"entry":[{},"TBS_1 \/vobs\/oracle\/dbs\/tbs_11.f"]},{"entry":[{},"TBS_1 \/vobs\/oracle\/dbs\/tbs_12.f"]},{"entry":[{},"TBS_2 \/vobs\/oracle\/dbs\/tbs_21.f"]},{"entry":[{},"TBS_2 \/vobs\/oracle\/dbs\/tbs_22.f"]},{"entry":[{},"TBS_2 \/vobs\/oracle\/dbs\/tbs_23.f"]},{"entry":[{},"TBS_2 \/vobs\/oracle\/dbs\/tbs_24.f"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}}},"br":{}},"Continuing with , the data storage system also includes storage subsystems . The configuration shown in the figure is just one of many conventionally used storage configurations. Here, each application server  has its own storage subsystem . The storage subsystems are connected to the application servers over appropriate communication channels \u2032. These communication channels can be any appropriate medium suitable for data transfer; e.g., fibre channel using the fibre channel protocol, SCSI (small computer system interface) using the SCSI protocol, and ESCON\u00ae and FICON\u00ae using the CKD protocol are commonly known examples. As can be seen in the figure, certain information about the storage subsystem that is relevant to the present invention can be obtained by the VPM agent  associated with the application server. The kind of information will be discussed further.","The storage subsystem  typically comprises one or more physical disks  on which the application data is stored. For example, a storage system, such as the storage system produced and sold by the assignee of the present invention known as the Lightning 9900, can have multiple volumes in one or more physical disks. This system comprises four physical disks of 72 GB capacity each, and can be configured to contain 24 volumes of 9 GB size. In the present invention, a disk  refers to a physical disk within the storage system , and a \u201cvolume\u201d refers to a logical volume that is created out of disks  and exposed (made available) to a host by defining a logical address.","Refer for a moment to FIG. . This figure illustrates a configuration of a data storage architecture suitable to explain aspects of the present invention. It will be appreciated from the discussions that any data storage architecture can be adapted with the components of the present invention. A logical volume  is a storage object that is presented to an application. If volume manager software is used, it is created out of a disk group . The volume manager software creates the disk group  from the physical volumes , and creates logical volumes  from the disk group. Thus, a logical volume  can be viewed as a slice of the disk group  and can comprise portions of one or more physical volumes , as determined by the volume manager software. If no volume manager is used, each logical volume is in one-to-one correspondence with a physical volume .","As noted, a disk group  typically comprises a set of physical volumes . The volume manager software maps an address on a logical volume  to an address on a physical volume . Usually this address conversion is transparent for a user and an application. Using this mechanism, the volume manager provides volume management functions like striping and redundancy for higher performance and reliability, and reconfiguring volumes for easy management.","A physical volume  is a volume that the operating system recognizes and accesses. To make a physical volume usable, an address has to be associated with the physical volume so that an application server  can access it. An addressed physical disk  is called a physical volume. A physical volume is sometimes called an LU (Logical Unit).","A physical disk  is a unit to be exposed to an application server  by assigning an address, and is managed within storage system . If a physical disk  is exposed, there is a corresponding physical volume  on the application server . A physical disk  may be deployed on one or more HDDs  in any manner, the implementation of which depends on the particulars of a given storage system, and is transparent to an application server. Usually the physical disk is uniquely numbered within a storage system.","A RAID group  comprises a set of HDDs  on which a physical disk  is deployed. The RAID group may contain several physical disks. In an embodiment of the present invention, a physical disk can be treated as belonging to one RAID Group .",{"@attributes":{"id":"p-0049","num":"0053"},"figref":["FIG. 2","FIG. 1","FIG. 2","FIG. 2"],"b":["20","121","100","150","130"]},"Storage area networks (SAN) can be used to provide the storage facilities for the application servers . Thus, storage systems  might be different SAN facilities. The network connection  from the VPM server  can be made to the physical volumes comprising the SAN. In this configuration, the VPM server can access the physical volumes directly. Network attached storage (NAS) architectures can be used and accessed in a similar manner. Consequently, the VPM agent  does not need to serve as an interfacing component to the storage system  on behalf of the VPM server . Instead, the VPM server can directly access the storage systems  to obtain the relevant information.",{"@attributes":{"id":"p-0051","num":"0055"},"figref":"FIGS. 3A-3F","b":["103","1","101"]},{"@attributes":{"id":"p-0052","num":"0056"},"figref":"FIG. 3A","b":["350","351","352","353"]},{"@attributes":{"id":"p-0053","num":"0057"},"figref":"FIG. 3B","b":["300","300"]},"Each entry  includes an application name field  which contains information indicative of the application (e.g. Oracle database application) and data object instantiations of the application. An instance identifier field  stores information indicative of the data object; e.g. a database. Each entry  also can include a mapping information field  to store information indicative of the constituent data files of the data object. As discussed above, this information can be obtained in an application-specific manner. Typically such information is available via administrative commands provided by the developer of the application.",{"@attributes":{"id":"p-0055","num":"0059"},"figref":"FIG. 3C","b":"320","ul":{"@attributes":{"id":"ul0005","list-style":"none"},"li":{"@attributes":{"id":"ul0005-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0006","list-style":"none"},"li":"df-k filename\n\nwhere filename is the name of a file identified in the application information table of FIG. B.\n"}}}},{"@attributes":{"id":"p-0056","num":"0061"},"figref":["FIG. 3D","FIG. 5","FIG. 5","FIG. 1","FIG. 5"],"b":["310","540","520","311","10","312","01","01","01","02","2","0","1","2","0","2","3","1","0","530","110","310","540","320","520","5"]},{"@attributes":{"id":"p-0057","num":"0062"},"figref":"FIG. 3E","b":["330","331","332"]},{"@attributes":{"id":"p-0058","num":"0063"},"figref":["FIG. 3F","FIG. 5","FIG. 5","FIG. 5"],"b":["340","520","550","5","340","341","342","510","150","550","340"]},"The physical volume information table entry  also includes one or more \u201cmirror information\u201d fields . Entries are created when a mirror operation is initiated on the physical volume. A \u201cmirror information\u201d entry can include the same information as the \u201cphysical disk information\u201d field . In addition, the mirror information field includes a \u201cmirror name\u201d that specifies a set of mirrored physical volumes . Usually a user defines a set of correlated mirrors (e.g. a set of application objects) and associates a mirror name with it. This allows the user to manipulate the set of mirrors by its mirror name, which is intuitive and understandable. There are as many entries of the \u201cmirror information\u201d fields as there are physical disks (, ) in the physical volume associated with a particular physical volume information table entry .",{"@attributes":{"id":"p-0060","num":"0065"},"figref":"FIG. 4","b":["400","102","1","401","402"]},"The VPM table  further includes an entry  for each volume (e.g., physical volume  or physical disk , ) that is a member of the volume pool. Each entry includes a \u201cperformance level\u201d indication, a \u201creliability level\u201d indication, a \u201cvendor name\u201d, a \u201csystem name\u201d of the disk system, a \u201cserial number\u201d indication, a \u201cvolume identifier,\u201d a \u201cphysical disk group identifier,\u201d and a \u201csite name\u201d field. The performance level provides a rough estimate of the performance capability of the disk. The reliability level provides an indication of the reliability of the disk. The site name identifies a geographic location of the disk. Disks which are used as mirror volumes may be located at places separate from the site of the primary volumes. This can be in another room, another building, another city, and so on. Separating the mirror volumes from the primary volumes being mirrored increases the chances of data survival if a catastrophic event occurs at the primary site. Consequently, as will be seen, it may be desirable to select mirror volumes based on their locations. The entry  also includes an \u201cin-use\u201d field which indicates if the volume has been allocated as a mirror volume or not.","As noted above, the user interface can be any appropriate interface technique suitable for a particular interfacing situation. An implementation according to an embodiment of the invention is a command line interface. For example, a UNIX-style command line interface may include commands such as the following:",{"@attributes":{"id":"p-0063","num":"0068"},"tables":{"@attributes":{"id":"TABLE-US-00004","num":"00004"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"42pt","align":"right"}},{"@attributes":{"colname":"2","colwidth":"133pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":{"entry":[{},"createmirror","mirror_name"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"84pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"133pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"[-vol pvol1 [pvol2 . . . pvoln]]"]},{"entry":[{},"[-app appname instname]"]},{"entry":[{},"[-host hostname]"]},{"entry":[{},"[-pool pool_name]"]},{"entry":[{},"[-plevel performance_level]"]},{"entry":[{},"[-rlevel reliability_level]"]},{"entry":[{},"[-site sitename]"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"1","align":"center","rowsep":"1"}}]}]}}]}}},"createmirror initiates a mirroring operation of the specified primary volumes. This command initiates selection of mirror volumes from a volume pool () to be used as mirror volumes to mirror the one or more primary volumes. A mirror name specifies the group of mirror volumes. The command arguments (options) include:","-vol: This argument allows the user to identify specific primary volumes to be mirrored. One or more primary volumes (pvol-pvoln) can be specified.","-app: This argument allows a user to specify an application (e.g., database application, volume manager, etc.) and an instance of a data object (\u201cinstname\u201d) associated with the application. This argument initiates a mapping of the data object to one or more primary volumes. A mirroring operation is then performed on the mapped primary volumes. The nature of the data object will depend on the application. For example, the command:\n\n","-host: This argument allows the user to specify a host name where the specified primary volumes reside. For example, in , this argument can be used to specify which of the application servers  contain the primary volumes to be mirrored. A default host can be used; for example, the machine on which the user is logged on can be a default host.","-pool: This argument allows the user to specify a volume pool from which the mirror volumes are selected. If this argument is not specified, a default volume pool is used.","-plevel: This argument allows a user to specify a particular performance level (criterion) of the mirror volume(s) to be used to mirror the primary volume(s). If this argument is not specified, then mirror volumes are selected irrespective of the performance level.","-rlevel: This argument allows a user to specify a particular reliability level (criterion) of the mirror volume(s) to be used to mirror the primary volume(s). If this argument is not specified, then mirror volumes are selected irrespective of the reliability level.","-sitename: This argument allows a user to specify a particular sitename (criterion) from which the mirror volume(s) are to be selected to mirror the primary volume(s). If this argument is not specified, then mirror volumes are selected irrespective of the location of the mirror volume.","It can be appreciated that other criteria can be included. The listed criteria illustrate the fact that selection of mirror volumes can be driven by user-specified criteria.",{"@attributes":{"id":"p-0073","num":"0080"},"tables":{"@attributes":{"id":"TABLE-US-00005","num":"00005"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"56pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"49pt","align":"right"}},{"@attributes":{"colname":"2","colwidth":"112pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"suspendmirror","mirror_name"]},{"entry":[{},{},"[-host hostname]"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]}}}}},"suspendmirror halts the mirroring operation of all the mirror volumes in the mirroring group identified by mirror_name. Unlike the command delmirror, this command simply halts the mirroring operation, but does not return the halted mirror volumes back to the volume pool. The command arguments (options) include:","-host: This argument allows the user to specify a host name where the mirroring operation is to be halted. For example, in , this argument can be used to specify which of the application servers  contain the primary volumes to be mirrored. A default host can be used; for example, the machine on which the user is logged on can be a default host.",{"@attributes":{"id":"p-0076","num":"0083"},"tables":{"@attributes":{"id":"TABLE-US-00006","num":"00006"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"offset","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"1","colwidth":"35pt","align":"left"}},{"@attributes":{"colname":"2","colwidth":"119pt","align":"left"}}],"thead":{"row":{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"delmirror","mirror_pname"]},{"entry":[{},{},"[-host hostname]"]},{"entry":[{},{},"[-pool poolname]"]},{"entry":[{},{"@attributes":{"namest":"offset","nameend":"2","align":"center","rowsep":"1"}}]}]}}}}},"delmirror halts the mirroring operation for all the mirror volumes in the mirroring group identified by mirror_name. In addition to halting the mirroring operation, this command returns the halted mirror volumes back to the volume pool, allowing those mirror volumes to be allocated to mirror other primary volumes. The arguments include:","-host: This argument allows the user to specify a host name where the mirroring operation is to be halted. For example, in , this argument can be used to specify which of the application servers  contain the primary volumes to be mirrored. A default host can be used; for example, the machine on which the user is logged on can be a default host.","-pool: This argument allows the user to specify the volume pool to which the halted mirror volumes are returned. If this argument is not specified, the mirror volume(s) can be returned to a default volume pool associated with the user.","poolcreate pool_name","poolcreate creates a volume pool having the specified pool name. This command simply creates an entry in the VPM table  (FIG. ).","poolattr pool_name grpname [+|\u2212] [R|U|RU]]","poolattr changes the group attributes for the group identified by \u201cgrpname\u201d for a volume pool having the specified pool name. The user specifies \u201c+\u201d or \u201c\u2212\u201d to respectively add or delete the privilege of reading (R), allocating (U), or both. This command changes the privilege field  in the VPM table  (FIG. ).","pooladdvol pool_name [+|\u2212] vol [vol . . . voln]","pooladdvol adds a volume to the volume pool specified by the pool name. One or more volumes (vol-voln) can be added. In the particular implementation according to an embodiment of the invention, the volume is a physical volume  (FIG. ). The user can specify \u201c+\u201d or \u201c\u2212\u201d to respectively add or delete the specified volumes.",{"@attributes":{"id":"p-0086","num":"0093"},"figref":["FIG. 6","FIG. 1"],"b":["103","101","110","601","110"]},"In each application server , information about applications running on the server is obtained in a step  by the VPM agent . This can be achieved in any of a number of ways, such as CLI or an API, and is heavily dependent on the application. Applications include software such as Oracle, SQL Server, Exchange, SAP R\/3, People Soft, BAAN, and so on. As mentioned above, information of interest includes some form of mapping information that identifies primary volumes which are used to store a particular data object or application object for an application; e.g., a database. Thus, for example, mapping information for each instance of a database (data object) maintained by a database application in an application server is obtained, identifying all the primary volumes used to store the data files associated with that database instance.","In a similar step , a VPM agent  can obtain information about a volume manager, if one is running on the application server . A typical volume management product is the Veritas Extended Volume Manager (VxVM). As in step , volume manager information can be obtained in a manner provided by the software. Thus, to obtain mapping information which identifies the primary volumes comprising a logical volume, the vxprint command can be used. The VPM agent  can be configured to interact with VxVM to appear as a user typing in the vxprint command and receive the output. The output can then be parsed to obtain the desired information.","Next, in a step , information about the physical volumes (e.g., Physical Disk Information , ) which can be accessed by the application server  is obtained. This can be achieved in a manner appropriate for the particular storage system . For example, a SCSI interface can receive SCSI command such as inquiry to obtain the information. As another example, a network protocol such as SNMP might be suitable. Some storage system vendors provide CLIs and APIs to access the information. In any case, a VPM Agent  can be programmed or otherwise configured to interact with the storage system to obtain the information.","In a step , information about the server itself is obtained. The information includes such things as the file system, the operating system, and so on. The information can be obtained using CLIs or APIs.","In a step , the information obtained in steps - is communicated to the VPM engine  by each application server . The VPM engine , in a step , collects the information received from each application server , compiles the data, and populates the system configuration tables shown in  with the data.",{"@attributes":{"id":"p-0092","num":"0099"},"figref":["FIG. 7","FIG. 1","FIG. 1"],"b":["100","121","2","101","701"]},"In a step , if the -vol argument is specified, then the a list of primary volumes is provided in the parametric information. However, if the -app argument is specified, then the VPM engine  obtains a list of information identifying the primary volumes on which the specified application object is stored by referencing the system configuration tables (FIGS. A-F).","Given the name of an application object is given, the VPM engine  can find logical and physical deployment of that object. Referring to the sample information shown in  for example, if the application object (tablespace TBS) is given, the deployment of TBS can be found in the following manner:","From the application information entry , it can be seen that TBS  comprises two files named \/u\/ora\/data\/tbs.ora and \/u\/ora\/data\/tbs.ora. Using an appropriate CLI or APIs, the logical volume  on which the two files reside can be determined; for example by issuing the command:\n\n","From the volume manager information entry , the logical volume  of \/dev\/vx\/dsk\/VG\/vol is shown to be on three physical volumes , namely, ctd, ctd, and ctd. From the file system information entry , the logical volume  of\/dev\/vx\/dsk\/VG\/vol is mounted on \/u\/ora\/data\/ and uses VxFS file system. From the physical volume information table , the physical volumes  of ctd is on a storage system called \u201cHigh-End Storage\u201d from a company called Storage Co. (both being fictitious names, used merely for explanatory purposes), Serial Number 60233, and Physical Disk Group ID 200.","In a step , the VPM engine  obtains a set of candidate mirror volumes from a volume pool. If the -pool argument is not specified, then a default volume pool is accessed. This can be accomplished by matching the user ID against the \u201cname\u201d field in the volume pool management table (FIG. ). Otherwise, the parametric information includes a volume pool name, identifying the volume pool from which the candidate mirror volumes are selected. An initial confirmation of sufficient privileges can be made before actually allocating mirror volumes from the user-specified pool.","In a step , the candidate mirror volumes are selected for each primary volume. If any of the criteria arguments are specified (e.g., performance, reliability, sitename), then only those mirror volumes with matching criteria will constitute the volume pool from which the candidate mirror volumes are selected. The following criteria are considered in a particular implementation of an embodiment of the invention, involving RAID systems. It can be appreciated that additional or alternative considerations might be appropriate for other disk architectures, and that these criteria are presented for explanatory purposes only to illustrate how mirror volumes can be selected.\n\n","Another consideration for mirror volume selection is to apply a weighting to each of the above-listed criteria. The VPM engine  can attempt to select the best mirror volume that satisfies all of the conditions. If it cannot, however, then it selects the next best volume. One approach is to produce a score for each available volume by summing the weightings of the criteria that are satisfied by that volume. The volume having the highest score is selected as a candidate volume.","When all the candidate volumes are selected, the list along with characteristic information of each candidate volume can be communicated to the user for approval, in a step . The list of candidate mirror volumes includes information that associates each candidate with a primary volume. It can be appreciated now why the mirror volume is a \u201ccandidate\u201d volume, since an approval from the user might be required.","The VPM engine  can be configured to selectively require an approval response from a user. For example, if the score for a candidate volume exceeds a threshold, it may be decided by design that no approval is required. The threshold could be set by the user via an argument to the command. Another technique might be to provide an argument that specifies whether approval is needed or not.","If an approval response to the candidate volumes is received, then in a step , the VPM engine  communicates to the VPM agents  information to begin mirroring operations. Each VPM agent  communicates with the storage system  to initiate mirroring of the primary volumes associated with the application server  using the assigned mirror volume. In other configurations (e.g., FIG. ), the VPM engine itself might communicate with the storage systems to initiate mirroring operations.","For each of the mirror volume its associated \u201cin-use\u201d field () is set to a value indicative of being in use, so as not be allocated. Finally, the allocated mirror volumes are added to a mirroring group of active mirror volumes identified by the \u201cmirror",{"@attributes":{"id":"p-0104","num":"0117"},"figref":"FIG. 8","b":["801","101","121","802","110","111","150","2"]},"In a step , the VPM engine  \u201creturns\u201d the mirror volumes to a volume pool. If the -pool argument is not specified, then the mirror volumes are \u201creturned\u201d to the volume pool from which they were originally allocated. Thus, in accordance with the particular disclosed implementation, the \u201cin-use\u201d field associated with each returning mirror volume is set to indicate that it is available to be re-allocated in a createmirror command.","If the -pool argument is specified, then the mirror volumes are returned to the volume pool specified by the pool name. This requires appropriate access by the user to the specified volume pool. If access is permitted, the volume entries  in the VPM table  that presently contains the mirror volumes are moved to the VPM table specified by the user; which includes deleting the entries from the former VPM table.","Mirror volumes can be used for various solutions, such as backup and recovery, disaster recovery, creating a duplicate database, etc. Some database systems and volume manager software allow a user to dynamically change the configuration of a data object. For example, a volume manager can reconfigure it's disk group  () by the addition of one or more physical volume . Consequently, the newly added physical volume(s) must be mirrored. Otherwise, the Disk Group  on the mirror volumes cannot be reconfigured or accessed by an Application Server .","When a configuration change occurs in an application server the event can be detected by an appropriately configured VPM agent .  shows how the VPM server  can be updated. In a step , a VPM agent detects a configuration change that can have an affect on volume mirroring operations, such as added or removed primary volumes, or added or removed mirror volumes. In an alternative architecture, the VPM server itself may be able to detect the event. When such an event is detected, the VPM agent can communicate information indicative of the event to the VPM engine , in a step . The VPM engine can then perform foregoing described operations to make the necessary updates to the various tables shown in ."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Aspects, advantages and novel features of the present invention will become apparent from the following description of the invention presented in conjunction with the accompanying drawings:",{"@attributes":{"id":"p-0021","num":"0025"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0022","num":"0026"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0023","num":"0027"},"figref":"FIGS. 3A-3F","b":"4"},{"@attributes":{"id":"p-0024","num":"0028"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0025","num":"0029"},"figref":["FIG. 6","FIGS. 3A-3F"]},{"@attributes":{"id":"p-0026","num":"0030"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0027","num":"0031"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0028","num":"0032"},"figref":"FIG. 9"}]},"DETDESC":[{},{}]}
