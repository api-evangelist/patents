---
title: Apparatus and method for media transmission bandwidth control using bandwidth estimation
abstract: A system, apparatus, and method for estimating available bandwidth for transmitting a media stream over a network, the media stream having a plurality of frames. One method includes receiving some of the plurality of frames, each frame of the plurality of frames having a inter-frame size differential and an inter-arrival time differential, detecting whether at least some of the inter-arrival time differentials are outside of a steady-state range using at least some of the inter-frame size differentials, and estimating an available bandwidth based on the detected change and using a processor.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09106787&OS=09106787&RS=09106787
owner: GOOGLE INC.
number: 09106787
owner_city: Mountain View
owner_country: US
publication_date: 20110509
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"p":["The present invention relates in general to media encoding and decoding.","An increasing number of applications today make use of digital media for various purposes including, for example, remote business meetings via video conferencing, high definition video entertainment, video advertisements, and sharing of user-generated videos. As technology is evolving, users have higher expectations for media quality and, for example, expect high resolution video even when transmitted over communications channels having limited bandwidth.","To permit transmission of digital media streams while limiting bandwidth consumption, a number of video compression schemes have been devised, including formats such as VPx, promulgated by Google, Inc. of Mountain View, California, and H.264, a standard promulgated by ITU-T Video Coding Experts Group (VCEG) and the ISO\/TEC Moving Picture Experts Group (MPEG), including present and future versions thereof. H.264 is also known as MPEG-4 Part 10 or MPEG-4 AVC (formally, ISO\/TEC 14496-10).","One type of media transmission includes real-time encoding and transmission, in which the receiver of a media stream decodes and renders media data (i.e. video frames) as it is received. For example, in a real-time video implementation, if video is encoded at a bitrate greater than the available bandwidth of the networks over which it is to be transmitted, portions of the encoded video stream may not be able to be received and decoded by the receiver in real-time.","Disclosed herein are embodiments of methods and apparatuses for determining an estimated available bandwidth.","Included in the disclosed embodiments is a method for determining an estimated available bandwidth for transmitting a media stream over a network, the media stream having a plurality of frames. The method includes receiving some of the plurality of frames, determining an inter-arrival time differential d for each of the received frames, the inter-arrival time differential dfor a current frame i calculated using a formula d=(t\u2212t)\u2212(T\u2212T), wherein: tis a receive time of a current frame i, tis a receive time of a previous frame i\u22121 that immediately precedes the current frame i, Tis a timestamp of the current frame i, and Tis a timestamp of the previous frame i\u22121, determining an inter-frame size differential dL for each of the received frames, the inter-frame size differential dLfor a current frame i calculated as the difference between a frame size of the current frame i and a frame size of the previous frame i\u22121, determining an estimated function having a slope Cand an offset mbased on at least some of the inter-arrival time differentials and inter-frame size differentials, and determining the estimated available bandwidth based on a comparison between the offset mand one or more thresholds.","Included in the disclosed embodiments is a method for regulating a bitrate of a media stream encoded by a transmitting station based on an estimated available bandwidth determined by a receiving station, the media stream having a plurality of frames. The method includes receiving some of the plurality of frames by the receiving station, the received frames each having an inter-arrival time differential and a inter-frame size differential, estimating an offset mof the inter-arrival time differential, detecting an available bandwidth over-use if the offset mis greater than a positive threshold, detecting an available bandwidth under-use if the offset mis less than a negative threshold, determining the estimated available bandwidth based on whether there is a detected over-use or under-use using a processor, and regulating the bitrate of the encoded media stream by sending the estimated available bandwidth to the transmitting station.","Included in the disclosed embodiments is a method for estimating available bandwidth for transmitting a media stream over a network, the media stream having a plurality of frames. The method includes receiving some of the plurality of frames, each frame of the plurality of frames having an inter-frame size differential and an inter-arrival time differential, detecting if at least some of the inter-arrival time differentials are outside of a steady-state range using at least some of the inter-frame size differentials, and estimating an available bandwidth based on the detection using a processor.","Included in the disclosed embodiments is a computing device for estimating available bandwidth for transmitting a media stream over a network, the media stream having a plurality of frames. The computing device includes a memory and a processor configured to execute instructions stored in the memory to: receive some of the plurality of frames, each frame of the plurality of frames having an inter-frame size differential and an inter-arrival time differential, detect whether at least some of the inter-arrival time differentials are outside of a steady-state range using at least some of the inter-frame size differentials, and estimate an available bandwidth based on the detection.","Included in the disclosed embodiments is a computing device for estimating available bandwidth for transmitting a media stream over a network, the media stream having a plurality of frames. The computing device includes a RTP receiver configured to receive frames of a media stream from a network, each frame having an inter-arrival time differential and an inter-frame size differential, an adaptive filter configured to determine an estimated function of inter-arrival time differential and inter-frame size differential for the received frames, the estimated function having a slope and an offset, an over-use detector configured to detect an over-use or under-use of the network based on a comparison between the offset and one or more pre-determined thresholds, and a remote rate-control configured to determine an estimated available bandwidth based on the detection of an over-use or under-use by the over-use detector.","These and other embodiments will be described in additional detail hereafter.",{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 1","b":"10"},"An exemplary transmitting station  may be, for example, a computer having an internal configuration of hardware including a processor such as a central processing unit (CPU)  and a memory . CPU  can be a controller for controlling the operations of transmitting station . The CPU  is connected to memory  by, for example, a memory bus. Memory  may be random access memory (RAM) or any other suitable memory device. Memory  can store data and program instructions which are used by the CPU . Other suitable implementations of transmitting station  are possible.","A network  connects transmitting station  and a receiving station  for transmission of an encoded media stream. Specifically, the media stream can be encoded by an encoder in transmitting station  and the encoded media stream can be decoded by a decoder in receiving station . Network  may, for example, be the Internet, which is a packet-switched network. Network  may also be a local area network (LAN), wide area network (WAN), virtual private network (VPN), or any other means of transferring the media stream from transmitting station .","The transmission of the encoded media stream can be accomplished using a real-time protocol, such as the real-time transport protocol (RTP) standard as promulgated by the Internet Engineering Task Force (IETF). Control of the transmission can be accomplished using the real-time transport control protocol (RTCP) defined in the RTP standard. For example, the RTCP can allow a transmitting station and receiving station to share information regarding network congestion and available bandwidth.","In one implementation, network  can include multiple network segments. For example, a transmission through the Internet can be routed through multiple network segments using routers that connect the network segments. The routers direct the transmission through a network path of appropriate network segments so that the transmission reaches its intended destination. Each network segment in the network path has an available bandwidth A, modeled with a fluid traffic model as follows:\n\nA\u2014C\u2014X; wherein \u2003\u2003(1)\n\nC is the network segment capacity (i.e. the segment's maximum bandwidth); and X is the amount of cross-traffic on the network segment (i.e. the portion of the capacity that is already used).\n","The available bandwidth of the network path can be no larger than the smallest available bandwidth Aof all of the network segments within the network path. Correspondingly, the maximum bandwidth, or capacity, of the network path is equal to the network segment having the smallest capacity C. The network path's available bandwidth Aand capacity Cmay change over time based on changing network conditions. For example, a network segment's performance may be degraded, reducing its capacity and the capacity of the network path. In another example, cross traffic over one of the network segments may reduce the available bandwidth of the network path.","The available bandwidth is the maximum data size per time period that the network is able to transmit. A bitrate is the size of an encoded media stream or other data over time. Both the bandwidth and the bitrate can be measured in bits or bytes per second.","If the media stream being transmitted has a bitrate greater than the available bandwidth, portions of the media stream will be queued within the network. The queuing can result in delayed receipt of portions of the media stream by the receiving station  or may result in portions of the media stream being lost during transmission. Lost portions of the media stream may be resent by the transmitting station , however, the resent portions can be significantly delayed\u2014and in some cases, the resent portions can be lost as well.","Receiving station , in one example, can be a computer having an internal configuration of hardware including a processor such as a central processing unit (CPU)  and a memory . CPU  is a controller for controlling the operations of transmitting station . CPU  can be connected to memory  by, for example, a memory bus. Memory  can be RAM or any other suitable memory device. Memory  stores data and program instructions which are used by CPU . Other suitable implementations of receiving station  are possible.","A display  configured to display a video stream can be connected to receiving station . Display  may be implemented in various ways, including by a liquid crystal display (LCD) or a cathode-ray tube (CRT). The display  can be configured to display a rendering of a video stream decoded by the decoder in receiving station .","Other implementations of the encoder and decoder system  are possible. In one implementation, additional components may be added to the encoder and decoder system . For example, a display or a video camera may be attached to transmitting station  to capture a video stream to be encoded. In another implementation, a transport protocol other than RTP may be used.",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 2","b":["50","50","50","52","52","54","56","56","58","56","58"]},{"@attributes":{"id":"p-0036","num":"0035"},"figref":["FIG. 3","FIG. 1"],"b":["70","12","30","28","70","12","30","70"]},"A video stream  is input into the system. Video encoding  encodes the input video stream. Video encoding  produces an encoded video stream ata particular bitrate. The encoding can be performed using techniques such as inter-frame prediction. In inter-frame prediction, some frames (usually called P-frames) are each encoded as a residual signal that is determined using a difference between the frame being encoded and a reference frame. The difference can be determined using techniques such as motion compensation. I-frames are intra-predicted frames, and are encoded without using other frames. I-frames are typically larger than frames that are not intra-predicted (i.e. P-frames).","A RTP sender  packages encoded frames into packets conforming to the RTP protocol for transport. The packaging includes setting a timestamp for a packaged frame based on either the capture time (the time at which the frame was captured by, for example, a video camera) or the send time (the time at which the frame is packaged and sent). Packaged frames are transmitted in a RTP stream  of RTP packets over the network .","A RTP receiver  receives the RTP packets in the RTP stream , unpackages the encoded video stream from the RTP packets and transfers the encoded video stream to video receiver . Video receiver  decodes and renders the encoded video stream.","After receiving a frame of the encoded video stream, RTP receiver  sends the timestamp, encoded frame size, and the actual receive time (the time at which the frame arrived at RTP receiver ) to receive-side control . Receive-side control  is included in bandwidth estimator . Receive-side control  is configured to determine an estimated available bandwidth for the RTP stream . Receive-side control  includes an adaptive filter , over-use detector , and remote rate-control .","The adaptive filter  determines an estimated function based on data points of the inter-arrival time differential and the inter-frame size differential of at least some of the frames that have been previously received. The estimated function includes a slope and an offset. The adaptive filter  and the determined estimated function will be described in more detail later. The over-use detector  uses a comparison of the offset of the estimated function and one or more thresholds to determine whether there is a network over-use or under-use. The over-use detector  will be described in more detail later.","The remote rate-control  determines an estimated available bandwidth for transmitting the RTP stream  over the network. The estimated available bandwidth is calculated based on the detection of network over-use or under-use by over-use detector . The remote rate-control  will be described in more detail later.","Once the estimated available bandwidth is determined, RTCP sender  is used to send the estimated available bandwidth to the transmitting station  via RTCP messages . The estimated available bandwidth is received by RTCP receiver  in an RTCP message. The RTCP receiver  extracts the estimated available bandwidth and passes it to send-side control . The send-side control calculates a send-side estimated available bandwidth that is bounded by the estimated available bandwidth determined by the receive-side control  and a value determined using the TCP throughput equation that is a part of TCP Friendly Rate Control (TFRC), promulgated by the Internet Engineering Task Force (IETF).","The bandwidth estimating system described above is only one possible implementation of the bandwidth estimating system. Other implementations are possible, including those that modify, add, or delete aspects of the system shown in . For example, an alternative implementation may not use the RTP and RTCP protocols and may instead use a different protocol. In another implementation, the bandwidth estimation system can be modified to estimate available bandwidth for other media streams, such as an audio stream.","When the encoding and transmission of a video stream is initialized, the bitrate of the video stream can be set to be within an expected available bandwidth of the network. The expected available bandwidth can be, for example, pre-determined or determined by either the transmitting or receiving station. One exemplary method of determining the expected available bandwidth includes performing a probe of the network. In this method, a burst of packets is sent to the receiving station by the transmitting station. The receiving station can then measure the incoming bitrate of the burst of packets to determine the expected available bandwidth. Other methods can also be used.","The actual available bandwidth Amay change over time, resulting in an under-use or an over-use of the available bandwidth Aof the network. Bandwidth estimator  is used to determine the estimated available bandwidth so that the bitrate of the encoded video stream can be optimized to the available bandwidth of the network. The bitrate can be optimized so that the encoded video stream takes up a majority of the available bandwidth (allowing for a higher quality video, since higher quality video generally requires a higher bitrate) and without taking up more than the available bandwidth so that transmission loss is controlled.",{"@attributes":{"id":"p-0047","num":"0046"},"figref":"FIG. 4","b":["110","28","30","86","112","86"]},"Next, at stage , an estimated function is determined using adaptive filter . The estimated function is based on the inter-arrival time differential d and the inter-frame size differential dL of at least some of the frames that have been previously received and includes an estimated slope and offset. Use of the inter-frame size differential dL allows for a more accurate offset than only using the inter-arrival time differential without respect to frame size. The inter-arrival time differential dof a frame i is the difference in network transmission time of successive frames in the video stream, as defined by this formula:\n\nd=t\u2212t\u2212(T\u2212T); wherein \u2003\u2003(1)\n\ntis the receive time of frame i; tis the receive time of a frame i\u22121 that immediately precedes the current frame I; Tis the timestamp (send time or capture time) of frame i; and Tis the timestamp of frame i\u22121.\n","The inter-frame size differential dLfor a frame i is the difference in frame size of successive frames in the video stream, as defined by this formula:\n\ndL=L; wherein \u2003\u2003(2)\n\nLis the frame size of frame i; and Lis the frame size of frame i\u22121.\n","In one exemplary implementation, the estimated function is estimated using a Kalman filter. To utilize a Kalman filter, the process of transmitting frames over the network is modeled. For any frame i, a model Dof inter-arrival time dcan be defined using the following formula:",{"@attributes":{"id":"p-0051","num":"0050"},"maths":{"@attributes":{"id":"MATH-US-00001","num":"00001"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"msub":{"mi":["D","i"]},"mo":"=","mrow":{"mfrac":{"mrow":{"mi":"d","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"msub":{"mi":["L","i"]}},"msub":{"mi":["C","min"]}},"mo":"+","msub":{"mi":["w","i"]}}},"mo":";","mi":"wherein"}},{"mrow":{"mo":["(",")"],"mn":"3"}}]}}}},"br":{},"sub":"i "},"In formula (3), the stochastic process W is a function of the capacity C, the current cross traffic X, and the current video stream bitrate R. W is modeled as a white Gaussian process with a variance of \u03c3. If the current video stream bitrate Rexceeds the current available bandwidth A(over-use condition), then wwill have a mean greater than zero. Alternatively, if the current video stream bitrate Ris less than the current available bandwidth, then wcan have a mean less than zero for limited periods of time. Sample wcan have a mean less than zero during a time period which the network is recovering from a over-use condition (under-use condition).","If the current video stream bitrate Ris equal to or less than the current available bandwidth Aand the network is not recovering from an over-use condition (steady-state condition), then the mean of wwill be zero. The mean of wcan be split out from the noise portion of wusing formula (3) as follows:",{"@attributes":{"id":"p-0054","num":"0053"},"maths":{"@attributes":{"id":"MATH-US-00002","num":"00002"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"msub":{"mi":["D","i"]},"mo":"=","mrow":{"mrow":{"mfrac":{"mn":"1","msub":{"mi":"C","mrow":{"mi":["min","i"],"mo":","}}},"mo":["\u2062","\u2062","\u2062"],"mi":"d","mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"msub":{"mi":["L","i"]}},"mo":["+","+"],"msub":[{"mi":["m","i"]},{"mi":["v","i"]}]}},"mo":";","mi":"wherein"}},{"mrow":{"mo":["(",")"],"mn":"4"}}]}}}},"br":{},"sub":["min,i ","min ","i ","i ","i ","i "]},"The estimated function with respect to Cand mis modeled in a form usable by the Kalman filter using matrix for frame i as follows:",{"@attributes":{"id":"p-0056","num":"0055"},"maths":{"@attributes":{"id":"MATH-US-00003","num":"00003"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msub":{"mover":{"mi":["\u03b8","_"]},"mi":"i"},"mo":"=","mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"msubsup":{"mi":"C","mrow":[{"mi":["min","i"],"mo":","},{"mo":"-","mn":"1"}]}}},{"mtd":{"msub":{"mi":["m","i"]}}}]}}}},{"mrow":{"mo":["(",")"],"mn":"5"}}]}}}}},"The next values of for the next frame i+1 can be modeled as follows:\n\n = +\u016b; wherein \u2003\u2003(6)\n\n\u016bis a zero-mean white Gaussian process noise having a model covariance Qdefined as:\n",{"@attributes":{"id":"p-0058","num":"0057"},"maths":{"@attributes":{"id":"MATH-US-00004","num":"00004"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"msub":{"mi":["Q","i"]},"mo":"=","mrow":{"mi":"E","mo":"\u2062","mrow":{"mo":["{","}"],"mrow":{"msub":{"mover":{"mi":["u","_"]},"mi":"i"},"mo":"\u2062","msubsup":{"mover":{"mi":["u","_"]},"mi":["i","T"]}}}}},"mo":";","mi":"wherein"}},{"mrow":{"mo":["(",")"],"mn":"7"}}]}}}},"br":{}},"The model Dcan be restated in terms of as follows:\n\nD=  +v; wherein \u2003\u2003(8)\n is the transpose of , being defined as:\n",{"@attributes":{"id":"p-0060","num":"0059"},"maths":{"@attributes":{"id":"MATH-US-00005","num":"00005"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msub":{"mover":{"mi":["h","_"]},"mi":"i"},"mo":"=","mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"mrow":{"mi":"d","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"msub":{"mi":["L","i"]}}}},{"mtd":{"mn":"1"}}]}}}},{"mrow":{"mo":["(",")"],"mn":"9"}}]}}}}},"The matrix of the model is restated as an estimate {circumflex over (\u03b8)}, which will be the output from the Kalman filter. The estimate {circumflex over (\u03b8)}, is defined as:",{"@attributes":{"id":"p-0062","num":"0061"},"maths":{"@attributes":{"id":"MATH-US-00006","num":"00006"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"msub":{"mover":{"mi":"\u03b8","mo":"^"},"mi":"i"},"mo":"=","mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"msubsup":{"mover":{"mi":"C","mo":"^"},"mrow":[{"mi":["min","i"],"mo":","},{"mo":"-","mn":"1"}]}}},{"mtd":{"msub":{"mover":{"mi":"m","mo":"^"},"mi":"i"}}}]}}},"mo":";","mi":"wherein"}},{"mrow":{"mo":["(",")"],"mn":"10"}}]}}}},"br":{},"sub":["min,1","i "],"sup":"\u22121 "},"The estimate {circumflex over (\u03b8)}is determined using the Kalman filter using the following estimation formula:\n\n{circumflex over (\u03b8)}={circumflex over (\u03b8)}+z ; wherein \u2003\u2003(11)\n\n{circumflex over (\u03b8)}is the estimate of the previous frame i\u22121;\n\nzis the measurement value, defined as:\n\nz=d\u2212 {circumflex over (\u03b8)}; and \u2003\u2003(12)\n is the Kalman Gain, defined as:\n",{"@attributes":{"id":"p-0064","num":"0063"},"maths":{"@attributes":{"id":"MATH-US-00007","num":"00007"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"msub":{"mover":{"mi":["K","_"]},"mi":"i"},"mo":"=","mfrac":{"mrow":[{"msub":[{"mi":"P","mrow":{"mi":"i","mo":"-","mn":"1"}},{"mover":{"mi":["h","_"]},"mi":"i"}],"mo":"\u2062"},{"msubsup":{"mover":{"mi":"\u03c3","mo":"^"},"mrow":{"mi":["v","i"],"mo":","},"mn":"2"},"mo":"+","mrow":{"msubsup":{"mover":{"mi":["h","_"]},"mi":["i","T"]},"mo":["\u2062","\u2062"],"msub":[{"mi":"P","mrow":{"mi":"i","mo":"-","mn":"1"}},{"mover":{"mi":["h","_"]},"mi":"i"}]}}]}},"mo":";","mi":"wherein"}},{"mrow":{"mo":["(",")"],"mn":"13"}}]}}}},"br":[{},{},{}],"sub":["i\u22121 ","i ","i","i","i","i\u22121","i","i ","i","i"],"in-line-formulae":[{},{}],"o":["K","h"],"sup":"T"},{"@attributes":{"id":"p-0065","num":"0064"},"maths":{"@attributes":{"id":"MATH-US-00008","num":"00008"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"msub":{"mover":{"mi":"Q","mo":"^"},"mi":"i"},"mo":"=","mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":[{"mrow":{"mfrac":{"mn":"30","mrow":{"mn":"1000","mo":"\u2062","msub":{"mi":["f","max"]}}},"mo":"\u00d7","msup":{"mn":"10","mrow":{"mo":"-","mn":"10"}}}},{"mn":"0"}]},{"mtd":[{"mn":"0"},{"mrow":{"mfrac":{"mn":"30","mrow":{"mn":"1000","mo":"\u2062","msub":{"mi":["f","max"]}}},"mo":"\u00d7","msup":{"mn":"10","mrow":{"mo":"-","mn":"2"}}}}]}]}}},"mo":";"}},{"mrow":{"mo":["(",")"],"mn":"15"}}]}}}},"br":[{},{},{}],"sub":["v,i","v,i","v,i\u22121","i"],"sup":["2 ","2","2","2"],"in-line-formulae":[{},{}]},{"@attributes":{"id":"p-0066","num":"0065"},"maths":{"@attributes":{"id":"MATH-US-00009","num":"00009"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"mi":"\u03b2","mo":"=","msup":{"mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"-","mi":"\u03b1"}},"mfrac":{"mn":"30","mrow":{"mn":"1000","mo":"\u2062","msub":{"mi":["f","max"]}}}}},"mo":";","mi":"wherein"}},{"mrow":{"mo":["(",")"],"mn":"17"}}]}}}},"br":[{},{}],"sub":"max "},{"@attributes":{"id":"p-0067","num":"0066"},"maths":{"@attributes":{"id":"MATH-US-00010","num":"00010"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msub":{"mi":["f","max"]},"mo":"=","mrow":{"mi":"max","mo":"\u2062","mrow":{"mo":["{","}"],"mrow":{"mfrac":[{"mn":"1","mrow":{"msub":[{"mi":["T","i"]},{"mi":"T","mrow":{"mi":"i","mo":"-","mn":"1"}}],"mo":"-"}},{"mn":"1","mrow":{"msub":[{"mi":"T","mrow":{"mi":"i","mo":"-","mn":"1"}},{"mi":"T","mrow":{"mi":"i","mo":"-","mn":"2"}}],"mo":"-"}},{"mn":"1","mrow":{"msub":[{"mi":"T","mrow":{"mi":["i","N"],"mo":"-"}},{"mi":"T","mrow":{"mi":["i","N"],"mo":["-","-"],"mn":"1"}}],"mo":"-"}}],"mo":[",",",","\u2062",","],"mi":"\u2026","mstyle":{"mspace":{"@attributes":{"width":"0.8em","height":"0.8ex"}}}}}}}},{"mrow":{"mo":["(",")"],"mn":"18"}}]}}}}},"As shown in formula (12), the measurement value z, is defined using the inter-arrival time differential d, the inter-frame size differential dL, and the previous estimate {circumflex over (\u03b8)}. Formula (12) is defined with the assumption that vis a random variable with samples drawn from a zero-mean white Gaussian process. In some cases, that assumption may be incorrect, so an outlier filter is used with the determination of z. If zis greater than 3\u221a{square root over ({circumflex over (\u03c3)})}when using formula (12), the value of zis replaced with 3\u221a{square root over ({circumflex over (\u03c3)})}. If zis less than \u22123\u221a{square root over ({circumflex over (\u03c3)})}when using formula (12), the value of zis replaced with \u22123\u221a{square root over ({circumflex over (\u03c3)})}. In other words, 3\u221a{square root over ({circumflex over (\u03c3)})}is the maximum value of zand \u22123\u221a{square root over ({circumflex over (\u03c3)})}is the minimum value of z. Other outlier filters may alternatively be used.","The Kalman Gain as defined in formula (13) is a gain vector. The gain vector includes gain values for each of",{"@attributes":{"id":"p-0070","num":"0069"},"maths":{"@attributes":{"id":"MATH-US-00011","num":"00011"},"math":{"@attributes":{"overflow":"scroll"},"msubsup":{"mover":{"mi":"C","mo":"^"},"mrow":[{"mi":["min","i"],"mo":","},{"mo":"-","mn":"1"}]}}},"br":{},"sub":["i","i ","i","i\u22121 ","v,i"],"sup":"2 "},"The error covariance Pis determined using an estimated covariance {circumflex over (Q)}. The estimated covariance {circumflex over (Q)}is a matrix of values approximating the model covariance . In this case, position (1,1) of the matrix contains the estimated variance of Cand position (2,2) of the matrix contains the estimated variance of m. The values shown reflect a greater expected variance for the offset mthan slope C. The values are proportional to the frame rate of the video stream, as measured by f.","The disparity in variances reflects an assumption that a change in bandwidth usage as represented by the offset mis much more likely than a change in network capacity as represented by C. However, different implementations and circumstances may require different assumptions and different values within estimated covariance {circumflex over (Q)}. For example, in the case of a mobile network, the network capacity may vary quickly as compared to other networks. As the expected underlying network conditions change, the values within estimated covariance {circumflex over (Q)}can be modified using, for example, an iterative analytical process.","The definition of variance {circumflex over (\u03c3)}and estimated covariance {circumflex over (Q)}parameters each include factor fthat is used to scale the parameters relative to frame rate over time. This scaling factor is included so that the Kalman filter responds within a similar number of frames of the video stream, regardless of the frame rate currently being used. The dynamic nature of this factor enables the Kalman filter to respond to dynamic changes in the video stream frame rate that may occur during real-time video encoding.","The above formulas (5)-(18) illustrate an exemplary implementation of a Kalman filter to estimate the slope and offset of an estimated function of the inter-arrival time differential and the inter-frame size differential of received frames. Other Kalman filter implementations and variations on the exemplary implementation are available. For example, formulas may be added, changed or omitted in alternative implementations. Furthermore, in alternative implementations, a different type of adaptive filter other than a Kalman filter may be used.",{"@attributes":{"id":"p-0075","num":"0074"},"figref":"FIG. 5","b":["130","140","130","130","132"]},"The scatter plot  includes three areas of plotted frames. Area  includes most of the plotted frames and is distributed about the origin of the plot. Area  primarily includes inter-predicted P-frames that do not come immediately after an I-frame. Area  includes frames having a larger inter-frame size differential dL. Area  primarily includes I-frames, which are typically larger than other frames within a video stream. Frames in area  generally will have larger inter-arrival time values than frames in other areas since the relatively increased size of the frames requires a corresponding relative increase in network transmission time.","Area  includes frames that have a smaller frame size than the immediately preceding frame. For example, area  can include P-frames that come immediately after an I-frame, since P-frames are typically smaller than I-frames. Frames in area  require relatively less network transmission time than the immediately preceding frame due to their relatively smaller size.","Estimated function  is an estimated function of the plotted frames. Estimated function  can be determined using a Kalman filter or other method as described above. In this example, the estimated function  has a zero-offset, showing the network in a steady-state condition.","Referring back to , at stage , network over-use or under-use is detected using over-use detector . The over-use detector  detects whether the network is in a steady-state, under-use, or over-use condition. The over-use detector  performs this detection based on the estimated offset {circumflex over (m)}, an over-use threshold \u03b3, and an under-use threshold \u2212\u03b3. In other implementations, the over-use threshold and under-use threshold may be separately pre-determined.","An over-use indication exists when {circumflex over (m)}>\u03b3, an under-use indication exists when {circumflex over (m)}<\u2212\u03b3and otherwise, the network is in steady-state. However, an over-use or under-use is only detected by the over-use detector  if the associated indication is maintained for \u03b3milliseconds and \u03b3frames. This requirement filters out what would be false detections caused by brief spikes in offset {circumflex over (m)}. Alternative implementations may filter the over-use and under-use detection differently. In one example, an over-use or under-use is detected when one of \u03b3milliseconds or \u03b3frames is reached while an indication is maintained. In another example, there may be no filter, and an over-use or under-use is detected immediately once there is an over-use or under-use indication.",{"@attributes":{"id":"p-0081","num":"0080"},"figref":"FIG. 6","b":["150","158","150","130","156","155","150","132","140","130","158","156"]},"The additional received frames  have an increased inter-arrival time differential as compared to the previously received frames shown in plot . The increased inter-arrival time differentials results in a positive offset  in the estimated function . The positive offset  can result in an indication of over-use if the positive offset  value is greater than the threshold value.","Referring back to , at stage , the rate control state is determined and the estimated available bandwidth is determined. The method includes three rate control states: increase, decrease, and hold. The rate control state is used to determine the methodology used to determine the estimated available bandwidth.",{"@attributes":{"id":"p-0084","num":"0083"},"figref":["FIG. 7","FIG. 4"],"b":["170","172","172","176","176"]},"The rate control state then transitions to the hold state  once an under-use condition is detected. The estimated available bandwidth is maintained at a same value once the rate control state is set to hold state . Once the under-use condition ends, the rate control state transitions to increase state . The rate control state can transition back to hold state  from increase state  if another under-use condition is detected.","The rate control states and transitions described above are exemplary and may be different in some implementations. For example, the rate control state can be configured to transition from decrease state  to increase state , for example, after a certain amount of time has passed after an over-use condition ends and an under-use condition has not yet begun. Depending on the thresholds chosen to detect over-use and under-use, this may happen if there is a mild over-use of the network that does not cause a subsequent under-use.","In another example, the rate control state can be configured to transition to a temporary hold state similar to hold state  once an over-use or under-use is indicated but not yet detected. For example, if an over-use is indicated, the estimated available bandwidth will be held at a same value either until the over-use is detected (at which time the state would change to decrease state ). Alternatively, if an under-use is indicated, the estimated available bandwidth will be held at a same value either until the under-use is detected (at which time the state would change to hold state ).",{"@attributes":{"id":"p-0088","num":"0087"},"figref":["FIG. 8","FIG. 4"],"b":["200","200","202","204","206","172","208","208","212"],"sub":["i ","i ","i","i ","i ","i","i\u22121","i\u22121 "],"br":[{},{}],"in-line-formulae":[{},{}]},{"@attributes":{"id":"p-0089","num":"0088"},"maths":{"@attributes":{"id":"MATH-US-00012","num":"00012"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"mrow":[{"mi":"\u03b7","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"msub":{"mi":"T","mrow":{"mi":["r","i"],"mo":","}},"mo":",","msubsup":{"mover":{"mi":"\u03c3","mo":"^"},"mrow":{"mi":["v","i"],"mo":","},"mn":"2"}}}},{"mn":"1.001","mo":"+","mfrac":{"mi":"B","mrow":{"mn":"1","mo":"+","msup":{"mi":"\u2147","mrow":{"mi":"q","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mrow":[{"mi":"r","mo":"\u00b7","msub":{"mi":"T","mrow":{"mi":["r","i"],"mo":","}}},{"mo":["(",")"],"mrow":{"mrow":{"msub":{"mi":"c","mn":"1"},"mo":"\u2062","msubsup":{"mover":{"mi":"\u03c3","mo":"^"},"mrow":{"mi":["v","i"],"mo":","},"mn":"2"}},"mo":"+","msub":{"mi":"c","mn":"2"}}}],"mo":"-"}}}}}}}],"mo":"="},"mo":";","mi":"wherein"}},{"mrow":{"mo":["(",")"],"mn":"20"}}]}}}},"br":{},"sub":["t,i ","1 ","2 "]},{"@attributes":{"id":"p-0090","num":"0089"},"figref":"FIG. 9","sub":["i ","r,i","v,i","1","2"],"b":"250","sup":"2"},"Referring back now to , other implementations may increase the estimated available bandwidth \u00c2in alternative ways. For example, \u00c2can be increased using formula 19 with an offset. Alternatively, \u00c2can be increased using any function of \u00c2.","The increase of the estimated available bandwidth \u00c2as shown above relies on an eventual over-use of the network to trigger a change to the decrease state . The encoded video stream bitrate Ris a measurement of the video stream bitrate as it is arriving at the receiving station. In some cases, the estimated available bandwidth \u00c2may increase to a value that exceeds a maximum bitrate that the transmitting station can encode for the video stream. To avoid divergence between the encoded video stream bitrate Rand the estimated available bandwidth \u00c2, \u00c2is limited to a maximum value in this case, as shown by this formula:\n\n\u00c2=max(\u00c2, 1.5R) ; wherein \u2003\u2003(21)\n\nRis measured using the formula:\n",{"@attributes":{"id":"p-0093","num":"0092"},"maths":{"@attributes":{"id":"MATH-US-00013","num":"00013"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"msub":{"mi":["R","i"]},"mo":"=","mrow":{"mfrac":{"mn":"1","mi":"t"},"mo":"\u2062","mrow":{"munderover":{"mo":"\u2211","mrow":[{"mi":"j","mo":"=","mn":"0"},{"msub":{"mi":["N","t"]},"mo":"-","mn":"1"}]},"mo":"\u2062","msub":{"mi":"L","mrow":{"mi":["i","j"],"mo":"-"}}}}},"mo":";","mi":"wherein"}},{"mrow":{"mo":["(",")"],"mn":"22"}}]}}}},"br":{},"sub":["i ","t ","i-j "]},"At a first transition time , the rate control state changes to decrease state . The rate control state change is triggered by the estimated offset plot  exceeding the over-use threshold \u03b3at point  and maintaining above the over-use threshold \u03b3for an over-use threshold period . Over-use threshold period  can be defined based on a pre-determined number of seconds (\u03b3milliseconds), pre-determined number of frames (\u03b3frames), or both. The decrease state  is maintained for a decrease time period .","In this example, the decrease time period  includes a temporary hold state at the end of the period once an under-use is indicated at point . The plot  reflects a sudden change from an over-use condition to an under-use condition. In other examples and where there is not a sudden change, the decrease time period  may end once the over-use condition ends. In such a case, the estimated available bandwidth is decreased during decrease state . The estimated available bandwidth is decreased using the formula:\n\n\u00c2=\u03b1R; wherein \u2003\u2003(23)\n\n\u03b1 is an fraction that is chosen from within an interval [0.8,0.95].\n","In some implementations, \u03b1 can alternatively be chosen from outside of the stated interval.","At a second transition time , the rate control state changes to hold state . The rate control state change is triggered by the estimated offset plot  decreasing below the under-use threshold \u2212\u03b3for an under-use threshold period . Under-use threshold period  can be defined based on \u03b3milliseconds, \u03b3frames, or both. Under-use threshold period  may alternatively use different values than those used to define over-use threshold period . The hold state is maintained for a hold time period . The hold time period  starts at second transition time  and ends when estimated offset plot  crosses above the under-use threshold. During the hold time period , estimated available bandwidth plot  is maintained at a same value. The encoded video stream bitrate plot  can fluctuate during this time as queued frames within the network are transmitted.","At a third transition time , the rate control state changes back to increase state . The estimated available bandwidth plot  is reset at the third transition time  based on the maximum encoded video stream bitrate R during the hold time period . The determination of the estimated available bandwidth at the end of the hold time period  is defined in this formula:\n\n\u00c2=R=max{R,R, . . . , R}; wherein \u2003\u2003(24)\n\nk is the number of frames within the hold time period.\n","The Rvalue is used to reset the estimated available bandwidth based on the premise that the actual available bandwidth will be equal to or greater than the maximum bitrate observed during the hold time period . The increase state  is then maintained for the remainder of the graph for a final increase time period . The next state after increase state  can be either hold state  or decrease state  depending on whether an under-use or an over-use condition is next detected.","Referring back to , once the estimated available bandwidth \u00c2is determined as of frame i, it is sent to the transmitting station  in stage . \u00c2can be sent via RTCP to the transmitting station  using RTCP sender  and RTCP messages . \u00c2can be determined and sent at the same rate as the video stream or at a slower rate, for example, five times per second. Alternatively, \u00c2can be determined for each frame, but transmitted as an aggregate for groups of frames at a lower rate than the frame rate. After \u00c2is sent, method  ends.",{"@attributes":{"id":"p-0101","num":"0100"},"figref":"FIG. 10","b":["260","100","262","96","98"],"sub":"i "},"At stage , a send-side estimated available bandwidth \u00c2is determined using the following formulas:\n\n\u00c2=1.05\u00c2+1000, if p<2% ; \u2003\u2003(25)\n\n\u00c2=\u00c2, if 2% \u2266p\u226610%; and \u2003\u2003(26)\n\n\u00c2=\u00c2\u2212(1\u22120.5p), if p>10% ; wherein \u2003\u2003(27)\n\n\u00c2is the send-side estimated available bandwidth for frame i\u22121; and\n\np is a measure of packet loss\n","The packet loss p is measured over the time between the current receipt of receive-side estimated available bandwidth \u00c2and the last receipt of a receive-side estimated available bandwidth. The last receipt of the receive-side estimated available bandwidth may have occurred be one or more frames in the past. If the packet loss is less than two percent, the send-side estimated available bandwidth \u00c2is increased relative to the last send-side estimated available bandwidth \u00c2. If the packet loss is between two and ten percent, the send-side estimated available bandwidth \u00c2is maintained at its previous value \u00c2. If the packet loss is greater than ten percent, the send-side estimated available bandwidth \u00c2is decreased from its previous value \u00c2proportionately to the packet loss.","Alternatively, the determination of whether to use formula , , or  to determine the send-side estimated available bandwidth may be based on one or more pre-determined packet loss thresholds. For example an upper packet loss threshold may be used in place of the constant 10% value and a lower packet loss threshold may be used in place of the constant 2% value.","The send-side estimated available bandwidth \u00c2is limited such that it does not exceed the receive-side estimated available bandwidth \u00c2. It is further limited such that it is equal to or greater than a bandwidth calculated using the using the TCP throughput equation that is a part of the TCP Friendly Rate Control (TFRC) specification. The formulas for both limitations are defined below:\n\n\u00c2=min(\u00c2,\u00c2); and \u2003\u2003(28)\n",{"@attributes":{"id":"p-0106","num":"0105"},"maths":{"@attributes":{"id":"MATH-US-00014","num":"00014"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":{"msubsup":{"mover":{"mi":"A","mo":"^"},"mi":["i","S"]},"mo":"=","mrow":{"mi":"max","mo":["(",")"],"mrow":{"msubsup":{"mover":{"mi":"A","mo":"^"},"mi":["i","S"]},"mo":",","mfrac":{"mrow":[{"mn":"8","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"s"},{"mi":"R","mo":"\u2062","msqrt":{"mrow":{"mfrac":{"mrow":{"mn":"2","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"bp"},"mn":"3"},"mo":"+","mrow":{"mo":["(",")"],"mrow":{"mn":"3","mo":["\u2062","\u2062","\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mrow":{"msub":{"mi":["t","RTO"]},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mrow":{"mn":"32","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"msup":{"mi":"p","mn":"2"}}}}},"mi":"p","msqrt":{"mfrac":{"mrow":{"mn":"3","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"bp"},"mn":"8"}}}}}}}]}}}},"mo":";","mi":"wherein"}},{"mrow":{"mo":["(",")"],"mn":"29"}}]}}}},"br":{},"sub":"RTO "},"Once the send-side estimated available bandwidth is determined and limited, at stage  the transmitting station encodes frames at a bitrate based on the send-side estimated available bandwidth using video encoding .","The above-described embodiments of encoding or decoding may illustrate some exemplary encoding techniques. However, in general, encoding and decoding as those terms are used in the claims are understood to mean compression, decompression, transformation or any other change to data whatsoever.","The embodiments of transmitting station  and\/or receiving station  (and the algorithms, methods, instructions etc. stored thereon and\/or executed thereby) can be realized in hardware, software, or any combination thereof including, for example, IP cores, ASICS, programmable logic arrays, optical processors, programmable logic controllers, microcode, firmware, microcontrollers, servers, microprocessors, digital signal processors or any other suitable circuit. In the claims, the term \u201cprocessor\u201d should be understood as encompassing any the foregoing, either singly or in combination. The terms \u201csignal\u201d and \u201cdata\u201d are used interchangeably. Further, portions of transmitting station  and receiving station  do not necessarily have to be implemented in the same manner.","Further, in one embodiment, for example, transmitting station  or receiving station  can be implemented using a general purpose computer\/processor with a computer program that, when executed, carries out any of the respective methods, algorithms and\/or instructions described herein. In addition or alternatively, for example, a special purpose computer\/processor can be utilized which can contain specialized hardware for carrying out any of the methods, algorithms, or instructions described herein.","Transmitting station  and receiving station  can, for example, be implemented on computers in a screencasting or a videoconferencing system. Alternatively, transmitting station  can be implemented on a server and receiving station  can be implemented on a device separate from the server, such as a hand-held communications device (i.e. a cell phone). In this instance, transmitting station  can encode content using an encoder into an encoded video signal and transmit the encoded video signal to the communications device. In turn, the communications device can then decode the encoded video signal using a decoder. Alternatively, the communications device can decode content stored locally on the communications device (i.e. no transmission is necessary). Other suitable transmitting station  and receiving station  implementation schemes are available. For example, receiving station  can be a personal computer rather than a portable communications device.","Further, all or a portion of embodiments of the present invention can take the form of a computer program product accessible from, for example, a computer-usable or computer-readable medium. A computer-usable or computer-readable medium can be any device that can, for example, tangibly contain, store, communicate, or transport the program for use by or in connection with any processor. The medium can be, for example, an electronic, magnetic, optical, electromagnetic, or a semiconductor device. Other suitable mediums are also available.","The above-described embodiments have been described in order to allow easy understanding of the present invention and do not limit the present invention. On the contrary, the invention is intended to cover various modifications and equivalent arrangements included within the scope of the appended claims, which scope is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structure as is permitted under the law."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The description herein makes reference to the accompanying drawings wherein like reference numerals refer to like parts throughout the several views, and wherein:",{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":["FIG. 3","FIG. 1"]},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":["FIG. 7","FIG. 4"]},{"@attributes":{"id":"p-0021","num":"0020"},"figref":["FIG. 8","FIG. 4"]},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 10"}]},"DETDESC":[{},{}]}
