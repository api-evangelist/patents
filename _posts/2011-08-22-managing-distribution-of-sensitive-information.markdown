---
title: Managing distribution of sensitive information
abstract: Managing distribution of sensitive data is disclosed. In one example, a request is sent to a control platform to add a virtual domain. A domain key associated with the virtual domain is received. A request that the credential be transmitted to the virtual domain is sent, along with the application credential which has been encrypted using the domain key. In another example, a request that one or more application credentials be pushed to a virtual domain is received from a configuration console. The virtual domain is notified that at least one action request associated with the virtual domain is available. A signed request is received from the virtual domain for the action request. The application credentials are transmitted to the virtual domain. In a third example, an application credential of a virtual domain is requested. A signed message including an encrypted application credential is received from the control platform.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09305182&OS=09305182&RS=09305182
owner: CLOUDFLARE, INC.
number: 09305182
owner_city: San Francisco
owner_country: US
publication_date: 20110822
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","DETAILED DESCRIPTION"],"p":["Businesses and other entities increasingly use infrastructure-as-a-service (IaaS) vendors to provide hosted computing resources instead of purchasing and maintaining computer hardware themselves. Unfortunately, without physical control over physical hardware, security and other problems can arise. As one example, newly provisioned virtual domains are particularly vulnerable to compromise by nefarious individuals until such time as the owner of the domain is able to access the domain and configure it correctly. As another example, multiple customers may make use of the same configuration server when configuring their respective virtual domains. The configuration server is a single point of compromise that can include high value assets such as cleartext password information for the various domains it supports. A nefarious individual can extract sensitive information out of the configuration server by directly attacking it, and also by impersonating a domain and asking for its configuration information.","The invention can be implemented in numerous ways, including as a process; an apparatus; a system; a composition of matter; a computer program product embodied on a computer readable storage medium; and\/or a processor, such as a processor configured to execute instructions stored on and\/or provided by a memory coupled to the processor. In this specification, these implementations, or any other form that the invention may take, may be referred to as techniques. In general, the order of the steps of disclosed processes may be altered within the scope of the invention. Unless stated otherwise, a component such as a processor or a memory described as being configured to perform a task may be implemented as a general component that is temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task. As used herein, the term \u2018processor\u2019 refers to one or more devices, circuits, and\/or processing cores configured to process data, such as computer program instructions.","A detailed description of one or more embodiments of the invention is provided below along with accompanying figures that illustrate the principles of the invention. The invention is described in connection with such embodiments, but the invention is not limited to any embodiment. The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives, modifications and equivalents. Numerous specific details are set forth in the following description in order to provide a thorough understanding of the invention. These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details. For the purpose of clarity, technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured.",{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 1","b":["102","106","104","106"]},"Customers of hosting provider  use management console  to create and manage virtual servers (also referred to as \u201cguest domains\u201d and \u201cvirtual domains\u201d). For example, as ACME's customer base grows in size, an administrator at ACME can increase the number of ACME's virtual servers as needed by interacting with management console  via an interface. When a new virtual server is needed, provisioning server  is responsible for selecting an appropriate physical machine from a pool  and loading the applicable image\/software. Using the techniques described herein, sensitive configuration and other information, such as SSH and other cryptographic keys; SSL and other certificates; and static passwords, can be pushed to the new virtual server in a secure manner. Such credentials are collectively referred to herein as \u201capplication credentials.\u201d","As will be described in more detail below, control platform  is configured to facilitate the secure distribution of sensitive information. The control server is also configured to facilitate the updating of such sensitive information, and to perform other tasks, as applicable.","Whenever control platform  is described as performing a task, either a single component, all components, or a subset of all components of control platform  may cooperate to perform the task. Similarly, whenever a component of control platform  is described as performing a task, a subcomponent may perform the task and\/or the component may perform the task in conjunction with other components. In some embodiments, the functionality of control platform  or portions thereof is provided by provisioning server , management console , and\/or other infrastructure under the control of the owner of hosting provider . In such scenarios, a separate control platform  may be omitted.","The functionality of control platform  can also be provided by a third party. As one example, in some embodiments hosting provider  contracts with an owner of control platform  to provide services to hosting provider 's customers. As another example, in some embodiments control server  is owned (or leased) by ACME or Beta. As yet another example, in some embodiments control platform  is under the control of a government entity or a consultancy that provides Payment Card Industry Data Security Standard (PCI DSS), Health Insurance Portability and Accountability Act (HIPAA), or other compliance-related services.","In the example shown, each of the physical machines in pool  includes standard commercially available server hardware (e.g., a multi-core processor, 4+ Gigabytes of RAM, and one or more Gigabit network interface adapters). Additional hardware may also be included in a physical machine, such as a trusted platform module (TPM) chip and\/or a USB dongle. Further, machines in pool  are configured in various embodiments to run commercially available virtualization software, such as VMware ESXi, Citrix XenServer, or Microsoft Hyper-V. An arbitrary physical machine  in the pool can be configured to host guest domains of a single entity or configured to support the guest domains of multiple tenants, as applicable.","As illustrated in , control platform  is a single device, running MySQL and Apache Tomcat. Other hosting providers have respective other control platforms and, depending on size, may use multiple instances of MySQL and\/or a cluster of Apache Tomcat frontends. Other database and web frontend software may also be used, as applicable. In some embodiments the functionality of control platform  is provided by a global \u201cserver\u201d implemented as a scalable, elastic architecture and may comprise several distributed components, including components provided by one or more third parties.","Enrollment",{"@attributes":{"id":"p-0021","num":"0020"},"figref":["FIG. 2","FIG. 2"],"b":["102","104","202","118","204","204","118"]},"Once the registration information has been approved (e.g., after the provided email address has been verified, and\/or other checks have been performed), a digital identify certificate is created for the customer (). Specifically, the enrollee is asked to generate a certificate signing request and provide it to a certificate authority (e.g., included in control platform ). In response, the enrollee receives back a signed identity certificate. The enrollee's registration\/certificate information is stored in database .","Portions of the process shown in  may be omitted or modified, as applicable. For example, in some embodiments instead of selecting registration information and supplying it at , the enrollee's registration information is provided to control platform  by an administrator of control platform  and communicated to the enrollee in conjunction with the signing of a contract or otherwise delivered independently of the process shown in . As another example, portion  of the process can be performed independently of the rest of the process shown in , and\/or may be performed with an entity other than control platform  (e.g., a separate certificate authority), with the appropriate certificate information communicated to control platform , as applicable.",{"@attributes":{"id":"p-0024","num":"0023"},"figref":["FIG. 3","FIG. 1"]},"Activating a New Virtual Domain","In the following discussion, \u201cAlice\u201d is an administrator of network  and \u201cBob\u201d is an administrator of network . Alice and Bob communicate with control platform  through respective configuration consoles  and , via network . Alice's company, ACME, has opted to use a hosted configuration console made available by control platform  as a web application. Bob's company, Beta, has instead opted to run its own management console, which communicates with control platform  via an application programming interface (API). In various embodiments, source code for consoles , , and for control platform  is open to the public, to customers, or otherwise made available to entities such as auditors. Further, control platform  or portions of its functionality can be exposed in different ways (e.g., as a graphical interface or a command line interface; via a tablet or smartphone application).","Suppose Alice wishes to create and securely configure a new virtual database server (virtual domain ). First, she interacts with management console  to provision the domain. Stored within provisioning server  are various images provided by vendors, customers, and in some embodiments control platform  (or an entity in control of control platform ). Once Alice selects an appropriate image, the provisioning server starts domain  on physical machine  and provides information such as the IP address of the domain to control platform . Control platform  creates a record in database  for Alice's domain .","In some embodiments, included within the image selected by Alice, or added during the provisioning process (e.g., as a package) is a system agent configured to communicate with control platform . In other embodiments, the agent is a hardware module or is implemented as a combination of hardware and software. The system agent is also configured to communicate with TPM  and USB dongle . When domain  is first started, a keypair is generated for it by TPM . The public key of the domain is transmitted by the system agent to control platform , which includes the key in database  and also provides it to configuration console . In other embodiments (e.g., where the physical machine does not include a TPM), the keypair can be generated on the USB dongle, or in domain 0 (dom0), as applicable. As another example, if domain  is hosted on a dedicated physical machine, a keypair of the machine (e.g., generated by TPM ) may be used as the domain keypair. If domain  is hosted in a multi-tenant physical machine, each co-tenant may have its domain keys generated by and stored by USB dongle , or may have its domain keys generated by and stored by the respective domain (but signed by TPM ). Other techniques for generating and storing domain keypairs can also be used, as applicable.","Once the domain is online, Alice can securely push credential and other configuration information to it.","Configuring the Virtual Domain",{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 4","b":["118","400","114","400","108","304","402","118","118","118"]},"Included in interface  is a dropdown list  of types of credentials that can be added to domain . Alice has elected to add a new database password. Other examples of application credentials that can be added in interface  include SSH keys and SSL certificates. Custom credentials can also be entered by selecting a \u201ccustom\u201d option from dropdown . Based on the type of credential selected, applicable fields  will be provided for manipulation by Alice. In the example shown, the database supports a single password and does not have an associated user (). Alice enters the password into region  and can enter any applicable notes into box .","When finished, Alice can select the \u201cadd\u201d button to transmit the credential information to control platform . Specifically, when Alice clicks button , the password value will be encrypted using the public key of domain  (e.g., obtained from database ), the complete message (i.e., carrying the information that the credential is to be added to domain ) will be signed using ACME's digital certificate, and the message will be transmitted to control platform . The message can be transmitted using a variety of technologies, including using AJAX, SOAP, and JSON, and is encrypted via SSL. In various embodiments, control platform  is configured to store all messages it receives from consoles \/ for forensic analysis, rollback, or other purposes. That Alice was the administrator that made the request is also stored.","In addition to creating specific application credentials for specific domains, Alice can also create groups of credentials (e.g., aux users, database administrators), and groups of domains (e.g., database servers) through interfaces similar to interface . Such groups are usable to push arbitrary application credentials to arbitrary groups of domains.","When control platform  receives the message from Alice, it creates a new entry in the database  for the new password including its name, any other parameters, and the password in encrypted form (i.e., encrypted with domain 's public key). Control platform  is configured to verify the signature on the message and also applies any applicable policies stored in database . For example, a policy included in database  may limit the time of day during which credential information can be modified or may specify that Alice can configure new domains but is not allowed to modify existing configurations.","Alice can continue to add additional credentials using interface , and can also update existing credentials (e.g., for the other virtual database server). When finished, she instructs control platform  to push the credential information to domain .","Pushing Credentials",{"@attributes":{"id":"p-0038","num":"0037"},"figref":["FIG. 5","FIG. 4"],"b":["118","500","304","502","504","506","304"]},"Having completed making additions\/updates to credential information for the time being, Alice is ready to push the credentials (which have already been stored in database ) out to the respective domains. As shown in , interface  allows Alice to select which credentials to push at this time by selecting one or more applicable checkboxes () and then selecting \u201cpush\u201d button .",{"@attributes":{"id":"p-0040","num":"0039"},"figref":["FIG. 6","FIG. 4"],"b":["600","118","602","602","510","604","2"]},"At , a doorbell message is sent to each of the domains for which an action request was generated at . A doorbell message is an alert, sent to the agent of a domain, notifying it that one or more action requests are waiting for it at control platform . When agent  receives a doorbell message (e.g., sent to it at ), it contacts control platform  and asks for any action requests addressed to it via a request signed with the private key of domain . In various embodiments, domain  is configured to periodically check in with control platform  instead of or in addition to responding to doorbell messages sent at . Such periodic checks performed by domain  are used in some embodiments as sources of heartbeat information by control platform .","After verifying the signature, control platform  provides agent  with two action requests ()\u2014one to add a database password () and one to add an SSL certificate (). The action requests are signed by control platform  (and in some embodiments are also signed by the applicable configuration console). Credentials within the action requests are encrypted using the public key of domain . As with messages between configuration consoles \/ and control platform , messages between control platform  and agent  can be transmitted using a variety of technologies, including using AJAX, SOAP, and JSON, and are encrypted via SSL. Additional security measures, such as the use of sequence numbers\/time to prevent replay attacks can also be employed.","Agent  attempts to execute the requested actions, such as by decrypting <encrypted password> and using it to create a new database password. Agent  also provides the status of the requested actions to control platform  at . For example, the agent can report that a credential was successfully added, updated, or failed to be added\/updated. In some embodiments, if no response is received within a threshold time period, additional action is taken by control platform , such as a second doorbell being sent to agent . In other embodiments, if no response is received in the appropriate amount of time, the status is designated as a failure.","Finally, at , the status of the requests is provided as output.  illustrates an embodiment of an interface to control platform  as rendered in a browser. Interface  is presented to Alice after she presses button . As indicated at  and , the addition of new credentials to domain  was successful. The updating of the database password of the first database server has not yet completed (). Specifically, the first database has not yet collected its action requests from control platform .","Morning Paper","In some embodiments, the credentials received from control platform  are, once decrypted, stored as they would typically be found on a traditional server not implementing the techniques described herein (e.g., including in the clear, and\/or in the traditional location where the credentials would be located). In other embodiments, the received credentials are stored in a more secure location (e.g., by creating symbolic links, using include files, or using other applicable redirection techniques) and\/or are decrypted as needed. For example, credentials can be stored on USB dongle  or stored in encrypted form on domain  and decrypted as needed by agent .","In yet other embodiments, at least some of the credentials provided to virtual domain  are stored in RAM  (e.g., in ramfs or other ram-based filesystem). When virtual domain  is rebooted, those credentials stored in RAM will be erased and thus need to be reprovisioned. One way of reprovisioning the credentials is as follows. System agent  is configured, upon reboot, to send a request to control platform  for all credential information associated with domain . This request is also referred to herein as a \u201cmorning paper\u201d request. As with the request made by agent  in conjunction with portion  of the process shown in , the morning paper request is signed by the private key of domain  (which is stored in TPM , USB dongle , or otherwise not purged during reboot).","Additional checks can also be performed by control platform  at this point, including interrogating TPM  or USB dongle , requesting a list of installed packages, or requesting checksums of data stored in domain . Such checks can also be periodically performed, not in connection with the request, e.g., to ensure that domain  hasn't been tampered with and\/or for use in later audits. Results of the checks are stored in database . Other types of policies can also be applied to the request, such as by limiting a given domain to one morning paper request per day; requiring an administrator to approve the request (e.g., out of band); requiring a physical presence detection routine be run on TPM  or dongle ; or by generating an alert on console  when a morning paper request occurs. If the checks are successful, control platform  provides all of domain 's credentials (as they appear in database \u2014encrypted with domain 's public key) to domain . If the checks are unsuccessful, a variety of actions can be taken. For example, an administrator can be alerted, either via consoles \/ or other communication methods (such as an email).","In various embodiments, database  serves as a cache of credential information. In the event credential information needed by domain  is not present in database , control platform  facilitates obtaining the credential information from the customer. For example, control platform  can alert Bob that he needs to supply credential information via configuration console , or via a secured application on his mobile telephony device.","Although the foregoing embodiments have been described in some detail for purposes of clarity of understanding, the invention is not limited to the details provided. There are many alternative ways of implementing the invention. The disclosed embodiments are illustrative and not restrictive."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Various embodiments of the invention are disclosed in the following detailed description and the accompanying drawings.",{"@attributes":{"id":"p-0004","num":"0003"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0005","num":"0004"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0006","num":"0005"},"figref":["FIG. 3","FIG. 1"]},{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 7"}]},"DETDESC":[{},{}]}
