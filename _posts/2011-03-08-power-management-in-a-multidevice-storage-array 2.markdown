---
title: Power management in a multi-device storage array
abstract: There is provided a method and apparatus for power management in a storage resource. The storage resource comprises at least one RAID array including a plurality of physical drives. The method comprises: determining a reduced number of physical drives within a RAID array upon which data is to be concentrated; moving data stored on said RAID array and/or targeting data written to said RAID array to one or more of said reduced number of physical drives such that said data is concentrated on said reduced number of physical drives in said RAID array; and selectively applying power management logic to enable, based on at least one power management criterion, one or more physical drives in said RAID array to be powered down or to be supplied with reduced power.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09594421&OS=09594421&RS=09594421
owner: Xyratex Technology Limited
number: 09594421
owner_city: Havant
owner_country: GB
publication_date: 20110308
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"p":["The present invention relates to a method of, and apparatus for, management of power in a storage resource. More particularly, the present invention relates to a method of, and apparatus for, management of power in a storage resource comprising at least one RAID array.","Commonly, redundant arrays of inexpensive disk (RAID) arrays are the primary storage architecture for large, networked computer storage systems. The RAID architecture was first disclosed in \u201cA Case for Redundant Arrays of Inexpensive Disks (RAID)\u201d, Patterson, Gibson, and Katz (University of California, Berkeley). RAID architecture combines multiple small, inexpensive disk drives into an array of disk drives that yields performance exceeding that of a single large drive.","There are a number of different RAID architectures, designated as RAID-1 through RAID-6. Each architecture offers disk fault-tolerance and offers different trade-offs in terms of features and performance. In addition to the different architectures, a non-redundant array of disk drives is referred to as a RAID-0 array. RAID controllers provide data integrity through redundant data mechanisms, high speed through streamlined algorithms, and accessibility to stored data for users and administrators.","RAID architecture provides data redundancy in two basic forms: mirroring (RAID 1) and parity (RAID 3, 4, 5 and 6). The implementation of mirroring in RAID 1 architectures involves creating an identical image of the data on a primary disk on a secondary disk. The contents of the primary and secondary disks in the array are identical.","RAID 1 architecture requires at least two drives and has increased reliability when compared to a single disk. Since each disk contains a complete copy of the data, and can be independently addressed, reliability is increased by a factor equal to the power of the number of independent mirrored disks, i.e. in a two disk arrangement, reliability is increased by a factor of four. Normally data is mirrored onto physically identical drives, though the process can be applied to logical drives where the underlying physical format is hidden from the mirroring process.","RAID 3, 4, 5, or 6 architectures generally utilise three or more disks of identical capacity. In these architectures, two or more of the disks are utilised for reading\/writing of data and one of the disks stores parity data. Data interleaving across the disks is usually in the form of data \u201cstriping\u201d in which the data to be stored is broken down into blocks called \u201cstripe units\u201d. The \u201cstripe units\u201d are then distributed across the disks. Therefore, should one of the disks in a RAID group fail or become corrupted, the missing data can be recreated from the data on the other disks. The data may be reconstructed through the use of the redundant \u201cstripe units\u201d stored on the remaining disks. However, RAID architectures utilising parity configurations need to generate and write parity data during a write operation.","A RAID array is usually presented to the host user as one or more logical drives. A logical drive is a usable region of storage capacity located on one or more physical disk drive components in a computer system. The drive is referred to as logical (or, sometimes, virtual) because it does not actually form a physical entity in its own right, and may comprise, for example, a partition on one or more disks in a RAID array.","In most modern storage networks, a number of storage devices are connected to many host server devices in a storage network. A single RAID array may provide capacity to one or more servers.","Modern storage resources tend to be very large and consume a large amount of power. Therefore, there is considerable interest in power management protocols and implementations in order to reduce the power consumption of a storage resource.","However, to date, attempts to reduce the power consumption of large storage resources have been less than successful. One reason for this is that power management protocols often focus on industry-standard Application Programming Interfaces (APIs) within storage resources. Power management logic is then applied to the storage devices (which may comprise, for example, hard disk drives) within these storage resources unilaterally without discrimination. This is, generally, sub-optimal for RAID configurations.","As an example, consider the situation where conventional power management logic is applied to a RAID 0 array. Conventional logic involves spinning down each hard disk drive when not in use. Therefore, when there is no data access, all of the hard disk drives will be spun down. However, because the data is striped across all of the hard disk drives in the RAID array, whenever any data access occurs all of the drives will spin up and become operational.","Therefore, useful power savings can only be obtained if the drives are spun down when there is a long period of total inactivity on the RAID array. Such a situation is very uncommon in modern storage systems which are operational on an almost permanent basis. Consequently, attempts to apply conventional power management logic to large-scale RAID arrays offer little practical benefit.","Other known power management implementations are disclosed in: U.S. Pat. Nos. 5,666,512; 5,423,046; 5,900,007; 5,546,558; 6,961,815; 7,035,972; 7,210,005; 7,222,216; 7,152,142; 7,330,931; and 7,398,418. Some of these arrangements focus on the provision of separate RAID arrays (for example, a mirrored RAID array and a parity-based RAID array) and data is stored on each of these arrays such that not all of the drives forming these multiple array types need to be powered on at all times. However, these arrangements require different array types and may be complicated to maintain and organise.","As set out above, known power management arrangements suffer from a technical problem that, in a storage resource comprising one or more RAID arrays, no practical power savings can be obtained within a RAID array using conventional power management logic.","According to a first aspect of the present invention, there is provided a method for power management in a storage resource, the storage resource comprising at least one RAID array including a plurality of physical drives, the method comprising: determining a reduced number of physical drives, said reduced number being less that the total number of physical drives, within a RAID array upon which data is to be concentrated; moving data stored on said RAID array and\/or targeting data written to said RAID array to one or more of said reduced number of physical drives such that said data is concentrated on said reduced number of physical drives in said RAID array; and selectively applying power management logic to enable, based on at least one power management criterion, one or more physical drives in said RAID array to be powered down or to be supplied with reduced power.","By providing such a method, the data geometry within a RAID array can be configured such that one or more of the physical drives forming part of the RAID array can be spun down (or powered down) for, ideally, an extended period using conventional power management approaches. This method provides useful power savings when compared to conventional power logic where all of the physical drives remain powered up unless there is no activity at all on the array.","In one embodiment, data is moved or targeted to one or more of said reduced number of physical drives until each of said reduced number of physical drives reaches a capacity limit.","In one embodiment, the method further comprises, when each of said reduced number of physical drives reaches a capacity limit, targeting data to physical drives other than said reduced number of physical drives.","In one embodiment, the method further comprises monitoring the access frequency of data on the RAID array; and moving more frequently accessed data to said reduced number of physical drives.","In one embodiment, less frequently accessed data is moved to or retained on physical drives other than said reduced number of physical drives.","In one embodiment, data is moved to particular physical drives in dependence upon access frequency such that data having a particular range of access frequencies is located on particular physical drives.","In one embodiment, said steps of monitoring data access frequency and moving data in dependence thereon are carried out as a background process.","In one embodiment, said background process is substantially continuous.","In one embodiment, the method further comprises: monitoring the access frequency of data on the RAID array and moving or targeting data to said reduced number of physical drives in dependence thereon.","In one embodiment, more frequently accessed data is moved to said reduced number of physical drives.","In one embodiment, less frequently accessed data is moved to or retained on physical drives other than said reduced number of physical drives.","In one embodiment, data is moved to particular physical drives in dependence upon access frequency such that data having a particular range of access frequencies is located on particular physical drives.","In one embodiment, said steps of monitoring data access frequency and moving or targeting data in dependence thereon are carried out as a background process.","In one embodiment, said background process is substantially continuous.","In one embodiment, the method further comprises providing a map to identify where data has been moved and\/or targeted to on said RAID array.","In one embodiment, said map comprises the original location and\/or destination of the data and the new location of the data after said data has been moved and\/or targeted.","In one embodiment, the method further comprises defining a plurality of storage segments on each physical drive of said RAID array, each storage segment having a storage index; wherein the step of providing said map comprises storing, for at least one storage segment, the original segment index for where the data was originally located or destined together with the corresponding actual segment index where the data is actually located.","In one embodiment, each storage segment corresponds to a logical block, sector, cluster or other defined data unit.","In one embodiment, the storage resource further comprises a file system for managing data on said RAID array, said map being operable to interface between said file system and said physical drives.","In one embodiment, said map is operable to present said original location and\/or destination of the data to said file system irrespective of said actual location of said data.","In one embodiment, said map comprises a look up table.","In one embodiment, said RAID array is controlled by a controller, and said look up table is stored in a memory of said controller and\/or in a non-volatile memory.","In one embodiment, said determining comprises a selection performed by a user on a host computer.","In one embodiment, said determining is performed automatically by a controller in response to at least one operational criterion.","In one embodiment, said at least one operational criterion is selected from the group of: storage resource usage; number of data accesses; time of day; overall power consumption of storage resource.","In one embodiment, said power management criterion is the amount of data on each of said physical drives and said step of selectively applying power management logic comprises powering down, or reducing the power supplied to, any physical drives which do not contain data.","In one embodiment, said step of selectively applying power management logic comprises powering down, or reducing the power supplied to, physical drives other than said reduced number.","In one embodiment, said physical drives other than said reduced number remain powered down until data is targeted thereto.","In one embodiment, said power management criterion is activity on said RAID array and said step of selectively applying power management logic comprises powering down, or reducing the power supplied to, any of said physical drives on the RAID array which are inactive for longer than a predetermined period.","According to a second aspect of the present invention, there is provided a controller for power management in a storage resource, the storage resource comprising at least one RAID array including a plurality of physical drives, the controller being operable to: determine a reduced number of physical drives, said reduced number being less that the total number of physical drives, within a RAID array upon which data is to be concentrated; move data stored on said RAID array and\/or target data written to said RAID array to one or more of said reduced number of physical drives such that said data is concentrated on said reduced number of physical drives in said RAID array; and selectively applying power management logic to enable, based on at least one power management criterion, one or more physical drives in said RAID array to be powered down or to be supplied with reduced power.","In one embodiment, the controller is further operable to move or target data to one or more of said reduced number of physical drives until each of said reduced number of physical drives reaches a capacity limit.","In one embodiment, the controller is further operable to, once each of said reduced number of physical drives reaches a capacity limit, targeting data to physical drives other than said reduced number of physical drives.","In one embodiment, the controller is further operable to: monitor the access frequency of data on the RAID array; and move more frequently accessed data to said reduced number of physical drives.","In one embodiment, less frequently accessed data is moved to or retained on physical drives other than said reduced number of physical drives.","In one embodiment, the controller is further operable to move data to particular physical drives in dependence upon access frequency such that data having a particular range of access frequencies is located on particular physical drives.","In one embodiment, the controller is operable to monitor data access frequency and move data in dependence thereon as a background process.","In one embodiment, said background process is substantially continuous.","In one embodiment, the controller is operable to monitor the access frequency of data on the RAID array and move or target data to said reduced number of physical drives in dependence thereon.","In one embodiment, the controller is further operable to move more frequently accessed data to said reduced number of physical drives.","In one embodiment, less frequently accessed data is moved to or retained on physical drives other than said reduced number of physical drives.","In one embodiment, data is moved to particular physical drives in dependence upon access frequency such that data having a particular range of access frequencies is located on particular physical drives.","In one embodiment, the controller is operable to carry out said monitoring of data access frequency and moving or targeting data in dependence thereon as a background process.","In one embodiment, said background process is substantially continuous.","In one embodiment, the controller is further operable to provide a map to identify where data has been moved and\/or targeted to on said RAID array.","In one embodiment, said map comprises the original location and\/or destination of the data and the new location of the data after said data has been moved and\/or targeted.","In one embodiment, the controller is further operable to: define a plurality of storage segments on each physical drive of said RAID array, each storage segment having a storage index: wherein provision of said map comprises storing, for at least one storage segment, the original segment index for where the data was originally located or destined together with the corresponding actual segment index where the data is actually located.","In one embodiment, each storage segment corresponds to a logical block, sector, cluster or other defined data unit.","In one embodiment, the controller further comprises a file system for managing data on said RAID array, said map being operable to interface between said file system and said physical drives.","In one embodiment, said map is operable to present said original location and\/or destination of the data to said file system irrespective of said actual location of said data.","In one embodiment, said map comprises a look up table.","In one embodiment, said look up table is stored in a memory of said controller and\/or in a non-volatile memory.","In one embodiment, said determining is performed by a user on a host computer connected to said controller.","In one embodiment, said determining is performed automatically by the controller in response to at least one operational criterion.","In one embodiment, said at least one operational criterion is selected from the group of storage resource usage; number of data accesses; time of day; overall power consumption of storage resource.","In one embodiment, the controller is implemented in either hardware or software.","In one embodiment, said power management criterion is the amount of data on each of said physical drives and the controller is further operable to apply selectively power management logic by powering down, or reducing the power supplied to, any physical drives which do not contain data.","In one embodiment, the controller is further operable to apply selectively power management logic by powering down, or reducing the power supplied to, physical drives other than said reduced number.","In one embodiment, said physical drives other than said reduced number remain powered down until data is targeted thereto.","In one embodiment, the controller is said power management criterion is activity on said RAID array and the controller is further operable to apply selectively power management logic by powering down, or reducing the power supplied to, any of said physical drives on the RAID array which are inactive for longer than a predetermined period.","According to a third aspect of the present invention, there is provided a computer program product executable by a programmable processing apparatus, comprising one or more software portions for performing the steps of the first to third aspects.","According to a fourth aspect of the present invention, there is provided a computer usable storage medium having a computer program product according to the eighth aspect stored thereon.",{"@attributes":{"id":"p-0087","num":"0086"},"figref":["FIG. 1","FIG. 1"],"b":["10","10","12","12","12","12"]},"The hosts  are connected to a first communication network  which couples the hosts  to a plurality of RAID controllers . The communication network  may take any suitable form, and may comprise any form of electronic network that uses a communication protocol; for example, a local network such as a LAN or Ethernet, or any other suitable network such as a mobile network or the internet.","The RAID controllers  are connected through device ports (not shown) to a second communication network , which is also connected to a plurality of storage devices . The RAID controllers  may comprise any storage controller devices that process commands from the hosts  and, based on those commands, control the storage devices . RAID architecture combines a multiplicity of small, inexpensive disk drives into an array of disk drives that yields performance that can exceed that of a single large drive. This arrangement enables high speed access because different parts of a file can be read from different devices simultaneously, improving access speed and bandwidth.","The operation of the RAID controllers  may be set at the Application Programming Interface (API) level. Typically, Original Equipment Manufactures (OEMs) provide RAID networks to end users for network storage. OEMs generally customise a RAID network and tune the network performance through an API.","Any number of RAID controllers  may be provided, and N RAID controllers  (where N is an integer) are shown in . Any number of storage devices  may be provided; in , N storage devices  are shown, where N is any integer value.","The second communication network  may comprise any suitable type of storage controller network which is able to connect the RAID controllers  to the storage devices . The second communication network  may take the form of, for example, a SCSI network, an iSCSI network or fibre channel.","The storage devices  may take any suitable form; for example, tape drives, disk drives, non-volatile memory, or solid state devices. Although most RAID architectures use hard disk drives as the main storage devices, it will be clear to the person skilled in the art that the embodiments described herein apply to any type of suitable storage device. More than one drive may form a storage device ; for example, a RAID array of drives may form a single storage device . The skilled person will be readily aware that the above features of the present embodiment could be implemented in a variety of suitable configurations and arrangements.","The RAID controllers  and storage devices  also provide data redundancy. The RAID controllers  provide data integrity through a built-in redundancy. The RAID controllers  are arranged such that, should one of the drives in a group forming a RAID array fail or become corrupted, the missing data can be recreated from the data on the other drives. The data may be reconstructed through the use of data mirroring or parity. In the case of a disk rebuild operation, this data is written to a new replacement drive that is designated by the respective RAID controller .",{"@attributes":{"id":"p-0095","num":"0094"},"figref":"FIG. 2","b":["100","102","104","106","102","104","108","104","106","110"]},"The host  comprises a general purpose computer (PC) which is operated by a user and which has access to the storage resource . Any number of hosts  may be provided. However, for clarity, only one host  is shown in . A graphical user interface (GUI)  is run on the host . The GUI  is a software application used to input attributes for the RAID controller , and acts as a user interface for a user of the host .","The RAID controller  comprises a software application layer , an operating system  and RAID controller hardware . The software application layer  comprises software applications including the algorithms and logic necessary for the initialization and run-time operation of the RAID controller . The software application layer  includes software functions such as a system manager for fault management and task scheduling. The software application layer  also receives requests from the host  (e.g., assigning new volumes, read\/write requests) and executes those requests. Requests that cannot be processed (because of lack of space available, for example) are returned as error messages to the user of the host .","The operating system (OS)  utilises an industry-standard software platform such as, for example, Linux, upon which the software applications forming part of the software application layer  can run. The operating system  comprises a file system  which enables RAID controller  to store and transfer files.","The RAID controller hardware  is the physical processor platform of the RAID controller  that executes the software applications in the software application layer . The RAID controller hardware  comprises a microprocessor, memory , and all other electronic devices necessary for RAID control of the RAID array .","The RAID controller hardware  also comprises the firmware or software for an enhanced power manager (EPM)  on the RAID array . The EPM  is configured to reduce power consumption of the RAID array  as will be described later.",{"@attributes":{"id":"p-0101","num":"0100"},"figref":"FIG. 3","b":["104","106","106","126","126","1","126","4","126"]},"Each physical drive  forms part of a RAID 0 array and the data stored thereon is stored in the form of data \u201cstripes\u201d in which the data to be stored is broken down into blocks called \u201cstripe units\u201d. The \u201cstripe units\u201d are then distributed across the physical drives . This is shown in  where stripe units A to A are illustrated as being stored across each of the four physical drives .","The RAID 0 array of physical drives  is, via the RAID controller , presented to the host  as a logical drive . This is shown schematically in . However, any number of logical drives  may be provided. Upon the logical drive  may be defined one or more volumes which can be read\/write accessed by the host . The logical drive  may each be considered to be a usable region of storage capacity located on one or more of the physical disk drive components  forming the RAID array and includes the data stripes A to AN (and includes the stripes A to A as shown stored on the physical drives ).","The logical drive  can be accessed by the host  and RAID controller  to read\/write data. Input\/output processing can also be carried out on the logical drive  in the manner of an actual physical drive; for example, defragmentation, rebuilding or backup operations. Therefore, the host  does not have visibility of the actual physical arrangement of data across the physical drives \u2014this is handled by the OS  and file system .",{"@attributes":{"id":"p-0105","num":"0104"},"figref":["FIG. 3","FIG. 3"],"b":["124","126","1","126","2","126","3","126","4","130","130","126","130"]},"Commonly, the physical drives  are formatted such that each segment  comprises 512 bytes (4096 bits). The term \u201csegment\u201d used herein, whilst described in an embodiment with particular reference to 512 byte logical block sizes, is generally applicable to any sector or segment size. Therefore, the term \u201csegment\u201d is merely intended to indicate a portion of the storage availability on a physical drive and is not intended to be limited to any of the disclosed examples. The optimal choice is dependent upon the file system, the data base and\/or the type of accesses involved.","Each segment  on each physical drive  has an address. Where each segment  corresponds to a logical block, this is known as a logical block address (LBA). As shown schematically in , each segment  has a file system segment index  identifying the address of that particular segment to the file system . The term \u201cfile system segment index\u201d is used because this is the address of the data as it appears to the file system (irrespective of the actual address of the data on the RAID array ) as will be described later. The file system segment index comprises both the target physical drive reference (i.e. the drive  upon which the data is stored) and the segment index within that drive .","As shown in , data is striped across each of the physical drives -, -, -, - in the form of stripe units A-A. Therefore, when a data file which (for the purposes of this illustration) comprises stripe units A-A, all of the physical drives -, -, -, - are required to spin up. Therefore, applying conventional power management logic to this configuration will result in little or no power savings unless there is no activity at all on the RAID array. Since this is likely to be a rare situation, relatively little benefit can be had from conventional power management implementations in this data storage configuration.",{"@attributes":{"id":"p-0109","num":"0108"},"figref":["FIG. 4","FIG. 3"],"b":["124","124","126","126","126"]},"Therefore, as shown in , by moving data (in the form of stripe units A-A) from all four physical drives -, -, -, - to reside on just two of the physical drives -, -, the remaining two physical drives -, - can be powered down and remain idle. This provides a 50% reduction in power consumption (not taking into account the power of the physical drives -, - which require a relatively small amount of power to idle).","Once the EPM  has remapped the data on the physical drives , the data now resides at a new address. In other words, each segment of the moved data now resides at a second, actual segment index . Consequently, if the OS  or file system  were to attempt to access the data at the old location (i.e. at the original file system segment index ), an error would be generated because the data is no longer present at that location. Consequently, a transfer map  is provided as part of the EPM . The transfer map  presents to the OS  a consistent image of the location of data across the physical drives  irrespective of the actual location of data on the physical drives .","As shown in , the EPM  comprises the transfer map . The transfer map  comprises a map of the data which has been moved following the geometry analysis by the EPM . The transfer map  provides a correlation between the file system segment index  (as shown in ) of each segment  containing data prior to operation of the EPM , and the actual segment index  (as shown in ) of the data once moved by the EPM .","In other words, the transfer map  can be used to provide a translation map between the original location of the data and the new, power management optimised, location of the data. This enables the data contained on the physical drives  to be accessed by the file system  and OS  without a priori knowledge of the new location of the data.","A schematic diagram of the transfer map  is shown in . In , the transfer map  is illustrated with reference to stripe units A, A and A as shown in . Stripe unit A was initially located on physical drive - at file system segment index  and remains in this location after optimisation of the drives  by the EPM . Therefore, the transfer map  for the data at segment index  on drive - has direct correspondence between the pre-and post-optimisation locations of stripe unit A.","However, for data stripe units A and A, their locations differ before and after the EPM optimisation process. For stripe unit A which was initially stored on drive - in file system segment index , this data is now stored on drive - in actual segment index . Similarly for data stripe unit A, this data was initially stored on drive - in file system segment index  and has been moved to drive - in actual segment index . Therefore, the transfer map  provides direct correlation between the original data location and the new data location. Consequently, a consistent view is presented to the OS  and file system , irrespective of the data's actual location with the RAID 0 array when reading and writing data.","In use, new data will be written to the RAID array . Whilst the OS  and file system  will attempt to write the data to the drive in standard RAID 0 format, the EPM  will direct data to appropriate locations to achieve the desired power savings. For example, the EPM  will direct data to fill up the operational drives - and - first rather than distribute data across each of the physical drives  as shown in .","In this case, the file system segment index  will correspond to the target destination for the write, whereas the actual segment index  will be where the data is directed to by the EPM  and is actually stored. The file system segment index  will then be stored with the actual segment index  in the transfer map  such that the data locations on the RAID array appear to the file system  as the file system segment indices .","As described above, any data already existing on the RAID 0 array is moved to enable data to be stored on fewer physical drives . In addition, newly-written data is directed towards the physical drives  in use such that a number of drives  in the array can remain powered down.","However, after a period of time, the amount of data written to the array might be greater than the amount of storage space available on (to use the example of this embodiment) the powered-up physical drives - and -. In this case, the remaining drives - and - will have to be used, reducing the power savings achievable.","However, there are still steps that can be taken to reduce power consumption. For example, the EPM  can maintain a log of the access frequency of data on the RAID array. This log could, in one implementation, be incorporated into the transfer map . The EPM  could then move data around on the RAID array (a process known as \u201cbackground grooming\u201d) to ensure that the most frequently accessed data is co-located on a single, or reduced number, of physical drives .","For example, consider the situation where the EPM  locates the most frequently accessed data on physical drives - and -. Therefore, even though physical drives - and - may contain data, this data is infrequently accessed and so conventional power management logic can be applied to these drives with useful power savings. Consequently, physical drives - and - can be maintained in a powered-down state for longer than would be achievable in a conventional RAID array where data is distributed across all of the drives in the array, irrespective of access frequency.","As the EPM  moves data on the physical drives , the transfer map  is updated to reflect the new actual segment index  which indicates where the data is actually stored.","Therefore, through use of the EPM , data can be reorganized intelligently to enable more effective (and possibly multi-layer) power management logic to be applied to a RAID array such that beneficial reductions in power consumption can be obtained.","For example, in a situation where some of the physical drives  in the RAID 0 array are empty after reorganization of the data on the RAID array as discussed above, then the EPM  can explicitly power those physical drives  down immediately. Those physical drives  can then be maintained in a powered down, or reduced power, state until such time as data is actually targeted to those particular physical drives .","In addition or in the alternative, standard power management logic can also be applied to the RAID array. For example, any windows of inactivity for any of the physical drives  on the RAID array can be identified and the relevant physical drives  powered down. This may include the physical drives to which data has been concentrated, the physical drives which have been left empty or containing less frequently accessed data, or both. The method and apparatus of the present invention, essentially, enables standard power management approaches based on inactivity to be more effective.","Consequently, the combination of the intelligent reorganization of the data by the EPM , together with the application of explicit and standard power management approaches enables a newly improved level of power savings to be achieved within a RAID array.","Another example of enhanced power management is illustrated with respect to .  illustrate the application of the EPM principle to a RAID 5 array. In this embodiment, the storage device  comprises five physical drives - to -.","The RAID 5 array of physical drives  is, via the RAID controller , presented to the host  as a plurality of logical drives  as described previously with reference to . Any number of logical drives  may be provided and, in this embodiment, N logical drives are shown schematically. Upon each logical drive  may be defined one or more volumes which can be read\/write accessed by the host . The logical drives  may each be considered to be a usable region of storage capacity located on one or more of the physical disk drive components  forming the RAID 5 array.","In common with  of the previous embodiment,  illustrates a situation where the EPM  is switched off or is not operational. Therefore, effectively,  shows a standard RAID 5 array. Each physical drive -, -, -, -, - comprises a number of sectors or segments . Each segment  comprises a block of data storage on the respective physical drive .","As shown in , data is striped across each of the physical drives -, -, -, -, - in the form of stripe units A-A. Additionally, parity data stripe units Pand Pare provided for data redundancy. Again, applying conventional power management logic to this configuration will result in little or no power savings unless there is no activity at all on the RAID array. Since this is likely to be a rare situation, relatively little benefit can be had from conventional power management implementations in this data storage configuration.",{"@attributes":{"id":"p-0131","num":"0130"},"figref":["FIG. 7","FIG. 6"],"b":["124","124","226","226","226"]},"Therefore, as shown in , by moving data (in the form of stripe units A-A and parity data stripe units Pand P) from all five physical drives -, -, -, -, - to reside on just three of the physical drives -, - (for stripe unit data) and - (for parity data), two physical drives -, - can be powered down and remain idle. This provides a 40% reduction in power consumption (not taking into account the power consumption of the physical drives -, - which require a relatively small amount of power to idle). Further, as an artifact of movement of data onto fewer drives, the RAID 5 array under EPM effectively becomes a RAID 4 array.","Whilst the above examples have been described illustrated with reference to RAID 0 and RAID 5 arrays, the present invention is applicable to other RAID configurations. The skilled person would be readily aware of alternative systems or arrays that could be used with the present invention. Further, the present invention is applicable to storage systems comprising multiple arrays. Clearly, the power savings achieved with the present invention are increased when applied to larger networks of physical drives.","As shown in the above embodiments, the present invention enables data to be stored on a RAID array in locations that would specifically allow for a particular number of drives to remain un-accessed and therefore able to spin down for extended time periods. Within storage arrays, physical drives are responsible for the vast majority of power consumption, and those storage arrays are responsible for the bulk of the power consumption within typical data centres.","Therefore, by utilising the approach of the present invention, a meaningful percentage of drives can remain spun down, providing large benefits to the overall IT management community.","Additionally, most storage arrays are configured by administrators to maintain a non-trivial percentage of minimum free space. This further benefits the present invention because drives selected to remain powered up can be filled to a capacity greater than that normally set by system administrators, making more efficient use of the storage space available.","The above approaches illustrate situations where, for clarity, a conventional RAID array with data stored thereon, is optimised by activation of the EPM process . However, it is to be appreciated that the EPM  could be run permanently from switch-on of a new RAID array.","Additionally, the EPM  will operate in the background on an array and continually migrate data based on access frequency such that only a proportion of the physical drives in a RAID array contain the most frequently accessed data. In other words, the most frequently accessed data is grouped on particular physical drives, thereby enabling other physical drives to be powered down for extended periods.","An example of this in use is a situation where previously frequently accessed data is deleted. In this case, the EPM  will note that a portion of a physical drive is accessed less frequently than other portions thereof. Consequently, the EPM  logic in the RAID controller  would eventually detect low-activity areas on the drives and migrate data accordingly to ensure that frequently accessed data is grouped together.","Additionally, as part of the EPM  there could also exist file system mapping logic at the host  level (either embedded in the OS or off-host) to instruct the controller when file data has been deleted so the corresponding areas on the drives could be proactively cleared from the EPM maps in the controller.","An important advantage of the above-described arrangements is that complex power management schemes are not required with the EPM  operating. In contrast, conventional power management approaches will now be effective on a RAID array. For example, simply applying a common timer-based power management scheme (fixed or dynamically variable) to the physical drives affiliated with each chunk\/sub-stripe grouping would yield significant benefits.","However, in practice, the operation of the EPM  will reduce the number of physical drives ;  in normal use on the RAID array forming part of the storage resource . Consequently, because fewer physical drives ;  are available, access\/write time for data may be increased because the data transfer must be completed across fewer drives. Additionally, latency may be affected. This is simply an unavoidable consequence of utilising fewer drives in normal operation. Additionally, the use of fewer drives to store a given amount of data may lead to reduced reliability in the form of shorter mean time between failures (MTBFs).","However, the above effects can be mitigated by selecting the degree of operation of the EPM . For example, the level of power management could be selected by a user, or selected automatically by the RAID controller  based on knowledge of the user demand on the RAID array.","The level of power management will determine the involvement of the EPM  in reorganizing the data on a RAID array. The level could be specified in a number of ways; for example, the user could utilise a slider bar to set a percentage of power saving vs performance\/reliability. Alternatively, the user could specify a percentage or number of drives to be powered down in normal use.","Taking the example of , a user could specify a particular maximum number or maximum proportion of physical drives which are to be powered down. In this case, say, for example, only one drive could ever be powered down to preserve access\/write speed to the RAID array, only drive - could be powered down and the EPM  would distribute data across drives -, - and - with only infrequently accessed data being stored on the physical drive - if drives -, - and - do not collective comprise sufficient capacity for all the data on the array.","In the alternative, if maximum power savings are required, the EPM  may power down drives -, - and - whilst maintaining drive - in a powered-on state.","Of course, the amount of data, and the access frequency of that data, will impose limits on the power savings achievable. If three of the four drives contain frequently accessed data, the EPM  will not be able to power down more than one drive for extended periods. However, even in this case, significant power savings can be obtained over conventional power management schemes.","The operation of the network storage resource  will now be described with reference to .  shows a flow diagram of the method of operation of the EPM .","Step : EPM Activated","At step , the EPM  is activated. This may be done on-host by a user, or may be done on- or off-host automatically by the RAID controller  in response to a particular criteria. The EPM  may be activated at initialization of a storage resource , or when the storage area network is operational . In other words, the EPM  is operable whether data exists on the RAID array or not.","The method now proceeds to step .","Step : Set Power Management Level","The power management level sets the degree of control that the EPM  has over the reorganization of data on the RAID array. The power management level enables a user to select a level of power management on a scale from maximum power efficiency up to maximum reliability\/performance. This may, for example, take the form of a slider bar which the user sets at a desired level.","Alternatively, the user may request that the data on the RAID array be organised such that the a particular number of drives in the array are to be spun down in normal use\u2014e.g. 2 drives out of 4, or 5 drives out of 10. Instead of a number, the user could also specify a proportion of drives\u2014for example, as a percentage. This would be automatically calculated in view of the number of drives and the desired proportion to be spun down.","As a further alternative, the power management level could be set automatically by the RAID controller , on- or off-host software or firmware, or by the file system. This may enable the system to be adaptive in use by, for example, increasing performance of the system in periods of particularly high use on the storage resource  (where access time may be a critical factor) whilst increasing power efficiency during times of lower activity (when access time is of less concern).","There may be situations where, due to the nature of data on the array, a particular power management level may not be available. In this situation, options may be presented as unavailable to the user, or the EPM  may simply get as close as possible to the desired power management level given the array configuration.","The method then proceeds to step .","Step : Analyse Array Geometry","The EPM , as part of the RAID controller , then analyses the arrangement of data on the RAID array. The EPM  is operable to analyse the number of drives in the array, the data (if any) stored thereon and the location of that data on the drives. At this stage, the transfer map  is generated and can be updated with details of the file system segment index for each of the data segments or blocks on the RAID array.","Once the array geometry has been analysed, in view of the specified power management level, any existing data on the array can be migrated in step . If there is no data to migrate on the array (i.e. if the array is empty), then the method proceeds directly to step .","Step : Migrate Existing Data.","At step , if it has been determined in step  that data is present on the RAID array, the EPM  is operable to migrate that data to reduce the number of drives that the data is spread across. At this stage, information relating to access frequency is unavailable. Therefore, the EPM  migrates data to locate the data on fewer drives than the total number of drives in the array as specified in accordance with the power management level set in step , enabling unused drives to be powered down.","The method then proceeds to step .","Step : Update Transfer Map","At step , the transfer map  is updated to reflect the data migrations that have happened in step . The transfer map  now maintains the file system segment index  (i.e. the original configuration of data, or layout of data segments, on the array) and the actual segment index  (i.e. where the data is now located after migration).","The method then proceeds to step .","Step : Log Data Writes","At step , the EPM  monitors writes to the RAID array from the host  or other accessing hosts. When a write request to a particular address is received, this is logged as the file system segment index  in the transfer map and the data is written to a selected location on the array in dependence upon the power management level and EPM logic. The actual location of the written data will then be stored in the transfer map  as the actual segment index  of that data.","The method then proceeds to step .","Step : Monitor Data Access Frequency","At step , the EPM  monitors the access frequency of data on the RAID array. This is performed continuously as a background whilst the EPM  is active. The access frequency may be stored in the transfer map , or alternatively may be stored as a separate look up table (LUT).","Step : Migrate Data","Based upon the access frequency of the data on the drives of the RAID array, the EPM  can co-located most frequently accessed data on one or more drives. This is done as a continuous background monitoring process. Therefore, if any data is deleted from one of the drives containing frequently accessed data, the space left will be filled with other frequently accessed data from another drive in the array.","Step : Update Transfer Map","Based on the migration of data in step , the transfer map  is updated to reflect the new location of the moved data.","The method then proceeds back to step  whilst the EPM  is active. However, the loop is broken when the EPM  is disabled; for example, by a user.","Once the EPM  is active, or has been run on the RAID array, data is reorganized intelligently to enable more effective (and possibly multi-layer) power management logic to be applied to a RAID array such that beneficial reductions in power consumption can be obtained.","Therefore, the EPM  may power down any physical drives ;  in the RAID array which are empty after reorganization of the data on the RAID array as discussed above. These physical drives ;  can then be maintained in a powered down, or reduced power, state until such time as data is actually targeted to those particular physical drives ; .","In addition or in the alternative, standard power management logic can then be applied to the RAID array. For example, any windows of inactivity for any of the physical drives  on the RAID array can be identified and the relevant physical drives  powered down. This may include the physical drives to which data has been concentrated, the physical drives which have been left empty or containing less frequently accessed data, or both. The method of the present invention, essentially, enables standard power management approaches based on inactivity to be more effective.","Consequently, the combination of the intelligent reorganization of the data by the EPM , together with the application of explicit and standard power management approaches enables a newly improved level of power savings to be achieved within a RAID array.","The EPM  and associated transfer map  can be used in other RAID operations. For example, an essential feature of a RAID array file system (with a RAID level above 0) is that of a rebuild operation. If, for example, the one of the physical drives should become corrupted or fail, or if one or more of the drives is replaced to increase capacity or speed, then a rebuild operation will be required.","In this case, the newly swapped-in drive can be rebuilt using the data stored on the other drives and by querying the transfer map  to locate the data appropriately on the remaining devices.","In normal use, the EPM implementation described above will be effectively invisible to the file system , operating system  and host . This means that the host  will be presented with a view of the RAID array which is preferably similar to that of a standard RAID array, with the operation of the EPM being hidden to the host . However, there may be circumstances in which the EPM file structure and interface could be exposed to the host .","One of these circumstances may arise when, a backup is required. In this case, an interface to the data store and management infrastructure could be exposed for backup purposes.","The interface to the EPM configuration may be exposed through a proprietary Application Programming Interface (API) or through a conventional file system on one of the drives of the RAID array (where the data store and affiliated management infrastructure is encapsulated inside one or more files). This approach may yield significant benefits in terms of backup performance when compared to conventional host-based file system approaches.","In a conventional, host-based file system, a significant portion of the time expended in backing up a storage device or logical volume is spent analysing the data. Commonly, every file is required to be touched or opened during the backup process. Even in cases where traditional image backup methods are used typically utilise a pre-analysis of the data or require the entire drive or volume to be processed (including unused free space on the drive or volume).","In contrast, in the EPM approach, the data has been already analysed and stored relative to particular protocols. Therefore, a backup operation could simply backup these file streams with speeds matching image backups, but without any additional processing overhead.","Additionally, whilst the embodiments of the present invention described above operate predominantly in off-host firmware or software (e.g. on the RAID controller ), an on-host arrangement could be used. In this arrangement, the whole of the EPM operation is carried out in on-host software input\/output (I\/O) subsystems.","Variations of the above embodiments will be apparent to the skilled person. The precise configuration of hardware and software components may differ and still fall within the scope of the present invention.","For example, the transfer map may provide translation between primary data storage locations and secondary data storage locations in other manners; for example, logical block addresses, cylinder head sectors or a different file mapping arrangement.","Embodiments of the present invention have been described with particular reference to the examples illustrated. While specific examples are shown in the drawings and are herein described in detail, it should be understood, however, that the drawings and detailed description are not intended to limit the invention to the particular form disclosed. It will be appreciated that variations and modifications may be made to the examples described within the scope of the present invention."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"p":["Embodiments of the present invention will now be described in detail with reference to the accompanying drawings, in which:",{"@attributes":{"id":"p-0079","num":"0078"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0080","num":"0079"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0081","num":"0080"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0082","num":"0081"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0083","num":"0082"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0084","num":"0083"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0085","num":"0084"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0086","num":"0085"},"figref":"FIG. 8"}]},"DETDESC":[{},{}]}
