---
title: System and method for synchronizing a selected master circuit with a slave circuit by receiving and forwarding a control signal between the circuits and operating the circuits based on their received control signal
abstract: A mechanism for synchronizing a multiple-circuit system, includes (a) selecting a master circuit from a plurality of circuits, the remaining circuits including at least one slave circuit, (b) receiving, at each of the plurality of circuits, input data and a local clock signal associated with the input data, (d) generating at least one control signal at the master circuit using the local clock signal of the master circuit, (e) outputting the control signal from the master circuit, (f) forwarding the control signal to the slave circuit(s), (g) looping back the control signal to the master circuit, (h) processing the input data at the slave circuit(s) using the forwarded control signal, (i) processing the input data at the master circuit using the looped-back control signal, and (j) outputting the processed data from each of the plurality of circuits.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=06952789&OS=06952789&RS=06952789
owner: LSI Logic Corporation
number: 06952789
owner_city: Milpitas
owner_country: US
publication_date: 20010912
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["RELATED APPLICATIONS","FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","BRIEF DESCRIPTION OF THE INVENTION","DETAILED DESCRIPTION"],"p":["This application claims the benefit of U.S. Provisional Patent Application Ser. No. 60\/290,551 filed on May 11, 2001 in the names of Khalid Azim, Venkat Yadavalli and Keven Hui.","The present invention relates to operation of a multiple-circuit system. More particularly, the present invention relates to synchronization of a multiple-circuit system and controlling data skew among the multiple circuits.",{"@attributes":{"id":"p-0004","num":"0003"},"figref":["FIG. 1","FIG. 1"],"b":["10","12","14","14","14"]},"As the bus width become wider to achieve faster data rate, more data link connections are required. For example, in channel-based point-to-point connections such as an Infiniband application, a word is encoded and sent out through up to 12 different channels\/lanes, and thus it is required to provide a 12-lane high speed serial link (current chip implementations handle up to 4 lanes which provides up to 4\u00d73.125 Gigabits\/sec for Ethernet). In order to provide such a multiple data lane connection, a plurality of I\/O circuits, typically transceivers, should be ganged together.","The specification of multi-link connections typically includes requirements for acceptable skew at the serial data outputs across multiple I\/O circuits. For example, in the Infinivand application described above, the delay skew across all 12 lanes at the serial outputs has to be 500 picosecond (ps) or less according to the current electrical specification. During the serialization, the I\/O circuits are also required to align all incoming parallel data to within the same byte\/cycle.","However, when two or more I\/O circuits or chips which are referencing to different forwarded clocks are bundled, the data coming out of the different circuits\/chips are not necessarily in sync. Due to the timing skew caused by a number of variations including process, temperatures, voltages, and board traces skew, synchronization of these output data across the multiple circuits\/chips becomes a difficult task. Such a multiple-circuit system using different local clocks also puts a significant limitation on chips placement and board routing in order to minimize the skew across all different clocks. Thus, ganging a plurality of I\/O circuit\/chips without any special circuit techniques will result in large and out-of-spec data skews between different circuits, making the system unusable.","Accordingly, it would be desirable to provide a scheme for synchronizing a multiple-circuit system such as a system including a plurality of I\/O circuitry units, and for controlling data skew across multiple circuits.","A mechanism for synchronizing a multiple-circuit system, includes (a) selecting a master circuit from a plurality of circuits, the remaining circuits including at least one slave circuit, (b) receiving, at each of the plurality of circuits, input data and a local clock signal associated with the input data, (d) generating at least one control signal at the master circuit using the local clock signal of the master circuit, (e) outputting the control signal from the master circuit, (f) forwarding the control signal to the slave circuit(s), (g) looping back the control signal to the master circuit, (h) processing the input data at the slave circuit(s) using the forwarded control signal, (i) processing the input data at the master circuit using the looped-back control signal, and (j) outputting the processed data from each of the plurality of circuits.","Embodiments of the present invention are described herein in the context of a method and apparatus for synchronizing a multi-circuit system. Those of ordinary skill in the art will realize that the following detailed description of the present invention is illustrative only and is not intended to be in any way limiting. Other embodiments of the present invention will readily suggest themselves to such skilled persons having the benefit of this disclosure. Reference will now be made in detail to implementations of the present invention as illustrated in the accompanying drawings. The same reference indicators will be used throughout the drawings and the following detailed description to refer to the same or like parts.","In the interest of clarity, not all of the routine features of the implementations described herein are shown and described. It will, of course, be appreciated that in the development of any such actual implementation, numerous implementation-specific decisions must be made in order to achieve the developer's specific goals, such as compliance with application- and business-related constraints, and that these specific goals will vary from one implementation to another and from one developer to another. Moreover, it will be appreciated that such a development effort might be complex and time-consuming, but would nevertheless be a routine undertaking of engineering for those of ordinary skill in the art having the benefit of this disclosure.",{"@attributes":{"id":"p-0023","num":"0022"},"figref":["FIG. 2","FIG. 2"],"b":["20","20","22","24","22","30","32","34","36","38","34","32","30","30"]},"Each slave circuit  includes a signal processing portion , a synchronous input port , and a control signal input port . Input data (Dm) and a local clock signal (TCXm) associate with the input data sent from a data source (not shown) are received at the synchronous input port  and input to the signal processing portion .","The control signal generated in the master circuit  is output via the control signal output port  onto a control signal bus . The control signal bus  is coupled from the control signal output port  of the master circuit  to the control signal input port  of each slave circuit , and to the control signal input port  of the master circuit .","The output control signal is supplied to each slave circuit  and received at the control signal input port . The signal processing portion  of the each slave circuit  processes the input data (Dm) in accordance with the control signal. The processed data is output via at least one output port  of the slave circuit .","The control signal is also looped back to the control signal input port  of the master circuit , and the signal processing portion  processes the input data (Di) in accordance with the looped-back control signal. The processed data is output via at least one output port  to a corresponding data lane. It should be noted that the control signal is not input to the signal processing portion  directly from the control signal generator , but is output from the master circuit  and then distributed thereto via the control signal bus . Thus, the master circuit  sees the delay in the control signal caused by the process, voltage, and temperature (PVT) variations internal to the master circuit as well as external delay such as traveling the bus.","Thus, by generating all necessary control signals at the master circuit  and forwarding them to the slave circuit(s)  and to the master circuit  itself, all the circuits of the system are operated by the same control signal including substantially the same delay. This eliminates variations caused by using a different local clock signal in each circuit, and also eliminates most of the delay factors due to variations internal to each circuit, which are random in nature and difficult to control.","According to one embodiment of the present invention, the master circuit  may further include a global control signal input port  to receive a global control signal, as shown in . The control signal generator  generate at least one control signal based on the global control signal. In addition, the master circuit  and the slave circuit(s)  may have the identical circuit structure, i.e., the slave circuit(s)  may include a portion capable of generating a control signal. In such a case, however, such a portion may be disabled (or not used) so that the slave circuit(s)  is operated solely by the control signal supplied from the master circuit .",{"@attributes":{"id":"p-0030","num":"0029"},"figref":"FIG. 3","b":["50","50","52","52","52"]},"Each circuit  receives input data (Dj) and an associated local clock (TCXj) from the corresponding data source  (0\u2266j\u2266N). Each circuit includes a serializer  to convert the group of parallel data into a group of serial data, and outputs the serial data onto M data lanes via the corresponding serial output ports (1\u2266M). Thus, the system  provides N\u00d7M serial data link connections. The multi-circuit system  further includes a clock source  to supply a common reference clock signal (Refclk) to each data source  and each circuit .","Since each circuit  receives a separate local clock TCXj, there will be some phase skew between these clocks due to board trace, process, voltage, temperature, and some other variations. If there is no realignment scheme, these parallel data can be latched in different cycle\/byte when they are clocked into the serializer  by the common clock (Refclk). When such a misalignment happens, the serial data output across the multiple circuits can be off by one whole cycle.","One embodiment of the present invention provides a scheme to synchronize the serial outputs across multiple circuits\/chips within a predetermined time period. The scheme includes two main parts: aligning all parallel input data across a plurality of circuits within one clock cycle; and managing the skew of the serial outputs within a predetermined time period across the multiple circuits. The synchronizing scheme is explained in detail using the following example.",{"@attributes":{"id":"p-0034","num":"0033"},"figref":["FIG. 4","FIG. 3"],"b":["60","50"]},"Referring to , the multiple-circuit system  includes a plurality of circuits, and one of the circuits is selected as the master circuit . Any circuit can be the master circuit . The remaining at least one circuits is at least one slave circuit . Each circuit of the system  has a synchronous parallel input port for receiving a group of parallel data and a local clock signal (TCX) associated with the group of parallel data (the data input is not shown in  for simplicity).","As shown in , the master circuit  includes a global control signal input port  to receive a global control signal RSTi (for example, Reset\/enable signal), a first synchronizer  for clocking the global control signal (RSTi) with the local clock signal (TCXi) so as to generate a first control signal (SyncRST). The first control signal (SyncRST) is output from a first control signal output  (as a signal SyncRESTout), and looped back to the master circuit  itself and forwarded to each slave circuit .","The master circuit  further includes a first control signal input  for receiving the first control signal looped back from the first control signal output port  (as a signal SyncRSTin), a first enable signal generator , a data storage unit  (for example, a FIFO storage), a clock input port  to receive a common clock signal (RefClk), a second synchronizer , a second control signal output , a second control signal input , and a second enable signal generator . The first enable signal generator  clocks the first control signal (SyncRSTin) with the local clock signal (TCXi) so as to produce a first enable signal (wrtEn). The parallel input data is written into the data storage unit  in accordance with the first enable signal (wrtEn).","In each slave circuit , which has the same circuit structure as the master circuit , the forwarded first control signal (SyncRSTin) is received at a first control signal input \u2032. A first enable signal generator \u2032 clocks the first control signal with the local clock signal (TCXn) so as to produce a first enable signal (wrtEn). The parallel input data is written into the data storage unit \u2032 in accordance with the first enable signal (wrtEn) in the same manner as that in the master circuit .","At the master circuit , the first enable signal (wrtEn) is also supplied to the second synchronizer , which clocks the first enable signal (wrtEn) with the common clock signal (RefClk) so as to generate a second control signal (rdEn). The second control signal is output from the second control signal output  (as a signal rdEnout), and forwarded to the master circuit  itself and to each slave circuit .","At the master circuit , the second control signal is received at the second control signal input  (as the looped back signal rdenIn), and the second enable signal generator  clocks the second control signal with the common clock signal (RefClk) so as to produce a second enable signal (SyncrdEn). The input data written to and stored in the data storage unit  is read therefrom in accordance with the second enable signal (SyncrdEn) and supplied to a serializer .","Similarly, in each slave circuit , the forwarded second control signal (rdEnIn) is received at a second control signal input \u2032. A second enable signal generator \u2032 clocks the second control signal with the common clock signal (RefClk) received at a clock signal input port \u2032 so as to produce a second enable signal (SyncrdEn). The input data written to and stored in the data storage unit \u2032 is read therefrom in accordance with the second enable signal (SyncrdEn) and supplied to a serializer \u2032 in the same manner as that in the master circuit .","It should be noted that although each slave circuit  has the same structure as the master circuit , the portions for generating the control signals (such as the first and second synchronizers) in the slave circuit  is disabled and\/or not used in operating the circuit. For example, as shown in , the global control signal input port \u2032 of the slave circuit may be grounded.",{"@attributes":{"id":"p-0043","num":"0042"},"figref":"FIG. 5","sub":["\u2014","\u2014","\u2014","\u2014","\u2014","\u2014"]},"As shown in , in the master circuit, the first control signal (SyncRST) is generated at the first rising edge of the local clock signal (TCX-2) after the global control signal (RSTi) goes low. The first control signal is distributed to each circuit (master, slave) as the input control signal (SyncRSTIn) with a delay (Tdlay). Then, the first rising edge of the local clock signal (TCX-2) after the first control signal (SyncRSTIn) goes low drives the first enable signal (WrtEn) high (a write enable flag on), which triggers the write operation in the next cycle. Similarly, at the first rising edge of the common clock signal (Refclk) after the first enable signal (WrtEn) goes high, the second control signal (rden) is generated (goes high). The second control signal is distributed to each circuit as the second input control signal (rdenIn) with a delay (Tdlay). Then, the first rising edge of the common clock signal (Refclk) after the second control signal (rdenIn) goes high drives the second enable signal (Sync rden) high (a read enable pointer on), which triggers the read operation in the next cycle.","\u201cTdlay\u201d denotes a delay from the control signals generated in the master circuit to the control signals supplied to each circuit: the delay from the first control signal generated in the master circuit (SyncRST) to the first control signal supplied to each circuit (SyncRSTIn); and the delay from the second control signal generated in the master circuit (rden) to that supplied to each circuit (rdEnIn). The delay includes propagation delay of 10 buffers, all the internal cells, packages and board trace flight time. The amount of the delay due to variations internal to the master circuit is substantially identical for each circuit, as discussed above. In addition, the master circuit may be selected so as to minimize the difference in signal path lengths from the master circuit to each slave circuit and to the master circuit itself. Thus, each circuit receives the same control signals at substantially the same timing or with a minimum variation. Since in each circuit the first enable signal is generated using the same first control signal (SyncRSTIn), and the second enable signal is generated using the same second control signal (rdEnIn), instead of generating thees control signals in each circuit, statistical and\/or uncontrollable inter-circuit variations due to process, temperature, voltage, etc. are minimized.",{"@attributes":{"id":"p-0046","num":"0045"},"figref":"FIG. 6"},"For a setup margin,\n\nSetup Margin=Period\u22122\u2212()\u2212(),\n\nwhere Period is the time period for one clock cycle. It should be noted that all clock signals have the same frequency. The above equation is the worst case of setup margin. Master TCX-2 clock is later than slave TCX-2 clock by maximum \u201ctsktcx,\u201d thus master chip is in worst case corner (WNWP, 125\u00b0 C., Vdd\u221210%) and slave chips are in best case corner (SNSP, 0\u00b0 C., Vdd+10%).\n","For a hold margin,\n\nHold Margin=()+()\n\nThe above equation is the worst case of hold margin. Master TCX-2 clock is later than slave TCX-2 clock by maximum \u201ctskcx\u201d thus master chip is in best case corner (SNSP, 0\u00b0 C., Vdd+10%) and slave chips are in worst case corner (WNWP, 125\u00b0 C., Vdd\u221210%).\n","It should be noted that these numbers are used to calculate maximum margins for the control signals only, and they do not represent the timing budget and margin for the maximum lane to lane skew itself.","Once byte alignment is performed by synchronizing the control signals, as described above, skew at the serial outputs can be controlled to certain range. From the output of the FIFO to the serial output at the pin level, there are several parts that contribute to the total skew. Placement error of the common clock signal (Refclk) or skew of the common clock signal (Refclk) at the serializer's multiplexer level between all the data lanes is one contributor. This skew can depend on process, voltage, and temperature (PVT) variation of insertion delay of all the cells on the clock path and clock generation scheme. Package skew and PVT variation of insertion delay of all the cells on the data path will also contribute to the total data skew.",{"@attributes":{"id":"p-0051","num":"0050"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0052","num":"0051"},"figref":"FIG. 8","b":["20","50"]},"First, a master circuit is selected from a plurality of circuits, the remaining circuits being at least one slave circuit (). At least one control signal is generated at the master circuit using the local clock signal of the master circuit (). The control signal(s) is forwarded to each slave circuit (), and at the same time looped back to the master circuit (). The master circuit is operated using the looped-back control signal(s) (), and the slave circuit(s) are operated using the forwarded control signal(s) (). By property selecting parameters, operation timings of the circuits (master circuit and at least one slave circuit) are aligned within one clock cycle. The data processed by the operation is output (), and skew across the circuits is controlled to be within a predetermined time period ().",{"@attributes":{"id":"p-0054","num":"0053"},"figref":"FIG. 9","b":"60"},"First, a master circuit is selected from a plurality of circuits, the remaining circuits being at least one slave circuit (). A global control signal is received at the master circuit (), and a first control signal is generated by clocking the global control signal with the local clock signal of the master circuit (). The first control signal is output from the master circuit and distributed to each circuit of the system. That is, the first control signal is looped back to the master circuit () and forwarded to the slave circuit(s) ().","At the master circuit, the distributed first control signal is clocked with the local clock signal () so as to produce a first enable signal (). A first operation is performed onto the input data in accordance with the first enable signal (). Similarly, at the slave circuit(s), the forwarded first control signal is clocked with the local clock signal () so as to produce a first enable signal (). A first operation is performed onto the input data in accordance with the first enable signal (). The first operation may be writing the data into a FIFO.","A common clock is received at the master circuit (), and a second control signal is generated using the first enable signal and the common clock signal (). The second control signal is looped back to the master circuit () and also forwarded to the slave circuit(s) ().","At the master circuit, the looped-back second control signal is clocked with the common clock signal () so as to produce a second enable signal (). A second operation is performed onto the input data in accordance with the second enable signal (). Similarly, at the slave circuit(s), the forwarded second control signal is clocked with the common clock signal () so as to produce a second enable signal (). A second operation is performed onto the input data in accordance with the second enable signal () in the same manner as in the master circuit. The second operation may be reading the data from the FIFO.","As described above, the multi-circuits synchronization scheme according to an embodiment of the present invention uses a master circuit and slave circuit(s). One of the circuits can be used as a master circuit which receives the global control signal. The master circuit generates all necessary control signals using its own local clocks, and the control signals are forwarded to all of the slave circuits. By doing this, all slave circuits receive the same control signals referencing to the local clocks of the master circuit thus eliminating multiple clock domains. Furthermore, the control signals are also looped back to the master circuit itself. By receiving its own control signals, the master circuit can also be seen as one of the slave circuits when it comes to calculating the timing budget.","By using this synchronizing technique of the present invention, the tasks of byte aligning and skew managing across multiple circuits\/chips are significantly simplified. As described and shown in the above embodiments, once the bite alignment for input data is accomplished, there is a great flexibility of choosing types of cells, IO buffer, as well as internal cells to manage skew across the circuits. Chips placement and board routing also become less challenging. The synchronization scheme is also independent of process technology used and numbers of chips or lanes need to be synchronized.","While embodiments and applications of this invention have been shown and described, it would be apparent to those skilled in the art having the benefit of this disclosure that many more modifications than mentioned above are possible without departing from the inventive concepts herein. The invention, therefore, is not to be restricted except in the spirit of the appended claims."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The accompanying drawings, which are incorporated into and constitute a part of this specification, illustrate one or more embodiments of the present invention and, together with the detailed description, serve to explain the principles and implementations of the invention.","In the drawings:",{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 9"}]},"DETDESC":[{},{}]}
