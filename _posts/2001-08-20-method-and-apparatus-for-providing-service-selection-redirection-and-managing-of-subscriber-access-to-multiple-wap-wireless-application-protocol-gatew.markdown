---
title: Method and apparatus for providing service selection, redirection and managing of subscriber access to multiple WAP (Wireless Application Protocol) gateways simultaneously
abstract: A method (FIG. ) and apparatus (FIG. ) to provide control and policy enforcement of WAP (Wireless Application Protocol) services in a wireless data networks is taught herein. WAP traffic is inspected with efficient algorithms to intercept un-registered WAP access and intercept dynamic change of user service selection. The intercepted WAP requests are modified with value-added parameters (such as QoS and subscriber identifiers) as per user and service provider agreement and table data. A series of strategies are described to blend wireless intelligence, user preference and service subscription, network operator requirements and service provider or enterprise preferences into routing and drive page generation. The means to dynamically provision users' service choices to wireless network elements are also presented without having to break the session within the system. This enables innovative data services such as pay-per-use, smart routing, and enterprise secured WAP services unlike any current conventional system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07039037&OS=07039037&RS=07039037
owner: 
number: 07039037
owner_city: 
owner_country: 
publication_date: 20010820
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS REFERENCES","BRIEF SUMMARY\u2014FIELD OF EMBODIMENT","BACKGROUND\u2014DESCRIPTION OF PRIOR ART","ADVANTAGES OF THE EMBODIMENT","PREFERRED EMBODIMENT\u2014DETAILED DESCRIPTION"],"p":["For background information this patent refers to the following publications,",{"@attributes":{"id":"p-0002","num":"0000"},"ul":{"@attributes":{"id":"ul0001","list-style":"none"},"li":["[Ref-1] \u201cWireless Application Protocol (WAP) Specification\u201d, version 1.2.1, June 2000, WAP Forum. http:\/\/www.wapforum.com\/what\/technical.htm","[Ref-2] \u201cWAP Wireless Session Protocol Specification\u201d, version 4 May 2000, WAP Forum. pp. 63\u201370.","[Ref-3] \u201cWAP Wireless Transaction Protocol Specification\u201d, version 19 Feb. 2000, WAP Forum, pp. 22\u201366.","[Ref-4] \u201cWAP Wireless Datagram Protocol Specification\u201d, version 19 Feb. 2000, WAP Forum, pp. 23\u201350.","[Ref-5] \u201cWAP Architecture Specification\u201d, version 30 Apr. 1998, WAP Forum.","[Ref-6] \u201cWAP Wireless Transport Layer Security Specification\u201d, version 18 Feb. 2000, WAP Forum.","[Ref-7] \u201cUser Datagram Protocol\u201d, IETF RFC-768, 28 Aug. 1980.","[Ref-8] \u201cInternet Protocol\u201d, IETF RFC-791, September 1981.","[Ref-10] \u201cHypertext Transfer Protocol\u2014HTTP\/1.1\u201d, IETF RFC-2068, January 1997.","[Ref-11] \u201cOpen Service Architecture, Application Programming Interface\u2014Part 1 (Release 1999)\u201d, 3GPP TS 29.198 V3.2.0, 3rd Generation Partnership Project; December 2000.","[Ref-12] \u201cWAP Architecture Specification 2.0\u201d, WAP Forum, October 2000."]}},"The embodiments disclosed herein relate to the development and use of a smart controller to provide dynamic service selection, policing, redirection and management of WAP (Wireless Application Protocol) traffic, or like wireless data traffic, in a wireless data network. In particular the embodiments relates to:\n\n","WAP (Wireless Application Protocol) Architecture","WAP (Wireless Application Protocol) is a standard proposed by the WAP Forum (http:\/\/www.wapforum.org) [Ref-1, Ref-5] that allows information to be sent and received by wireless devices. WAP has been deployed in several existing cellular wireless data networks (e.g., GSM, TDMA and CDMA).","WAP capable wireless devices (WAP devices) have several operational constraints compared to traditional Internet access devices such as personal computers. These limitations include a less powerful CPU, less memory, restricted power consumption, smaller display, and different input methods to the device. In addition, WAP devices operate in an environment that generally provides less bandwidth, less connection stability, less predictable availability, and greater latency than their wire-line counterparts. With these considerations, the WAP Forum introduced a new network element called the WAP Gateway that was targeted at addressing one or more of these issues.","In a traditional browser environment the processing and caching takes place in a single location with the display being located adjacent to the data handling. The WAP gateway splits this process acting as a proxy (i.e. hosting default home page, recording cookies, content and protocol conversions, etc.) for the devices as shown in . In addition, the WAP gateway has been forced to provide several adjacent functions that assist in the end-to-end flow of data as part of the bridging or proxy function that they perform in the wireless network.","Another prior art concept is the unique identification of subscriber in the IP and wireless domains. However, due to privacy concerns, the WAP standard does not allow the device to send in a unique identifier in its requests, where one such identifier may be the phone number of the device, commonly referred as the MSISDN (Mobile Subscriber ISDN number). This inability to transmit an ID poses a serious challenge to the application development on the Web server which does not have a consistent means to identify the WAP device and hence the user. The solution, from application development side, is to require the user to log on by typing a user ID or MSISDN plus a password. Owing to the limited capability of the input method on the device, this is both inconvenient and difficult. Therefore, a need exists for a more convenient and simple way to allow WAP or wireless data requests to be tagged with IDs so that services can be differentiated on a request-by-request basis, a user-by-user basis, or a device-by-device basis, since this function is desirable and is not possible using conventional devices.","WAP gateway vendors have developed solutions to obtain IP address to MSISDN mapping from the NAS (Network Access Server) or AAA (Authentication, Authorization and Accounting) server. The WAP gateway then can identify each WAP request by the IP address and pass the MSISDN either in the URL or the HTTP header to applications running on Web servers. This requires the WAP gateway to collocate with the NAS or AAA in the carrier domain, which limits the configuration possibilities of the system. Enterprises and Wireless Portals who would like to control user experience by owning the WAP gateway will not have access to this critical information in the NAS or AAA, whereby flexibility within the system is lost when using this approach.","Another prior art method involves using the service control in existing WAP implementations. In existing wireless data networks the choice of WAP application is established through:\n\n","In the WAP page selection system, the subscriber is presented multiple origin server choices through a single WAP gateway (WAP implementations\/protocol associate a WAP device with a single WAP gateway).","The IP address of the WAP gateway is embedded in the WAP device restricting the device from accessing any other end-point directly and forcing one single WAP gateway to provide all services to the WAP device. This severely restricts the flexibility and scope of services that may be provided to the end user. In summary, this type of a system results in two major problems:\n\n","In a traditional WAP session a data request is encrypted by the WAP device and transmitted over the WAP device to the WAP gateway using the Wireless Transport Layer Security (WTLS) protocol [Ref-6]. The WAP gateway is then forced to decrypt the message and then re-encrypt it using another protocol (e.g. Secure Socket Layer) before transmitting it to the data content site origin server (). The WTLS certificate only authenticates the WAP device to the WAP gateway. Therefore, to ensure end-to-end authentication, the WAP gateway would need to reside on the content site. However, the presence of an embedded WAP gateway IP address in the WAP device forces the subscriber to break connection with the network, re-program the IP address in the WAP device for each separate WAP service access. For mission-critical applications that demand high data security, it's desirable to have the WAP gateway co-located with the application. Therefore, a different manner of delivering encrypted WAP traffic is needed to ensure that the WAP security hole problem is solved or at least reduced in severity.","Undifferentiated Service","When subscribers access applications through a single WAP gateway, the network service level they receive is limited by the service tier of the WAP gateway (which is the primary network element). As a result, in centralized WAP gateway deployments, both critical and casual applications have the same bandwidth allocation, the same latency, and the same security parameters associated with them in a single service tier. In order for individual application bundles to be associated with differentiated service tiers a unique WAP gateway needs to be coupled with each bundle. The combination of the applications plus the network service level then creates a \u201cWAP service level\u201d.","In a conventional multiple-profile system, the subscriber defines multiple profiles with each profile containing a unique WAP gateway IP address, NAS (Network Access Server) dialup number, user ID and password. Unfortunately, switching to a new application, forces the subscriber to terminate the current session, modify the profile choice, and start a new session. Dynamically changing the WAP gateway provider within the same session is impossible using conventional techniques and systems. The process to create multiple profiles is cumbersome, tedious, and technically challenging. In addition, wireless network operators have no control over a user's selection on WAP gateway providers, and thus cannot guarantee overall service control. Therefore, a need exists for a system that allows a user to change WAP gateways dynamically while in session whereby such a process will also allow tighter and more dynamic control of the quality of service (QoS) on a session-by-session basis.","Wireless Data\u2014Parameter Support","Wireless applications have enhanced usability when they are integrated with wireless-specific information. This includes support for features such as roaming and market preferences such as pre-paid and pay-per-use support.","Roaming","WAP roaming is currently achieved with one of the following methods.",{"@attributes":{"id":"p-0016","num":"0000"},"ul":{"@attributes":{"id":"ul0007","list-style":"none"},"li":{"@attributes":{"id":"ul0007-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0008","list-style":"none"},"li":["User making long distance calls to the home networks that incurs a huge cost to the user, and is therefore unpopular.","Upgrading the NAS\/RAS server in the roaming network to tunnel back to the home network, which is complex and inflexible.","Using a foreign WAP gateway to access the home WAP portals without accessing back to the home network. This methodology loses the user identity at the home WAP system and substantially discounts the user experience.","Using a local dial-up ISP to access the WAP gateway in the home network. Again the user identity will be lost in this approach."]}}}},"All the existing approaches to roaming are either cost inefficient, unnecessarily complex, and\/or substantially reduce the user experience. In addition the prior art does not recognize or provide the ability to provide local services selectively when in a roamed network, largely due to the fact that, in most cases, the user identity is lost.","Pre-Paid and Pay-per-use Support for Wireless Data Services","Mobile Network Operators (MNOs) and Service Providers have developed various pre-paid service packages where services are only provided when there are credits in subscribers' pre-purchased accounts. Pre-paid services have become extensively used by subscribers. However, the pre-paid packages are limited to voice services only and currently there are no pre-paid data services available on conventional networks. This is often due to the fact that the system cannot always identify the user and offer the user unique or selective packages. In addition, the single gateway through which the user accesses the data is only capable of processing certain packages that by definition will limit certain services offered to the subscriber.","Another concept which is yet to be developed in the wireless data network is the pay-per-use data service. In this scenario, subscribers may or may not sign up with the MNO, but can purchase service as they go, on the basis of usage time or number of accesses. Again, this has not been possible in conventional system due to limitations in the configuration and operation of the system.","The current art would restrict or prevent pay-per-use and pre-paid selections to be applied by all applications within a single gateway, thus eliminating the possibility of selective pre-paid application use on a user-by-user or session-by-session basis.","Accordingly, several advantages of the disclosed embodiments are to provide a system and methodology that has one or more of the following aspects:","To provide a system and method for developing an integrated subscriber WAP-gateway routing table. The routing table being used to represent a mapping of the subscriber to the current WAP gateway of choice, the service profile or service level associated with the WAP gateway, and the subscriber's individual security and priority profile\/level;","To provide a system and method for each service selection choice to be individually monitored in a dynamic manner so that further requests are appropriately serviced and service is flexible;","To provide a system and method for subscribers to be presented WAP service choices on-demand, each of which represents a different WAP gateway and hence a different service tiers or different quality of service (QoS);","To provide a system and apparatus that allows subscribers to simultaneously access multiple WAP gateways during a single data session;","To provide a system and apparatus that provides an efficient inspection of WAP traffic and enables the WAP-user to dynamically alter his WAP service selection at any time, in or out of session;","To provide a system and apparatus that provides a WAP content provider unique and secure subscriber identification in conjunction with dynamic service selection for the subscriber;","To provide a system and apparatus that enforces different traffic behaviors on WAP traffic depending on the subscriber selection, subscriber profile and Service Agreement;","To provide a system and apparatus that combines Service Selection with a Subscriber and Service Profile System thus enabling new wireless data service parameters to be developed and implemented (example Roaming support and pre-paid\/pay-per-use data services) to create more personalized services;","To provide a system and method that affords mobile network operators the capability of offering tiered WAP service with differentiators such as QoS, routing over differentiated transport layers and with value-add information (e.g. inserting subscriber identifier);","To optimize identification of out-going non-WTLS WAP traffic (i.e. from WAP device to WAP gateway) with efficient algorithms and to minimize latency by allowing the returning traffic routed directly to the WAP device.","To generally improve upon WAP, or like wireless, data systems.","Other features and advantages of the present embodiment will become apparent from the following detailed description, in conjunction with the accompanying drawings.","Generally, the specific embodiments taught herein set forth an improved WAP system and controller. This system is capable of dynamically allowing a WAP user to change WAP gateways in session or out of session. The system also allows for dynamic selection and application of different service profiles. Due to unique packaging and handling of IP addresses and unique application of the timing and location of encoding and decoding, the WAP security hole problem is reduced or eliminated and security of transmitted data is improved. In addition, other benefits are obtained as discussed herein. Specifically, the WAP system and controller can be better understood with reference to  below.","AirNgine Mobile Service Gateway ()","A high-level block diagram of the AirNgine Mobile Service Gateway (MSG) () platform, which is generally the gateway and controller set forth within the system of , is as shown in .","The AirNgine MSG () is a service control and policy enforcement element located within in the wireless data network. It is also the integration point between network service entities to which it provides unified access and applications (or end-user services) (e.g., Service Agent ()). It interacts with:\n\n","The AirNgine MSG system () generally consists of a base Framework (), feature servers (Service Agent ()), a Service Router (), a Subscriber and Service Profile System (SSPS) () and an Operation, Administration, Maintenance and Provisioning (OAM&P) () system. The AirNgine MSG () communicates with network elements through several protocols including, but not limited to, SMPP, SS7\/IS41-MAP, SS7\/INAP-TCAP and SIP, with applications through an OSA-like API [Ref-11] and natively in WAP with the bearer plane.\n\n","The Service Agent () in  consists of the following Feature Servers through which it develops wireless smarts for use in both policy enforcement, a unified view to applications, and other functions:\n\n","The Service Router () enables the following network services:\n\n","The AirNgine Platform () also has an Operation, Administration, Maintenance and Provisioning OAM&P () System that provides full-feature Fault, Configuration, Accounting and Performance management. The objective of the OAM&P () is to provide this capability for each of the product components. The management layer () will:\n\n","The system of  is shown in greater detail in . Specifically, in , the contents of the WAP Controller portion () of  is shown in more detail. The present embodiment operates with any wireless data protocol and almost any wireless data network(s) including the existing Second Generation (2G) GSM, TDMA and CDMA Circuit Switched Data (CSD) environment and the forthcoming 2.5G GSM GPRS and CDMA 1XRTT and Third Generation (3G) all-IP wireless data networks as well as other technologies.","The WAP Controller () of  requires, in a preferred embodiment, that WAP devices use its IP address as the WAP gateway address, so that all the WAP requests from the WAP device will be sent to the WAP Controller (). WAP traffic can be classified into two categories, namely pull and push. The pull traffic is initiated by a WAP device requesting a service (e.g., prepaid operations, security changes, etc.) or information from a server, whereas the push traffic is generated by a server delivering information to the WAP device without explicit request. Push notifications identify WAP devices by their MSISDN and generally bypass the WAP controller () as shown at a bottom of the . WAP Controller () generally addresses the pull traffic. In , the external communications are labeled with protocol names (e.g., WAP\/UDP, HTML, etc.). Within the WAP Controller (), components interact by direct access within the process space with mutual exclusion object (mutex) protection.",{"@attributes":{"id":"p-0061","num":"0114"},"figref":["FIG. 3","FIG. 6","FIG. 6","FIG. 3"],"b":["234","601","301","301","303","304","602","603","604","304","311","606","304","605","310","607","309","608"]},"UDP Listener ()","While  shows the entire process of communication within the Controller () that is shown in ,  shows the specific flow within the UDP Listener Thread () of  when a request is received from the WAP device. The UDP Listener () of  performs the task of accepting WAP traffic in its infinite loop manner until a termination signal is received (). It generally listens () at the following UDP and TCP ports for WAP requests from WAP Devices.",{"@attributes":{"id":"p-0063","num":"0116"},"b":"9200"},{"@attributes":{"id":"p-0064","num":"0117"},"b":"9201"},{"@attributes":{"id":"p-0065","num":"0118"},"b":"9202"},{"@attributes":{"id":"p-0066","num":"0119"},"b":"9203"},{"@attributes":{"id":"p-0067","num":"0120"},"b":"9204"},{"@attributes":{"id":"p-0068","num":"0121"},"b":"9205"},{"@attributes":{"id":"p-0069","num":"0122"},"b":"9206"},{"@attributes":{"id":"p-0070","num":"0123"},"b":"9207"},"When a WAP request arrives from a device, the UDP Listener () puts the request in an object () together with the WAP device's IP address. To reduce memory allocation\/de-allocation, this object is taken from an Object Pool () as shown in . The object is then placed in a mutual exclusion object protected (mutex-protected) Request Queue () which is monitored by multiple Worker Threads (). Note that the listening operation within the UDP Listener () times out after 2 seconds (or some other reasonable time) so that the termination signal can be checked regularly.","Worker Thread ()","Once objects are placed into the Request Queue () as discussed per ,  shows the flow of the Worker Thread () when the Thread () picks up a WAP request from the Request Queue (). Generally, a Worker Thread () performs the tasks of:\n\n","The Worker Thread repeats those tasks for objects within the Request Queue () indefinitely until a termination signal is received ().","More specifically, when a request is obtained from Request Queue () (), a Worker Thread () performs the following algorithm as shown in .\n\n","In summary, the Work Threads () are used to determine which requests are to be split off for processing by the Service Selection Management () routine and which requests are to be processed for communication to the WAP gateway.","Returning to , and in a preferred form, WAP Controller () routes Wireless Transport Layer Security (WTLS) traffic to the destination WAP gateway verbatim. For security reasons, WTLS specifications [see Ref-6, page 62] usually require the micro-browser on the WAP device to verify whether the Common Name (defined as the IP address or host name) of WAP gateway matches the WAP gateway IP address used in the WAP device. Since the WAP device uses the IP address of WAP Controller (), the WAP gateway WTLS certification preferably uses this IP address as its Common Name for security reasons.","The details of the WAP Controller () protocol stack are shown in  [Ref-4].  shows that a request progressed from a mobile device to a WAP proxy server is layered within one of many different types of protocols.","Routing Table ()","In , because there is no concept of subnets, the WAP Controller's Routing Table () may contain millions of entries, comparing with a maximum of 20,000 entries in a standard router. This is especially likely in the 2.5G and 3G environments where WAP devices can be always-on in the IP networks. The Routing Table () in  is thus preferably implemented with a Hash Table () as shown in  with an almost-constant look-up hashing algorithm using IP addresses in their network integer format. The number of the hash buckets is preferably chosen to be a prime number greater than the total number of routing entries. This reduces the potential hashing collision and improves look-up efficiency.",{"@attributes":{"id":"p-0079","num":"0142"},"figref":"FIG. 5","b":["305","501","502","503","503"],"ul":{"@attributes":{"id":"ul0024","list-style":"none"},"li":{"@attributes":{"id":"ul0024-0001","num":"0000"},"ul":{"@attributes":{"id":"ul0025","list-style":"none"},"li":["A WAP device IP address (),","Its chosen WAP gateway (G\/W) IP address (),","A preferred subscriber identifier header name index () that can be used to identify the community in which the subscriber belongs,","The subscriber identifier (),","A QoS parameter (),","Charging parameters (),","WAP device port number (), and","Assigned port number ()."]}}}},"The Header Name Index () (see also ()) allows each WAP device to have it's preferred subscriber identifier header name (). The subscriber identifier () varies depending on user privacy and service provider requirements. The ID can be the MSISDN, a scrambled MSISND (such as an MD digest of the MSISDN), or a common community identifier. The identifier () can also be turned off, i.e. empty in some applications. The QoS Parameters () enables the WAP Controller () to mark WAP traffic using IPv4 TOS (Type of Service) or DS (Differentiated Service) fields to control the quality of service on a per request basis. This QoS Parameter will also work in the future IPv6 environment. The charging parameters () capture both the time based costs and number of access charging models for a given user, mobile device or request. The assigned port numbers are indexed for fast searching by the Packet Sniffer thread (). These numbers are used together with the WAP device IP and port to forward returning connection-oriented WAP traffic.","The Worker Thread () algorithm in  and the Hash Table () implementation of the Routing Table () are useful for optimizing the efficiency of the WAP Controller (). In addition, information within the Hash Table entries may be modified in session or per request by the user of the mobile device so that dynamic adjustment of the routing table is possible.","Packet Sniffer ()","In the connection-oriented mode, both the WAP device and the WAP gateway maintain a connection state. The connection state identifies a valid connection by analyzing the quadruple <client IP, client port, server IP, server port>. Packets coming from hosts other than that identified by the valid connection state are discarded. Because of the state information, the WAP Controller () has to act as the proxy for the incoming WAP request as well as the returning traffic. Owing to the fact that the WAP Controller () needs to proxy a large number of WAP devices, it is most efficient to assign a distinct port on the WAP Controller () machine to represent the WAP device and routing the return traffic accordingly. The Packet Sniffer thread () performs this task using the routing table with an index on the assigned port. An assigned port is freed when its corresponding WAP device sends an abort request or no WAP traffic is detected over a time-out period (referring to the Management Thread ()).",{"@attributes":{"id":"p-0083","num":"0154"},"figref":"FIG. 8A","b":["315","315","9201","9203","234","8","02","8","03","315","8","05"]},"Drive Page Thread ()","In , the Drive Page Thread () is responsible for:\n\n","There are usually multiple Drive Page Threads () running in the system of . Each thread () connects to an instance of the Service Selection Management () module and is used to process drive page requests for service selection back to the mobile device.  shows the flow of a Drive Page Thread () that is shown in . Drive Page Threads () run in a perpetual loop until a termination signal is received (). In the loop, the Drive Page Thread () first tests whether its connection to the Service Selection Management () is broken (). If so, it proceeds to re-connect without processing any drive page request (). When the connection is fine, the Drive Page Thread () picks up a request from the Drive Page Queue () () and sends it to the Service Selection Management instance () (), the Thread () then checks whether there is any drive page returned from the Service Selection Management (). If there is any drive pages returned to the Thread () by the Management module (), the drive pages are processed and sent to the WAP device () for presentation to the mobile device user.","Data Feeder ()","The WAP Controller () receives regular updates of routing entries from the Service Selection Management module () and User&Device Identification module () as soon as WAP users log on and off the network. A logging on event signals a new routing entry to be inserted into WAP Controller () Routing Table (), whereas a logging off event requires removing the related routing entry from the Routing Table (). Routing entry updates are handled by the Data Feeder Thread (). The Data Feeder interface () follows the HTTP 1.1 [Ref-10] protocol in a preferred form.",{"@attributes":{"id":"p-0087","num":"0161"},"figref":["FIG. 9","FIG. 3"],"b":["307","901","307","902","232","235","307","905","307","904","305","907","305","909","911","910"]},"Management Thread ()","The WAP Controller () also supports a management interface (Process  and API ). The management API () provides WAP Controller () internal states and statistics in HTML and XML again in HTTP 1.1 protocol in a preferred form.  shows the flow of the Management Thread (). In particular, the Management Thread () is responsible for one or more of:\n\n","Like other threads, the Management Thread () operates in a loop until a termination signal is received (). In , the Thread () first listens for an incoming request (). When a request arrives, it tests whether the request is a status request (). If so, the Management Thread collects operational measurements (OMs), status and states (such as number of requests processed and the number of cached requests) and sends the data in a reply page (), else the command is processed within the Thread () (). If the request is a command (such as \u201chalt\u201d), it sets the termination signal and sends a reply page ().","User & Device Identification ()","When a WAP device logs on the wireless network, the IWF\/GGSN\/PDSN authenticates the WAP device, authorizes its accesses and also accounts for the log on event. This is done by communicating with the AAA server as shown in . In , the IWF\/GGSN\/PDSN is configured using User&Device Identification () as the AM server. The User & Device Identification () takes an AAA request, extracts the required data and forwards the request to the actual AAA server. Interesting parameters in an AAA record include Calling-Station-Id (represents the MSISDN), Framed-IP-Address (represents the IP address) and Acct-Status-Type (Start or Stop) RADIUS attributes in the Accounting-Request packets. The information maps an IP address to a MSISDN which is pushed to Routing Management () which in turn generates a routing entry and updates the WAP Controller () via the Data Feeder () and the Routing Table (). This log on process normally happens before any bearer traffic is started or allowed for that device over the network. The same procedure occurs when a WAP device logs off the network. However, this time the IWF\/GGSN\/PDSN signals the termination of the session and the Routing Entry () for that WAP device is removed from the Routing Table () of the WAP Controller ().","Routing Management ()","In , the Routing Management () stores routing entries persistently and controls the routing entries for the WAP Controller () when WAP devices log on and off the wireless network. When a WAP Controller () starts up, it requests the Routing Management () to fill the Routing Table () over the HTTP interface () shown in .","The Routing Management () pushes routing entries to the WAP Controller () accordingly in the event that WAP devices log on the network. Routing Management () uses the following strategies to formulate routing entries within the routing table ().\n\n","When WAP Controller () needs to provide a drive page, it makes a request to the Service Selection Management () of  along with the WAP device's IP address from the Routing Table (). The Service Selection Management () generates a drive page based on user preferences, user group, service subscription which are retrieved from SSPS () in , and wireless intelligence (such as location, roaming, pre-paid account, etc.) which are obtained from the Service Agent () in . The OAM&P () in AirNgine MSG () of  allows comprehensive provisioning from Mobile Network Operations (MNOs), Service Providers and end users. The provisioned data is stored in SSPS ().","In a preferred form, all the HTTP interfaces in the WAP Controller support the efficient HTTP\/1.1 pipelining as outlined in [Ref-10].",{"@attributes":{"id":"p-0095","num":"0182"},"figref":["FIG. 12","FIG. 12","FIGS. 3\u201311"],"b":"234"},{"@attributes":{"id":"p-0096","num":"0183"},"figref":["FIG. 13","FIG. 13","FIGS. 3\u201312"],"b":"234"},"Because the WAP Controller () performs a common function in a wireless data network, it can also be embedded in a data gateway within a wireless data network, as shown in  (compared with the WAP Controller () deployed external to the data gateway as shown in ). This flexibility allows a Controller () to enable differentiated service for WAP traffic in several different configurations.","The system set forth in  and operationally discussed per  may perform several functions. These functions are set forth below.","Roaming Support","Unlike conventional WAP gateways, the WAP Controller () does not need to be exposed to the Internet with a public IP address. In the situation where a carrier operates multiple networks in different countries or carriers with roaming agreements, the WAP Controllers () can be configured with the same private IP addresses (such as, 10.0.0.0) in all the networks. A Mobile Station (MS) always uses the same IP address as the WAP gateway address in both the home and foreign networks. In other words, the IP address of the MS is static. Given the set and static IP addresses in the MS, the WAP Controller () can route every WAP requests back to the home network WAP gateway with ease. This way, WAP roaming becomes seamless by provisioning roaming users in the SSPS () with quick access to the users' home network WAP gateway(s). Consistent personalized services can be assured by ensuring that all roaming traffic is sent directly back to the home Gateway whereby the tables, ID, and information of the home Gateway is accessed and applied, regardless of roaming location.  shows the traffic flow in the roaming scenario whereby an MS in a foreign network can route, by IP addresses, all necessary information directly to the home network hardware and software. As one advantage to this system, user information is not lost when roaming, and the user experience when in a foreign network will be just as if the user was present in his home network.","Pre-Paid and Pay-per-use Support","The WAP Controller () is located at the best position to handle prepaid and pay-per-use data service because it intercepts WAP traffic after subscribers get into the MNO network but before they reach any services (WAP gateway access, QoS and transport end points, etc.). Therefore, the WAP Controller () will enforce pre-paid and pay-per-use criteria (i.e. time and number of accesses) when traffic is passing through on a per subscriber or per session basis. Therefore, the system taught herein provides useful elements and advantages when offering pre-paid and pay-per-use data services to mobile device or WAP subscribers.","While the WAP system and methods herein are taught, described, and illustrated with reference to specific implementations, further modifications and improvements will occur to those skilled in the art. For example, the system and methods taught herein can work for other wireless technology standards and methods other than WAP. It is to be understood, therefore, that the claims should not be limited to the particular forms and embodiments illustrated herein and that it is intended that the appended claims cover all modifications that do not depart from the spirit and scope of this invention."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTIONS OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0034","num":"0054"},"figref":"FIG. 1A"},{"@attributes":{"id":"p-0035","num":"0055"},"figref":"FIG. 1B"},{"@attributes":{"id":"p-0036","num":"0056"},"figref":"FIG. 2","b":"201"},{"@attributes":{"id":"p-0037","num":"0057"},"figref":["FIG. 3","FIG. 2"],"b":["234","230"]},{"@attributes":{"id":"p-0038","num":"0058"},"figref":["FIG. 4","FIG. 3"],"b":"234"},{"@attributes":{"id":"p-0039","num":"0059"},"figref":["FIG. 5","FIG. 3"],"b":["305","234"]},{"@attributes":{"id":"p-0040","num":"0060"},"figref":["FIG. 6","FIG. 3"],"b":"234"},{"@attributes":{"id":"p-0041","num":"0061"},"figref":["FIG. 7","FIG. 3"],"b":"301"},{"@attributes":{"id":"p-0042","num":"0062"},"figref":["FIG. 8","FIG. 3"],"b":"304"},{"@attributes":{"id":"p-0043","num":"0063"},"figref":["FIG. 8A","FIG. 3"],"b":"315"},{"@attributes":{"id":"p-0044","num":"0064"},"figref":["FIG. 9","FIG. 3"],"b":"307"},{"@attributes":{"id":"p-0045","num":"0065"},"figref":["FIG. 10","FIG. 3"],"b":"308"},{"@attributes":{"id":"p-0046","num":"0066"},"figref":["FIG. 11","FIG. 3"],"b":"310"},{"@attributes":{"id":"p-0047","num":"0067"},"figref":"FIG. 12","b":["234","233","232"]},{"@attributes":{"id":"p-0048","num":"0068"},"figref":"FIG. 13","b":"201"},{"@attributes":{"id":"p-0049","num":"0069"},"figref":"FIG. 14","b":"201"},{"@attributes":{"id":"p-0050","num":"0070"},"figref":["FIG. 15","FIG. 3"],"b":"234"},{"@attributes":{"id":"p-0051","num":"0071"},"figref":["FIG. 16","FIG. 3"],"b":"234"}]},"DETDESC":[{},{}]}
