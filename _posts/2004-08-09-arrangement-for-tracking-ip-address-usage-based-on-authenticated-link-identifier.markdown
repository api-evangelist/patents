---
title: Arrangement for tracking IP address usage based on authenticated link identifier
abstract: Link layer authentication information is supplied by a link layer authentication device to an access router for tracking IP address usage by a client device. The authentication information supplied to the access router includes an authenticated client identifier and a corresponding authenticated link identifier for the client device that attached to the network based on the authenticated link identifier. The access router, in response to receiving a message that specifies the authenticated link identifier and a source IP address, adds the source IP address to a cache entry that specifies the authenticated client identifier and the corresponding authenticated link identifier, and outputs to an audit resource a record that specifies the source IP address and the authenticated link identifier.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08068414&OS=08068414&RS=08068414
owner: Cisco Technology, Inc.
number: 08068414
owner_city: San Jose
owner_country: US
publication_date: 20040809
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","BEST MODE FOR CARRYING OUT THE INVENTION"],"p":["1. Field of the Invention","The present invention relates to management of Internet Protocol (IP) addresses used by network nodes. In particular, the present invention relates to tracking usage of IP addresses back to network nodes, for example based on the IP addresses having been used for illegal activity such as Denial of Service, virus\/worm attacks, distribution of spam (unwanted e-mail), or for tracking usage of IP addresses relative to Quality of Service policies, or to monitor node mobility.","2. Description of the Related Art","Network administrators have encountered a dramatic increase in the number of Denial of Service (DOS) attacks and spoof packet attacks in the last few years. It has always been difficult to identify the source of the attacks, namely the individual host computer that is specifically responsible for the attacks. In particular, IP-based networks typically include resources for maintaining network operations; however, network state is not preserved for future analysis. Hence, if an attack is detected, there is no audit trail preserved that enables an authoritative source to trace the origin of the attack with sufficient information to identify a specific individual user.","In addition, enforcement efforts in protecting against various forms of abuse are frustrated due to the untraceability of the network address, because there is no authoritative technique for correlating a network address to a user identity.","Monitoring of link layer addresses (e.g., MAC layer addresses) is insufficient, since the link layer information that could be used to identify the origin of the attack is lost after the packet has passed the first hop router. The IEEE 802.1x standard provides for layer  authentication but does not specify methods for collecting layer  addressing information. Further, efforts to block a link layer address do not scale well in deployment; link layer addresses also can be \u201cspoofed\u201d, and computers may have multiple network interfaces having respective link layer addresses, for example a first MAC address for a wired IEEE 802.3 interface, and a second MAC address for a wireless IEEE 802.11 interface.","Further, the link layer is not necessarily tied to the IP network layer; hence, a user that is attached by a link layer can send packets onto the network with an arbitrary IP network source address, for example dynamically-allocated network addresses based on Dynamic Host Configuration Protocol (DHCP) or dial-up services. This arbitrary network address utilized by the user also is typically the only reference available to an enforcement entity to identify the requesting source.","Attempts at providing authentication services have addressed assigning an authenticated IP address to a user, such attempts fail to address the problem that a malicious user may still use an unassigned address. Examples of existing authentication services include Remote Authentication Dial-In User Service (RADIUS) as described in the Internet Engineering Task Force (IETF) Request for Comments (RFC) 2865, available at the IETF website address \u201cwww.ietf.org\/rfc\/rfc2865.txt\u201d. The RADIUS authentication records an IP address having been assigned to a user. In particular, a user of a dial-up PPP service may connect to a service via an identifiable dial-up port (e.g., \u201c\u201d), provide authentication information including user identifier (e.g., \u201cjohn_adams\u201d) and password; hence, the RADIUS service can authenticate the user identifier (e.g., \u201cjohn_adams\u201d) based on the password, and correlate the authenticated user identifier to the dial-up port \u201c\u201d. The RADIUS service also will determine that the PPP negotiation has supplied the user a prescribed assigned IP address \u201cX.Y.B.C\u201d; hence, the RADIUS service can store in its internal database that the assigned IP address \u201cX.Y.B.C\u201d was assigned to user \u201cjohn_adams\u201d on the dial-up port \u201c\u201d.","As described above, however, the existing systems have monitored only the IP address that have been assigned to a user, and not necessarily the actual IP addresses that are used by the user. However, the same enforcement issues arise because a source node may use an alternate IP address (e.g., \u201cY.X.Q.R\u201d) that differs from the IP address having been assigned to the user (e.g., \u201cX.Y.B.C\u201d).","Although application-level proxy resources and Network Address Translator (NAT) devices are able to utilize proxy authentication to associate user names to IP addresses, there is no guarantee that all data traffic will pass through the application-level proxy resources or the NAT devices. Hence, a rogue device can circumvent the application-level proxy resources and NAT devices to avoid detection.","There is a need for an arrangement that provides a reliable and consistent tracking of any IP address used by a network node, regardless of whether the IP address is assigned to the network node by an authoritative source.","There also is a need for an arrangement that provides reliable tracking of any IP address used by a network node, including identification of the network node by a link identifier.","There also is a need for an arrangement that enables an audit trail to be established for identification of an entity (e.g., a user or an executable resource in a network device) having used an identified IP address.","These and other needs are attained by the present invention, where link layer authentication information is supplied to an IP router for tracking IP address usage by a client device. The authentication information supplied to the IP router includes an authenticated client identifier and a corresponding authenticated link identifier for the client device that attached to the network based on the authenticated link identifier. The IP router, in response to receiving a message that specifies the authenticated link identifier and a source IP address, adds the source IP address to a cache entry that specifies the authenticated client identifier and the corresponding authenticated link identifier, and outputs to an audit resource a record that specifies the source IP address and the authenticated link identifier.","Hence, the audit resource is able to maintain a history of IP addresses used by authenticated link identifiers, enabling administrators to track IP addresses that are used based on the associated authenticated link identifiers and the corresponding client identifiers.","One aspect of the present invention provides a method in an Internet Protocol (IP) based router in a network. The method includes creating a cache entry specifying an authenticated client identifier and a corresponding authenticated link identifier for a client device attached to the network based on the authenticated link identifier. The method also includes receiving a message that specifies the authenticated link identifier and a source IP address, and adding the source IP address to the cache entry specifying the authenticated link identifier based on parsing the message. The method also includes outputting to an audit resource a record that specifies the source IP address and the authenticated link identifier.","Another aspect of the present invention provides a method in a network having a link layer authentication device and an IP router. The method in the link layer authentication device includes detecting an establishment of a link with a client device on an identified link port, and attempting authentication of the client device attached to the identified link port based on sending, to an authentication server, client device information including a client identifier. The method in the link layer authentication device also includes outputting to the IP router, based on authentication of the client device by the authentication server, the client identifier as an authenticated client identifier and an authenticated link identifier relative to the corresponding link port. The method in the IP router includes receiving the authenticated client identifier and the corresponding authenticated link identifier, and creating a cache entry specifying the authenticated client identifier and the corresponding authenticated link identifier. The method in the IP router also includes receiving a message that specifies the authenticated link identifier and a source IP address, adding the source IP address to the cache entry specifying the authenticated link identifier based on parsing the message, and outputting to an audit resource a record that specifies the source IP address and the authenticated link identifier.","Additional advantages and novel features of the invention will be set forth in part in the description which follows and in part will become apparent to those skilled in the art upon examination of the following or may be learned by practice of the invention. The advantages of the present invention may be realized and attained by means of instrumentalities and combinations particularly pointed out in the appended claims.",{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 1","b":["10","14","14","10","12","18","20","23"]},"The authenticator  is configured for detecting establishment of a link  with the client device  on an identified link port . As described below, the authenticator  is configured for authenticating the client device  based on sending an authentication request  specifying a client identifier (e.g., an entity identifier)  and password  to an authentication server .","In response to receiving an approval  from the authentication server , the authenticator  is configured for outputting to the access router  an authentication message  that includes an authenticated client identifier (e.g., authenticated User ID) \u2032 that uniquely identifies the entity requesting the IP address, and an authenticated link identifier (ALID) . The access router  caches the authenticated client identifier \u2032 and the authenticated link identifier  in a cache entry  configured for specifying the authenticated client identifier \u2032, the authenticated link identifier , and an IP address used by the device  that accesses the network  using the authenticated link identifier . Note that each cache entry  preferably also includes a time stamp (not shown) that indicates the age of the entry, which can be used to validate, manage and diagnose authorized activity.","Hence, in response to the access router  detecting a message \u2032 specifying the authenticated link identifier  and a source IP address  having been generated by the client device , the IP router updates its cache entry  to specify that the owner of the authenticated link identifier  (the client device  having the authenticated user identifier \u2032) is using the IP address . In addition, the access router  is configured for outputting to the audit database  a record  that specifies at least the source IP address  and the corresponding authenticated link identifier . Hence, the audit database  is able to maintain a log  of all IP addresses used by the client device .",{"@attributes":{"id":"p-0028","num":"0027"},"figref":["FIGS. 2A and 2B","FIG. 2A","FIG. 2B"],"b":["12","20","12","20","36","12","20","36","44","36","44"]},"The authenticator  of , A and B is implemented, for example, as part of a network access device for the client device . In particular, the authenticator  illustrated in  includes a link layer protocol resource , an authentication resource , and an IP interface ; the authenticator \u2032 of  includes a resource interface \u2032 (e.g., an Application Programming Interface (API)) in place of the IP interface  for passing the messages  and \u2032 using memory pointers.","The link layer protocol resource  is configured for providing link layer access services to the network  based on the client device  establishing a physical or logical link  (e.g., dial-up, wired Ethernet IEEE 802.3 connection, wireless IEEE 802.11 connection, etc.) with the authenticator  according to a prescribed link layer (i.e., OSI layer ) protocol. The network access device can be implemented as a layer  access point, a layer  access switch, etc. In addition, the network access device can establish the link  using various protocols depending on the network medium used to connect the authenticator  and the client device , for example IEEE 802.1x Extensible Authentication Protocol (EAP) or the Lightweight Extensible Authentication Protocol (LEAP)\u2014authenticated sessions on a layer  access point. LEAP is a proprietary authentication process for associating wireless clients to an access port using an authentication server, and is commercially available from Cisco Systems, San Jose, Calif.","The client device  is configured for attaching to a port  of the network access device, assumed herein to be part of the authenticator . As shown in , upon establishment of the link  according to a prescribed link layer protocol, the client device  is configured for outputting onto the link  a message  specifying an assigned link address  for reception by an identified port (e.g., switch port)  of the authenticator . As recognized in the art, the identifier for the port  may be a hardware-based port identifier based on the port being one of a plurality of hardware ports (e.g., Ethernet switch port, modem bank, etc.), or the identifier for the port  may be a session identifier that is used by the authenticator  to identify the link  established with the client device.","The authentication resource  of  is configured for determining an identity  of the client device (e.g., user identifier \u201cjohn_adams\u201d), for example based on the client device  providing a user identifier  and a password . For example, the authentication resource  and the client device  may perfrom IEEE 802.1x EAP authentication, where the client device  (e.g., the IEEE 802.1x supplicant) provides the user identifier  and password  to the authenticator . The user identifier  is used to uniquely identify the entity (e.g., a user or executable resource within the client device) requesting the IP address. The authentication resource  is configured for sending the authentication request  shown in  to the authentication server , based on forwarding the user identifier  and the password . The authentication server  is configured for authenticating the mapping between the link identifier (e.g., the identifier of the port ), the user identifier , and the password , and in response sending a response  indicating either acceptance or denial of the authentication request . The above-described authentication may be implemented according to known link layer authentication protocols such as IEEE 802.1x EAP authentication or LEAP authentication.","In response to receiving an authentication verification  from the authentication server  accepting the authentication request, the authentication resource  marks the link identifier (e.g., the identifier of the port ) as an authenticated link identifier , marks the client identifier  as an authenticated client identifier \u2032, and sends to the IP router  an authentication message  that specifies the authenticated link identifier  (e.g., port identifier ), and the authenticated client identifier \u2032. The authentication message  is output by the IP interface  () or the resource interface \u2032.","Although the authenticated link identifier  is illustrated as based on the port identifier , the layer  (e.g., MAC) address  could be used so long as the address  can be authenticated by the authentication server .","The IP router  is configured as a first-hop router (e.g., default gateway) for enabling the client device  to access a wide area packet switched network such as the Internet (not shown). As illustrated in , the IP router  includes an IP interface , a cache manager resource , a cache  having cache entries (e.g., , ), and a record reporting resource . The IP interface  of  is configured for receiving the authentication message  having been generated by the authentication resource  and including the authenticated client identifier \u2032 and the authenticated link identifier ; the IP interface  of  also is configured for receiving packets \u2032 having been forwarded by the authenticator  based on reception of the original packet  by the authenticator  from the client device .","The cache manager  is configured for storing a cache entry  (e.g., , ) that includes the authenticated link identifier , the authenticated client identifier \u2032, any IP address  used by the client device , and preferably a time stamp. In response to receiving the authentication message , the cache manager  is configured for creating a new cache entry (e.g., ) that includes the authenticated link identifier  and the authenticated client identifier \u2032 specified in the authentication message . Note, however, that the authentication message  does not specify any IP address expected be used by the client device , since the client device  may be an untrusted device that may use an unknown IP address.","According to the disclosed embodiment, the cache manager resource  also is configured for parsing a received packet \u2032 having been forwarded by the authenticator  from the client device . As illustrated in , the client device  outputs a packet  having an untrusted IP address  to the authenticator  according to a prescribed link layer protocol. The authentication resource  authenticates the link layer address  used by the client device , and outputs the packet \u2032 with the authenticated link identifier  (e.g., an authenticated layer  address  or an added port identifier  if different from the link layer address ) the IP address , and associated payload data (not shown). It should be noted that the authentication resource  is configured for verifying the authenticity of the layer  address  of each packet  output by the client device , for example based on caching the relevant information used during authentication (e.g., \u2032, , , ), to prevent \u201cspoofing\u201d of the layer  address .","The cache manager resource  responds to the received data packet \u2032 by identifying the authenticated link identifier  in the received packet \u2032, and adding the source IP address (e.g., \u201c66.73.95.21\u201d) of the packet to the corresponding cache entry , such that the cache entry specifies the authenticated link identifier , the authenticated client identifier \u2032, and the IP address used by the client device . The cache manager resource  also is configured for refreshing or clearing a cache entry in response to a prescribed condition (e.g., timeout due to inactivity or roaming, dynamic VLAN assignment, quarantine or containment due to network access control or network infection containment protocols, etc.).","The reporting resource  is configured for generating and outputting to the audit resource (e.g., the audit database ) a record  that represents transmission of-the packet \u2032 from the client device , in response to the cache manager resource  adding the IP address (e.g., ) to the cache entry . The record  includes the source IP address , the authenticated link identifier , and optionally the associated authenticated client identifier (not shown in ). Hence, the audit database  stores the record  for traceability of the traffic generated by the client device .","Note that the IP router  may employ caching to minimize the number of records  that need to be sent to the audit database; hence, a new record  needs to be sent only if there is a new cache entry (e.g., there is a change in any one of the authenticated link identifier , the user identifier \u2032, or the IP address ).","Hence, if the client device  initiates a denial of service attack on a targeted node based on using a \u201cspoofed\u201d IP address  and sending packets to the destination IP address of the targeted node, the audit database  would have a log  of the authenticated link identifier  and the spoofed IP address(es) . After the denial of service attack, the administrator of the targeted node would be able to determine the spoofed IP address(es)  based on logs at the targeted node (or associated firewalls); the administrator could then determine the entity that had used the spoofed IP address(es)  based on identifying from the log  that the authenticator  had authenticated the port  at that point in time (based on the authenticated link identifier ).",{"@attributes":{"id":"p-0042","num":"0041"},"figref":["FIGS. 3A and 3B","FIG. 3A","FIG. 3B","FIGS. 3A and 3B"],"b":["12","20","12","12","20"]},"The method begins in step , where the link layer protocol resource  in the authenticator  detects establishment of the link  with the client device  on the identified port . The authentication resource  sends in step  an authentication request  to the authentication server , shown in , that includes the user ID  and password . The authentication server  performs authentication in response to the request , for example according to IEEE 802.1x EAP or LEAP, and outputs a response  indicating either approval or denial of the request.","If in step  the authentication resource  detects that the response  indicates approval, the authentication resource  designates in step  the client identifier  as an authenticated client identifier \u2032 and designates in step  a unique authenticated link identifier , for example based on the MAC address , the port identifier , etc. The authentication resource  generates in step  the authentication message  including the authenticated client identifier \u2032 and the authenticated link identifier , which is then output by the IP interface  or the resource interface \u2032.","Referring to , the IP interface  (or the resource interface \u2032 of ) receives in step  the authentication message  specifying the authenticated client identifier \u2032 and the authenticated link identifier , and in response the cache manager resource  parses the authentication message  and creates a new cache entry (e.g., ) specifying the authenticated client identifier (e.g., \u201cjohn_adams\u201d) \u2032 and the authenticated link identifier (e.g., \u201cMAC1\u201d) . In response to the IP interface  receiving in step  the client device-originated IP packet \u2032 specifying the authenticated link identifier (e.g.,\u201cMAC1\u201d)  and the source IP address (e.g., \u201c66.73.95.21\u201d) , the cache manager resource  identifies in step  the cache entry based on the matching authenticated link identifier .","The cache manager resource  adds in step  the new source IP address (e.g., \u201c66.73.95.21\u201d) to the identified cache entry (e.g., ), enabling the access router  to identify the client device  that is using the IP address ","In response to the adding of a source IP address (e.g., ) to a cache entry (e.g., ), the record reporting resource  generates in step  a record  that specifies the authenticated link identifier , the source IP address , and optionally the authenticated client identifier \u2032. The IP interface  outputs the record  to the audit database  for storage in the log .","Hence, an administrator of the authenticator  can access the log  to identify that the source of the IP address was the client device  based on the authenticated link identifier , and optionally also the authenticated client identifier \u2032.","Note that the cache manager resource  may generate another entry (e.g., ) for the same client device  if a different IP address (e.g., \u201c79.00.00.11\u201d) is used. Hence, assuming in step  that the IP interface  of the access router  receives another client-originated message \u2032, the cache manager resource  identifies in step  the stored cache entry based on the authenticated link identifier  specified in the new message \u2032.","If in step  the cache manager resource  determines that the newly-received message \u2032 specifies a source IP address (e.g., \u201c79.00.00.11\u201d) that differs from the source IP address (\u201c66.73.95.21\u201d) specified in the cache entry , the cache manager resource  creates in step  a new cache entry that specifies the new source IP address , the authenticated client identifier \u2032, and the authenticated link identifier . In response to creation of the new cache entry specifying the new IP address , the reporting resource  generates in step  a new record  specifying the authenticated link identifier  and the new IP address of the newly-created cache entry , and optionally the authenticated client identifier \u2032; the new record  is output by the IP interface  to the audit database .","According to the disclosed embodiment, a record is maintained of an IP address used by an entity, as well as the authenticated user identity of that entity using the IP address. As used herein, the term \u201centity\u201d refers to any consumer of an IP address for use as a source IP address in sending a packet onto a network: examples of an entity include a user of an e-mail client, a user of a browser, an executable resource in a Voice over IP telephone configured for using a source IP address for establishing a Voice over IP telephone call, an executable resource configured for fetching updated information (e.g., virus update software, software update software) etc.","Moreover, the ability to correlate a network address to an entity enables a network access device (e.g., a firewall device, a catalyst switch, etc.) to implement network infection containment, where an unauthorized computer (or a previously-authorized computer having been compromised due to some agent) is placed in a quarantine zone to minimize damage to the network, while providing sufficient access for the unauthorized computer to obtain remote remediation services (e.g., removal of viruses, etc.). Deployment of a interface to current state data in the audit database or the access router also may enable targeted nodes to identify a source of a Denial of Service (DoS) attack in real time by sending a request to an authoritative source (not shown) to query the interface for the identity of the entity using the source IP address.","Note that the disclosed embodiment also can be used in networks utilizing a shared medium, since each node will require some type of unique address that enables traffic to reach that node. However, it is preferred that a secure authentication is used between an authenticator and the authenticated device to prevent other nodes on the shared medium from detecting the authentication process between the authenticator and the authenticated device.","As described above, the client identifier  and authenticated client identifier \u2032 are used to uniquely identify a entity (e.g., user, executable resource) that is to be a consumer of an IP address for use as a source IP address in sending a packet onto a network; hence, client identifier  and the authenticated client identifier \u2032 can be based on machine-generated credentials, as opposed to any user-supplied credentials. However, note that the authenticator  still outputs an authenticated client identifier \u2032 and an authenticated link identifier  each having been generated by a known administrative control. Also note that the authenticated client identifier \u2032 may be implemented using other methods of identification, including digital signature, digital certificate, etc., where the client identifier  can be implemented in the form of a digital signature\/certificate prior to validation\/acceptance by the authenticator , and the authenticated client identifier \u2032 can be implemented in the form of the digital signature having been validated\/accepted by the authenticator .","Although existing network switches may store current state of the switch in the form of layer  and layer  addresses for a given network node, the disclosed embodiment associates the layer  IP address to the authenticated link identifier. Note that the term \u201cauthenticated link identifier\u201d encompasses various link layer identifiers depending on implementation, for example MAC addresses for Ethernet (IEEE 802.3) addresses, wireless LAN (IEEE 802.11) addresses, dial-up port for PPP based dial-up connections, authenticated port or session identifier in a Virtual Private Network (VPN) concentrator, etc.","Also note that disclosed arrangement does not require configuration of application-level proxies, since the disclosed arrangement records all IP addresses used by the client device, regardless of the type of IP traffic output by the client device.","Also note that the disclosed embodiment is equally applicable to IPv4 and IPv6 address schemes.","While the disclosed embodiment has been described in connection with what is presently considered to be the most practical and preferred embodiment, it is to be understood that the invention is not limited to the disclosed embodiments, but, on the contrary, is intended to cover various modifications and equivalent arrangements included within the spirit and scope of the appended claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Reference is made to the attached drawings, wherein elements having the same reference numeral designations represent like elements throughout and wherein:",{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":["FIGS. 2A and 2B","FIG. 1"]},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIGS. 3A and 3B"}]},"DETDESC":[{},{}]}
