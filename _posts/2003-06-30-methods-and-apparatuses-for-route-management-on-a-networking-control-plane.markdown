---
title: Methods and apparatuses for route management on a networking control plane
abstract: An open networking routing system includes at least one forwarding element, and a control element communicatively coupled to the forwarding element(s). In one embodiment, the control element is equipped with a route cache manager to receive notification of a routing table update in the control element, and facilitate notification of the routing table update to at least one functional component within the control element and forwarding element(s) in a coordinated manner to maintain routing coherency between the control element and forwarding element(s).
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07388840&OS=07388840&RS=07388840
owner: Intel Corporation
number: 07388840
owner_city: Santa Clara
owner_country: US
publication_date: 20030630
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","DETAILED DESCRIPTION OF ILLUSTRATIVE EMBODIMENTS","Route Updates","Route Addition","Route Deletion","Additional Route Update Functions","Epilogue"],"p":["1. Technical Field","Certain illustrative embodiments described herein relate to devices and processes for routing packets of information in network communications and, more specifically, to systems and methods for implementing route updates.","2. Background Information and Description of Related Art","Networks of computers such as intranets, local and wide area networks, and public networks such as the Internet typically exchange information in the form of packets\/datagrams. In addition to data, a packet typically includes header section that contains information identifying the packet and indicating its origin and destination. The header can further include network protocol identifiers, which describe the version number of the protocol that is to be used to transmit the information through and amongst networks.","Network devices that transmit data packets and their associated headers amongst networks are known as \u201crouters.\u201d In order to be transmitted from one network to another, data packets are typically routed by one or more routers to one or more public networks, private networks and\/or individual server\/client computers. Routers often include a routing table that specifies the manner in which the data packets are transmitted from the input ports to the output ports of the routers based on the destinations of the packets. Routers can implement a dynamic routing process whereby each router exchanges with other routers through standard routing protocols (such as Routing Information Protocol (RIP) as e.g. defined in RFC 1058 dated June 1988 and available at \u201chttp:\/\/www.ietf.org\/rfc\/rfc1058.txt?number=1058\u201d and\/or Open Shortest Path First (OSPF) as e.g. defined and RFC 1583 dated March 1994 and available at http:\/\/www.ietf.org\/rfc\/rfc1583.txt?number=1583). The periodic route updates of such routing protocols provide information regarding how to route the packets along the paths by which the router is currently connected to other routers and networks. Upon receipt of routing update packets, such as a RIP or OSPF update, each router can process the update and record any new routing information, or network path descriptors, into its routing table.","Routers can have an open network architecture wherein the router includes a control plane that creates and manages the routing protocols, and a separate forwarding plane that forwards the packets pursuant to information specified e.g. in an associated forwarding table, sometimes called a FIB. In such architectures, the forwarding plane may include multiple forwarding elements managed by a single control element. In such cases, each forwarding element may contain both a RIB and a FIB, where a RIB typically contains the routing information that entities exchange via an inter-domain routing protocol, and the FIB typically contains the information that that the entities use to forward the inter-domain traffic.","Unfortunately, routing errors can occur if route updates are implemented at different times by the various forwarding elements controlled by the single control element. For instance, if a packet is received by a router that is processing route updates, the packet could be transmitted by an \u201cupdated\u201d forwarding element to a \u201cun-updated\u201d forwarding element that drops the packet because it has not yet processed the route update. Further compounded the chance of routing errors occurring due to route update inconsistencies is the fact that the forwarding plane typically performs wire speed packet forwarding whereas the control plane operates at a somewhat slower speed.","A system for updating routing information can be realized in, for example, an open network system having a single control element and multiple forwarding elements. In one embodiment of the invention, the routing update is received by a route cache manager in the control element, which in turn may facilitate notification of the routing table update to one or more forwarding elements as well as to one or more functional components within the control element, in a coordinated manner to maintain routing coherency between the control element and the forwarding element(s).","In the following detailed description, numerous specific details are set forth in order to provide a thorough understanding of embodiments of the present invention. However, those skilled in the art will understand that such embodiments may be practiced without these specific details. In other instances, well known methods, procedures, components, and circuits have not been described in detail.","Although various discrete operations will be described herein, the mere order of description should not be construed as to imply that these operations are necessarily performed in the order they are presented.","Reference throughout this specification to \u201cone embodiment\u201d or \u201can embodiment\u201d means that a particular feature, structure, or characteristic described in connection with the embodiment is included in at least one embodiment of the invention. Thus, the appearances of the phrases \u201cin one embodiment\u201d or \u201cin an embodiment\u201d in various places throughout this specification are not necessarily all referring to the same embodiment or invention. Furthermore, the particular features, structures, or characteristics may be combined in any suitable manner in one or more embodiments. Lastly, the terms \u201ccomprising\u201d, \u201cincluding\u201d, \u201chaving\u201d, and the like, as used in the present application, are intended to be synonymous.","In an open networking architecture, a network element typically includes two distinct planes of operation, namely a control plane and a forwarding plane.  illustrates one embodiment of an open architecture based network routing element having separated control and forwarding planes of operation. As shown in , example router architecture  includes a control element  and forwarding elements -, which are physically separated from control element . Control element  may represent a combination of hardware, such as one or more microprocessors and memory elements, and software configured to receive routing updates , such as RIP updates or OSPF Link State Advertisements (LSA) from peer routers (not shown). Likewise, control element  may also generate and transmit route updates  to peer routers (not shown). In one embodiment, control element  processes route updates  and forwards updated routing information, such as FIB updates, to forwarding elements - and\/or one or more clients of control element  in a coordinated manner. A client may represent one or more components within control element , which may use one or more methods associated with the control element and\/or which may listen to one or more events associated with the control element.","Forwarding elements - may represent a combination of hardware (such as one or more microprocessors and memory elements) and software configured to transmit and route data, typically at wire speed. Forwarding elements - may be connected to one or more external networks through one or more peer routers (not shown). Additionally, forwarding elements - may implement and enforce RIB and\/or FIB based updates received from e.g. control element . For example, the RIB may govern the data flow  into the ingress forwarding element  and the data flow  from the egress forwarding element  on e.g. layer  in an OSI model. Moreover, the FIB may govern the forwarding of data packets  between and amongst forwarding elements - (e.g. inter-FE forwarding) on e.g. layer . (label switching layer) of the OSI model. Router  can be connected to other routers associated with private networks (such as intranets, VPNs, LANs, WANs and the like) and\/or public networks (such as the Internet).","In one embodiment, one or more of control element  and forwarding elements - may include one or more network processors to execute instructions designed to implement a network forwarding device, such as a router, in accordance with various embodiments of the invention described herein. In one embodiment, one or more of control element  and forwarding elements - may include one or more processors from the IXP\u2122 family of network processors, available from Intel Corporation of Santa Clara, Calif.",{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 2","b":["200","212","218","212","218","212","218"]},"In the illustrated embodiment, control element  includes a routing protocol processing component , a route cache manager (RCM) , a route management component , and one or more control element based clients  such as, but not limited to, a Resource Reservation Setup Protocol Traffic Engineering (RSVP-TE) based client, a Constraint-Routing Label Distribution Protocol (CRLDP) based client and a Multi-Protocol Label Switching (MPLS) protocol based client. Forwarding element  includes a forwarding engine , which may in turn include one or more routing tables (RIB)  and\/or forwarding tables (FIB) .","In operation, routing protocol processing component  receives a route update, such as a RIP update or an OSPF link state update to a network routing table stored in and\/or maintained by e.g. a kernel of an operating system (hereinafter \u201ckernel\u201d) that is hosted by control element . Routing protocol processing component  in turn notifies RCM  as to the route update information. In one embodiment of the invention, route updates may be received by the kernel via an IOCTL operation, whereas RCM  may receive route update information from routing protocol processing component  via a service interface to e.g. an IP stack. For example, in a VxWorks operating environment RCM  may receive route update information via the routeEnhLib library. In one embodiment RCM  registers with the kernel to receive route update information from the kernel FIB.","In one embodiment, RCM  maintains an internal cached routing table to facilitate coordinated route updating between the control and forwarding element(s), as well as one or more components\/clients of control element  that might utilize route information. In accordance with one embodiment of the invention, in response to receiving the route update information from routing protocol processing component , RCM  coordinates notification of the route update information to route management component  and one or more functional components of control element , such as clients  that may have previously registered with control element . In one embodiment of the invention, RCM  transmits the route update information to route management component  via invocation of one or more application program interfaces (API's). In turn, route management component  manages the interface between control element  and one or more forwarding elements  so as to further facilitate routing coherency between the control element and forwarding element(s).","More specifically, route management component  may derive any RIB and\/or FIB updates determined to be necessary based upon e.g. the route update information. A RIB update may be transmitted from route management component  to forwarding engine  in the form of an updated routing table, whereas a FIB update may be transmitted from route management component  to the forwarding engine in the form of an updated forwarding table. As data is received by router , the data may be transmitted to another FE pursuant to the rules set forth in the forwarding table (FIB)  or to an external network component pursuant to the rules set forth in the routing table (or RIB) .","In one embodiment, one or more clients  may register a callback with RCM . Accordingly, upon receiving a route update involving a route addition or deletion, RCM  may trigger a callback to notify such registered clients as to a given update. In one embodiment, RCM  marks routes to be deleted within an internal cache prior to committing the deletion of the routes from e.g. the FIB. Similarly, in one embodiment, RCM  only commits route additions to its internal cache after the routes have successfully been added to the forwarding plane(s).",{"@attributes":{"id":"p-0028","num":"0027"},"figref":["FIG. 3","FIG. 2","FIG. 3"],"b":["207","206","212","302","207","208","304","207","208","208","306","208"]},"At block  a determination is made as to whether RCM  has received a notification indicating that the new route was successfully added to the forwarding plane. In one embodiment, RCM  receives a callback from the forwarding plane via an IPv4 based control plane callback module. If RCM  has been notified as to the successful addition of the route into the forwarding plane, RCM commits the new route to an internal route cache (block ), and proceeds to notify registered clients within the control element (e.g. as indicated by a client registration table) as to the presence of the newly added route (block ). However, if RCM  has not been notified as to the successful addition of the route into the forwarding plane, or RCM  has been notified as to an unsuccessful addition of the route into the forwarding plane, RCM  will not add the new route to its internal cache (block ). By waiting to notify clients about the route addition until after a route has been successfully added to the forwarding element(s), the chance of packets being misrouted or the client being mislead into relying on an incorrect or otherwise invalid path can be reduced.",{"@attributes":{"id":"p-0030","num":"0029"},"figref":["FIG. 4","FIG. 2","FIG. 4"],"b":["207","212","402","207","207","404","207","406","207","208","408","208","410"]},"At block , a determination is made as to whether the route deletion from the forwarding plane was successful. If the route deletion from the forwarding plane was successful as indicated e.g. by a notification received by RCM , RCM proceeds to remove the route marked for deletion from its internal cache (e.g. RCM  commits the deletion) (block ). However, if the route deletion from the forwarding plane was not successful, the route marked for deletion is not removed from the internal cache, (block ). Accordingly, it is possible to reduce route misuse by the clients by letting the RCM inform the client upfront about the route to be deleted from the forwarding plane.","Due to the extensible nature of open networking architectures, new forwarding elements may be dynamically bound to control elements.  is a flow diagram illustrating a process for updating a newly bound forwarding element with route information, in accordance with one embodiment of the invention. In the illustrated embodiment, the process starts with a newly added forwarding element being detected and configured for operation with (e.g. bound to) control element  (block ). This may involve the control element downloading configuration information such as IP addresses, attributes, filters, and so forth, to the newly bound forwarding element. Thereafter, RCM  is notified as to the existence of the newly bound forwarding element (block ). In turn, RCM  downloads a current cached and synchronized copy of the kernel routing table to route management component  (block ). In one embodiment of the invention, RCM  does not download to the FE(s), routes that are indicated as to be deleted (e.g. in the RCM internal route cache) prior to the actual route deletion being committed. Similarly, in one embodiment, routes marked for addition are downloaded to the FE(s) prior to the route addition being committed.","In one embodiment of the invention, RCM  invokes one or more API calls to cause route cache manager  to commit the copy of the kernel routing table to the correct forwarding element and perform inter-FE configuration if multiple forwarding elements are presented.","In one embodiment of the invention, various applications\/clients such as a Label Information Base (LIB) or an RSVP-TE based client perform route lookups (e.g. next hop lookups for a particular destination IP address) via RCM . In one embodiment, a client application may pass a destination IP address and a subnet mask to RCM  to perform such a route lookup. In response, RCM  searches for the requested route from the internal route cache. However, while doing so, RCM  ignores those routes that are marked as new (e.g. recently added) since their addition is not yet completed, and those routes that are marked to be deleted since they will in fact soon be deleted. Finally, RCM  returns any identified next-hop information to the requesting application.","In one embodiment, RCM  can further notify client applications when the next hop entry for a particular destination IP address changes. For example, a client application may register a callback with RCM , which in turn may cause RCM  to update a client registration table accordingly. Thereafter, if the route changes at any point, RCM  is notified. In one embodiment, since a change to a route entry may include a next hop change, a subnet mask change, a change in metric, and so forth, RCM  performs a check to determine whether the change is a change to the next-hop entry. If the detected change is determined to be to the next hop, the internal cache is updated and the appropriate client applications are contacted.","The foregoing techniques and systems can be implemented in a wide variety of network architectures to effectively update routing information according to an almost limitless number of specific transactional protocols. For example, the routers described herein need not have an Open Networking architecture. Moreover, although the routers have been described has having physically separated control and forwarding planes, the routers can nevertheless have control and forwarding planes residing on the same physical platform. The techniques described herein can be applied across multiple routers that each have only a single forwarding element but collectively have a plurality of forwarding elements. The route update information can be any parameter or datum associated with the handling of a packet, although in various embodiments the update information may include RIP updates, and\/or OSPF link status updates. Each control element can optionally control only a single forwarding element. Alternately, multiple control elements can be connected to a single forwarding element. The forwarding elements need not transfer packets directly from the ingress to the egress port. For example, in certain implementations it may be necessary or desirable to transmit or contingently transmit packets through one or more intermediate forwarding elements.","The components and planar separation of the forwarding and control elements discussed above are merely preferred arrangements\u2014the various components and\/or their functions can be relocated to other planes or elements or can be combined with one another. As an example, the routing protocol processing module, route cache manager and\/or route management component can be integrated into a single program element\/component if desired. Similarly, aspects of the forwarding management module and forwarding engine can be combined if desired. For example, although the forwarding table and routing table are described as being maintained as discrete elements in the forwarding engine in the aforementioned embodiments, the RIB and FIB can nonetheless be integrated into a single table.","Similarly, it will be apparent to those skilled in the art that the specific protocols described above, and their particular sequencing, are merely illustrative embodiments selected for the particular network architecture and control\/forwarding elements illustrated in . Moreover, although reference is made herein to version 4 of the Internet Protocol (IPv4), techniques described herein similar apply to succeeding versions of the Internet Protocol such as e.g. IPv6.","While the above description has been directed primarily to routers, the above techniques can be used to implement updates in any number of network applications, such as administrative updates to client computers in an intranet, LAN, WAN or VPN.","The foregoing techniques can be implemented in an almost limitless number of additional manners dictated by particular network environment(s), transfer protocols, and other design parameters. The foregoing proposed modifications will be understood as merely illustrative by those skilled in the art. It will be understood that various modifications may be made without departing from the spirit and scope of the invention. Accordingly, other embodiments are within the scope of the following claims.","The systems and methods described herein may have only a certain subset of the functionalities described, depending on the particular implementation. In selected embodiments, the foregoing systems and methods improve route coherency via consistent route updating between the forwarding plane and control plane as well as control plan client applications. This in turn reduces the likelihood and\/or frequency of dropped or mis-routed packets. Furthermore, many embodiments provide the aforementioned fail-safe arrangement whereby a route update is aborted if any component involved in implementing the routing and forwarding updates is unable to commit the update in the manner or at the time desired. A router equipped with the above-described components can therefore be optionally configured to \u201croll-back\u201d to a previous routing state in the event any error occurs during an update process."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF DRAWINGS","p":["The invention may best be understood by referring to the following description and accompanying drawings that are used to illustrate embodiments of the invention. In the drawings:",{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0012","num":"0011"},"figref":["FIG. 3","FIG. 2"]},{"@attributes":{"id":"p-0013","num":"0012"},"figref":["FIG. 4","FIG. 2"]},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 5"}]},"DETDESC":[{},{}]}
