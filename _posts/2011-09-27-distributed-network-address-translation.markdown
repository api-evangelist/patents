---
title: Distributed network address translation
abstract: Systems and methods are disclosed that facilitate the management of network address information utilized by hosted computing devices. Each host computing device includes a local network and port address management component that is configured with port address translation information for the specific host computing device. Additionally, one or more edge computing devices also include a local network and port address management component that is configured with network and port address translation information. The network and port address translation information facilitates the correlation of internal network address information associated with a virtual machine instance with a tuple of an externally accessible network address and port address information. The local network and port address translation management components utilize the network and port address translation information to translate communication requests to and from the virtual machine instances without requiring a centralized network and port address translation component.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09055117&OS=09055117&RS=09055117
owner: Amazon Technologies, Inc.
number: 09055117
owner_city: Seattle
owner_country: US
publication_date: 20110927
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","DETAILED DESCRIPTION"],"p":["Generally described, computing devices utilize a communication network, or a series of communication networks, to exchange data. Companies and organizations operate computer networks that interconnect a number of computing devices to support operations or provide services to third parties. The computing systems can be located in a single geographic location or located in multiple, distinct geographic locations (e.g., interconnected via private or public communication networks). Specifically, data centers or data processing centers, herein generally referred to as a \u201cdata center,\u201d may include a number of interconnected computing systems to provide computing resources to users of the data center. The data centers may be private data centers operated on behalf of an organization or public data centers operated on behalf, or for the benefit of, the general public.","To facilitate increased utilization of data center resources, virtualization technologies may allow a single physical computing device to host one or more instances of virtual machines that appear and operate as independent computing devices to users of a data center. With virtualization, the single physical computing device can create, maintain, delete, or otherwise manage virtual machines in a dynamic matter. In turn, users can request computer resources from a data center, including single computing devices or a configuration of networked computing devices, and be provided with varying numbers of virtual machine resources.","In embodiments in which a user (e.g., a customer of the service provider) utilizes a number of networked computing devices, such as a hosted virtual machine network, each networked computing device is typically associated with an externally accessible network address. For example, each networked computing device can be associated with an Internet Protocol (\u201cIP\u201d) address conforming to the Internet Protocol version 4 (\u201cIPv4\u201d) communication protocol. However, a service provider may often be limited in terms of the number of externally accessible network addresses that are available for the networked computing devices. Accordingly, service providers can implement various types of network address translation techniques, generally referred to as Network Address Translation (\u201cNAT\u201d).","In a typically NAT implementation, a service provider can assign each computing device in a hosted network internal, private network addresses that facilitate communication within the hosted network. The service provider then implements a centralized NAT computing device that can correlates a finite set of external network addresses to each of the computing devices in the hosted network. The centralized NAT computing device operates as a gateway translating communications between the internal, private network address of the computing devices in the hosted network and the finite set of externally accessible network addresses. However, centralized NAT devices can be a centralized point of failure for a hosted network and can have difficulty managing large number of communication connections typically associated in larger hosted networks.","Generally described, aspects of the present disclosure relate to the management of communications associated hosted computing devices. Specifically, systems and methods are disclosed that facilitate the management of network address information utilized by hosted computing devices. In one embodiment, a hosted virtual network can include host computing devices and edge computing devices that utilize network and port address translation information to facilitate communication to and from virtual machine instances hosted on the specific host computing device.","Illustratively, the network and port address translation information facilitates the correlation of internal network address information associated with a virtual machine instance with a tuple of an externally accessible network address and network and port address. In one aspect, for a hosted virtual machine network, one or more virtual machine instances may be configured with internal network address and other identifier information that facilitates communication with other components of the hosted virtual machine network. To exchange data with components external to the hosted virtual network, the virtual machine instances (or other computing devices) originate messages associated with internally assigned network addresses and port address identifier information selected from a range of available port address identifiers for the hosted virtual network. Edge computing devices in the hosted virtual network receive communication requests from the virtual machine instances. The edge computing devices utilize network and port address translation information to translate the communication request to correspond to a common IP address for purposes of external network communications. The external communication request also includes the port identification information.","In another aspect, external communications to the virtual machine instances sharing the common IP address can be distinguished by edge computing devices in the hosted virtual machine network by specifying specific port address information for each virtual machine instance. For example, assume two virtual machine instances are configured with same external network address (e.g., 128.227.1.1). Additionally, assume that each virtual machine instance is provided 8-bits of freedom (e.g., 256 ports) for establishing communication channels. Each virtual machine instance can be defined in terms of a network address and port address tuple. By way of illustrative example, the first virtual machine instance can be defined by the network address and port address tuple, e.g., 128.227.1.1:4096-4351. Similarly, the second virtual machine instance can be defined by a different network address and port address tuple, e.g., 128.227.1.1:4351-4657. Because the two virtual machine instances in the example share a common network address (e.g., 128.227.1.1), the local network address and port address management component in the edge computing device can identify an appropriate virtual machine instances based on a port address selected from the range of port addresses associated with each virtual machine instance.","Accordingly, the local network and port address translation management component utilizes the network and port address translation information to translate communication requests to and from the virtual machine instances on the host computing device in a distributed manner and without requiring a centralized network and port address translation component. Additionally, for some virtual machine instances that will not likely utilize external network communications, the virtual network can allocate a common external address to these devices (distinguished by port address identifiers\/addresses). Still further, client computing device networks or service providers, can provide varying ranges of port addresses, generally referred to as port compression, based on availability of network addresses, financial criteria, and the like.","Illustratively, the present disclosure will be discussed with regard to illustrative architectures and interaction between virtual machine instances hosted on host computing device. However, one skilled in the relevant art will appreciate that the present disclosure may be applicable to networks including physical computing devices only or a combination of host computing devices and physical computing devices. Additionally, although the present disclosure will be discussed with regard to various addressing protocols utilized in conjunction with data packet delivery via the wireless communication networks including the Internet Protocol version 4 (\u201cIPv4\u201d), one skilled in the relevant art will appreciate that the present disclosure is not limited to any particular network addressing protocol.",{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 1","b":["100","100","102","104"]},"In one embodiment, the client computing device networks  can correspond to one or more computing devices that are controlled on or behalf of a user (such as a system administrator). The communication network  may be, for instance, a wide area network (WAN), a local area network (LAN), or a global communications network. For purposes of an illustrative embodiment, the client computing device networks  can correspond to customers of the virtual network  for requesting instantiation of hosted virtual network components. The virtual network environment  can also include","The virtual network  can include multiple physical computing devices, generally referred to as host computing devices . In one embodiment, the host computing devices  are capable of hosting multiple virtual machine instances . At least some of the virtual machine instances  may be provisioned to provide a variety of different desired functionalities depending on the needs of the service provider providing the virtual network  or of the client computing device networks  utilizing the virtual network. Examples of the types of desired functionality, include but are not limited to: database management, serving or distributing data or content (e.g., Web servers), managing load balancing or network resources, managing network connectivity or security, providing network addressing information, managing client or server redirection, or any other functionality associated with a data center. One skilled in the relevant art will appreciate that the virtual network  is logical in nature and can encompass host computing devices  from various geographic regions. Additionally, although the host computing devices  will be discussed with regard to hosted virtual machine instances , one or more of the host computing devices  may be physical machines configured to provide specified functionality in the virtual network  without hosting virtual machine instances , generally illustrated as host computing device  without virtual machine instances  in . Accordingly, reference in the illustrative examples and embodiments to host computing devices  or host computing device can include host computing devices hosting virtual machines  or not hosting virtual machine instances.","The virtual network  also includes a network address and port address management component  for processing configuration requests submitted by client computing device networks  to configure network address and port address information for virtual machine instances on the host computing devices  (or for the host computing devices). As illustrated in , the network address and port address management component  is a centralized component of the virtual machine network  for obtaining client configuration requests and forwarding the requests to a local network and port address management component associated with a specified host computing device . It should be appreciated that, although the network address and port address management component  is depicted for the purpose of example as a single, stand alone logical component in illustrative , the routines and steps performed by the network address and port address management component  may be distributed among any number of components and executed in hardware or software. For example, multiple network address and port address management components  may be implemented in the virtual network . Additionally, although the network address and port address management component  is illustrated as logically associated within the virtual network , the network address and port address management component  may be implemented in a separate networked environment, in conjunction with client computing device networks , or otherwise integrated into other components\/systems of the virtual network . Still further, in other embodiments, the network address and port address management component  may be omitted altogether as will be explained in greater detail below.","In addition to the network address and port address management component , each host computing device  includes a local network address and port address management component . In one aspect, the local network address and port address management component  interfaces with the network address and port address management component  to obtain client configuration requests. In another aspect, the local network address and port address management component  processes communication requests to and from virtual machine instances  in accordance with network address and port address information.","The virtual network  also includes a number of edge computing devices  for processing communication requests between host computing devices  and one or more components external to the virtual network . The edge computing devices  may correspond to any one of a number of computing devices for facilitating communications, or combination thereof. Additionally, one or more of the edge computing devices  may be implemented in a virtualized environment as virtual machine instances on a host computing device. Illustratively, each edge computing device also includes a local network address and port address management component . In one aspect, the local network address and port address management component  interfaces with the network address and port address management component  to obtain client configuration requests. In another aspect, the local network address and port address management component  processes communication requests to and from virtual machine instances  in accordance with network address and port address information.","With continued reference to , the virtual network  can further include a network and port address data store  for maintaining, at least in part, network and port address information related to host computing devices . As illustrated in , each local network address and port address management component  and edge computing device  can also include at least a portion of the network and port address data store  as local network and port address data store ,  for processing communications associated with hosted virtual machine instances. Illustratively, the network and port address data store  and local network and port address data store ,  correspond to network attached storage (NAS), database servers, local storage, or other storage configurations which may be implemented in a centralized or distributed manner.","Illustratively, the network address and port address management component  or local network address and port address management components ,  may be associated with computing resources such as central processing units and architectures, memory, mass storage, graphics processing units, communication network availability and bandwidth, etc. Generally, however, the network address and port address management component  and local network address and port address management components ,  may include one or more processing units, such as one or more CPUs. The network address and port address management component  and local network address and port address management components ,  may also include system memory, which may correspond to any combination of volatile and\/or non-volatile storage mechanisms. The system memory may store information that provides an operating system component, various program modules, program data, or other components. The network address and port address management component  and local network address and port address management components ,  performs functions by using the processing unit(s) to execute instructions provided by the system memory. The network address and port address management component ,  and local network address and port address management components ,  may also include one or more types of removable storage and one or more types of non-removable storage. Still further, the network address and port address management component ,  and local network address and port address management components ,  can include communication components for facilitating communication via wired and wireless communication networks, such as communication network .","Turning now to , a simplified block diagram of the virtual network environment  of  illustrating the configuration and processing of client configuration requests on one or more host computing devices  will be described. For purposes of illustration, many of the components of the virtual network environment  have been omitted. However, one skilled in the relevant art will appreciate that the illustrated interaction between components may utilize the omitted components or additional components not previously illustrated in .","With reference to , in one embodiment, the client computing network  can initiate a request to the network address and port address management component  to authorize or request the configuration of network address and port address information for one or more hosted computing devices  or edge computing devices  associated with the client computing device network  (1). The request can identify one or more specific, instantiated host computing device(s)  or be made in conjunction with a request to instantiate one or more host computing device(s). Additionally, the request can also identify one or more edge computing devices  or be made in conjunction with a request to instantiate one or more edge computing devices. In one embodiment, the configuration of network address and port address information can include the specification or request of an external network address that will be assigned to host computing device. For example, an administrator associated with a client computing network  may be presented with an interface (e.g., a graphical user interface) that identifies network addresses that could be utilized by the client computing network . In another example, the client computing network  can also specify a selected external network address by identification of network address information in accordance with an Application Programming Interface (\u201cAPI\u201d) call.","In another embodiment, the configuration of the network address and port address information may include the specification as to the number of hosted computing devices  that will share a specified external network address. As previously discussed, multiple host computing devices  assigned to a shared external network address are distinguished by associating each host computing device with port address information. More specifically, each host computing device  can be configured to correspond to a defined range of the available port addresses. By way of illustrative example, one skilled in the relevant art will appreciate that some networking protocols, such as Transport Control Protocol (\u201cTCP\u201d) or User Datagram Protocol (\u201cUDP\u201d) utilize a 16 bits integer to define port address information utilized to establish communication channels, generally referred to as sockets in conjunction with a network address. Accordingly, for each network address, there could be up to 65,535 (2) different combinations of network address and port address. In accordance with this embodiment, however, each computing device or instance associated with a common network address can be associated with a range of the total available port addresses in which the overall size of the range would represent that potential number of simultaneous connections any virtual machine instance can maintain. For example, utilizing 8-bits to define port address ranges would allow each virtual machine instance up to 256 simultaneous connections, while utilizing 12-bits to define port address ranges would allow each virtual machine instance up to 4,096 simultaneous connections. As such, a service provider associated virtual network  may implement different pricing plans depending on the size of the port address ranges a client computing network  is willing to accept for host computing devices  or virtual machine instances .","One skilled in the relevant art will appreciate, however, that the client configuration request can be directly transmitted to a local network address and port address management component on the host computing devices  or edge computing devices .","Based on the received request, the network address and port address management component  processes the network and port address configuration request (2). In one embodiment, the processing of the network and port address configuration request can corresponds to the identification of one or more host computing devices  and their corresponding local network address and port address management components  or edge computing devices and their corresponding local network address and port address management components  that will receive the client configuration request. In another embodiment, the processing of the network and port address configuration request can include the determination of network address and port address information for each host computing device  or edge computing device  corresponding to the client configuration request. In this embodiment, the network address and port address management component  may conduct some additional processing, such as the selection of a network addresses from a set of network addresses. For example, if the client computing network  did not (or was not allowed to) select a network address, the network address and port address management component  can select a network address that corresponds to the level port address ranges (e.g., port address compression) selected by the client computing network .","In another aspect, the network address and port address management component  may select a range of port address from available ranges of port addresses for a set of host computing devices  (including virtual machine instances  hosted on the host computing devices ) sharing a common external network address. One skilled in the relevant art will appreciate that some ranges of port addresses may be reserved for specific functions (e.g., port 25 for incoming Simple Mail Transfer Protocol (\u201cSMTP\u201d) requests). As such, the network address and port address management component  can ensure that some ranges of port addresses are not assigned. The network address and port address management component  can then store any of the network address and port address information obtained in the client configuration request or otherwise generated based on the processing of the client configuration request.","With continued reference to , the network address and port address management component  can then transmit the appropriate client configuration request (or portion thereof) to one or more local network address and port address management component  on selected host computing devices  or to the local network address and port address management component  on selected edge computing devices  (3). Based on the receipt of the client configuration request, the respective local network address and port address management components ,  processes the network address and port address information. Illustratively, the local network address and port address management components ,  can complete some or all of the processing previously described with regard to the network address and port address management component . The local network address and port address management components ,  can also store locally maintained network address and port address information, such as an IP table. A description of the utilization of the network address and port address information will be described with regard to .","Turning now to , during the execution of the virtual machine instances on the hosted computing device , one or more of the virtual machine instances can generate communication requests to components external to the virtual network  (1). As previously described, each virtual machine instance can be associated with an internal, private network address that facilitates communications to the virtual machine instances within the virtual network . However, the internal, private network address is not typically available to direct communications with external components, such as computing network .","In accordance with an illustrative embodiment, the local network address and port address management component  processes the communication request by including in the communication request port address information associated with the virtual machine instance  generating the communication request (2). The port address information can be selected from a range of port address identifiers allocated to the components of the hosted virtual network. From the perspective of the virtual machine instances  and host computing devices  the outgoing communication request still identifies the private, local network address of the virtual machine instance.","Upon receipt of the communication request including the specified port address identifier, a receiving edge computing device  processes the communication request and translates the communication (3). Illustratively, the translation of the communication request relates to the modification of information identifying the originating network address of the transmitting device to correspond to the external network address associated with the virtual machine instance. Additionally, the translation of the communication request also includes the port address identification information corresponds the transmitting virtual machine instance  to correspond to the port address correlated to the virtual machine instance or selecting one of a range of possible port addresses. One skilled in the relevant art will appreciate, however, that the translation of the communication request does not require the utilization of a central translation component, such as a port address translation component. Accordingly, the translation of the communication request can be distributed throughout at least portions of the virtual network  to one or more edge computing devices .","The receiving edge computing device  then causes the transmission of translated communication request to the destination (4). Although not illustrated in , the transmission of the translated communication request can include the utilization of a number of additional components of the virtual network .","With reference now to , at some point, a computing network  can generate communications that are received at an edge computing device  and which identify the external network address and port address of a virtual machine instance (1). As previously described, in some embodiments, multiple virtual machine instances on a host computing device  may share a common network address, such as in hosted virtual machine network. Based on the received communication, a corresponding local network address and port address management component  on the edge computing device  processes the communication request by translating the incoming communication request (2). Specifically, in one embodiment, the local network address and port address management component  can modify the information identifying the destination address of the communication request to the internal, private network address of a virtual machine instance corresponding to the specified network address and port address in the incoming communication request.","Once the communication request has been translated, the communication request is transmitted to a corresponding virtual machine instance (3). In this embodiment, the receiving virtual machine instance does not need to be aware of the shared external network address or assigned port address that is used to facilitate communication. The received communication can be processed by the receiving virtual machine instance  (4).","Turning to , a flow diagram illustrative of a network address and port address configuration routine  implemented by local network address and port address management component  or local network address and port address management component  will be described. While routine  will be described with regard to implementation by the local network address and port address management component  or local network address and port address management component , one skilled in the relevant art will appreciate that routine , or some portion thereof, may be implemented other components of the virtual network . For example, one or more of aspects of routine  may be implemented by the network address and port address management component .","At block , the local network address and port address management component obtains a client configuration request. In one embodiment, the request can be transmitted by a client computing network . As previously described, the request can identify one or more specific host computing devices  or virtual machine instances that need to be configured. The request can be transmitted in accordance with an API call. Additionally, the client configuration request can also include criteria that specify types or groups of virtual machine instances and that can be used by the local network address and port address management component ,  to select specific virtual machine instances to configure. For example, the client configuration request may include a specification of a class of virtual machine instances (e.g., all database servers). Still further, the client configuration request can include criteria specifying a minimum, maximum or other threshold number of simultaneous connections that each host computing device  can maintain. Similarly, the client configuration request can further specify different financial cost criteria that may be utilized in selection of ranges of port address information.","At block , the local network address and port address management component identifies one or more virtual machine instances that will be configured. At block , routine  implements a loop in which all the identified virtual machine instances will be configured on all host computing devices . Accordingly, the next host computing device  is selected as the next computing device. At block , the local network address and port address management component determines a network and port address tuple for each virtual machine instance hosted in a specific host computing device . As previously described, the local network address and port address management component may conduct some additional processing, such as the selection of a network addresses from a set of network addresses. In another example, the local network address and port address management component may select a port address range from available range of port addresses that has been selected for a set of host computing devices  sharing a common network address. As previously described, each host computing device  (or virtual machine instance ) will be distinguish from other host computing devices  sharing the same network address based on port addresses selected from the allocated range of port addresses.","At block , the local network address and port address management component can then store any of the network address and port address information obtained in the client configuration request or otherwise generated based on the processing of the client configuration request. Additionally, at block , the local network address and port address management component can cause the distribution of the network address and port address information to one of the data stores. At decision block , a test is conducted to determine whether additional virtual machine instances need to be configured or whether additional host computing devices need to be configured. If so, routine  returns to block . Alternatively, routine  terminates at block .","Turning to , a flow diagram illustrative of a communication processing routine  implemented by the local network address and port address management component  of the edge computing device will be described. As previously described, although routine  will be described with regard to communication requests from a virtual machine instance, one skilled in the relevant art will appreciate that at least aspects of routine  can be implemented in accordance with host computing devices  that correspond to physical computing devices not implementing any virtual machine instances.","At block , the local network address and port address management component  obtains a communication request from a hosted virtual machine instance. As previously described, each virtual machine instance can be associated with an internal, private network address that facilitates communications to the virtual machine instances within the virtual network . However, the internal, private network address is not typically available to direct communications with external components, such as computing network .","At block , the local network address and port address management component  of the edge device  identifies network address and port address information that corresponds to the communication request. At block , the local network address and port address management component  then identifies a specific network address and port address tuple that will be utilize to translate the communication request. As previously described, the local network address and port address management component  can process the communication request to generate some portion of the network address or port address information from a set of available network address or port address information. For example, the local network address and port address management component  can select from a range of port address information.","At block , the local network address and port address management component  translates the communication request. Illustratively, the translation of the communication request relates to the modification of information identifying the originating network address of the transmitting device to correspond to the external network address associated with the virtual machine instance. Additionally, the translation of the communication request also relates to the modification of information specifying a port address of the transmitting device to correspond to the port address correlated to the virtual machine instance or selecting one of a range of possible port addresses. At block , the routine  terminates.","It will be appreciated by those skilled in the art and others that all of the functions described in this disclosure may be embodied in software executed by one or more processors of the disclosed components and mobile communication devices. The software may be persistently stored in any type of non-volatile storage.","Conditional language, such as, among others, \u201ccan,\u201d \u201ccould,\u201d \u201cmight,\u201d or \u201cmay,\u201d unless specifically stated otherwise, or otherwise understood within the context as used, is generally intended to convey that certain embodiments include, while other embodiments do not include, certain features, elements and\/or steps. Thus, such conditional language is not generally intended to imply that features, elements and\/or steps are in any way required for one or more embodiments or that one or more embodiments necessarily include logic for deciding, with or without user input or prompting, whether these features, elements and\/or steps are included or are to be performed in any particular embodiment.","Any process descriptions, elements, or blocks in the flow diagrams described herein and\/or depicted in the attached figures should be understood as potentially representing modules, segments, or portions of code which include one or more executable instructions for implementing specific logical functions or steps in the process. Alternate implementations are included within the scope of the embodiments described herein in which elements or functions may be deleted, executed out of order from that shown or discussed, including substantially concurrently or in reverse order, depending on the functionality involved, as would be understood by those skilled in the art. It will further be appreciated that the data and\/or components described above may be stored on a computer-readable medium and loaded into memory of the computing device using a drive mechanism associated with a computer readable storing the computer executable components such as a CD-ROM, DVD-ROM, or network interface further, the component and\/or data can be included in a single device or distributed in any manner. Accordingly, general purpose computing devices may be configured to implement the processes, algorithms, and methodology of the present disclosure with the processing and\/or execution of the various data and\/or components described above.","It should be emphasized that many variations and modifications may be made to the above-described embodiments, the elements of which are to be understood as being among other acceptable examples. All such modifications and variations are intended to be included herein within the scope of this disclosure and protected by the following claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The foregoing aspects and many of the attendant advantages will become more readily appreciated by reference to the following detailed description, when taken in conjunction with the accompanying drawings, wherein:",{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0008","num":"0007"},"figref":["FIGS. 2A-2C","FIG. 1"]},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 4"}]},"DETDESC":[{},{}]}
