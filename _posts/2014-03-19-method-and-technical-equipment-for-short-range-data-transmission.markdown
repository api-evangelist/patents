---
title: Method and technical equipment for short range data transmission
abstract: A method, an apparatus, a system and a computer program product are provided for Bluetooth low energy technology. The method may be carried out by a Bluetooth low energy module. The method may include: detecting an advertisement packet from an advertising device; extracting time information of the advertisement packet; generating a new time information on the basis of the extracted time information; and sending an advertisement packet at the new time information. A system may include a plurality of advertising devices that implement the method, with one of the advertising devices being a master advertiser, and the other advertising devices being slave advertisers.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09479892&OS=09479892&RS=09479892
owner: Silicon Laboratories Finland Oy
number: 09479892
owner_city: Espoo
owner_country: FI
publication_date: 20140319
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","TECHNICAL FIELD","BACKGROUND","SUMMARY","DESCRIPTION OF EXAMPLE EMBODIMENTS"],"p":["This application claims priority under 35 USC \u00a7119 to Finnish patent application 20135459 filed on May 3, 2013, the disclosure of which is incorporated herein by reference in its entirety.","The present invention relates to Bluetooth low energy. In particular, the present invention relates to advertising in Bluetooth low energy.","Bluetooth Low Energy (BLE) relates to Bluetooth wireless radio technology. It has been designed for low-power and low latency applications for wireless devices within short range. Today, typical BLE applications can be found from healthcare, fitness, security, smart energy, industrial automation and home entertainment. However, BLE is not limited only those, but increasingly more new applications utilizing BLE technology are designed.","The difference between BLE and classic Bluetooth is that the BLE devices consume remarkably less power for communication than classic Bluetooth devices. In addition, the BLE is able to start the data transmission quicker than the classic Bluetooth. This makes it possible to have BLE devices constantly on and to communicate intermittently with other devices.","When there are multiple devices with BLE capability in close proximity, the continuous data transfer may cause interferences or collision of packets. There is, therefore, a need for a solution that improves the technology of BLE modules to avoid these problems.","Now there has been invented a method and technical equipment implementing the method, by which the above problems are alleviated.","According to a first aspect, a method comprises detecting an advertisement packet from an advertising device; extracting time information of the advertisement packet; generating a new time information on the basis of the extracted time information; and sending an advertisement packet at the new time information.","According to a second aspect, an apparatus comprises processing means and memory means, wherein the apparatus is configured to detect an advertisement packet from an advertising device; extract time information of the advertisement packet; generate a new time information on the basis of the extracted time information; and send an advertisement packet at the new time information.","According to a third aspect, a system comprises a plurality of advertising devices, wherein one of the advertising device is a master advertiser, and the other advertising devices is slave advertisers, wherein each slave advertiser is configured to detect an advertisement packet from a master advertiser; extract time information of the advertisement packet; generate a new time information on the basis of the extracted time information; and send an advertisement packet at the new time information.","According to a fourth aspect, a computer program product embodied on a non-transitory computer readable medium, comprising computer program code configured to, when executed on at least one processor, cause an apparatus or a system to: detect an advertisement packet from an advertising device; extract time information of the advertisement packet; generate a new time information on the basis of the extracted time information; and send an advertisement packet at the new time information.","According to an embodiment, the new time information is generated by adding an offset to the extracted time information.","According to an embodiment, the advertisement packet is detected by means of an address of the advertising device.","According to an embodiment, the advertisement packet is detected from a data contained in said advertisement packet.","According to an embodiment, the time information of the advertisement packet is T_advEvent=advInterval+advDelay, where advInterval is an interval between advertisement packets, and advDelay is a pseudo-random number.","According to an embodiment, the new time information is T_advEvent=T_advEvent+offset, where offset is configuration data.","According to an embodiment, the apparatus carrying out the method is a Bluetooth low energy module.",{"@attributes":{"id":"p-0024","num":"0023"},"figref":["FIG. 1","FIG. 1"],"b":["100","100","110","120","130","110","120","120","120","130"]},"The link layer provides ultra-low power idle mode operation and device discovery (i.e. connection mode and advertising mode handling). The link layer also is in charge for packet transmission and responding.",{"@attributes":{"id":"p-0026","num":"0025"},"figref":["FIG. 2","FIG. 1","FIG. 1"],"b":["200","210","210","210","135","200","110","130","135"]},"In BLE technology, a number of slave devices can be connected to a master device. The master is able to communicate with one or more slave devices, also simultaneously. To let the master know about the slave devices, the slave devices (or at that point \u201cadvertisers\u201d) periodically pass advertisement packets which a scanning device (i.e. \u201cscanner\u201d) is scanning. When the scanner connects to an advertiser, the advertiser is called \u201ca slave\u201d and the scanner is called \u201ca master\u201d.","As said, more than one slave can be connected to the master. Therefore, also a numerous amount of advertisement packets travels over the air. However, the advertisers are not synchronized, which may cause interference if there are e.g. hundreds of devices in close proximity. The interference may cause loss of packets.","Prior the invention, the devices in advertiser mode (i.e. \u201cadvertisers\u201d) are required to use a random delay in advertisement packets to reduce device interference if multiple devices advertise at the same time and same interval. T_advEvent specifies the time when an advertisement packet from an advertiser is transmitted, T_advEvent=advInterval+advDelay, where advInterval is an interval between advertising events (i.e. advertisement packets), e.g. 20 ms to 30 ms. advDelay is a pseudo-random number within a range 0 ms to 10 ms. advDelay is generated by the BLE link-layer for each advertising event.","However, much more reliable advertising can be achieved by synchronizing the advertisers according to an embodiment of the invention. In this embodiment, a \u201cmaster\u201d advertiser is selected among a group of advertisers. When such \u201cmaster advertiser\u201d is selected, the rest of the advertisers are \u201cslave advertisers\u201d. In order to utilize the present embodiment, the advertisers are able to perform both scanning and advertising.","The master advertiser may be configured in advance, or it can be selected \u201con the fly\u201d. In both cases, the selected master advertiser may advertise with a specific advertisement packet which the slave advertisers are able to detect and use to determine which advertisement packet originated from the master advertiser. For example, a master advertiser's advertisement packets' payload may contain information that this is the master advertiser. The payload may contain, for example, an identification of the usable Bluetooth\/BLE network. As an alternative, the address of the master advertiser may be stored in the memory of the slave advertisers as a configuration data. It is to be noticed, that this \u201cmaster advertiser\u201d may be different from the scanner who will act as the master after connection, as will be shown in . As an alternative, the master advertiser  is the scanner .","When a slave advertiser either knows the address of the master advertisers or knows the specific packet of the master advertisers, the slave advertiser is able to scan the packet in the air. When such a packet is detected, the slave advertiser is able to extract T_advEventof the master advertisement packet from the packet, which T_advEventis to be utilized in the advertisement packets of the slave advertiser. T_advEventof the master advertisement packet is in the form of advInterval+advDelay as described above. advInverval is selected in advance, either configured by a user or by application. advDelay is a pseudorandom number generated at each interval. T_advEventis used to send advertisement packets from the master advertiser, and T_advEventis relative to the previous advertisement packet from the master advertiser.","The previous process, i.e. scanning the master advertisement packet, is performed by each of the slave advertisers, whereby each of them will know T_advEventof the master advertisement packet. This T_advEventof the master advertisement packet is completed by the slave advertisers with a specific offset to generate T_advEventfor the slave advertisement packet. The specific offset is configuration data in the slave advertising device, meaning that it may be stored in the device in advance. When the configuration data is defined for different devices, it is taken care of that different devices have different offsets. This kind of operation makes it possible to synchronize the slave advertisers to the \u201cmaster advertiser\u201d. The synchronization in this example means that the advertisement packets of the slave advertisers are transmitted at different times to prevent collisions and interference.","So, instead of using a pseudo-random number that is received from the link-layer, the T_advEventof the master advertiser is utilized by the slave advertisers in the present embodiments. The slave advertisers schedule their own advertisement times by adding an accurate offset to the T_advEvent of the master advertisement packet as follows: T_advEvent=MasterAdv+offset, where MasterAdv is T_advEvent=AdvInterval+AdvDelay of the master advertiser. As said, the offset, replacing the pseudo-random number, may be configuration data being defined for each slave advertiser in advance. Instead, the master advertiser may configure the offset for the slave advertiser (i.e. \u201cslave-offset\u201d) by delivering the slave-offset in its advertisement packet. Yet as a further alternative, the master advertiser may open a connection with the slave advertiser and configure the slave-offset through the connection. The offset may also then be stored in the configuration data of the slave advertiser.","In an embodiment, each offset is a multiple of 2.5 ms, whereby up to 400 advertisers are allowed during one second with no overlap. However, the invention is not limited to this embodiment, but the offset can be any time value.","T_advEventof the slave advertisement packets are updated every time a new advertisement packet from a master advertiser is transmitted to keep the slave advertisers in synchronization. As an alternative, a random number can be shared between slave advertising devices, so they can choose the same pseudorandom offset. This may be contained in the configuration data of the slave advertiser, or in the advertisement packet of the master advertiser. In the latter case, the master advertisement packets should still be scanned to compensate the clock jitter.","If a new advertisement packet from the master advertiser is missed by the slave advertisers, the synchronization of the slave advertiser is lost. In that case, the slave advertisers need to scan the advertisement packets again, until an advertisement packet from the master advertisers is found.",{"@attributes":{"id":"p-0038","num":"0037"},"figref":["FIGS. 3-4","FIG. 3","FIG. 3"],"b":["350","310","320","350","310","32","350","310","320","350","310","320","350","310","320","310","320","350","310","320","310","320"]},{"@attributes":{"id":"p-0039","num":"0038"},"figref":["FIG. 4","FIG. 4","FIG. 3","FIG. 4"],"b":["350","310","320","320","310","320","310","350","320","310"],"sub":["main ","adv"]},"When the scanner  wishes to connect with one or more of the advertisers -, the scanner performs the connection initiation by sending a connection request (CONNECTION_REQ) to the advertisers -. After the connection is formed, the devices - may transmit application data to the central device .","In the example of , the master advertiser  and the scanner  are different devices. However, the scanner  may be the master advertiser whereby the advertiser  is a slave advertiser as devices .",{"@attributes":{"id":"p-0042","num":"0041"},"figref":"FIG. 5"},"The various embodiments may provide advantages. Synchronization of advertisers generates more reliable advertising because packet losses can be avoided. Therefore, the variety of applications using BLE can be expanded towards even more critical solutions, where packet losses are even more undesired. An example of such an application is a medical application, where wireless ECG sensors (electrocardiography) based on BLE transmits heart-related data to a monitor. This is an application, where synchronization of the advertisers is very important for accurate timing.","The various embodiments of the invention can be implemented with the help of computer program code that resides in a memory and causes the relevant BLE enabled devices, i.e. an apparatus comprising the BLE module, to carry out the invention.","It is obvious that the present invention is not limited solely to the above-presented embodiments, but it can be modified within the scope of the appended claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"DESCRIPTION OF THE DRAWINGS","p":["In the following, various embodiments of the invention will be described in more detail with reference to the appended drawings, in which",{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIGS. 4-4"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 5"}]},"DETDESC":[{},{}]}
