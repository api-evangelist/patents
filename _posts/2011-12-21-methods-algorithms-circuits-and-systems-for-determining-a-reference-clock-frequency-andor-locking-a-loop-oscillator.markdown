---
title: Methods, algorithms, circuits, and systems for determining a reference clock frequency and/or locking a loop oscillator
abstract: Apparatuses, methods, systems, algorithms, and circuits for reference clock frequency determination are disclosed. In one embodiment, a circuit for detecting a reference clock frequency can include a clock counter configured to count a number of cycles of the reference clock over a predetermined portion of a sleep clock to provide a reference clock cycle count, where the sleep clock has a known frequency and a predetermined accuracy; a frequency estimator configured to estimate the reference clock frequency from the reference clock cycle count and the known frequency of the sleep clock; and a frequency selector configured to select a closest frequency to the estimated reference clock frequency from a plurality of allowed frequencies.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08830002&OS=08830002&RS=08830002
owner: Marvell World Trade Ltd.
number: 08830002
owner_city: St. Michael
owner_country: BB
publication_date: 20111221
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"p":["This application is a continuation of U.S. patent application Ser. No. 12\/578,536, filed on Oct. 13, 2009 (which issued as U.S. Pat. No. 8,089,318), which claims the benefit of U.S. Provisional Patent Application No. 61\/106,371, filed on Oct. 17, 2008, each of which is incorporated herein by reference in its entirety.","The present invention generally relates to the field of integrated circuits. More specifically, embodiments of the present disclosure pertain to circuits and methods for determining a reference clock frequency and\/or locking a loop oscillator, such as a phase-locked loop (PLL).","Phase-locked loop (PLL) circuitry may be used to generate and control one or more clock signals to be propagated throughout an integrated circuit (IC). In system-on-a-chip (SOC) and other IC applications, such PLLs have limited lockable frequency ranges. To allow PLLs to lock despite such limited lockable frequency ranges, a frequency of a reference clock can be provided to the PLL upon power-up or initialization to facilitate locking onto the reference clock for generation of output PLL clocks.","Many ICs also support a number of different reference clock frequencies. In one example, as many as ten different frequencies can be accommodated by a single IC (e.g., an SOC). Some approaches include the use of four strap pins to encode the different reference clock frequencies. In such approaches, the SOC, IC and\/or application can be programmed to support a particular reference clock frequency. However, the strap pin approach has drawbacks including increased printed-circuit board (PCB) space since one or more additional external resistor(s) are required, greater on-chip real estate for input buffer, electrostatic discharge (ESD), decoder, and other associated circuitry, and a resultant increase in costs.","Embodiments of the present disclosure relate to circuits and methods for determining a frequency of a reference clock.","In one aspect, the disclosure concerns a circuit for detecting a frequency of a reference clock, the circuit comprising a clock counter configured to count a number of cycles of the reference clock over a predetermined portion of a sleep clock to provide a reference clock cycle count, a frequency estimator configured to estimate the frequency of the reference clock based on the reference clock cycle count, and a frequency selector configured to select a closest frequency to the estimated reference clock frequency from a plurality of allowed frequencies. In certain embodiments, the sleep clock is an external sleep clock, and in other embodiments, the sleep clock is an internal sleep clock.","In the case of an internal sleep clock, the circuit can further comprise a decoder configured to decode a plurality of inputs and select one of a plurality of allowed frequency groups (each of which includes a subset of unique allowed frequencies) based on the inputs. The frequency selector can be configured to select a frequency closest to the estimated reference clock frequency from a selected group of allowed frequencies.","In various embodiments, the circuit can further comprise an input configured to supply the sleep clock to the circuit, and\/or a phase-locked loop (PLL) configured to lock onto the reference clock using the closest frequency as an initial frequency. In addition, the frequency selector can further comprise a memory configured to store the plurality of allowed frequencies, and\/or a comparator configured to compare the closest frequency to at least a subset of the plurality of allowed frequencies.","In another aspect, the disclosure concerns a method of determining a frequency of a reference clock. The method generally comprises counting a number of cycles of the reference clock over a predetermined portion of a sleep clock to provide a reference clock cycle count, estimating the frequency of the reference clock based on the reference clock cycle count and a frequency of the sleep clock, and selecting a closest frequency to the estimated reference clock frequency from a plurality of allowed frequencies. The predetermined portion of the sleep clock can comprise an integer number of cycles or phases of the sleep clock. In various embodiments, the method further comprises programming the plurality of allowed frequencies into a memory and\/or providing the closest frequency to a phase-locked loop (PLL), and locking the PLL to the reference clock using the closest frequency.","In alternative embodiments, the sleep clock can be external or internal. In the latter case, the method can further comprise decoding a plurality of encoder inputs to select one of a plurality of allowed frequency groups. Each allowed frequency group generally includes a subset of unique allowed frequencies, and the closest frequency is generally selected from the selected allowed frequency group.","The circuits, architectures, systems, methods, algorithms and software of the present disclosure advantageously provide a mechanism for reliably determining a frequency of a reference clock, while at the same time, reducing or eliminating the dedicated use of strap or other input pins for doing so. The present approach can therefore reduce costs of manufacturing both the IC and a printed circuit board including the IC, as well as reduce board space. These and other advantages of the present invention will become readily apparent from the detailed description of various embodiments below.","Reference will now be made in detail to embodiments of the disclosure, examples of which are illustrated in the accompanying drawings. While the invention will be described in conjunction with various embodiments, it will be understood that the described embodiments are not intended to limit the invention. On the contrary, the disclosure is intended to cover alternatives, modifications and equivalents that may be included within the spirit and scope of the disclosure as defined by the appended claims. Furthermore, in the following detailed description, numerous specific details are set forth in order to provide a thorough understanding of the present disclosure. However, the present invention may be practiced without these specific details. In other instances, well-known methods, procedures, components, and circuits have not been described in detail so as not to unnecessarily obscure aspects of the present invention.","Some portions of the detailed descriptions which follow are presented in terms of processes, procedures, logic blocks, functional blocks, processing, and other symbolic representations of operations on data bits, data streams or waveforms within a computer, processor, controller and\/or memory. These descriptions and representations are generally used by those skilled in the data processing arts to effectively convey the substance of their work to others skilled in the art. A process, procedure, logic block, function, operation, etc., is herein, and is generally, considered to be a self-consistent sequence of steps or instructions leading to a desired and\/or expected result. The steps generally include physical manipulations of physical quantities. Usually, though not necessarily, these quantities take the form of electrical, magnetic, optical, or quantum signals capable of being stored, transferred, combined, compared, and otherwise manipulated in a computer, data processing system, or logic circuit. It has proven convenient at times, principally for reasons of common usage, to refer to these signals as bits, waves, waveforms, streams, values, elements, symbols, characters, terms, numbers, or the like.","All of these and similar terms are associated with the appropriate physical quantities and are merely convenient labels applied to these quantities. Unless specifically stated otherwise and\/or as is apparent from the following discussions, it is appreciated that throughout the present application, discussions utilizing terms such as \u201cprocessing,\u201d \u201coperating,\u201d \u201ccomputing,\u201d \u201ccalculating,\u201d \u201cdetermining,\u201d \u201cmanipulating,\u201d \u201ctransforming,\u201d or the like, refer to the action and processes of a computer, data processing system, logic circuit or similar processing device (e.g., an electrical, optical, or quantum computing or processing device), that manipulates and transforms data represented as physical (e.g., electronic) quantities. The terms refer to actions, operations and\/or processes of the processing devices that manipulate or transform physical quantities within the component(s) of a system or architecture (e.g., registers, memories, other such information storage, transmission or display devices, etc.) into other data similarly represented as physical quantities within other components of the same or a different system or architecture.","Furthermore, for the sake of convenience and simplicity, the terms \u201csignal(s)\u201d and \u201cwaveform(s)\u201d may be used interchangeably, however, these terms are also given their art recognized meanings. Also, for convenience and simplicity, the terms \u201cclock,\u201d \u201ctime,\u201d \u201crate,\u201d \u201cperiod\u201d and \u201cfrequency\u201d may be used interchangeably, as well as the terms \u201cdata,\u201d \u201cdata stream,\u201d and \u201cinformation,\u201d and in general, use of one such form generally includes the others, unless the context of the use unambiguously indicates otherwise. The terms \u201cnode(s),\u201d \u201cinput(s),\u201d \u201coutput(s),\u201d and \u201cport(s)\u201d may be used interchangeably, as well as the terms \u201cconnected to,\u201d \u201ccoupled with,\u201d \u201ccoupled to,\u201d and \u201cin communication with\u201d (which terms also refer to direct and\/or indirect relationships between the connected, coupled and\/or communicating elements, unless the context of the term's use unambiguously indicates otherwise). However, these terms are also generally given their art-recognized meanings.","The disclosure, in its various aspects, will be explained in greater detail below with regard to embodiments.","Particular embodiments allow for automatic determination of a reference clock frequency such that an associated phase-locked loop (PLL) can be initialized and\/or locked onto the reference clock. For example, a separate \u201csleep\u201d clock with a known frequency and frequency accuracy or tolerance can be used to estimate the reference clock frequency. Various embodiments can utilize one of two different approaches depending on whether the sleep clock is internally generated within a chip or device, or externally supplied thereto, for frequency selection based on the frequency estimate. Generally, an externally supplied sleep clock has frequency within a certain accuracy, resulting in a relatively simple reference clock frequency selection, while an internally supplied sleep clock is generally less accurate, and determination of a frequency thereof can benefit from a more complex and\/or rigorous solution. In any event, particular embodiments allow for determining the reference clock frequency using either type of sleep clock.",{"@attributes":{"id":"p-0027","num":"0026"},"figref":["FIG. 1","FIG. 1"],"b":["100","102","104","102","110","102","102","104","104","0","104","1","104","106","102","108","1","106","104","104","102"]},"Clock Generator Including Reference Clock Frequency Determining Circuit",{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 2","b":["110","110","202","212","202","102","202","212","202","202","202","202"]},"In particular embodiments, a sleep clock (e.g., a continuous background and\/or low power mode clock) can be used to estimate a frequency of the reference clock. Any other clock with a known frequency within a given accuracy, frequency margin, or variable frequency range, could also be used in certain embodiments. The estimate can be used in the selection of a reference clock frequency for supply at signal  to PLL . Clock calibrator  can receive the reference clock and the sleep clock, and may use the sleep clock to estimate the reference clock frequency. For example, clock calibrator  can count a number of reference clock cycles for a given sleep clock period, or other suitable portion of the sleep clock, and use that clock count to provide an estimated reference clock frequency at signal . This can be done because the sleep clock has a known frequency and a known or predetermined accuracy. For example, the known sleep clock frequency can be provided from an external source or from information stored in a memory  (e.g., a ROM or a register).","Referring back to , frequency selector  can receive estimated frequency  and select from among predetermined frequencies stored in memory  a closest frequency to send to PLL  via signal . For example, these predetermined (or allowed) frequencies can include, for example, frequencies of about 12 MHz, about 13 MHz, about 19.2 MHz, about 20 MHz, about 24 MHz, about 26 MHz, about 38.4 MHz, about 40 MHz, about 44 MHz, and about 52 MHz. IC  may support such various frequencies for different customers and\/or applications. For an externally supplied sleep clock, no particular grouping of the allowed frequencies need be considered for selection of the closest frequency. Rather, one or more comparators can be used to select a closest frequency to the estimated reference clock frequency from among the allowed frequencies.","Frequency selector  can include memory  (e.g., a read-only memory [ROM]), whereby firmware or other information stored on the ROM may be configured to assist with or implement frequency determination in particular embodiments. In one alternative approach, a driver for an application programming interface (API) can be included in the ROM to allow a user to provide explicit reference clock frequency information via a host interface. In addition, firmware (e.g., hardware and\/or software) or other information from a host chip can be downloaded to support multiple build and\/or customer versions for various reference clock frequencies. In another alternative approach, an electrically erasable ROM (EEPROM), located on or off-chip, can be utilized to store a reference clock frequency, which can then be accessed and transferred into the on-chip ROM.","The sleep clock as shown in  can be externally provided to IC  and\/or generated internally within IC . Particular embodiments may use the internally supplied sleep clock as a default when no externally supplied sleep clock is detected. An externally supplied sleep clock generally provides improved frequency accuracy relative to an internally supplied sleep clock, but particular embodiments can also accommodate internally supplied sleep clock variations. For example, external sleep clocks are typically available for cell phone systems. However, printer and camera systems may not have a readily accessible external sleep clock, so an internally supplied sleep clock can be made available for these systems.","In this fashion, embodiments of the invention can automatically determine a reference clock frequency using a sleep clock. This can be done regardless of whether the sleep clock is internally or externally supplied to an SOC. This approach may result in lower costs, smaller board size, and increased PLL initialization reliability, as compared to conventional approaches, such as those that use four or more strap pins.",{"@attributes":{"id":"p-0035","num":"0034"},"figref":["FIG. 3","FIG. 3"],"b":["302","304","304","302"],"sup":["th ","th ","th"]},"Clock Calibrators for Reference Clock Frequency Determination",{"@attributes":{"id":"p-0037","num":"0036"},"figref":["FIG. 4A","FIG. 2"],"b":["204","402","302","304","402","302","304","406","402","304","402","302","304","404","406","208","406","304","404","416","102","208","208","206","214"]},{"@attributes":{"id":"p-0038","num":"0037"},"figref":"FIG. 4B","b":["204","104","0","104","1","104","0","104","1","408","410"]},{"@attributes":{"id":"p-0039","num":"0038"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0"},"tgroup":{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"3"},"colspec":[{"@attributes":{"colname":"1","colwidth":"42pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"63pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"112pt","align":"center"}}],"thead":{"row":[{"entry":"TABLE 1"},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}},{"entry":["Group","Frequencies (MHz)","Frequency Estimate Tolerance"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["0","12, 24, 44","Up to 45%"]},{"entry":["1","13, 26, 52","Up to 50%"]},{"entry":["2","19.2, 38.4","Up to 50%"]},{"entry":["3","20, 40","Up to 50%"]},{"entry":{"@attributes":{"namest":"1","nameend":"3","align":"center","rowsep":"1"}}}]}}}}},"Similar to the circuit of , the clock counter  of  can count a number of reference clock cycles for a given sleep clock portion, to provide reference clock cycle count . In the example of , frequency estimator \u2032 can receive reference clock cycle count  and group selection signal , and provide estimated frequency  (which, e.g., can be provided to frequency selector  in ). Referring back to , in one embodiment, the estimated frequency  is a ratio of the reference clock frequency to the sleep clock frequency. Using the approach described in paragraph [0031] above, the ratio of the reference clock frequency to the sleep clock frequency is sufficiently accurate to select to closest allowed frequency from the group selected by frequency group selection signal . In another embodiment, the sleep clock frequency is stored in memory  and provided to frequency estimator \u2032 to provide estimated frequency . Alternatively, group selection signal  can be provided directly to frequency selector  () in order to narrow a search or reduce the possible number of the stored (allowed) predetermined frequencies for reference clock frequency selection. As discussed above, frequency selector  can include memory  for storage of predetermined or allowable reference clock frequencies. Frequency selector  can select from memory , a closest (e.g., using comparator circuitry) of the allowed frequencies to the estimated reference clock frequency .","The frequency groupings shown in Table 1 are arranged such that the frequencies within a group have a spread to accommodate the relatively large frequency accuracy variation found in the internally provided sleep clock. Thus as shown, the frequencies in each group (e.g., 12 MHz, 24 MHz, and 44 MHz in group 0) allow for an accurate selection of the reference clock frequency. For example, frequency estimator \u2032 may arrive at an estimate of 15 MHz for the reference clock using reference clock cycle count . Frequency selector  can receive group selection signal  (either directly or via frequency estimator \u2032) from strap pin decoder information  indicating that group 0 is to be selected. From this information, the reference clock frequency of 12 MHz can be selected as the closest allowed frequency to the estimated 15 MHz in group 0, and provided via signal  to PLL . For example, the closest allowed frequency determination can be made using comparator circuitry (see, e.g., ), and the selection can be performed using appropriate combinatorial logic coupled to memory .","In this fashion, an automatic reference clock frequency estimation can be made by using minimal encoder inputs, while still accommodating an internally provided sleep clock having a relatively large frequency accuracy variation (e.g., about +\/\u221215%). When an externally supplied sleep clock is available, the frequency estimate can be used directly to select a closest allowed reference clock frequency from among the predetermined\/allowable frequencies stored in memory, and without the use of any encoder inputs, such as external strap pins.",{"@attributes":{"id":"p-0043","num":"0042"},"figref":"FIG. 5","b":["206","502","502","0","502","1","502","2","502","3","214","504","0","504","1","504","2","504","3","504","208","502","208","504","0","504","1","504","2","504","3","514","0","514","1","514","2","514","3","208","502","0","502","1","502","2","502","3","208","502","0","502","1","502","2","502","3","514","0","514","1","514","2","514","3"]},"The outputs -, -, -, and - from each comparator  can be fed into a second level comparator  (e.g., corresponding comparators -, -, -, and -), for comparison against a predetermined threshold. The predetermined threshold is a digital or analog signal having a value corresponding to the known accuracy or variability of the sleep clock frequency. When the allowed frequencies in a given group generally have differences in values that exceed the known accuracy or variability of the sleep clock frequency, only one of the outputs -, -, - and - has a value less than that of the predetermined threshold.","Those skilled in the art will appreciate that a plurality of such threshold comparator stages (e.g., with successively smaller thresholds), comparators  with multiple successive thresholds, and\/or other logic or circuitry, can be employed to determine a closest allowed frequency  to the estimated frequency . In this particular example, outputs -, -, - and - from comparators  can be supplied to logic  to determine a closest allowed frequency . Generally, the allowed frequency -, -, -, or - corresponding to the output -, -, - or - having the lowest value is the closest allowed frequency. This closest allowed frequency can be indicated to multiplexer  via selection signal  such that the closest allowed frequency  can be output at signal  (e.g., for input to PLL , as shown in ). Thus, logic  can be configured to provide an allowed frequency selection signal  in response to a comparator output  having a lowest value or otherwise indicating the allowed frequency  closest to the estimated frequency .","Methods of Determining a Reference Clock Frequency",{"@attributes":{"id":"p-0047","num":"0046"},"figref":["FIG. 6A","FIG. 2","FIG. 6B"],"b":["600","602","604","214","606","606","608","610","612","614","616"]},"As discussed above, an externally supplied sleep clock has better frequency accuracy relative to an internal sleep clock, and thus may be a first choice from that standpoint. However, some applications may not provide a sleep clock in this manner, so a default internally generated sleep clock can also be accommodated in particular embodiments.",{"@attributes":{"id":"p-0049","num":"0048"},"figref":["FIG. 6B","FIG. 4B"],"b":["600","652","654","656","658","408","660","662","664"]},"In some cases, an EEPROM or other non-volatile or reprogrammable memory may be used to simply store a programmed frequency of the reference clock. If this is the case, part of the sequence (e.g., one or more of the flow blocks) shown in  can be bypassed, and the reference clock frequency value can simply be passed to the PLL by associated chip logic.","Firmware and\/or ROM code can be employed to store instructions and\/or otherwise control the timing as to when the PLL receives the target reference clock frequency and is able to begin the locking procedure. For example, the ROM code can set a PLL calibration start register bit (e.g., set to an active state) while waiting for a PLL calibration busy register bit to be activated (e.g., set to \u20180\u2019). A PLL calibration lock register bit can be checked until an active state (e.g., a value of \u20181\u2019) is detected, thus indicating the PLL is properly locked to the reference clock. When the PLL has locked to the reference clock and is generating proper PLL clock outputs to IC, the firmware and\/or ROM code can switch the IC clock to use the PLL clock. This can be accomplished by the activating a clock enable signal to select an output from the PLL.","A fault or error case may occur in some situations where the PLL calibration busy register bit does not change from an active state (e.g., it may be stuck in a high logic state or level), causing the ROM code to wait indefinitely. This can also occur when the PLL calibration busy register bit is set to an active state (e.g., it goes into a low logic state or level), but the PLL calibration lock register bit remains inactive (e.g., it is stuck low). Such error cases can be corrected by interrupting the ROM code using a debugger while the reference clock is being used as a default chip clock. Once the PLL has properly locked to the reference clock (e.g., as indicated by the PLL calibration lock bit going into an active state), the ROM code switches the chip clock to the PLL clock.","Exemplary Software","The present disclosure also includes algorithms, computer program(s) and\/or software, implementable and\/or executable in a general purpose computer or workstation equipped with a conventional digital signal processor, configured to perform one or more steps of the method and\/or one or more operations of the hardware. Thus, a further aspect of the disclosure relates to algorithms and\/or software that implement the above method(s). For example, the disclosure may further relate to a computer program, computer-readable medium or waveform containing a set of instructions which, when executed by an appropriate processing device (e.g., a signal processing device, such as a microcontroller, microprocessor or DSP device), is configured to perform the above-described method and\/or algorithm.","For example, the computer program may be on any kind of readable medium, and the computer-readable medium may comprise any medium that can be read by a processing device configured to read the medium and execute code stored thereon or therein, such as a floppy disk, CD-ROM, magnetic tape or hard disk drive. Such code may comprise object code, source code and\/or binary code.","The waveform is generally configured for transmission through an appropriate medium, such as copper wire, a conventional twisted pair wireline, a conventional network cable, a conventional optical data transmission cable, or even air or a vacuum (e.g., outer space) for wireless signal transmissions. The waveform and\/or code for implementing the present method(s) are generally digital, and are generally configured for processing by a conventional digital data processor (e.g., a microprocessor, microcontroller, or logic circuit such as a programmable gate array, programmable logic circuit\/device or application-specific [integrated] circuit).","Thus, embodiments of the present disclosure provide circuits, architectures, systems, methods, algorithms and software for determining a reference clock frequency and\/or locking a loop oscillator, such as a phase-locked loop (PLL). For example, the circuit and method enable accurate and\/or reliable determination of a reference clock frequency from either an internal or external sleep clock signal, using relatively simple logic. The architecture and system generally include one or more aspects of the circuit(s), and the algorithms and software generally include one or more aspects of the method(s).","The foregoing descriptions of specific embodiments of the present disclosure have been presented for purposes of illustration and description. They are not intended to be exhaustive or to limit the disclosure to the precise forms disclosed, and obviously many modifications and variations are possible in light of the above teaching. The embodiments were chosen and described in order to best explain the principles of the disclosure and its practical application, to thereby enable others skilled in the art to best utilize the disclosure and various embodiments with various modifications as are suited to the particular use contemplated. It is intended that the scope of the invention be defined by the Claims appended hereto and their equivalents."],"BRFSUM":[{},{}],"heading":["FIELD OF THE INVENTION","DISCUSSION OF THE BACKGROUND","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION","CONCLUSION\/SUMMARY"],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 4A"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 4B"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 6A"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 6B"}]},"DETDESC":[{},{}]}
