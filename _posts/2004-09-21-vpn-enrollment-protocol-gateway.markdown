---
title: VPN enrollment protocol gateway
abstract: A virtual private network (VPN) enrollment protocol gateway is described herein. The protocol gateway is implemented as a registration authority that operates as an intermediary between routers and a certificate authority, allowing routers operating in accordance with one protocol to obtain and maintain certificates for a VPN from a certificate authority operating in accordance with another protocol. In accordance with one aspect, the gateway protocol supports various requests from the router, including router enrollment requests, get certificate revocation list request, get certificate requests, get certificate authority certificate requests, and password requests.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07069441&OS=07069441&RS=07069441
owner: Microsoft Corporation
number: 07069441
owner_city: Redmond
owner_country: US
publication_date: 20040921
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"heading":["RELATED APPLICATIONS","TECHNICAL FIELD","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION","CONCLUSION"],"p":["This is a continuation of application Ser. No. 09\/548,257, filed Apr. 12, 2000, now U.S. Pat. No. 6,978,364, entitled \u201cVPN Enrollment Protocol Gateway\u201d, which is hereby incorporated by reference herein.","This invention relates to secure communications, and more particularly to a protocol gateway allowing routers operating in accordance with one protocol to obtain and maintain certificates for a virtual private network (VPN) from a certificate authority operating in accordance with another protocol.","Computer technology is continually advancing, resulting in continually evolving uses for computers. One such use is communicating with other computers over a network, such as the Internet, to obtain or exchange information, purchase or sell goods or services, etc. One particular type of communication that can be established is referred to as a \u201cvirtual private network\u201d or \u201cVPN\u201d. In a VPN, portions of a network (such as the Internet) are used to establish secure communications from one computer to another via multiple different routers in the network. The VPN allows users to use the larger network (e.g., the Internet) to connect to another computer as if they were part of a dedicated secure network.","In order to operate as part of a VPN, a router enrolls for a VPN certificate via a certificate authority (CA). This VPN certificate is then provided to other routers that are part of the VPN and is used to authenticate the router and may also be used to securely communicate with the other routers. However, different protocols for enrolling for VPN certificates have arisen, many of which are incompatible with one another. For example, many routers available from Cisco Systems, Inc. of San Jose, Calif. use a proprietary protocol called Simple Certificate Enrollment Protocol (SCEP) for obtaining VPN certificates, while many certificate authorities available from Microsoft Corporation of Redmond, Wash. use an incompatible enrollment protocol based on Public-Key Cryptography Standard (PKCS) #10 and PKCS #7. Thus, a router using SCEP would not be able to enroll for a VPN certificate from a CA using PKCS #10 and PKCS #7.","Additionally, many routers and CAs are already manufactured and in use that operate based on such incompatible protocols. Therefore, re-designing such routers or CAs to be compatible with one another would require the replacement of many such pre-existing devices. Thus, it would be beneficial to provide a solution that allows routers and CAs (including pre-existing routers and CAs) operating based on incompatible protocols to communicate with one another for VPN certificate enrollment.","The VPN enrollment protocol gateway described below addresses these and other disadvantages.","A virtual private network (VPN) enrollment protocol gateway is described herein. The protocol gateway allows routers operating in accordance with one protocol to obtain and maintain certificates for a VPN from a certificate authority operating in accordance with another protocol.","According to one aspect, the VPN enrollment protocol gateway is implemented as a registration authority that operates as an intermediary between the router and the certificate authority. As a registration authority, the gateway is trusted by the certificate authority. The router communicates with the registration authority as if it were the certificate authority, not realizing that it is communicating with an intermediary.","According to another aspect, the protocol gateway receives a router enrollment request from the router. The protocol gateway decrypts the request, adds an alterative subject name to the request, digitally signs the request, and forwards the signed request to the certificate authority. The certificate authority determines whether to trust the source of the request (the protocol gateway), and proceeds to respond with the requested certificate if it verifies that the gateway can be trusted. The gateway receives the requested certificate, encrypts and digitally signs a response including the certificate, and returns the signed and encrypted response to the router.","According to another aspect, the certificate authority may not be able to immediately issue a certificate, in which case it issues a pending response. The registration authority maintains a mapping of a router transaction ID (identifier) received from the router and a pending response ID received from the certificate authority. This mapping allows subsequent requests from the router with the same transaction ID (e.g., querying whether the certificate has been issued yet) to be properly matched to a request previously submitted to the certificate authority for which a pending response was issued. The registration authority also maintains a mapping of a hash value of the request received from the router to the pending response for that request. This mapping allows the registration authority to determine when a request is resubmitted by the router (e.g., in the event the router never receives a pending response returned to it by the registration authority).","According to another aspect, the protocol gateway receives a get certificate revocation list from the router. The protocol gateway decrypts the request and extracts from the request the certificate serial number of the signing certificate of the request. The protocol gateway then submits a Get Certificate by Serial Number request to the certificate authority, which returns to the protocol gateway the certificate corresponding to the serial number. The protocol gateway extracts a certificate revocation list distribution point from the response, and obtains the certificate revocation list from the distribution point. The protocol gateway then generates a response including the certificate revocation list, encrypts and signs the response, and returns the response to the router.","According to another aspect, the protocol gateway receives a get certificate request from the router. The protocol gateway decrypts the request and extracts from the request the certificate serial number of the signing certificate of the request. The protocol gateway then submits a Get Certificate by Serial Number request to the certificate authority, which returns to the protocol gateway the certificate corresponding to the serial number. The protocol gateway then encrypts and signs a response including the certificate, and returns the response to the router.","According to another aspect, the protocol gateway receives a get certificate authority certificate request from the router. The protocol gateway generates a response message including the signing certificate of the registration authority as well as the encryption certificate of the registration authority, and returns the response message to the router.","According to another aspect, the protocol gateway maintains a record of passwords handed out to a router. A router obtains a password by communicating with the protocol gateway (or another device trusted by the protocol gateway) via an authenticatable mechanism (e.g., SSL (Secure Sockets Layer)). A password is returned to the router, which can then use this password for a request submitted to the protocol gateway. If the password presented by the router is in the router's record, then the request is processed; otherwise, the request is rejected.","The discussion herein assumes that the reader is familiar with cryptography. For a basic introduction of cryptography, the reader is directed to a text written by Bruce Schneier and entitled \u201cApplied Cryptography: Protocols, Algorithms, and Source Code in C,\u201d published by John Wiley & Sons with copyright 1994 (or second edition with copyright 1996).","In the discussion below, embodiments of the invention will be described in the general context of computer-executable instructions, such as program modules, being executed by one or more conventional personal computers. Generally, program modules include routines, programs, objects, components, data structures, etc. that perform particular tasks or implement particular abstract data types. Moreover, those skilled in the art will appreciate that various embodiments of the invention may be practiced with other computer system configurations, including hand-held devices, multiprocessor systems, microprocessor-based or programmable consumer electronics, network PCs, minicomputers, mainframe computers, and the like. In a distributed computer environment, program modules may be located in both local and remote memory storage devices.","Alternatively, embodiments of the invention can be implemented in hardware or a combination of hardware, software, and\/or firmware. For example, all or part of the invention can be implemented in one or more application specific integrated circuits (ASICs).",{"@attributes":{"id":"p-0032","num":"0031"},"figref":"FIG. 1","b":["102","104","106","104","106","106","108"]},"VPN  includes one or more routers , , and  through which data is passed between client  and server . Routers \u2013 are part of a public network, such as the Internet. Routers that are part of other types of networks may also be included in VPN , such as routers from a LAN or a private wide-area network.","Additionally, other networks may be involved in the communication between client  and server . By way of example, client  may connect to the public network supporting VPN  via a conventional modem and a Public Switched Telephone Network (PSTN), via a conventional cable modem and cable lines, etc.","Routers \u2013 can communicate with one another, as well as registration authority , via any of a wide variety of conventional communications protocols. In one implementation, routers \u2013 communicate with one another and registration authority  using the Hypertext Transfer Protocol (HTTP).","Each of the routers \u2013 receives data from one of the other routers \u2013 or alternatively from another component (e.g., a public network access provider, such as an Internet Service Provider (ISP); client computer ; etc.). The data is then securely passed on to another of the routers \u2013 or other components.","In order for data to be transmitted among routers \u2013, a certificate-based authentication scheme is employed. In such an authentication scheme, each router \u2013 is assigned a unique certificate that it can use to authenticate itself to other routers or other computing devices (e.g., an ISP, a bridge or gateway, etc.). Additionally, these other computing devices may be part of VPN  and may similarly be assigned unique certificates that can be used for authentication. Such certificates can also optionally be used to encrypt messages between routers and\/or other computing devices in any of a variety of conventional manners. For ease of explanation, routers are described as the devices that are obtaining and maintaining certificates for VPN . The establishment and operation of a VPN is well-known to those skilled in the art, and thus will not be discussed further except as it pertains to the invention.","The certificates used by routers \u2013 are assigned by a trusted certificate authority (CA) . The process of obtaining such a certificate is referred to as \u201cenrollment\u201d. In the illustrated example, routers \u2013 use a different enrollment protocol than is used by certificate authority . A registration authority  communicates with both routers \u2013 and certificate authority  and acts as an intermediary for enrollment, translating requests and responses in one protocol to another, as discussed in more detail below.",{"@attributes":{"id":"p-0039","num":"0038"},"figref":["FIG. 2","FIG. 1"],"b":["142","142","102","104","116","118","142","144","146","148","146","144"]},"The bus  represents one or more of any of several types of bus structures, including a memory bus or memory controller, a peripheral bus, an accelerated graphics port, and a processor or local bus using any of a variety of bus architectures. The system memory includes read only memory (ROM)  and random access memory (RAM) . A basic input\/output system (BIOS) , containing the basic routines that help to transfer information between elements within computer , such as during start-up, is stored in ROM . Computer  further includes a hard disk drive  for reading from and writing to a hard disk, not shown, connected to bus  via a hard disk driver interface  (e.g., a SCSI, ATA, or other type of interface); a magnetic disk drive  for reading from and writing to a removable magnetic disk , connected to bus  via a magnetic disk drive interface ; and an optical disk drive  for reading from or writing to a removable optical disk  such as a CD ROM, DVD, or other optical media, connected to bus  via an optical drive interface . The drives and their associated computer-readable media provide nonvolatile storage of computer readable instructions, data structures, program modules and other data for computer . Although the exemplary environment described herein employs a hard disk, a removable magnetic disk  and a removable optical disk , it should be appreciated by those skilled in the art that other types of computer readable media which can store data that is accessible by a computer, such as magnetic cassettes, flash memory cards, digital video disks, random access memories (RAMs) read only memories (ROM), and the like, may also be used in the exemplary operating environment.","A number of program modules may be stored on the hard disk, magnetic disk , optical disk , ROM , or RAM , including an operating system , one or more application programs , other program modules , and program data . Operating system  can be any of a variety of operating systems, such as any of the \u201cWindows\u201d family of operating systems available from Microsoft Corporation of Redmond, Wash. A user may enter commands and information into computer  through input devices such as keyboard  and pointing device . Other input devices (not shown) may include a microphone, joystick, game pad, satellite dish, scanner, or the like. These and other input devices are connected to the processing unit  through an interface  (e.g., a serial port interface) that is coupled to the system bus. A monitor  or other type of display device is also connected to the system bus  via an interface, such as a video adapter . In addition to the monitor, personal computers typically include other peripheral output devices (not shown) such as speakers and printers.","Computer  can operate in a networked environment using logical connections to one or more remote computers, such as a remote computer . The remote computer  may be another personal computer, a server, a router, a network PC, a peer device or other common network node, and typically includes many or all of the elements described above relative to computer , although only a memory storage device  has been illustrated in . The logical connections depicted in  include a local area network (LAN)  and a wide area network (WAN) . Such networking environments are commonplace in offices, enterprise-wide computer networks, intranets, and the Internet. In the described embodiment of the invention, remote computer  executes an Internet Web browser program such as the \u201cInternet Explorer\u201d Web browser manufactured and distributed by Microsoft Corporation of Redmond, Wash.","When used in a LAN networking environment, computer  is connected to the local network  through a network interface or adapter . When used in a WAN networking environment, computer  typically includes a modem  or other means for establishing communications over the wide area network , such as the Internet. The modem , which may be internal or external, is connected to the system bus  via a serial port interface . In a networked environment, program modules depicted relative to the personal computer , or portions thereof, may be stored in the remote memory storage device. It will be appreciated that the network connections shown are exemplary and other means of establishing a communications link between the computers may be used.","Generally, the data processors of computer  are programmed by means of instructions stored at different times in the various computer-readable storage media of the computer. Programs and operating systems are typically distributed, for example, on floppy disks or CD-ROMs. From there, they are installed or loaded into the secondary memory of a computer. At execution, they are loaded at least partially into the computer's primary electronic memory. The invention described herein includes these and other various types of computer-readable storage media when such media contain instructions or programs for implementing the steps described below in conjunction with a microprocessor or other data processor. The invention also includes the computer itself when programmed according to the methods and techniques described below. Furthermore, certain sub-components of the computer may be programmed to perform the functions and steps described herein. The invention includes such sub-components when they are programmed as described. In addition, the invention described herein includes data structures, described herein, as embodied on various types of memory media.","For purposes of illustration, programs and other executable program components such as the operating system are illustrated herein as discrete blocks, although it is recognized that such programs and components reside at various times in different storage components of the computer, and are executed by the data processor(s) of the computer.",{"@attributes":{"id":"p-0046","num":"0045"},"figref":["FIG. 3","FIG. 1"],"b":["118","210","116","210","110","114","210","118","116","210","118","116"]},"Communication between registration authority  and each of router  and certificate authority  can be carried out using any of a wide variety of conventional encryption and\/or digital signing techniques. By way of example, using well-known public key cryptography techniques, a device obtains a private key\/public key pair; the public key is made available to other devices while the private key is kept secret by the device. Another device can encrypt a message intended for this device by using a conventional encryption algorithm and this device's public key. The private key\/public key pair and the encryption algorithm are chosen such that it is relatively easy to decrypt the message with the private key, but extremely difficult to decrypt the message without the private key. Similarly, a message can be digitally signed by the device using a conventional encryption algorithm and its private key. The digitally signed message can be decrypted by another device using the public key, allowing the other device to verify that the message came from that device. Alternatively, rather than applying an encryption algorithm to the message itself, the encryption algorithm may be applied to a hash value generated based on the message and a known hash function. Different public key\/private key pairs can be used for encryption and digital signatures, or alternatively the same public key\/private key pair can be used for both encryption and digital signatures.","Registration authority  operates as an enrollment agent for certificate authority , allowing routers such as router  to enroll for a VPN certificate from certificate authority  via registration authority . Registration authority  obtains, from certificate authority , an enrollment agency signature certificate (e.g., by enrolling for an \u201cOffline IPSec\u201d enrollment agent signature certificate) and an encryption certificate (e.g., by enrolling for an \u201cIPSec Encryption\u201d certificate). In the illustrated examples, these certificates are used by registration authority  to digitally sign data sent to both the router  and the certificate authority , and to encrypt data sent to the router .","Router  communicates requests  to registration authority  in accordance with the protocol supported by router . In the illustrated example, router  supports the protocol SCEP. Different types of requests  can be transmitted to registration authority . In one implementation, registration authority  operates as a protocol gateway for the following types of requests: router enrollment, get certificate revocation list (CRL), get certificate, get certificate authority (CA) certificate, and password registration. The specific manner in which each of these requests is handled by registration authority  is discussed in more detail below.","Upon receipt of an SCEP request , registration authority  converts the request into an appropriate format for certificate authority . The converted request is then digitally signed by registration authority  and the signed request  is transmitted to certificate authority . Certificate authority , receiving a request in its own protocol (using PKCS #7 and PKCS #10), responds to the request and issues a CA response . Registration authority  receives the response , converts the response to the appropriate SCEP format for router , and transmits an SCEP response  to router . Alternatively, for some requests registration authority  may generate the response  without forwarding a signed request  to certificate authority .","Registration authority  includes a protocol converter . Protocol converter  receives messages from router  and converts them as necessary to the proper protocol for certificate authority , and similarly receives messages from certificate authority  and converts them to the proper protocol for router . The manner in which protocol converter  operates is dependent on the particular protocols being used by router  and certificate authority .","In one implementation, registration authority  operates in accordance with the Internet X.509 Public Key Infrastructure Certificate and CRL Profile (Network Working Group Request for Comments 2459, Jan. 1999). Alternatively, other implementations may operate in accordance with other standards.","Registration authority  also includes a transaction ID table , a request hash table , and a password table . Tables \u2013 are used by registration authority  to maintain information regarding requests  and responses  in order to conform with the protocols of router  and certificate authority .",{"@attributes":{"id":"p-0054","num":"0053"},"figref":"FIG. 4","b":["222","228","230","228","118","210","116","118","230","222","118","116","210"]},"Each entry in transaction ID table  is removed from table  after a period of time. In one implementation, each entry in table  is kept in table  for one week and then removed. This period of time can optionally be configurable by a user or administrator.",{"@attributes":{"id":"p-0056","num":"0055"},"figref":"FIG. 5","b":["224","232","234","224"]},"Request hash table  allows registration authority  to \u201cremember\u201d router requests. For example, a pending response may be issued by registration authority  to router , as discussed in more detail below. If a failure or problem occurs during the transmission (e.g., a network failure), then the pending response may not be received by router . If router  never receives the response, router  will re-issue the same request. By maintaining table , registration authority  can determine when a received request is a re-issued request, and need not submit another request for another new certificate to certificate authority .","Each entry in request hash table  is removed from table  after a period of time. In one implementation, each entry in table  is kept in table  for twenty minutes and then removed. This period of time can optionally be configurable by a user or administrator.",{"@attributes":{"id":"p-0059","num":"0058"},"figref":"FIG. 6","b":["226","236","210","210","210"]},"Each password in password table  is removed from table  after a period of time. In one implementation, each password in table  is kept in table  for sixty minutes and then removed. This period of time can optionally be configurable by an administrator.","Returning to , in the illustrated example registration authority  is a dynamically linked library (DLL) referred to as the \u201cMSCEP\u201d DLL. Alternatively, registration authority  may include a DLL referred to as the \u201cMSCEP\u201d DLL. Registration authority  includes a response module  that generates responses for certain requests from router  that do not require forwarding to certificate authority . The operation of response module  is discussed in more detail below.","Registration authority  further hosts a web site . Alternatively, registration authority  may have a secure communication link to a server hosting web site , thereby allowing data to be securely passed between the server and registration authority , or registration authority  may be software and\/or firmware being executed by a server that also hosts web site . Web site  allows passwords to be securely issued to router  and stored in password table , as discussed in more detail below.","Router Enrollment Request",{"@attributes":{"id":"p-0063","num":"0062"},"figref":["FIGS. 7","FIGS. 7","FIG. 3","FIGS. 7","FIGS. 7","FIG. 3"],"i":["a ","b ","a ","b ","a ","b ","a ","b "],"b":["7","7","118","116","7","7"]},"To participate in a VPN, router  enrolls for a certificate from certificate authority . Router  enrolls for a certificate by sending, as SCEP request , a router enrollment message (e.g., a SCEP PKCSReq message) to registration authority . The router enrollment message includes a certificate enrollment request in accordance with the Public-Key Cryptography Standards (PKCS) #10 standard. The certificate enrollment request is further encrypted (e.g., using the public key of registration authority ) and then digitally signed by router  in accordance with the Public-Key Cryptography Standards (PKCS) #7 standard. Additional information regarding PKCS #7 and PKCS #10 is available from RSA Data Security, Inc. of Bedford, Mass. It should be noted that, although requests from router  use PKCS #7 and PKCS #10, certain information needed by certificate authority  is not included in the requests. Registration authority  resolves this problem, adding information when necessary.","Registration authority  receives, as the router enrollment message, this encrypted and digitally signed request (act ). Upon receipt of the enrollment message, registration authority  verifies the signature of the router enrollment message (act ). If the signature is not verified then the message is ignored (act ). Alternatively, an indication of failure could be returned to router .","If the signature is verified, then registration authority  decrypts the router enrollment message (e.g., using the private key of registration authority ) and extracts the certificate enrollment request from the message (act ). Registration authority  uses the certificate enrollment request to generate a request to the CA for an enrollment certificate in a format expected by certificate authority  (act ).","Router  needs a certificate with a subject alternative names extension (SubjectAltName). However, router  does not specifically request the SubjectAltName extension, and certificate authority  does not automatically add the extension. Registration authority  resolves this issue by adding, to the message it transmits to certificate authority , the SubjectAltName extension in the request.","The PKCS #7 message, including both the subject alternative names extension and the certificate enrollment request extracted from the router enrollment message, is digitally signed by registration authority  (act ). This signed message is then transmitted to certificate authority  as a CA request (act ). Note that the CA request thus includes a PKCS #7 message that is signed by registration authority , which in turn includes a certificate enrollment request that is signed by router .","Certificate authority  receives the CA request from registration authority  (act ) and determines, based on the content of the CA request, whether to issue the requested certificate (act ). The manner in which certificate authority  determines whether to issue the requested certificate can vary. In one implementation, certificate authority  determines whether to issue a certificate based on whether the certificate of the registration authority  can be validated up to a trusted valid root and whether the certificate of registration authority  includes an extended key usage indicating that registration authority  can be a registration authority (and thus operate as an enrollment agent). If both of these conditions are satisfied, then a certificate is issued. Otherwise, the certificate is not issued. Additionally, certificate authority  may require that the certificate of registration authority  have been issued directly by a certificate authority (that is, no intermediate certificates in the chain from the registration authority certificate to the certificate authority certificate).","If certificate authority  determines it will not issue a certificate, then certificate authority  generates a CA response indicating failure (act ). However, if certificate authority  determines it will issue a certificate, then certificate authority  generates the requested certificate (act ) and then generates a CA response including the generated certificate (act ).","The CA response generated by certificate authority  has no message content and is referred to as a \u201cdegenerated PKCS #7\u201d. The PKCS #7 message, however, allows multiple certificates to be included in a degenerated PKCS #7 message. Certificate authority  returns the newly generated certificate as part of the degenerated PKCS #7 message. Additionally, the entire certificate chain from the generated certificate up to a root certificate may optionally be included in the degenerated PKCS #7 message.","Certificate authority  then transmits the CA response (indicating either failure or with the generated certificate) to registration authority  (act ). Registration authority  receives the CA response (act ) and checks whether the CA response includes a certificate (act ). If no certificate is included, then registration authority  generates an SCEP response message indicating failure (act ). However, if such a certificate is included, then registration authority  extracts the certificate (act ) and generates an SCEP response including the certificate (act ). In the illustrated example, registration authority  extracts only the certificate generated by certificate authority ; the additional certificate chain (if included) is not used by registration authority . Alternatively, the entire certificate chain could be included if router  desired (or at least could handle) the chain.","Registration authority  then encrypts the SCEP response (act ) and digitally signs the encrypted response (act ). The encrypted and signed response is then transmitted to router  (act ), which in turn can verify the signature and decrypt the response to extract the certificate generated by certificate authority .","Pending Response Handling","In some situations, certificate authority  may not immediately issue a CA response with either a certificate or an indication that no certificate will be issued. For example, certificate authority  may wait for an administrator to approve the issuing of the certificate. In such situations, certificate authority  issues a CA pending response from certificate authority .",{"@attributes":{"id":"p-0075","num":"0074"},"figref":["FIG. 8","FIG. 8","FIG. 3","FIG. 8","FIGS. 3\u20137"],"b":"118","i":"b. "},"Registration authority  receives the CA pending response from certificate authority  (act ). Upon receipt of the CA pending response, registration authority  adds entries to its transaction ID table  (act ) and its request hash table  (act ). Registration authority  also generates an encrypted and digitally signed SCEP pending response message (act ) and transmits the encrypted and signed message to router  (act ).","Typically, in response to an SCEP pending response message, router  will re-issue its request for a certificate (e.g., via a GetCertInitial message). Registration authority  waits until it receives an additional SCEP request for the certificate from the router  (act ). Once the additional request is received, registration authority  accesses transaction ID table  to determine the appropriate CA request ID (act ). Registration authority  uses the CA request ID from table  to generate a CA request for a certificate corresponding to the CA request ID and digitally signs the CA request (act ). The signed CA request is then transmitted to certificate authority  (act ).","Upon receiving the CA request, certificate authority  may issue another pending response to registration authority  or alternatively determine whether to issue the certificate (per act  of discussed above). Upon receipt of a response from certificate authority , registration authority  determines whether the response is another pending response (act ). If the response is another pending response, the registration authority  returns to act  and generates and encrypted and signed SCEP pending response message. However, if the response is not another pending response, then registration authority  proceeds per acts \u2013 of to return an appropriate response to router .","Use of request hash table  further allows registration authority  to gracefully recover in the event the SCEP pending response message is not received by router . If router  does not receive the pending response message, then it will resubmit its original request (e.g., an SCEP PKCSReq message). In order to avoid a duplicate request to certificate authority for the certificate, registration authority  generates the hash value for SCEP PKCSReq messages it receives and compares the hash value to the entries in request hash table . If the hash value matches an entry, then registration authority  uses the CA request ID from table  to generate a CA request for a certificate corresponding to the CA request ID (act ), rather than generating a CA request including a certificate enrollment request (act  of ). Processing then continues as discussed above with reference to .","Get Certificate Revocation List Request","Returning to , router  may also send a Get Certificate Revocation List (CRL) request as SCEP request . The request identifies a serial number or similar identifier of a certificate for which the corresponding CRL should be retrieved. The CRL is a list identifying revoked certificates which is made available by the certificate authority (typically in a public repository). The CRL can be checked to determine whether a particular serial number (typically identified in the CRL by its serial number) has been revoked. Registration authority  responds to such a request by obtaining the requested CRL and returning it to router .",{"@attributes":{"id":"p-0081","num":"0080"},"figref":["FIG. 9","FIG. 9","FIG. 3","FIG. 9","FIG. 3"],"b":"118"},"Initially, registration authority  receives the Get CRL request (e.g., an SCEP GetCRL message) from router  (act ). Registration authority  decrypts the request (act ), verifies the signature of the decrypted request (act ), and proceeds based on whether the signature is verified (act ). If the signature cannot be successfully verified, then the message is dropped (act ); registration authority  simply ignores the message. Alternatively, registration authority  may return an indication to router  that the signature could not be verified.","However, if the signature is successfully verified, then registration authority  extracts the certificate serial number from the decrypted request (act ). This serial number can be extracted by obtaining the serial number of the certificate used by router  to sign the Get CRL request.","Registration authority  then uses the extracted serial number to generate a Get Certificate by Serial Number request (act ). The Get Certificate by Serial Number request is then digitally signed and transmitted to certificate authority  (act ), which in turn accesses its records to identify the certificate corresponding to the given serial number. This certificate is then returned by certificate authority  to registration authority  (act ).","The certificate returned by certificate authority  includes a CRL distribution point, which is an identifier of a location (e.g., a uniform resource locator (URL)) at which the CRL corresponding to the certificate can be obtained. Upon receipt of the certificate, registration authority  extracts the CRL distribution point from the certificate (act ). Registration authority  then accesses (e.g., via HTTP) the identified location and retrieves the CRL located there (act ).","Upon obtaining the CRL, registration authority  generates an SCEP response message including the CRL (act ). Registration authority  then encrypts and digitally signs the SCEP response message including the CRL, and returns the encrypted and signed SCEP response message to router  (act ).","Alternatively, the Get CRL request received from router  (act ) may include the certificate for which the corresponding CRL is to be obtained. In this situation, the CRL distribution point can be extracted by accessing the included certificate, thereby alleviating the need to access certificate authority  (acts \u2013).","Get Certificate Request","Returning to , router  may also send a Get Certificate request as SCEP request . The request identifies a serial number of a certificate that the router would like returned to it. Router  may make such a request, for example, in situations where it has kept the serial number of a certificate it needs but has not kept the actual certificate. Registration authority  responds to such a request by obtaining the requested certificate and returning it to router .",{"@attributes":{"id":"p-0089","num":"0088"},"figref":["FIG. 10","FIG. 10","FIG. 3","FIG. 10","FIG. 3"],"b":"118"},"Initially, registration authority  receives the Get Certificate request (e.g., an SCEP GetCert message) from router  (act ). Registration authority  decrypts the request (act ), verifies the signature of the decrypted request (act ), and proceeds based on whether the signature is verified (act ). If the signature cannot be successfully verified, then the message is dropped (act ); registration authority  simply ignores the message. Alternatively, registration authority  may return an indication to router  that the signature could not be verified.","However, if the signature is successfully verified, then registration authority  extracts the certificate serial number from the decrypted request (act ). This serial number can be extracted by obtaining the serial number specified in the request (e.g., as the certificate serial number of the signing certificate of the request).","Registration authority  then uses the extracted serial number to generate a Get Certificate by Serial Number request (act ). The Get Certificate by Serial Number request is then digitally signed and transmitted to certificate authority  (act ), which in turn accesses its records to identify the certificate corresponding to the given serial number. This certificate is then returned by certificate authority  to registration authority  (act ).","Registration authority  then generates an SCEP response message including the certificate received in act  (act ). Registration authority  then encrypts and digitally signs the SCEP response message including the certificate, and returns the encrypted and signed SCEP response message to router  (act ).","Get CA Request","Returning to , router  may also send a Get CA request as SCEP request . The request is an HTTP Get call to a URL hosted by registration authority . The URL is made available to router  during setup or configuration of router . Registration authority  responds to such a request by returning the requested certificates to router .",{"@attributes":{"id":"p-0095","num":"0094"},"figref":["FIG. 11","FIG. 11","FIG. 3","FIG. 11","FIG. 3"],"b":"118"},"Initially, a Get CA request is received by registration authority  from router  (act ). Upon receipt of the request, registration authority  obtains a DLL name identified by the request (act ). In one implementation, an exemplary Get CA request from router  is in the following form:\n\nGET mscep.dll\/cgi-bin\/pkiclient.exe?operation=GetCACert&message=<Base64 encoded authority issuer identifier>\n\nIn this implementation, registration authority  is implemented as an IIS (Internet Information Server) ISAPI (Internet Server Application Programming Interface) DLL. Upon receipt of such a request, IIS parses the input through to identify the first DLL and attempts to load that DLL if necessary. Thus, the remainder of the request can be ignored by registration authority  in determining how to respond to the request.\n","Registration authority  is the identified DLL, which in the illustrated example is \u201cmscep.dll\u201d, and passes the request to response module  (act ). In response to being passed the message (either in its entirety, or a part thereof), response module  generates a degenerated PKCS #7 message including the signing certificate and the encryption certificate of registration authority  (act ), and returns the degenerated PKCS #7 message to the router (act ). Thus, router  requests the certificates for the certificate authority, but receives the certificates for the registration authority instead.","Alternatively, registration authority  may include a certificate chain in the message it generates in act . By way of example, MSCEP DLL  may send a certificate request to certificate authority , which returns the certificate of certificate authority  and a certificate chain that extends up to its root certificate.","Password Handling","Returning to , router  may also make use of a password to authenticate itself to certificate authority  (actually registration authority , but router  is not aware of this). The password allows registration authority  (and thus certificate authority , which trusts registration authority ) to know that a particular request actually came from the router claiming to have sent it. The password may be used with one or more of the different types of SCEP requests  discussed above. By way of example, the password may be used with the router enrollment request.",{"@attributes":{"id":"p-0100","num":"0099"},"figref":["FIG. 12","FIG. 12","FIG. 3","FIG. 12","FIG. 3"],"b":"118"},"Initially, registration authority  receives a request for a password (act ). This request is received via a mechanism that allows registration authority  to authenticate the requester, such as by use of SSL (Secure Sockets Layer) to authenticate the requestor when accessing web site  of . The requestor could be a computer being operated by a router administrator, or alternatively router . Upon receipt of the request, registration authority  attempts to authenticate the requester, such as the router administrator, (act ) and proceeds based on whether the authentication is successful (act ). If the requestor cannot be authenticated, then the request for a password is denied (act ). The request may simply be ignored, or alternatively an indication may be returned to the requester that the request for a password is denied.","However, if the router is authenticated, then registration authority  proceeds to generate a password and add the newly generated password to password table  (act ). The password can be generated by registration authority  in any of a wide variety of conventional manners, such as by generating a random (or pseudo-random) number and\/or sequence of letters. The generated number may then be placed into a particular format if needed by either router  or certificate authority , such as hexadecimal format, binary coded decimal format, etc.","The password added to password table  is removed from table  after a period of time. In one implementation, each password in table  is kept in table  for sixty minutes and then removed. This period of time can optionally be configurable by an administrator.","Registration authority  then returns the newly generated password to requestor (act ). This return of the password is done in a secure manner, such as by use of SSL.","Eventually, registration authority  receives a request from router  that includes a password that needs to be verified (act ). Upon receipt of such a request, registration authority  determines whether the received password is in password table  (act ). If the received password is not in password table , then the request is rejected (act ). The request can simply be ignored, or alternatively a rejection response can be returned to router  (e.g., informing router  that the password it provided was not valid).","However, if the password is in password table , then the request is processed by registration authority  (act ). Registration authority  may also optionally remove the password from password table  (act ), thereby adding an additional level of security by allowing each password to be used only once.","Thus, a VPN enrollment protocol gateway has been described. The protocol gateway is implemented as a registration authority that is trusted by the certificate authority, and operates as an intermediary between the router and the certificate authority. The protocol gateway advantageously allows routers operating in accordance with one protocol to obtain and maintain certificates for a VPN from a certificate authority operating in accordance with another protocol.","Although the description above uses language that is specific to structural features and\/or methodological acts, it is to be understood that the invention defined in the appended claims is not limited to the specific features or acts described. Rather, the specific features and acts are disclosed as exemplary forms of implementing the invention."],"BRFSUM":[{},{}],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The present invention is illustrated by way of example and not limitation in the figures of the accompanying drawings. The same numbers are used throughout the figures to reference like components and\/or features.",{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIGS. 7","i":["a ","b "],"b":"7"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0027","num":"0026"},"figref":"FIG. 11"},{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 12"}]},"DETDESC":[{},{}]}
