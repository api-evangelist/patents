---
title: Read and write optimization for protected area of memory
abstract: A system (and method) to update content of a secure area of a secure digital (SD) card is disclosed. The system performs a first authenticated key exchange to access the secure area of the secure digital memory. The system reads content from the secure area in response to successful performance of the first authenticated key exchange. The system modifies the content in a memory of a computer system. The system performs a second authenticated key exchange to access the secure area of the secure digital card in preparation to write to the secure area of the secure digital memory. The system then writes modified content to the secure area of the secure digital memory in response to successful performance of the second authenticated key exchange.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08775827&OS=08775827&RS=08775827
owner: Media IP, LLC
number: 08775827
owner_city: Seattle
owner_country: US
publication_date: 20110328
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND","DETAILED DESCRIPTION"],"p":["1. Field of Art","The disclosure generally relates to the field of memory devices, and more particularly, optimization for protected areas of solid state memory devices.","2. Description of the Related Art","Today, Secure Digital (SD) cards are in wide use for many storage applications including audio (MP3 players), pictures (digital cameras), and full motion video (camcorders and HD camcorders). The SD card provides an acceptable portable storage medium to transfer unprotected content between different devices, especially for the video capture devices mentioned above. The content stored on SD cards can be transferred or archived to devices with larger storage capacities and additional processing capabilities. One such additional processing capability allows consumers to create and manage a digital archive of consumer generated content.","Consumers are familiar with the storage capabilities, but there are a very few applications which take advantage of the security (the S in Secure Digital) features of the SD card. Today's applications that use the security features enable digital rights management (DRM) to protect the content from copying or other forms of piracy and theft. Examples of DRM applications include still images and full-motion video (1-seg and GreenPlay by MOD Systems Incorporated). DRM protected content on the aforementioned SD cards cannot be archived easily. The DRM protection must remain intact during generation, transfer, and archival, often tied directly to the physical SD media on which it was originally stored.","The DRM specification and processing require access to both the secure and user areas of an SD card. Specific linkages between the files on the secure area and the files on the user area are determined by the DRM specification. For SD cards, there are multiple DRM specifications currently in existence for different applications. Three of particular DRM types are SD-bind, SD-Video, and SDSD-Video.","When accessing the secure area, a mutual authentication (e.g., authenticated key exchange (AKE)) process is necessary prior to accessing the secure area. This process can take 10 ms or more for each secure area access and is highly dependent on the physical implementation of the SD cards themselves. There are three types of secure accesses available: read, write, and erase. Each time a mutual authentication is completed, a single secure access can be accomplished. If an operation requires more than one access (for examples, reading a directory entry or reading different files) or more than one type of access (erase, read, write), a mutual authentication is required for each access. The 10+ milliseconds (\u201cms\u201d) time is therefore additive, if not multiplicative, and reduces the rate at which the SD cards can be programmed.","This problem is exemplified by applications using SD card security. For example, several companies are preloading movie content on microSD cards to playback in CE devices. Preloading means that content is loaded on to the SD card prior to packaging. Other companies are loading content on-demand in a retail environment, a form of manufacturing on demand. Both processes are subject to speed degradation associated with the mutual authentication process.","Typical process overhead for preloading consists of 25 AKE operations for SD-Bind. More AKE operations are required for manufacturing on demand if the SD card is not in an \u201cinitial\u201d state containing only the file systems. More operations are needed for SD-Video and SDSD-Video as the number of AKE operations is also dependent on the content to be protected. AKE for SDSD-Video is approximately 100 operations. Moving content from one SD device to another can range from 70 to almost 150 operations. Using a 10 ms average time for a single AKE operation, this process can add 250 ms to the manufacturing cycle time for secure operations alone. Using an SD card with a 10 MB\/s throughput (a class 10 SD card) and a content size of 500 MB, content write time is approximately 50 second (\u201cs\u201d) for content plus 250 ms for secure operations leaving the total time to write the content at 50.25 s.","The Figures (FIGS.) and the following description relate to preferred embodiments by way of illustration only. It should be noted that from the following discussion, alternative embodiments of the structures and methods disclosed herein will be readily recognized as viable alternatives that may be employed without departing from the principles of what is claimed.","Reference will now be made in detail to several embodiments, examples of which are illustrated in the accompanying figures. It is noted that wherever practicable similar or like reference numbers may be used in the figures and may indicate similar or like functionality. The figures depict embodiments of the disclosed system (or method) for purposes of illustration only. One skilled in the art will readily recognize from the following description that alternative embodiments of the structures and methods illustrated herein may be employed without departing from the principles described herein.","Configuration Overview","A system (and method) to update content of a secure area of a secure digital (SD) card is disclosed. The system performs a first authenticated key exchange to access the secure area of the secure digital memory. The system reads content from the secure area in response to successful performance of the first authenticated key exchange. The system modifies the content in a memory of a computer system. The system performs a second authenticated key exchange to access the secure area of the secure digital card in preparation to write to the secure area of the secure digital memory. The system then transfers the content to the secure area of the secure digital memory in response to successful performance of the second authenticated key exchange","Computing Machine Architecture",{"@attributes":{"id":"p-0018","num":"0017"},"figref":["FIG. 1","FIG. 1"],"b":["100","124"]},"The machine may be a server computer, a client computer, a personal computer (PC), a tablet PC, a set-top box (STB), a personal digital assistant (PDA), a cellular telephone, a smartphone, a web appliance, a network router, switch or bridge, a gaming console, a Blu-ray Disc player, or any machine capable of executing instructions  (sequential or otherwise) that specify actions to be taken by that machine. In addition, the machine may be configured to include instructions stored as firmware or a hardware state machine (microcode). Further, while only a single machine is illustrated, the term \u201cmachine\u201d shall also be taken to include any collection of machines that individually or jointly execute instructions  to perform any one or more of the methodologies discussed herein.","The example computer system  includes a processor  (e.g., a central processing unit (CPU), a graphics processing unit (GPU), a digital signal processor (DSP), one or more application specific integrated circuits (ASICs), one or more radio-frequency integrated circuits (RFICs), or any combination of these), a main memory , and a static memory , which are configured to communicate with each other via a bus . The computer system  may further include graphics display unit  (e.g., a plasma display panel (PDP), a liquid crystal display (LCD), a projector, or a cathode ray tube (CRT)). The computer system  may also include alphanumeric input device  (e.g., a keyboard), a cursor control device  (e.g., a mouse, a trackball, a joystick, a motion sensor, touchscreen, remote control or other pointing instrument), a persistent storage unit , a signal generation device  (e.g., a speaker), and a network interface device , which also are configured to communicate via the bus . The computer system  also may include a random number generator (RNG) . The random number generator  can be implemented in either hardware or software.","The storage unit  includes a machine-readable medium  on which is stored instructions  (e.g., software) embodying any one or more of the methodologies or functions described herein. The instructions  (e.g., software) may also reside, completely or at least partially, within the main memory  or within the processor  (e.g., within a processor's cache memory) during execution thereof by the computer system , the main memory  and the processor  also constituting machine-readable media. The instructions  (e.g., software) may be transmitted or received over a network  via the network interface device .","Also included in the computing system  is a secure digital (SD) card reader\/writer . The SD card reader\/writer in one embodiment may be a physical device that accepts SD card in various physical formats (SD card, mini SD, or micro SD) and interfaces the electrical characteristics such that the storage on the SD card can be accessed by the computing device. The card reader may be internal to the computing device or external using adapters such as a USB-SD card reader, PC card-card reader, express card reader, or other means such that the computing device can communicate with an SD card.","While machine-readable medium  is shown in an example embodiment to be a single medium, the term \u201cmachine-readable medium\u201d should be taken to include a single medium or multiple media (e.g., a centralized or distributed database, or associated caches and servers) able to store instructions (e.g., instructions ). The term \u201cmachine-readable medium\u201dshall also be taken to include any medium that is capable of storing instructions (e.g., instructions ) for execution by the machine and that cause the machine to perform any one or more of the methodologies disclosed herein. The term \u201cmachine-readable medium\u201d includes, but not be limited to, data repositories in the form of solid-state memories, collections of logic elements, optical media, and magnetic media.","In one example embodiment, the instructions  correspond to an application program . The application program  includes a set machine readable instructions to carry out key exchange and data transfer specifications as further described herein. In one example, the application program  may work with a digital rights management (DRM) key  and tamper resistant software .","In addition, the example computer system  includes a SD secure application programming interface (API) . The SD API is a software component that facilitates access to the SD card's secure area. The software architecture of the computer systems assumes that the SD card is capable of responding to the commands from the application program using the SD Secure API architecture.","Digital Rights Management Computing Environment",{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 2A-FIG","b":["2","100","200","200","205","210","215","220","225","230"]},"The application program  and the SD secure API  of the computer system  are further broken out for illustrative purposes to show additional components. Specifically, the application program  includes a DRM key  and a tamper resistant software (TRS) . The DRM key may also be external to the application program so long as the key can be securely stored. The SD secure API  includes a device manager (DM)  and a device driver (DD) . Similarly, the flash memory  is further broken out for illustration purposes to show a secure (or protected) area  and a user area .","Turning now to the application program , the DRM key  is stored in the computer system  and used to complete a key exchange with the SD card . Specifically, the key exchange is used to gain access to the SD card secure area  in accordance with the Content Protection for Recordable Media (CPRM) specification for use with SD cards. The application is provisioned with the DRM key either at initial installation or contained within the program itself. The random number generator  in the computer system  provides random numbers as required by the Authenticated Key Exchange (AKE) specification.","The key exchange process and subsequent data access is subject to hackers (unauthorized or rogue applications) attempting to obtain the data stored on the secure area  of the SD card  that is transferred into the application program . The tamper resistant software  protects against these and other hacking attempts (attacks). The tamper resistant software  comprises software code that may include techniques which remain proprietary to their respective vendors but may include such items as code obfuscation, anti-debugging, and code duplication.","Next, referring to the SD secure API , it comprises a software component that facilitates access to the secure area  on the SD card . The software architecture of the computer system  assumes that the SD card is capable of responding to the commands from the application program  using the SD secure API  architecture.","As noted previously, the SD secure API  includes the device manager (DM)  and the device driver (DD) . The device manager (DM)  identifies SD card readers attached to the computer system . Once card readers are identified, the device manager  matches the corresponding device driver  with the specific physical card reader, or readers, attached to the computer system . The device driver  provides a device independent API interface to card readers allowing individual device drivers to be hardware specific. It formats secure commands specifically for card readers and returns data to the application program . The device driver  provides a conduit for application to communicate with card readers, which in turn communicate directly with the secure area  of the SD card .","Turning now to the SD card , the SD card may be a multiple of physical package configurations such as SD card, mini SD, or micro SD. The SD card  must conform to the specifications developed and enforced by the SD CARD ASSOCIATION. The general construct of the SD card  is illustrated to provide a general idea of how an SD card may be internally constructed. The decomposition is not intended to reveal any specific trade secrets or patents of the many SD card vendors. The SD card itself can be thought of as an application specific computing platform, as opposed to the general purpose computing platform of a computing device. The specific application is to transfer data to\/from the computer system , and if required, to securely store data by restricting access to applications that can complete the Authenticated Key Exchange (AKE) in order to access the secure data.","In the SD card , a microcontroller device  is configured to receive requests for data from a card reader. In the case of user area  access (insecure access) data is returned without completing the Authenticated Key Exchange process. The firmware  comprises software machine instructions by the microcontroller  to interpret card reader commands and return data to the card reader. The firmware includes the necessary algorithms (cryptograph and hash) in accordance with SD CARD ASSOCIATION and CPRM specifications to implement the Authenticated Key Exchange (AKE) protocol. Firmware may be implemented using physical logic elements or can be a program that is interpreted by a microcontroller .","The random number generator  that provides random numbers for replay protection required by AKE protocol. The random number generator  can be implemented in either hardware or software. It is noted that the random number generator  in the computer system  and the random number generator  in the SD card  are both used for the AKE protocol. The media key block (MKB)  is structured in accordance with the CPRM specification for SD Cards. Specifically, multiple keys are included in SD cards and are provisioned by the SD card manufacturer at manufacturing time. The media key block  includes DRM keys that may change due to key revocations. Specific keys are used with the authenticated key exchange protocol that must be completed prior to accessing the secure flash (or other non-volatile memory) area.","As noted previously, the SD card contains flash memory  that is partitioned into two separate regions. One is a secure area  and the other is a user (unsecured) area . The secured area  may be implemented as a physical device or logical region within the SD card as chosen by the SD card original equipment manufacturer (OEM). The size of the secure area  size is determined at manufacturing time according to the SD card specifications. Requests to access the data from the secured area  must first complete the AKE process. The user (or unsecured) area  may be implemented in the same manner as the secure area . The user (or unsecured) area  also may be either physical or logical partitions depending on implementation within the SD card. Request for data from the user area  does not require AKE process to complete.","The flash memory  is configured to store secure data in the secure area  and unsecured data in the user area . Both the secure data and the unsecure data are stored in a persistent manner so that it can be retrieved at a later time. It is noted that every SD card is provisioned with a secure area , even if it is never used by any application.","The Media ID  is used in accordance with the AKE protocol. The DRM key of the media key block (MKB)  and media ID  are required for the AKE processes. These items are provisioned by the SD card manufacturer during the manufacturing process.","When executing, the application program  uses a DRM key, the random number generator  of the computer system , the media key block , and the media ID  when transferring data through the device manager  and device driver  in order to complete the security exchange with the SD card . The SD card  uses the media key block , the random number generator , the media ID , and data sent by the application program  to calculate the AKE process result. The exchange process includes mutual authentication whereby both the SD card  and application program  authenticate each other before accessing the secure area  of the SD card . The process completes when both the SD card  has authenticated the application program  and the application program  has authenticated the SD card . Here, the SD card  performs the same operations as the application program  and if both achieve the same AKE process result, mutual authentication is achieved and both the application program  and SD card  can proceed to access the data in the secure area  within the flash memory  of the SD card .","Optimized Write to Secure Digital Card Secure Area","In one aspect of the disclosed configuration, the number of AKE operations can be reduced to two operations. Referring to the example from above, the resultant time is then 50.02seconds (\u201cs\u201d) or an overall reduction of 230 milliseconds (\u201cms\u201d) per SD card. When considering SDSD, 60 or more AKE operations can be required in a manufacturing setting. By way of example this removes 580 ms from the manufacturing procedure, or approximately a 2% reduction in overall time. For manufacture on demand set ups, for example retail kiosk applications that manufacture a custom configured SD card, the savings are greater as more information is stored on the protected area. This information gets stored when either the information is written to the protected area during manufacturing or the information is written to the protected area prior to manufacturing.","In secure operation configurations the time change savings are significant. For example, when considering just the secure operations, the total time for AKE exchanges plus data transfers using a 32 KB transfer, the time required is 10 ms+3 ms=13 ms. For a 60operations, the total time is 780 ms. When the AKEs are reduced to 2, the total time required is 200 ms. The process is almost four times (4\u00d7) faster than a conventional secure write process.",{"@attributes":{"id":"p-0041","num":"0040"},"figref":"FIG. 3","b":["310","315","320","104","100","320","104","100","260","265","200","260","104","100","200","330","335","200","260","265","200","340"]},"It is also noted that some applications require only read operations from the SD card secure area. This optimization process is equally applicable to read-only applications using multiple read operations from the secure area. Since multiple read operations required multiple AKE, the read operations can also be reduced to a single read and single AKE by following the process steps from  through , eliminating the write operations described in  through ","Additional Configuration Considerations","Throughout this specification, plural instances may implement components, operations, or structures described as a single instance. Although individual operations of one or more methods are illustrated and described as separate operations, one or more of the individual operations may be performed concurrently, and nothing requires that the operations be performed in the order illustrated. Structures and functionality presented as separate components in example configurations may be implemented as a combined structure or component. Similarly, structures and functionality presented as a single component may be implemented as separate components. These and other variations, modifications, additions, and improvements fall within the scope of the subject matter herein.","Certain embodiments are described herein as including logic or a number of components, modules, or mechanisms. Modules may constitute either software modules (e.g., code embodied on a machine-readable medium or in a transmission signal) or hardware modules. A hardware module is tangible unit capable of performing certain operations and may be configured or arranged in a certain manner. In example embodiments, one or more computer systems (e.g., a standalone, client or server computer system) or one or more hardware modules of a computer system (e.g., a processor or a group of processors) may be configured by software (e.g., an application or application portion) as a hardware module that operates to perform certain operations as described herein.","In various embodiments, a hardware module may be implemented mechanically or electronically. For example, a hardware module may comprise dedicated circuitry or logic that is permanently configured (e.g., as a special-purpose processor, such as a field programmable gate array (FPGA) or an application-specific integrated circuit (ASIC)) to perform certain operations. A hardware module may also comprise programmable logic or circuitry (e.g., as encompassed within a general-purpose processor or other programmable processor) that is temporarily configured by software to perform certain operations. It will be appreciated that the decision to implement a hardware module mechanically, in dedicated and permanently configured circuitry, or in temporarily configured circuitry (e.g., configured by software) may be driven by cost and time considerations.","The various operations of example processes described herein, e.g., as described with  and , may be performed, at least partially, by one or more processors that are temporarily configured (e.g., by software) or permanently configured to perform the relevant operations. Whether temporarily or permanently configured, such processors may constitute processor-implemented modules that operate to perform one or more operations or functions. The modules referred to herein may, in some example embodiments, comprise processor-implemented modules.","The one or more processors may also operate to support performance of the relevant operations in a \u201ccloud computing\u201d environment or as a \u201csoftware as a service\u201d (SaaS). For example, at least some of the operations may be performed by a group of computers (as examples of machines including processors), these operations being accessible via a network (e.g., the Internet) and via one or more appropriate interfaces (e.g., application program interfaces (APIs).)","The performance of certain of the operations may be distributed among the one or more processors, not only residing within a single machine, but deployed across a number of machines. In some example embodiments, the one or more processors or processor-implemented modules may be located in a single geographic location (e.g., within a home environment, an office environment, or a server farm). In other example embodiments, the one or more processors or processor-implemented modules may be distributed across a number of geographic locations.","Some portions of this specification are presented in terms of algorithms or symbolic representations of operations on data stored as bits or binary digital signals within a machine memory (e.g., a computer memory). These algorithms or symbolic representations are examples of techniques used by those of ordinary skill in the data processing arts to convey the substance of their work to others skilled in the art. As used herein, an \u201calgorithm\u201d is a self-consistent sequence of operations or similar processing leading to a desired result. In this context, algorithms and operations involve physical manipulation of physical quantities. Typically, but not necessarily, such quantities may take the form of electrical, magnetic, or optical signals capable of being stored, accessed, transferred, combined, compared, or otherwise manipulated by a machine. It is convenient at times, principally for reasons of common usage, to refer to such signals using words such as \u201cdata,\u201d \u201ccontent,\u201d \u201cbits,\u201d \u201cvalues,\u201d \u201celements,\u201d \u201csymbols,\u201d\u201ccharacters,\u201d \u201cterms,\u201d \u201cnumbers,\u201d \u201cnumerals,\u201d or the like. These words, however, are merely convenient labels and are to be associated with appropriate physical quantities.","Unless specifically stated otherwise, discussions herein using words such as \u201cprocessing,\u201d \u201ccomputing,\u201d \u201ccalculating,\u201d \u201cdetermining,\u201d \u201cpresenting,\u201d \u201cdisplaying,\u201d or the like may refer to actions or processes of a machine (e.g., a computer) that manipulates or transforms data represented as physical (e.g., electronic, magnetic, or optical) quantities within one or more memories (e.g., volatile memory, non-volatile memory, or a combination thereof), registers, or other machine components that receive, store, transmit, or display information.","As used herein any reference to \u201cone embodiment\u201d or \u201can embodiment\u201d means that a particular element, feature, structure, or characteristic described in connection with the embodiment is included in at least one embodiment. The appearances of the phrase \u201cin one embodiment\u201d in various places in the specification are not necessarily all referring to the same embodiment.","Some embodiments may be described using the expression \u201ccoupled\u201d and \u201cconnected\u201d along with their derivatives. For example, some embodiments may be described using the term \u201ccoupled\u201d to indicate that two or more elements are in direct physical or electrical contact. The term \u201ccoupled,\u201d however, may also mean that two or more elements are not in direct contact with each other, but yet still co-operate or interact with each other. The embodiments are not limited in this context.","As used herein, the terms \u201ccomprises,\u201d \u201ccomprising,\u201d \u201cincludes,\u201d \u201cincluding,\u201d \u201chas,\u201d\u201chaving\u201d or any other variation thereof, are intended to cover a non-exclusive inclusion. For example, a process, method, article, or apparatus that comprises a list of elements is not necessarily limited to only those elements but may include other elements not expressly listed or inherent to such process, method, article, or apparatus. Further, unless expressly stated to the contrary, \u201cor\u201d refers to an inclusive or and not to an exclusive or. For example, a condition A or B is satisfied by any one of the following: A is true (or present) and B is false (or not present), A is false (or not present) and B is true (or present), and both A and B are true (or present).","In addition, use of the \u201ca\u201d or \u201can\u201d are employed to describe elements and components of the embodiments herein. This is done merely for convenience and to give a general sense of the invention. This description should be read to include one or at least one and the singular also includes the plural unless it is obvious that it is meant otherwise.","Upon reading this disclosure, those of skill in the art will appreciate still additional alternative structural and functional designs for a system and a process for optimization of writes to a secure digital card (SD card) secured (or protected) area through the disclosed principles herein. Thus, while particular embodiments and applications have been illustrated and described, it is to be understood that the disclosed embodiments are not limited to the precise construction and components disclosed herein. Various modifications, changes and variations, which will be apparent to those skilled in the art, may be made in the arrangement, operation and details of the method and apparatus disclosed herein without departing from the spirit and scope defined in the appended claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF DRAWINGS","p":["The disclosed embodiments have other advantages and features that will be more readily apparent from the detailed description, the appended claims, and the accompanying figures (or drawings). A brief introduction of the figures is below.",{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 2A-FIG","b":"2"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 3"}]},"DETDESC":[{},{}]}
