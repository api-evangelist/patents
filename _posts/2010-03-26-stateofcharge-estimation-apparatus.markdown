---
title: State-of-charge estimation apparatus
abstract: A state-of-charge estimation apparatus connected to a power storage device having cell batteries, and estimating a state of charge of the power storage device, the apparatus including a first SOC computation unit computing a current integration value based on a total current from a current detector detecting the total current flowing to the storage device from a power conversion device using a previous SOC value as an initial value, and outputting the integration value as a first state-of-charge estimated value, and a second SOC computation unit estimating, after discharge suspension in the storage device, an open-circuit voltage based on a total voltage on a connection point between the conversion device and the storage device, a previous value of the total voltage, and a gain with time passage after discharge suspension in the storage device, and outputting the open-circuit voltage as a second state-of-charge estimated value.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09013151&OS=09013151&RS=09013151
owner: Mitsubishi Electric Corporation
number: 09013151
owner_city: Chiyoda-Ku, Tokyo
owner_country: JP
publication_date: 20100326
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["FIELD","BACKGROUND","CITATION LIST","Patent Literatures","SUMMARY","Technical Problem","Solution to Problem","Advantageous Effects of Invention","DESCRIPTION OF EMBODIMENTS"],"p":["The present invention relates to an apparatus that estimates a state of charge (SOC) of a secondary battery.","Generally, when batteries are used in a railway system in order to supply energy during running or to recover regenerative energy at the time of deceleration and halt, many cell batteries are used with being connected to each other in series-parallel combination, because of a large amount of electric energy to be consumed. At this point, it is necessary to obtain an SOC for the running of a vehicle and control of charge\/discharge of batteries.","There has been conventionally known a method of estimating an SOC of a battery by a combination of a system using integration of charge and discharge currents and a system using a relation between an open-circuit voltage and the SOC of a secondary battery held in equilibrium (for example, Patent Literature 1 mentioned below). The method disclosed in Patent Literature 1 is to estimate an SOC from current integration at the time of charge or discharge, and to estimate an SOC by estimating the open-circuit voltage during a standby time.","In relation to the open-circuit voltage estimation method, there has been known an example of estimating an open-circuit voltage using a voltage change after charge or discharge (for example, Patent Literature 2 mentioned below).","Patent Literature 1: Japanese Patent Application Laid-open No. 2008-199723","Patent Literature 2: Japanese Patent Application Laid-open No. 2007-333474","However, the method of Patent Literature 1 mentioned above has the following problems. That is, because an equivalent circuit of a battery is used to estimate an open-circuit voltage, an internal resistance dependent on a temperature or an SOC is required, and it is also required to take battery degradation into consideration.","Meanwhile, when an SOC of a power storage device composed of many batteries is estimated, it is desirable to measure a battery voltage and a battery current for the entire batteries that constitute the power storage device. However, sensors for measuring the battery voltage and the battery current are not high in resolution and accuracy, so that the measurement values often include ripples. According to Patent Literature 2 mentioned above, the open-circuit voltage is estimated by measuring a total voltage of the batteries and making addition of a predetermined value when the change rate of the total voltage is equal to or lower than a predetermined value after charge or discharge. Therefore, it is possible to estimate the open-circuit voltage only by measuring the total voltage without using any equivalent circuit constants. However, there are problems in that it is required to ensure a high voltage-measuring accuracy to obtain a stable value because a significant difference is caused in the SOC when the open-circuit voltage of cells differs only by 1 mV.","The present invention has been achieved in view of the above-mentioned circumstances, and an object of the present invention is to provide a state-of-charge estimation apparatus that can suppress change in an SOC estimated value.","In order to solve the above-mentioned problems and achieve the object, the present invention provides a state-of-charge estimation apparatus that is connected to a power storage device constituted by connecting a plurality of cell batteries, and estimates a state of charge of the power storage device, the state-of-charge estimation apparatus comprising: a first computation unit that computes a current integration value based on a current from a detector that detects a current flowing to or from the power storage device from or to a power conversion unit while a previous value of a state-of-charge estimated value is set as an initial value, and that outputs the computed current integration value as a first state-of-charge estimated value; a second computation unit that estimates, after suspension of charge or discharge in the power storage device, an open-circuit voltage based on a voltage detected in a connection point between the power conversion unit and the power storage device, a previous value of the voltage detected in the connection point, and a gain that decreases with passage of time after the suspension of the charge or discharge in the power storage device, and that outputs the estimated open-circuit voltage as a second state-of-charge estimated value; and a selection unit that selects any one of the first state-of-charge estimated value and the second state-of-charge estimated value.","According to the present invention, the state-of-charge estimation apparatus includes a first SOC computation unit that estimates a first state-of-charge estimated value, a second SOC computation unit that estimates a second state-of-charge estimated value, and an SOC sudden-change prevention unit that suppress sudden change in the second state-of-charge estimated value based on a variable gain and a previous SOC value. Therefore, it is possible to suppress the change in the SOC estimated value even when the battery-voltage measurement accuracy is low or the measured voltage has ripples.","Embodiments of a state-of-charge estimation apparatus according to the present invention will be described below in detail with reference to the drawings. The present invention is not limited to the embodiments.","First Embodiment",{"@attributes":{"id":"p-0029","num":"0028"},"figref":["FIG. 1","FIG. 2","FIG. 1","FIG. 3"],"b":["10","11","10"]},"A power conversion device (power conversion unit)  shown in  is connected to a power collector  and wheels  that serve as a return circuit of a return current, and receives power from an overhead wire  connected to an electric power substation (not shown) that serves as a direct-current (DC) power supply. A voltage detector  shown in  detects a voltage in a connection point between the power conversion device  and the power storage device . A current detector  detects a current that flows to or from the power storage device . The state-of-charge estimation apparatus  computes and outputs an SOC estimated value based on a current command Iall* from the power conversion device , a total voltage Vall detected by the voltage detector , and a total current Iall detected by the current detector .","With reference to , the power storage device  is configured to include battery modules - to -. The battery module - is constituted by connecting cell batteries - to -in series. Similarly, the battery module - is constituted by connecting cell batteries - to -in series. The battery module -is constituted by connecting cell batteries - to -in series. The battery module -is constituted by connecting cell batteries - to -in series. Each cell battery is a repeatedly dischargeable\/rechargeable secondary battery such as a lithium ion secondary battery, and an SOC of each cell battery can be observed by measuring an open-circuit voltage. A breaker, a battery monitoring device and the like are not shown here although these are often provided in the power storage device .","A voltage between terminals of the power storage device  is assumed as the total voltage Vall. It is assumed that a discharge\/charge current is the total current Iall and that the value of the total current Iall is positive in a charging state. It is also assumed that the number of parallel-connected cells (modules) is m and the number of series-connected cells (modules) is n in the power storage device , where n=(the number of modules)\u00d7(the number of series-connected cells in each module). Because of the large number of cells that constitute the power storage device , a voltage resulting from a resistance component of conductors or cables used for the connecting the terminals is added to the total voltage Vall during charge\/discharge.","In , the voltage detector  and the current detector  provided on an intermediate between the power conversion device  and the power storage device  are used to measure the total voltage Vall and the total current Iall. However, the total voltage Vall and the total current Iall are not limited to those measured in this manner, and a total voltage Vall and a total current Iall measured by a charge\/discharge circuit side (not shown) may be used. In this case, the resistance component of the cable led to the state-of-charge estimation apparatus  becomes larger, and therefore it is desirable to consider an attenuation amount caused by this resistance component.","(State-of-Charge Estimation Apparatus )",{"@attributes":{"id":"p-0035","num":"0034"},"figref":"FIG. 3","b":["10","10","21","22","24","20","23","25","26"]},"The first SOC computation unit  computes and outputs a first state-of-charge estimated value (hereinafter, simply referred to as \u201cfirst estimated value\u201d) SOC based on the total current Iall, a first flag (FLG) generated by the first flag generation unit , and an SOCz that is a previous value of SOC from the unit-delay unit  (hereinafter, referred to as \u201cprevious value SOCz\u201d).","The second SOC computation unit  computes and outputs a second state-of-charge estimated value SOC based on the total voltage Vall and a second flag (FLG) and a third flag (FLG) from the second flag generation unit .","The SOC sudden-change prevention unit (hereinafter, simply referred to as \u201csudden-change prevention unit\u201d)  outputs a third state-of-charge estimated value (hereinafter, simply referred to as \u201cthird estimated value\u201d) SOC based on the second state-of-charge estimated value (hereinafter, simply referred to as \u201csecond estimated value) SOC from the second SOC computation unit  and the previous value SOCz from the unit delay-unit .","The SOC selection unit  selects, as the SOC, any one of the first estimated value SOC from the first SOC computation unit  and the third estimated value SOC from the sudden-change prevention unit  according to the value of the FLG from the second flag generation unit .","An overall computation cycle t [sec] of the state-of-charge estimation apparatus  is 0.1 [sec], for example. As described above, the power storage device  is composed of many cells. Generally, series-connected batteries are provided with a battery-voltage equalization unit (not shown), and the parallel-connected series cells have a substantially equal voltage value. Therefore, it is considered that SOC variations among the cell batteries are not remarkable. For this reason, the SOC is handled as a single value.","A configuration of the state-of-charge estimation apparatus  is explained below in detail.","(First SOC Computation Unit )",{"@attributes":{"id":"p-0043","num":"0042"},"figref":["FIG. 4","FIG. 3","FIG. 5","FIG. 3","FIG. 6","FIG. 3"]},"In , the first SOC computation unit  is configured to include a gain unit , a multiplier , an integrator , a gain unit , and a gain unit .","The gain unit  obtains a cell-current average value Icell by multiplying the total current Iall by a gain 1\/m. That is, the gain unit  obtains an average value of cell currents by dividing the total current Iall by the number m of parallel-connected cell batteries.","The multiplier  multiplies the cell-current average value Icell from the gain unit  by the FLG and outputs a multiplication result. This multiplier  stops integration when the FLG is 0 and executes integration when the FLG is 1. The FLG is generated by the first flag generation unit  described later, and the FLG=1 indicates execution of integration and the FLG=0 indicates stop of integration.","The integrator  integrates an output from the multiplier , and the integrator  is reset every time in a case where FLG is 1.","The gain unit  multiplies the previous value SOCz by a gain K, thereby converting the value SOCz into an initial current-integration value (an initial value). In this way, the initial current-integration value is obtained from the previous value SOCz when the integrator  is reset by the FLG. The gain K of the gain unit  is K=battery capacity [Ah]\u00d73600 [sec]\/100 [%]. The FLG is generated by the second flag generation unit  described later.","The gain unit  multiplies a current integration value from the integrator  by a gain K, so as to convert the integration value into the first estimated value SOC. Note that K=1\/battery capacity [Ah]\/360 [sec]\u00d7100 [%].","The first SOC computation unit  is configured to stop integration to prevent an error in the SOC value from increasing due to the influence of a current detection error when the FLG is 0. This configuration is described. A case of satisfying a relation of |Iall|<Iallmin indicates the following states. The first of them is a state where the current command Iall*=0 so that charge and discharge is suspended, and only a ripple current flows. The second of them is a state where the current command Iall*=0 is not held but the charge or discharge continues in constant voltage charge at a current value lower than Iallmin. When the current is low, influences of the current detection error is significant. Therefore, the first SOC computation unit  is configured so that, when the FLG is 0, an output value of the integrator  no longer changes and the first estimated value SOC becomes a constant value by causing the multiplier  to stop integration.",{"@attributes":{"id":"p-0051","num":"0050"},"figref":["FIG. 5(","FIG. 3","FIG. 5(","FIG. 3"],"i":["a","b"],"b":["21","21"]},"A first flag generation unit shown in ) is configured to include an absolute-value computation unit that computes an absolute value of the total current Iall, and a comparator that compares the absolute value from the absolute-value computation unit with the current threshold Iallmin and outputs the comparison result as the FLG. If the absolute value |Iall| (A) of Iall is equal to or higher than the current threshold Iallmin (B), then FLG=1. If the absolute value |Iall| (A) of Iall is lower than the current threshold Iallmin (B), then FLG=0.","A first flag generation unit shown in ) is configured to include an absolute-value computation unit that computes the absolute value of the total current Iall, a comparator that compares the absolute value from the absolute-value computation unit with the current threshold Iallmin and outputs a comparison result, and a NOR gate  that receives the output from the comparator and a gate block GB from the charge\/discharge circuit (not shown) as inputs and outputs a logical result of their values as the FLG. If configuration is made such that FLG=0 is outputted when the gate block GB from the charge\/discharge circuit is detected, a value of the FLG can be changed with a higher accuracy than that of the first flag generation unit shown in ).",{"@attributes":{"id":"p-0054","num":"0053"},"figref":["FIG. 6","FIG. 3"],"b":"22"},"A second flag generation unit shown in ) is configured to include a comparator that outputs the FLG when the current command Iall* is 0, and an ON delay unit that changes the value of the FLG to 1 after passage of a predetermined time t [sec] since the FLG becomes 1 (FLG=1) and outputs the FLG. For example, when the current command Iall* becomes 0, the value of FLG that is an output from the comparator becomes 1. In this way, when the current command Iall*=0, the value of FLG becomes 1, or otherwise the value of FLG becomes 0. Furthermore, the value of FLG becomes 1 after the passage of the predetermined time t [sec] since the value of FLG becomes 1. The time t is 20 [sec], for example.","A second flag generation unit shown in ) is configured to include a comparator that outputs  when the current command Iall* is 0, an OR gate  that outputs any one of an output from the comparator and the gate block GB from the charge\/discharge circuit (not shown) as the FLG, and an ON delay unit that changes the value of the FLG to 1 after the passage of the predetermined time t [sec] since the FLG becomes 1 (FLG=1) and outputs the FLG. By making such a configuration that a value of FLG is changed to 1 after passage of a predetermined time t [sec] from detection of the gate block GB from of the charge\/discharge circuit, the value of the FLG can be changed with a higher accuracy than that of the second flag generation unit shown in ).","The value of the FLG indicates that the first estimated value SOC is computed in the first SOC computation unit  when FLG=0, and that the second estimated value SOC is computed in the second SOC computation unit  when FLG=1.","Each of the ON delay unit shown in ) and the ON delay unit shown in ) changes the value of the FLG with it being delayed only when the value of the FLG changes from 0 to 1, but changes the value of the FLG without it being delayed when the value of the FLG changes from 1 to 0. Accordingly, SOC estimation is halted for the period t(s) for which the Vall suddenly changes after the charge or discharge.","Furthermore, because the second flag generation unit shown in ) or the second flag generation unit shown in ) obtains the FLG using the current command Iall*, the second flag generation unit or prevents the second SOC computation unit  from outputting the second estimated value SOC during the period (during the period t, for example) during which the relation of |Iall|<Iallmin is satisfied but the charge or discharge continues due to constant voltage charge or discharge.","(Second SOC Computation Unit )",{"@attributes":{"id":"p-0061","num":"0060"},"figref":["FIG. 7","FIG. 3","FIG. 8","FIG. 9","FIG. 7"],"b":["24","3"]},"The second SOC computation unit  shown in  is configured to include, as main constituent elements, a gain unit , a gain unit , a limiter , a table , a unit-delay unit , a subtracter , and an adder .","The second SOC computation unit  operates when the FLG shown in  is 1, and has a computation cycle of t [sec]. For example, the time t is 5 [sec], that is, for example, 50 times as long as the overall computation cycle of the state-of-charge estimation apparatus .","The gain unit obtains a cell voltage average value Vcell by multiplying the total voltage Vall by a gain 1\/n. That is, the gain unit obtains an average voltage value of cells by dividing the total voltage Vall by the number n of series-connected cell batteries.","The unit-delay unit  outputs the cell voltage average value Vcell from the gain unit with it being delayed by one sample (t). That is, the unit-delay unit  outputs a previous value of the cell voltage average value Vcell.","The subtracter  outputs a difference between the output (the previous value) from the unit-delay unit  and the output (a present value) from the gain unit . The gain unit  multiplies the difference from the subtracter  by the gain K and outputs the multiplication result. The adder  adds the output (the previous value) from the unit-delay unit  to the output from the gain unit , thereby obtaining an open-circuit voltage estimated value (an open-circuit voltage) Vocell.","After passage of a sufficient time from the charge or discharge, Vocell=Vcell. However, right after the charge, Vocell<Vcell, and a difference between the Vocell and the Vcell then gradually decreases. Furthermore, right after the discharge, Vocell>Vcell, and the difference therebetween then gradually decreases. Therefore, the second SOC computation unit  obtains the open-circuit voltage estimated value Vocell at a present time (k) using the following Equation.\n\n()=(-1)+3\u00d7(()\u2212(-1))\u2003\u2003(1)\n","That is, multiplication of a change in the cell voltage average value Vcell from k\u22121 to k by K is added to the cell voltage average value Vcell(k\u22121) t before then. Accordingly, when the gain K=1, the open-circuit voltage estimated value Vocell is equal to the present cell voltage average value Vcell, and when the gain K<1, the influence of the change in the cell voltage average value Vcell on the open-circuit voltage estimated value Vocell decreases. Herein, the gain K is a variable gain.","The limiter  limits a value of the open-circuit voltage estimated value Vocell from the adder  to a practical value for reference to a table ","In the table , the open-circuit voltage estimated value Vocell is caused to correspond to the SOC as shown in . The correspondence between the open-circuit voltage estimated value Vocell and the SOC can be obtained by a charge\/discharge test on the battery cell. The second SOC computation unit  outputs, as the second estimated value SOC, the value of the SOC corresponding to the open-circuit voltage estimated value Vocell limited by the limiter  while referring to the table . An approximate expression may be used in place of the table ","The value of the gain K set for the gain unit  is set to be smaller with the passage of time and to become smaller than 1 as a final value as shown in .  shows the value of the gain K in the case where t is 20 [sec] and t=5 [sec], as one example. The time when the second SOC computation unit  that has detected FLG=1 starts operating is set as 0 [sec]. When the second SOC computation unit  performs computation at an interval of t, for example, the value of the gain K during the period t (0 to 20 [sec]) is about 6.","The reason for setting the value of the gain K as described above is as follows. A state where the power storage device  is caused to suspend its discharge when being discharged is described by way of example.","Around the period t, which is just after the end of the discharge, the difference between Vcell(k\u22121) and Vcell(k)\u2212Vcell(k\u22121) is large. When the value of the gain K is small around the period t, a change in the open-circuit voltage estimated value Vocell is large and the second estimated value SOC greatly changes accordingly. Until just before the end of the discharge, the SOC is estimated by the current integration. However, around the period t just after the end of the discharge, the total voltage Vall rapidly recovers (rises). With a view to estimate the stable SOC while suppressing the change in the second estimated value SOC, the second SOC computation unit  according to the present embodiment sets the value of the gain K to be large around the period t just after the end of the discharge, thereby preventing the excess of the SOC. The excess of the SOC means that the SOC estimated value by the estimation of the open-circuit voltage right after the end of the discharge falls below the SOC estimated value by the current integration just after the end of the discharge.","The value of the gain K is set to gradually decrease after the passage of the period t and to be equal to 0.5 with the passage of about 50 [sec]. The reason for setting the value of the gain K as described above is as follows. The change in the cell voltage average value Vcell is originally supposed to be small because of the passage of a certain time after the end of the discharge. However, even when the discharge is suspended, the cell voltage average value Vcell fluctuates because the power conversion device  continues switching and the current detector , therefore, detects some ripple current or the voltage detector  has the voltage detection error. When the open-circuit voltage estimated value Vocell changes along with this change, the second estimated value SOC changes accordingly. To suppress such a change in the second estimated value SOC, the second SOC computation unit  according to the present embodiment gradually decreases the value of the gain K after the passage of the period t and sets the gain K to K=0.5 after the passage of about 50 [sec], thereby suppressing the change in the open-circuit voltage estimated value Vocell.","The gain K during the charge is also set to a value that decreases with the passage of time similarly to that during the discharge. For example, the value of the gain K is set to be large around the period t and to gradually decrease after the passage of the period t. This is because an absolute value of a change rate of the voltage average value Vcell is large to small both after the discharge and after the charge although the magnitude relation between the open-circuit voltage estimated value Vocell and the voltage average value Vcell after the discharge is opposite to that after the charge.","(SOC Sudden-Change Prevention Unit )",{"@attributes":{"id":"p-0077","num":"0076"},"figref":["FIG. 10","FIG. 3"],"b":["25","25","63","61","62","64"]},"The subtracter  outputs a difference between the previous value SOCz and the second estimated value SOC. The gain unit  multiplies the difference from the subtracter  by K, and the limiter  limits an output from the gain unit  to \u00b10.02 [%] per 0.1 [sec] and outputs the limited result. The subtracter  adds an output from the limiter  to the previous value SOCz and outputs an addition result as the third estimated value SOC.","The above processing is specifically explained. First, the third estimated value SOC [%] is computed by the following Equation.\n\nThird estimated value 2 [%]=Limit(4(20))\u2003\u2003(2)\n","where the value of K is 0.8, for example, and for the limiter , \u00b10.02 [%] is set, for example.","Because the computation cycle of the sudden-change prevention unit  is 0.1 [sec], the third estimated value SOC changes at a maximum by 0.02 [%] for 0.1 [sec]. Furthermore, the computation cycle t of the second SOC computation unit  shown in  is 5 [sec]. Therefore, the second estimated value SOC from the second SOC computation unit  is updated once every 50 times of executions of computations of the sudden-change prevention unit . That is, the second estimated value SOC changes at a maximum by 0.02\u00d750=1 [%] per 5 [sec]. As a specific example, when the second estimated value SOC inputted to the sudden-change prevention unit  decreases from 50%, for example, the second estimated value SOC becomes 49.98[%] 0.1 [sec] later and becomes 49.96 [%] further 0.1 [sec] later. That is, the second estimated value SOC 5 [sec] after being inputted to the sudden-change prevention unit  decreases by 1 [%] to 49.0 [%]. Similarly, when a value of the second estimated value SOC increases from 50%, the second estimated value SOC becomes 51.0 [%] 5 [sec] later.","In this way, the sudden-change prevention unit  prevents the third estimated value SOC from suddenly changing by limiting the change in the second estimated value SOC from the second SOC computation unit  to 1% for 5 seconds. When the sudden-change prevention unit  does not have the limiter (Limit) , the sudden-change prevention unit  outputs a K multiple of the difference between the second estimated value SOC and the previous value SOCz as the third estimated value SOC. For example, when K=1, the difference between the second estimated value SOC and the previous value SOCz is directly reflected in the third estimated value SO. Furthermore, the above-mentioned value of K and a set value of the limiter  are given as an example and the invention is not limited to these values.",{"@attributes":{"id":"p-0083","num":"0082"},"figref":["FIG. 11","FIG. 3"],"b":["23","1","20","2","24","25","71","2","1","2","2","2"]},"Specifically, the FLG=0 is held during the charge and discharge and for the period (t) of the passage of about 20 seconds from the charge or discharge is suspended. Therefore, the switch  selects the first estimated value SOC from the first SOC computation unit  and outputs the first estimated value SOC. That is, when |Iall|<Iallmin, the current integration is halted in the first SOC computation unit , so that the SOC inputted to the SOC selection unit  is constant. Accordingly, the SOC is not updated during the charge or discharge and for the period t after the charge or discharge.","On the other hand, during a period until the charge or discharge is resumed after the passage of the period t, the third estimated value SOC is selected.","When control power is activated, an appropriate SOC can not be obtained if an initial value of the unit-delay unit  that outputs the previous value SOCz is set to 0. Therefore, a method of setting the initial value is explained below.",{"@attributes":{"id":"p-0087","num":"0086"},"figref":["FIG. 12","FIG. 3","FIG. 12","FIG. 7"],"b":["24","51","54","51","54","54","24","54","54"],"i":["a ","b ","b","b ","b","a ","b","b. "]},"When a sufficient time passes since the previous charge or discharge, the open-circuit voltage of the power storage device  obtained from the voltage detector  can be considered to be constant, so that the initial-value setting circuit can obtain the value (the initial value) of the SOC. For example, when a system starts after the end of the charge or discharge, the open-circuit voltage can be considered to be generally constant. Therefore, the first SOC computation unit  and the sudden-change prevention unit , shown in , perform computation of the first estimated value SOC and the second estimated value SOC using the initial value from the initial-value setting circuit . When a sufficient time has not passed since the previous charge or discharge, the second SOC computation unit  shown in  updates the SOC to an appropriate SOC.","Note that a measured value of the total voltage Vall includes ripples and noise. Therefore, a configuration may be made such that the total voltage Vall is inputted to a lowpass filter of, for example,  Hz and then the SOC is estimated with an output from the filter being used as the total voltage Vall.","In a railway system, the total voltage Vall is about 600 V, and in the situation the number of series-connected cell batteries exceeds 160. On the other hand, according to the table shown in , the relation between the open-circuit voltage and the SOC is that the value of SOC\/open-circuit voltage increases as the open-circuit voltage and the SOC rise. Therefore, when the SOC is larger, the influence of a voltage change increases. When the open-circuit voltage changes by 10 mV (the total voltage is 1.6 V for the number of series-connected cell batteries is 160), for example, the SOC is considered to change by 2 to 3%. Therefore, it is difficult to keep the change in the SOC below a 1% level in consideration of resolution and measurement accuracy of the voltage detector . Furthermore, a DC-DC converter (not shown) that is included in the power conversion device  and executes the charge and discharge for the power storage device  is caused to operate with the current command being 0, it is thought that a voltage ripple resulting from a ripple current occurs. Under these conditions, it is necessary to provide an estimation method that allows the SOC estimated value to include a few errors and prevents the SOC estimated value from remarkably deviating from an actual SOC and from excessively changing under these conditions. Moreover, in the railway system, it is assumed to frequently use not only constant-current operation but also constant-voltage operation during the charge or discharge so as to improve battery utilization efficiency and to protect the batteries.","The state-of-charge estimation apparatus  according to the present embodiment can ensure a high estimation accuracy both during the charge\/discharge and during suspension thereof by using a combination of SOC computation based on the current integration (the first SOC computation unit ) and SOC computation based on the estimation of the open-circuit voltage (the second SOC computation unit ).","Moreover, it is unnecessary to use a battery equivalent circuit model for the estimation of the open-circuit voltage, and it is possible to obtain a stable estimated value by the use of only the measured value of the total voltage Vall without any large deviation from the actual SOC and the excessive change in the estimated value. Furthermore, the state-of-charge estimation apparatus  can be less influenced by noise.","Further, even when the charge or discharge continues at a low current at which the influence of the error is larger in the case of estimation based on the current integration, the state-of-charge estimation apparatus  according to the present embodiment does not erroneously estimate the open-circuit voltage although the estimated value can not be updated but the charge or discharge continues. Therefore, the state-of-charge estimation apparatus  according to the present embodiment can handle not only the constant-current charge and discharge but also the constant-voltage charge and discharge.","As described above, the state-of-charge estimation apparatus  according to the present embodiment includes: the first SOC computation unit  that computes the current integration value of the total current Iall detected by the current detector  and computes the first estimated value SOC based on the current integration value while the previous value SOCz is set as the initial value; the second SOC computation unit  that computes, after the charge or discharge in the power storage device  is suspended, the open-circuit voltage estimated value Vocell based on the cell voltage average value Vcell of the total voltage Vall detected by the voltage detector , the previous value of the cell voltage average value Vcell, and the gain K that changes with the passage of time after the charge or discharge is suspended, and outputs the open-circuit voltage estimated value Vocell as the second estimated value SOC; and the sudden-change prevention unit  that limits the change amount in the second estimated value SOC in the computation cycle t of the second SOC computation unit  to be equal to or smaller than the predetermined value (1%) based on the previous value SOCz and the second estimated value SOC. Therefore, it is possible to improve the accuracy of estimating the SOC during the charge or discharge and during the suspension of the charge and discharge.","The second SOC computation unit  according to the present embodiment can compute the open-circuit voltage estimated value Vocell only based on the total voltage Vall. Therefore, it is possible to estimate the SOC from the open-circuit voltage estimated value Vocell without using any equivalent circuit model as in the conventional techniques.","The second SOC computation unit  according to the present embodiment computes the open-circuit voltage estimated value Vocell by the use of the gain unit . Therefore, it is possible to suppress the change in the open-circuit voltage estimated value Vocell after the end of the charge or discharge, and to obtain the stable SOC estimated value (the second estimated value SOC).","The first SOC computation unit  according to the present embodiment controls the first estimated value SOC to be constant when FLG=0. Therefore, it is possible to estimate the SOC even during the period (t) during which the constant-voltage charge or discharge continues and the open-circuit voltage estimated value Vocell can not be estimated.","In the above descriptions, the cell batteries included in the power storage device  are arranged in n series-connected cell batteries by m parallel-connected cell batteries; however, needless to mention, the values of n and m can be also each set to an arbitrary value equal to or larger than 1. Furthermore, values of the computation cycles t to t described above are given only as examples and the computation cycles t to t are not limited to these values. Further, as one example, the value of the gain K shown in  is set to be constant during the period t (0 to 20 seconds) and then gradually decrease. Alternatively, similar effects can be attained even when the state-of-charge estimation apparatus  is configured to, for example, gradually change the value of the gain K from the time (0 second) when the charge or discharge ends.","Second Embodiment",{"@attributes":{"id":"p-0100","num":"0099"},"figref":["FIG. 13","FIG. 3"],"b":["10","10","9","11"]},"As described above, the gains (K and K) for converting the current integration value from the integrator  into the first estimated value SOC are set for the first SOC computation unit . Specifically, the gain K is set for the gain unit  and obtained by K=1\/battery capacity [Ah])\/3600 [sec]\u00d7100 [%]. The gain K is set for the gain unit  and obtained by K=1\/battery capacity [Ah]\u00d73600 [sec]\/100 [%]. The gains K and K change according to the value of the battery capacity [Ah], and therefore an error occurs to the estimated SOC when the value of the battery capacity [Ah] differs from an actual battery capacity.","Therefore, the state-of-charge estimation apparatus  according to the present embodiment is configured to reduce an estimation error in the first estimated value SOC using the battery capacity [Ah] corrected according to the degradation degree of the power storage device , not using the gains K and K derived from a fixed value (a battery capacity) such as a battery nominal value.","In the table , the battery capacity obtained from a charge\/discharge time integration value, a charge\/discharge capacity integration value or the like, that is, the battery capacity corrected according to the reduction in the capacity of the power storage device  is caused to correspond to the gains K and K corresponding to this battery capacity. The first SOC computation unit  computes the first estimated value SOC by the use of the gains K and K corresponding to the corrected battery capacity while referring to the table .","As described above, the state-of-charge estimation apparatus  according to the present embodiment computes the first estimated value SOC by the use of the gains K and K corresponding to the corrected battery capacity. Therefore, it is possible to improve the accuracy of computing the SOC based on the current integration in addition to the advantageous effects of the state-of-charge estimation apparatus  according to the first embodiment.","Third Embodiment",{"@attributes":{"id":"p-0106","num":"0105"},"figref":["FIG. 14","FIG. 7","FIG. 7","FIG. 7"],"b":["24","24","56","57"]},"The gain calculation unit  calculates the gain K that changes in dependence upon a module temperature (a battery temperature) T with the passage of time after the suspension of the charge or discharge in the power storage device . The module temperature T is a temperature of the battery modules obtained from the power storage device  shown in . The multiplier  multiplies the difference from the subtracter  by the gain K from the gain calculation unit . The adder  adds the output from the unit-delay unit  to an output from the multiplier , thereby obtaining the open-circuit voltage estimated value Vocell. In this way, the second SOC computation unit  according to the present embodiment multiplies the output from the subtracter  (the difference of the voltage average value Vcell) by the gain K from the gain calculation unit . It is thereby possible to improve the accuracy of estimating the open-circuit voltage estimated value Vocell even when voltage change characteristics of the power storage device  after the charge or discharge change in dependence upon the module temperature T.","The module temperature T is not limited to the module temperature itself, and may be a temperature of another portion that reflects the battery temperature. Furthermore, the second SOC computation unit  according to the present embodiment may be combined with the first SOC computation unit  according to the second embodiment.","Moreover, information inputted to the gain calculation unit  so as to calculate the gain K is not limited to the module temperature T. Information that changes according to the battery temperature, for example, a value such as current, voltage, or SOC can be used as the information.","As described above, the second SOC computation unit  according to the present embodiment computes the open-circuit voltage estimated value Vocell based on the module temperature T and the total voltage Vall. In this way, the second SOC computation unit  can compute the open-circuit voltage estimated value Vocell according to the change in the module temperature T, so that it is possible to improve the accuracy of estimating the second estimated value SOC in addition to the effects of the second SOC computation unit  according to the first embodiment.","The state-of-charge estimation apparatus  described in the first or second embodiment is configured to select any one of the first estimated value SOC from the first SOC computation unit  and the third estimated value SOC from the SOC sudden-change prevention unit  according to the passage of time since the suspension of the charge or discharge of the power storage device . However, the invention is not limited thereto, and for example, the state-of-charge estimation apparatus  may be configured to exclude the sudden-change prevention unit  and directly input the second estimated value SOC from the second SOC computation unit  to the SOC selection unit . In this case, the SOC selection unit  selects any one of the first estimated value SOC and the second estimated value SOC in accordance with the value of the FLG from the second flag generation unit . Even in this configuration, the second SOC computation unit  can suppress the change in the open-circuit voltage estimated value Vocell after the passage of the period t. Therefore, the change in the open-circuit voltage estimated value Vocell can be more suppressed as compared with the conventional techniques although the effect of preventing the sudden change in the second estimated value SOC as exhibited by the first and second embodiments may not be attained. Therefore, it is possible to improve the accuracy of estimating the second estimated value SOC.","The first SOC computation unit  shown in the first or second embodiment is configured to compute the first estimated value SOC by causing the gain unit  to obtain the cell current average value Icell. Alternatively, the first estimated value SOC may be obtained by integrating the total current Iall without using the gain unit . Furthermore, the second SOC computation unit  described in the first and second embodiments is configured to compute the open-circuit voltage estimated value Vocell by causing the gain unit to obtain the cell voltage average value Vcell. However, the invention is not limited thereto. For example, the open-circuit voltage may be estimated by, without using the gain unit , multiplying the difference between the total voltage Vall and the previous value of the total voltage Vall by the gain, and by adding the output from the gain unit  to the previous value of the total voltage Vall.","The state-of-charge estimation apparatus described in the first to third embodiments are only an example of the present invention, and it is needless to mention that the state-of-charge estimation apparatus can be combined with other well-known techniques, or can be configured with being modified, such as with omitting a part thereof, without departing from the spirit of the present invention.","Industrial Applicability","As described above, the present invention can be applied to apparatuses that estimate an SOC of a secondary battery, and is particularly useful as an invention that can suppress a change in an SOC estimated value even when the battery-voltage measurement accuracy is low and\/or even when a measured voltage has certain ripples.","Reference Signs List",{"@attributes":{"id":"p-0115","num":"0114"},"b":["21","1","2","1","21","2"],"i":["n","n","m "]},{"@attributes":{"id":"p-0116","num":"0115"},"b":["4","1","4","5","1","5","6","1","6","7","1","7"],"i":["k","k","k","k "]},{"@attributes":{"id":"p-0117","num":"0116"},"b":["9","54","54"],"i":["a","b "]},{"@attributes":{"id":"p-0118","num":"0117"},"b":"10"},{"@attributes":{"id":"p-0119","num":"0118"},"b":"11"},{"@attributes":{"id":"p-0120","num":"0119"},"b":"12"},{"@attributes":{"id":"p-0121","num":"0120"},"b":"13"},{"@attributes":{"id":"p-0122","num":"0121"},"b":"14"},{"@attributes":{"id":"p-0123","num":"0122"},"b":"15"},{"@attributes":{"id":"p-0124","num":"0123"},"b":"17"},{"@attributes":{"id":"p-0125","num":"0124"},"b":"18"},{"@attributes":{"id":"p-0126","num":"0125"},"b":"20"},{"@attributes":{"id":"p-0127","num":"0126"},"b":["21","21","21"],"i":["a","b "]},{"@attributes":{"id":"p-0128","num":"0127"},"b":["22","22","22"],"i":["a","b "]},{"@attributes":{"id":"p-0129","num":"0128"},"b":"23"},{"@attributes":{"id":"p-0130","num":"0129"},"b":"24"},{"@attributes":{"id":"p-0131","num":"0130"},"b":"24","i":"a "},{"@attributes":{"id":"p-0132","num":"0131"},"b":"25"},{"@attributes":{"id":"p-0133","num":"0132"},"b":["26","55"]},{"@attributes":{"id":"p-0134","num":"0133"},"b":["41","44","45","51","51","51","52","61"],"i":["a","b"]},{"@attributes":{"id":"p-0135","num":"0134"},"b":["42","57"]},{"@attributes":{"id":"p-0136","num":"0135"},"b":"43"},{"@attributes":{"id":"p-0137","num":"0136"},"b":["53","62"]},{"@attributes":{"id":"p-0138","num":"0137"},"b":"56"},{"@attributes":{"id":"p-0139","num":"0138"},"b":["58","63","64"]},{"@attributes":{"id":"p-0140","num":"0139"},"b":"59"},{"@attributes":{"id":"p-0141","num":"0140"},"b":"71"},{"@attributes":{"id":"p-0142","num":"0141"},"b":["101","101"],"i":["a","b "]},{"@attributes":{"id":"p-0143","num":"0142"},"b":["102","102","104","104"],"i":["a","b","a","b "]},{"@attributes":{"id":"p-0144","num":"0143"},"b":"103"},{"@attributes":{"id":"p-0145","num":"0144"},"b":["105","105"],"i":["a","b "]},{"@attributes":{"id":"p-0146","num":"0145"},"b":"106"},"FLG FIRST FLAG","FLG SECOND FLAG","FLG THIRD FLAG","GB GATE BLOCK","Iall TOTAL CURRENT","Iall* CURRENT COMMAND","Icell CELL CURRENT AVERAGE VALUE","Iallmin CURRENT THRESHOLD","K, K, K GAIN","SOC FIRST STATE-OF-CHARGE ESTIMATED VALUE","SOC SECOND STATE-OF-CHARGE ESTIMATED VALUE","SOC THIRD STATE-OF-CHARGE ESTIMATED VALUE","SOCz PREVIOUS STATE-OF-CHARGE VALUE","T MODULE TEMPERATURE","t COMPUTATION CYCLE OF ENTIRE POWER STORAGE DEVICE","t PERIOD FOR WHICH Vall SUDDENLY CHANGES AFTER CHARGE OR DISCHARGE","t COMPUTATION CYCLE OF SECOND SOC COMPUTATION UNIT","Vall TOTAL VOLTAGE","Vcell CELL VOLTAGE AVERAGE VALUE (VOLTAGE AVERAGE VALUE)","Vocell OPEN-CIRCUIT VOLTAGE ESTIMATED VALUE (OPEN-CIRCUIT VOLTAGE)"],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF DRAWINGS","p":[{"@attributes":{"id":"p-0013","num":"0012"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0014","num":"0013"},"figref":["FIG. 2","FIG. 1"]},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":["FIG. 4","FIG. 3"]},{"@attributes":{"id":"p-0017","num":"0016"},"figref":["FIG. 5","FIG. 3"]},{"@attributes":{"id":"p-0018","num":"0017"},"figref":["FIG. 6","FIG. 3"]},{"@attributes":{"id":"p-0019","num":"0018"},"figref":["FIG. 7","FIG. 3"]},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":["FIG. 9","FIG. 7"],"b":"3"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":["FIG. 10","FIG. 3"]},{"@attributes":{"id":"p-0023","num":"0022"},"figref":["FIG. 11","FIG. 3"]},{"@attributes":{"id":"p-0024","num":"0023"},"figref":["FIG. 12","FIG. 3"]},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 13"},{"@attributes":{"id":"p-0026","num":"0025"},"figref":"FIG. 14"}]},"DETDESC":[{},{}]}
