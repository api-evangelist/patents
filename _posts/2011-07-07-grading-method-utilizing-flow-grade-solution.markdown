---
title: Grading method utilizing flow grade solution
abstract: A method, apparatus, and article of manufacture provide the ability to create a flow-grade solution. In a computer application, a curve from which a slope is to be projected and an elevation field depth buffer, that provides a 2D array with one element for each coordinate, are defined. A slope angle for the slope is specified. As grading shapes are rendered, by sweeping a cone with the slope angle along the curve, a grid is used to capture, into the buffer, an elevation for each vertex of the grid. A flow grade solution represented by the field depth buffer is thus obtained. The flow grade solution includes a path of steepest slope (determined from the elevations stored in the buffer) from any given location in the grid.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08676546&OS=08676546&RS=08676546
owner: Autodesk, Inc.
number: 08676546
owner_city: San Rafael
owner_country: US
publication_date: 20110707
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS-REFERENCE TO RELATED APPLICATIONS","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF THE PREFERRED EMBODIMENTS","CONCLUSION"],"p":["This application is related to the following co-pending and commonly-assigned patent applications, which applications are incorporated by reference herein:","U.S. patent application Ser. No. 13\/178,353, entitled \u201cINTERACTIVELY SHAPING TERRAIN THROUGH COMPOSABLE OPERATIONS\u201d, by Smita Narayan and Christopher E. Putnam, et. al., filed on Jul. 7, 2011; and","U.S. patent application Ser. No. 13\/178,358, entitled \u201cDIRECT MANIPULATION OF COMPOSITE TERRAIN OBJECTS WITH INTUITIVE USER INTERACTION\u201d, by Smita Narayan and Christopher E. Putnam, et. al., filed on Jul. 7, 2011.","1. Field of the Invention","The present invention relates generally to computer aided design (CAD) applications, and in particular, to a method, apparatus, and article of manufacture for interactively shaping a terrain using a flow grade solution in a building information model (BIM) of a CAD.","2. Description of the Related Art","Grading is configuring the land's surface by removing or adding soil and other earthen material to artificially shape the land to best suit a project. The grading of a site serves three basic purposes: functional, drainage, and aesthetic. These basic purposes often conflict with each other and prior art solutions fail to provide an easy mechanism to satisfy all of these purposes while utilizing a single grading model as the user proceeds from concept to completion of a project. Such problems may be better understood with a description of prior art grading and grading solutions.","Functionality: Terrain grading is used to re-form terrain\/land in order to provide land that is functional or can be used for a functional purpose. In this regard, grading reforms the terrain to make it compatible for an intended land use. Such functional land uses may include parking lots, ponds, swales, and other features. To provide for such land use, terrain grading creates finish smooth slopes at specified grades.","Facilitate Drainage: Grading establishes and controls the new drainage pattern to direct the runoff to outfall points and away from buildings.","Aesthetic: A good design creates an aesthetically pleasing and appealing landscape. Natural landforms are created by using concave and convex shaped slopes rather than uniform gradient slopes. The creation of aesthetic landforms must be balanced by the cost of constructing them.","These goals often conflict with each other and to integrate them into the final design, they must be analyzed collectively. In practice, a grading plan is established through several successive trials of different schemes. This process can be very tedious. A grading scheme often involves projecting slopes from curves representing shoulder edges or water boundaries, and leveling them against the existing terrain. The implementation of this concept is fraught with difficulties due to a variety of complex scenarios that could not be handled by a na\u00efve ray projection algorithm, especially when projecting from curves with rapid elevation changes.","More specifically, prior art products provide a grading scheme by projecting each segment of a curve at a given cross-slope to produce bounded panels, and then combining them. Such a methodology involves complex models whose history of operations is difficult to track. The complexity of the existing solution results in difficult software implementations that are error prone, unstable, and may completely fail (if supplied geometry is complicated). Accordingly, users are hesitant to use the prior art product on account of such stability problems. In addition, the existing grading solution does not provide a design based on maximum allowable grade, which may be dictated by soil quality, design standards, and\/or ADA [American with Disabilities Act] guidelines. The prior art also provides few tools for modifying existing solutions in ways that directly map to site development needs. Further, the prior art fails to provide tools that can be used in a conceptual design that can also later be refined or used to generate production drawings. In this regard, it is desirable to provide a tool that can be used to obtain quick answers for early decision making (e.g., approximate values of earthwork quantities) that can be refined later to produce a more accurate solution.","As described above, a particular need is that of designing the terrain to facilitate drainage. The prior art provides a complex methodology that is neither natural nor user friendly. In this regard, the prior art measures the cross grade (or cross slope) perpendicular to the curve from which a slope is projected. Each segment of the curve is projected at a given cross-slope to produce bounded panels that are combined by intersecting them against each other. This approach involves complex algorithms to solve inside corners and the intersection of overlapping solutions. For example, the rapid transitions of offsets across the inside corners cause incomplete or failed 3D intersections of the adjacent, bounded planes. Likewise, a multi-elevation rounded corner projected beyond its radius produces equally complex intersection geometry. The intersections are solved by simplifying the geometry and integrating the solution into planar topology to remove redundant loops. However, stability problems and specialized functionality restrict the use of the prior art methods.","Thus, prior art solutions produce inside corners with complex geometry that is hard to clean, especially if the solutions involve degenerate partial solutions. Solving such inside corners involves complex algorithms and is a cumbersome process. In addition, when designing the drainage, the prior art fails to provide the ability to create or use organic shapes that could be used to produce an aesthetically pleasing landscape.","Moreover, there are few tools for modifying prior art solutions in ways that directly map to site development needs. Even though there is a large set of elevation\/grade editing tools, the overlapping line work can create difficult to resolve stability problems and elevation conflicts. Predicting the impact of an edit to a solution requires experience, and factors like tessellation quality, crossing break lines, and Delaunay triangulation rules can confound a new user.","As described above, the existing solution does not allow the creation of a conceptual model that can later be refined into a more accurate model. In practice, before any detailed grading plans are underway, the designer needs to develop a generalized grading scheme to determine any problem areas and get a feel for the type of limitations the site may have as the design progresses. In the preliminary analysis, engineers are often looking for quick early-stage approximate answers (like road and parking area gradients, drainage patterns, rough estimates of cut and fill quantities, need for steep slopes, retaining walls, etc.) to make quick decisions that can later be refined into production drawings. The prior art fails to provide such capabilities.","In view of the above, it is desirable to enable a single set of tools that can be used from concept through completion, in the same environment, while allowing the user to design a grading solution in a natural and desirable manner.","One or more embodiments of the invention provide a grading method that provides a \u201cflow-grade\u201d solution. An elevation field depth buffer is computed to create an approximate geometry that represents the finished slope. Such a solution is different from a \u201ccross-grade\u201d solution of the prior art. The cross grade (or cross slope) is measured perpendicular to the curve from which the slope is projected. However, a flow grade is measured along the path of steepest descent. Designing by flow grade and direction is more natural and desirable for parking lot design, landfills, and excavation design as it allows the specification of steepest allowable grade (which may be based on design standards and\/or soil quality) and directing drainage along the flow path.","In addition, flow grading produces clean inside corners and requires no special handling due to the way an elevation field depth buffer is defined (see detailed description below). Moreover, the design of embodiments of the invention allows clean overlapping of grading solutions from multiple curves, by combining the depth buffers produced from each curve. A flow-grade design of the present invention may also allow the creation of organic shapes (concave\/convex) by sweeping a truncated cone with a tangent sphere. Further, a flow grade model allows the user to change a grid density to improve the quality of a model at the expense of time to update, thus empowering the user to transition from concept to completion, using the same grading model.","In the following description, reference is made to the accompanying drawings which form a part hereof, and which is shown, by way of illustration, several embodiments of the present invention. It is understood that other embodiments may be utilized and structural changes may be made without departing from the scope of the present invention.","Overview","Embodiments of the invention provide a grading method in the form of a \u201cflow grade\u201d solution that evaluates an approximate geometry of a projected slope using an elevation field depth buffer. The grading shapes are produced by sweeping a cone along the curve from which the slope is to be projected. A grid is used to capture the maximum or minimum elevation seen for each vertex as grading shapes are \u201crendered\u201d to the buffer. The flow grade solution from any given point is a cone with its apex at that point extending at the desired grade to the extents of the grid. Hence, a cone is used to produce the flow grade geometry.","In addition, organic shapes may be created by truncating the cone and replacing the apex with a tangent sphere. Accumulating the values for many such cones along the footprint provides a good approximation to the \u201cflow grade\u201d solution. This process of generating the flow grade solution always produces clean inside corners even when the slope is projected from curves with complex geometry. Embodiments may also handle cross grading solutions gracefully. Simplicity of data access allows many opportunities for performance optimizations through adaptive refinement, multi-threading, and graphics processing unit (GPU) computing. For example, the entire site can be solved in parallel by creating a team of threads where each thread is responsible for solving a small set of grid vertices. Further, embodiments of the invention allow the user to change the grid density to improve the quality of the model at the expense of time to update, thus empowering the user to transition from concept to completion, all in the same environment.","Hardware Environment",{"@attributes":{"id":"p-0029","num":"0028"},"figref":"FIG. 1","b":["100","102","102","102","104","104","104","106","102","114","116","128","102","132"]},"In one embodiment, the computer  operates by the general purpose processor A performing instructions defined by the computer program  under control of an operating system . The computer program  and\/or the operating system  may be stored in the memory  and may interface with the user and\/or other devices to accept input and commands and, based on such input and commands and the instructions defined by the computer program  and operating system  to provide output and results.","Output\/results may be presented on the display  or provided to another device for presentation or further processing or action. In one embodiment, the display  comprises a liquid crystal display (LCD) having a plurality of separately addressable liquid crystals. Each liquid crystal of the display  changes to an opaque or translucent state to form a part of the image on the display in response to the data or information generated by the processor  from the application of the instructions of the computer program  and\/or operating system  to the input and commands. The image may be provided through a graphical user interface (GUI) module A. Although the GUI module A is depicted as a separate module, the instructions performing the GUI functions can be resident or distributed in the operating system , the computer program , or implemented with special purpose memory and processors.","Some or all of the operations performed by the computer  according to the computer program  instructions may be implemented in a special purpose processor B. In this embodiment, the some or all of the computer program  instructions may be implemented via firmware instructions stored in a read only memory (ROM), a programmable read only memory (PROM) or flash memory within the special purpose processor B or in memory . The special purpose processor B may also be hardwired through circuit design to perform some or all of the operations to implement the present invention. Further, the special purpose processor B may be a hybrid processor, which includes dedicated circuitry for performing a subset of functions, and other circuits for performing more general functions such as responding to computer program instructions. In one embodiment, the special purpose processor is an application specific integrated circuit (ASIC).","The computer  may also implement a compiler  which allows an application program  written in a programming language such as Common Business-Oriented Language (COBOL), Pascal, C++, FORTRAN, or other language to be translated into processor  readable code. After completion, the application or computer program  accesses and manipulates data accepted from I\/O devices and stored in the memory  of the computer  using the relationships and logic that was generated using the compiler .","The computer  also optionally comprises an external communication device such as a modem, satellite link, Ethernet card, or other device for accepting input from and providing output to other computers .","In one embodiment, instructions implementing the operating system , the computer program , and the compiler  are tangibly embodied in a computer-readable medium, e.g., data storage device , which could include one or more fixed or removable data storage devices, such as a zip drive, floppy disc drive , hard drive, CD-ROM drive, tape drive, etc. Further, the operating system  and the computer program  are comprised of computer program instructions which, when accessed, read and executed by the computer , causes the computer  to perform the steps necessary to implement and\/or use the present invention or to load the program of instructions into a memory, thus creating a special purpose data structure causing the computer to operate as a specially programmed computer executing the method steps described herein. Computer program  and\/or operating instructions may also be tangibly embodied in memory  and\/or data communications devices , thereby making a computer program product or article of manufacture according to the invention. As such, the terms \u201carticle of manufacture,\u201d \u201cprogram storage device\u201d and \u201ccomputer program product\u201d as used herein are intended to encompass a computer program accessible from any computer readable device or media.","Of course, those skilled in the art will recognize that any combination of the above components, or any number of different components, peripherals, and other devices, may be used with the computer .",{"@attributes":{"id":"p-0037","num":"0036"},"figref":["FIG. 2","FIG. 1","FIG. 1"],"b":["200","202","201","206","202","201","206"]},"A network  such as the Internet connects clients  to server computers . Network  may utilize ethernet, coaxial cable, wireless communications, radio frequency (RF), etc. to connect and provide the communication between clients  and servers . Clients  may execute a client application or web browser and communicate with server computers  executing web servers . Such a web browser is typically a program such as MICROSOFT INTERNET EXPLORER\u2122, MOZILLA FIREFOX\u2122, OPERA\u2122, APPLE SAFARI\u2122, etc. Further, the software executing on clients  may be downloaded from server computer  to client computers  and installed as a plug in or ACTIVEX\u2122 control of a web browser. Accordingly, clients  may utilize ACTIVEX\u2122 components\/component object model (COM) or distributed COM (DCOM) components to provide a user interface on a display of client . The web server  is typically a program such as MICROSOFT'S INTERNET INFORMATION SERVER\u2122.","Web server  may host an Active Server Page (ASP) or Internet Server Application Programming Interface (ISAPI) application , which may be executing scripts. The scripts invoke objects that execute business logic (referred to as business objects). The business objects then manipulate data in database  through a database management system (DBMS) . Alternatively, database  may be part of or connected directly to client  instead of communicating\/obtaining the information from database  across network . When a developer encapsulates the business functionality into objects, the system may be referred to as a component object model (COM) system. Accordingly, the scripts executing on web server  (and\/or application ) invoke COM objects that implement the business logic. Further, server  may utilize MICROSOFT\u2032S\u2122 Transaction Server (MTS) to access required data stored in database  via an interface such as ADO (Active Data Objects), OLE DB (Object Linking and Embedding DataBase), or ODBC (Open DataBase Connectivity).","Generally, these components - all comprise logic and\/or data that is embodied in\/or retrievable from device, medium, signal, or carrier, e.g., a data storage device, a data communications device, a remote computer or device coupled to the computer via a network or via another data communications device, etc. Moreover, this logic and\/or data, when read, executed, and\/or interpreted, results in the steps necessary to implement and\/or use the present invention being performed.","Although the term \u201cuser computer\u201d, \u201cclient computer\u201d, and\/or \u201cserver computer\u201d is referred to herein, it is understood that such computers  and  may include portable devices such as cell phones, notebook computers, pocket computers, or any other device with suitable processing, communication, and input\/output capability.","Of course, those skilled in the art will recognize that any combination of the above components, or any number of different components, peripherals, and other devices, may be used with computers  and .","Software Embodiments","Embodiments of the invention are implemented as a software application on a client  or server computer . As described above, such a software application provides a grading method in the form of a \u201cflow grade\u201d solution that evaluates an approximate geometry of a projected slope using an elevation field depth buffer.","A \u201cflow grade\u201d is measured along the gradient line of a surface and involves the evaluation of an approximate geometry of a projected slope using an elevation field depth buffer. Evaluating the approximate geometry in this manner can be used to satisfy maximum allowed slope requirements that are not possible with prior art cross-grade solutions.","As an overview, to compute the elevation field depth buffer, a grid is used to capture the maximum or minimum elevation seen for each vertex as grading shapes are \u201crendered\u201d to the buffer. The \u201cflow grade\u201d solution from any given point may be considered as a cone with its apex at that point extending at the desired grade to the extents of the grid.  illustrates a cone  (having a desired slope ) that is swept along a curve  from which the slope  is to be projected. Accumulating the values for many such cones  along the footprint provides a good approximation of the flow grade grading solution. Cones  may be used in embodiments of the invention (although other shapes may also be used) as a cone  represents a flow grade solution for all locations from that point. By adding more cones  and keeping only the top part of each cone , the approximate\/simulated solution approaches the true solution.","More specifically, the elevation field depth buffer is a two-dimensional (2D) array (x-y) with one element for each coordinate. Each element of the buffer captures the maximum elevation (or minimum elevation depending on the direction of the slope) seen for each vertex as grading shapes are \u201crendered\u201d to the buffer. The grading shapes are generated by sweeping a cone  with a desired slope  along a curve  from which the slope  is to be projected. As the cones  are rendered, the elevations at grid points are stored in the buffer. When another cone  is rendered at the same location, the two elevations are compared and the elevation with the maximum value is saved to the elevation buffer, replacing the old value. If the cone  is inverted, the minimum elevation is chosen.","From a given location in the buffer, a cone  represents a flow grade solution (path of steepest slope). Thus, in the end, the depth buffer allows the user to correctly reproduce the flow grade solution. The quality of the result can be controlled by changing the granularity of the depth buffer\/grid.","Advantages of Flow-Grade Solution","Designing by flow grade may serve three primary purposes:","(1) Slope Requirements: It allows the user to specify maximum allowable grade dictated by soil quality, design standards and ADA guidelines. Further, interior corner cleanups may be handled gracefully;","(2) Aesthetic: By replacing the apex of the swept cone  with a tangent sphere, the method allows the user to create concave\/convex-shaped slopes  that are visually appealing; and","(3) Concept to Completion: The user can start with coarse grids to obtain quick approximate answers in the planning stage, and refine the same model by increasing the grid density and adding details, to get accurate estimates of volumes, etc. (at the expense of time to update). Further, the simplicity of data access (e.g., via grid based methods) allow many opportunities for performance optimizations through adaptive refinement, multi-threading, and other forms of optimization.\n\nLogical Flow\n",{"@attributes":{"id":"p-0050","num":"0049"},"figref":"FIG. 4"},"At step , a computer-aided design (CAD) building information modeling (BIM) application is used to define a curve from which a slope is to be projected.","At step , an elevation field depth buffer is created. The buffer is a two-dimensional (2D) array with one element for each (x-y) coordinate in the 2D array.","At step , a slope angle is specified for the slope. This is the angle of steepest descent that the user desires.","At step , one or more grading shapes are rendered by sweeping a cone with the slope angle along the curve. The placement of the cone relative to curve is determined by the direction of the slope. For example, the cone is held erect with apex at the top if the slope is to be projected downward. The cone is held inverted with the apex at the bottom if the slope is to be projected upward. The sweeping action involves sweeping the apex of the cone along the curve while the cone is held vertical (upright or inverted).","At step , as the one or more grading shapes are rendered for each position of the cone along the curve, a grid is used to capture, into the field depth buffer, an elevation for each vertex of the grid. The elevation is captured into the field depth buffer if the elevation comprises either a maximum or a minimum elevation (depending on the direction of the slope) for the vertex. In other words, when a point of the cone is rendered at a vertex of the grid where an elevation was previously captured, the point elevation of the point of the cone is compared to the previously captured elevation. The greater\/lesser (depending on whether a minimum or maximum is utilized) of the point elevation and the previously captured elevation is captured into the field depth buffer. This process is repeated with every subsequent cone rendered at the given grid vertex. In the end, the depth buffer represents an approximate flow grade solution.","At step , a flow grade solution (represented by the field depth buffer) is obtained after capturing the elevations from the last cone position. The flow grade solution provides\/specifies\/includes a path of steepest slope from any given location in the grid. Further, the flow grade solution represents an approximate geometry of the slope projected from the curve. Such a path of steepest slope is determined from the elevation stored for each vertex of the grid in the field depth buffer. Contours (curves of constant elevations) may be drawn by interpolating the grid elevations (stored for each vertex of the grid in the field depth buffer), and the flow path from a given point may be determined by following a path perpendicular to the contours. In designing the flow grade solution, the granularity of the grid may be modified to control the precision of results. For example, the user can start with coarse grids to get quick approximate answers in the planning stage, and refine the same model by increasing the grid density, to get an accurate estimate of volumes, etc. (i.e., the granularity of the grid is modified to change a precision of the results). Such a modification may enable the use of a single grading model from concept of the grading model, used for preliminary analysis, to completion of the grading model, in a form of production drawings.","While generating\/rendering grading shapes at step , an apex of the swept cone may be replaced with a tangent sphere to create a concave\/convex shaped slope (where a result is used for representing organic shapes). This shape can be utilized for representing natural landforms, like swales and berms. In addition, the grade of the cone can be changed as it is swept along the curve to produce a flow grade solution with grades that transition along the curve. This method of generating flow grade solution always produces clean inside corners due to the way the elevations are captured at step . The flow grade solution is also scalable to multiple curves. In this regard, overlapping solutions can be created by updating the field depth buffer with elevations from a second curve. No special handling of overlapping geometry is required due to the way field depth buffers can be combined. Thus, a second cone with\/having a second slope angle may be swept along a second curve while updating elevations in the field depth buffer (during the sweep operation). Accordingly, clean intersection geometry for overlapping solutions may be produced based on a combining of the field depth buffers. The order of depth buffers can be altered to control the resulting overlapping geometry, according to user's intent.","Further, step  may also include the outputting or utilization of the flow grade solution. Such an outputting\/utilization of the flow grade solution may include the display (using contours or solid-shaded views in 2D or 3D view), printing, and\/or transmission of the flow grade solution. Alternatively, or in addition, the flow grade solution may be used by engineers, designers, etc. to grade terrain, establish drainage patterns and design parking lots, ponds, landfills, aesthetic landforms like organic swales and embankments, etc.","This concludes the description of the preferred embodiment of the invention. The following describes some alternative embodiments for accomplishing the present invention. For example, any type of computer, such as a mainframe, minicomputer, or personal computer, or computer configuration, such as a timesharing mainframe, local area network, or standalone personal computer, could be used with the present invention.","The foregoing description of the preferred embodiment of the invention has been presented for the purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise form disclosed. Many modifications and variations are possible in light of the above teaching. It is intended that the scope of the invention be limited not by this detailed description, but rather by the claims appended hereto."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Referring now to the drawings in which like reference numbers represent corresponding parts throughout:",{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 4"}]},"DETDESC":[{},{}]}
