---
title: Scalable WLAN gateway
abstract: A technique for combining transmission bandwidths of several mobile stations (MS, MS) is disclosed. A master mobile station (MS) establishes (-) a WLAN base station communicating with WLAN client terminals (CT). One or more slave mobile stations (MS) may detect a predefined network identifier and join the WLAN network. The master (MS) assigns IP addresses for the client terminals (CT) and slave mobile stations (MS). The master also resolves DNS queries in cooperation with external DNS servers. Traffic, including internet packets (IP-IP), between the client terminals and various internet hosts (HO) is tunneled over multiple simultaneous transmission paths (----) between the master (MS) and a multiplexing/demultiplexing computer (SM). The inventive bandwidth combination technique is transparent to the client terminals (CT) and the internet hosts (HO).
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08064418&OS=08064418&RS=08064418
owner: Joikusoft Ltd.
number: 08064418
owner_city: Espoo
owner_country: FI
publication_date: 20081216
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["CROSS REFERENCE TO RELATED APPLICATION","FIELD OF THE INVENTION","BACKGROUND OF THE INVENTION","BRIEF DESCRIPTION OF THE INVENTION","DETAILED DESCRIPTION OF SPECIFIC EMBODIMENTS","REFERENCES"],"p":["The present application claims priority of Finnish Patent Application 20080345, filed May 9, 2008.","The invention relates to methods, apparatuses and software products for providing a wireless broadband internet connection via a mobile communication network. In the context of the present invention, a broadband connection means a connection capable of transmitting traffic, in good network conditions, faster than a V.90 modem can, or faster than 64 kilobits per second.","Wireless broadband modems can be used to couple personal computers or client terminals to the internet in places where wired internet connections or local-area networks are not available. Prior art wireless broadband modems exhibit certain problems. For instance, sharing a single wireless broadband connection among several users (client terminals) is awkward at best. Normally this requires setting up one of several client terminals as a master terminal that provides the internet connection to the remaining client terminals. This process consumes resources of the master terminal and the client terminals cannot operate without the master. The difficulty of sharing a single wireless broadband connection among several users is understandable in view of the fact that most wireless broadband modems are given or sold at a nominal cost by mobile network operators in connection with a network subscription. The network operators' obvious desire is to sell a subscription to each user instead of sharing a single connection among several users. Another problem of prior art wireless broadband modems is the fact that most of them are \u201cwireless\u201d only towards the mobile network and the connection to the client terminal takes place via a USB cable. The wired connection is actually a benefit in connection with fixed client terminals, such as home computers, because the wired connection can also supply power to the wireless broadband modem, but in connection with mobile client terminals, the wired nature of the USB connection is a definite handicap. Yet another problem is that the bandwidth provided by the mobile station and access network may be insufficient, particularly when several client terminals share a single wireless broadband connection.","An object of the invention is to develop a method, an apparatus and software products so as to alleviate one or more of the problems identified above. The object is achieved by methods, apparatuses and software products as defined in the attached independent claims. The dependent claims and the drawings with their associated descriptions relate to specific embodiments.","An aspect of the invention is a mobile station having an enhanced functionality for acting as a wireless local-area network (\u201cWLAN\u201d) gateway. Such a gateway mobile station comprises a memory for storing applications and data; a processor for executing the stored applications; a user interface comprising an input section and an output section; reception\/transmission circuitry for providing a communication interface to one or more access networks; authentication means operable to authenticate a user of the mobile station; a radio transceiver operable to establish and maintain a broadband connection with a mobile communication network in response to a successful authentication of the user of the mobile station; and wireless WLAN means responsive to an activation or deactivation command according to a setting received via the input section of the user interface. The inventive mobile station comprises program code segments for instructing the processor to control the following operations:\n\n","Other aspects of the invention include a method for operating the above-specified mobile station and a software carrier comprising a software application for a mobile station, wherein the software application comprises the above-specified program code segments.","Yet other aspects of the invention include a multiplexing\/demultiplexing computer for multiplexing (combining) data packets from the above-specified multiple simultaneous transmission paths to an internet host, and for demultiplexing (splitting) data packets arriving from the internet host to the multiple simultaneous transmission paths. Later in this description the multiplexing\/demultiplexing computer is colloquially called a \u201cShareMachine\u201d.","In one specific embodiment the mobile station further comprises means for receiving, installing and executing downloadable programs and the inventive gateway application is a downloadable application. Implementing the inventive gateway application as a downloadable application provides the added benefit that the inventive technique is applicable to mobile stations which are physically capable of performing the inventive method but do not contain the necessary software.","In another specific embodiment the gateway application further comprises a code portion to redirect a first HTTP page request from each mobile station during an internet session to a predetermined internet address. Redirecting the mobile station's first HTTP page request during an internet session provides the owner of the predetermined internet address with the benefit that the mobile station user must begin an internet session via the predetermined internet address. That address may contain useful information or advertisements, for example.","Yet another specific embodiment is a gateway application for a mobile station, wherein the mobile station comprises a GPS receiver or other means for determining the mobile station's location, and the gateway application comprises a code portion for associating the determined location to the tunneled internet traffic. The gateway application and\/or some internet-based supplementary server(s) may use the determined location to produce one or more additional or supplementary services to the WLAN terminal.","The gateway application may further comprise a code portion for collecting traffic statistics in respect of the tunneled traffic and for transmitting at least some of the collected traffic statistics to an advertising server and\/or billing server, so as to use the traffic statistics for advertising and\/or billing.","In order to minimize battery consumption, the gateway application may direct the mobile station's processor to set up timer functions, such that a sleep timer periodically activates the WLAN circuitry and a watchdog timer deactivates the WLAN circuitry in response to a detected absence of WLAN terminal activity for a predetermined period of time.",{"@attributes":{"id":"p-0026","num":"0032"},"figref":"FIG. 1","b":"1"},"As used herein, a gateway means an interface point between one or more WLAN client terminals on one hand and one or more mobile access networks on the other hand. A scalable gateway means a gateway arrangement which is capable of providing a dynamically varying number of simultaneous parallel transfer paths over one or more mobile access networks, such that data packets belonging to the same internet connection between a client terminal and the host are multiplexed (combined) and demultiplexed (divided) at the ends of the simultaneous parallel transfer paths.","According to the present invention, the scalable gateway is established and managed by a master mobile station MS. The scalable gateway established by the master mobile station MS may be subsequently joined and supported by zero or more slave mobile stations MS. A slave mobile station MS, when present, may join the WLAN network WN established by the master mobile station MS and support its operation by providing multiple radio interface paths, thus increasing bandwidth. Slave mobile stations MS may also detach from the gateway without causing any other harm than a corresponding reduction in bandwidth. The expression \u201czero or more slave mobile stations\u201d means that the master mobile station MS can provide gateway operations by itself, but increased bandwidth may be provided by one or more slave mobile stations MS.","The master and slave mobile stations MS, MS can be identical in terms of hardware and software, and any mobile station in which the inventive scalable gateway application is executed first checks if an ad-hoc WLAN network is already established by another mobile station. For example, WLAN networks offering the inventive gateway functionality can be detected on the basis of the WLAN SSID identifier. If the mobile station detects an already-established WLAN network, it assumes the role of a slave mobile station. If an already-established ad-hoc WLAN network is not detected, the inventive mobile station establishes the WLAN network itself and assumes the role of the master mobile station for that WLAN network. For reasons of clarity,  shows only one slave mobile station MS, but the invention is not restricted to any particular number of mobile stations.","The invention is ideally implemented such that the master mobile station MS and slave mobile station(s) MS are coupled to different base stations BS, BS, . . . . Operation via multiple different base stations helps ensure that the cellular radio interfaces between mobile stations and base stations do not constitute bottlenecks. For instance, such coupling to different base stations can be ensured by providing the various mobile stations MS, MS with SIM cards (Subscriber Identity Module) of different access network operators. The access networks AN, AN typically comprise gateway GPRS support nodes GGSN, GGSN for connecting to data networks DN, such as the internet.","Because different packets transmitted between a client terminal CT and a host HO may be propagated via multiple base stations BS, BS and access networks AN, AN, rules and schemes for packet routing must be defined. For instance, it must be decided whether packets transmitted via the multiple base stations and access networks are routed at the client terminal(s) CT or the mobile station(s) MS, MS. Currently there are commercially available mobile stations, which are provided with WLAN client software, and one way to implement packet routing is to perform the routing in the client terminal(s) CT, such that a transmitting client terminal sends packets to the first available mobile station, the next packet to the next available mobile station, and so on. A benefit of this routing scheme is that it eliminates packet forwarding among the mobile stations. On the other hand, implementing the packet routing in the client terminal(s) requires modifications to the protocol stacks in the client terminal(s), which is why the present invention is based on the idea that packet routing via the multiple mobile stations MS, MS is performed in the mobile stations. Performing packet routing in the mobile stations provides the benefit that the scalable gateway is almost completely transparent to the client terminal(s), and\u2014as seen from the client terminal(s)\u2014the only change caused by the invention is increased bandwidth.","It is worth noting that performing packet routing in the mobile stations is far from trivial, however. This means that the mobile stations must send, or they should send, individual packets to one another. But a large portion of currently available smart telephones are based on Symbian\u00ae 60 or 80 platforms, and current implementations of Symbian\u00ae 60 or 80 platforms do not support it. In other words, mobile stations based on Symbian\u00ae 60 or 80 platforms cannot send individual packets to one another over the WLAN network. This limitation could be overcome by performing the packet routing in the client terminal(s) but, as stated earlier, this requires modifications to the protocol stacks. The inventor has found out, however, that it is not necessary to send the packets as point-to-point transmissions, and the limitation of Symbian\u00ae 60 or 80 platforms can be overcome by sending the packets in multicast transmissions, as will be explained in more detail in connection with .",{"@attributes":{"id":"p-0033","num":"0039"},"figref":"FIG. 1","b":["1","2","1"]},"Various measures may be taken to enhance data security and overall system robustness. For instance, virtual private network (VPN) technology may be utilized for some legs of the connections between the client terminals CT and the internet hosts HO. In one implementation, a VPN is established for each connection section between a mobile station MS, MS and a ShareMachine computer SM. In this implementation the client terminals CT and the internet hosts HO do not need to establish the VPN and, apart from the increased bandwidth, the invention is transparent to them. System robustness may be enhanced by implementing the ShareMachine and SuperHead computers SM, SH in a distributed manner, as will be explained in detail in connection with .",{"@attributes":{"id":"p-0035","num":"0041"},"figref":"FIG. 2"},"For acting as a unitary (non-scalable) gateway, the mobile station MS comprises a central processing unit CP  and memory . In addition, the mobile station MS comprises or utilizes external input-output circuitry  which constitutes the mobile station's user interface and comprises an input circuitry  and an output circuitry . The input circuitry  comprises the mobile station's microphone and user-input device, such as a keypad and\/or touch screen. The output circuitry  comprises the mobile station's display and earphone or loudspeaker. The mobile station MS further comprises reception\/transmission circuitry  which comprises a transmission circuitry , reception circuitry  and antenna . A subscriber identity module, SIM,  is used by an authentication function  to authenticate the mobile station user and to identify the user's subscription to the access network. The mobile station also comprises WLAN (Wireless Local Area Network) circuitry  whose normal mode of usage is acting as a WLAN client to a WLAN base station (not shown).","In order to support installable program modules, the mobile station's memory MEM  may comprise routines for downloading installable program modules and for storing the installable program modules in the memory MEM for execution by the central processing unit CP.  shows an arrangement in which the mobile station is configured to download installable program modules from a repository RP via a data network DN, an access network AN, the antenna  and reception circuitry , although other arrangements are equally possible, such as downloading the installable program modules via the data network DN to a client terminal CT, from which the installable program modules are transferred to the mobile station the WLAN circuitry  or via some other short-range connection, such as Bluetooth or Universal Serial Bus (USB, not shown separately). The access network AN is typically a broadband-capable mobile communication network, while the data network DN is typically the internet or some closed subnetwork implementing internet protocol (IP), commonly called intranets or extranets. At this level of generalization, all previously-discussed elements of  can be conventional as used in the relevant art. One or more external hosts are accessible via the access network AN and data network DN, as will be described in more detail below. Finally, reference numeral  denotes an area of the memory  used to store parameters and variables.","The foregoing description of  describes an applicable mobile station in technical terms. Such mobile stations are commercially available: For instance, at the priority date of the present invention, mobile stations based on Symbian S60 or S80 platforms can be used, provided that they support WLAN and broadband communications. A departure from prior art mobile stations can be seen in the fact that the mobile station comprises the inventive gateway application , either as a factory-installed software application or as a downloadable application. The client terminals CT resemble laptop computers or smart telephones, but those skilled in the art will realize that the mobile station MS provided with the inventive gateway application  supports virtually any client terminal capable of acting as a WLAN client, personal digital assistants, home entertainment devices, digital cameras, etc., to name just a representative sample of applicable device types.","Within the gateway application , reference numeral  collectively denotes program-implemented functions which are used to operate the mobile station as a non-scalable gateway which provides one radio interface to one or several client terminals. These functions, which will be described in connection with , include establishment of an ad-hoc WLAN network, generation of a beacon ID, IP address assignment and discovery (eg DHCP), domain name services (DNS) in cooperation with external domain name servers, multi-protocol support and roaming support. The multi-protocol support functionality may include a Network Address & Port Translation (NAPT) block which translates the source and destination addresses. Translation of port numbers may be used to identify various connections to or from the same IP address. A detailed conversion example will be described in connection with .","Reference numeral  collectively denotes program-implemented functions which are used to operate the mobile station as a scalable gateway which coordinates provision of multiple radio interfaces to one or several client terminals. These functions, which will be described in connection with , include a multicasting function, which includes packet multicast transmission and signalling in the WLAN network, packet delivery and signalling between a master mobile station and a slave mobile station, and a communication function for communicating with SuperHead and ShareMachine computers.",{"@attributes":{"id":"p-0041","num":"0047"},"figref":"FIG. 3","b":["305","310","330","315","320","325"]},"The nature of the user interface depends on which kind of computer is used to implement the ShareMachine computer SM. If the ShareMachine computer is a dedicated computer, it may not need a local user interface, such as a keyboard and display, and the user interface may be a remote interface, wherein the ShareMachine computer is managed remotely, such as from a web browser over the internet, for example. On the other hand, it is expected that some access network operators may display a hostile attitude to the pre-sent invention in general and the ShareMachine computers in particular, because the present invention makes it possible to share one or a few access network subscriptions among a larger number of client terminals. Thus some network operators may attempt to block the operation of the ShareMachine computers. In order to improve the robustness of the invention, a relatively large number of potential ShareMachine computers may be involved. Conventional home computers are prime examples of potential ShareMachine computers. In that case, the user interface should be a local interface, including a display, keyboard and pointing device, although for the purposes of the pre-sent invention, the user interface is primarily needed to launch the software application  which makes an appropriate computer (hardware-wise) into the inventive ShareMachine computer. In addition, the user interface may be utilized for obtaining traffic statistics. Reference numeral  denotes an area of the memory  used to store parameters and variables.","The ShareMachine computer's software application  comprises program code for instructing the processor to execute the following functions. A signalling function permits the ShareMachine computer to discover participating elements, such as gateway mobile stations. A SuperHead communication function enables communication with a SuperHead computer (in XML over HTTPS, for example). An optional configuration\/reporting function enables configuration of the ShareMachine computer and traffic statistics reporting via a user interface, which may be a local user interface or a remote user interface. A packet management function performs packet packing\/unpacking and multiplexing\/demultiplexing as well as NAT\/NAPT (Network Address (and Port) Translation) operations. A DNS function permits the ShareMachine computer to participate in DNS operations with pre-existing internet-based DNS servers.",{"@attributes":{"id":"p-0044","num":"0050"},"figref":["FIG. 4","FIG. 3"],"b":["305","330","370"]},"A ShareMachine communication function enables communication with ShareMachine computers (in XML over HTTPS, for example). A ShareMachine management function enables keeping track of ShareMachine computers and prioritisation of them according to various operating parameters and IP addresses, which are to be communicated to Gateway Mobile Stations. An optional configuration\/reporting function enables configuration of the SuperHead computer and traffic statistics reporting via a user interface, which may be a local user interface or a remote user interface.",{"@attributes":{"id":"p-0046","num":"0052"},"figref":["FIG. 5","FIG. 5"],"b":["5","0","5","0","5","40"]},"In step - the gateway application instructs the mobile station's processor to prepare an ad-hoc WLAN network around the mobile station, by acting as a WLAN base station (as opposed to the mobile station's more conventional usage as a WLAN client). In step - the gateway application instructs the mobile station to initiate broadcasting of a beacon ID message, which typically is an IBSSID message as defined in standard IEEE 802.11x. Step - is depicted as an arrow, but in practice the broadcasting of the beacon ID message should be repeated until step - in which the execution of the gateway application is terminated.","In step - the client terminal CT searches for available WLAN networks and detects the broadcasted beacon ID and selects the WLAN network created by the mobile station MS. In step - the client terminal CT, as part of a conventional WLAN attach procedure, requests an IP address from the mobile station's WLAN base station, which returns the requested IP address in step -. Dynamic Host Configuration Protocol (DHCP) is typically used for steps - and -.","Let us assume that the client terminal CT tries to retrieve a web page from the internet host (item  in ). In step - the client terminal CT sends a domain name service (DNS) query for the IP address of the host's web page to the DNS server of the mobile station's gateway application. In step - the mobile station's gateway application forwards the DNS query to internet's domain name service and obtains the host's IP address in step -. In step - the mobile station's gateway application returns the host's IP address to the client terminal CT.","In step - the client terminal CT requests a web page from the host's IP address. Hypertext Transfer Protocol (HTTP) is typically used for this purpose. This request, like any communication between the client terminal CT and any internet hosts, takes place via the inventive gateway application being executed in the mobile station.","Step - is an optional step which may be omitted in some embodiments. When performed, step - comprises redirecting the first HTTP page request from client terminal CT to another internet host, called Host\u2032. This means that in step - the gateway application forces the client terminal's first HTTP page request to a forced home page at the IP address of Host\u2032. For example, the operator of the site Host\u2032 may display advertisements in exchange of sponsoring communication costs over the access network AN. In step - the web site Host\u2032 returns the requested web page, which the gateway application relays to the client terminal CT in step -.","In step - the client terminal CT again requests the web page from the host's IP address. Since this the second (or further) page request from the client terminal, the gateway application no longer redirects the HTTP request but relays it to the Host in step -. In steps - and - the requested web page from the Host is transmitted to the client terminal. As shown by arrow , the process can return from step - to step - when future web pages are requested. The loops - through - can be repeated until the gateway application is terminated in step -. If the forced home page feature (step -) is not implemented, the first HTTP request (step -) is processed similarly to the subsequent HTTP requests (step -). In subsequent executions of step -, if the HTTP page request relates to a web page for which the gateway application does not have an IP address, a DSN query will be performed (cf. steps - and -).",{"@attributes":{"id":"p-0053","num":"0059"},"figref":"FIG. 5","b":["5","6","5","36"]},{"@attributes":{"id":"p-0054","num":"0060"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0055","num":"0061"},"figref":["FIG. 6","FIG. 2","FIGS. 1 and 5","FIGS. 6 through 8"],"b":["1","2","1","2","270","272","274","1","2","1","2"]},"In step - the client terminal CT requests an IP address from the master MS in an DCHP Discover( ) procedure. In step - the master MS sends the client terminal CT the requested IP address. In the present example, the master MS, whose own IP address of is 192.168.1.1, offers the client terminal the next available IP address, which is 192.168.1.2. In step - the mobile station MS, having detected that an ad-hoc WLAN network already exists, requests an IP address from the master MS. In the example shown, the master MS grants in step - the slave MS an IP address of 192.168.2.1, which in this example is derived from the masters' own IP address by setting the third octet to the next available number. In other words, the slave mobile station MS is assigned a subnet of its own. This implementation provides certain benefits as regards optimization of resource utilization. For instance, the slave mobile station MS may act as a WLAN gateway to some of the client terminals, whereby it is not necessary to route all traffic via the master mobile station MS.","It should be noted that in a typical environment the IP address lease time cannot be very long because the ad-hoc network does not indicate when a slave mobile station leaves the network. After a mobile station leaves the network, the gateway and subnet addresses should be renewed quickly. In a typical environment, in which the mobile stations are not dedicated to gateway service, the IP lease time is preferably no more than a few minutes.",{"@attributes":{"id":"p-0058","num":"0064"},"figref":["FIG. 7","FIG. 1","FIGS. 5 and 6"],"b":["1","2","7","0","1","2","1"]},"In steps - and - the client terminal CT sends two IP packets IP and IP to the master MS. The ultimate destination of the IP packets is the internet Host HO. The master MS thus acts as the client terminal's only access point to the internet. In step - the master MS sends the first IP packet IP as an UDP packet to the ShareMachine computer SM. Any intervening access networks are omitted for clarity, but they are shown in . In step - the master MS multicasts the second IP packet IP as an UDP packet, and the slave MS captures the multicast transmission. In step - the slave MS sends the second IP packet IP as an UDP packet to the ShareMachine computer SM. In steps - and - the ShareMachine computer SM sends the IP packets IP and IP to the Host. In the example described herein, UDP packets were used for efficiency's sake. If better robustness is desired and some efficiency can be sacrificed, TCP protocol may be used instead.","For the purposes of , it suffices that the master gateway mobile station MS somehow knows or obtains the address of the ShareMachine computer SM. For instance, in a simple implementation the master MS or its user may utilize an internet search engine to discover addresses of available ShareMachine computers. An enhanced procedure for obtaining the ShareMachine computer's address from a SuperHead computer will be described in connection with .","The reason for using multicast over point-to-point transmission is that Symbian\u00ae S60 or S80 platforms, which a large portion of current WLAN-equipped mobile stations are based on, do not provide an Application Programming Interface (API) function to access the Media Access Control (MAC), or device hardware, layer by individual packets. Resorting to the multicast transmission in the WLAN network provides a workaround solution for this problem.","In one specific implementation the overhead due to multitasking is reduced by setting a flag in the first (master) mobile station\/gateway, such that the slave mobile stations\/gateways do not have to unpack each packet to see its destination. The multitasking operation also compensates for the fact that packet loss is a definite handicap in mobile access networks. As a result of the multicast transmission via multiple alternative routes, the likelihood of at least one successful packet delivery is increased. In addition, the multitasking operation increases robustness of the ad-hoc WLAN network. If one of the slave mobile stations\/gateways disappears from the WLAN network, the packets may still survive.","In the scenario shown in , the master MS sends the first IP packet IP to the ShareMachine computer SM directly, while the second IP packet IP is sent via the slave MS. The next IP packet (not shown) will be sent directly again, and so on, in order to achieve load balancing among the gateways MS, MS and the access networks AN, AN (see ). It is possible that, as a result of the overhead caused by sending some packets via the slave(s) and\/or varying delays in the access networks, the ShareMachine computer SM receives some packets out of sequence, and packet IPn will be received after packet IPn+1. Thus the ShareMachine computer SM should be able to buffer packets coming out of sequence until it has received all the packets it needs to forward them to the Host in the correct sequence. The ShareMachine computer SM may employ a protocol watchdog timer that raises an alert if some packet is not received for a predetermined period of time, in which case the ShareMachine computer SM may request retransmission of the packets starting from the last properly received packet.","In steps - through -, two internet packets IP and IP are sent from the Host, via the ShareMachine computer SM and the gateways MS, MS, to the client terminal CT. Based on the preceding the description of the reverse direction, the packet transmission from the Host to the client terminal CT is mostly self-explanatory and a detailed description is omitted. In this case the slave MS must send the packet IP over multicast transmission to the master MS, and it is the task of the master MS to assemble the packets in the correct sequence, by requesting retransmission if necessary.","The embodiment described herein provides the benefit that the operation of the inventive scalable gateway is completely transparent to the client terminal CT and the Host, which need no modifications whatsoever and which can only detect an increased transmission speed.",{"@attributes":{"id":"p-0066","num":"0072"},"figref":"FIG. 8","b":["1","2"]},"As shown near the top of , the primary IP address assigned to the network elements CT, MS, MS, SM and HO are denoted by a suffix \u201cIP\u201d after the reference sign of the respective network element. For example, CT IP is the IP address assigned to the client terminal CT. The master and slave gateway mobile stations MS and MS also employ a secondary IP address each, and these are denoted with a prime after the \u201cIP\u201d suffix. For example, MS IP\u2032 is the secondary IP address assigned to the master gateway mobile station MS. The secondary IP addresses of the mobile stations are used for the communication between the mobile stations MS, MS and the ShareMachine computer SM. In one representative implementation, the mobile stations' primary IP addresses MS IP and MS IP are assigned from the sub-network of the master mobile station MS, while the secondary IP addresses MS IP\u2032 and MS IP\u2032 are public IP addresses assigned by the mobile stations' respective access network operators.","In the initial state -, an ad-hoc WLAN network has been established and a DHCP procedure has been performed. The remaining steps of  constitute four major phases, which are transmitting a first packet U and a second packet U from the client terminal CT to the host HO (called uplink transmission) and transmitting a first packet D and a second packet D from the host HO to the client terminal CT. Addressing details of the messages and operations shown in  are compiled into table 1.","Steps - through - relate to the transmission of the first uplink packet U from the client terminal CT to the host HO. In step - the client terminal CT sends the packet U to the master mobile station MS. As shown in Table 1, the packet U is an Ethernet packet over the WLAN network established by the master mobile station MS. The source and destination addresses of the packet U are the MAC addresses of the master mobile station MS. The packet's payload contains IP Data, as transmitted by the client terminal. Table 1 also contains a second row entry for the step -, and this means that there is an IP packet encapsulated within the Ethernet packet. The IP packet's source and destination addresses are the IP addresses of the client terminal CT and host HO, respectively. Step - is an optional header packing step, the purpose of which is to optimize the use of the radio interface bandwidth. In the scenario shown in , the master mobile station MS does not send the first packet U directly to the ShareMachine computer SM but via the slave mobile station MS. Accordingly, step - comprises sending the packet U as a multicast transmission, which involves sending from the MAC address of MS an Ethernet packet into which is encapsulated an UDP packet. The UDP packet, in turn, contains the actual IP packet, as shown in Table 1. The slave mobile station MS, having received the multicast transmission, sends the UDP packet to the IP address of the ShareMachine computer SM in step -. The header unpacking step - reverses the effect of the header packing step -. In step - the NAPT block of the ShareMachine computer SM performs Network Address Translation on the packet U. After the Network Address Translation, in step -, the ShareMachine computer SM sends the first uplink packet U to the host HO.","Steps - through - relate to the transmission of the second uplink packet U from the client terminal CT to the host HO. The transmission of the second uplink packet U is simpler than the transmission of the first uplink packet U in that the packet U is sent directly from the master mobile station MS to the ShareMachine computer SM, and the multicast transmission over the WLAN is omitted. The transmission of packets originating or terminating at the client terminal CT and host HO is similar regardless of whether or the packet is conveyed via the slave mobile station MS. This means that the transmission is transparent to the client terminal CT and host HO, which can only detect an improved transmission bandwidth.","Steps - through - relate to the transmission of the first downlink packet D from the host HO to the client terminal CT. Finally, steps - through - relate to the transmission of the second downlink packet D from the host HO to the client terminal CT. A detailed description of the various transmissions is omitted as the downlink transmission is analogous with the uplink transmission, and the necessary addressing details are indicated in Table 1. In the embodiment described herein, the mobile stations' public (operator-assigned) IP addresses are used for communicating with the ShareMachine computer SM, while private IP addresses, ie, those assigned by the master mobile station MS, are used for communicating between the mobile stations.",{"@attributes":{"id":"p-0072","num":"0078"},"tables":{"@attributes":{"id":"TABLE-US-00001","num":"00001"},"table":{"@attributes":{"frame":"none","colsep":"0","rowsep":"0","pgwide":"1"},"tgroup":[{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"1"},"colspec":{"@attributes":{"colname":"1","colwidth":"259pt","align":"center"}},"thead":{"row":{"entry":"TABLE 1"}},"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":{"@attributes":{"namest":"1","nameend":"1","align":"center","rowsep":"1"}}},{"entry":"Addressing details relating to FIG. 8"}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"6"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"6","colwidth":"63pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["Step","Packet","Source","Destination","Data","Note"]},{"entry":{"@attributes":{"namest":"1","nameend":"6","align":"center","rowsep":"1"}}},{"entry":["8-11","Ethernet Packet","CT MAC","MS1 MAC","IP Data",{}]},{"entry":[{},"IP Packet","CT IP","HO IP","IP Data"]},{"entry":["8-13","Ethernet Packet","MS1 MAC","Multicast","UDP Packet"]},{"entry":[{},"UDP Packet","MS1 IP","Multicast","IP Packet"]},{"entry":["8-14","UDP Packet","MS2 IP\u2032","SM IP","IP Packet"]},{"entry":["8-16","IP Packet","CT IP","HO IP","IP Data","Id by MS public IP"]},{"entry":["8-17","IP Packet","SM IP","HO IP","IP Data","Unique Source port"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"238pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["8-21","See 8-11"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"105pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":[{},"IP Packet","CT IP","HO IP","IP Data"]},{"entry":["8-23","UDP Packet","MS1 IP\u2032","SM IP","IP Packet"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"238pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["8-26","See 8-16"]},{"entry":["8-27","See 8-17"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"6"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"6","colwidth":"63pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["8-31","IP Packet","HO IP","SM IP","IP Data","Unique Dest'n port"]},{"entry":["8-32","IP Packet","HO IP","CT IP","IP Data","Id by MS public IP"]},{"entry":["8-34","UDP Packet","SM IP","MS2 IP\u2032","IP Packet"]},{"entry":["8-35","UDP Packet","MS2 IP","Multicast","IP Packet"]},{"entry":["8-37","IP Packet","HO IP","CT IP","IP Data"]},{"entry":[{},"Ethernet Packet","MS2 MAC","CT MAC","IP Data"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"238pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["8-41","See 8-31"]},{"entry":["8-42","See 8-32"]}]}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"5"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"49pt","align":"left"}},{"@attributes":{"colname":"3","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"4","colwidth":"42pt","align":"left"}},{"@attributes":{"colname":"5","colwidth":"105pt","align":"left"}}],"tbody":{"@attributes":{"valign":"top"},"row":{"entry":["8-44","UDP Packet","SM IP","MS1 IP\u2032","IP Packet"]}}},{"@attributes":{"align":"left","colsep":"0","rowsep":"0","cols":"2"},"colspec":[{"@attributes":{"colname":"1","colwidth":"21pt","align":"center"}},{"@attributes":{"colname":"2","colwidth":"238pt","align":"center"}}],"tbody":{"@attributes":{"valign":"top"},"row":[{"entry":["8-47","See 8-37"]},{"entry":{"@attributes":{"namest":"1","nameend":"2","align":"center","rowsep":"1"}}}]}}]}}},"In the above table, the expressions \u201cunique source\/destination port\u201d means that the ShareMachine computer SM may identify various connections to the same host HO by means of port numbers. For instance, the ShareMachine computer SM may identify a connection from an exemplary client terminal CT to the host HO by port number 5555, while the next connection will be identified by port number 5556 (or any other unique value). When the host HO sends packets downstream, the ShareMachine computer SM can use the port number to determine which connection the downstream packets belong to.",{"@attributes":{"id":"p-0074","num":"0080"},"figref":["FIG. 9","FIGS. 1"],"b":["9","2","1","2","5","6","9","4","1","1","9","6","1","9","8","1","9","10","9","12","1","9","14","1"]},"On the other hand, if the test in step - fails, the process proceeds to steps - and -, in which the next SuperHead address from the list is tried. If the list of SuperHead addresses is exhausted, the process proceeds to step - and -, which involve various user alerting steps and\/or error recovery procedures. For instance, the master mobile station MS or its user may employ an internet search engine to obtain more SuperHead addresses.","A proper response from the SuperHead computer to the master MS should include a list of IP addresses of one or more available ShareMachine computers and, preferably, an updated list of available SuperHead computers. In a representative but non-restrictive implementation, such lists are sent in XML (extendible Markup Language) format. Reception of the list of available ShareMachine computers permits the master MS to know computers have reported themselves to the SuperHead computer as potential ShareMachine computers.","Typically each connection is served by one ShareMachine computer, but one master MS may serve several connections from one or more client terminals, and each connection may be served by a different ShareMachine computer. Also, it is beneficial if the master MS obtains and stores a list of several ShareMachine addresses, in case the active ShareMachine computer detaches itself from service or otherwise ceases to serve the connection.","In some embodiments the SuperHead and ShareMachine computers are implemented in a distributed manner. Such distributed implementation proves certain advantages, in addition to capacity considerations. For instance, many internet services or servers are threatened by network vandalism or sabotage, such as denial-of-service attacks. Furthermore, while there is nothing illegal in the usage of the access network subscription in the mobile stations, the inventive distribution of the access network subscriptions among several client terminals may result in access network traffic which is heavier than average, and the network operators may be tempted to prevent or obstruct the operation of the inventive gateway applications in the mobile stations. A distributed implementation of the SuperHead and ShareMachine computers makes them less vulnerable to such network-based vandalism by hackers or obstructions by access network operators. Robustness may be further improved by utilizing dynamic IP addresses for the SuperHead and\/or ShareMachine computers.","In an enhanced implementation of the procedure shown in , the lists of SuperHead and ShareMachine computers are updated regularly, via inquiries to a SuperHead computer. Frequent updating of the SuperHead and ShareMachine addresses provide further robustness, particularly in cases wherein the SuperHead and\/or ShareMachine computers are conventional home computers whose spare time is being utilized to serve connection in the manner described herein. When such home computers are turned off or used for other purposes, they stop operating as SuperHead and\/or ShareMachine computers. Accordingly, the address updating frequency should be dimensioned based on representative operating patterns of typical home computers, with 10 minutes being a good starting value. While the SuperHead discovery procedure shown in  has been described in connection with a master mobile station MS, the corresponding SuperHead discovery procedure may also be utilized by ShareMachine computers, with the variation that the ShareMachine computer registers itself with the discovered SuperHead computer as soon as it has discovered one.","In a variation of the address inquiry procedure described herein, the functions of the SuperHead and ShareMachine computers are combined in such a manner that the ShareMachine computers keep track of one another. In other words, the ShareMachine computers also act as SuperHead computers.","The previously described embodiments relate to provision of a scalable gateway functionality. One of the key elements of the invention is establishment of a WLAN base station in a mobile station. By establishing a WLAN base station in the mobile station, it will be possible to utilize some of the enhanced functionality of modern mobile stations.","In addition to merely conveying internet traffic between the client terminal CT and the internet host, the inventive gateway application can, in some specific embodiments, provide additional or supplementary services which utilize some of the functionality of modern mobile stations. In some implementations, such supplementary services are provided by an arrangement in which a supplementary server enhances the service(s) provided by a primary server. Such a supplementary server can be part of the functionality of the inventive WLAN gateway application, or it can be implemented as a network element distinct from the primary server.","One exemplary implementation of such additional services involves utilization of GPS (Global Positioning System) devices incorporated into some mobile stations. The inventive gateway application may be enhanced to associate GPS-provided geographical coordinates to the traffic originated by the client terminal, or to some of that traffic. For instance, the gateway application can tag still or video image data with geographical coordinates and\/or use some additional service (not shown separately) that maps the with geographical coordinates to a plaintext name of the relevant location. In another implementation the gateway application associates GPS-provided coordinates to the traffic, or some of it, while the actual tagging of the images with the coordinates is provided by some additional server, such as an image sharing server (not shown separately). Actually, what matters is the location of the client terminal and not the location of the mobile station acting as a WLAN gateway. But considering the short range of the mobile station's WLAN transmission, the mobile station's location can be used as the client terminal's location for virtually all practical purposes.","In a more ambitious implementation, the gateway application can provide additional services on the basis of the geographical coordinates. For instance, the gateway application can recognize various queries initiated by the client terminal and\/or responses to those queries by internet servers and enhance the query responses by relevant map or photography information. For instance, the gateway application can detect a query to \u201cpost\u201d and provide the query response with a map and\/or photograph of the post office closest to the mobile station's GPS-provided geographical coordinates. In order to obtain the map and\/or photograph, the gateway application may query a supplementary server which provides the requested functionality.","Another example of such additional services relates to traffic statistics which the gateway application collects and transmits to some internet-based supplementary server (not shown separately). For example, such a supplementary server may use the traffic statistics to monitor Quality of Service (QoS) parameters, which can be used to maintain the QoS at a specified level and\/or to optimize resource usage in the access network. In some embodiments the supplementary server is an advertising server. The advertising server may utilize the traffic statistics for targeted or tailored advertising to the client terminal CT. Such traffic statistics may include, for example, user identification, usage (amount of traffic, usage times, internet addresses visited, query parameters, or the like). Alternatively or additionally, the gateway application can transmit traffic statistics to a billing server which participates in charging the client terminal's subscriber. Yet further, the advertising server and the billing server may cooperate in such a manner that the advertising server's operator sells advertisement space or time and the advertising server credits the client terminal's subscriber for any advertisements received. The credits are then relayed to and used by the billing server in order to reduce the client terminal's subscriber's invoice, generate additional services, extend pre-paid subscription time, to name just a few examples.","Finally, the gateway application may be configured to convey the mobile station's location, or some derivative it, to the advertising server for targeted or tailored advertising on the basis of the mobile station's location. For instance, targeted advertising for some goods or service may include sending an advertisement to a client terminal only if the mobile station's location indicates that the client terminal is reasonably close to the outlet of the goods or service. On the other hand, tailored advertising may be implemented such that the advertisement indicates the address or location of the closest outlet.",{"@attributes":{"id":"p-0087","num":"0093"},"figref":["FIGS. 10 and 11","FIG. 10","FIG. 10"]},"In step - the WLAN circuitry of the mobile station MS is powered off and the execution of the WLAN gateway application may be suspended or terminated. Step - terminates when the sleep timer expires. For instance, the sleep timer may generate a processor interrupt which directs the mobile station's processor to perform program routines for activating the WLAN circuitry and starting or resuming execution of the WLAN gateway application. After step - the mobile station has established a WLAN network. In step - the mobile station checks if any client terminal(s), such as the exemplary digital camera, attempt(s) to attach to the WLAN network. If not, the process proceeds to step -, in which the WLAN network and circuitry are deactivated and the process begins anew at step -. On the other hand, if any client terminal attaches to the WLAN network, the mobile station starts a watchdog timer in step - and maintains the WLAN network as indicated in step -. Step - includes a test to detect client terminal activity. If client terminal activity is detected, the process returns to step - in which the watchdog timer is restarted. Naturally, any client-related requests are served as well, as part of the basic functionality of the WLAN gateway application. On the other hand, if no client terminal activity is detected, the process proceeds to step - which is a test as to whether the watchdog timer has expired. If not, the process returns to step - in which the WLAN network is maintained without restarting the watchdog timer. Eventually, a moment occurs when no client activity has been detected and the watchdog timer expires, and this is detected in step -. Then, in step -, the WLAN network and circuitry are deactivated and the process begins anew at step -.","By virtue of the embodiment described in connection with , the WLAN gateway application may terminate its own execution and power off the mobile station's WLAN circuitry. The automatic execution of the gateway application and the accompanying automatic activation of the mobile station's WLAN circuitry provides certain benefits. For instance, both digital cameras and mobile stations are handicapped by small user interfaces and relatively short battery life, particularly when their liquid-crystal displays (LCD) are illuminated. The automation described in connection with the present embodiment alleviates such handicaps.",{"@attributes":{"id":"p-0090","num":"0096"},"figref":["FIG. 11","FIGS. 5 and 10"],"b":["11","0","11","2","11","4","11","8","11","10","11","12"]},"It is readily apparent to a person skilled in the art that, as the technology advances, the inventive concept can be implemented in various ways. The invention and its embodiments are not limited to the examples described above but may vary within the scope of the claims.",{"@attributes":{"id":"p-0092","num":"0000"},"ul":{"@attributes":{"id":"ul0003","list-style":"none"},"li":["1. FI20080032, filed 16 Jan. 2008, and","2. PCT\/FI2008\/050617, filed 30 Oct. 2008."]}},"Both references are commonly owned patent applications. The references are unpublished applications at the filing date of the present invention, which is why some sections of their contents are repeated here."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["In the following the invention will be described in greater detail by means of specific aspects and embodiments with reference to the attached drawings, in which:",{"@attributes":{"id":"p-0015","num":"0021"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0016","num":"0022"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0017","num":"0023"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0018","num":"0024"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0019","num":"0025"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0020","num":"0026"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0021","num":"0027"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0022","num":"0028"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0023","num":"0029"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0024","num":"0030"},"figref":"FIG. 10"},{"@attributes":{"id":"p-0025","num":"0031"},"figref":"FIG. 11"}]},"DETDESC":[{},{}]}
