---
title: Method and apparatus for latency and power efficient database searches
abstract: Methods, apparatus and systems perform searches in a CAM memory that is divided into one or more databases. A selector selects at least two the databases for a simultaneous search, and selects at least one of the databases for a sequential search.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07467129&OS=07467129&RS=07467129
owner: Kawasaki Microelectronics, Inc.
number: 07467129
owner_city: Chiba-shi
owner_country: JP
publication_date: 20021223
---

{"@attributes":{"id":"description"},"RELAPP":[{},{}],"p":["This nonprovisional application claims the benefit of U.S. Provisional Application No. 60\/408,304, filed Sep. 6, 2002, which is incorporated herein by reference.","1. Field of Invention","The present invention relates to database searches.","2. Description of Related Art","A content addressable memory (CAM) is a memory device that stores contents as entries such as addresses and\/or data and the like, and have the ability to compare a given search data with its stored entries. If a match is found for the search data, one or more entries associated with the search data is returned. The returned one or more entries may be used directly in a performance of an operation or alternatively, the one or more entries may be used as basis for a \u201clookup\u201d operation, for example.","CAM devices are widely used in many systems and in particular, in systems that process data such as computer systems, telecommunication systems, network systems and the like. For example, in a network router, an incoming packet header of a packet may be the search data that is used to lookup a destination address of the packet in a CAM device that the router uses to determine which port the packet is to be forwarded. Besides this basic function, a network router may search through the different databases, for example, to determine how the packet is to be processed and\/or what filters are to be applied.","Through the introduction of higher density CAM devices and the ability to partition the CAM device's memory block into multiple sub-blocks, multiple databases can be stored in a single CAM device. However, there are many instances in which a single complete search data cannot be entered into the CAM device using a single clock cycle to search the multiple databases. Consequently, the complete search data is sent in several discrete portions using multiple clock cycles which increases the CAM's response time and power consumption.","The invention provides methods, apparatus and systems for performing searches in a CAM memory block that may be divided into multiple banks representing one or more databases and multiple clock cycles for complete search data entry. Each bank may be further divided into a plurality of segments; each segment may store a portion of or a complete content entry. Multiple memory banks, power management, storing partial results, and performing partial parallel searches may be utilized. In this way, the number of clock cycles may be reduced, thus lowering power consumption and increasing efficiency. Multiple databases may be searched in parallel using various portions of the complete search data, while other portions of the complete search data may be searched sequentially.","Match line results may be determined and stored for the segments of the banks. A match line result is a result of a comparison of a portion of the search data with a segment. The match line results may be retained and accumulated between searches of the banks. A portion of the complete search data may be sent to selected banks, and the search results may be combined with the search results of the previous search to give search results for the segments previously searched and the segments currently searched. The search result for the databases may be determined through accumulating match line results for searched segments. A search output memory may store a complete search result of a bank.","The databases may have different number of banks and\/or search data entry widths. Portions of the complete search data may be altered in the CAM device for the databases. Even though the same portion of the search data may be provided to each bank, the bits that are irrelevant to the respective banks may be masked out in the CAM device. The search data portions not of interest to a particular database may not be provided to the database by deselecting the database from the search pathway in a search sequence.","Each bank and segment may be powered down when not in use. To save on power consumption, the CAM device may activate only those banks and segments that are of interest in any particular search. The segments that do not need to be searched may be deactivated to save power. Likewise, banks that are not the target of a search may be set to be inactive to conserve power. Careful use of selecting and deselecting banks can be used to efficiently reduce clock cycles while maximizing the use of the CAM device.","To further reduce the number of clock cycles required for a search, databases having fewer segments than other databases may be placed with higher priority in a CAM and appear earlier in a search sequence. Their results may be taken during parallel searches and thus sequential searches for such databases may not be necessary.","These and other features and advantages of the invention are described in, or are apparent from, the following description of various exemplary embodiments of the methods, apparatus and systems of the invention.",{"@attributes":{"id":"p-0025","num":"0024"},"figref":"FIG. 1","b":["100","102","104","106","200","108","100"]},"The logic unit , using a known protocol, may select the CAM device  for communication using the one or more control and\/or data busses and\/or application programming interfaces . Once communication is established, the logic unit  may cause the CAM device  to receive a complete or portions of a complete search data. The CAM device  searches stored entries for corresponding matches with the complete or portions of the complete search data. In the case where a complete search data is received, the CAM device  may return one or more search results as output to the logic unit .","When a portion of the complete search data is received, the CAM device  may retain a partial search result associated with the portion of the complete search data. The CAM device  then receives a next portion of the complete search data and performs a corresponding partial search. In this way, the CAM device  may continuously perform search operations for corresponding matches and retain the partial search results on consecutively received portions of the complete search data until all the portions of the complete search data are received. Then, the CAM device  returns one or more search results as output to the logic unit  based on the accumulated partial search results of all the received portions. Further details of the CAM device  is now described below.",{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 2","b":["200","202","203","204","205","300","206","208","202","400","300","300","310","310","310","310","320","320","310","310","320","320"],"sub":["1 ","n","1 ","n ","1 ","m ","1 ","n","1 ","m "]},"A search of the CAM array  may require more than one clock cycle because the complete search data may not be entered as a single input entry to the CAM device , for various reasons. For example, the input data lines of the CAM device  may not accommodate the complete search data, and only portions of the search data are sent over the data lines for each clock cycle. In another example, the complete search data may be sent a portion at a time by a sending device due to a limitation of the sending device. In any event, multiple clock cycles may be used to send the complete search data, one portion at a time to the CAM device . Thus, if the complete search data is 288 bits wide and the input data lines are 72 bits wide, then 4 clock cycles may be required to send the complete search data to the CAM device .","In view of the above, a portion of a complete search data  that is equal to a number of bits of a segment . . . of the CAM array bank . . . may be transferred in each clock cycle. For example, if the segments . . . are 72 bits wide, then the complete search data may be divided into discrete portions that are 72 bits wide each. Thus, when a portion of the search data  having a width of a segment . . . is provided at every clock cycle, the segments . . . in a bank . . . can be searched during that clock cycle. It should be appreciated that the search may be executed sequentially or simultaneously on one or more banks . . . representing a single database or the search may be executed sequentially or simultaneously on one or more banks . . . representing a plurality of databases. It should also be appreciated that the portion of the search data  need not be limited to a width of a segment but the portion of the search data  may be for two or more segments, or fractions thereof. Details of the database searches will be further described with respect to .","The segment selector , based on instruction signals received from, for example, the logic unit  (see ) or a finite state machine, may select which segments are to be searched among the plurality of segments . . . in the banks . . . . For example, the segment selector  may select the segments of the banks . . . to be searched by a portion of a complete search data  received by the CAM device .","After the complete search data has been received by the CAM array  and the databases have been searched, and if there are more than one entry in the CAM array  that matches with the complete search data, the priority encoder , based on a priority scheme, selects from the multiple matched entries. The selected entry may then be retained in the output index , which may also be a register. The retained entry in the output index  may be used directly in a performance of an operation or the entry may be used as an index to another device.",{"@attributes":{"id":"p-0033","num":"0032"},"figref":"FIG. 3","b":["500","510","510","0","1","2","3","0","3","510","510","510","510","1","5103","5104","5105","2","5106","510","510","512","512","512","512"],"sub":["1 ","8 ","1 ","2","7 ","8","1 ","8 ","1 ","4","1 ","4 "]},"When multiple clock cycles are required to provide the complete search data, the CAM device  may perform parallel searches on all desired databases , , , and  for all search data portions except for the last portion. As each bank . . . is searched, match flag registers store the results for the searched segments . . . of the banks . . . . AND-chains accumulate the match flag results of all previously searched segments . . . with the most recently searched segments . . . . The match flag registers and the AND-chains will be further described with respect to .","For example, the CAM device  may require 4 clock cycles of 72 bit portions of the complete data to receive a complete search data during a typical search. Thus, for the first 3 clock cycles, parallel searches may be performed on all banks . . . of all desired databases , ,  and . Specifically, in the first clock cycle, the CAM device  receives the first portion of the complete data and performs searches in the first segments of each bank . . . for matching entries. If there is a match with one or more first segments of the banks . . . , match flag registers associated with the first segments store the matched result. Next, the CAM device  receives the second portion of the complete data and performs searches on the second segments of each bank . . . for matching entries. If there is a match with one or more second segments of the banks . . . , match flag registers associated with the second segments store the matched result. Next, the CAM device  receives the third portion of the complete data and performs searches on the third segments of each bank . . . for matching entries. If there is a match with one or more third segments of the banks . . . , match flag registers associated with the third segments store the matched result.","For the fourth and last portion of the complete search data, however, the databases , ,  and  may be searched individually and serially. Thus, for each database , ,  and  of interest, the last search may be repeated until all databases , ,  and  of interest are searched. The last portion of the complete search data for this last sequence of searches may be retrieved from a register or alternatively, may be provided repetitively from a sending device. It should be appreciated that if the last portion of the search data is repetitively sent from a sending device, then the last portion of the search data may be the same or may be different. It should be further appreciated that not all searches are limited to parallel searches except for the last segment. For example, the searches performed on the last two segments might be solely directly to a single database. In another example, the second segment may be used to search the databases , ,  and  individually and serially. Accordingly, it should be appreciated that different combinations and possibilities exist with searching databases in parallel or individually on a per segment basis.","The database selector  (see ) selects the banks to be searched. The data selector  may operate based on instruction signals received from, for example, the logic unit  (see ). Alternatively, the data selector  may operate based on an internal control mechanism such as a finite state machine. An operation of an exemplary database selector in a form of a finite state machine  is now described using .",{"@attributes":{"id":"p-0038","num":"0037"},"figref":["FIG. 4","FIG. 3"],"b":["600","500","600"]},"The operation of the exemplary finite state machine  starts with the first clock cycle, where the first portion of the complete search data is sent to the CAM device . During this time, the finite state machine  is at its first state 11111111 enabling all eight banks . . . for a search. Next, in the second clock cycle, the second portion of the complete search data is sent to the CAM device . During this time, the finite state machine  is at its second state 11111111 enabling all eight banks . . . for a search. Then, in the third clock cycle, the third portion of the complete search data is sent to the CAM device . During this time, the finite machine  is at its third state 11111111 enabling all eight banks . . . for a search.","In the fourth clock cycle, the fourth and final portion of the complete search data is sent to the CAM device . The search based on the final portion of the complete search data is treated differently. Instead of searching databases , ,  and  in parallel, a single database, for example, database  is targeted. When database  is targeted, the other remaining databases ,  and  are inactive and are not involved in the search. The fourth portion of the complete search data may be stored in a register for future searches or alternatively, it may be repetitively sent to the CAM device  during future searches.","In the fourth clock cycle, the finite state machine  may be at its fourth state 11000000 enabling banks  and  representing database . Next, in the fifth clock cycle, the finite state machine  is at its fifth state 00111000 enabling banks ,  and  representing database . Then, in the sixth clock cycle, the finite state machine  is at its sixth state 00000100 enabling only bank  representing database . Lastly, in the seventh clock cycle, the finite state machine  is at its seventh state 00000011 enabling banks  and  representing the database . This completes the search sequence and the finite state machine  returns to the first state for the next search sequence. It should be appreciated that although the generation of the data selector  has been described using the finite state machine , this operation can be implemented as control signals from the logic unit .","The sequential search in the final phase of the search sequence may be to complete a search or to select the database to search and to output the result for that database. With a CAM device that includes many banks, those banks not in the targeted database are left inactive to save power. The search on the final segment combines the match flag register from previous segments together with current result to produce a final result for the targeted database. Even though other databases are inactive, the match flag registers for previously searched segments in other databases continue to store their values. A search on the final segment is done for each database of interest. Each search returns the result for a single database.",{"@attributes":{"id":"p-0043","num":"0042"},"figref":"FIG. 5","b":["0","1","512","512"],"sub":["1 ","4 "]},{"@attributes":{"id":"p-0044","num":"0043"},"figref":["FIG. 6","FIG. 5","FIG. 6","FIG. 5","FIG. 6"],"b":["0","1","2","3","0","1","2","3","512","512","512","0","1","2","3"],"sub":["1 ","3","4 "]},"Because the searches on the final segment may not be performed in parallel over multiple databases, the last portion of the complete search data may differ from one database to another. Some portions of the complete search data may not apply to all databases. In these instances, a bit selector  (see ) may be used to mask out that portion or part of that portion as \u201cdon't care\u201d bits. For example, mask registers specific to a database may be used to mask out the bits during a search. Other known techniques may be used to mask out the bits. For example, in ternary CAM devices, each entry in a database could specify those bits as \u201cdon't care\u201d. Bits to be masked may be varied using control signals from the logic unit  (see ).",{"@attributes":{"id":"p-0046","num":"0045"},"figref":"FIG. 7","b":["700","710","720","710","712","710","730","740","720","724","726","728","722","724","740","710","726","728","722"]},"The match flag register  has the data input terminal D to which the match line  output from the CAM word  is input, and the data latch control terminal to which a match flag control signal  is input. Once the match flag register  receives the match flag control signal , it captures the match line  output.","The AND gate  constituting an AND chain has a first input terminal to which the output Q of the match flag register  is input, and a second input terminal to which the AND chain output of an adjacent word is input. Therefore, the AND gate  outputs a signal of logic \u20181\u2019 if the output from the match flag register  of this word indicates logic \u20181\u2019, or a match, and if the AND chain output from an adjacent word indicates logic \u20181\u2019, or a match.","The OR gate  which outputs an AND chain signal has a first input terminal to which the output of the AND gate  is input, and a second input terminal to which an entry representative segment instruction signal is input. The entry representative segment instruction signal signals the entry representative word which outputs a match signal for the entry if one entry is comprised of a combination of a plurality of words. The entry representative segment instruction signal indicates logic \u20181\u2019 if a segment is the entry representative word, and logic \u20180\u2019, otherwise.","If one entry is comprised of a combination of a plurality of words, the segment containing the word having the largest address for that entry may be output as a match address of the search result. However, it should be appreciated that the entry representative word can be the smallest address in an entry or an intermediate length of address in the entry.","The AND gate  functioning as an entry match output circuit has a first input terminal connected to the output of the AND gate , and a second input terminal connected to the entry representative physical segment instruction line. Thus, as the entry match output, an AND result of the match flags of the plurality of words in an entry is output from the AND gate  if that word is the entry representative word. Otherwise, or if not the entry representative word, logic \u20180\u2019 indicating a mismatch is output.",{"@attributes":{"id":"p-0052","num":"0051"},"figref":"FIG. 8","b":["810","820","814"]},"First, all the match flag registers are initialized. Thus, if the CAM cell is of the mismatch-detection type, because all the match lines of the CAM device not searched are maintained in the initial state or a match state, the match flag may be captured into the match flag register at the time of a first search. In the case of a first search, which is not reflected by the previous search result, the search bit lines in the segment to be searched are only driven, while the search bit lines of the segment not to be searched are maintained in a waiting state. Then, a match between the content stored in the CAM words  and  and the search data is searched for at the same time in the segment  and  to be searched, and a match flag is output to each corresponding match line. The match line outputs for the words belonging to a segment not to be searched are maintained in the initial state or a match state. Thereafter, in response to a data capture pulse applied to both match flag control signals at a timing of establishing the state of the match lines, a match line output is held in each corresponding match flag register  and .","Because the match flag registers  and  of the words belonging to a segment  and  not to be searched are maintained in the initial state or a match state, even if either segment  and  containing the word i or the word i+1 is to be searched for a first search, the search result can be correctly reflected to the entry match output for the entry representative word i+1. Accordingly, if one entry is composed of a combination of a plurality of words, a correct search result can be achieved if any word is first searched for a match.","In the case of an AND search, which is reflected by the previous search (first search in this embodiment) result, as in the first search, the search bit lines in a segment to be searched are only driven according to the search data. Thereafter, a data capture pulse is applied only to the match flag control signal of a word to be searched at a timing of establishing the state of the match lines, and a match line output is held in each corresponding match flag register  and .","In the case of an AND search, since the search result of the first search is held in the match flag register  and  of a word not to be searched, even if either segment containing the word i or the word i+1 is to be searched for an AND search, a correct AND search result for both can be output as the entry match output from the entry representative word i+1. Accordingly, the CAM device can achieve a match search in an arbitrary order.","The aforementioned AND search result is output as the entry match output from the entry representative word. Then, the addresses of the entry representative words are sequentially output from the priority encoder  (see ) according to a predetermined priority.","As described above, a plurality of segments  and  are combined, and the search lines and the data capture into the match flag registers  and  are individually controlled, so that a correct AND search result can be obtained regardless of the searched order. In effect, the search bit lines and the match line of a word to be searched are only driven while the search bit lines and the match line of a word not to be searched are not driven, thereby greatly reducing power consumption.","Since the match flag register  and  of a word not to be searched is maintained in the initial state or a match state, for example, if one entry is comprised of a combination of four words, a match between the words of which the addresses are apart from each other in an entry can be searched, such as an AND search for a first word and a third word. This allows for a match search while distinguishing attributes of the data stored in each word, and a correct search result can be achieved. Further details may be found in the US Patent Application Publication No. 2002\/0080665 which is incorporated, in its entirety herein by reference.",{"@attributes":{"id":"p-0060","num":"0059"},"figref":"FIG. 9","b":["100","110","120","130","140","120","130","140"]},"Otherwise, if a determination is made that segment i is the last segment of the total number of segments that represent an entry, then the operation continues to step S. In step S, database j represents the first database. Next, in step S, the last segment i is searched on the first database of interest. Next in step S, a determination is made whether there are any other databases of interest to be searched. If there are other databases, then the operation continues to step S. In step S, the integer j is defined as the next database of interest and the operation returns to step S to repeat steps S and S. Otherwise, if a determination is made that there are no other databases of interest, the operation continues to step S where the operation terminates.","The system  for performing CAM database searches may be implemented using a programmed general purpose computer. However, the system  can also be implemented using a special purpose computer, a network processor, a processor, a programmed microprocessor or microcontroller and peripheral integrated circuit elements, an ASIC or other integrated circuit, a digital signal processor, a hardwired electronic or logic circuit such as a discrete element circuit, a programmable logic device such as a PLD, PLA, FPGA or PAL, or the like. In general, any device, capable of implementing a finite state machine that is in turn capable of implementing the flowchart shown in  can be used to implement an embodiment of the invention.","Each of the circuit, routine or applications , ,  and  of the system  can be implemented as portions of a suitably programmed general purpose computer. Alternatively, circuit, routine or applications , ,  and  of the system  outlined above can be implemented as physically distinct hardware circuits within an ASIC, or using a PLD, PLA, FPGA, or PAL, or using discrete logic elements or discrete circuit elements. The particular form each of the circuit, routine or applications , ,  and  of the system  outlined above will take is a design choice and will be apparent to those skilled in the art.","Moreover, the system  and\/or each of the various circuit, routine or applications discussed above can each be implemented as software routines, managers or objects executing on a programmed general purpose computer, a special purpose computer, a microprocessor or the like. In this case, the system  and\/or each of the various circuit, routine or applications discussed above can each be implemented as one or more routines embedded in the communications network, as a resource residing on a server, or the like. The system  and the various circuit, routine or applications discussed above can also be implemented by physically incorporating the system  into a software and\/or hardware system, such as the hardware and software systems of a document server, web server or electronic library server.","As shown in , the CAM array can be implemented using any appropriate combination of alterable, volatile or non-volatile memory or non-alterable, or fixed, memory. The alterable memory, whether volatile or non-volatile, can be implemented using any one or more of static or dynamic RAM, flash memory or the like. Similarly, the non-alterable or fixed memory can be implemented using any one or more of ROM, PROM, EPROM, EEPROM or the like.","While this invention has been described in conjunction with the exemplary embodiments outlines above, it is evident that many alternatives, modifications and variations will be apparent to those skilled in the art. Accordingly, the exemplary embodiments of the invention, as set forth above, are intended to be illustrative, not limiting. Various changes may be made without departing from the spirit and scope of the invention."],"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION OF EXEMPLARY EMBODIMENTS"],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["Various exemplary embodiments of the invention are described in detail with reference to the following figures wherein:",{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":["FIG. 4","FIG. 3"]},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 9"}]},"DETDESC":[{},{}]}
