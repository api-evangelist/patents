---
title: State projection via minimization of error energy
abstract: The present invention improves in one aspect the accuracy, efficiency, and robustness of fixed-step solvers when simulating a physical system that does not change in energy at the critical event. The present invention uses the energy of the error as the figure of merit in finding the first state of the system under the new constraints. The present invention enables a fixed-step solver to be more robust even when the critical event falls between two time samples. The present invention may also be applied to variable-step solvers. Moreover, the present invention may also be used to simulate a physical system when the energy changes at the critical event in the physical system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08019575&OS=08019575&RS=08019575
owner: The MathWorks, Inc.
number: 08019575
owner_city: Natick
owner_country: US
publication_date: 20060630
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["TECHNICAL FIELD","BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION"],"p":["The present invention generally relates to computational simulation of physical systems, and more specifically to using fixed-step numerical solvers to simulate the physical systems.","Various classes of graphical models describe computations that can be performed on computational hardware, such as a computer, microcontroller, field programmable gate array (FPGA), and custom hardware. Classes of such graphical models include time-based block diagrams such as those found within Simulink\u00ae from The MathWorks, Inc. of Natick, Mass., state-based and flow diagrams, such as those found within Stateflow\u00ae from The MathWorks, Inc. of Natick, Mass., entity-flow diagrams such as those found within SimEvents from The MathWorks, Inc. of Natick, Mass., data-flow diagrams, circuit diagrams, and software diagrams, such as those found in the Unified Modeling Language (UML), for example. UML is available from object management group (OMG). A common characteristic among these various forms of graphical models is that they define semantics on how to execute the graphical syntax of the model.","Historically, engineers and scientists have utilized graphical models in numerous scientific areas such as Feedback Control Theory and Signal Processing to study, design, debug, and refine dynamic systems. Dynamic systems, which are characterized by the fact that their behaviors change over time, or the fact that their states change or the fact that their behaviors change due to a system environment, are representative of many real-world systems. Graphical modeling has become particularly attractive over the last few years with the advent of software packages such as Simulink\u00ae from The MathWorks, Inc. of Natick, Mass. Such packages provide sophisticated software platforms with a rich suite of support tools that makes the analysis and design of dynamic systems efficient, methodical, and cost-effective.","A dynamic system, either natural or man-made, is a system whose response at any given time is a function of its inputs, its current state, the current time, and other input parameters. Such systems range from simple to highly complex systems. Physical dynamic systems include a falling body, the rotation of the earth, bio-mechanical systems (muscles, joints, etc.), bio-chemical systems (gene expression, protein pathways), weather and climate pattern systems, etc. Examples of man-made or engineered dynamic systems include: a bouncing ball, a spring with a mass tied on an end, automobiles, airplanes, control systems in major appliances, communication networks, audio signal processing, nuclear reactors, a stock market, etc.","Professionals from diverse areas such as engineering, science, education, and economics build graphical models of dynamic systems in order to better understand system behavior as it changes with the progression of time. The graphical models aid in building \u201cbetter\u201d systems, where \u201cbetter\u201d may be defined in terms of a variety of performance measures such as quality, time-to-market, cost, speed, size, power consumption, quality of service (QoS), robustness, etc. The graphical models also aid in analyzing, debugging and repairing existing systems (be it the human body or the anti-lock braking system in a car). The models may also serve the purpose of educating others on the basic principles governing physical systems. The models and results are often used as a scientific communication medium between humans. The term \u201cmodel-based design\u201d is used to refer to the use of graphical models in the development, analysis, and validation of dynamic systems, such as, for example, control systems and signal processing systems.","Graphical modeling environments such as Simulink\u00ae and various modeling applications associated with Simulink\u00ae, such as SimMechanics, SimPowerSystems, SimHydraulics, and SimDriveline, assist in simplifying the process of designing, simulating, and implementing dynamic systems. A graphical model can be a representation of a real-world system. The graphical representation of a dynamic system often consists of a graph containing nodes (i.e. blocks) interconnected by edges (i.e. lines). The blocks may be functional entities that perform mathematical operations, transformations, or both or enforce constraints on the data and information being processed by the system.","The simulation of a physical system involves solving a set of differential and algebraic equations (DAEs) where a set of algebraic constraints may specify the relationship of different body elements in the physical system, the relationship of different capacitor and inductor elements in the physical system, the relationship of different fluid capacity and inertia elements in the physical system, etc. Typically, the system evolves for a certain length of simulation time, optionally synchronized with real-time to facilitate, for example, hardware-in-the-loop simulation, under a fixed set of constraints. During this evolution, however, events may occur that change the set of active constraints of the system. After the set of constraints changes, the simulation continues under the new fixed set of constraints. Hence, the simulation solver needs to transition from using the old constraints to using the new constraints when the event occurs and signals a change in the relationship of the different elements in the physical system.","Simulation solvers can be generally separated into two categories: variable-step solvers and fixed-step solvers. Variable-step solvers can change the time step used throughout the simulation and hence can often detect precisely the exact time at which the set of the constraints of the physical system changes. However, it is difficult to estimate how long (in real time) the simulation will take using the variable-step solvers. In contrast, fixed-step solvers use simulation time steps of fixed duration to solve the simulation and, hence, the amount of real time that it will take to simulate the physical system can be predicted. However, because fixed-step solvers may not change the time step used within the simulation, it is very likely that the fixed-step solvers only detect the event signaling a change in constraints after the simulation has overshot the transition time. Once the fixed-step solvers detect the event, a different set of differential and algebraic equations and\/or algebraic constraints are used to simulate the physical system. However, because of the overshot of the transition time, the subsequent simulation results of the physical system can be erroneous or inaccurate. One can usually mitigate this problem by decreasing the fixed simulation time step used by the fixed-step solvers; however, this is disadvantageous because the total simulation (real) time increases, sometimes dramatically, and oftentimes becomes unreasonable and impractical. Alternatively, more sophisticated algorithms and\/or algorithms with fewer approximations can be used to accurately simulate the physical system by the fixed-step solvers. One approach is to employ a zero-crossing location algorithm to establish precisely when an indicator function generates the event, which often applies an iterative search to find the time where the resultant of the indicator function changes to zero, changes from zero, or crosses zero. However such an approach will also lengthen the overall simulation time. Hence there is a need to improve the use of fixed-step solvers such that both accuracy and efficiency can be preserved.","In one aspect, the present invention improves the accuracy, efficiency, and robustness of fixed-step solvers when simulating a physical system that does not change in energy at the critical event. A critical event is defined herein as an event that occurs at the point in time when constraints of the physical system change. A physical system can be modeled using a set of differential and algebraic equations. In one aspect, the present invention minimizes the energy of the error between the first state simulated under the old constraint and the second state simulated under the new constraint so that for physical systems that do not change in energy at the critical event, conservation of energy will be satisfied given the overshot state at the time sample when the critical event is detected, even when using fixed-step solvers. The present invention recognizes that critical events can fall between two time samples, and, hence, the present invention minimizes the error because of the inability to place a sampling time at the critical point, which is usually what happens when a fixed-step solver is used. The present invention enables a fixed-step solver to be more robust even when large time steps are used. One of ordinary skill in the art will appreciate that the present invention may also be applied in simulating a system in which energy does change at a critical event.","In one embodiment of the present invention, a method for simulating a system of differential and algebraic equations (DAEs) is provided. The method includes the step of simulating the system of DAEs under a first set of constraints at a first time sample. The method further includes the step of detecting an event signaling a change in the first set of constraints to a second set of constraints. The event can occur between the first time sample and a second time sample, wherein the second time sample is one time step after the first time sample. The method also includes the step of receiving a first state of the system simulated under the first set of constraints. The method further includes the step of calculating a second state of the physical system simulated under a second set of constraints by minimizing an energy of an error between the second state and a state derived from the first state. The state derived from the first state can be the same as the first state. Alternatively, the state derived from the first state can be an intermediate state derived from the first state.","In one aspect of the present invention, a fixed-step solver is used to simulate the system. Alternatively, a variable-step solver is used to simulate the system. The second state of the system simulated under the second set of constraints and the first state of the system simulated under the first set of constraints may both occur at the second time sample. The second state of the physical system simulated under the second set of constraints may instead occur at a third time sample that is one time step after the second time sample and the intermediate state may be calculated based on the second set of constraints and using the first state of the system simulated under the first set of constraints as initial conditions. The first set of constraints can describe a first relationship among a plurality of gears before a clutch locks and the second set of constraints can describe a second relationship among the plurality of gears after the clutch locks. In another aspect of the present invention, the calculation of the second state of the system simulated under the second set of constraints involves the use of a so-called mass matrix associated with the energy of the system defined by a quadratic form of the states. The mass matrix may be a non-parameterized (constant) or a parameterized matrix that may lead to a nonlinear problem formulation. In a further aspect of the present invention, the method further includes the step of projecting the first state onto the second set of constraints in one operation. In still another aspect of the present invention, the second state of the system simulated under the second set of constraints includes one or more user-specified states.","In another embodiment of the present invention, a computer-readable medium storing instructions for enabling a computing device to simulate a system of DAEs is provided. The medium includes the instructions for simulating the system of DAEs under a first set of constraints at a first time sample and detecting an event signaling a change in the first set of constraints to a second set of constraints. The medium also includes the instructions for receiving a first state of the system simulated under the first set of constraints. The medium further includes the instructions for calculating a second state of the system simulated under the second set of constraints by minimizing an energy of an error between a state derived from the first state and the second state.","In a further embodiment of the present invention, a system for simulating a system of DAEs is provided. The system includes a modeling facility including a critical event energy minimizer for minimizing an energy of an error between a state derived from a first state simulated under a first set of constraints and a second state simulated under a second set of constraints, wherein a critical event occurs that causes the modeling facility to change from simulating the system under the first set of constraints to simulating the system under the second set of constraints. The critical event may occur between two time samples. The state derived from the first state can be the same as the first state or an intermediate state derived from the first state.","In one aspect of the present invention, the first set of constraints describes a first relationship among a plurality of gears before a clutch locks and the second set of constraints describes a second relationship among the plurality of gears after the clutch locks. In modeling an electrical system with a switch, the first set of constraints can describe a relationship between the electrical connections before a switch closes and the second set of constraints can describe the relationship between the electrical connections after the switch closes. Similarly, in a multi-body system, the first set of constraints can be a relationship between the contact points of two bodies before they are in contact and the second set of constraints can be their relationship after they are in contact. In another aspect of the present invention, the critical event energy minimizer calculates the second state of the system simulated under the second set of constraints using a so-called mass matrix associated with the energy of the system defined by a quadratic form of the states. In still another aspect of the present invention, the mass matrix or the moment of inertia matrix may be a non-parameterized (constant) or a parameterized matrix that may lead to a nonlinear problem formulation. In yet another aspect of the present invention, the critical event energy minimizer minimizes the energy of the error by projecting the first state onto the second set of constraints in one operation. In still another aspect of the present invention, the second state of the system simulated under the second set of constraints retains a user-specified state.","The present invention in one aspect improves the accuracy, efficiency, and robustness of fixed-step solvers especially when simulating a physical system that does not change in energy at the critical event. The present invention may also be used with a variable-step solver as well when there is restraint in the number of time steps used or the size of the time step in the simulation. Additionally, the present invention may also be used with a system that has a change in energy at the critical event. One of ordinary skill in the art will appreciate that the present invention is not limited to the exemplary usage listed herein, and the exemplary usage should not be used to limit the scope of the present invention. In many conventional simulations, an approximation that simplifies analysis without too great a cost in accuracy is often used. Variable-step solvers are able to utilize algorithms that involve many approximations because the solvers can modify the time steps to be small enough around the critical points if necessary such that the approximations are still valid. However, the same approximation algorithms do not always work well with fixed step solvers because sometimes the critical event falls between two time samples tand t(t<t) and the critical event is only detected at t. When the critical event is detected, the fixed step solver uses the new constraints to simulate the system, but since erroneous or inaccurate simulation results are obtained at tbecause of the delay in detection of the critical event, subsequent simulation results obtained from the new constraints are also erroneous or inaccurate if the errors or inaccuracies from the simulation results at tare not retroactively corrected or minimized.","For example, in a simulation of a driveline system having gears such as shown in  with a schematic such as , carrier  drives four planet gears  and also provides input (not shown) into the system. Clutch  is used to lock the ring gear  with the sun gear . The simulation of the driveline system tries to simulate the behavior (velocities) of the gears before and after the clutch  locks (a critical event) the ring gear  with the sun gear .",{"@attributes":{"id":"p-0028","num":"0027"},"figref":"FIG. 2A","b":["32","34","36","22","24","26","22","24","26"]},{"@attributes":{"id":"p-0029","num":"0028"},"figref":["FIG. 2B","FIG. 2B"],"sub":["1 ","2 ","1","2","2","2 ","3 "],"b":["32","34","36","22","24","26"]},"The present invention provides a method and system to remedy the above mentioned problem so that more physically-meaningful simulation results are obtained. The present invention uses a minimization technique to minimize the energy of the error between the erroneous simulation results obtained from the old constraints and the unknown simulation results to be obtained from the new constraints. In a preferred embodiment of the present invention, the minimization occurs at the time sample when the critical event is detected. In another embodiment of the present invention, the minimization occurs at a time sample after the critical event is detected. One application of the present invention is in situations where there is no change in kinetic energy of the physical system when a critical event occurs. In one embodiment, the present invention enables the fixed-step solvers to maintain the use of the same efficient approximation algorithms as variable step solvers during most of the simulation and yet ensure accuracy and efficiency. Hence the fixed-step solvers are made more robust and accurate in handling situations where the critical event falls between two time samples, especially when the time steps are large. One of ordinary skill in the art will appreciate that the present invention is also applicable to variable-step solvers when the critical event falls between two time samples even though the time steps are variable in the simulation. The present invention can also be applied when the critical event occurs exactly at a time sample and\/or when there is a change in energy in the system.",{"@attributes":{"id":"p-0031","num":"0030"},"figref":"FIG. 3","b":["102","106","104","104","106","104","104","102","120","108","102"]},"The memory  may comprise a computer system memory or random access memory such as DRAM, SRAM, EDO RAM, etc. The memory  may comprise other types of memory as well, or combinations thereof. A user may interact with the computing device  through a visual display device  such as a computer monitor, which may include a user interface . The computing device  may include other I\/O devices such as a keyboard  and a pointing device , for example a mouse, for receiving input from a user. Optionally, the keyboard  and the pointing device  may be connected to the visual display device . The computing device  may include other suitable conventional I\/O peripherals. The computing device  may further comprise a storage device , such as a hard-drive or CD-ROM, for storing an operating system  and other related software, and for storing modeling facility , such as Simulink\u00ae, SimDriveline, SimMechanics, SimHydraulics, SimPowerSystems, all from The MathWorks, Inc. of Natick Mass. Modeling facility  can be, but is not limited to, an application, a program, a module, or a script. Modeling facility  includes a critical event energy minimizer  to minimize change in error energy when a critical event is detected. Critical event energy minimizer  can be part of the modeling facility  or it can be an add-on module to the modeling facility . Additionally, the operating system  and executable process  can be run from a computer readable media, such as, for example, KNOPPIX\u00ae, a bootable CD for GNU\/Linux.","Additionally, the computing device  may include a network interface  to interface to a Local Area Network (LAN), Wide Area Network (WAN) or the Internet through a variety of connections including, but not limited to, standard telephone lines, LAN or WAN links (e.g., 802.11, T1, T3, 56 kb, X.25), broadband connections (e.g., ISDN, Frame Relay, ATM), wireless connections, or some combination of any or all of the above. The network interface  may comprise a built-in network adapter, network interface card, PCMCIA network card, card bus network adapter, wireless network adapter, USB network adapter, modem or any other device suitable for interfacing the computing device  to any type of network capable of communication and performing the operations described herein. Moreover, the computing device  may be any computer system such as a workstation, desktop computer, server, laptop, handheld computer or other form of computing or telecommunications device that is capable of communication and that has sufficient processor power and memory capacity to perform the operations described herein, either standalone or in a networked configuration.","The computing device  can be running any operating system such as any of the versions of the Microsoft\u00ae Windows\u00ae operating systems, the different releases of the Unix and Linux operating systems, any version of the MacOS\u00ae for Macintosh computers, any embedded operating system, any real-time operating system, any open source operating system, any proprietary operating system, any operating systems for mobile computing devices, or any other operating system capable of running on the computing device and performing the operations described herein.","Before continuing below, it is helpful to define a few terms used herein.","As used herein, the term \u201cbody element\u201d refers to the basic element of a mechanical system or machine. A body element is characterized by its mass or moment of inertia properties, its position and orientation in space, and any attached body coordinate systems. Body elements can be connected to one another by joints, constraints, or drivers.","As used herein, the term \u201cstate\u201d refers to a variable in a dynamic system whose derivative also appears when the system is written as a set of first order differential and algebraic equations. The state variables are integrated in time to calculate the time evolution of all of the variables in the system. For mechanical systems, the state variables can be position and velocity variables. For electrical systems, the state variables can be voltage and current. For hydraulic systems, state variables can be pressure and flow. For rotational mechanics, state variables can be torque and angular velocity. For some systems, some of the state variables can be calculated after integrating the system by using the time history of other state variables. For example, certain dynamics of mechanical systems can be represented by equations that are only based on velocity variables and do not explicitly contain position variables in the equations. The position variables can be calculated later by integrating the corresponding velocity variables.","As used herein the term \u201cconstraint\u201d refers to a restriction among states in a model of a system. A constraint removes one or more independent states, unless that constraint is redundant and restricts states that are already constrained. The relationship specified by a constraint can be an explicit function of time or not. The relationship specified by a constraint can be static and does not change during the course of simulation. For example, this is applicable to the relative velocities of two shafts connected by a simple gear. On the other hand, the relationship specified by a constraint can also be dynamic and change during the course of the simulation. For example, this is applicable to the situation where a clutch is locked during the simulation, thereby constraining the velocities of the shafts connected to the clutch. Similarly, in case of a rigid bar rotating on a ball, the point around which the bar rotates is variable over time, and, therefore, the constraints between the velocities of the tips of the bar change over time. One aspect of the present invention is pertinent to dynamic constraints. The algebraic equations that define a set of constraints define a manifold in the abstract space of the unconstrained states of the system, which is a surface or domain that includes all the possible system states that satisfy the set of constraints. The physical system is said to satisfy the set of constraints when the state it is in can be said to lie on the manifold defined by the equations that define the set of constraints. The present invention can be conceptualized as \u201cprojecting\u201d the state of the system which does not lie on the manifold in the \u201cprevious\u201d state to a point on the manifold that corresponds to the first state of the system but under the new constraints. In the case of a dynamic constraint, even if the point in time when the constraints change can be determined precisely, for example, by using a variable-step solver, the state of the system still has to be projected to a point on the new manifold. In general, the projection is required for dynamic constraints, particularly when one or more independent states are removed.",{"@attributes":{"id":"p-0039","num":"0038"},"figref":"FIG. 4","b":["202","120","204"],"sub":["s","1 ","2","1","2 ","2","r "],"br":{},"in-line-formulae":[{},{}],"i":"x=Py+g"},"Here, the vector g=g(t) denotes one or more user specified states that are included in the system state x. The user can prescribe in g any external input into the system. The non-zero entries in the vector g can denote motion actuation of the system. In step , the critical event energy minimizer  receives the last state of the system simulated under the first set of constraints. In a preferred embodiment of the present invention, the last state of the system simulated under the first set of constraints occurs at time t. Alternatively, the last state of the system simulated under the first set of constraints can occur at a time after time t.","In step , the critical event energy minimizer  calculates the first state x of the physical system under the second set of constraints. In a preferred embodiment of the present invention, the first state x of the physical system is calculated at time t. Alternatively, the first state x of the physical system is calculated at a time after time t. In a preferred embodiment of the present invention, the critical event energy minimizer  minimizes the energy of the error between the last state under the first set of constraints and the first state under the second set of constraints. This minimization is further preferred to occur at time t, but can also occur at a time after time t. In another embodiment of the present invention, the critical event energy minimizer  minimizes the energy of the error between the first state under the second set of constraints and an intermediate state derived from the last state that was simulated under the first set of constraints. The intermediate state can be calculated based on the second set of constraints and using the last state that was simulated under the first set of constraints as initial conditions to the DAEs corresponding to the second set of constraints. In one embodiment of the present invention, the intermediate state is calculated at the same time sample as the first state of the system under the second set of constraints. Let xdenote either the last state simulated under the first set of constraints or the intermediate state derived from the last state and the energy of the error, T(x), can be expressed as the following assuming the body elements have mass or inertia given by the mass matrix M",{"@attributes":{"id":"p-0042","num":"0041"},"maths":{"@attributes":{"id":"MATH-US-00001","num":"00001"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"mi":"T","mo":"\u2061","mrow":{"mo":["(",")"],"mi":"x"}},{"mfrac":{"mn":["1","2"]},"mo":["\u2062","\u2062"],"msup":{"mrow":{"mo":["(",")"],"mrow":{"mi":"x","mo":"-","msub":{"mi":"x","mn":"0"}}},"mi":"T"},"mrow":{"mrow":{"mi":"M","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mi":"x","mo":"-","msub":{"mi":"x","mn":"0"}}}},"mo":"."}}],"mo":"="}},{"mrow":{"mo":["(",")"],"mn":"2"}}]}}}},"br":{}},{"@attributes":{"id":"p-0043","num":"0042"},"maths":{"@attributes":{"id":"MATH-US-00002","num":"00002"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mrow":[{"mi":"T","mo":"\u2061","mrow":{"mo":["(",")"],"mi":"y"}},{"mfrac":{"mn":["1","2"]},"mo":["\u2062","\u2062"],"msup":{"mrow":{"mo":["(",")"],"mrow":{"mrow":{"mi":["p","y"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},"mo":["+","-"],"mi":"g","msub":{"mi":"x","mn":"0"}}},"mi":"T"},"mrow":{"mrow":{"mi":"M","mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"mrow":{"mi":["P","y"],"mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}}},"mo":["+","-"],"mi":"g","msub":{"mi":"x","mn":"0"}}}},"mo":"."}}],"mo":"="}},{"mrow":{"mo":["(",")"],"mn":"3"}}]}}}},"br":[{},{}],"in-line-formulae":[{},{}],"i":["y=","P","MP","P","M","x","\u2212g"],"sup":["T","\u22121","T"],"sub":"0"},"x can then be obtained by substituting equation (4) into equation (1), which yields\n\n()()+\u2003\u2003(5)\n","Equation (5) is then used to calculate the first state simulated under the second set of constraints. Equation (5) can also be understood as a projection from xto the manifold defined by the second set of constraints, where the projection result yields the minimum energy of the error (step  in ). Note that the mass matrix M that is used in the above calculations is the only matrix associated with the quadratic part of the system energy. In general, if the energy of the system can be expressed in the form T=xMx+2Bx=  M \u2212BMB, with =x+B, then the above formulation (equation 5) applies.","The first state simulated under the second set of constraints will ideally occur at time t, the same time as the detection of the critical event. However, one of ordinary skill in the art will appreciate that the first state simulated under the second set of constraints can be chosen to be at time t=t+\u0394t, where \u0394t is the time step, or any other time sample after time t. In this case, the last state simulated under the first set of constraints may or may not be at time t(when the detection of the critical event occurs), and a user or software developer can decide if the last state simulated under the first set of constraints or an intermediate state derived from the last state will be used to minimize the energy of the error with respect to the first state simulated under the second set of constraints.","Using the present invention, the erroneous or inaccurate simulation results obtained at time tunder the first set of constraints do not propagate to the simulation results at time tobtained under the second set of constraints as happened in . The simulation results for the first state simulated under the second set of constraints are obtained by minimizing the energy of the error between the last state simulated under the first set of constraints and the first state simulated under the second set of constraints. Alternatively, the energy of the error can be minimized between the first state that was simulated under the second set of constraints and an intermediate state derived from the last state that was simulated under the first set of constraints. In a preferred embodiment of the present invention, the last state simulated under the first set of constraints and the first state simulated under the second set of constraints are obtained at the same time sample and the minimization of energy of the error also occurs at the same time sample.","To better understand the present invention, the following is a mechanical example that illustrates how the present invention can be applied. Given two shafts with inertia and connected by a clutch, a fixed-step solver is used to execute the model of the mechanical system before and after the clutch locks. The clutch locking event is assumed to fall between two time samples and it is further assumed that the fixed-step solver does not detect the clutch locking event until the later of the two time samples. The two shafts can be modeled using two states, which are denoted here as xand x. The two shafts can have associated inertia mand m. The system before the locking event is denoted using a superscript A and the system after the locking event is denoted using a superscript B. The superscripts \u2212 and + are used to further denote that states right before and right after the constraint change in the simulation (as opposed to the ideal scenario). The state of the system can be denoted by",{"@attributes":{"id":"p-0049","num":"0048"},"maths":{"@attributes":{"id":"MATH-US-00003","num":"00003"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":{"mi":"X","mo":"=","mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"msub":{"mi":"x","mn":"1"}}},{"mtd":{"msub":{"mi":"x","mn":"2"}}}]}}},"mo":","}}},"br":{}},"Before the clutch locks, the total (kinetic) energy of the system T can be expressed as",{"@attributes":{"id":"p-0051","num":"0050"},"maths":{"@attributes":{"id":"MATH-US-00004","num":"00004"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msup":{"mi":["T","A"]},"mo":"=","mrow":{"mrow":[{"mfrac":{"mn":["1","2"]},"mo":["\u2062","\u2062"],"msub":{"mi":"m","mn":"1"},"msubsup":{"mi":"v","mrow":{"mn":"1","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"},"mn":"2"}},{"mfrac":{"mn":["1","2"]},"mo":["\u2062","\u2062"],"msub":{"mi":"m","mn":"2"},"mrow":{"msubsup":{"mi":"v","mrow":{"mn":"2","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"},"mn":"2"},"mo":"."}}],"mo":"+"}}}},"br":[{},{}],"in-line-formulae":[{},{}],"i":["N","=m","v","+m","v"],"sup":"A","sub":["1","1A","2","2A"]},"After the clutch locks, conservation of momentum dictates that the velocity of the composite system and the velocities of the system and the shafts can be expressed as",{"@attributes":{"id":"p-0053","num":"0052"},"maths":{"@attributes":{"id":"MATH-US-00005","num":"00005"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msub":{"mi":["v","B"]},"mo":"=","mrow":{"msub":{"mi":"v","mrow":{"mn":"1","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"B"}},"mo":"=","mrow":{"msub":{"mi":"v","mrow":{"mn":"2","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"B"}},"mo":"=","mrow":{"mrow":[{"mfrac":{"msub":{"mi":"m","mn":"1"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","msub":{"mi":"v","mrow":{"mn":"1","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"}}},{"mfrac":{"msub":{"mi":"m","mn":"2"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","mrow":{"msub":{"mi":"v","mrow":{"mn":"2","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"}},"mo":"."}}],"mo":"+"}}}}}}},"The momentum of the system is conserved because\n\n=().\u2003\u2003(6)\n\nThe energy of the system after the clutch locks becomes\n",{"@attributes":{"id":"p-0055","num":"0054"},"maths":{"@attributes":{"id":"MATH-US-00006","num":"00006"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msup":{"mi":["T","B"]},"mo":"=","mrow":{"mfrac":{"mn":["1","2"]},"mo":["\u2062","\u2062"],"mrow":[{"mo":["(",")"],"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},{"msup":{"mrow":{"mo":["(",")"],"mrow":{"mrow":[{"mfrac":{"msub":{"mi":"m","mn":"1"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","msub":{"mi":"v","mrow":{"mn":"1","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"}}},{"mfrac":{"msub":{"mi":"m","mn":"2"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","msub":{"mi":"v","mrow":{"mn":"2","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"}}}],"mo":"+"}},"mn":"2"},"mo":"."}]}}},{"mrow":{"mo":["(",")"],"mn":"7"}}]}}}},"br":{},"sub":["1A","2A"]},{"@attributes":{"id":"p-0056","num":"0055"},"maths":{"@attributes":{"id":"MATH-US-00007","num":"00007"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msup":{"mi":["T","B"]},"mo":"=","mrow":{"mrow":{"mfrac":{"mn":["1","2"]},"mo":["\u2062","\u2062"],"mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"msubsup":{"mi":["v","A"],"mn":"2"}},"mo":"=","msup":{"mi":["T","A"]}}}}},"br":{}},"This example can also be formulated using the velocities of the shafts as the solver states:",{"@attributes":{"id":"p-0058","num":"0057"},"maths":{"@attributes":{"id":"MATH-US-00008","num":"00008"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"mi":"X","mo":"=","mrow":{"mrow":[{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"msub":{"mi":"x","mn":"1"}}},{"mtd":{"msub":{"mi":"x","mn":"2"}}}]}},{"mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"msub":{"mi":"v","mn":"1"}}},{"mtd":{"msub":{"mi":"v","mn":"2"}}}]}},"mo":"."}],"mo":"="}}},{"mrow":{"mo":["(",")"],"mn":"8"}}]}}}},"br":{}},{"@attributes":{"id":"p-0059","num":"0058"},"maths":{"@attributes":{"id":"MATH-US-00009","num":"00009"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msup":{"mi":["Y","A"]},"mo":"=","mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"msubsup":{"mi":["y","A"],"mn":"1"}}},{"mtd":{"msubsup":{"mi":["y","A"],"mn":"2"}}}]}}}}},"br":{}},{"@attributes":{"id":"p-0060","num":"0059"},"maths":{"@attributes":{"id":"MATH-US-00010","num":"00010"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msup":{"mi":["P","A"]},"mo":"=","mrow":{"mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":[{"mn":"1"},{"mn":"0"}]},{"mtd":[{"mn":"0"},{"mn":"1"}]}]}},"mo":"."}}}},"br":{}},{"@attributes":{"id":"p-0061","num":"0060"},"maths":{"@attributes":{"id":"MATH-US-00011","num":"00011"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":[{"mtd":{"mrow":{"msup":{"mi":["Y","B"]},"mo":"=","mrow":{"mo":["[","]"],"msup":{"mi":["Y","B"]}}}}},{"mtd":{"mrow":{"msup":{"mi":["P","B"]},"mo":"=","mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"mn":"1"}},{"mtd":{"mn":"1"}}]}}}}}]}}},"br":{}},"Suppose that the transition from the old constraints to the new constraints does not occur until the fixed-step solver overshoots the transition time (the time when the clutch locks), then the simulated velocities after the clutch locks are not vand vas shown above, but rather\n\n+\u03b5and +\u03b5,\n\nwhere \u03b5and \u03b5are the corresponding difference of the ideal velocities v, vand the simulated velocities v and v at the time when the clutch locking event is detected by the fixed-step solver. The pre-transition momentum and the energy are then expressed as\n\n(+\u03b5)+(+\u03b5)\u2003\u2003(9)\n",{"@attributes":{"id":"p-0063","num":"0062"},"maths":{"@attributes":{"id":"MATH-US-00012","num":"00012"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msup":{"mi":["T","A"]},"mo":"=","mrow":{"mfrac":{"mn":["1","2"]},"mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"msup":[{"mrow":{"msub":{"mi":"m","mn":"1"},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mrow":{"mn":"1","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"}},{"mi":"\u025b","mn":"1"}],"mo":"+"}}},"mn":"2"},{"mrow":{"msub":{"mi":"m","mn":"2"},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mrow":{"mn":"2","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"}},{"mi":"\u025b","mn":"2"}],"mo":"+"}}},"mn":"2"}],"mo":"+"}}}}},{"mrow":{"mo":["(",")"],"mn":"10"}}]}}}},"br":[{},{}],"in-line-formulae":[{},{}],"i":["N","=m","v","m","v"],"sup":"B+","sub":["1","1","1","2","2","2"]},{"@attributes":{"id":"p-0064","num":"0063"},"maths":{"@attributes":{"id":"MATH-US-00013","num":"00013"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msup":{"mi":"T","mrow":{"mi":"B","mo":"+"}},"mo":"=","mrow":{"mfrac":{"mn":["1","2"]},"mo":"\u2062","mrow":{"mrow":[{"mo":["(",")"],"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},{"mo":["[","]"],"mrow":{"mrow":[{"mfrac":{"msub":{"mi":"m","mn":"1"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mn":"1"},{"mi":"\u025b","mn":"1"}],"mo":"+"}}},{"mfrac":{"msub":{"mi":"m","mn":"2"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mn":"2"},{"mi":"\u025b","mn":"2"}],"mo":"+"}}}],"mo":"+"}}],"mo":"\u2061"}}}},{"mrow":{"mo":["(",")"],"mn":"12"}}]}}}}},"At the transition time, the velocities of the two shafts are equal, hence the velocity of the composite system m+mis equal to both the velocities of mand m. After the clutch locks, the velocities of the two shafts are supposed to be the same, but if a fixed-step solver overshoots the transition time, then the velocities are different by the time the fixed-step solver make the transition from the old constraints to the new constraints. For the following equations, the velocity of both of the shafts at the transition time would be assumed to be the velocity of one of the shafts at the transition time. In the prior art, the post-transition momentum and energy is then be expressed as\n\n(+\u03b5)+(+\u03b5)\n",{"@attributes":{"id":"p-0066","num":"0065"},"maths":{"@attributes":{"id":"MATH-US-00014","num":"00014"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msup":{"mi":["T","B"]},"mo":"=","mrow":{"mfrac":{"mn":["1","2"]},"mo":"\u2061","mrow":{"mo":["[","]"],"mrow":{"msup":[{"mrow":{"msub":{"mi":"m","mn":"1"},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mrow":{"mn":"1","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"}},{"mi":"\u025b","mn":"1"}],"mo":"+"}}},"mn":"2"},{"mrow":{"msub":{"mi":"m","mn":"2"},"mo":"\u2061","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mrow":{"mn":"1","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"}},{"mi":"\u025b","mn":"1"}],"mo":"+"}}},"mn":"2"}],"mo":"+"}}}}}},"br":[{},{}],"in-line-formulae":[{},{}],"i":["N","=m","v","\u2212v"],"sup":"B","sub":["2","1A","1","2A","2"]},{"@attributes":{"id":"p-0067","num":"0066"},"maths":{"@attributes":{"id":"MATH-US-00015","num":"00015"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mrow":[{"mi":"\u0394","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"msup":{"mi":["T","B"]}},{"mfrac":{"mn":["1","2"]},"mo":["\u2062","\u2062"],"mrow":[{"mo":["(",")"],"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},{"mo":["{","}"],"mrow":{"msup":[{"mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mrow":{"mn":"1","mo":["\u2062","\u2062"],"mstyle":{"mspace":{"@attributes":{"width":"0.3em","height":"0.3ex"}}},"mi":"A"}},{"mi":"\u025b","mn":"1"}],"mo":"+"}},"mn":"2"},{"mrow":{"mo":["[","]"],"mrow":{"mrow":[{"mfrac":{"msub":{"mi":"m","mn":"1"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mn":"1"},{"mi":"\u025b","mn":"1"}],"mo":"+"}}},{"mfrac":{"msub":{"mi":"m","mn":"2"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mn":"2"},{"mi":"\u025b","mn":"2"}],"mo":"+"}}}],"mo":"+"}},"mn":"2"}],"mo":"-"}}]}],"mo":"="}}}},"Using the present invention, the velocity states in equation (8) are projected as follows:\n\n(),\n\nFrom which\n",{"@attributes":{"id":"p-0069","num":"0068"},"maths":[{"@attributes":{"id":"MATH-US-00016","num":"00016"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"X","mo":"=","mrow":{"msub":{"mi":["v","B"]},"mo":"\u2061","mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"mn":"1"}},{"mtd":{"mn":"1"}}]}}}}}},{"@attributes":{"id":"MATH-US-00016-2","num":"00016.2"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msub":{"mi":["v","B"]},"mo":"=","mrow":{"mrow":[{"mfrac":{"msub":{"mi":"m","mn":"1"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mn":"1"},{"mi":"\u025b","mn":"1"}],"mo":"+"}}},{"mfrac":{"msub":{"mi":"m","mn":"2"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","mrow":{"mo":["(",")"],"mrow":{"msub":[{"mi":"v","mn":"2"},{"mi":"\u025b","mn":"2"}],"mo":"+"}}}],"mo":"+"}}}}]},"With respect to the ideal fixed-step post-transition values, equations (11) and (12), the errors are zero:\n\n\u0394=0\n\n\u0394=0\n","Alternatively, the example can be formulated to use momenta as the solver states:",{"@attributes":{"id":"p-0072","num":"0071"},"maths":{"@attributes":{"id":"MATH-US-00017","num":"00017"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"X","mo":"=","mrow":{"mrow":[{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"msub":{"mi":"x","mn":"1"}}},{"mtd":{"msub":{"mi":"x","mn":"2"}}}]}},{"mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"msub":{"mi":"N","mn":"1"}}},{"mtd":{"msub":{"mi":"N","mn":"2"}}}]}},"mo":"."}],"mo":"="}}}},"br":{}},{"@attributes":{"id":"p-0073","num":"0072"},"maths":{"@attributes":{"id":"MATH-US-00018","num":"00018"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msup":{"mi":["Y","A"]},"mo":"=","mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"msubsup":{"mi":["y","A"],"mn":"1"}}},{"mtd":{"msubsup":{"mi":["y","A"],"mn":"2"}}}]}}}}},"br":{}},{"@attributes":{"id":"p-0074","num":"0073"},"maths":{"@attributes":{"id":"MATH-US-00019","num":"00019"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msup":{"mi":["P","A"]},"mo":"=","mrow":{"mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":[{"mn":"1"},{"mn":"0"}]},{"mtd":[{"mn":"0"},{"mn":"1"}]}]}},"mo":"."}}}},"br":{}},{"@attributes":{"id":"p-0075","num":"0074"},"maths":[{"@attributes":{"id":"MATH-US-00020","num":"00020"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msup":{"mi":["Y","B"]},"mo":"=","mrow":{"mo":["\u230a","\u230b"],"msup":{"mi":["y","B"]}}}}},{"@attributes":{"id":"MATH-US-00020-2","num":"00020.2"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"msup":{"mi":["P","B"]},"mo":"=","mrow":{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"mn":"1"}},{"mtd":{"mfrac":{"msub":[{"mi":"m","mn":"2"},{"mi":"m","mn":"1"}]}}}]}}}}}]},"From equation (1), the momentum of the first shaft after the clutch locks is ideally",{"@attributes":{"id":"p-0077","num":"0076"},"maths":{"@attributes":{"id":"MATH-US-00021","num":"00021"},"math":{"@attributes":{"overflow":"scroll"},"mtable":{"mtr":{"mtd":[{"mrow":{"msubsup":{"mi":["N","B"],"mn":"1"},"mo":"=","mrow":{"mrow":[{"mfrac":{"msub":{"mi":"m","mn":"1"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","msup":{"mi":["N","B"]}},{"mfrac":{"msub":{"mi":"m","mn":"1"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}},"mo":"\u2062","mrow":{"mo":["(",")"],"mrow":{"msubsup":[{"mi":["N","A"],"mn":"1"},{"mi":["N","A"],"mn":"2"}],"mo":"+"}}}],"mo":"="}}},{"mrow":{"mo":["(",")"],"mn":"13"}}]}}}}},"Using the present invention, the velocity states in equation (8) are projected as follows:\n\n(),\n\nfrom which, the expression\n",{"@attributes":{"id":"p-0079","num":"0078"},"maths":{"@attributes":{"id":"MATH-US-00022","num":"00022"},"math":{"@attributes":{"overflow":"scroll"},"mrow":{"mi":"X","mo":"=","mrow":{"mrow":[{"mrow":[{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"mn":"1"}},{"mtd":{"mfrac":{"msub":[{"mi":"m","mn":"2"},{"mi":"m","mn":"1"}]}}}]}},{"mo":["(",")"],"mrow":{"msubsup":[{"mi":["N","A"],"mn":"1"},{"mi":["N","A"],"mn":"2"}],"mo":"+"}}],"mo":["\u2062","\u2062"],"msup":{"mrow":[{"mo":["(",")"],"mrow":{"mn":"1","mo":"+","mfrac":{"msub":[{"mi":"m","mn":"2"},{"mi":"m","mn":"1"}]}}},{"mo":"-","mn":"1"}]}},{"mrow":[{"mo":["[","]"],"mtable":{"mtr":[{"mtd":{"mn":"1"}},{"mtd":{"mfrac":{"msub":[{"mi":"m","mn":"2"},{"mi":"m","mn":"1"}]}}}]}},{"mo":["(",")"],"mrow":{"msubsup":[{"mi":["N","A"],"mn":"1"},{"mi":["N","A"],"mn":"2"}],"mo":"+"}}],"mo":["\u2062","\u2062"],"mfrac":{"msub":{"mi":"m","mn":"1"},"mrow":{"msub":[{"mi":"m","mn":"1"},{"mi":"m","mn":"2"}],"mo":"+"}}}],"mo":"="}}}},"br":[{},{}],"in-line-formulae":[{},{}],"i":["N","T"],"sup":["B","B"]},{"@attributes":{"id":"p-0080","num":"0079"},"figref":["FIG. 5A","FIG. 1A","FIG. 2B"],"b":["42","44","46","22","24","26","42","44","46"],"sub":["2 ","3 ","3","3 ","3","2 ","3 "]},{"@attributes":{"id":"p-0081","num":"0080"},"figref":["FIG. 5B","FIG. 1A"],"b":["42","44","46","22","24","26","42","44"],"sub":["2 ","2","2 "]},"The present invention is also applicable to systems with variable masses or moment of inertia, resulting in parameterized matrices causing nonlinear problem formulations. The following are two approaches that are suitable to practice with an embodiment of the present invention.","First Approach:","Substituting M with M(x) in equation (5). Since there is no unknown in M(x), M(x) can be easily calculated and hence x in equation (5) can be easily obtained.","Second Approach:","Substituting M with M(x) in equation (3) and performing an iterative minimization solve of the new equation to obtain y and the corresponding x. In general, the mass matrix can be constructed from parameters such as mechanical stiffness, electrical inductance, electrical capacity, fluid capacity, fluid inertia, etc. These parameters may be expressed as functions of system variables and can be used to compute the energy in the system. As such, the present invention can be applied in different domains in physics, even if the physical model uses more than one domain in physics.",{"@attributes":{"id":"p-0085","num":"0084"},"figref":["FIG. 6","FIG. 1A","FIG. 5A"],"b":["300","302","312","22","302","310","24","302","306","26","302","304","22","304","302","24","304","318","302","308","24","308","316","24","314","300","300","320","322","324","302","22","26","24","320","322","324","326","326"]},"The present invention has been described above for illustrative purposes based on Simulink\u00ae-based applications from The MathWorks, Inc. of Natick, Mass. Nevertheless, those skilled in the art will appreciate that the principles and concepts described above are equally applicable to other modeling environments, such as Rhapsody from I-Logix Inc. of Andover, Mass., TargetLink and Real-Time Interface from dSPACE GmbH of Germany, RT-LABT\u2122 from Opal-RT Technologies, Inc. of Canada, EXITE from EXTESSY AG of Germany, LabVIEW\u00ae, MATRIXx, HyperSignal\u00ae from National Instruments, Inc. of Austin, Tex., SystemVue\u2122 from Agilent Technologies, Inc. of Palo Alto, Calif., COSSAP from Synopsys, Inc. of Mountain View, Calif., Ptolemy from University of California at Berkeley at Berkeley, Calif., Dymola from Dynasim AB of Sweden, acslXtreme\u00ae from The AEgis Technologies Group, Inc. of Huntsville, Ala., 20sim from Controllab Products B.V. of Netherlands, and other like graphical and non-graphical modeling environments that can model and simulate a physical or electrical system. Textual languages to which aspects of this invention can be applied include, but are not limited to, Modelica\u2122 and VHDL with the analog (AMS) extension, VHDL-AMS.","The present invention is not limited to a dedicated subsystem in a model that models a physical system. The present invention is also applicable to a model with different environment settings within the same model. For example, one mechanical machine may be simulated in an environment where gravity of Earth is modeled, whereas another machine may be simulated in an environment with zero gravity, both being part of the same model. Environment settings include, but not limited to, whether the machine should be analyzed in a two-dimensional or three-dimensional model, what assembly and constraint tolerances to apply, or what method to employ for linearization of the machine. The present invention is also applicable to cross-domain models, such as multi-tasking control systems on top of a physical model, a physical model embedded in an environment for a control system design, a physical model that has event-driven aspects or that is combined with a model part that is executed in an event-driven manner, a physical model used with a state-diagram modeling environment. A mixture of elements from different application domains can be used in a physical model in every level of the hierarchy and it is not necessary to have a dedicated subsystem to have a different environment setting.","In one aspect of the present invention, the model may be constructed by means of an application programming interface (API). This interface may be directly accessed by a user through a set of textual commands, for example, to add blocks of a certain type, to connect blocks, or to set parameter values. Furthermore, the model may be processed in different ways as specified by the textual commands, for example, the model could be compiled, executed, loaded in memory, and the number of elements in the model could be counted, etc. In addition, the model may contain call-back instructions that are executed based on events that are part of the design of the model. For example, when a model is loaded, a sequence of commands may be executed that could affect the model that is being loaded into memory. Similarly, when the parameter dialog of a block is requested by double-clicking on the block, a call-back is initiated that may execute a sequence of commands first before bringing up the parameter dialog.","In another aspect of the present invention, the model may employ data that is stored in a global workspace, i.e., a workspace that can be accessed by any system that is compatible with the modeling environment. This data can include elaborate structures and is not limited to being one or more numeric values. This data can optionally include hierarchy information and can be modified directly by the user or operated on by other systems, for example for the purpose of data acquisition, signal processing, or optimization. Furthermore, the workspace can be organized in a hierarchical fashion, wherein local workspaces exist that can be accessed only by specific parts of the model hierarchy. Symbol resolution rules can be applied to resolve the references to a piece of data within these workspaces. The local workspaces can be associated with subsystems in the model by creating a mask for a subsystem. This mask facilitates the creation of a custom dialog for entering data to derive the values of the data in the local workspaces. Furthermore, the mask may be equipped with a number of call-backs and so may exist without being combined with a local workspace.","In still another aspect of the invention, the model may be employed for analyses such as linearization, trimming, and coverage analysis to determine the range of values that one or a set of simulation scenarios have covered. In case of coverage analysis, the discrete aspects of the model can be analyzed in terms of decision coverage, condition coverage, modified condition\/decision coverage (MC\/DC), etc. Graphical affordances allow depicting the coverage analysis results on the model. Furthermore, the model may be employed for optimizations, such as response optimization in the time and\/or frequency domain.","In another aspect of the present invention, the model may contain hot-links to system requirements as documented in a database, spreadsheet, text document, or other information container. These hot-links allow automatically navigating back and forth between the system requirements and the model, for example by means of a mouse click. The system requirements may, for example, capture explicit information about the effect of a dynamic constraint on the system behavior.","In still another aspect of the present invention, S-function code is generated from the model. An S-function is a component that can be captured in, for example, C, ADA, and M code, and that adheres to the Simulink\u00ae S-function interface. This S-function may include the projection algorithm of the present invention that minimizes the energy of the error. In a further aspect of the present invention, code can be generated from the model. For example, C code can be automatically generated that can be executed in real-time, for example for hardware-in-the-loop simulation, or the C code can be compiled into a shared library such as a dynamic link library (DLL) on versions of the Microsoft\u00ae Windows\u00ae operating systems. Additionally, a hardware description language (HDL) representation can be generated, for example for hardware accelerated simulation or reconfigurable input\/output signal conditioning such as CompactRIO of National Instruments, Inc.","Many alterations and modifications may be made by those having ordinary skill in the art without departing from the spirit and scope of the invention. Therefore, it must be expressly understood that the illustrated embodiments have been shown only for the purposes of example and should not be taken as limiting the invention, which is defined by the following claims. These claims are to be read as including what they set forth literally and also those equivalent elements which are insubstantially different, even though not identical in other respects to what is shown and described in the above illustrations."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE FIGURES","p":["The foregoing and other objects, aspects, features, and advantages of the invention will become more apparent and may be better understood by referring to the following description taken in conjunction with the accompanying drawings, in which:",{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 1A"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":["FIG. 1B","FIG. 1A"]},{"@attributes":{"id":"p-0019","num":"0018"},"figref":["FIG. 2A","FIG. 1A"]},{"@attributes":{"id":"p-0020","num":"0019"},"figref":["FIG. 2B","FIG. 1A"]},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":["FIG. 5A","FIG. 1A"]},{"@attributes":{"id":"p-0024","num":"0023"},"figref":["FIG. 5B","FIG. 1A"]},{"@attributes":{"id":"p-0025","num":"0024"},"figref":["FIG. 6","FIG. 1A"]}]},"DETDESC":[{},{}]}
