---
title: Heuristic determination of user origin
abstract: A system and method for independently determining the geographical location of a user accessing a networked system. The method may include gathering a plurality of inputs about the user's geographic location; weighting each input based on whether said input identifies a likelihood of true geographic location; determining whether each input verifies a geographic location specified by the user; and summing weights of the input factors verifying the specified geographic location. A system for independently determining the geographical location of a user includes a user login routine, a heuristic user geographic location determination engine, and at least one data store including a user profile record having a user specified geographic location.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=07636785&OS=07636785&RS=07636785
owner: Microsoft Corporation
number: 07636785
owner_city: Redmond
owner_country: US
publication_date: 20041116
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["BACKGROUND OF THE INVENTION","SUMMARY OF THE INVENTION","DETAILED DESCRIPTION"],"p":["1. Field of the Invention","The present invention is directed to distinguishing the physical location of users of a system coupled to a network such as the Internet.","2. Description of the Related Art","Companies who provide services over the Internet have an interest in determining with some certainty where individuals who use such services are geographically located. Users may have use preferences based on their location, and service providers can tailor service offerings based on location. In addition, providers may be concerned about providing services to regions where revenue generation is limited. In addition, legal restrictions on the types of services which may be provided to particular countries may exist.","While many service providers may simply ask users to specify their location, many providers would like to verify the user location in order to reduce risk. Additionally, providers can choose to reward users who correctly specify their location and\/or penalize dishonest users. Hence, a system for independently determining the geographical location of a user would be useful.","In one aspect, the invention comprises a method for independently determining the geographical location of a user accessing a networked system. In one aspect, this may include comparing the determined geographic location to a user specified location.","In a further aspect, the method comprises: gathering a plurality of inputs about the user's geographic location; weighting each input based on whether said input identifies a likelihood of true graphic location; determining whether each input verifies a geographic location specified by the user; and summing weights of the input factors verifying the specified geographic location.","In an alternative embodiment, the method may include the steps of: gathering profile information about a user including a user specified location; determining a user location by summing one or more input factors based on a weight assigned each input factor according to an assurance such factor identifies a likelihood of true geographic origin; comparing a determined user location to the user specified location; and altering the user experience based on said step of comparing.","The invention may also comprise a system in a computing environment. In this aspect, the invention may include a user login routine; a heuristic user geographic location determination engine; and at least one data store including a user profile record having a user specified geographic location.","In yet another embodiment, the invention may comprise a method of providing an email service. The method may include the steps of: providing a network coupled system including code for providing an email service to users; obtaining profile information about a user including a specified user location; heuristically determining a user location; comparing a determined user location to the user specified location; and varying the email service based on said step of comparing.","The present invention can be accomplished using hardware, software, or a combination of both hardware and software. The software used for the present invention is stored on one or more processor readable storage media including hard disk drives, CD-ROMs, DVDs, optical disks, floppy disks, tape drives, RAM, ROM or other suitable storage devices. In alternative embodiments, some or all of the software can be replaced by dedicated hardware including custom integrated circuits, gate arrays, FPGAs, PLDs, and special purpose computers.","These and other objects and advantages of the present invention will appear more clearly from the following description in which the preferred embodiment of the invention has been set forth in conjunction with the drawings.","In general, the invention provides a method and system for determining the geographical location of a user accessing a network system. In one aspect, the network may be any type of LAN or WAN, is a combination of public and private networks, such as the Internet. The geographical location of users accessing a network system or service may be important to a system administrator who may seek to provide services, or provide enhanced services, based on the geographical location of the user. The system of the present invention allows system administrator to tailor services based on the geographical location of a user with some certainty that the geographical location can be verified to some reasonable degree of certainty.","In one aspect, the invention may be performed on one or more processing devices or general computing systems.  illustrates an example of a suitable general computing system environment  on which the invention may be implemented. The computing system environment  is only one example of a suitable computing environment and is not intended to suggest any limitation as to the scope of use or functionality of the invention. Neither should the computing environment  be interpreted as having any dependency or requirement relating to any one or combination of components illustrated in the exemplary operating environment .","The invention is operational with numerous other general purpose or special purpose computing system environments or configurations. Examples of well known computing systems, environments, and\/or configurations that may be suitable for use with the invention include, but are not limited to, personal computers, server computers, hand-held or laptop devices, multiprocessor systems, microprocessor-based systems, set top boxes, programmable consumer electronics, network PCs, minicomputers, mainframe computers, distributed computing environments that include any of the above systems or devices, and the like.","The invention may be described in the general context of computer-executable instructions, such as program modules, being executed by a computer. Generally, program modules include routines, programs, objects, components, data structures, etc., that perform particular tasks or implement particular abstract data types. The invention may also be practiced in distributed computing environments where tasks are performed by remote processing devices that are linked through a communications network. In a distributed computing environment, program modules may be located in both local and remote computer storage media including memory storage devices.","With reference to , an exemplary system for implementing the invention includes a general purpose computing device in the form of a computer . Components of computer  may include, but are not limited to, a processing unit , a system memory , and a system bus  that couples various system components including the system memory to the processing unit . The system bus  may be any of several types of bus structures including a memory bus or memory controller, a peripheral bus, and a local bus using any of a variety of bus architectures. By way of example, and not limitation, such architectures include Industry Standard Architecture (ISA) bus, Micro Channel Architecture (MCA) bus, Enhanced ISA (EISA) bus, Video Electronics Standards Association (VESA) local bus, and Peripheral Component Interconnect (PCI) bus also known as Mezzanine bus.","Computer  typically includes a variety of computer readable media. Computer readable media can be any available media that can be accessed by computer  and includes both volatile and nonvolatile media, removable and non-removable media. By way of example, and not limitation, computer readable media may comprise computer storage media and communication media. Computer storage media includes both volatile and nonvolatile, removable and non-removable media implemented in any method or technology for storage of information such as computer readable instructions, data structures, program modules or other data. Computer storage media includes, but is not limited to, RAM, ROM, EEPROM, flash memory or other memory technology, CD-ROM, digital versatile disks (DVD) or other optical disk storage, magnetic cassettes, magnetic tape, magnetic disk storage or other magnetic storage devices, or any other medium which can be used to store the desired information and which can accessed by computer . Communication media typically embodies computer readable instructions, data structures, program modules or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media. The term \u201cmodulated data signal\u201d means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal. By way of example, and not limitation, communication media includes wired media such as a wired network or direct-wired connection, and wireless media such as acoustic, RF, infrared and other wireless media. Combinations of the any of the above should also be included within the scope of computer readable media.","The system memory  includes computer storage media in the form of volatile and\/or nonvolatile memory such as read only memory (ROM)  and random access memory (RAM) . A basic input\/output system  (BIOS), containing the basic routines that help to transfer information between elements within computer , such as during start-up, is typically stored in ROM . RAM  typically contains data and\/or program modules that are immediately accessible to and\/or presently being operated on by processing unit . By way of example, and not limitation,  illustrates operating system , application programs , other program modules , and program data .","The computer  may also include other removable\/non-removable, volatile\/nonvolatile computer storage media. By way of example only,  illustrates a hard disk drive  that reads from or writes to non-removable, nonvolatile magnetic media, a magnetic disk drive  that reads from or writes to a removable, nonvolatile magnetic disk , and an optical disk drive  that reads from or writes to a removable, nonvolatile optical disk  such as a CD ROM or other optical media. Other removable\/non-removable, volatile\/nonvolatile computer storage media that can be used in the exemplary operating environment include, but are not limited to, magnetic tape cassettes, flash memory cards, digital versatile disks, digital video tape, solid state RAM, solid state ROM, and the like. The hard disk drive  is typically connected to the system bus  through a non-removable memory interface such as interface , and magnetic disk drive  and optical disk drive  are typically connected to the system bus  by a removable memory interface, such as interface .","The drives and their associated computer storage media discussed above and illustrated in , provide storage of computer readable instructions, date structures, program modules and other data for the computer . In , for example, hard disk drive  is illustrated as storing operating system , application programs , other program modules , and program data . Note that these components can either be the same as or different from operating system , application programs , other program modules , and program data . Operating system , application programs , other program modules , and program data  are given different numbers here to illustrate that, at a minimum, they are different copies. A user may enter commands and information into the computer  through input devices such as a keyboard  and pointing device , commonly referred to as a mouse, trackball or touch pad. Other input devices (not shown) may include a microphone, joystick, game pad, satellite dish, scanner, or the like. These and other input devices are often connected to the processing unit  through a user input interface  that is coupled to the system bus, but may be connected by other interface and bus structures, such as a parallel port, game port or a universal serial bus (USB). A monitor  or other type of display device is also connected to the system bus  via an interface, such as a video interface . In addition to the monitor, computers may also include other peripheral output devices such as speakers  and printer , which may be connected through a output peripheral interface .","The computer  may operate in a networked environment using logical connections to one or more remote computers, such as a remote computer . The remote computer  may be a personal computer, a server, a router, a network PC, a peer device or other common network node, and typically includes many or all of the elements described above relative to the computer , although only a memory storage device  has been illustrated in . The logical connections depicted in  include a local area network (LAN)  and a wide area network (WAN) , but may also include other networks. Such networking environments are commonplace in offices, enterprise-wide computer networks, intranets and the Internet.","When used in a LAN networking environment, the computer  is connected to the LAN  through a network interface or adapter . When used in a WAN networking environment, the computer  typically includes a modem  or other means for establishing communications over the WAN , such as the Internet. The modem , which may be internal or external, may be connected to the system bus  via the user input interface , or other appropriate mechanism. In a networked environment, program modules depicted relative to the computer , or portions thereof, may be stored in the remote memory storage device. By way of example, and not limitation,  illustrates remote application programs  as residing on memory device . It will be appreciated that the network connections shown are exemplary and other means of establishing a communications link between the computers may be used.",{"@attributes":{"id":"p-0035","num":"0034"},"figref":["FIG. 2","FIG. 2"],"b":["202","204","206","208","210","202","204"]},"At step , the system administrator determines which of any number of input factors are to be utilized in the determination. In this context, the System Administrator is an entity that could be a human or potential automated algorithm. For geographic location, the input factors can comprise any number of items, including, but not limited to: the type of IP address the user is logging in from, (with types including information such as whether the IP is a broadband, anonymous, proxy server, or AOL address); the location of the user, by continent, or region; the time zone that the user is logging in from; the latitude, or longitude of the IP; the IP routing type; and\/or numerous other factors. These inputs can be determined from any number of sources. In one embodiment, the system administrator can gather data and maintain its own database of know geographic IP addresses. In another embodiment, commercially available services provide information about a login IP address for use by the administrator in its own algorithm.","In yet another aspect, a system administrator may gather certain types of information from the user themselves by requiring a user to provide a profile of information as part of a registration process prior to login onto the service provided. Such profile information may include name, address, zip code, time zone, country, phone number, language, credit card, and email addresses, as well as other such information to allow the user to gain access to the system.","Next, at step , the system administrator assigns a weight to each input factor chosen for evaluation. In one embodiment, the weight assigned is based on the factor's reliability in determining the geographical location of the user. For example, if an IP block is known to originate in a proxy server in China, one might assign the login IP factor a higher weight than, for example, a browser language specification in the user profile. In a browser language specification, it might be possible for a user to lie and input a language of, for example, English to pretend to be in the United States, while actually being logged in from China. It should be recognized that alternative weighting algorithms can be used. For example, one can assign weights to each different feature based on a set of \u201ctrusted\u201d information or a control group. In addition, the weighted algorithm may be automated, or supplemented by a machine learning algorithm which can optimize the weighting scheme.","As noted above, steps  and  comprise set-up steps for the method of the invention. Once these steps are completed, evaluation steps  and  may occur.","At step , data for each of the input factors for a given user is gathered. For example, each time a user registers with the system administrator, logs into the system, or at a timed specific interval, the input factors can be gathered and provided to a heuristic geographic location determination at step . In step , an independent determination can made as to whether the user has provided a true indication of the user's country of origin. Once the determination is made at step , at step , the information can be utilized by the system administrator or algorithm to vary the user experience or penalize the user based on the veracity of the user. Localized information can be used for other purposes as well, such as to provide localized content on customized web pages such as MY Yahoo or MY MSN.",{"@attributes":{"id":"p-0041","num":"0040"},"figref":["FIG. 3","FIG. 3"],"b":["208","206","302","304","306","308","310","312","316","318","320","320","322","324"]},"As noted above, in one embodiment, the invention may be utilized in determining a user accessing a networked system.  shows an example of two users ,  accessing a networked system  which provides a service via a network such as the Internet . System  may be a processing device as shown in  or equivalent. Likewise, each user may be accessing system  using a processing device as described with respect to  or its equivalent. System  includes code for implementing a service  which is provided to the user by the system administrator. In conjunction with the service , the system administrator may require a user to provide login information using a login module , and enter profile information which may be stored in a profile data store . Also shown in  is a geographic location engine  comprising code for instructing the system processing device  to perform the method in accordance with the present invention. System  may also include data stores for retaining additional information about the user relative to the user's location. These include a location history data store , a local login data store  and an enhanced country login data store . As will be explained in further detail below, these data stores ,  and  can be used to provide varying levels of the service  to users based on the user's veracity in providing location information to the administrator.","While the system can be used to provide any type of service, a specific embodiment of the invention is discussed below in the context of providing an enhanced email service. In this context, the service code  may comprise code for providing an on-line email service such as Microsoft\u00ae Hotmail. In one variation of providing this service, described below, the enhanced service is based on both the veracity of the user in specifying the user's login location, and whether the user is logging in from a specific country, referred to herein as an \u201cenhanced country\u201d. The method accounts for the possibility that countries defined as being enhanced countries may change over time.","In the context of providing a service, the system administrator may require users to establish a login account before providing the service to the user. In this context, the administrator may gather profile information about users.  shows use of the method of the present invention when establishing a new user for the service.","In , a new user  must first establish a service login by performing a signup procedure at step . The signup procedure  can be a forms or prompt driven process for gathering profile information which can include the first name, last name, email address, country or region that the user is logging in from, the gender of the user, the birth date and the occupation of the user. In addition, the user may be asked to specify a time zone. As noted above, such information may be provided in a data store such as profile data store .","At step , the geographic location method of the present invention makes an independent determination of user origin using the algorithm described in . In one aspect, this may comprise using the exemplary algorithm shown in . Based on the information provided at step  and the independent determination at step , a decision can be made at step  as to whether the user should be provided with an upgraded service, , or base service .",{"@attributes":{"id":"p-0047","num":"0046"},"figref":["FIG. 6","FIG. 3","FIG. 7"],"b":["602","604","606","608","604","608","612","610","610","610","610","616","612"]},"It should be further recognized that the terms \u201cbase service\u201d and \u201cupgraded service\u201d may include any number of individual features comprising a feature set. For example, where the method is used in conjunction with an email service, the base service may comprise providing the user with a 2 MB storage account, and the upgraded service may be providing a 25 MB storage account. After several additional logins or a probationary period, the upgraded service may be a higher level account, (for example, a 250 MB storage account,) with the 25 MB account serving as the \u201cbase service\u201d. Other features may include extending a period of account inactivity allowed before the account is deactivated. Each such feature set may be defined in terms of a user location and\/or the user's veracity with respect to whether the user is logging in from the location they specify.",{"@attributes":{"id":"p-0049","num":"0048"},"figref":["FIG. 7","FIGS. 5 and 6","FIG. 7"],"b":["506","606","702"]},"In , one aspect of the country IP look-up data  is an indication of whether the user is using an anonymous IP. An anonymous IP in this context means that the user is accessing the service with an anonymous proxy server to cloak the user's true IP address. If a user is using an anonymous IP, at step , a determination is made by the system administrator not to offer an enhanced service to such a user. As noted above, a system for implementing the invention may include a history data store , a local login data store , and an enhanced country login data store . If the user has logged in from an anonymous IP address, a counter in the local login data store is decremented and a counter in the enhanced country data store is decremented at step . The enhanced country count retains a record of whether or not the user is verified to have logged in from a country which is in the list of countries which the administrator has decided to offer the enhanced services. The local login counter maintains a record of whether or not the user actually logging in from the geographical location which the user has specified that the user logs in from.","If the country IP look-up is determined not to be anonymous at step , a determination is made at step  to whether the country is an enhanced country. If so, the enhanced country login count is incremented at step . If not, the count is decremented at step . In order to account for the possibility that countries defined as being enhanced countries may change over time, in one embodiment, the enhanced country login counter is never decremented below zero. This prevents users in countries which are not part of the initial list, but which are added to the list later, from being penalized by having a decremented count go below zero.","If the IP lookup results in a non-anonymous determination, and the country is an enhanced country, then the input factors are gathered at step  and provided to decision steps , , and . While in one embodiment, three input factors are used, it will be recognized that additional input factors  and  (shown in phantom) may be used depending on the granularity and specificity of the determination desired.","The profile country decision  determines whether the input country login IP matches the user's specified country. The time zone decision  determines whether the time zone data from the user login matches the time zone which would be found in the country which the user specified in the user's profile. For example, a determination is made as to whether the login time of the user matches the time zone for North America to verify that the user is in fact in a North American region. The browser language decision determines whether the user's login browser language setting matches the user's profile language. This would prevent a user in, for example, China, specifying that the browser language should be English when in fact the user is using Chinese. In such a situation, it is more likely that the user is in fact in China.","For each valid result of steps , , , a number of points are assigned based on the weighting factors which the system administrator determined the factor is worth. For example, the profile country is matched with the country IP from which the user is logging into, 30 points are added at step ; if the time zone matches the country at , 10 points are added at , and if the language and profile matches the login country, then 20 points are added at . The number of points is then summed and at step , if the sum is greater than a specified threshold, the user is determined to be making a local login. In this example, the threshold is 30 points. If the user has greater than or equal to 30 points as a result of the answers at step , , , then the user is determined to have made a local login at step  and the local login count and history record are updated at . If not, the user is making a non-local login at step  and the counts are decremented accordingly at . Alternative thresholds may be set, depending on how the factors are weighted and used. In one alternative, for example, one factor (for example, Factor N) is set as a time counter which tests true when the user has logged in after an allotted period of time has passed since the user's first login. In this example, the counter may add some number of points, for example 10 per login per day or X points over a specific period, and the threshold increased to account for the desired delay in determining a valid local login. For example, a user may be required to login three times at least one day after the user's initial login from the same point, adding thirty points to the total number calculated, with the threshold increased to 60 to result in a valid local login.","In the embodiment of , the country IP lookup by itself is deemed sufficient to overcome the threshold. Alternatively, a match of the time zone and language tests  or  will overcome the threshold. It will be recognized that a unique element of the invention is the ability to vary the factors, weights and threshold to provide an increased or decreased level of certainty in the geographical location determination.","Using the data in the enhanced country counter and the local login counter, the system administrator can determine whether to change the user status at steps  or . For example, if the user is determined to be logging in from a country in which an enhanced service is provided, and is determined to have made a successful local login, the enhanced service can be provided.","In one embodiment, an additional factor which may be considered in the method of  (in factor  or ) may comprise input from user supplied or third party content distribution networks. Content distribution networks provide web content to so-called \u201cedge\u201d servers\u2014servers which are closer in proximity (either network routing proximity or geographic proximity) to a user than a service provider's main hosting environment may be. The content distribution network stores information from other web servers and responds to user requests for information from the service provider's web server. The service provider can obtain information on the geographical location of a user by taking as input to the method of  information on which edge server is responding to a particular user. Such information can come from companies who provide content distribution networks, such as Akamai Technologies, Inc., of Cambridge, Mass., or from a content network built by the service provider itself using devices such as those available from Netscaler, Inc. of San Jose, Calif. Users seeking to circumvent such content distribution networks will generally suffer severely degraded performance, Hence, the weighting of each factor , , , and this factor may be altered according to the assurance one has that data from the distribution network is likely a correct indicator of geographic location based on the server being used to access the administrator's service.","As noted above, in certain implementations, the enhanced user login counter may not be decremented below zero. In one aspect, the local login counter may be decremented below zero. This counter, in conjunction with the history information, is retained by the system administrator and may be used to reward the user or penalize users who repeatedly attempt to use the service dishonestly.","In another embodiment, enhanced services can be tracked and provided for individual countries or features, and the criteria for upgrading or downgrading each individual feature maintained separately. For example, assume users in countries A and B should be provided with enhanced services after a 30 day probation period, but users in country C should only be provided with enhanced services after 60 days. In another example, users in countries A, B and C are all provided with enhanced service after a probation period, but users in country C should deactivated or downgraded from the enhanced service to a basic service after some period of inactivity.",{"@attributes":{"id":"p-0060","num":"0059"},"figref":["FIG. 8","FIG. 6"]},"In , the probation period determination step  is made on a per feature basis. Different features or feature sets can have different probation periods, so that step  may be calculated for different feature sets after a first upgraded feature set is provided. Which features or feature sets are provided, or how long a user must wait to be provided such feature, can be dependent on the location of the user. For example, step  may define a first feature set including an upgrade from a base feature set or service to a second level of service after a first period. While the user is in a first feature set probation period they are given their base or existing level of service at step . Once the probation period is reached, a second feature set probation period is checked in step , until the next upgraded period is reached, when they are upgraded to the next level at step .",{"@attributes":{"id":"p-0062","num":"0061"},"figref":["FIG. 9","FIG. 4","FIG. 9","FIG. 4"],"b":["960","962","964","960","962","964"]},"Counters , , and  may be used by the alternative method of , an alternative to the method of , to track user information to provide enhanced feature sets as discussed above. Steps in the method of  which are equivalent to those set forth in  are identically numbered. In , steps , and  increment, and step  decrements, the per country (or per feature) login counts based on the determination of the anonymous login at step  or enhanced country login at step .","In a further aspect of the invention, the system administrator may provide users with an opportunity to prove their origin. In cases where the independent geographical location determination specifies a user is not in the country they allege to be from, a user can be provided with the opportunity to prove they reside in an eligible enhanced country. In one aspect, this may include sending a posted letter to the user's address with a product key that the user can enter into the login service, sending an SMS message to a user's cell phone using the correct country code, or obtaining credit card information to verify the country.","The foregoing detailed description of the invention has been presented for purposes of illustration and description. It is not intended to be exhaustive or to limit the invention to the precise form disclosed. Many modifications and variations are possible in light of the above teaching. The described embodiments were chosen in order to best explain the principles of the invention and its practical application to thereby enable others skilled in the art to best utilize the invention in various embodiments and with various modifications as are suited to the particular use contemplated. It is intended that the scope of the invention be defined by the claims appended hereto."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":[{"@attributes":{"id":"p-0014","num":"0013"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0015","num":"0014"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0016","num":"0015"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0017","num":"0016"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0018","num":"0017"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0019","num":"0018"},"figref":"FIG. 6"},{"@attributes":{"id":"p-0020","num":"0019"},"figref":"FIG. 7"},{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 8"},{"@attributes":{"id":"p-0022","num":"0021"},"figref":"FIG. 9"},{"@attributes":{"id":"p-0023","num":"0022"},"figref":"FIG. 10"}]},"DETDESC":[{},{}]}
