---
title: Application resource usage behavior analysis
abstract: A method, system, and apparatus are disclosed, which include injecting shadow input/outputs (shadow IOs) into a system, removing the shadow IOs from the system, storing the shadow IOs, and analyzing the stored shadow IOs to determine application specific behavioral information about the system.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09600182&OS=09600182&RS=09600182
owner: EMC IP Holding Company LLC
number: 09600182
owner_city: Hopkinton
owner_country: US
publication_date: 20090624
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"p":["A portion of the disclosure of this patent document may contain command formats and other computer language listings, all of which are subject to copyright protection. The copyright owner has no objection to the facsimile reproduction by anyone of the patent document or the patent disclosure, as it appears in the Patent and Trademark Office patent file or records, but otherwise reserves all copyright rights whatsoever.","This invention relates to application IT resource usage and behaviors.","In many computer systems using external data storage subsystems, there are multiple physical paths, or buses, to each data storage subsystem. One reason for having multiple paths is to provide redundancy in the case of a failed path. The selection of a path for sending an I\/O request can affect the quality of service for applications initiating I\/O requests because paths have limited capacity for carrying data. Path capacity limitations may be the result of multiple influences, such as the fundamental bandwidth limitation of the physical connection or the storage subsystem's front-end resources for processing requests.","A method, system, and apparatus are disclosed, which include injecting shadow input\/outputs (shadow IOs) into a system, removing the shadow IOs from the system, storing the shadow IOs, and analyzing the stored shadow IOs to determine application specific behavioral information about the system.","Current application resource management solutions are typically limited in understanding behavior of application IT resource usage and behavior. However, Application focused solutions could benefit from application-specific behavioral knowledge. The techniques described herein provide the ability to understand application resource usage behavior and generate real-time or historical traffic map for a data center.","In an embodiment, these techniques may leverage the PowerPath architecture, described herein, to perform application specific behavioral analysis. This may be performed by creating shadow Input\/Outputs (shadow I\/Os) and injecting these shadow I\/Os into the system. The shadow I\/Os may be cloned IOs, where the frequency and number of shadow I\/Os injected may be determined through an adaptive sampling algorithm. As well, the shadow I\/Os can be appended to an application data stream or can be the result of a test of the traffic currently on the system.","The sampling algorithm may be adaptive and can be tuned dynamically to fit business needs. The shadow IO can contain application information, performance data and resource consumption information. As well, a correlation engine may collect shadow IOs and analyze the information collected to understand application resource usage, QoS and traffic of a data center. The correlation engine may leverage structural configuration information collected by current EMC products. A real-time\/historical traffic map can be generated to support change management decisions such as provisioning and datacenter rebalancing, etc.","The techniques described may dynamically collect and analyze the application-based use and behavior of IT resources. It may provide application level performance and resource usage behavior intelligence data. This data may enable and support new solutions in areas like Information Lifecycle Management, automatic application provisioning and business impact analysis.","For example, in a particular embodiment, an application collector may collect application information and pass it to a shadow IO manager in Powerpath. The shadow IO manager may collect roundtrip IO Quality of Service (QoS) data. Based on an adaptive sampling algorithm, new shadow IO packages data may be injected along with application IO or just a shadow IO may be injected. The Shadow IOs may be collected. The shadow IO may be written to a special shadow storage device. As well, shadow IOs may be stamped by resources with additional resource information along the way. Once the shadow IO reaches its destination, which in this embodiment can be a special shadow device, behavior analysis appliance may collect application information and related resource information to build up an application dependency mapping. Behavior analysis appliance may collect QoS data from the special device to build weight for the paths utilized.","Reference is now made in detail to exemplary embodiments of the invention, examples of which are illustrated in the accompanying drawings. A computer system may include multiple hosts and multiple data storage subsystems such each host may access data on each of data storage subsystems. For simplicity, however,  illustrates a computer system  that includes a single host  and a single data storage subsystem . Applications  running on operating system  of host  may access data in data storage subsystem  via I\/O driver  and host bus adapters , , , and . Host  can be, for example, a server, a personal computer, or any other device capable of initiating read and write requests to data storage subsystem . Data storage subsystem  can be a single physical data storage device or a data storage system comprising multiple physical data storage devices including an enterprise storage system. For example, data storage subsystem  may be a SYMMETRIX data storage system, available from EMC Corporation of Hopkinton, Mass., a CLARIION data storage system available from EMC Corp., a TagmaStore data storage system available from Hitachi Data Systems Corp. of Santa Clara, Calif., or a FAStT data storage system available from IBM. In computer systems consistent with the principles of the invention, there may be a plurality of data storage subsystems  accessible by host  and each data storage subsystem may be unique.","Host  has multiple paths  for sending I\/O requests to data storage subsystem . Typically, there are at least two paths from a host to a data storage subsystem. Generally, there may be up to 32 paths.  shows four paths from host  to data storage subsystem : path , path , path , and path . Each of the paths  can be any of a number of different types of communication links that allow data to be passed between data storage subsystem  and host . Each of the host bus adapters , , , and  would be adapted to communicate using an appropriate protocol via the paths . For example, path  can be implemented as a SCSI bus with host bus adapters  and storage bus director  each being a SCSI driver. Alternatively, path  between the host  and the data storage subsystem  may be a Fibre Channel fabric. Moreover, a path  may include multiple communication path types and may be part of a communication network.","Host  contains an operating system , applications , I\/O driver , and host bus adapters , , , and . I\/O driver  facilitates the sending of I\/O requests from applications  running on host  to data storage subsystem . The I\/O driver may queue I\/O requests from host  directed to data storage subsystem . In addition, the I\/O driver may implement algorithms to decide which I\/O requests to send, how many I\/O requests to send, and the speed at which to send I\/O requests. The I\/O driver may keep a record of I\/O requests that are sent to data storage subsystem  until the I\/O request is processed by data storage subsystem . An exemplary host I\/O driver is the POWERPATH tool, available from EMC Corp. The POWERPATH tool may use known path selection techniques such as those described in U.S. Pat. No. 6,542,944, entitled \u201cMethod And Apparatus For Balancing Workloads Among Paths In A Multi-Path Computer System Based On The State Of Previous I\/O Operations\u201d and issued on Apr. 1, 2003 to EMC Corp. As well, application Ser. No. 11\/682,049 labeled \u201cMethods And Systems For Dynamic Division of Path Capacity\u201d provides a further description thereof. Both U.S. Pat. No. 6,542,944 and application Ser. No. 11\/682,049 are hereby incorporated by reference.",{"@attributes":{"id":"p-0021","num":"0020"},"figref":"FIG. 2","b":["103","102","103","102","104","260","102","247"]},"I\/O driver  of  may be thought of conceptually as having the form of a \u201cC\u201d clamp with a top horizontal arm , a bottom horizontal arm , and a vertical connector  between the arms. Horizontal arm  may be, for example, an interface to any operating system (OS) such as LINUX, Sun's SOLARIS, IBM's AIX, HP's HPUX, and Microsoft's WINDOWS NT. Bottom horizontal arm  includes platform-dependent code comprising an interface to relevant host bus adapters , , , and . Only host bus adapter  is shown for exemplary purposes. Vertical connector  comprises a series of common Application Programming Interfaces (APIs). An advantage of the C clamp is that extensions can be written in a platform-independent manner because the arms ,  translate all of the platform-dependent communications into more generic communications. An extension stack  is enveloped between arms  and . In addition to a plurality of existing extensions ,  in extension stack , a path selection extension  is added to perform the logical division of path capacity. Path selection extension  can consist of a plurality of extensions.","The I\/O driver, via path extension , may select a path by which to transmit an I\/O request or group of I\/O requests to data storage subsystem . I\/O driver  would communicate with the appropriate host bus adapter , , , or  depending on which path is selected.",{"@attributes":{"id":"p-0024","num":"0023"},"figref":"FIG. 2","b":["300","300","121","122","123","124","110","130","300","100","259","103","110","300","100","110"]},"Given that communication can be distributed across multiple paths, it can be useful to understand the behavioral characters of not only each path, but how each application has its IO distributed across the paths. Current application resource management solutions typically offer limited understanding of behavior of application IT resource usage and performance. As well, current application resource management techniques typically can not distinguish behaviors among applications in the same host because of lack of application identity information. Therefore, the current techniques, in an embodiment, provide application focused solutions which yield application-specific behavioral knowledge data that may be helpful to understand system behavior.",{"@attributes":{"id":"p-0026","num":"0025"},"figref":["FIG. 3","FIG. 3","FIG. 3","FIG. 1","FIG. 1"],"b":["310","330","340","330","335","330","340","345","350","355","350","360","365","310","350","360"]},"Refer now to .  represents an embodiment of one of the current techniques.  is similar to , although augmented to include a Shadow I\/O injector , a Shadow I\/O device , and an Application Behavior Analysis Appliance . Now, Refer to  in conjunction with , which further illustrates a technique of the current disclosure. When information I\/O is in the system space  the Shadow I\/O injector  may inject a shadow I\/O, such as io , into the system. Io  may be injected along with I\/O from a particular application, such as io , or in isolation to test the current system.","In the embodiment of , io , which is a shadow IO, is injected along with the I\/O  of payroll process application . When io  reaches Data Switch  it, along with the other application data I\/O , is stamped with additional information by IO Stamper . Again, when io  reaches storage  it is stamped with additional I\/O information by IO Stamper  and separated from the application I\/O  to a shadow I\/O store . The shadow I\/O may then be analyzed by Application Behavior Analysis engine . However, in any given system there may be multiple applications on a system, which may result in shadow I\/Os being injected for each application. As well, there may be many hosts communicating with given data storage system.","Referring now to , the \u201cc-clamp\u201d architecture of  has been overlayed with the components of the I\/O Shadow Manager to illustrate how the shadow I\/O may be implemented on a Power Path system. In this embodiment, IO  represents input into the PowerPath  system. In this example, IO  progresses into the middle of the PowerPath  \u201cc-clamp\u201d to IO Selector . When the IO  reaches the IO Selector , IO Shadow Manager  may inject a Shadow IO into the system. The IOs may progress out of the \u201cc-clamp\u201d structure to their final destination of IO  and Shadow IO . In some embodiments, the IO may be stored in a data storage system and the Shadow IO may be stored in a Shadow IO storage device.","Referring back to , the Shadow I\/O injector  may be configured in many ways. In general, the Shadow I\/O injector  needs to be capable of monitoring the I\/O in the system and able to inject Shadow I\/Os into the system. The Shadow I\/O injector  can be configured to inject Shadow I\/O in a multitude of ways. For example, the Shadow I\/O injector  may inject Shadow I\/O at a given period of time. The Shadow I\/O injector  could inject Shadow I\/O whenever an application starts to send I\/O as well as at the end of application I\/O. As well, the Shadow I\/O injector  may inject Shadow I\/O at given periods of time during the transmission of application I\/O. Further, the Shadow I\/O injector  can be configured to inject Shadow I\/O based on external input or instructions.","As well, PowerPath may use a selection algorithm to pick an IO for injection for the Shadow I\/O injector. For example, PowerPath shadows IOs may be injected based on knowledge of shadow device. That is, PowerPath may manage shadow device space to analyze system behavior. In a particular embodiment of the current technique, there may be one shadow device per data storage array. As well, there may be one shadow injector for each host in the system. In another embodiment, PowerPath may write application information, original IO header and start timestamp into shadow IOs. In other embodiments, each shadow IO may have a unique identifier. PowerPath may also correlate end timestamp from original IO acknowledgement. In a further embodiment, PowerPath may aggregate original IO end timestamps and write to shadow device periodically.","In another aspect of the current techniques, the Application resource mapping correlator  may create mappings between applications which can be located in Application Space  and the IO performance and associated resources for each application. For POC, only endpoint resources may be available (e.g. host, array). In other embodiments, a process ID (pid) may be the application data in the Shadow IO. A user process on the host can periodically collect process list including pid, process name and timestamp.","The process may use iocmd (ioctl) at the shadow manager to send the process data to shadow device, such as shadow device . Ioctl is part of the user-to-kernel interface of a conventional operating system. Ioctls are typically employed to allow userspace code to communicate with hardware devices or kernel components. A correlator, such as correlator , may collect application information from shadow device . Shadow device  may have a metadata block to control region assignment for each host, such as Host . When PowerPath starts, it can read-in the metadata block and identify the region to use and next available space by looking for 0x00. Two regions may be assigned for each host. PowerPath can coordinate with correlator to process information in the non-use region immediately. In a further aspect of the current techniques, it is useful to note that can be numerous applications in Application Space . The current techniques enable analysis of each particular application, for example to understand the differences between applications running in the same host.","With the current techniques, applied to a system with multi-pathing, a parent IO and shadow IO could end up in different physical paths. The performance data of a particular application's shadow IO can be used as feedback to determine the frequency of injection of other shadow IO. As well, shadow IOs can contain any amount of variable information including process ID and pattern matching information. Multiple hosts may share the same shadow device or each host may have its own shadow device. Each host may have many applications and the Shadow IO may be used to determine the characteristics for each application.","The methods and apparatus of this invention may take the form, at least partially, of program code (i.e., instructions) embodied in tangible media, such as floppy diskettes, CD-ROMs, hard drives, random access or read only-memory, or any other machine-readable storage medium. When the program code is loaded into and executed by a machine, such as a computer, the machine becomes an apparatus for practicing the invention. When implemented on one or more general-purpose processors, the program code combines with such a processor to provide a unique apparatus that operates analogously to specific logic circuits. As such a general purpose digital machine can be transformed into a special purpose digital machine.  shows Program Logic  embodied on a computer-readable medium  as shown, and wherein the Logic is encoded in computer-executable code thereby forming a Computer Program Product .","The logic for carrying out the method may be embodied as part of the system described below, which is useful for carrying out a method described with reference to embodiments shown in, for example,  and . For purposes of illustrating the present invention, the invention is described as embodied in a specific configuration and using special logical arrangements, but one skilled in the art will appreciate that the device is not limited to the specific configuration but rather only by the claims included with this specification.","Although the foregoing invention has been described in some detail for purposes of clarity of understanding, it will be apparent that certain changes and modifications may be practiced within the scope of the appended claims. Accordingly, the present implementations are to be considered as illustrative and not restrictive, and the invention is not to be limited to the details given herein, but may be modified within the scope and equivalents of the appended claims."],"heading":["TECHNICAL FIELD","BACKGROUND","SUMMARY","DETAILED DESCRIPTION"],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"DESCRIPTION OF DRAWINGS","p":[{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0008","num":"0007"},"figref":"FIG. 3"},{"@attributes":{"id":"p-0009","num":"0008"},"figref":"FIG. 4"},{"@attributes":{"id":"p-0010","num":"0009"},"figref":"FIG. 5"},{"@attributes":{"id":"p-0011","num":"0010"},"figref":["FIG. 6","FIG. 2"]},{"@attributes":{"id":"p-0012","num":"0011"},"figref":"FIG. 7"}]},"DETDESC":[{},{}]}
