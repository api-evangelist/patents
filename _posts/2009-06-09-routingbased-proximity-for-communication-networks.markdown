---
title: Routing-based proximity for communication networks
abstract: A node in an overlay network requests a ranked list of other nodes in multiple areas of the overlay network that can provide a desired piece of content or service to the requesting node. A separate node such as a router generates the ranked list using a routing algorithm, returning the list to the requesting node so that the requesting node may acquire the desired content or service from the nearest node in the overlay network.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08179801&OS=08179801&RS=08179801
owner: Cisco Technology, Inc.
number: 08179801
owner_city: San Jose
owner_country: US
publication_date: 20090609
---

{"@attributes":{"id":"description"},"BRFSUM":[{},{}],"heading":["I. FIELD OF THE INVENTION","II. BACKGROUND OF THE INVENTION","DESCRIPTION OF EXAMPLE EMBODIMENTS","Overview","Example Embodiments"],"p":["The present application relates generally to determining proximity in communication networks, including but not limited to peer-to-peer networks and other forms of overlay networks.","A peer-to-peer network is an example of a network (of a limited number of peer devices) that is overlaid on another network, in this case, the Internet. In such networks it is often the case that a piece of content or a service desired by one of the peers can be provided by more than one other node in the overlay network, and it is desirable to select the source node to optimize efficiency.","An apparatus includes a processor and a computer readable storage medium bearing instructions to cause the processor to receive node identifications from a requesting node. The node identifications are associated with respective peers to the requesting node in an overlay network that uses infrastructure of a backbone network. The requesting node resides in a different area than at least some of the peers. The processor uses a shortest path first (SPF) algorithm to determine a respective metric associated with each peer and the requesting node. Based on the metric, a list of peers is generated and returned to the requesting node.","In example non-limiting embodiments, the apparatus can be a service gateway (SG). The processor may install SGs in each area and establish tunnel-based adjacencies among SGs and identify each SG as a member of a given area. Link-state databases may be flooded from the SGs to reflector SGs, where they are stored.","The apparatus may employ an open shortest path firs routing protocol or may employ an intermediate system to intermediate system (ISIS) routing protocol.","In another embodiment, a tangible computer readable medium bears instructions executable by a computer processor for receiving from a requesting node in a communication network a list of other nodes in a plurality of areas in the network that can provide a desired piece of content or service to the requesting node. The instructions cause the processor to generate a ranked list of the other nodes and return the ranked list to the requesting node.","In another embodiment, a computer-implemented method includes receiving a list of at least two nodes residing in a plurality of areas from a requesting node, executing a shortest path first (SPF) algorithm on each of the at least two nodes relative to the requesting node to generate an ordered list of the at least two nodes, and returning the ordered list to the requesting node.","Referring initially to , a backbone network , such as the Internet, includes an overlay network , which includes plural areas , . For simplicity, only two areas are shown in the overlay network . The overlay network , being overlaid on the backbone network  uses the infrastructure of the backbone network . Each area ,  includes a plurality of nodes  (for simplicity, only three nodes are shown in each area).","In the embodiment shown the overlay network  may be a peer-peer network in which content is moved along overlay network links  among consumer end points such as personal digital assistants (PDAs), etc., it being understood that present principles are not necessarily limited to peer-to-peer networks. For example, present principles may apply to a service provider operated overlay network such as a network of service nodes or a service provider operated content delivery network (CDN). Further, in some embodiments an overlay network is not necessarily implicated when, for instance a proximity-sorted list of nodes is to be generated by one node on behalf of another node so that the other node can know the nearest instance of a network service, such as a cache or voice-over-Internet gateway for example.","The backbone network  may include service gateways (SOs) including regular service gateways  and reflector service gateways . The SGs ,  may be part of the overlay network . In one embodiment the SGs ,  may be implemented by a router or switch or server or other node type.","Typically, a SG includes one or more processors  accessing one or more computer readable storage media  such as solid state storage, disk storage, etc. A program, referred to herein as a proximity function, may embody portions of present logic and may be stored on the media  for execution thereof by the processor . Other parts of the logic may be implemented by one or more nodes  of the overlay network . Also, other nodes  including end user client devices, Internet servers, routers, switches, etc. typically are part of the backbone network .",{"@attributes":{"id":"p-0017","num":"0016"},"figref":["FIG. 2","FIGS. 2 and 3"]},"Autonomous System is a set of routers and links under a common administration, typically a service provider network (or a regional part of one) or an enterprise network. An Autonomous System, in addition to being directed to organizing a network, also has implications in the way BGP protocol (defined below) is deployed.","Interior Gateway Protocol (IGP) is a routing protocol deployed inside an Autonomous System and used to create routing schemes including nodes (routers) and links that form the network topology through which IP packets are routed\/forwarded. Example IGPs include Open Shortest Path First (OSPF, a link state routing protocol), Intermediate System to Intermediate System (ISIS, another link state routing protocol), Enhanced Interior Gateway Routing Protocol (EIGRP), and Routing Information Protocol (RIP).","Link-state protocols are routing protocols based on link-state advertisement, of which ISIS and OSPF are examples. Characteristics of link-state protocols include the advertising by each node of its local connectivity to the rest of the other nodes. This is in contrast to distance-vector protocols, wherein each node advertises the content of its routing information base to its adjacent neighbors.","An \u201carea\u201d is a group of contiguous networks and attached hosts that is specified to be an area by a network administrator or manager. A domain is a collection of connected areas. Routing domains provide full connectivity to all end systems within them. \u201cLevels\u201d are defined with respect to areas. For example, Level 1 routing is routing within a single Level 1 area, while Level 2 routing is routing between two (or more) different Level 1 areas.","Border Gateway Protocol (BGP) is a protocol for communicating between an autonomous system and other routers in the underlying network, e.g., to connect one autonomous system to another. BGP's uses include advertising reachability information across Autonomous System boundaries and to propagate reachability information (for instance, as received from an external Autonomous System) into a local Autonomous System.","Shortest Path First (SPF) and Reverse Shortest Path First (R-SPF) are algorithms that can be executed by each router in a link-state network, for instance, by each router that executes either ISIS or OSPF. The purpose of SPF is to build a routing information base (RIB) that is used by the router to route\/forward IP packets. The algorithm can use data structure and logic, including, among data structures, three lists. An \u201cUNKNOWN\u201d list contains all nodes known in the topology (the network) for which no path has been computed yet. A TENTative list contains nodes for which at least one path has been computed (but may not be the shortest one). A PATHS list contains a list of nodes for which shortest path to it has been computed. An SPF or R-SPF algorithm runs by moving nodes from one list to another in the order: UNKNOWN\u2192TENT\u2192PATHS, and stops when the TENT list is emptied. An example SPF algorithm is the Dijkstra Algorithm. The difference between SPF and R-SPF is in the way nodes are inspected and evaluated during the algorithm. The forward SPF algorithm computes the shortest path based on the cost from a reference node to each other node in the network while the R-SPF (reverse) takes into account the reverse metric, i.e., the metric from each node in the network to the reference node.","Area border router (ABR) node is a node that has connections to nodes in more than one area.","Referring again to , an SG  implements routing protocols (ISIS, OSPF and BOP) and a set of proximity algorithms, and exposes an Application Programming Interface (APT), such as a Web service. An SG  receives proximity requests from clients and replies to these requests with proximity responses. A proximity request contains a Proximity Source Address (PSA), or reference address, and a list of IP addresses, referred to as Proximity Target Addresses (PTAs). The PTAs represents the candidate list, which is referred to as the Proximity Target List (PTL).","The proximity function returns a ranked list of IP addresses. The ranking is based on topological (metric) distance from the given reference address. For example, a client of a content exchange application, with an IP address 192.168.199.11, has the choice of downloading a given content from IP addresses: 192.168.10.1, 192.168.33.22 and 192.168.54.2. The client node sends a request to the SG . The proximity request has the following form:\n\n","In , at block , a node (referred to herein as a \u201crequesting node\u201d) in the overlay network  that wishes to obtain objects\/services from another node in the network  generates a list of overlay network nodes (also referred to as \u201cpeers\u201d) reflecting objects and\/or services that are available at each node . The overlay network nodes may be in the same area  as the requesting node , or may be in another area, such as area . The list is sent at block  to the SG  executing the proximity function along with a request to re-order the list according to the proximity of the peer nodes to the requesting node (which is the reference node in the subsequent SPF calculations).","The SG  executes the proximity function at block  to generate a list ordered by proximity to the requesting node of the peer nodes , preferably without disrupting the service provider of the overlay network . To this end, the SG  may be programmed to never originate any routing update pursuant to its cooperation with the overlay network  in the form of, e.g. ISIS or OSPF or BGP packets. Also, the SG may be programmed to never attract traffic pursuant to its cooperation with the overlay network  by, for example, setting appropriate values for ISIS overload bits and\/or for OSPF \u201cmaxage\u201d metrics.","With more specificity, in example non-limiting embodiments the SG  acquires routing information from routing protocols such as OSPF\/ISIS\/BGP. To do this, the SG  participates in the routing scheme in the sense that it establishes adjacencies\/sessions with routers and collects a routing database as part of the normal routing protocol operations. However, in example embodiments the SG does not fully become part of the routing scheme in the sense that the SG  does not become a \u201crouter\u201d in terms of routing\/forwarding traffic unrelated to the present discussion. Accordingly, in example embodiments the SG  diverts incoming traffic using the overload bit (in the case of ISIS), or the \u201cmax metric\u201d (in the case of OSPF\/ISIS) such that apart from its operation discussed herein the SG  is transparent to the network. Thus, in example embodiments the SG  does not receive any traffic that would require a routing\/forwarding operation; however, in example embodiment the SG  receives traffic if and only if such traffic is destined to the SG  itself.","Returning to , the proximity function causes the SG  to return the ordered list to the requesting node at block . Details on how a SG initializes and executes the proximity function are set forth in co-pending U.S. patent application Ser. No. 12\/368,436, incorporated herein by reference. For convenience, relevant details from the referenced patent application are set forth as follows.","All nodes that \u201cadvertise\u201d the requesting node are moved into a TENT list of the SG. By \u201cadvertise\u201d is meant indicate a peer relationship with the requesting node. The \u201cadvertising nodes\u201d typically are the nodes compiled by the requesting node and sent to the SG as part of the request to reorder the nodes by proximity. In this way, the SG is better permitted to process multi-homed prefixes. Pseudonodes in the TENT list may be given higher preference than non-pseudonodes. A pseudonode may be established by a local area network (LAN) or other entity that might be represented as a single node. By \u201cpreference\u201d is meant that when a node is to be moved into the PATHS list from the TENT list and a nonpseudonode and a pseudonode both have the same cost (root distance), the pseudonode is preferred.","As explained in the referenced patent application, for all TENT nodes sharing a common prefix with the requesting node (i.e., is co-located with the requesting node), the proximity of such nodes is set to zero. That is, when the requesting node shares the same subnet with one or more nodes under test (and thus are \u201cco-located\u201d), the co-located node or nodes under test are preferred.","A SPF cycle is started for each node in the TENT list, wherein as each TENT node is moved into the PATHS list of the SG the prefixes advertised by the node being moved are inspected. If all prefixes for which proximity is to be evaluated are processed (i.e., all prefixes to be evaluated are known into the PATHS list), then the proximity algorithm can stop because proximity has been computed for all requested prefixes.","A SPF metric is computed for each node in the PATHS list relative to the requesting node. An SPF metric represents proximity between the requesting node and another node. When a requesting node requests an object or service a reverse-SPF calculation may be used, i.e., an SPF calculation may be made from the PATHS node under test to the requesting node. In the event that the requesting node is requesting to upload an object or service to another node in the overlay network, a forward-SPF calculation used, i.e., from the requesting node to the PATHS node under test.","Once proximity metrics have been calculated for all nodes in the PATHS list, a ranked list of nodes is generated by proximity, e.g., from closest proximity to farthest from the requesting node. The list is returned to the requesting node, which can consult the list to obtain the desired object\/service, typically by communicating with the node at the \u201cclosest\u201d end of the list.",{"@attributes":{"id":"p-0036","num":"0039"},"figref":["FIG. 3","FIG. 3","FIG. 2","FIG. 3"],"b":["14","16","34","36","22","40","22","10","42","22"]},"One or more SGs, referred to as \u201creflector SGs\u201d  may function as IGP Route Reflectors using, e.g., BGP route reflection principles with the exception that the requesting node does not offer a selection of prefix preference. The reflector SGs  receive link-state databases from their peer SGs and pass those databases on to other SG peers. In such example embodiments, each SG  has a TA with one and only one reflector SG  for efficiency, and a reflector SG  implements logic in which LSA\/LSP information received by a non-TA neighbor is sent to all TA neighbors and non-TA neighbors, with information received by a TA neighbor being sent only to all other TA neighbors.","With the above information exchange and scope of TAs between SGs residing in different areas, a SG can correlate with each other the various link state databases it receives. With more specificity, when a ABR\/L1L2 router (a router that interfaces between two different levels) is reached, the corresponding link state database (LSDB) is inspected by the SG and proximity computation continues by exploring this other area\/level. This requires an identification or association information between the ABR and its area to be communicated as mentioned above, which information is available through the above-described SG TAs. As an example, an SG  can compute proximity to find the shortest path to an ABR, which can have different IDs in different areas\/levels. With this information, the SG  determines which other areas also have the same ABR present as indicated by the ABR IDs associated with that other area, with the SG then continuing the proximity calculations for nodes in such other area.","Note that a SG need not recompute proximity because of a convergence change (i.e., a convergence change in an IGP area need not trigger proximity recomputation).","As mentioned above, in some example embodiments each SG  has a session\/adjacency with a single reflector SG . As also described above and referring back to , at block  each SG  identifies itself as a member of a given area ID (given by either OSPF or ISIS area address\/number) and exchanges this identification information with other SGs when establishing a TA relationship.","Reflecting the description above in , each SG  also floods its link-state database to the reflector SG  at block . In flooding, a source node sends a message to all other nodes in the network. The reflector SG  stores the databases from all areas and floods them to all reflector-client SGs in block . This may be done according to a basic split-horizon rule: do not reflect a given area database back to an SG  that is a member of the same area.","When reflection work is completed, each SG  has received all link-state area databases. This will enable at block , SPF (or reverse SPF) calculations at an SG  to proceed in accordance with the description above even if the Proximity Source Address (PSA) and one or more Proximity Target Addresses (PTAS) are not in the same area.","The performance of the SPF\/R-SPF algorithms may be performed differently depending on whether OSPF or ISIS routing protocols are applied. In the case of OSPF during SPF\/R-SPF calculations, when the calculation reaches an ABR, the databases for both Area  (its own area) and the other areas in which ABR participates are inspected. These multiple topologies can be attached to form a single tree and the computation may proceed much as in the case of a single tree.","In the case of ISIS, during SPF\/R-SPF calculations, when the calculation reaches a L1L2 router, the level-2 database and the level-1 database(s) in which the router participates are inspected. The level-1 database(s) and the level-2 database can be attached together in order to form a single tree, and the computation proceeds as described above.","While the particular ROUTING-BASED PROXIMITY FOR COMMUNICATION NETWORKS is herein shown and described in detail, it is to be understood that the subject matter which is encompassed by the present disclosure is limited only by the claims."],"brief-description-of-drawings":[{},{}],"description-of-drawings":{"heading":"BRIEF DESCRIPTION OF THE DRAWINGS","p":["The details of the present disclosure, both as to its structure and operation, can best be understood in reference to the accompanying drawings, in which like reference numerals refer to like parts, and in which:",{"@attributes":{"id":"p-0005","num":"0004"},"figref":"FIG. 1"},{"@attributes":{"id":"p-0006","num":"0005"},"figref":"FIG. 2"},{"@attributes":{"id":"p-0007","num":"0006"},"figref":"FIG. 3"}]},"DETDESC":[{},{}]}
